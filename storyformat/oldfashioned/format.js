window.storyFormat({"name":"OldFashioned","version":"2.7.2","description":"An AR extension to the Twine 2 port of the Twine 1 SugarCube story format.  See its <a href=\"http://www.motoslave.net/sugarcube/2/#documentation\" target=\"_blank\">documentation</a>.","author":"Blair MacIntyre and Thomas Michael Edwards","image":"icon.svg","url":"http://www.motoslave.net/sugarcube/","license":"Simplified BSD License","proofing":false,"source":"<!DOCTYPE html>\n<html class=\"init-no-js\">\n<head>\n<meta charset=\"UTF-8\" />\n<title>{{STORY_NAME}}</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<!--\n\nOldFashioned superset of SugarCube (v2.7.2): A free (gratis and libre) story format, based on TiddlyWiki.\n\nCopyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>.\nAll rights reserved.\n\nParts copyright © 2016 Blair MacIntyre <blair@cc.gatech.edu>.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this\n   list of conditions and the following disclaimer.\n2. Redistributions in binary form must reproduce the above copyright notice,\n   this list of conditions and the following disclaimer in the documentation\n   and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\nANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n-->\n<script id=\"script-libraries\" type=\"text/javascript\">\nif(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.className=\"init-loading\";\n/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */\nif(\"document\" in self){if(!(\"classList\" in document.createElement(\"_\"))){(function(j){\"use strict\";if(!(\"Element\" in j)){return}var a=\"classList\",f=\"prototype\",m=j.Element[f],b=Object,k=String[f].trim||function(){return this.replace(/^\\s+|\\s+$/g,\"\")},c=Array[f].indexOf||function(q){var p=0,o=this.length;for(;p<o;p++){if(p in this&&this[p]===q){return p}}return -1},n=function(o,p){this.name=o;this.code=DOMException[o];this.message=p},g=function(p,o){if(o===\"\"){throw new n(\"SYNTAX_ERR\",\"An invalid or illegal string was specified\")}if(/\\s/.test(o)){throw new n(\"INVALID_CHARACTER_ERR\",\"String contains an invalid character\")}return c.call(p,o)},d=function(s){var r=k.call(s.getAttribute(\"class\")||\"\"),q=r?r.split(/\\s+/):[],p=0,o=q.length;for(;p<o;p++){this.push(q[p])}this._updateClassName=function(){s.setAttribute(\"class\",this.toString())}},e=d[f]=[],i=function(){return new d(this)};n[f]=Error[f];e.item=function(o){return this[o]||null};e.contains=function(o){o+=\"\";return g(this,o)!==-1};e.add=function(){var s=arguments,r=0,p=s.length,q,o=false;do{q=s[r]+\"\";if(g(this,q)===-1){this.push(q);o=true}}while(++r<p);if(o){this._updateClassName()}};e.remove=function(){var t=arguments,s=0,p=t.length,r,o=false,q;do{r=t[s]+\"\";q=g(this,r);while(q!==-1){this.splice(q,1);o=true;q=g(this,r)}}while(++s<p);if(o){this._updateClassName()}};e.toggle=function(p,q){p+=\"\";var o=this.contains(p),r=o?q!==true&&\"remove\":q!==false&&\"add\";if(r){this[r](p)}if(q===true||q===false){return q}else{return !o}};e.toString=function(){return this.join(\" \")};if(b.defineProperty){var l={get:i,enumerable:true,configurable:true};try{b.defineProperty(m,a,l)}catch(h){if(h.number===-2146823252){l.enumerable=false;b.defineProperty(m,a,l)}}}else{if(b[f].__defineGetter__){m.__defineGetter__(a,i)}}}(self))}else{(function(){var b=document.createElement(\"_\");b.classList.add(\"c1\",\"c2\");if(!b.classList.contains(\"c2\")){var c=function(e){var d=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(h){var g,f=arguments.length;for(g=0;g<f;g++){h=arguments[g];d.call(this,h)}}};c(\"add\");c(\"remove\")}b.classList.toggle(\"c3\",false);if(b.classList.contains(\"c3\")){var a=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(d,e){if(1 in arguments&&!this.contains(d)===!e){return e}else{return a.call(this,d)}}}b=null}())}};\n/*!\n * https://github.com/es-shims/es5-shim\n * @license es5-shim Copyright 2009-2015 by contributors, MIT License\n * see https://github.com/es-shims/es5-shim/blob/v4.5.6/LICENSE\n */\n(function(t,r){\"use strict\";if(typeof define===\"function\"&&define.amd){define(r)}else if(typeof exports===\"object\"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol===\"function\"&&typeof Symbol.toStringTag===\"symbol\";var D;var x=Function.prototype.toString,S=/\\s*class /,O=function isES6ClassFn(t){try{var r=x.call(t);var e=r.replace(/\\/\\/.*\\n/g,\"\");var n=e.replace(/\\/\\*[.\\s\\S]*\\*\\//g,\"\");var i=n.replace(/\\n/gm,\" \").replace(/ {2}/g,\" \");return S.test(i)}catch(a){return false}},E=function tryFunctionObject(t){try{if(O(t)){return false}x.call(t);return true}catch(r){return false}},j=\"[object Function]\",I=\"[object GeneratorFunction]\",D=function isCallable(t){if(!t){return false}if(typeof t!==\"function\"&&typeof t!==\"object\"){return false}if(m){return E(t)}if(O(t)){return false}var r=T.call(t);return r===j||r===I};var M;var U=RegExp.prototype.exec,F=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},N=\"[object RegExp]\";M=function isRegex(t){if(typeof t!==\"object\"){return false}return m?F(t):T.call(t)===N};var C;var k=String.prototype.valueOf,R=function tryStringObject(t){try{k.call(t);return true}catch(r){return false}},A=\"[object String]\";C=function isString(t){if(typeof t===\"string\"){return true}if(typeof t!==\"object\"){return false}return m?R(t):T.call(t)===A};var P=e.defineProperty&&function(){try{var t={};e.defineProperty(t,\"x\",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var $=function(t){var r;if(P){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!==\"object\"&&r!==\"function\"};var Y=u.isNaN||function(t){return t!==t};var Z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError(\"can't convert \"+t+\" to object\")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var z=function Empty(){};$(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError(\"Function.prototype.bind called on incompatible \"+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,\"$\"+l)}a=i(\"binder\",\"return function (\"+y.call(u,\",\")+\"){ return binder.apply(this, arguments); }\")(o);if(r.prototype){z.prototype=r.prototype;a.prototype=new z;z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var B=d.bind(n.toString);var H=d.bind(s);var W=g.bind(s);var L=d.bind(f.slice);var X=d.bind(f.split);var q=d.bind(f.indexOf);var K=d.bind(v);var Q=d.bind(n.propertyIsEnumerable);var V=d.bind(r.sort);var _=t.isArray||function isArray(t){return B(t)===\"[object Array]\"};var tt=[].unshift(0)!==1;$(r,{unshift:function(){h.apply(this,arguments);return this.length}},tt);$(t,{isArray:_});var rt=e(\"a\");var et=rt[0]!==\"a\"||!(0 in rt);var nt=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call(\"foo\",function(t,e,n){if(typeof n!==\"object\"){r=false}});t.call([1],function(){\"use strict\";e=typeof this===\"string\"},\"x\")}catch(i){n=true}}return!!t&&!n&&r&&e};$(r,{forEach:function forEach(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,\"\"):r;var n=-1;var i=Z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError(\"Array.prototype.forEach callback must be a function\")}while(++n<i){if(n in e){if(typeof a===\"undefined\"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!nt(r.forEach));$(r,{map:function map(r){var e=Z.ToObject(this);var n=et&&C(this)?X(this,\"\"):e;var i=Z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError(\"Array.prototype.map callback must be a function\")}for(var f=0;f<i;f++){if(f in n){if(typeof o===\"undefined\"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!nt(r.map));$(r,{filter:function filter(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,\"\"):r;var n=Z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError(\"Array.prototype.filter callback must be a function\")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o===\"undefined\"?t(a,f,r):t.call(o,a,f,r)){K(i,a)}}}return i}},!nt(r.filter));$(r,{every:function every(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,\"\"):r;var n=Z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError(\"Array.prototype.every callback must be a function\")}for(var a=0;a<n;a++){if(a in e&&!(typeof i===\"undefined\"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!nt(r.every));$(r,{some:function some(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,\"\"):r;var n=Z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError(\"Array.prototype.some callback must be a function\")}for(var a=0;a<n;a++){if(a in e&&(typeof i===\"undefined\"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!nt(r.some));var it=false;if(r.reduce){it=typeof r.reduce.call(\"es5\",function(t,r,e,n){return n})===\"object\"}$(r,{reduce:function reduce(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,\"\"):r;var n=Z.ToUint32(e.length);if(!D(t)){throw new TypeError(\"Array.prototype.reduce callback must be a function\")}if(n===0&&arguments.length===1){throw new TypeError(\"reduce of empty array with no initial value\")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError(\"reduce of empty array with no initial value\")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!it);var at=false;if(r.reduceRight){at=typeof r.reduceRight.call(\"es5\",function(t,r,e,n){return n})===\"object\"}$(r,{reduceRight:function reduceRight(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,\"\"):r;var n=Z.ToUint32(e.length);if(!D(t)){throw new TypeError(\"Array.prototype.reduceRight callback must be a function\")}if(n===0&&arguments.length===1){throw new TypeError(\"reduceRight of empty array with no initial value\")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError(\"reduceRight of empty array with no initial value\")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!at);var ot=r.indexOf&&[0,1].indexOf(1,2)!==-1;$(r,{indexOf:function indexOf(t){var r=et&&C(this)?X(this,\"\"):Z.ToObject(this);var e=Z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=Z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},ot);var ft=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;$(r,{lastIndexOf:function lastIndexOf(t){var r=et&&C(this)?X(this,\"\"):Z.ToObject(this);var e=Z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,Z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},ft);var ut=function(){var t=[1,2];var r=t.splice();return t.length===2&&_(r)&&r.length===0}();$(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ut);var lt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();$(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(Z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!==\"number\"){e=H(arguments);if(e.length<2){K(e,this.length-t)}else{e[1]=Z.ToInteger(r)}}return c.apply(this,e)}},!lt);var st=function(){var r=new t(1e5);r[8]=\"x\";r.splice(1,1);return r.indexOf(\"x\")===7}();var ct=function(){var t=256;var r=[];r[t]=\"a\";r.splice(t+1,0,\"b\");return r[t]===\"a\"}();$(r,{splice:function splice(t,r){var e=Z.ToObject(this);var n=[];var i=Z.ToUint32(e.length);var a=Z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=b(w(Z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=H(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!st||!ct);var vt=r.join;var ht;try{ht=Array.prototype.join.call(\"123\",\",\")!==\"1,2,3\"}catch(pt){ht=true}if(ht){$(r,{join:function join(t){var r=typeof t===\"undefined\"?\",\":t;return vt.call(C(this)?X(this,\"\"):this,r)}},ht)}var yt=[1,2].join(undefined)!==\"1,2\";if(yt){$(r,{join:function join(t){var r=typeof t===\"undefined\"?\",\":t;return vt.call(this,r)}},yt)}var dt=function push(t){var r=Z.ToObject(this);var e=Z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var gt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!==\"undefined\"||!G(t,0)}();$(r,{push:function push(t){if(_(this)){return v.apply(this,arguments)}return dt.apply(this,arguments)}},gt);var wt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!==\"undefined\"||!G(t,0)}();$(r,{push:dt},wt);$(r,{slice:function(t,r){var e=C(this)?X(this,\"\"):this;return W(e,arguments)}},et);var bt=function(){try{[1,2].sort(null);[1,2].sort({});return true}catch(t){}return false}();var Tt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var mt=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();$(r,{sort:function sort(t){if(typeof t===\"undefined\"){return V(this)}if(!D(t)){throw new TypeError(\"Array.prototype.sort callback must be a function\")}return V(this,t)}},bt||!mt||!Tt);var Dt=!{toString:null}.propertyIsEnumerable(\"toString\");var xt=function(){}.propertyIsEnumerable(\"prototype\");var St=!G(\"x\",\"0\");var Ot=function(t){var r=t.constructor;return r&&r.prototype===t};var Et={$window:true,$console:true,$parent:true,$self:true,$frame:true,$frames:true,$frameElement:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$external:true};var jt=function(){if(typeof window===\"undefined\"){return false}for(var t in window){try{if(!Et[\"$\"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]===\"object\"){Ot(window[t])}}catch(r){return true}}return false}();var It=function(t){if(typeof window===\"undefined\"||!jt){return Ot(t)}try{return Ot(t)}catch(r){return false}};var Mt=[\"toString\",\"toLocaleString\",\"valueOf\",\"hasOwnProperty\",\"isPrototypeOf\",\"propertyIsEnumerable\",\"constructor\"];var Ut=Mt.length;var Ft=function isArguments(t){return B(t)===\"[object Arguments]\"};var Nt=function isArguments(t){return t!==null&&typeof t===\"object\"&&typeof t.length===\"number\"&&t.length>=0&&!_(t)&&D(t.callee)};var Ct=Ft(arguments)?Ft:Nt;$(e,{keys:function keys(t){var r=D(t);var e=Ct(t);var n=t!==null&&typeof t===\"object\";var i=n&&C(t);if(!n&&!r&&!e){throw new TypeError(\"Object.keys called on a non-object\")}var a=[];var f=xt&&r;if(i&&St||e){for(var u=0;u<t.length;++u){K(a,o(u))}}if(!e){for(var l in t){if(!(f&&l===\"prototype\")&&G(t,l)){K(a,o(l))}}}if(Dt){var s=It(t);for(var c=0;c<Ut;c++){var v=Mt[c];if(!(s&&v===\"constructor\")&&G(t,v)){K(a,v)}}}return a}});var kt=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var Rt=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var At=e.keys;$(e,{keys:function keys(t){if(Ct(t)){return At(H(t))}else{return At(t)}}},!kt||Rt);var Pt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var $t=new Date(-0x55d318d56a724);var Jt=new Date(14496624e5);var Yt=$t.toUTCString()!==\"Mon, 01 Jan -45875 11:59:59 GMT\";var Zt;var zt;var Gt=$t.getTimezoneOffset();if(Gt<-720){Zt=$t.toDateString()!==\"Tue Jan 02 -45875\";zt=!/^Thu Dec 10 2015 \\d\\d:\\d\\d:\\d\\d GMT[-\\+]\\d\\d\\d\\d(?: |$)/.test(Jt.toString())}else{Zt=$t.toDateString()!==\"Mon Jan 01 -45875\";zt=!/^Wed Dec 09 2015 \\d\\d:\\d\\d:\\d\\d GMT[-\\+]\\d\\d\\d\\d(?: |$)/.test(Jt.toString())}var Bt=d.bind(Date.prototype.getFullYear);var Ht=d.bind(Date.prototype.getMonth);var Wt=d.bind(Date.prototype.getDate);var Lt=d.bind(Date.prototype.getUTCFullYear);var Xt=d.bind(Date.prototype.getUTCMonth);var qt=d.bind(Date.prototype.getUTCDate);var Kt=d.bind(Date.prototype.getUTCDay);var Qt=d.bind(Date.prototype.getUTCHours);var Vt=d.bind(Date.prototype.getUTCMinutes);var _t=d.bind(Date.prototype.getUTCSeconds);var tr=d.bind(Date.prototype.getUTCMilliseconds);var rr=[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"];var er=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];var nr=function daysInMonth(t,r){return Wt(new Date(r,t,0))};$(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Bt(this);if(t<0&&Ht(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Bt(this);var r=Ht(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Bt(this);var r=Ht(this);var e=Wt(this);if(t<0&&r>11){if(r===12){return e}var n=nr(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Lt(this);if(t<0&&Xt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Lt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Lt(this);var r=Xt(this);var e=qt(this);if(t<0&&r>11){if(r===12){return e}var n=nr(0,t+1);return n-e+1}return e}},Pt);$(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Kt(this);var r=qt(this);var e=Xt(this);var n=Lt(this);var i=Qt(this);var a=Vt(this);var o=_t(this);return rr[t]+\", \"+(r<10?\"0\"+r:r)+\" \"+er[e]+\" \"+n+\" \"+(i<10?\"0\"+i:i)+\":\"+(a<10?\"0\"+a:a)+\":\"+(o<10?\"0\"+o:o)+\" GMT\"}},Pt||Yt);$(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return rr[t]+\" \"+er[e]+\" \"+(r<10?\"0\"+r:r)+\" \"+n}},Pt||Zt);if(Pt||zt){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return rr[t]+\" \"+er[e]+\" \"+(r<10?\"0\"+r:r)+\" \"+n+\" \"+(i<10?\"0\"+i:i)+\":\"+(a<10?\"0\"+a:a)+\":\"+(o<10?\"0\"+o:o)+\" GMT\"+(f>0?\"-\":\"+\")+(u<10?\"0\"+u:u)+(l<10?\"0\"+l:l)};if(P){e.defineProperty(Date.prototype,\"toString\",{configurable:true,enumerable:false,writable:true})}}var ir=-621987552e5;var ar=\"-000001\";var or=Date.prototype.toISOString&&new Date(ir).toISOString().indexOf(ar)===-1;var fr=Date.prototype.toISOString&&new Date(-1).toISOString()!==\"1969-12-31T23:59:59.999Z\";var ur=d.bind(Date.prototype.getTime);$(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(ur(this))){throw new RangeError(\"Date.prototype.toISOString called on non-finite value.\")}var t=Lt(this);var r=Xt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,qt(this),Qt(this),Vt(this),_t(this)];t=(t<0?\"-\":t>9999?\"+\":\"\")+L(\"00000\"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=L(\"00\"+e[n],-2)}return t+\"-\"+H(e,0,2).join(\"-\")+\"T\"+H(e,2).join(\":\")+\".\"+L(\"000\"+tr(this),-3)+\"Z\"}},or||fr);var lr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(ir).toJSON().indexOf(ar)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!lr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=Z.ToPrimitive(r);if(typeof n===\"number\"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError(\"toISOString property is not callable\")}return i.call(r)}}var sr=Date.parse(\"+033658-09-27T01:46:40.000Z\")===1e15;var cr=!isNaN(Date.parse(\"2012-04-04T24:00:00.500Z\"))||!isNaN(Date.parse(\"2012-11-31T23:59:59.000Z\"))||!isNaN(Date.parse(\"2012-12-31T23:59:60.000Z\"));var vr=isNaN(Date.parse(\"2000-01-01T00:00:00.000Z\"));if(vr||cr||!sr){var hr=Math.pow(2,31)-1;var pr=Y(new Date(1970,0,1,0,0,0,hr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(pr&&s>=7&&l>hr){var p=Math.floor(l/hr)*hr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){$(c,{constructor:r},true)}return c};var e=new RegExp(\"^\"+\"(\\\\d{4}|[+-]\\\\d{6})\"+\"(?:-(\\\\d{2})\"+\"(?:-(\\\\d{2})\"+\"(?:\"+\"T(\\\\d{2})\"+\":(\\\\d{2})\"+\"(?:\"+\":(\\\\d{2})\"+\"(?:(\\\\.\\\\d{1,}))?\"+\")?\"+\"(\"+\"Z|\"+\"(?:\"+\"([-+])\"+\"(\\\\d{2})\"+\":(\\\\d{2})\"+\")\"+\")?)?)?)?\"+\"$\");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(pr&&n>hr){var i=Math.floor(n/hr)*hr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}$(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;$(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]===\"-\"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};$(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var yr=l.toFixed&&(8e-5.toFixed(3)!==\"0.000\"||.9.toFixed(0)!==\"1\"||1.255.toFixed(2)!==\"1.25\"||0xde0b6b3a7640080.toFixed(0)!==\"1000000000000000128\");var dr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<dr.size){n+=t*dr.data[e];dr.data[e]=n%dr.base;n=Math.floor(n/dr.base)}},divide:function divide(t){var r=dr.size;var e=0;while(--r>=0){e+=dr.data[r];dr.data[r]=Math.floor(e/t);e=e%t*dr.base}},numToString:function numToString(){var t=dr.size;var r=\"\";while(--t>=0){if(r!==\"\"||t===0||dr.data[t]!==0){var e=o(dr.data[t]);if(r===\"\"){r=e}else{r+=L(\"0000000\",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var gr=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError(\"Number.toFixed called with invalid number of decimals\")}e=u(this);if(Y(e)){return\"NaN\"}if(e<=-1e21||e>=1e21){return o(e)}n=\"\";if(e<0){n=\"-\";e=-e}i=\"0\";if(e>1e-21){a=dr.log(e*dr.pow(2,69,1))-69;f=a<0?e*dr.pow(2,-a,1):e/dr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){dr.multiply(0,f);l=r;while(l>=7){dr.multiply(1e7,0);l-=7}dr.multiply(dr.pow(10,l,1),0);l=a-1;while(l>=23){dr.divide(1<<23);l-=23}dr.divide(1<<l);dr.multiply(1,1);dr.divide(2);i=dr.numToString()}else{dr.multiply(0,f);dr.multiply(1<<-a,0);i=dr.numToString()+L(\"0.00000000000000000000\",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+L(\"0.0000000000000000000\",0,r-s+2)+i}else{i=n+L(i,0,s-r)+\".\"+L(i,s-r)}}else{i=n+i}return i};$(l,{toFixed:gr},yr);var wr=function(){try{return 1..toPrecision(undefined)===\"1\"}catch(t){return true}}();var br=l.toPrecision;$(l,{toPrecision:function toPrecision(t){return typeof t===\"undefined\"?br.call(this):br.call(this,t)}},wr);if(\"ab\".split(/(?:ab)*/).length!==2||\".\".split(/(.?)(.?)/).length!==4||\"tesst\".split(/(s)*/)[1]===\"t\"||\"test\".split(/(?:)/,-1).length!==4||\"\".split(/.?/).length||\".\".split(/()()/).length>1){(function(){var t=typeof/()??/.exec(\"\")[1]===\"undefined\";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e===\"undefined\"&&n===0){return[]}if(!M(e)){return X(this,e,n)}var a=[];var o=(e.ignoreCase?\"i\":\"\")+(e.multiline?\"m\":\"\")+(e.unicode?\"u\":\"\")+(e.sticky?\"y\":\"\"),f=0,u,l,s,c;var h=new RegExp(e.source,o+\"g\");if(!t){u=new RegExp(\"^\"+h.source+\"$(?!\\\\s)\",o)}var p=typeof n===\"undefined\"?r:Z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){K(a,L(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]===\"undefined\"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,H(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test(\"\")){K(a,\"\")}}else{K(a,L(i,f))}return a.length>p?H(a,0,p):a}})()}else if(\"0\".split(void 0,0).length){f.split=function split(t,r){if(typeof t===\"undefined\"&&r===0){return[]}return X(this,t,r)}}var Tr=f.replace;var mr=function(){var t=[];\"x\".replace(/x(.)?/g,function(r,e){K(t,e)});return t.length===1&&typeof t[0]===\"undefined\"}();if(!mr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\\)[*?]/.test(t.source);if(!e||!n){return Tr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;K(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Tr.call(this,t,i)}}}var Dr=f.substr;var xr=\"\".substr&&\"0b\".substr(-1)!==\"b\";$(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return Dr.call(this,e,r)}},xr);var Sr=\"\t\\n\\x0B\\f\\r \\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\"+\"\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\"+\"\\u2029\\ufeff\";var Or=\"\\u200b\";var Er=\"[\"+Sr+\"]\";var jr=new RegExp(\"^\"+Er+Er+\"*\");var Ir=new RegExp(Er+Er+\"*$\");var Mr=f.trim&&(Sr.trim()||!Or.trim());$(f,{trim:function trim(){if(typeof this===\"undefined\"||this===null){throw new TypeError(\"can't convert \"+this+\" to object\")}return o(this).replace(jr,\"\").replace(Ir,\"\")}},Mr);var Ur=d.bind(String.prototype.trim);var Fr=f.lastIndexOf&&\"abc\\u3042\\u3044\".lastIndexOf(\"\\u3042\\u3044\",2)!==-1;$(f,{lastIndexOf:function lastIndexOf(t){if(typeof this===\"undefined\"||this===null){throw new TypeError(\"can't convert \"+this+\" to object\")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:Z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=q(L(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Fr);var Nr=f.lastIndexOf;$(f,{lastIndexOf:function lastIndexOf(t){return Nr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(Sr+\"08\")!==8||parseInt(Sr+\"0x16\")!==22){parseInt=function(t){var r=/^[\\-+]?0[xX]/;return function parseInt(e,n){var i=Ur(e);var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat(\"-0\")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Ur(r);var n=t(e);return n===0&&L(e,0,1)===\"-\"?-0:n}}(parseFloat)}if(String(new RangeError(\"test\"))!==\"RangeError: test\"){var Cr=function toString(){if(typeof this===\"undefined\"||this===null){throw new TypeError(\"can't convert \"+this+\" to object\")}var t=this.name;if(typeof t===\"undefined\"){t=\"Error\"}else if(typeof t!==\"string\"){t=o(t)}var r=this.message;if(typeof r===\"undefined\"){r=\"\"}else if(typeof r!==\"string\"){r=o(r)}if(!t){return r}if(!r){return t}return t+\": \"+r};Error.prototype.toString=Cr}if(P){var kr=function(t,r){if(Q(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);e.enumerable=false;Object.defineProperty(t,r,e)}};kr(Error.prototype,\"message\");if(Error.prototype.message!==\"\"){Error.prototype.message=\"\"}kr(Error.prototype,\"name\")}if(String(/a/gim)!==\"/a/gim\"){var Rr=function toString(){var t=\"/\"+this.source+\"/\";if(this.global){t+=\"g\"}if(this.ignoreCase){t+=\"i\"}if(this.multiline){t+=\"m\"}return t};RegExp.prototype.toString=Rr}});\n/*!\n * https://github.com/paulmillr/es6-shim\n * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)\n *   and contributors,  MIT License\n * es6-shim: v0.35.0\n * see https://github.com/paulmillr/es6-shim/blob/0.35.0/LICENSE\n * Details and documentation:\n * https://github.com/paulmillr/es6-shim/\n */\n(function(e,t){if(typeof define===\"function\"&&define.amd){define(t)}else if(typeof exports===\"object\"){module.exports=t()}else{e.returnExports=t()}})(this,function(){\"use strict\";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){Object.defineProperty({},\"x\",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name===\"foo\";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/===\"function\"?function IsCallableSlow(e){return typeof e===\"function\"&&g(e)===\"[object Function]\"}:function IsCallableFast(e){return typeof e===\"function\"};var O={getter:function(e,t,r){if(!s){throw new TypeError(\"getters require true ES5 support\")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError(\"getters require true ES5 support\")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if(\"value\"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,\"toString\",t.toString.bind(t),true)}}};var m=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!==\"undefined\"){n(t).forEach(function(e){O.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=m(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!==\"undefined\"){return self}if(typeof window!==\"undefined\"){return window}if(typeof global!==\"undefined\"){return global}throw new Error(\"unable to locate global object\")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var M=Function.call.bind(Array.prototype.sort);var C=Function.call.bind(String.prototype.slice);var x=Function.call.bind(Array.prototype.push);var N=Function.apply.bind(Array.prototype.push);var A=Function.call.bind(Array.prototype.shift);var R=Math.max;var _=Math.min;var k=Math.floor;var F=Math.abs;var L=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var G=function(){};var W=S.Symbol||{};var H=W.species||\"@@species\";var V=Number.isNaN||function isNaN(e){return e!==e};var B=Number.isFinite||function isFinite(e){return typeof e===\"number\"&&T(e)};var $=function isArguments(e){return g(e)===\"[object Arguments]\"};var U=function isArguments(e){return e!==null&&typeof e===\"object\"&&typeof e.length===\"number\"&&e.length>=0&&g(e)!==\"[object Array]\"&&g(e.callee)===\"[object Function]\"};var J=$(arguments)?$:U;var K={primitive:function(e){return e===null||typeof e!==\"function\"&&typeof e!==\"object\"},object:function(e){return e!==null&&typeof e===\"object\"},string:function(e){return g(e)===\"[object String]\"},regex:function(e){return g(e)===\"[object RegExp]\"},symbol:function(e){return typeof S.Symbol===\"function\"&&typeof e===\"symbol\"}};var X=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);O.preserveToString(e[t],n)};var Z=typeof W===\"function\"&&typeof W[\"for\"]===\"function\"&&K.symbol(W());var Y=K.symbol(W.iterator)?W.iterator:\"_es6-shim iterator_\";if(S.Set&&typeof(new S.Set)[\"@@iterator\"]===\"function\"){Y=\"@@iterator\"}if(!S.Reflect){h(S,\"Reflect\",{},true)}var Q=S.Reflect;var ee=String;var te={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!te.IsCallable(t)){throw new TypeError(t+\" is not a function\")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(e==null){throw new TypeError(t||\"Cannot call method on \"+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e===\"function\"||typeof e===\"object\"},ToObject:function(e,t){return Object(te.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return te.IsCallable(e)},ToInt32:function(e){return te.ToNumber(e)>>0},ToUint32:function(e){return te.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)===\"[object Symbol]\"){throw new TypeError(\"Cannot convert a Symbol value to a number\")}return+e},ToInteger:function(e){var t=te.ToNumber(e);if(V(t)){return 0}if(t===0||!B(t)){return t}return(t>0?1:-1)*k(F(t))},ToLength:function(e){var t=te.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return V(e)&&V(t)},SameValueZero:function(e,t){return e===t||V(e)&&V(t)},IsIterable:function(e){return te.TypeIsObject(e)&&(typeof e[Y]!==\"undefined\"||J(e))},GetIterator:function(e){if(J(e)){return new q(e,\"value\")}var t=te.GetMethod(e,Y);if(!te.IsCallable(t)){throw new TypeError(\"value is not an iterable\")}var r=te.Call(t,e);if(!te.TypeIsObject(r)){throw new TypeError(\"bad iterator\")}return r},GetMethod:function(e,t){var r=te.ToObject(e)[t];if(r===void 0||r===null){return void 0}if(!te.IsCallable(r)){throw new TypeError(\"Method not callable: \"+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=te.GetMethod(e,\"return\");if(r===void 0){return}var n,o;try{n=te.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!te.TypeIsObject(n)){throw new TypeError(\"Iterator's return method returned a non-object.\")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!te.TypeIsObject(t)){throw new TypeError(\"bad iterator\")}return t},IteratorStep:function(e){var t=te.IteratorNext(e);var r=te.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r===\"undefined\"?e:r;if(!n&&Q.construct){return Q.construct(e,t,o)}var i=o.prototype;if(!te.TypeIsObject(i)){i=Object.prototype}var a=m(i);var u=te.Call(e,a,t);return te.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!te.TypeIsObject(r)){throw new TypeError(\"Bad constructor\")}var n=r[H];if(n===void 0||n===null){return t}if(!te.IsConstructor(n)){throw new TypeError(\"Bad @@species\")}return n},CreateHTML:function(e,t,r,n){var o=te.ToString(e);var i=\"<\"+t;if(r!==\"\"){var a=te.ToString(n);var u=a.replace(/\"/g,\"&quot;\");i+=\" \"+r+'=\"'+u+'\"'}var f=i+\">\";var s=f+o;return s+\"</\"+t+\">\"},IsRegExp:function IsRegExp(e){if(!te.TypeIsObject(e)){return false}var t=e[W.match];if(typeof t!==\"undefined\"){return!!t}return K.regex(e)},ToString:function ToString(e){return ee(e)}};if(s&&Z){var re=function defineWellKnownSymbol(e){if(K.symbol(W[e])){return W[e]}var t=W[\"for\"](\"Symbol.\"+e);Object.defineProperty(W,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!K.symbol(W.search)){var ne=re(\"search\");var oe=String.prototype.search;h(RegExp.prototype,ne,function search(e){return te.Call(oe,e,[this])});var ie=function search(e){var t=te.RequireObjectCoercible(this);if(e!==null&&typeof e!==\"undefined\"){var r=te.GetMethod(e,ne);if(typeof r!==\"undefined\"){return te.Call(r,e,[t])}}return te.Call(oe,t,[te.ToString(e)])};X(String.prototype,\"search\",ie)}if(!K.symbol(W.replace)){var ae=re(\"replace\");var ue=String.prototype.replace;h(RegExp.prototype,ae,function replace(e,t){return te.Call(ue,e,[this,t])});var fe=function replace(e,t){var r=te.RequireObjectCoercible(this);if(e!==null&&typeof e!==\"undefined\"){var n=te.GetMethod(e,ae);if(typeof n!==\"undefined\"){return te.Call(n,e,[r,t])}}return te.Call(ue,r,[te.ToString(e),t])};X(String.prototype,\"replace\",fe)}if(!K.symbol(W.split)){var se=re(\"split\");var ce=String.prototype.split;h(RegExp.prototype,se,function split(e,t){return te.Call(ce,e,[this,t])});var le=function split(e,t){var r=te.RequireObjectCoercible(this);if(e!==null&&typeof e!==\"undefined\"){var n=te.GetMethod(e,se);if(typeof n!==\"undefined\"){return te.Call(n,e,[r,t])}}return te.Call(ce,r,[te.ToString(e),t])};X(String.prototype,\"split\",le)}var pe=K.symbol(W.match);var ve=pe&&function(){var e={};e[W.match]=function(){return 42};return\"a\".match(e)!==42}();if(!pe||ve){var ye=re(\"match\");var he=String.prototype.match;h(RegExp.prototype,ye,function match(e){return te.Call(he,e,[this])});var be=function match(e){var t=te.RequireObjectCoercible(this);if(e!==null&&typeof e!==\"undefined\"){var r=te.GetMethod(e,ye);if(typeof r!==\"undefined\"){return te.Call(r,e,[t])}}return te.Call(he,t,[te.ToString(e)])};X(String.prototype,\"match\",be)}}var ge=function wrapConstructor(e,t,r){O.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in G||r[n]){return}O.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in G||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;O.redefine(e.prototype,\"constructor\",t)};var de=function(){return this};var Oe=function(e){if(s&&!z(e,H)){O.getter(e,H,de)}};var me=function(e,t){var r=t||function iterator(){return this};h(e,Y,r);if(!e[Y]&&K.symbol(Y)){e[Y]=r}};var we=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var je=function createDataPropertyOrThrow(e,t,r){we(e,t,r);if(!te.SameValue(e[t],r)){throw new TypeError(\"property is nonconfigurable\")}};var Se=function(e,t,r,n){if(!te.TypeIsObject(e)){throw new TypeError(\"Constructor requires `new`: \"+t.name)}var o=t.prototype;if(!te.TypeIsObject(o)){o=r}var i=m(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Te=String.fromCodePoint;X(String,\"fromCodePoint\",function fromCodePoint(e){return te.Call(Te,this,arguments)})}var Ie={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!te.SameValue(r,te.ToInteger(r))||r<0||r>1114111){throw new RangeError(\"Invalid code point \"+r)}if(r<65536){x(t,String.fromCharCode(r))}else{r-=65536;x(t,String.fromCharCode((r>>10)+55296));x(t,String.fromCharCode(r%1024+56320))}}return t.join(\"\")},raw:function raw(e){var t=te.ToObject(e,\"bad callSite\");var r=te.ToObject(t.raw,\"bad raw value\");var n=r.length;var o=te.ToLength(n);if(o<=0){return\"\"}var i=[];var a=0;var u,f,s,c;while(a<o){u=te.ToString(a);s=te.ToString(r[u]);x(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:\"\";c=te.ToString(f);x(i,c);a+=1}return i.join(\"\")}};if(String.raw&&String.raw({raw:{0:\"x\",1:\"y\",length:2}})!==\"xy\"){X(String,\"raw\",Ie.raw)}b(String,Ie);var Ee=function repeat(e,t){if(t<1){return\"\"}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Pe=Infinity;var Me={repeat:function repeat(e){var t=te.ToString(te.RequireObjectCoercible(this));var r=te.ToInteger(e);if(r<0||r>=Pe){throw new RangeError(\"repeat count must be less than infinity and not overflow maximum string size\")}return Ee(t,r)},startsWith:function startsWith(e){var t=te.ToString(te.RequireObjectCoercible(this));if(te.IsRegExp(e)){throw new TypeError('Cannot call method \"startsWith\" with a regex')}var r=te.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=R(te.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=te.ToString(te.RequireObjectCoercible(this));if(te.IsRegExp(e)){throw new TypeError('Cannot call method \"endsWith\" with a regex')}var r=te.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o===\"undefined\"?n:te.ToInteger(o);var a=_(R(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(te.IsRegExp(e)){throw new TypeError('\"includes\" does not accept a RegExp')}var t=te.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=te.ToString(te.RequireObjectCoercible(this));var r=te.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&\"a\".includes(\"a\",Infinity)!==false){X(String.prototype,\"includes\",Me.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var Ce=i(function(){\"/a/\".startsWith(/a/)});var xe=a(function(){return\"abc\".startsWith(\"a\",Infinity)===false});if(!Ce||!xe){X(String.prototype,\"startsWith\",Me.startsWith);X(String.prototype,\"endsWith\",Me.endsWith)}}if(Z){var Ne=a(function(){var e=/a/;e[W.match]=false;return\"/a/\".startsWith(e)});if(!Ne){X(String.prototype,\"startsWith\",Me.startsWith)}var Ae=a(function(){var e=/a/;e[W.match]=false;return\"/a/\".endsWith(e)});if(!Ae){X(String.prototype,\"endsWith\",Me.endsWith)}var Re=a(function(){var e=/a/;e[W.match]=false;return\"/a/\".includes(e)});if(!Re){X(String.prototype,\"includes\",Me.includes)}}b(String.prototype,Me);var _e=[\"\t\\n\\x0B\\f\\r \\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\",\"\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\",\"\\u2029\\ufeff\"].join(\"\");var ke=new RegExp(\"(^[\"+_e+\"]+)|([\"+_e+\"]+$)\",\"g\");var Fe=function trim(){return te.ToString(te.RequireObjectCoercible(this)).replace(ke,\"\")};var Le=[\"\\x85\",\"\\u200b\",\"\\ufffe\"].join(\"\");var De=new RegExp(\"[\"+Le+\"]\",\"g\");var ze=/^[\\-+]0x[0-9a-f]+$/i;var qe=Le.trim().length!==Le.length;h(String.prototype,\"trim\",Fe,qe);var Ge=function(e){te.RequireObjectCoercible(e);this._s=te.ToString(e);this._i=0};Ge.prototype.next=function(){var e=this._s,t=this._i;if(typeof e===\"undefined\"||t>=e.length){this._s=void 0;return{value:void 0,done:true}}var r=e.charCodeAt(t),n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return{value:e.substr(t,o),done:false}};me(Ge.prototype);me(String.prototype,function(){return new Ge(this)});var We={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n===\"undefined\"){o=false}else{if(!te.IsCallable(n)){throw new TypeError(\"Array.from: when provided, the second argument must be a function\")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(J(e)||te.GetMethod(e,Y))!==\"undefined\";var u,f,s;if(a){f=te.IsConstructor(r)?Object(new r):[];var c=te.GetIterator(e);var l,p;s=0;while(true){l=te.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i===\"undefined\"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){te.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=te.ToObject(e);u=te.ToLength(y.length);f=te.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i===\"undefined\"?n(h,s):t(n,i,h,s)}f[s]=h}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!te.IsCallable(t)?new Array(e):te.Construct(t,[e]);for(var o=0;o<e;++o){je(n,o,arguments[o])}n.length=e;return n}};b(Array,We);Oe(Array);var He=function(e){return{value:e,done:arguments.length===0}};q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i,t=this.array;if(!(this instanceof q)){throw new TypeError(\"Not an ArrayIterator\")}if(typeof t!==\"undefined\"){var r=te.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n===\"key\"){o=e}else if(n===\"value\"){o=t[e]}else if(n===\"entry\"){o=[e,t[e]]}this.i=e+1;return{value:o,done:false}}}this.array=void 0;return{value:void 0,done:true}}});me(q.prototype);var Ve=function orderKeys(e,t){var r=String(te.ToInteger(e))===e;var n=String(te.ToInteger(t))===t;if(r&&n){return t-e}else if(r&&!n){return-1}else if(!r&&n){return 1}else{return e.localeCompare(t)}};var Be=function getAllKeys(e){var t=[];var r=[];for(var n in e){x(z(e,n)?t:r,n)}M(t,Ve);M(r,Ve);return P(t,r)};var $e=Array.of===We.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!$e){X(Array,\"of\",We.of)}var Ue={copyWithin:function copyWithin(e,t){var r=te.ToObject(this);var n=te.ToLength(r.length);var o=te.ToInteger(e);var i=te.ToInteger(t);var a=o<0?R(n+o,0):_(o,n);var u=i<0?R(n+i,0):_(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f===\"undefined\"?n:te.ToInteger(f);var c=s<0?R(n+s,0):_(s,n);var l=_(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=te.ToObject(this);var o=te.ToLength(n.length);t=te.ToInteger(typeof t===\"undefined\"?0:t);r=te.ToInteger(typeof r===\"undefined\"?o:r);var i=t<0?R(o+t,0):_(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=te.ToObject(this);var n=te.ToLength(r.length);if(!te.IsCallable(e)){throw new TypeError(\"Array#find: predicate must be a function\")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=te.ToObject(this);var n=te.ToLength(r.length);if(!te.IsCallable(e)){throw new TypeError(\"Array#findIndex: predicate must be a function\")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,\"key\")},values:function values(){return new q(this,\"value\")},entries:function entries(){return new q(this,\"entry\")}};if(Array.prototype.keys&&!te.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!te.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[Y]){b(Array.prototype,{values:Array.prototype[Y]});if(K.symbol(W.unscopables)){Array.prototype[W.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!==\"values\"){var Je=Array.prototype.values;X(Array.prototype,\"values\",function values(){return te.Call(Je,this,arguments)});h(Array.prototype,Y,Array.prototype.values,true)}b(Array.prototype,Ue);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,\"indexOf\",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}me(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){me(Object.getPrototypeOf([].values()))}var Ke=function(){return a(function(){return Array.from({length:-1}).length===0})}();var Xe=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!Ke||!Xe){X(Array,\"from\",We.from)}var Ze=function(){return a(function(){return Array.from([0],void 0)})}();if(!Ze){var Ye=Array.from;X(Array,\"from\",function from(e){if(arguments.length>1&&typeof arguments[1]!==\"undefined\"){return te.Call(Ye,this,arguments)}else{return t(Ye,this,e)}})}var Qe=-(Math.pow(2,32)-1);var et=function(e,r){var n={length:Qe};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError(\"should not reach here\")},[]);return true})};if(!et(Array.prototype.forEach)){var tt=Array.prototype.forEach;X(Array.prototype,\"forEach\",function forEach(e){return te.Call(tt,this.length>=0?this:[],arguments)},true)}if(!et(Array.prototype.map)){var rt=Array.prototype.map;X(Array.prototype,\"map\",function map(e){return te.Call(rt,this.length>=0?this:[],arguments)},true)}if(!et(Array.prototype.filter)){var nt=Array.prototype.filter;X(Array.prototype,\"filter\",function filter(e){return te.Call(nt,this.length>=0?this:[],arguments)},true)}if(!et(Array.prototype.some)){var ot=Array.prototype.some;X(Array.prototype,\"some\",function some(e){return te.Call(ot,this.length>=0?this:[],arguments)},true)}if(!et(Array.prototype.every)){var it=Array.prototype.every;X(Array.prototype,\"every\",function every(e){return te.Call(it,this.length>=0?this:[],arguments)},true)}if(!et(Array.prototype.reduce)){var at=Array.prototype.reduce;X(Array.prototype,\"reduce\",function reduce(e){return te.Call(at,this.length>=0?this:[],arguments)},true)}if(!et(Array.prototype.reduceRight,true)){var ut=Array.prototype.reduceRight;X(Array.prototype,\"reduceRight\",function reduceRight(e){return te.Call(ut,this.length>=0?this:[],arguments)},true)}var ft=Number(\"0o10\")!==8;var st=Number(\"0b10\")!==2;var ct=y(Le,function(e){return Number(e+0+e)===0});if(ft||st||ct){var lt=Number;var pt=/^0b[01]+$/i;var vt=/^0o[0-7]+$/i;var yt=pt.test.bind(pt);var ht=vt.test.bind(vt);var bt=function(e){var t;if(typeof e.valueOf===\"function\"){t=e.valueOf();if(K.primitive(t)){return t}}if(typeof e.toString===\"function\"){t=e.toString();if(K.primitive(t)){return t}}throw new TypeError(\"No default value\")};var gt=De.test.bind(De);var dt=ze.test.bind(ze);var Ot=function(){var e=function Number(t){var r;if(arguments.length>0){r=K.primitive(t)?t:bt(t,\"number\")}else{r=0}if(typeof r===\"string\"){r=te.Call(Fe,r);if(yt(r)){r=parseInt(C(r,2),2)}else if(ht(r)){r=parseInt(C(r,2),8)}else if(gt(r)||dt(r)){r=NaN}}var n=this;var o=a(function(){lt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new lt(r)}return lt(r)};return e}();ge(lt,Ot,{});b(Ot,{NaN:lt.NaN,MAX_VALUE:lt.MAX_VALUE,MIN_VALUE:lt.MIN_VALUE,NEGATIVE_INFINITY:lt.NEGATIVE_INFINITY,POSITIVE_INFINITY:lt.POSITIVE_INFINITY});Number=Ot;O.redefine(S,\"Number\",Ot)}var mt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:mt,MIN_SAFE_INTEGER:-mt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:B,isInteger:function isInteger(e){return B(e)&&te.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&F(e)<=Number.MAX_SAFE_INTEGER},isNaN:V});h(Number,\"parseInt\",S.parseInt,Number.parseInt!==S.parseInt);if(![,1].find(function(e,t){return t===0})){X(Array.prototype,\"find\",Ue.find)}if([,1].findIndex(function(e,t){return t===0})!==0){X(Array.prototype,\"findIndex\",Ue.findIndex)}var wt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var jt=function ensureEnumerable(e,t){if(s&&wt(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var St=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Tt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var It=function(e,t){var r=n(Object(t));var o;if(te.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),wt(t))}return p(P(r,o||[]),Tt(t),e)};var Et={assign:function(e,t){var r=te.ToObject(e,\"Cannot convert undefined or null to object\");return p(te.Call(St,1,arguments),It,r)},is:function is(e,t){return te.SameValue(e,t)}};var Pt=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,\"xy\")}catch(t){return e[1]===\"y\"}}();if(Pt){X(Object,\"assign\",Et.assign)}b(Object,Et);if(s){var Mt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!te.TypeIsObject(e)){throw new TypeError(\"cannot set prototype on a non-object\")}if(!(t===null||te.TypeIsObject(t))){throw new TypeError(\"can only set prototype to an object or null\"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,\"__proto__\")};b(Object,Mt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf,r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Ct=!i(function(){Object.keys(\"foo\")});if(!Ct){var xt=Object.keys;X(Object,\"keys\",function keys(e){return xt(te.ToObject(e))});n=Object.keys}var Nt=i(function(){Object.keys(/a/g)});if(Nt){var At=Object.keys;X(Object,\"keys\",function keys(e){if(K.regex(e)){var t=[];for(var r in e){if(z(e,r)){x(t,r)}}return t}return At(e)});n=Object.keys}if(Object.getOwnPropertyNames){var Rt=!i(function(){Object.getOwnPropertyNames(\"foo\")});if(!Rt){var _t=typeof window===\"object\"?Object.getOwnPropertyNames(window):[];var kt=Object.getOwnPropertyNames;X(Object,\"getOwnPropertyNames\",function getOwnPropertyNames(e){var t=te.ToObject(e);if(g(t)===\"[object Window]\"){try{return kt(t)}catch(r){return P([],_t)}}return kt(t)})}}if(Object.getOwnPropertyDescriptor){var Ft=!i(function(){Object.getOwnPropertyDescriptor(\"foo\",\"bar\")});if(!Ft){var Lt=Object.getOwnPropertyDescriptor;X(Object,\"getOwnPropertyDescriptor\",function getOwnPropertyDescriptor(e,t){return Lt(te.ToObject(e),t)})}}if(Object.seal){var Dt=!i(function(){Object.seal(\"foo\")});if(!Dt){var zt=Object.seal;X(Object,\"seal\",function seal(e){if(!K.object(e)){return e}return zt(e)})}}if(Object.isSealed){var qt=!i(function(){Object.isSealed(\"foo\")});if(!qt){var Gt=Object.isSealed;X(Object,\"isSealed\",function isSealed(e){if(!K.object(e)){return true}return Gt(e)})}}if(Object.freeze){var Wt=!i(function(){Object.freeze(\"foo\")});if(!Wt){var Ht=Object.freeze;X(Object,\"freeze\",function freeze(e){if(!K.object(e)){return e}return Ht(e)})}}if(Object.isFrozen){var Vt=!i(function(){Object.isFrozen(\"foo\")});if(!Vt){var Bt=Object.isFrozen;X(Object,\"isFrozen\",function isFrozen(e){if(!K.object(e)){return true}return Bt(e)})}}if(Object.preventExtensions){var $t=!i(function(){Object.preventExtensions(\"foo\")});if(!$t){var Ut=Object.preventExtensions;X(Object,\"preventExtensions\",function preventExtensions(e){if(!K.object(e)){return e}return Ut(e)})}}if(Object.isExtensible){var Jt=!i(function(){Object.isExtensible(\"foo\")});if(!Jt){var Kt=Object.isExtensible;X(Object,\"isExtensible\",function isExtensible(e){if(!K.object(e)){return false}return Kt(e)})}}if(Object.getPrototypeOf){var Xt=!i(function(){Object.getPrototypeOf(\"foo\")});if(!Xt){var Zt=Object.getPrototypeOf;X(Object,\"getPrototypeOf\",function getPrototypeOf(e){return Zt(te.ToObject(e))})}}var Yt=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,\"flags\");return e&&te.IsCallable(e.get)}();if(s&&!Yt){var Qt=function flags(){if(!te.TypeIsObject(this)){throw new TypeError(\"Method called on incompatible type: must be an object.\")}var e=\"\";if(this.global){e+=\"g\"}if(this.ignoreCase){e+=\"i\"}if(this.multiline){e+=\"m\"}if(this.unicode){e+=\"u\"}if(this.sticky){e+=\"y\"}return e};O.getter(RegExp.prototype,\"flags\",Qt)}var er=s&&a(function(){return String(new RegExp(/a/g,\"i\"))===\"/a/i\"});var tr=Z&&s&&function(){var e=/./;e[W.match]=false;return RegExp(e)===e}();var rr=a(function(){return RegExp.prototype.toString.call({source:\"abc\"})===\"/abc/\"});var nr=rr&&a(function(){return RegExp.prototype.toString.call({source:\"a\",flags:\"b\"})===\"/a/b\"});if(!rr||!nr){var or=RegExp.prototype.toString;h(RegExp.prototype,\"toString\",function toString(){var e=te.RequireObjectCoercible(this);if(K.regex(e)){return t(or,e)}var r=ee(e.source);var n=ee(e.flags);return\"/\"+r+\"/\"+n},true);O.preserveToString(RegExp.prototype.toString,or)}if(s&&(!er||tr)){var ir=Object.getOwnPropertyDescriptor(RegExp.prototype,\"flags\").get;var ar=Object.getOwnPropertyDescriptor(RegExp.prototype,\"source\")||{};var ur=function(){return this.source};var fr=te.IsCallable(ar.get)?ar.get:ur;var sr=RegExp;var cr=function(){return function RegExp(e,t){var r=te.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t===\"undefined\"&&e.constructor===RegExp){return e}var o=e;var i=t;if(K.regex(e)){o=te.Call(fr,e);i=typeof t===\"undefined\"?te.Call(ir,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t===\"undefined\"?e.flags:t}return new sr(e,t)}}();ge(sr,cr,{$input:true});RegExp=cr;O.redefine(S,\"RegExp\",cr)}if(s){var lr={input:\"$_\",lastMatch:\"$&\",lastParen:\"$+\",leftContext:\"$`\",rightContext:\"$'\"};l(n(lr),function(e){if(e in RegExp&&!(lr[e]in RegExp)){O.getter(RegExp,lr[e],function get(){return RegExp[e]})}})}Oe(RegExp);var pr=1/Number.EPSILON;var vr=function roundTiesToEven(e){return e+pr-pr};var yr=Math.pow(2,-23);var hr=Math.pow(2,127)*(2-yr);var br=Math.pow(2,-126);var gr=Number.prototype.clz;delete Number.prototype.clz;var dr={acosh:function acosh(e){var t=Number(e);if(Number.isNaN(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}return L(t/Math.E+D(t+1)*D(t-1)/Math.E)+1},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}return t<0?-Math.asinh(-t):L(t+D(t*t+1))},atanh:function atanh(e){var t=Number(e);if(Number.isNaN(t)||t<-1||t>1){return NaN}if(t===-1){return-Infinity}if(t===1){return Infinity}if(t===0){return t}return.5*L((1+t)/(1-t))},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0,n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=Math.exp(L(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=te.ToUint32(t);if(r===0){return 32}return gr?te.Call(gr,r):31-k(L(r+.5)*Math.LOG2E)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(Number.isNaN(t)){return NaN}if(!T(t)){return Infinity}if(t<0){t=-t}if(t>21){return Math.exp(t)/2}return(Math.exp(t)+Math.exp(-t))/2},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(F(t)>.5){return Math.exp(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=F(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return L(e)*Math.LOG2E},log10:function log10(e){return L(e)*Math.LOG10E},log1p:function log1p(e){var t=Number(e);if(t<-1||Number.isNaN(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(L(1+t)/(1+t-1))},sign:function sign(e){var t=Number(e);if(t===0){return t}if(Number.isNaN(t)){return t}return t<0?-1:1},sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}if(F(t)<1){return(Math.expm1(t)-Math.expm1(-t))/2}return(Math.exp(t-1)-Math.exp(-t-1))*Math.E/2},tanh:function tanh(e){var t=Number(e);if(Number.isNaN(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}var r=Math.expm1(t);var n=Math.expm1(-t);if(r===Infinity){return 1}if(n===Infinity){return-1}return(r-n)/(Math.exp(t)+Math.exp(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-k(-t):k(t)},imul:function imul(e,t){var r=te.ToUint32(e);var n=te.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||V(t)){return t}var r=Math.sign(t);var n=F(t);if(n<br){return r*vr(n/br/yr)*br*yr}var o=(1+yr/Number.EPSILON)*n;var i=o-(o-n);if(i>hr||V(i)){return r*Infinity}return r*i}};b(Math,dr);h(Math,\"log1p\",dr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,\"asinh\",dr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,\"tanh\",dr.tanh,Math.tanh(-2e-17)!==-2e-17);h(Math,\"acosh\",dr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,\"cbrt\",dr.cbrt,Math.abs(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON>8);h(Math,\"sinh\",dr.sinh,Math.sinh(-2e-17)!==-2e-17);var Or=Math.expm1(10);h(Math,\"expm1\",dr.expm1,Or>22025.465794806718||Or<22025.465794806718);\nvar mr=Math.round;var wr=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var jr=pr+1;var Sr=2*pr-1;var Tr=[jr,Sr].every(function(e){return Math.round(e)===e});h(Math,\"round\",function round(e){var t=k(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!wr||!Tr);O.preserveToString(Math.round,mr);var Ir=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=dr.imul;O.preserveToString(Math.imul,Ir)}if(Math.imul.length!==2){X(Math,\"imul\",function imul(e,t){return te.Call(Ir,Math,arguments)})}var Er=function(){var e=S.setTimeout;if(typeof e!==\"function\"&&typeof e!==\"object\"){return}te.IsPromise=function(e){if(!te.TypeIsObject(e)){return false}if(typeof e._promise===\"undefined\"){return false}return true};var r=function(e){if(!te.IsConstructor(e)){throw new TypeError(\"Bad promise constructor\")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError(\"Bad Promise implementation!\")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(te.IsCallable(t.resolve)&&te.IsCallable(t.reject))){throw new TypeError(\"Bad promise constructor\")}};var n;if(typeof window!==\"undefined\"&&te.IsCallable(window.postMessage)){n=function(){var e=[];var t=\"zero-timeout-message\";var r=function(r){x(e,r);window.postMessage(t,\"*\")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=A(e);n()}};window.addEventListener(\"message\",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=te.IsCallable(S.setImmediate)?S.setImmediate:typeof process===\"object\"&&process.nextTick?process.nextTick:o()||(te.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var O=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var m=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return O(e,new TypeError(\"Self resolution\"))}if(!te.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return O(e,o)}if(!te.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return O(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=m(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires \"new\"')}if(this&&this._promise){throw new TypeError(\"Bad construction\")}if(!te.IsCallable(t)){throw new TypeError(\"not a valid resolver\")}var r=Se(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=m(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var M=function(e,t,r){var n=e.iterator;var o=[],i={count:1},a,u;var f=0;while(true){try{a=te.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var C=function(e,t,r){var n=e.iterator,o,i,a;while(true){try{o=te.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!te.TypeIsObject(t)){throw new TypeError(\"Promise is not object\")}var n=new r(t);var o,i;try{o=te.GetIterator(e);i={iterator:o,done:false};return M(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{te.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!te.TypeIsObject(t)){throw new TypeError(\"Promise is not object\")}var n=new r(t);var o,i;try{o=te.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{te.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!te.TypeIsObject(t)){throw new TypeError(\"Bad promise constructor\")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!te.TypeIsObject(t)){throw new TypeError(\"Bad promise constructor\")}if(te.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{\"catch\":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!te.IsPromise(n)){throw new TypeError(\"not a promise\")}var o=te.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=te.IsCallable(e)?e:a;var d=te.IsCallable(t)?t:u;var O=n._promise;var m;if(O.state===f){if(O.reactionLength===0){O.fulfillReactionHandler0=g;O.rejectReactionHandler0=d;O.reactionCapability0=i}else{var w=3*(O.reactionLength-1);O[w+l]=g;O[w+p]=d;O[w+v]=i}O.reactionLength+=1}else if(O.state===s){m=O.result;h(g,i,m)}else if(O.state===c){m=O.result;h(d,i,m)}else{throw new TypeError(\"unexpected Promise state\")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Er===\"function\"){b(S,{Promise:Er});var Pr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var Mr=!i(function(){S.Promise.reject(42).then(null,5).then(null,G)});var Cr=i(function(){S.Promise.call(3,G)});var xr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,G).then(null,G)}catch(n){return true}return t===r}(S.Promise);var Nr=s&&function(){var e=0;var t=Object.defineProperty({},\"then\",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Ar=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Ar.prototype=Promise.prototype;Ar.all=Promise.all;var Rr=a(function(){return!!Ar.all([1,2])});if(!Pr||!Mr||!Cr||xr||!Nr||Rr){Promise=Er;X(S,\"Promise\",Er)}if(Promise.all.length!==1){var _r=Promise.all;X(Promise,\"all\",function all(e){return te.Call(_r,this,arguments)})}if(Promise.race.length!==1){var kr=Promise.race;X(Promise,\"race\",function race(e){return te.Call(kr,this,arguments)})}if(Promise.resolve.length!==1){var Fr=Promise.resolve;X(Promise,\"resolve\",function resolve(e){return te.Call(Fr,this,arguments)})}if(Promise.reject.length!==1){var Lr=Promise.reject;X(Promise,\"reject\",function reject(e){return te.Call(Lr,this,arguments)})}jt(Promise,\"all\");jt(Promise,\"race\");jt(Promise,\"resolve\");jt(Promise,\"reject\");Oe(Promise)}var Dr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(\":\")===t.join(\":\")};var zr=Dr([\"z\",\"a\",\"bb\"]);var qr=Dr([\"z\",1,\"a\",\"3\",2]);if(s){var Gr=function fastkey(e){if(!zr){return null}if(typeof e===\"undefined\"||e===null){return\"^\"+te.ToString(e)}else if(typeof e===\"string\"){return\"$\"+e}else if(typeof e===\"number\"){if(!qr){return\"n\"+e}return e}else if(typeof e===\"boolean\"){return\"b\"+e}return null};var Wr=function emptyObject(){return Object.create?Object.create(null):{}};var Hr=function addIterableToMap(e,n,o){if(r(o)||K.string(o)){l(o,function(e){if(!te.TypeIsObject(e)){throw new TypeError(\"Iterator value \"+e+\" is not an entry object\")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(o!==null&&typeof o!==\"undefined\"){a=n.set;if(!te.IsCallable(a)){throw new TypeError(\"bad map\")}i=te.GetIterator(o)}if(typeof i!==\"undefined\"){while(true){var u=te.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!te.TypeIsObject(f)){throw new TypeError(\"Iterator value \"+f+\" is not an entry object\")}t(a,n,f[0],f[1])}catch(s){te.IteratorClose(i,true);throw s}}}}};var Vr=function addIterableToSet(e,n,o){if(r(o)||K.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(o!==null&&typeof o!==\"undefined\"){a=n.add;if(!te.IsCallable(a)){throw new TypeError(\"bad set\")}i=te.GetIterator(o)}if(typeof i!==\"undefined\"){while(true){var u=te.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){te.IteratorClose(i,true);throw s}}}}};var Br={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!te.TypeIsObject(e)||!n(e)){throw new TypeError(\"Method Map.prototype.\"+t+\" called on incompatible receiver \"+te.ToString(e))}};var i=function MapIterator(e,t){o(e,\"[[MapIterator]]\");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={next:function next(){var e=this.i,t=this.kind,r=this.head,n;if(typeof this.i===\"undefined\"){return{value:void 0,done:true}}while(e.isRemoved()&&e!==r){e=e.prev}while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t===\"key\"){n=e.key}else if(t===\"value\"){n=e.value}else{n=[e.key,e.value]}this.i=e;return{value:n,done:false}}}this.i=void 0;return{value:void 0,done:true}}};me(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires \"new\"')}if(this&&this._es6map){throw new TypeError(\"Bad construction\")}var e=Se(this,Map,a,{_es6map:true,_head:null,_storage:Wr(),_size:0});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){Hr(Map,e,arguments[0])}return e};a=u.prototype;O.getter(a,\"size\",function(){if(typeof this._size===\"undefined\"){throw new TypeError(\"size method called on incompatible Map\")}return this._size});b(a,{get:function get(e){o(this,\"get\");var t=Gr(e);if(t!==null){var r=this._storage[t];if(r){return r.value}else{return}}var n=this._head,i=n;while((i=i.next)!==n){if(te.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,\"has\");var t=Gr(e);if(t!==null){return typeof this._storage[t]!==\"undefined\"}var r=this._head,n=r;while((n=n.next)!==r){if(te.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,\"set\");var n=this._head,i=n,a;var u=Gr(e);if(u!==null){if(typeof this._storage[u]!==\"undefined\"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}while((i=i.next)!==n){if(te.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(te.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},\"delete\":function(t){o(this,\"delete\");var r=this._head,n=r;var i=Gr(t);if(i!==null){if(typeof this._storage[i]===\"undefined\"){return false}n=this._storage[i].prev;delete this._storage[i]}while((n=n.next)!==r){if(te.SameValueZero(n.key,t)){n.key=n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,\"clear\");this._size=0;this._storage=Wr();var t=this._head,r=t,n=r.next;while((r=n)!==t){r.key=r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,\"keys\");return new i(this,\"key\")},values:function values(){o(this,\"values\");return new i(this,\"value\")},entries:function entries(){o(this,\"entries\");return new i(this,\"key+value\")},forEach:function forEach(e){o(this,\"forEach\");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});me(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!==\"undefined\"};var r=function requireSetSlot(t,r){if(!te.TypeIsObject(t)||!e(t)){throw new TypeError(\"Set.prototype.\"+r+\" called on incompatible receiver \"+te.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires \"new\"')}if(this&&this._es6set){throw new TypeError(\"Bad construction\")}var e=Se(this,Set,o,{_es6set:true,\"[[SetData]]\":null,_storage:Wr()});if(!e._es6set){throw new TypeError(\"bad set\")}if(arguments.length>0){Vr(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t===\"^null\"){return null}else if(t===\"^undefined\"){return void 0}else{var r=t.charAt(0);if(r===\"$\"){return C(t,1)}else if(r===\"n\"){return+C(t,1)}else if(r===\"b\"){return t===\"btrue\"}}return+t};var u=function ensureMap(e){if(!e[\"[[SetData]]\"]){var t=e[\"[[SetData]]\"]=new Br.Map;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e[\"[[SetData]]\"]=t}e._storage=null};O.getter(i.prototype,\"size\",function(){r(this,\"size\");if(this._storage){return n(this._storage).length}u(this);return this[\"[[SetData]]\"].size});b(i.prototype,{has:function has(e){r(this,\"has\");var t;if(this._storage&&(t=Gr(e))!==null){return!!this._storage[t]}u(this);return this[\"[[SetData]]\"].has(e)},add:function add(e){r(this,\"add\");var t;if(this._storage&&(t=Gr(e))!==null){this._storage[t]=true;return this}u(this);this[\"[[SetData]]\"].set(e,e);return this},\"delete\":function(e){r(this,\"delete\");var t;if(this._storage&&(t=Gr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this[\"[[SetData]]\"][\"delete\"](e)},clear:function clear(){r(this,\"clear\");if(this._storage){this._storage=Wr()}if(this[\"[[SetData]]\"]){this[\"[[SetData]]\"].clear()}},values:function values(){r(this,\"values\");u(this);return this[\"[[SetData]]\"].values()},entries:function entries(){r(this,\"entries\");u(this);return this[\"[[SetData]]\"].entries()},forEach:function forEach(e){r(this,\"forEach\");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this[\"[[SetData]]\"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,\"keys\",i.prototype.values,true);me(i.prototype,i.prototype.values);return i}()};if(S.Map||S.Set){var $r=a(function(){return new Map([[1,2]]).get(1)===2});if(!$r){var Ur=S.Map;S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires \"new\"')}var e=new Ur;if(arguments.length>0){Hr(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=m(Ur.prototype);h(S.Map.prototype,\"constructor\",S.Map,true);O.preserveToString(S.Map,Ur)}var Jr=new Map;var Kr=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var Xr=Jr.set(1,2)===Jr;if(!Kr||!Xr){var Zr=Map.prototype.set;X(Map.prototype,\"set\",function set(e,r){t(Zr,this,e===0?0:e,r);return this})}if(!Kr){var Yr=Map.prototype.get;var Qr=Map.prototype.has;b(Map.prototype,{get:function get(e){return t(Yr,this,e===0?0:e)},has:function has(e){return t(Qr,this,e===0?0:e)}},true);O.preserveToString(Map.prototype.get,Yr);O.preserveToString(Map.prototype.has,Qr)}var en=new Set;var tn=function(e){e[\"delete\"](0);e.add(-0);return!e.has(0)}(en);var rn=en.add(1)===en;if(!tn||!rn){var nn=Set.prototype.add;Set.prototype.add=function add(e){t(nn,this,e===0?0:e);return this};O.preserveToString(Set.prototype.add,nn)}if(!tn){var on=Set.prototype.has;Set.prototype.has=function has(e){return t(on,this,e===0?0:e)};O.preserveToString(Set.prototype.has,on);var an=Set.prototype[\"delete\"];Set.prototype[\"delete\"]=function SetDelete(e){return t(an,this,e===0?0:e)};O.preserveToString(Set.prototype[\"delete\"],an)}var un=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var fn=Object.setPrototypeOf&&!un;var sn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||fn||!sn){var cn=S.Map;S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires \"new\"')}var e=new cn;if(arguments.length>0){Hr(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=cn.prototype;h(S.Map.prototype,\"constructor\",S.Map,true);O.preserveToString(S.Map,cn)}var ln=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var pn=Object.setPrototypeOf&&!ln;var vn=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||pn||!vn){var yn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires \"new\"')}var e=new yn;if(arguments.length>0){Vr(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=yn.prototype;h(S.Set.prototype,\"constructor\",S.Set,true);O.preserveToString(S.Set,yn)}var hn=!a(function(){return(new Map).keys().next().done});if(typeof S.Map.prototype.clear!==\"function\"||(new S.Set).size!==0||(new S.Map).size!==0||typeof S.Map.prototype.keys!==\"function\"||typeof S.Set.prototype.keys!==\"function\"||typeof S.Map.prototype.forEach!==\"function\"||typeof S.Set.prototype.forEach!==\"function\"||u(S.Map)||u(S.Set)||typeof(new S.Map).keys().next!==\"function\"||hn||!un){b(S,{Map:Br.Map,Set:Br.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,\"keys\",S.Set.prototype.values,true)}me(Object.getPrototypeOf((new S.Map).keys()));me(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!==\"has\"){var bn=S.Set.prototype.has;X(S.Set.prototype,\"has\",function has(e){return t(bn,this,e)})}}b(S,Br);Oe(S.Map);Oe(S.Set)}var gn=function throwUnlessTargetIsObject(e){if(!te.TypeIsObject(e)){throw new TypeError(\"target must be an object\")}};var dn={apply:function apply(){return te.Call(te.Call,null,arguments)},construct:function construct(e,t){if(!te.IsConstructor(e)){throw new TypeError(\"First argument must be a constructor.\")}var r=arguments.length>2?arguments[2]:e;if(!te.IsConstructor(r)){throw new TypeError(\"new.target must be a constructor.\")}return te.Construct(e,t,r,\"internal\")},deleteProperty:function deleteProperty(e,t){gn(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){gn(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(dn,{ownKeys:function ownKeys(e){gn(e);var t=Object.getOwnPropertyNames(e);if(te.IsCallable(Object.getOwnPropertySymbols)){N(t,Object.getOwnPropertySymbols(e))}return t}})}var On=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(dn,{isExtensible:function isExtensible(e){gn(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){gn(e);return On(function(){Object.preventExtensions(e)})}})}if(s){var mn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return mn(o,t,r)}if(\"value\"in n){return n.value}if(n.get){return te.Call(n.get,r)}return void 0};var wn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return wn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if(\"value\"in i){if(!i.writable){return false}if(!te.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return Q.defineProperty(o,r,{value:n})}else{return Q.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(dn,{defineProperty:function defineProperty(e,t,r){gn(e);return On(function(){Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){gn(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){gn(e);var r=arguments.length>2?arguments[2]:e;return mn(e,t,r)},set:function set(e,t,r){gn(e);var n=arguments.length>3?arguments[3]:e;return wn(e,t,r,n)}})}if(Object.getPrototypeOf){var jn=Object.getPrototypeOf;dn.getPrototypeOf=function getPrototypeOf(e){gn(e);return jn(e)}}if(Object.setPrototypeOf&&dn.getPrototypeOf){var Sn=function(e,t){var r=t;while(r){if(e===r){return true}r=dn.getPrototypeOf(r)}return false};Object.assign(dn,{setPrototypeOf:function setPrototypeOf(e,t){gn(e);if(t!==null&&!te.TypeIsObject(t)){throw new TypeError(\"proto must be an object or null\")}if(t===Q.getPrototypeOf(e)){return true}if(Q.isExtensible&&!Q.isExtensible(e)){return false}if(Sn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var Tn=function(e,t){if(!te.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){X(S.Reflect,e,t)}}};Object.keys(dn).forEach(function(e){Tn(e,dn[e])});var In=S.Reflect.getPrototypeOf;if(c&&In&&In.name!==\"getPrototypeOf\"){X(S.Reflect,\"getPrototypeOf\",function getPrototypeOf(e){return t(In,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){X(S.Reflect,\"setPrototypeOf\",dn.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,\"test\",{value:1});var t=typeof Object.preventExtensions!==\"function\"||!S.Reflect.defineProperty(Object.preventExtensions({}),\"test\",{});return e&&t})){X(S.Reflect,\"defineProperty\",dn.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){X(S.Reflect,\"construct\",dn.construct)}}if(String(new Date(NaN))!==\"Invalid Date\"){var En=Date.prototype.toString;var Pn=function toString(){var e=+this;if(e!==e){return\"Invalid Date\"}return te.Call(En,this)};X(Date.prototype,\"toString\",Pn)}var Mn={anchor:function anchor(e){return te.CreateHTML(this,\"a\",\"name\",e)},big:function big(){return te.CreateHTML(this,\"big\",\"\",\"\")},blink:function blink(){return te.CreateHTML(this,\"blink\",\"\",\"\")},bold:function bold(){return te.CreateHTML(this,\"b\",\"\",\"\")},fixed:function fixed(){return te.CreateHTML(this,\"tt\",\"\",\"\")},fontcolor:function fontcolor(e){return te.CreateHTML(this,\"font\",\"color\",e)},fontsize:function fontsize(e){return te.CreateHTML(this,\"font\",\"size\",e)},italics:function italics(){return te.CreateHTML(this,\"i\",\"\",\"\")},link:function link(e){return te.CreateHTML(this,\"a\",\"href\",e)},small:function small(){return te.CreateHTML(this,\"small\",\"\",\"\")},strike:function strike(){return te.CreateHTML(this,\"strike\",\"\",\"\")},sub:function sub(){return te.CreateHTML(this,\"sub\",\"\",\"\")},sup:function sub(){return te.CreateHTML(this,\"sup\",\"\",\"\")}};l(Object.keys(Mn),function(e){var r=String.prototype[e];var n=false;if(te.IsCallable(r)){var o=t(r,\"\",' \" ');var i=P([],o.match(/\"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){X(String.prototype,e,Mn[e])}});var Cn=function(){if(!Z){return false}var e=typeof JSON===\"object\"&&typeof JSON.stringify===\"function\"?JSON.stringify:null;if(!e){return false}if(typeof e(W())!==\"undefined\"){return true}if(e([W()])!==\"[null]\"){return true}var t={a:W()};t[W()]=true;if(e(t)!==\"{}\"){return true}return false}();var xn=a(function(){if(!Z){return true}return JSON.stringify(Object(W()))===\"{}\"&&JSON.stringify([Object(W())])===\"[{}]\"});if(Cn||!xn){var Nn=JSON.stringify;X(JSON,\"stringify\",function stringify(e){if(typeof e===\"symbol\"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=te.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!==\"symbol\"){if(K.symbol(n)){return Tt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return Nn.apply(this,o)})}return S});\n/*! jQuery v2.2.1 | (c) jQuery Foundation | jquery.org/license */\n!function(a,b){\"object\"==typeof module&&\"object\"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error(\"jQuery requires a window with a document\");return b(a)}:b(a)}(\"undefined\"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m=\"2.2.1\",n=function(a,b){return new n.fn.init(a,b)},o=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,p=/^-ms-/,q=/-([\\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:\"\",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for(\"boolean\"==typeof g&&(j=g,g=arguments[h]||{},h++),\"object\"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:\"jQuery\"+(m+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return\"function\"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isPlainObject:function(a){return\"object\"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!k.call(a.constructor.prototype,\"isPrototypeOf\")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+\"\":\"object\"==typeof a||\"function\"==typeof a?i[j.call(a)]||\"object\":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf(\"use strict\")?(b=d.createElement(\"script\"),b.text=a,d.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,\"ms-\").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?\"\":(a+\"\").replace(o,\"\")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,\"string\"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:h.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return\"string\"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(d=e.call(arguments,2),f=function(){return a.apply(b||this,d.concat(e.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:l}),\"function\"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),function(a,b){i[\"[object \"+b+\"]\"]=b.toLowerCase()});function s(a){var b=!!a&&\"length\"in a&&a.length,c=n.type(a);return\"function\"===c||n.isWindow(a)?!1:\"array\"===c||0===b||\"number\"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=\"sizzle\"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",L=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",M=\"(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+\",N=\"\\\\[\"+L+\"*(\"+M+\")(?:\"+L+\"*([*^$|!~]?=)\"+L+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+M+\"))|)\"+L+\"*\\\\]\",O=\":(\"+M+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+N+\")*)|.*)\\\\)|)\",P=new RegExp(L+\"+\",\"g\"),Q=new RegExp(\"^\"+L+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+L+\"+$\",\"g\"),R=new RegExp(\"^\"+L+\"*,\"+L+\"*\"),S=new RegExp(\"^\"+L+\"*([>+~]|\"+L+\")\"+L+\"*\"),T=new RegExp(\"=\"+L+\"*([^\\\\]'\\\"]*?)\"+L+\"*\\\\]\",\"g\"),U=new RegExp(O),V=new RegExp(\"^\"+M+\"$\"),W={ID:new RegExp(\"^#(\"+M+\")\"),CLASS:new RegExp(\"^\\\\.(\"+M+\")\"),TAG:new RegExp(\"^(\"+M+\"|[*])\"),ATTR:new RegExp(\"^\"+N),PSEUDO:new RegExp(\"^\"+O),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+L+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+L+\"*(?:([+-]|)\"+L+\"*(\\\\d+)|))\"+L+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+K+\")$\",\"i\"),needsContext:new RegExp(\"^\"+L+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+L+\"*((?:-\\\\d)?\\\\d*)\"+L+\"*\\\\)|)(?=[^-]|$)\",\"i\")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\\d$/i,Z=/^[^{]+\\{\\s*\\[native \\w/,$=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,_=/[+~]/,aa=/'|\\\\/g,ba=new RegExp(\"\\\\\\\\([\\\\da-f]{1,6}\"+L+\"?|(\"+L+\")|.)\",\"ig\"),ca=function(a,b,c){var d=\"0x\"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],\"string\"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+\" \"]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if(\"object\"!==b.nodeName.toLowerCase()){(k=b.getAttribute(\"id\"))?k=k.replace(aa,\"\\\\$&\"):b.setAttribute(\"id\",k=u),r=g(a),h=r.length,l=V.test(k)?\"#\"+k:\"[id='\"+k+\"']\";while(h--)r[h]=l+\" \"+qa(r[h]);s=r.join(\",\"),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute(\"id\")}}}return i(a.replace(Q,\"$1\"),b,d,e)}function ga(){var a=[];function b(c,e){return a.push(c+\" \")>d.cacheLength&&delete b[a.shift()],b[c+\" \"]=e}return b}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement(\"div\");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){var c=a.split(\"|\"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function la(a){return function(b){var c=b.nodeName.toLowerCase();return\"input\"===c&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return(\"input\"===c||\"button\"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&\"undefined\"!=typeof a.getElementsByTagName&&a}c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?\"HTML\"!==b.nodeName:!1},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener(\"unload\",da,!1):e.attachEvent&&e.attachEvent(\"onunload\",da)),c.attributes=ia(function(a){return a.className=\"i\",!a.getAttribute(\"className\")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment(\"\")),!a.getElementsByTagName(\"*\").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(\"undefined\"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute(\"id\")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c=\"undefined\"!=typeof a.getAttributeNode&&a.getAttributeNode(\"id\");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return\"undefined\"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if(\"*\"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return\"undefined\"!=typeof b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML=\"<a id='\"+u+\"'></a><select id='\"+u+\"-\\r\\\\' msallowcapture=''><option selected=''></option></select>\",a.querySelectorAll(\"[msallowcapture^='']\").length&&q.push(\"[*^$]=\"+L+\"*(?:''|\\\"\\\")\"),a.querySelectorAll(\"[selected]\").length||q.push(\"\\\\[\"+L+\"*(?:value|\"+K+\")\"),a.querySelectorAll(\"[id~=\"+u+\"-]\").length||q.push(\"~=\"),a.querySelectorAll(\":checked\").length||q.push(\":checked\"),a.querySelectorAll(\"a#\"+u+\"+*\").length||q.push(\".#.+[+~]\")}),ia(function(a){var b=n.createElement(\"input\");b.setAttribute(\"type\",\"hidden\"),a.appendChild(b).setAttribute(\"name\",\"D\"),a.querySelectorAll(\"[name=d]\").length&&q.push(\"name\"+L+\"*[*^$|!~]?=\"),a.querySelectorAll(\":enabled\").length||q.push(\":enabled\",\":disabled\"),a.querySelectorAll(\"*,:x\"),q.push(\",.*:\")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,\"div\"),s.call(a,\"[s!='']:x\"),r.push(\"!=\",O)}),q=q.length&&new RegExp(q.join(\"|\")),r=r.length&&new RegExp(r.join(\"|\")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,\"='$1']\"),c.matchesSelector&&p&&!A[b+\" \"]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error(\"Syntax error, unrecognized expression: \"+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c=\"\",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if(\"string\"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||\"\").replace(ba,ca),\"~=\"===a[2]&&(a[3]=\" \"+a[3]+\" \"),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),\"nth\"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*(\"even\"===a[3]||\"odd\"===a[3])),a[5]=+(a[7]+a[8]||\"odd\"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||\"\":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(\")\",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return\"*\"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+\" \"];return b||(b=new RegExp(\"(^|\"+L+\")\"+a+\"(\"+L+\"|$)\"))&&y(a,function(a){return b.test(\"string\"==typeof a.className&&a.className||\"undefined\"!=typeof a.getAttribute&&a.getAttribute(\"class\")||\"\")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?\"!=\"===b:b?(e+=\"\",\"=\"===b?e===c:\"!=\"===b?e!==c:\"^=\"===b?c&&0===e.indexOf(c):\"*=\"===b?c&&e.indexOf(c)>-1:\"$=\"===b?c&&e.slice(-c.length)===c:\"~=\"===b?(\" \"+e.replace(P,\" \")+\" \").indexOf(c)>-1:\"|=\"===b?e===c||e.slice(0,c.length+1)===c+\"-\":!1):!0}},CHILD:function(a,b,c,d,e){var f=\"nth\"!==a.slice(0,3),g=\"last\"!==a.slice(-4),h=\"of-type\"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?\"nextSibling\":\"previousSibling\",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p=\"only\"===a&&!o&&\"nextSibling\"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error(\"unsupported pseudo: \"+a);return e[u]?e(b):e.length>1?(c=[a,a,\"\",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,\"$1\"));return d[u]?ha(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||\"\")||fa.error(\"unsupported lang: \"+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute(\"xml:lang\")||b.getAttribute(\"lang\"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+\"-\");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return\"input\"===b&&!!a.checked||\"option\"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return\"input\"===b&&\"button\"===a.type||\"button\"===b},text:function(a){var b;return\"input\"===a.nodeName.toLowerCase()&&\"text\"===a.type&&(null==(b=a.getAttribute(\"type\"))||\"text\"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+\" \"];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=R.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q,\" \")}),h=h.slice(c.length));for(g in d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)};function qa(a){for(var b=0,c=a.length,d=\"\";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&\"parentNode\"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(j=b[u]||(b[u]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ta(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ta(b||\"*\",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ua(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[\" \"],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:\" \"===a[i-2].type?\"*\":\"\"})).replace(Q,\"$1\"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s=\"0\",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG(\"*\",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+\" \"];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xa(e,d)),f.selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n=\"function\"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&\"ID\"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=W.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qa(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split(\"\").sort(B).join(\"\")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement(\"div\"))}),ia(function(a){return a.innerHTML=\"<a href='#'></a>\",\"#\"===a.firstChild.getAttribute(\"href\")})||ja(\"type|href|height|width\",function(a,b,c){return c?void 0:a.getAttribute(b,\"type\"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML=\"<input/>\",a.firstChild.setAttribute(\"value\",\"\"),\"\"===a.firstChild.getAttribute(\"value\")})||ja(\"value\",function(a,b,c){return c||\"input\"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute(\"disabled\")})||ja(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[\":\"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\\w-]+)\\s*\\/?>(?:<\\/\\1>|)$/,y=/^.[^:#\\[\\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if(\"string\"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return h.call(b,a)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=\":not(\"+a+\")\"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if(\"string\"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+\" \"+a:a,d},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,\"string\"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]*))$/,C=n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,\"string\"==typeof a){if(e=\"<\"===a[0]&&\">\"===a[a.length-1]&&a.length>=3?[null,a,null]:B.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=d.getElementById(e[2]),f&&f.parentNode&&(this.length=1,this[0]=f),this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?void 0!==c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};C.prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||\"string\"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?\"string\"==typeof a?h.call(n(a),this[0]):h.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function F(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,\"parentNode\")},parentsUntil:function(a,b,c){return u(a,\"parentNode\",c)},next:function(a){return F(a,\"nextSibling\")},prev:function(a){return F(a,\"previousSibling\")},nextAll:function(a){return u(a,\"nextSibling\")},prevAll:function(a){return u(a,\"previousSibling\")},nextUntil:function(a,b,c){return u(a,\"nextSibling\",c)},prevUntil:function(a,b,c){return u(a,\"previousSibling\",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return\"Until\"!==a.slice(-5)&&(d=c),d&&\"string\"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||n.uniqueSort(e),D.test(a)&&e.reverse()),this.pushStack(e)}});var G=/\\S+/g;function H(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a=\"string\"==typeof a?H(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:\"\")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&\"string\"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){var c;while((c=n.inArray(b,f,c))>-1)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c=\"\",this},disabled:function(){return!f},lock:function(){return e=g=[],c||(f=c=\"\"),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[[\"resolve\",\"done\",n.Callbacks(\"once memory\"),\"resolved\"],[\"reject\",\"fail\",n.Callbacks(\"once memory\"),\"rejected\"],[\"notify\",\"progress\",n.Callbacks(\"memory\")]],c=\"pending\",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+\"With\"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+\"With\"](this===e?d:this,arguments),this},e[f[0]+\"With\"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler(\"ready\"),n(d).off(\"ready\"))))}});function J(){d.removeEventListener(\"DOMContentLoaded\",J),a.removeEventListener(\"load\",J),n.ready()}n.ready.promise=function(b){return I||(I=n.Deferred(),\"complete\"===d.readyState||\"loading\"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(n.ready):(d.addEventListener(\"DOMContentLoaded\",J),a.addEventListener(\"load\",J))),I.promise(b)},n.ready.promise();var K=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if(\"object\"===n.type(c)){e=!0;for(h in c)K(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},L=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function M(){this.expando=n.expando+M.uid++}M.uid=1,M.prototype={register:function(a,b){var c=b||{};return a.nodeType?a[this.expando]=c:Object.defineProperty(a,this.expando,{value:c,writable:!0,configurable:!0}),a[this.expando]},cache:function(a){if(!L(a))return{};var b=a[this.expando];return b||(b={},L(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if(\"string\"==typeof b)e[b]=c;else for(d in b)e[d]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][b]},access:function(a,b,c){var d;return void 0===b||b&&\"string\"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=a[this.expando];if(void 0!==f){if(void 0===b)this.register(a);else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in f?d=[b,e]:(d=e,d=d in f?[d]:d.match(G)||[])),c=d.length;while(c--)delete f[d[c]]}(void 0===b||n.isEmptyObject(f))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!n.isEmptyObject(b)}};var N=new M,O=new M,P=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,Q=/[A-Z]/g;function R(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d=\"data-\"+b.replace(Q,\"-$&\").toLowerCase(),c=a.getAttribute(d),\"string\"==typeof c){try{c=\"true\"===c?!0:\"false\"===c?!1:\"null\"===c?null:+c+\"\"===c?+c:P.test(c)?n.parseJSON(c):c}catch(e){}O.set(a,b,c);\n}else c=void 0;return c}n.extend({hasData:function(a){return O.hasData(a)||N.hasData(a)},data:function(a,b,c){return O.access(a,b,c)},removeData:function(a,b){O.remove(a,b)},_data:function(a,b,c){return N.access(a,b,c)},_removeData:function(a,b){N.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=O.get(f),1===f.nodeType&&!N.get(f,\"hasDataAttrs\"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf(\"data-\")&&(d=n.camelCase(d.slice(5)),R(f,d,e[d])));N.set(f,\"hasDataAttrs\",!0)}return e}return\"object\"==typeof a?this.each(function(){O.set(this,a)}):K(this,function(b){var c,d;if(f&&void 0===b){if(c=O.get(f,a)||O.get(f,a.replace(Q,\"-$&\").toLowerCase()),void 0!==c)return c;if(d=n.camelCase(a),c=O.get(f,d),void 0!==c)return c;if(c=R(f,d,void 0),void 0!==c)return c}else d=n.camelCase(a),this.each(function(){var c=O.get(this,d);O.set(this,d,b),a.indexOf(\"-\")>-1&&void 0!==c&&O.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){O.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||\"fx\")+\"queue\",d=N.get(a,b),c&&(!d||n.isArray(c)?d=N.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||\"fx\";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};\"inprogress\"===e&&(e=c.shift(),d--),e&&(\"fx\"===b&&c.unshift(\"inprogress\"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+\"queueHooks\";return N.get(a,c)||N.access(a,c,{empty:n.Callbacks(\"once memory\").add(function(){N.remove(a,[b+\"queue\",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return\"string\"!=typeof a&&(b=a,a=\"fx\",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),\"fx\"===a&&\"inprogress\"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||\"fx\",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};\"string\"!=typeof a&&(b=a,a=void 0),a=a||\"fx\";while(g--)c=N.get(f[g],a+\"queueHooks\"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,T=new RegExp(\"^(?:([+-])=|)(\"+S+\")([a-z%]*)$\",\"i\"),U=[\"Top\",\"Right\",\"Bottom\",\"Left\"],V=function(a,b){return a=b||a,\"none\"===n.css(a,\"display\")||!n.contains(a.ownerDocument,a)};function W(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,\"\")},i=h(),j=c&&c[3]||(n.cssNumber[b]?\"\":\"px\"),k=(n.cssNumber[b]||\"px\"!==j&&+i)&&T.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||\".5\",k/=f,n.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var X=/^(?:checkbox|radio)$/i,Y=/<([\\w:-]+)/,Z=/^$|\\/(?:java|ecma)script/i,$={option:[1,\"<select multiple='multiple'>\",\"</select>\"],thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};$.optgroup=$.option,$.tbody=$.tfoot=$.colgroup=$.caption=$.thead,$.th=$.td;function _(a,b){var c=\"undefined\"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||\"*\"):\"undefined\"!=typeof a.querySelectorAll?a.querySelectorAll(b||\"*\"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function aa(a,b){for(var c=0,d=a.length;d>c;c++)N.set(a[c],\"globalEval\",!b||N.get(b[c],\"globalEval\"))}var ba=/<|&#?\\w+;/;function ca(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],o=0,p=a.length;p>o;o++)if(f=a[o],f||0===f)if(\"object\"===n.type(f))n.merge(m,f.nodeType?[f]:f);else if(ba.test(f)){g=g||l.appendChild(b.createElement(\"div\")),h=(Y.exec(f)||[\"\",\"\"])[1].toLowerCase(),i=$[h]||$._default,g.innerHTML=i[1]+n.htmlPrefilter(f)+i[2],k=i[0];while(k--)g=g.lastChild;n.merge(m,g.childNodes),g=l.firstChild,g.textContent=\"\"}else m.push(b.createTextNode(f));l.textContent=\"\",o=0;while(f=m[o++])if(d&&n.inArray(f,d)>-1)e&&e.push(f);else if(j=n.contains(f.ownerDocument,f),g=_(l.appendChild(f),\"script\"),j&&aa(g),c){k=0;while(f=g[k++])Z.test(f.type||\"\")&&c.push(f)}return l}!function(){var a=d.createDocumentFragment(),b=a.appendChild(d.createElement(\"div\")),c=d.createElement(\"input\");c.setAttribute(\"type\",\"radio\"),c.setAttribute(\"checked\",\"checked\"),c.setAttribute(\"name\",\"t\"),b.appendChild(c),l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML=\"<textarea>x</textarea>\",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var da=/^key/,ea=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,fa=/^([^.]*)(?:\\.(.+)|)/;function ga(){return!0}function ha(){return!1}function ia(){try{return d.activeElement}catch(a){}}function ja(a,b,c,d,e,f){var g,h;if(\"object\"==typeof b){\"string\"!=typeof c&&(d=d||c,c=void 0);for(h in b)ja(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&(\"string\"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=ha;else if(!e)return a;return 1===f&&(g=e,e=function(a){return n().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=N.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return\"undefined\"!=typeof n&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||\"\").match(G)||[\"\"],j=b.length;while(j--)h=fa.exec(b[j])||[],o=q=h[1],p=(h[2]||\"\").split(\".\").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(\".\")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=N.hasData(a)&&N.get(a);if(r&&(i=r.events)){b=(b||\"\").match(G)||[\"\"],j=b.length;while(j--)if(h=fa.exec(b[j])||[],o=q=h[1],p=(h[2]||\"\").split(\".\").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp(\"(^|\\\\.)\"+p.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&(\"**\"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&N.remove(a,\"handle events\")}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(N.get(this,\"events\")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.rnamespace||a.rnamespace.test(g.namespace))&&(a.handleObj=g,a.data=g.data,d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(\"click\"!==a.type||isNaN(a.button)||a.button<1))for(;i!==this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||\"click\"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+\" \",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:\"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which\".split(\" \"),fixHooks:{},keyHooks:{props:\"char charCode key keyCode\".split(\" \"),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:\"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement\".split(\" \"),filter:function(a,b){var c,e,f,g=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||d,e=c.documentElement,f=c.body,a.pageX=b.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];h||(this.fixHooks[f]=h=ea.test(f)?this.mouseHooks:da.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;while(b--)c=e[b],a[c]=g[c];return a.target||(a.target=d),3===a.target.nodeType&&(a.target=a.target.parentNode),h.filter?h.filter(a,g):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==ia()&&this.focus?(this.focus(),!1):void 0},delegateType:\"focusin\"},blur:{trigger:function(){return this===ia()&&this.blur?(this.blur(),!1):void 0},delegateType:\"focusout\"},click:{trigger:function(){return\"checkbox\"===this.type&&this.click&&n.nodeName(this,\"input\")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,\"a\")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ga:ha):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:ha,isPropagationStopped:ha,isImmediatePropagationStopped:ha,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ga,a&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ga,a&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ga,a&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),n.fn.extend({on:function(a,b,c,d){return ja(this,a,b,c,d)},one:function(a,b,c,d){return ja(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+\".\"+d.namespace:d.origType,d.selector,d.handler),this;if(\"object\"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||\"function\"==typeof b)&&(c=b,b=void 0),c===!1&&(c=ha),this.each(function(){n.event.remove(this,a,c,b)})}});var ka=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:-]+)[^>]*)\\/>/gi,la=/<script|<style|<link/i,ma=/checked\\s*(?:[^=]|=\\s*.checked.)/i,na=/^true\\/(.*)/,oa=/^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g;function pa(a,b){return n.nodeName(a,\"table\")&&n.nodeName(11!==b.nodeType?b:b.firstChild,\"tr\")?a.getElementsByTagName(\"tbody\")[0]||a.appendChild(a.ownerDocument.createElement(\"tbody\")):a}function qa(a){return a.type=(null!==a.getAttribute(\"type\"))+\"/\"+a.type,a}function ra(a){var b=na.exec(a.type);return b?a.type=b[1]:a.removeAttribute(\"type\"),a}function sa(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(N.hasData(a)&&(f=N.access(a),g=N.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}O.hasData(a)&&(h=O.access(a),i=n.extend({},h),O.set(b,i))}}function ta(a,b){var c=b.nodeName.toLowerCase();\"input\"===c&&X.test(a.type)?b.checked=a.checked:(\"input\"===c||\"textarea\"===c)&&(b.defaultValue=a.defaultValue)}function ua(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&\"string\"==typeof q&&!l.checkClone&&ma.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),ua(f,b,c,d)});if(o&&(e=ca(b,a[0].ownerDocument,!1,a,d),g=e.firstChild,1===e.childNodes.length&&(e=g),g||d)){for(h=n.map(_(e,\"script\"),qa),i=h.length;o>m;m++)j=e,m!==p&&(j=n.clone(j,!0,!0),i&&n.merge(h,_(j,\"script\"))),c.call(a[m],j,m);if(i)for(k=h[h.length-1].ownerDocument,n.map(h,ra),m=0;i>m;m++)j=h[m],Z.test(j.type||\"\")&&!N.access(j,\"globalEval\")&&n.contains(k,j)&&(j.src?n._evalUrl&&n._evalUrl(j.src):n.globalEval(j.textContent.replace(oa,\"\")))}return a}function va(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(_(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&aa(_(d,\"script\")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(ka,\"<$1></$2>\")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=_(h),f=_(a),d=0,e=f.length;e>d;d++)ta(f[d],g[d]);if(b)if(c)for(f=f||_(a),g=g||_(h),d=0,e=f.length;e>d;d++)sa(f[d],g[d]);else sa(a,h);return g=_(h,\"script\"),g.length>0&&aa(g,!i&&_(a,\"script\")),h},cleanData:function(a){for(var b,c,d,e=n.event.special,f=0;void 0!==(c=a[f]);f++)if(L(c)){if(b=c[N.expando]){if(b.events)for(d in b.events)e[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);c[N.expando]=void 0}c[O.expando]&&(c[O.expando]=void 0)}}}),n.fn.extend({domManip:ua,detach:function(a){return va(this,a,!0)},remove:function(a){return va(this,a)},text:function(a){return K(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return ua(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=pa(this,a);b.appendChild(a)}})},prepend:function(){return ua(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=pa(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return ua(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return ua(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(_(a,!1)),a.textContent=\"\");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return K(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if(\"string\"==typeof a&&!la.test(a)&&!$[(Y.exec(a)||[\"\",\"\"])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(_(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return ua(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(_(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),f=e.length-1,h=0;f>=h;h++)c=h===f?this:this.clone(!0),n(e[h])[b](c),g.apply(d,c.get());return this.pushStack(d)}});var wa,xa={HTML:\"block\",BODY:\"block\"};function ya(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],\"display\");return c.detach(),d}function za(a){var b=d,c=xa[a];return c||(c=ya(a,b),\"none\"!==c&&c||(wa=(wa||n(\"<iframe frameborder='0' width='0' height='0'/>\")).appendTo(b.documentElement),b=wa[0].contentDocument,b.write(),b.close(),c=ya(a,b),wa.detach()),xa[a]=c),c}var Aa=/^margin/,Ba=new RegExp(\"^(\"+S+\")(?!px)[a-z%]+$\",\"i\"),Ca=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Da=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Ea=d.documentElement;!function(){var b,c,e,f,g=d.createElement(\"div\"),h=d.createElement(\"div\");if(h.style){h.style.backgroundClip=\"content-box\",h.cloneNode(!0).style.backgroundClip=\"\",l.clearCloneStyle=\"content-box\"===h.style.backgroundClip,g.style.cssText=\"border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute\",g.appendChild(h);function i(){h.style.cssText=\"-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%\",h.innerHTML=\"\",Ea.appendChild(g);var d=a.getComputedStyle(h);b=\"1%\"!==d.top,f=\"2px\"===d.marginLeft,c=\"4px\"===d.width,h.style.marginRight=\"50%\",e=\"4px\"===d.marginRight,Ea.removeChild(g)}n.extend(l,{pixelPosition:function(){return i(),b},boxSizingReliable:function(){return null==c&&i(),c},pixelMarginRight:function(){return null==c&&i(),e},reliableMarginLeft:function(){return null==c&&i(),f},reliableMarginRight:function(){var b,c=h.appendChild(d.createElement(\"div\"));return c.style.cssText=h.style.cssText=\"-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0\",c.style.marginRight=c.style.width=\"0\",h.style.width=\"1px\",Ea.appendChild(g),b=!parseFloat(a.getComputedStyle(c).marginRight),Ea.removeChild(g),h.removeChild(c),b}})}}();function Fa(a,b,c){var d,e,f,g,h=a.style;return c=c||Ca(a),g=c?c.getPropertyValue(b)||c[b]:void 0,\"\"!==g&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Ba.test(g)&&Aa.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0!==g?g+\"\":g}function Ga(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Ha=/^(none|table(?!-c[ea]).+)/,Ia={position:\"absolute\",visibility:\"hidden\",display:\"block\"},Ja={letterSpacing:\"0\",fontWeight:\"400\"},Ka=[\"Webkit\",\"O\",\"Moz\",\"ms\"],La=d.createElement(\"div\").style;function Ma(a){if(a in La)return a;var b=a[0].toUpperCase()+a.slice(1),c=Ka.length;while(c--)if(a=Ka[c]+b,a in La)return a}function Na(a,b,c){var d=T.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||\"px\"):b}function Oa(a,b,c,d,e){for(var f=c===(d?\"border\":\"content\")?4:\"width\"===b?1:0,g=0;4>f;f+=2)\"margin\"===c&&(g+=n.css(a,c+U[f],!0,e)),d?(\"content\"===c&&(g-=n.css(a,\"padding\"+U[f],!0,e)),\"margin\"!==c&&(g-=n.css(a,\"border\"+U[f]+\"Width\",!0,e))):(g+=n.css(a,\"padding\"+U[f],!0,e),\"padding\"!==c&&(g+=n.css(a,\"border\"+U[f]+\"Width\",!0,e)));return g}function Pa(b,c,e){var f=!0,g=\"width\"===c?b.offsetWidth:b.offsetHeight,h=Ca(b),i=\"border-box\"===n.css(b,\"boxSizing\",!1,h);if(d.msFullscreenElement&&a.top!==a&&b.getClientRects().length&&(g=Math.round(100*b.getBoundingClientRect()[c])),0>=g||null==g){if(g=Fa(b,c,h),(0>g||null==g)&&(g=b.style[c]),Ba.test(g))return g;f=i&&(l.boxSizingReliable()||g===b.style[c]),g=parseFloat(g)||0}return g+Oa(b,c,e||(i?\"border\":\"content\"),f,h)+\"px\"}function Qa(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=N.get(d,\"olddisplay\"),c=d.style.display,b?(f[g]||\"none\"!==c||(d.style.display=\"\"),\"\"===d.style.display&&V(d)&&(f[g]=N.access(d,\"olddisplay\",za(d.nodeName)))):(e=V(d),\"none\"===c&&e||N.set(d,\"olddisplay\",e?c:n.css(d,\"display\"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&\"none\"!==d.style.display&&\"\"!==d.style.display||(d.style.display=b?f[g]||\"\":\"none\"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Fa(a,\"opacity\");return\"\"===c?\"1\":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{\"float\":\"cssFloat\"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Ma(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&\"get\"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,\"string\"===f&&(e=T.exec(c))&&e[1]&&(c=W(a,b,e),f=\"number\"),null!=c&&c===c&&(\"number\"===f&&(c+=e&&e[3]||(n.cssNumber[h]?\"\":\"px\")),l.clearCloneStyle||\"\"!==c||0!==b.indexOf(\"background\")||(i[b]=\"inherit\"),g&&\"set\"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Ma(h)||h),g=n.cssHooks[b]||n.cssHooks[h],g&&\"get\"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Fa(a,b,d)),\"normal\"===e&&b in Ja&&(e=Ja[b]),\"\"===c||c?(f=parseFloat(e),c===!0||isFinite(f)?f||0:e):e}}),n.each([\"height\",\"width\"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Ha.test(n.css(a,\"display\"))&&0===a.offsetWidth?Da(a,Ia,function(){return Pa(a,b,d)}):Pa(a,b,d):void 0},set:function(a,c,d){var e,f=d&&Ca(a),g=d&&Oa(a,b,d,\"border-box\"===n.css(a,\"boxSizing\",!1,f),f);return g&&(e=T.exec(c))&&\"px\"!==(e[3]||\"px\")&&(a.style[b]=c,c=n.css(a,b)),Na(a,c,g)}}}),n.cssHooks.marginLeft=Ga(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Fa(a,\"marginLeft\"))||a.getBoundingClientRect().left-Da(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+\"px\":void 0}),n.cssHooks.marginRight=Ga(l.reliableMarginRight,function(a,b){return b?Da(a,{display:\"inline-block\"},Fa,[a,\"marginRight\"]):void 0}),n.each({margin:\"\",padding:\"\",border:\"Width\"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f=\"string\"==typeof c?c.split(\" \"):[c];4>d;d++)e[a+U[d]+b]=f[d]||f[d-2]||f[0];return e}},Aa.test(a)||(n.cssHooks[a+b].set=Na)}),n.fn.extend({css:function(a,b){return K(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ca(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Qa(this,!0)},hide:function(){return Qa(this)},toggle:function(a){return\"boolean\"==typeof a?a?this.show():this.hide():this.each(function(){V(this)?n(this).show():n(this).hide()})}});function Ra(a,b,c,d,e){return new Ra.prototype.init(a,b,c,d,e)}n.Tween=Ra,Ra.prototype={constructor:Ra,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?\"\":\"px\")},cur:function(){var a=Ra.propHooks[this.prop];return a&&a.get?a.get(this):Ra.propHooks._default.get(this)},run:function(a){var b,c=Ra.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ra.propHooks._default.set(this),this}},Ra.prototype.init.prototype=Ra.prototype,Ra.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,\"\"),b&&\"auto\"!==b?b:0)},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},Ra.propHooks.scrollTop=Ra.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:\"swing\"},n.fx=Ra.prototype.init,n.fx.step={};var Sa,Ta,Ua=/^(?:toggle|show|hide)$/,Va=/queueHooks$/;function Wa(){return a.setTimeout(function(){Sa=void 0}),Sa=n.now()}function Xa(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=U[d],e[\"margin\"+c]=e[\"padding\"+c]=a;return b&&(e.opacity=e.width=a),e}function Ya(a,b,c){for(var d,e=(_a.tweeners[b]||[]).concat(_a.tweeners[\"*\"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Za(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&V(a),q=N.get(a,\"fxshow\");c.queue||(h=n._queueHooks(a,\"fx\"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,\"fx\").length||h.empty.fire()})})),1===a.nodeType&&(\"height\"in b||\"width\"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,\"display\"),k=\"none\"===j?N.get(a,\"olddisplay\")||za(a.nodeName):j,\"inline\"===k&&\"none\"===n.css(a,\"float\")&&(o.display=\"inline-block\")),c.overflow&&(o.overflow=\"hidden\",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Ua.exec(e)){if(delete b[d],f=f||\"toggle\"===e,e===(p?\"hide\":\"show\")){if(\"show\"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))\"inline\"===(\"none\"===j?za(a.nodeName):j)&&(o.display=j);else{q?\"hidden\"in q&&(p=q.hidden):q=N.access(a,\"fxshow\",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;N.remove(a,\"fxshow\");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ya(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start=\"width\"===d||\"height\"===d?1:0))}}function $a(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&\"expand\"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function _a(a,b,c){var d,e,f=0,g=_a.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Sa||Wa(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:Sa||Wa(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for($a(k,j.opts.specialEasing);g>f;f++)if(d=_a.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,Ya,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(_a,{tweeners:{\"*\":[function(a,b){var c=this.createTween(a,b);return W(c.elem,a,T.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=[\"*\"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],_a.tweeners[c]=_a.tweeners[c]||[],_a.tweeners[c].unshift(b)},prefilters:[Za],prefilter:function(a,b){b?_a.prefilters.unshift(a):_a.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&\"object\"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:\"number\"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue=\"fx\"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(V).css(\"opacity\",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=_a(this,n.extend({},a),f);(e||N.get(this,\"finish\"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return\"string\"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||\"fx\",[]),this.each(function(){var b=!0,e=null!=a&&a+\"queueHooks\",f=n.timers,g=N.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Va.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||\"fx\"),this.each(function(){var b,c=N.get(this),d=c[a+\"queue\"],e=c[a+\"queueHooks\"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each([\"toggle\",\"show\",\"hide\"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||\"boolean\"==typeof a?c.apply(this,arguments):this.animate(Xa(b,!0),a,d,e)}}),n.each({slideDown:Xa(\"show\"),slideUp:Xa(\"hide\"),slideToggle:Xa(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Sa=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),Sa=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Ta||(Ta=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(Ta),Ta=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx?n.fx.speeds[b]||b:b,c=c||\"fx\",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement(\"input\"),b=d.createElement(\"select\"),c=b.appendChild(d.createElement(\"option\"));a.type=\"checkbox\",l.checkOn=\"\"!==a.value,l.optSelected=c.selected,b.disabled=!0,l.optDisabled=!c.disabled,a=d.createElement(\"input\"),a.value=\"t\",a.type=\"radio\",l.radioValue=\"t\"===a.value}();var ab,bb=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return K(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return\"undefined\"==typeof a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ab:void 0)),void 0!==c?null===c?void n.removeAttr(a,b):e&&\"set\"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+\"\"),c):e&&\"get\"in e&&null!==(d=e.get(a,b))?d:(d=n.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&\"radio\"===b&&n.nodeName(a,\"input\")){var c=a.value;return a.setAttribute(\"type\",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)}}),ab={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\\w+/g),function(a,b){var c=bb[b]||n.find.attr;bb[b]=function(a,b,d){var e,f;return d||(f=bb[b],bb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,bb[b]=f),e}});var cb=/^(?:input|select|textarea|button)$/i,db=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return K(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,\ne=n.propHooks[b]),void 0!==c?e&&\"set\"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&\"get\"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,\"tabindex\");return b?parseInt(b,10):cb.test(a.nodeName)||db.test(a.nodeName)&&a.href?0:-1}}},propFix:{\"for\":\"htmlFor\",\"class\":\"className\"}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],function(){n.propFix[this.toLowerCase()]=this});var eb=/[\\t\\r\\n\\f]/g;function fb(a){return a.getAttribute&&a.getAttribute(\"class\")||\"\"}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,fb(this)))});if(\"string\"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=fb(c),d=1===c.nodeType&&(\" \"+e+\" \").replace(eb,\" \")){g=0;while(f=b[g++])d.indexOf(\" \"+f+\" \")<0&&(d+=f+\" \");h=n.trim(d),e!==h&&c.setAttribute(\"class\",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,fb(this)))});if(!arguments.length)return this.attr(\"class\",\"\");if(\"string\"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=fb(c),d=1===c.nodeType&&(\" \"+e+\" \").replace(eb,\" \")){g=0;while(f=b[g++])while(d.indexOf(\" \"+f+\" \")>-1)d=d.replace(\" \"+f+\" \",\" \");h=n.trim(d),e!==h&&c.setAttribute(\"class\",h)}}return this},toggleClass:function(a,b){var c=typeof a;return\"boolean\"==typeof b&&\"string\"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,fb(this),b),b)}):this.each(function(){var b,d,e,f;if(\"string\"===c){d=0,e=n(this),f=a.match(G)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(void 0===a||\"boolean\"===c)&&(b=fb(this),b&&N.set(this,\"__className__\",b),this.setAttribute&&this.setAttribute(\"class\",b||a===!1?\"\":N.get(this,\"__className__\")||\"\"))})},hasClass:function(a){var b,c,d=0;b=\" \"+a+\" \";while(c=this[d++])if(1===c.nodeType&&(\" \"+fb(c)+\" \").replace(eb,\" \").indexOf(b)>-1)return!0;return!1}});var gb=/\\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e=\"\":\"number\"==typeof e?e+=\"\":n.isArray(e)&&(e=n.map(e,function(a){return null==a?\"\":a+\"\"})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&\"set\"in b&&void 0!==b.set(this,e,\"value\")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&\"get\"in b&&void 0!==(c=b.get(e,\"value\"))?c:(c=e.value,\"string\"==typeof c?c.replace(gb,\"\"):null==c?\"\":c)}}}),n.extend({valHooks:{option:{get:function(a){return n.trim(a.value)}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f=\"select-one\"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute(\"disabled\"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,\"optgroup\"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(n.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each([\"radio\",\"checkbox\"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute(\"value\")?\"on\":a.value})});var hb=/^(?:focusinfocus|focusoutblur)$/;n.extend(n.event,{trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,\"type\")?b.type:b,r=k.call(b,\"namespace\")?b.namespace.split(\".\"):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!hb.test(q+n.event.triggered)&&(q.indexOf(\".\")>-1&&(r=q.split(\".\"),q=r.shift(),r.sort()),l=q.indexOf(\":\")<0&&\"on\"+q,b=b[n.expando]?b:new n.Event(q,\"object\"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=r.join(\".\"),b.rnamespace=b.namespace?new RegExp(\"(^|\\\\.)\"+r.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},f||!o.trigger||o.trigger.apply(e,c)!==!1)){if(!f&&!o.noBubble&&!n.isWindow(e)){for(j=o.delegateType||q,hb.test(j+q)||(h=h.parentNode);h;h=h.parentNode)p.push(h),i=h;i===(e.ownerDocument||d)&&p.push(i.defaultView||i.parentWindow||a)}g=0;while((h=p[g++])&&!b.isPropagationStopped())b.type=g>1?j:o.bindType||q,m=(N.get(h,\"events\")||{})[b.type]&&N.get(h,\"handle\"),m&&m.apply(h,c),m=l&&h[l],m&&m.apply&&L(h)&&(b.result=m.apply(h,c),b.result===!1&&b.preventDefault());return b.type=q,f||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!L(e)||l&&n.isFunction(e[q])&&!n.isWindow(e)&&(i=e[l],i&&(e[l]=null),n.event.triggered=q,e[q](),n.event.triggered=void 0,i&&(e[l]=i)),b.result}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b),d.isDefaultPrevented()&&c.preventDefault()}}),n.fn.extend({trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}}),n.each(\"blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu\".split(\" \"),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),l.focusin=\"onfocusin\"in a,l.focusin||n.each({focus:\"focusin\",blur:\"focusout\"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=N.access(d,b);e||d.addEventListener(a,c,!0),N.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=N.access(d,b)-1;e?N.access(d,b,e):(d.removeEventListener(a,c,!0),N.remove(d,b))}}});var ib=a.location,jb=n.now(),kb=/\\?/;n.parseJSON=function(a){return JSON.parse(a+\"\")},n.parseXML=function(b){var c;if(!b||\"string\"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,\"text/xml\")}catch(d){c=void 0}return(!c||c.getElementsByTagName(\"parsererror\").length)&&n.error(\"Invalid XML: \"+b),c};var lb=/#.*$/,mb=/([?&])_=[^&]*/,nb=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,ob=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pb=/^(?:GET|HEAD)$/,qb=/^\\/\\//,rb={},sb={},tb=\"*/\".concat(\"*\"),ub=d.createElement(\"a\");ub.href=ib.href;function vb(a){return function(b,c){\"string\"!=typeof b&&(c=b,b=\"*\");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))while(d=f[e++])\"+\"===d[0]?(d=d.slice(1)||\"*\",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function wb(a,b,c,d){var e={},f=a===sb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return\"string\"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e[\"*\"]&&g(\"*\")}function xb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function yb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while(\"*\"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader(\"Content-Type\"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+\" \"+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function zb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if(\"*\"===f)f=i;else if(\"*\"!==i&&i!==f){if(g=j[i+\" \"+f]||j[\"* \"+f],!g)for(e in j)if(h=e.split(\" \"),h[1]===f&&(g=j[i+\" \"+h[0]]||j[\"* \"+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a[\"throws\"])b=g(b);else try{b=g(b)}catch(l){return{state:\"parsererror\",error:g?l:\"No conversion from \"+i+\" to \"+f}}}return{state:\"success\",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ib.href,type:\"GET\",isLocal:ob.test(ib.protocol),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":tb,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":n.parseJSON,\"text xml\":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?xb(xb(a,n.ajaxSettings),b):xb(n.ajaxSettings,a)},ajaxPrefilter:vb(rb),ajaxTransport:vb(sb),ajax:function(b,c){\"object\"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m=n.ajaxSetup({},c),o=m.context||m,p=m.context&&(o.nodeType||o.jquery)?n(o):n.event,q=n.Deferred(),r=n.Callbacks(\"once memory\"),s=m.statusCode||{},t={},u={},v=0,w=\"canceled\",x={readyState:0,getResponseHeader:function(a){var b;if(2===v){if(!h){h={};while(b=nb.exec(g))h[b[1].toLowerCase()]=b[2]}b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===v?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return v||(a=u[c]=u[c]||a,t[a]=b),this},overrideMimeType:function(a){return v||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>v)for(b in a)s[b]=[s[b],a[b]];else x.always(a[x.status]);return this},abort:function(a){var b=a||w;return e&&e.abort(b),z(0,b),this}};if(q.promise(x).complete=r.add,x.success=x.done,x.error=x.fail,m.url=((b||m.url||ib.href)+\"\").replace(lb,\"\").replace(qb,ib.protocol+\"//\"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=n.trim(m.dataType||\"*\").toLowerCase().match(G)||[\"\"],null==m.crossDomain){j=d.createElement(\"a\");try{j.href=m.url,j.href=j.href,m.crossDomain=ub.protocol+\"//\"+ub.host!=j.protocol+\"//\"+j.host}catch(y){m.crossDomain=!0}}if(m.data&&m.processData&&\"string\"!=typeof m.data&&(m.data=n.param(m.data,m.traditional)),wb(rb,m,c,x),2===v)return x;k=n.event&&m.global,k&&0===n.active++&&n.event.trigger(\"ajaxStart\"),m.type=m.type.toUpperCase(),m.hasContent=!pb.test(m.type),f=m.url,m.hasContent||(m.data&&(f=m.url+=(kb.test(f)?\"&\":\"?\")+m.data,delete m.data),m.cache===!1&&(m.url=mb.test(f)?f.replace(mb,\"$1_=\"+jb++):f+(kb.test(f)?\"&\":\"?\")+\"_=\"+jb++)),m.ifModified&&(n.lastModified[f]&&x.setRequestHeader(\"If-Modified-Since\",n.lastModified[f]),n.etag[f]&&x.setRequestHeader(\"If-None-Match\",n.etag[f])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&x.setRequestHeader(\"Content-Type\",m.contentType),x.setRequestHeader(\"Accept\",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+(\"*\"!==m.dataTypes[0]?\", \"+tb+\"; q=0.01\":\"\"):m.accepts[\"*\"]);for(l in m.headers)x.setRequestHeader(l,m.headers[l]);if(m.beforeSend&&(m.beforeSend.call(o,x,m)===!1||2===v))return x.abort();w=\"abort\";for(l in{success:1,error:1,complete:1})x[l](m[l]);if(e=wb(sb,m,c,x)){if(x.readyState=1,k&&p.trigger(\"ajaxSend\",[x,m]),2===v)return x;m.async&&m.timeout>0&&(i=a.setTimeout(function(){x.abort(\"timeout\")},m.timeout));try{v=1,e.send(t,z)}catch(y){if(!(2>v))throw y;z(-1,y)}}else z(-1,\"No Transport\");function z(b,c,d,h){var j,l,t,u,w,y=c;2!==v&&(v=2,i&&a.clearTimeout(i),e=void 0,g=h||\"\",x.readyState=b>0?4:0,j=b>=200&&300>b||304===b,d&&(u=yb(m,x,d)),u=zb(m,u,x,j),j?(m.ifModified&&(w=x.getResponseHeader(\"Last-Modified\"),w&&(n.lastModified[f]=w),w=x.getResponseHeader(\"etag\"),w&&(n.etag[f]=w)),204===b||\"HEAD\"===m.type?y=\"nocontent\":304===b?y=\"notmodified\":(y=u.state,l=u.data,t=u.error,j=!t)):(t=y,(b||!y)&&(y=\"error\",0>b&&(b=0))),x.status=b,x.statusText=(c||y)+\"\",j?q.resolveWith(o,[l,y,x]):q.rejectWith(o,[x,y,t]),x.statusCode(s),s=void 0,k&&p.trigger(j?\"ajaxSuccess\":\"ajaxError\",[x,m,j?l:t]),r.fireWith(o,[x,y]),k&&(p.trigger(\"ajaxComplete\",[x,m]),--n.active||n.event.trigger(\"ajaxStop\")))}return x},getJSON:function(a,b,c){return n.get(a,b,c,\"json\")},getScript:function(a,b){return n.get(a,void 0,b,\"script\")}}),n.each([\"get\",\"post\"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:\"GET\",dataType:\"script\",async:!1,global:!1,\"throws\":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,\"body\")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return!n.expr.filters.visible(a)},n.expr.filters.visible=function(a){return a.offsetWidth>0||a.offsetHeight>0||a.getClientRects().length>0};var Ab=/%20/g,Bb=/\\[\\]$/,Cb=/\\r?\\n/g,Db=/^(?:submit|button|image|reset|file)$/i,Eb=/^(?:input|select|textarea|keygen)/i;function Fb(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||Bb.test(a)?d(a,e):Fb(a+\"[\"+(\"object\"==typeof e&&null!=e?b:\"\")+\"]\",e,c,d)});else if(c||\"object\"!==n.type(b))d(a,b);else for(e in b)Fb(a+\"[\"+e+\"]\",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?\"\":b,d[d.length]=encodeURIComponent(a)+\"=\"+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Fb(c,a[c],b,e);return d.join(\"&\").replace(Ab,\"+\")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,\"elements\");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(\":disabled\")&&Eb.test(this.nodeName)&&!Db.test(a)&&(this.checked||!X.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(Cb,\"\\r\\n\")}}):{name:b.name,value:c.replace(Cb,\"\\r\\n\")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Gb={0:200,1223:204},Hb=n.ajaxSettings.xhr();l.cors=!!Hb&&\"withCredentials\"in Hb,l.ajax=Hb=!!Hb,n.ajaxTransport(function(b){var c,d;return l.cors||Hb&&!b.crossDomain?{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e[\"X-Requested-With\"]||(e[\"X-Requested-With\"]=\"XMLHttpRequest\");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,\"abort\"===a?h.abort():\"error\"===a?\"number\"!=typeof h.status?f(0,\"error\"):f(h.status,h.statusText):f(Gb[h.status]||h.status,h.statusText,\"text\"!==(h.responseType||\"text\")||\"string\"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c(\"error\"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c(\"abort\");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}:void 0}),n.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{\"text script\":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter(\"script\",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type=\"GET\")}),n.ajaxTransport(\"script\",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=n(\"<script>\").prop({charset:a.scriptCharset,src:a.url}).on(\"load error\",c=function(a){b.remove(),c=null,a&&f(\"error\"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Ib=[],Jb=/(=)\\?(?=&|$)|\\?\\?/;n.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var a=Ib.pop()||n.expando+\"_\"+jb++;return this[a]=!0,a}}),n.ajaxPrefilter(\"json jsonp\",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Jb.test(b.url)?\"url\":\"string\"==typeof b.data&&0===(b.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Jb.test(b.data)&&\"data\");return h||\"jsonp\"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Jb,\"$1\"+e):b.jsonp!==!1&&(b.url+=(kb.test(b.url)?\"&\":\"?\")+b.jsonp+\"=\"+e),b.converters[\"script json\"]=function(){return g||n.error(e+\" was not called\"),g[0]},b.dataTypes[0]=\"json\",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Ib.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),\"script\"):void 0}),l.createHTMLDocument=function(){var a=d.implementation.createHTMLDocument(\"\").body;return a.innerHTML=\"<form></form><form></form>\",2===a.childNodes.length}(),n.parseHTML=function(a,b,c){if(!a||\"string\"!=typeof a)return null;\"boolean\"==typeof b&&(c=b,b=!1),b=b||(l.createHTMLDocument?d.implementation.createHTMLDocument(\"\"):d);var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ca([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var Kb=n.fn.load;n.fn.load=function(a,b,c){if(\"string\"!=typeof a&&Kb)return Kb.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(\" \");return h>-1&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&\"object\"==typeof b&&(e=\"POST\"),g.length>0&&n.ajax({url:a,type:e||\"GET\",dataType:\"html\",data:b}).done(function(a){f=arguments,g.html(d?n(\"<div>\").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(g,f||[a.responseText,b,a])})}),this},n.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};function Lb(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,\"position\"),l=n(a),m={};\"static\"===k&&(a.style.position=\"relative\"),h=l.offset(),f=n.css(a,\"top\"),i=n.css(a,\"left\"),j=(\"absolute\"===k||\"fixed\"===k)&&(f+i).indexOf(\"auto\")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),\"using\"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(e=d.getBoundingClientRect(),c=Lb(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return\"fixed\"===n.css(c,\"position\")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],\"html\")||(d=a.offset()),d.top+=n.css(a[0],\"borderTopWidth\",!0),d.left+=n.css(a[0],\"borderLeftWidth\",!0)),{top:b.top-d.top-n.css(c,\"marginTop\",!0),left:b.left-d.left-n.css(c,\"marginLeft\",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&\"static\"===n.css(a,\"position\"))a=a.offsetParent;return a||Ea})}}),n.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},function(a,b){var c=\"pageYOffset\"===b;n.fn[a]=function(d){return K(this,function(a,d,e){var f=Lb(a);return void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),n.each([\"top\",\"left\"],function(a,b){n.cssHooks[b]=Ga(l.pixelPosition,function(a,c){return c?(c=Fa(a,b),Ba.test(c)?n(a).position()[b]+\"px\":c):void 0})}),n.each({Height:\"height\",Width:\"width\"},function(a,b){n.each({padding:\"inner\"+a,content:b,\"\":\"outer\"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||\"boolean\"!=typeof d),g=c||(d===!0||e===!0?\"margin\":\"border\");return K(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement[\"client\"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body[\"scroll\"+a],e[\"scroll\"+a],b.body[\"offset\"+a],e[\"offset\"+a],e[\"client\"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,\"**\"):this.off(b,a||\"**\",c)},size:function(){return this.length}}),n.fn.andSelf=n.fn.addBack,\"function\"==typeof define&&define.amd&&define(\"jquery\",[],function(){return n});var Mb=a.jQuery,Nb=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Nb),b&&a.jQuery===n&&(a.jQuery=Mb),n},b||(a.jQuery=a.$=n),n});\n/*\n * jQuery throttle / debounce - v1.1 - 3/7/2010\n * http://benalman.com/projects/jquery-throttle-debounce-plugin/\n * \n * Copyright (c) 2010 \"Cowboy\" Ben Alman\n * Dual licensed under the MIT and GPL licenses.\n * http://benalman.com/about/license/\n */\n(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!==\"boolean\"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);\n/*!\n * imagesLoaded PACKAGED v4.1.0\n * JavaScript is all like \"You images are done yet or what?\"\n * MIT License\n */\n!function(t,e){\"function\"==typeof define&&define.amd?define(\"ev-emitter/ev-emitter\",e):\"object\"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}(this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},n=i[t]=i[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{},n=i[t]=i[t]||[];return n[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=i.indexOf(e);return-1!=n&&i.splice(n,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=0,o=i[n];e=e||[];for(var r=this._onceEvents&&this._onceEvents[t];o;){var s=r&&r[o];s&&(this.off(t,o),delete r[o]),o.apply(this,e),n+=s?0:1,o=i[n]}return this}},t}),function(t,e){\"use strict\";\"function\"==typeof define&&define.amd?define([\"ev-emitter/ev-emitter\"],function(i){return e(t,i)}):\"object\"==typeof module&&module.exports?module.exports=e(t,require(\"ev-emitter\")):t.imagesLoaded=e(t,t.EvEmitter)}(window,function(t,e){function i(t,e){for(var i in e)t[i]=e[i];return t}function n(t){var e=[];if(Array.isArray(t))e=t;else if(\"number\"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e}function o(t,e,r){return this instanceof o?(\"string\"==typeof t&&(t=document.querySelectorAll(t)),this.elements=n(t),this.options=i({},this.options),\"function\"==typeof e?r=e:i(this.options,e),r&&this.on(\"always\",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(function(){this.check()}.bind(this))):new o(t,e,r)}function r(t){this.img=t}function s(t,e){this.url=t,this.element=e,this.img=new Image}var h=t.jQuery,a=t.console;o.prototype=Object.create(e.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(t){\"IMG\"==t.nodeName&&this.addImage(t),this.options.background===!0&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&d[e]){for(var i=t.querySelectorAll(\"img\"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if(\"string\"==typeof this.options.background){var r=t.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var d={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var i=/url\\((['\"])?(.*?)\\1\\)/gi,n=i.exec(e.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,t),n=i.exec(e.backgroundImage)}},o.prototype.addImage=function(t){var e=new r(t);this.images.push(e)},o.prototype.addBackground=function(t,e){var i=new s(t,e);this.images.push(i)},o.prototype.check=function(){function t(t,i,n){setTimeout(function(){e.progress(t,i,n)})}var e=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(e){e.once(\"progress\",t),e.check()}):void this.complete()},o.prototype.progress=function(t,e,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent(\"progress\",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log(\"progress: \"+i,t,e)},o.prototype.complete=function(){var t=this.hasAnyBroken?\"fail\":\"done\";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent(\"always\",[this]),this.jqDeferred){var e=this.hasAnyBroken?\"reject\":\"resolve\";this.jqDeferred[e](this)}},r.prototype=Object.create(e.prototype),r.prototype.check=function(){var t=this.getIsImageComplete();return t?void this.confirm(0!==this.img.naturalWidth,\"naturalWidth\"):(this.proxyImage=new Image,this.proxyImage.addEventListener(\"load\",this),this.proxyImage.addEventListener(\"error\",this),this.img.addEventListener(\"load\",this),this.img.addEventListener(\"error\",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},r.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent(\"progress\",[this,this.img,e])},r.prototype.handleEvent=function(t){var e=\"on\"+t.type;this[e]&&this[e](t)},r.prototype.onload=function(){this.confirm(!0,\"onload\"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,\"onerror\"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener(\"load\",this),this.proxyImage.removeEventListener(\"error\",this),this.img.removeEventListener(\"load\",this),this.img.removeEventListener(\"error\",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener(\"load\",this),this.img.addEventListener(\"error\",this),this.img.src=this.url;var t=this.getIsImageComplete();t&&(this.confirm(0!==this.img.naturalWidth,\"naturalWidth\"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener(\"load\",this),this.img.removeEventListener(\"error\",this)},s.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent(\"progress\",[this,this.element,e])},o.makeJQueryPlugin=function(e){e=e||t.jQuery,e&&(h=e,h.fn.imagesLoaded=function(t,e){var i=new o(this,t,e);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});\n/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */\nvar LZString={_keyStr:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return\"\";var t=\"\";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return\"\";var t=\"\",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\\+\\/\\=]/g,\"\");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return\"\";var t=\"\",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return\"\";var t=\"\",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return\"\";var t,n,r={},i={},s=\"\",o=\"\",u=\"\",a=2,f=3,l=2,c=\"\",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==\"\"){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return\"\";if(e==\"\")return null;var t=[],n,r=4,i=4,s=3,o=\"\",u=\"\",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return\"\"}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return\"\"}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!==\"undefined\"&&module!=null){module.exports=LZString}\n/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */\nvar saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){\"use strict\";var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,i=t.createElementNS(\"http://www.w3.org/1999/xhtml\",\"a\"),s=\"download\"in i,o=function(n){var r=t.createEvent(\"MouseEvents\");r.initMouseEvent(\"click\",true,false,e,0,0,0,0,0,false,false,false,false,0,null);n.dispatchEvent(r)},u=e.webkitRequestFileSystem,a=e.requestFileSystem||u||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l=\"application/octet-stream\",c=0,h=[],p=function(){var e=h.length;while(e--){var t=h[e];if(typeof t===\"string\"){r.revokeObjectURL(t)}else{t.remove()}}h.length=0},d=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e[\"on\"+t[r]];if(typeof i===\"function\"){try{i.call(e,n||e)}catch(s){f(s)}}}},v=function(t,r){var f=this,p=t.type,v=false,m,g,y=function(){var e=n().createObjectURL(t);h.push(e);return e},b=function(){d(f,\"writestart progress write writeend\".split(\" \"))},w=function(){if(v||!m){m=y(t)}if(g){g.location.href=m}else{window.open(m,\"_blank\")}f.readyState=f.DONE;b()},E=function(e){return function(){if(f.readyState!==f.DONE){return e.apply(this,arguments)}}},S={create:true,exclusive:false},x;f.readyState=f.INIT;if(!r){r=\"download\"}if(s){m=y(t);i.href=m;i.download=r;o(i);f.readyState=f.DONE;b();return}if(e.chrome&&p&&p!==l){x=t.slice||t.webkitSlice;t=x.call(t,0,t.size,l);v=true}if(u&&r!==\"download\"){r+=\".download\"}if(p===l||u){g=e}if(!a){w();return}c+=t.size;a(e.TEMPORARY,c,E(function(e){e.root.getDirectory(\"saved\",S,E(function(e){var n=function(){e.getFile(r,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL();h.push(e);f.readyState=f.DONE;d(f,\"writeend\",t)};n.onerror=function(){var e=n.error;if(e.code!==e.ABORT_ERR){w()}};\"writestart progress write abort\".split(\" \").forEach(function(e){n[\"on\"+e]=f[\"on\"+e]});n.write(t);f.abort=function(){n.abort();f.readyState=f.DONE};f.readyState=f.WRITING}),w)}),w)};e.getFile(r,{create:false},E(function(e){e.remove();n()}),E(function(e){if(e.code===e.NOT_FOUND_ERR){n()}else{w()}}))}),w)}),w)},m=v.prototype,g=function(e,t){return new v(e,t)};m.abort=function(){var e=this;e.readyState=e.DONE;d(e,\"abort\")};m.readyState=m.INIT=0;m.WRITING=1;m.DONE=2;m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null;e.addEventListener(\"unload\",p,false);return g}(self)\n/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */\n!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&\"object\"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:\"string\"==e?a:a+\"\\0\"}function l(a,b){for(var c,d=a+\"\",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c[\"seed\"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,\"object\"==typeof module&&module,\"function\"==typeof define&&define,\"random\");\n/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */\n!function(){for(var methods=[\"assert\",\"clear\",\"count\",\"debug\",\"dir\",\"dirxml\",\"error\",\"exception\",\"group\",\"groupCollapsed\",\"groupEnd\",\"info\",\"log\",\"markTimeline\",\"profile\",\"profileEnd\",\"table\",\"time\",\"timeEnd\",\"timeline\",\"timelineEnd\",\"timeStamp\",\"trace\",\"warn\"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var t;t=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,t.AFRAME=e()}}(function(){var t;return function i(e,t,r){function n(o,s){if(!t[o]){if(!e[o]){var c=\"function\"==typeof require&&require;if(!s&&c)return c(o,!0);if(a)return a(o,!0);var u=new Error(\"Cannot find module '\"+o+\"'\");throw u.code=\"MODULE_NOT_FOUND\",u}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return n(i?i:t)},l,l.exports,i,e,t,r)}return t[o].exports}for(var a=\"function\"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(e,t){\"use strict\";t.exports={createLink:function(e,t){var i=document.head||document.getElementsByTagName(\"head\")[0],r=document.createElement(\"link\");r.href=e,r.rel=\"stylesheet\";for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];r.setAttribute(\"data-\"+n,a)}i.appendChild(r)},createStyle:function(e,t){var i=document.head||document.getElementsByTagName(\"head\")[0],r=document.createElement(\"style\");r.type=\"text/css\";for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];r.setAttribute(\"data-\"+n,a)}r.sheet?(r.innerHTML=e,r.sheet.cssText=e,i.appendChild(r)):r.styleSheet?(i.appendChild(r),r.styleSheet.cssText=e):(r.appendChild(document.createTextNode(e)),i.appendChild(r))}}},{}],2:[function(e,t,i){function r(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}function n(){var e=arguments,t=this.useColors;if(e[0]=(t?\"%c\":\"\")+this.namespace+(t?\" %c\":\" \")+e[0]+(t?\"%c \":\" \")+\"+\"+i.humanize(this.diff),!t)return e;var r=\"color: \"+this.color;e=[e[0],r,\"color: inherit\"].concat(Array.prototype.slice.call(e,1));var n=0,a=0;return e[0].replace(/%[a-z%]/g,function(e){\"%%\"!==e&&(n++,\"%c\"===e&&(a=n))}),e.splice(a,0,r),e}function a(){return\"object\"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{null==e?i.storage.removeItem(\"debug\"):i.storage.debug=e}catch(t){}}function s(){var e;try{e=i.storage.debug}catch(t){}return e}function c(){try{return window.localStorage}catch(e){}}i=t.exports=e(\"./debug\"),i.log=a,i.formatArgs=n,i.save=o,i.load=s,i.useColors=r,i.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:c(),i.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"],i.formatters.j=function(e){return JSON.stringify(e)},i.enable(s())},{\"./debug\":3}],3:[function(e,t,i){function r(){return i.colors[l++%i.colors.length]}function n(e){function t(){}function n(){var e=n,t=+new Date,a=t-(u||t);e.diff=a,e.prev=u,e.curr=t,u=t,null==e.useColors&&(e.useColors=i.useColors()),null==e.color&&e.useColors&&(e.color=r());var o=Array.prototype.slice.call(arguments);o[0]=i.coerce(o[0]),\"string\"!=typeof o[0]&&(o=[\"%o\"].concat(o));var s=0;o[0]=o[0].replace(/%([a-z%])/g,function(t,r){if(\"%%\"===t)return t;s++;var n=i.formatters[r];if(\"function\"==typeof n){var a=o[s];t=n.call(e,a),o.splice(s,1),s--}return t}),\"function\"==typeof i.formatArgs&&(o=i.formatArgs.apply(e,o));var c=n.log||i.log||console.log.bind(console);c.apply(e,o)}t.enabled=!1,n.enabled=!0;var a=i.enabled(e)?n:t;return a.namespace=e,a}function a(e){i.save(e);for(var t=(e||\"\").split(/[\\s,]+/),r=t.length,n=0;r>n;n++)t[n]&&(e=t[n].replace(/\\*/g,\".*?\"),\"-\"===e[0]?i.skips.push(new RegExp(\"^\"+e.substr(1)+\"$\")):i.names.push(new RegExp(\"^\"+e+\"$\")))}function o(){i.enable(\"\")}function s(e){var t,r;for(t=0,r=i.skips.length;r>t;t++)if(i.skips[t].test(e))return!1;for(t=0,r=i.names.length;r>t;t++)if(i.names[t].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}i=t.exports=n,i.coerce=c,i.disable=o,i.enable=a,i.enabled=s,i.humanize=e(\"ms\"),i.names=[],i.skips=[],i.formatters={};var u,l=0},{ms:7}],4:[function(e,t){\"use strict\";function i(e){if(null===e||void 0===e)throw new TypeError(\"Sources cannot be null or undefined\");return Object(e)}function r(e,t,i){var r=t[i];if(void 0!==r&&null!==r){if(o.call(e,i)&&(void 0===e[i]||null===e[i]))throw new TypeError(\"Cannot convert undefined or null to object (\"+i+\")\");e[i]=o.call(e,i)&&a(r)?n(Object(e[i]),t[i]):r}}function n(e,t){if(e===t)return e;t=Object(t);for(var i in t)o.call(t,i)&&r(e,t,i);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(t),a=0;a<n.length;a++)s.call(t,n[a])&&r(e,t,n[a]);return e}var a=e(\"is-obj\"),o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;t.exports=function(e){e=i(e);for(var t=1;t<arguments.length;t++)n(e,arguments[t]);return e}},{\"is-obj\":6}],5:[function(){!function(t,i,r,n){\"use strict\";function a(e,t){for(var i=0,r=e.length;r>i;i++)v(e[i],t)}function o(e){for(var t,i=0,r=e.length;r>i;i++)t=e[i],b(t,P[c(t)])}function s(e){return function(t){nt(t)&&(v(t,e),a(t.querySelectorAll(F),e))}}function c(e){var t=st.call(e,\"is\"),i=e.nodeName.toUpperCase(),r=V.call(U,t?k+t.toUpperCase():z+i);return t&&r>-1&&!u(i,t)?-1:r}function u(e,t){return-1<F.indexOf(e+'[is=\"'+t+'\"]')}function l(e){var t=e.currentTarget,i=e.attrChange,r=e.attrName,n=e.target;vt&&(!n||n===t)&&t.attributeChangedCallback&&\"style\"!==r&&e.prevValue!==e.newValue&&t.attributeChangedCallback(r,i===e[S]?null:e.prevValue,i===e[I]?null:e.newValue)}function h(e){var t=s(e);return function(e){y.push(t,e.target)}}function d(e){gt&&(gt=!1,e.currentTarget.removeEventListener(_,d)),a((e.target||i).querySelectorAll(F),e.detail===N?N:L),rt&&m()}function p(e,t){var i=this;ct.call(i,e,t),M.call(i,{target:i})}function f(e,t){et(e,t),w?w.observe(e,ht):(mt&&(e.setAttribute=p,e[T]=x(e),e.addEventListener(O,M)),e.addEventListener(j,l)),e.createdCallback&&vt&&(e.created=!0,e.createdCallback(),e.created=!1)}function m(){for(var e,t=0,i=at.length;i>t;t++)e=at[t],G.contains(e)||(i--,at.splice(t--,1),v(e,N))}function g(e){throw new Error(\"A \"+e+\" type is already registered\")}function v(e,t){var i,r=c(e);r>-1&&(E(e,P[r]),r=0,t!==L||e[L]?t===N&&!e[N]&&(e[L]=!1,e[N]=!0,r=1):(e[N]=!1,e[L]=!0,r=1,rt&&V.call(at,e)<0&&at.push(e)),r&&(i=e[t+\"Callback\"])&&i.call(e))}if(!(n in i)){var y,M,A,x,w,E,b,T=\"__\"+n+(1e5*Math.random()>>0),L=\"attached\",N=\"detached\",D=\"extends\",S=\"ADDITION\",C=\"MODIFICATION\",I=\"REMOVAL\",j=\"DOMAttrModified\",_=\"DOMContentLoaded\",O=\"DOMSubtreeModified\",z=\"<\",k=\"=\",R=/^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,B=[\"ANNOTATION-XML\",\"COLOR-PROFILE\",\"FONT-FACE\",\"FONT-FACE-SRC\",\"FONT-FACE-URI\",\"FONT-FACE-FORMAT\",\"FONT-FACE-NAME\",\"MISSING-GLYPH\"],U=[],P=[],F=\"\",G=i.documentElement,V=U.indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},Q=r.prototype,Y=Q.hasOwnProperty,H=Q.isPrototypeOf,W=r.defineProperty,X=r.getOwnPropertyDescriptor,q=r.getOwnPropertyNames,Z=r.getPrototypeOf,K=r.setPrototypeOf,J=!!r.__proto__,$=r.create||function yt(e){return e?(yt.prototype=e,new yt):this},et=K||(J?function(e,t){return e.__proto__=t,e}:q&&X?function(){function e(e,t){for(var i,r=q(t),n=0,a=r.length;a>n;n++)i=r[n],Y.call(e,i)||W(e,i,X(t,i))}return function(t,i){do e(t,i);while((i=Z(i))&&!H.call(i,t));return t}}():function(e,t){for(var i in t)e[i]=t[i];return e}),tt=t.MutationObserver||t.WebKitMutationObserver,it=(t.HTMLElement||t.Element||t.Node).prototype,rt=!H.call(it,G),nt=rt?function(e){return 1===e.nodeType}:function(e){return H.call(it,e)},at=rt&&[],ot=it.cloneNode,st=it.getAttribute,ct=it.setAttribute,ut=it.removeAttribute,lt=i.createElement,ht=tt&&{attributes:!0,characterData:!0,attributeOldValue:!0},dt=tt||function(){mt=!1,G.removeEventListener(j,dt)},pt=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,10)},ft=!1,mt=!0,gt=!0,vt=!0;K||J?(E=function(e,t){H.call(t,e)||f(e,t)},b=f):(E=function(e,t){e[T]||(e[T]=r(!0),f(e,t))},b=E),rt?(mt=!1,function(){var t=X(it,\"addEventListener\"),i=t.value,r=function(e){var t=new CustomEvent(j,{bubbles:!0});t.attrName=e,t.prevValue=st.call(this,e),t.newValue=null,t[I]=t.attrChange=2,ut.call(this,e),this.dispatchEvent(t)},n=function(t,i){var r=this.hasAttribute(t),n=r&&st.call(this,t);e=new CustomEvent(j,{bubbles:!0}),ct.call(this,t,i),e.attrName=t,e.prevValue=r?n:null,e.newValue=i,r?e[C]=e.attrChange=1:e[S]=e.attrChange=0,this.dispatchEvent(e)},a=function(e){var t,i=e.currentTarget,r=i[T],n=e.propertyName;r.hasOwnProperty(n)&&(r=r[n],t=new CustomEvent(j,{bubbles:!0}),t.attrName=r.name,t.prevValue=r.value||null,t.newValue=r.value=i[n]||null,null==t.prevValue?t[S]=t.attrChange=0:t[C]=t.attrChange=1,i.dispatchEvent(t))};t.value=function(e,t,o){e===j&&this.attributeChangedCallback&&this.setAttribute!==n&&(this[T]={className:{name:\"class\",value:this.className}},this.setAttribute=n,this.removeAttribute=r,i.call(this,\"propertychange\",a)),i.call(this,e,t,o)},W(it,\"addEventListener\",t)}()):tt||(G.addEventListener(j,dt),G.setAttribute(T,1),G.removeAttribute(T),mt&&(M=function(e){var t,i,r,n=this;if(n===e.target){t=n[T],n[T]=i=x(n);for(r in i){if(!(r in t))return A(0,n,r,t[r],i[r],S);if(i[r]!==t[r])return A(1,n,r,t[r],i[r],C)}for(r in t)if(!(r in i))return A(2,n,r,t[r],i[r],I)}},A=function(e,t,i,r,n,a){var o={attrChange:e,currentTarget:t,attrName:i,prevValue:r,newValue:n};o[a]=e,l(o)},x=function(e){for(var t,i,r={},n=e.attributes,a=0,o=n.length;o>a;a++)t=n[a],i=t.name,\"setAttribute\"!==i&&(r[i]=t.value);return r})),i[n]=function(e,t){if(r=e.toUpperCase(),ft||(ft=!0,tt?(w=function(e,t){function i(e,t){for(var i=0,r=e.length;r>i;t(e[i++]));}return new tt(function(r){for(var n,a,o,s=0,c=r.length;c>s;s++)n=r[s],\"childList\"===n.type?(i(n.addedNodes,e),i(n.removedNodes,t)):(a=n.target,vt&&a.attributeChangedCallback&&\"style\"!==n.attributeName&&(o=st.call(a,n.attributeName),o!==n.oldValue&&a.attributeChangedCallback(n.attributeName,n.oldValue,o)))})}(s(L),s(N)),w.observe(i,{childList:!0,subtree:!0})):(y=[],pt(function v(){for(;y.length;)y.shift().call(null,y.shift());pt(v)}),i.addEventListener(\"DOMNodeInserted\",h(L)),i.addEventListener(\"DOMNodeRemoved\",h(N))),i.addEventListener(_,d),i.addEventListener(\"readystatechange\",d),i.createElement=function(e,t){var r=lt.apply(i,arguments),n=\"\"+e,a=V.call(U,(t?k:z)+(t||n).toUpperCase()),o=a>-1;return t&&(r.setAttribute(\"is\",t=t.toLowerCase()),o&&(o=u(n.toUpperCase(),t))),vt=!i.createElement.innerHTMLHelper,o&&b(r,P[a]),r},it.cloneNode=function(e){var t=ot.call(this,!!e),i=c(t);return i>-1&&b(t,P[i]),e&&o(t.querySelectorAll(F)),t}),-2<V.call(U,k+r)+V.call(U,z+r)&&g(e),!R.test(r)||-1<V.call(B,r))throw new Error(\"The type \"+e+\" is invalid\");var r,n,l=function(){return f?i.createElement(m,r):i.createElement(m)},p=t||Q,f=Y.call(p,D),m=f?t[D].toUpperCase():r;return f&&-1<V.call(U,z+m)&&g(m),n=U.push((f?k:z)+r)-1,F=F.concat(F.length?\",\":\"\",f?m+'[is=\"'+e.toLowerCase()+'\"]':m),l.prototype=P[n]=Y.call(p,\"prototype\")?p.prototype:$(it),a(i.querySelectorAll(F),L),l}}}(window,document,Object,\"registerElement\")},{}],6:[function(e,t){\"use strict\";t.exports=function(e){var t=typeof e;return null!==e&&(\"object\"===t||\"function\"===t)}},{}],7:[function(e,t){function i(e){if(e=\"\"+e,!(e.length>1e4)){var t=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]),r=(t[2]||\"ms\").toLowerCase();switch(r){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return i*l;case\"days\":case\"day\":case\"d\":return i*u;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return i*c;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return i*s;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return i*o;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return i}}}}function r(e){return e>=u?Math.round(e/u)+\"d\":e>=c?Math.round(e/c)+\"h\":e>=s?Math.round(e/s)+\"m\":e>=o?Math.round(e/o)+\"s\":e+\"ms\"}function n(e){return a(e,u,\"day\")||a(e,c,\"hour\")||a(e,s,\"minute\")||a(e,o,\"second\")||e+\" ms\"}function a(e,t,i){return t>e?void 0:1.5*t>e?Math.floor(e/t)+\" \"+i:Math.ceil(e/t)+\" \"+i+\"s\"}var o=1e3,s=60*o,c=60*s,u=24*c,l=365.25*u;t.exports=function(e,t){return t=t||{},\"string\"==typeof e?i(e):t.long?n(e):r(e)}},{}],8:[function(e,t){\"use strict\";function i(e){if(null===e||void 0===e)throw new TypeError(\"Object.assign cannot be called with null or undefined\");return Object(e)}function r(){try{if(!Object.assign)return!1;var e=new String(\"abc\");if(e[5]=\"de\",\"5\"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;10>i;i++)t[\"_\"+String.fromCharCode(i)]=i;var r=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if(\"0123456789\"!==r.join(\"\"))return!1;var n={};return\"abcdefghijklmnopqrst\".split(\"\").forEach(function(e){n[e]=e}),\"abcdefghijklmnopqrst\"!==Object.keys(Object.assign({},n)).join(\"\")?!1:!0}catch(a){return!1}}var n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;t.exports=r()?Object.assign:function(e){for(var t,r,o=i(e),s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var c in t)n.call(t,c)&&(o[c]=t[c]);if(Object.getOwnPropertySymbols){r=Object.getOwnPropertySymbols(t);for(var u=0;u<r.length;u++)a.call(t,r[u])&&(o[r[u]]=t[r[u]])}}return o}},{}],9:[function(e,t){(function(e){var i=e.performance||{},r=function(){for(var e=[\"now\",\"webkitNow\",\"msNow\",\"mozNow\",\"oNow\"];e.length;){var t=e.shift();if(t in i)return i[t].bind(i)}var r=Date.now||function(){return(new Date).getTime()},n=(i.timing||{}).navigationStart||r();return function(){return r()-n}}();r.performanceNow=i.now,r.noConflict=function(){i.now=r.performanceNow},r.conflict=function(){i.now=r},r.conflict(),t.exports=r}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],10:[function(e,t){function i(){h&&u&&(h=!1,u.length?l=u.concat(l):d=-1,l.length&&r())}function r(){if(!h){var e=o(i);h=!0;for(var t=l.length;t;){for(u=l,l=[];++d<t;)u&&u[d].run();d=-1,t=l.length}u=null,h=!1,s(e)}}function n(e,t){this.fun=e,this.array=t}function a(){}var o,s,c=t.exports={};!function(){try{o=setTimeout}catch(e){o=function(){throw new Error(\"setTimeout is not defined\")}}try{s=clearTimeout}catch(e){s=function(){throw new Error(\"clearTimeout is not defined\")}}}();var u,l=[],h=!1,d=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new n(e,t)),1!==l.length||h||o(r,0)},n.prototype.run=function(){this.fun.apply(null,this.array)},c.title=\"browser\",c.browser=!0,c.env={},c.argv=[],c.version=\"\",c.versions={},c.on=a,c.addListener=a,c.once=a,c.off=a,c.removeListener=a,c.removeAllListeners=a,c.emit=a,c.binding=function(){throw new Error(\"process.binding is not supported\")},c.cwd=function(){return\"/\"},c.chdir=function(){throw new Error(\"process.chdir is not supported\")},c.umask=function(){return 0}},{}],11:[function(e,t){!function(e){function i(e,t){return function(){e.apply(t,arguments)}}function r(e){if(\"object\"!=typeof this)throw new TypeError(\"Promises must be constructed via new\");if(\"function\"!=typeof e)throw new TypeError(\"not a function\");this._state=null,this._value=null,this._deferreds=[],u(e,i(a,this),i(o,this))}function n(e){var t=this;return null===this._state?(this._deferreds.push(e),void 0):(h(function(){var i=t._state?e.onFulfilled:e.onRejected;if(null===i)return(t._state?e.resolve:e.reject)(t._value),void 0;var r;try{r=i(t._value)}catch(n){return e.reject(n),void 0}e.resolve(r)}),void 0)}function a(e){try{if(e===this)throw new TypeError(\"A promise cannot be resolved with itself.\");if(e&&(\"object\"==typeof e||\"function\"==typeof e)){var t=e.then;if(\"function\"==typeof t)return u(i(t,e),i(a,this),i(o,this)),void 0}this._state=!0,this._value=e,s.call(this)}catch(r){o.call(this,r)}}function o(e){this._state=!1,this._value=e,s.call(this)}function s(){for(var e=0,t=this._deferreds.length;t>e;e++)n.call(this,this._deferreds[e]);this._deferreds=null}function c(e,t,i,r){this.onFulfilled=\"function\"==typeof e?e:null,this.onRejected=\"function\"==typeof t?t:null,this.resolve=i,this.reject=r}function u(e,t,i){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,i(e))})}catch(n){if(r)return;r=!0,i(n)}}var l=setTimeout,h=\"function\"==typeof setImmediate&&setImmediate||function(e){l(e,1)},d=Array.isArray||function(e){return\"[object Array]\"===Object.prototype.toString.call(e)};r.prototype[\"catch\"]=function(e){return this.then(null,e)},r.prototype.then=function(e,t){var i=this;return new r(function(r,a){n.call(i,new c(e,t,r,a))})},r.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&d(arguments[0])?arguments[0]:arguments);return new r(function(t,i){function r(a,o){try{if(o&&(\"object\"==typeof o||\"function\"==typeof o)){var s=o.then;if(\"function\"==typeof s)return s.call(o,function(e){r(a,e)},i),void 0}e[a]=o,0===--n&&t(e)}catch(c){i(c)}}if(0===e.length)return t([]);for(var n=e.length,a=0;a<e.length;a++)r(a,e[a])})},r.resolve=function(e){return e&&\"object\"==typeof e&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,i){i(e)})},r.race=function(e){return new r(function(t,i){for(var r=0,n=e.length;n>r;r++)e[r].then(t,i)})},r._setImmediateFn=function(e){h=e},\"undefined\"!=typeof t&&t.exports?t.exports=r:e.Promise||(e.Promise=r)}(this)},{}],12:[function(e,t){function i(e){var t=function(e){return e.trim()},i={};return r(e).map(t).filter(Boolean).forEach(function(e){var t=e.indexOf(\":\"),r=e.substr(0,t).trim(),n=e.substr(t+1).trim();i[r]=n}),i}function r(e){for(var t,i=[],r=0,n=\";\",a=/url\\([^\\)]+$/,o=\"\";r<e.length;)t=e.indexOf(n,r),-1===t&&(t=e.length),o+=e.substring(r,t),a.test(o)?(o+=\";\",r=t+1):(i.push(o),o=\"\",r=t+1);return i}function n(e){return Object.keys(e).map(function(t){return t+\":\"+e[t]}).join(\";\")}function a(e){return n(i(e))}t.exports.parse=i,t.exports.stringify=n,t.exports.normalize=a},{}],13:[function(){THREE.BlendCharacter=function(){this.weightSchedule=[],this.warpSchedule=[],this.load=function(e,t){var i=this,r=new THREE.ObjectLoader;r.load(e,function(r){if(r.traverse(function(e){e instanceof THREE.SkinnedMesh&&(i.skinnedMesh=e)}),THREE.SkinnedMesh.call(i,i.skinnedMesh.geometry,i.skinnedMesh.material),void 0==i.skinnedMesh)return console.log(\"unable to find skinned mesh in \"+e),void 0;i.material.skinning=!0,i.mixer=new THREE.AnimationMixer(i),i.mixer=i.mixer;for(var n=0;n<i.geometry.animations.length;++n)i.mixer.clipAction(i.geometry.animations[n]);void 0!==t&&t()})},this.update=function(e){this.mixer.update(e)},this.play=function(e,t){return this.mixer.clipAction(e).setEffectiveWeight(t).play()},this.crossfade=function(e,t,i){this.mixer.stopAllAction();var r=this.play(e,1),n=this.play(t,1);r.crossFadeTo(n,i,!1)},this.warp=function(e,t,i){this.mixer.stopAllAction();var r=this.play(e,1),n=this.play(t,1);r.crossFadeTo(n,i,!0)},this.applyWeight=function(e,t){this.mixer.clipAction(e).setEffectiveWeight(t)},this.getWeight=function(e){return this.mixer.clipAction(e).getEffectiveWeight()},this.pauseAll=function(){this.mixer.timeScale=0},this.unPauseAll=function(){this.mixer.timeScale=1},this.stopAll=function(){this.mixer.stopAllAction()},this.showModel=function(e){this.visible=e}},THREE.BlendCharacter.prototype=Object.create(THREE.SkinnedMesh.prototype),THREE.BlendCharacter.prototype.constructor=THREE.BlendCharacter,THREE.BlendCharacter.prototype.getForward=function(){var e=new THREE.Vector3;return function(){return e.set(-this.matrix.elements[8],-this.matrix.elements[9],-this.matrix.elements[10]),e}}},{}],14:[function(){THREE.ColladaLoader=function(){function e(e,i,r,n){var a=0;if(document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState?0===o.status||200===o.status?o.response?(Bt=i,t(o.response,void 0,e)):n?n({type:\"error\",url:e}):console.error(\"ColladaLoader: Empty or non-existing file (\"+e+\")\"):n?n({type:\"error\",url:e}):console.error(\"ColladaLoader: Couldn't load \\\"\"+e+'\" ('+o.status+\")\"):3===o.readyState&&r&&(0===a&&(a=o.getResponseHeader(\"Content-Length\")),r({total:a,loaded:o.responseText.length}))},o.open(\"GET\",e,!0),o.send(null)}else alert(\"Don't know how to parse XML!\")}function t(e,t,i){if(kt=(new DOMParser).parseFromString(e,\"text/xml\"),t=t||Bt,void 0!==i){var c=i.split(\"/\");c.pop(),_t=(c.length<1?\".\":c.join(\"/\"))+\"/\"}r(),At(),Pt=n(\"library_images image\",L,\"image\"),Qt=n(\"library_materials material\",H,\"material\"),Yt=n(\"library_effects effect\",K,\"effect\"),Vt=n(\"library_geometries geometry\",k,\"geometry\"),Ht=n(\"library_cameras camera\",rt,\"camera\"),Wt=n(\"library_lights light\",at,\"light\"),Gt=n(\"library_controllers controller\",N,\"controller\"),Ft=n(\"library_animations animation\",$,\"animation\"),It=n(\"library_visual_scenes visual_scene\",C,\"visual_scene\"),jt=n(\"library_kinematics_models kinematics_model\",st,\"kinematics_model\"),Ot=[],zt=[],Nt=a(),Rt=new THREE.Group;for(var u=0;u<Nt.nodes.length;u++)Rt.add(v(Nt.nodes[u]));Rt.scale.multiplyScalar(Zt),s(),Dt=o(),g();var l={scene:Rt,morphs:Ot,skins:zt,animations:St,kinematics:Ct,dae:{images:Pt,materials:Qt,cameras:Ht,lights:Wt,effects:Yt,geometries:Vt,controllers:Gt,animations:Ft,visualScenes:It,visualScene:Nt,scene:Nt,kinematicsModels:jt,kinematicsModel:Dt}};return t&&t(l),l}function i(e){Xt=e}function r(){var e=kt.querySelectorAll(\"asset\"),t=e[0];if(t&&t.childNodes)for(var i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];switch(r.nodeName){case\"unit\":var n=r.getAttribute(\"meter\");n&&(Zt=parseFloat(n));break;case\"up_axis\":Kt=r.textContent.charAt(0)}}}function n(e,t,i){for(var r=kt.querySelectorAll(e),n={},a=0,o=r.length,s=0;o>s;s++){var c=r[s],u=(new t).parse(c);u.id&&0!==u.id.length||(u.id=i+a++),n[u.id]=u}return n}function a(){var e=kt.querySelectorAll(\"scene instance_visual_scene\")[0];if(e){var t=e.getAttribute(\"url\").replace(/^#/,\"\");return It[t.length>0?t:\"visual_scene0\"]}return null}function o(){var e=kt.querySelectorAll(\"instance_kinematics_model\")[0];if(e){var t=e.getAttribute(\"url\").replace(/^#/,\"\");return jt[t.length>0?t:\"kinematics_model0\"]}return null}function s(){St=[],c(Rt)}function c(e){var t=Nt.getChildById(e.colladaId,!0),i=null;if(t&&t.keys){i={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:\"animation_\"+e.name,length:0},St.push(i);for(var r=0,n=t.keys.length;n>r;r++)i.length=Math.max(i.length,t.keys[r].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(var r=0,n=e.children.length;n>r;r++)for(var a=c(e.children[r]),o=0,s=a.hierarchy.length;s>o;o++)i.hierarchy.push({keys:[],sids:[]});return i}function u(){var e,t=1e6,i=-t,r=0;for(var n in Ft){var a=Ft[n];e=e||a.id;for(var o=0;o<a.sampler.length;o++){var s=a.sampler[o];s.create(),t=Math.min(t,s.startTime),i=Math.max(i,s.endTime),r=Math.max(r,s.input.length)}}return{start:t,end:i,frames:r,ID:e}}function l(e,t){var i=t instanceof _?Gt[t.url]:t;if(!i||!i.morph)return console.log(\"could not find morph controller!\"),void 0;for(var r=i.morph,n=0;n<r.targets.length;n++){var a=r.targets[n],o=Vt[a];if(o.mesh&&o.mesh.primitives&&o.mesh.primitives.length){var s=o.mesh.primitives[0].geometry;s.vertices.length===e.vertices.length&&e.morphTargets.push({name:\"target_1\",vertices:s.vertices})}}e.morphTargets.push({name:\"target_Z\",vertices:e.vertices})}function h(e,t,i,r){if(e.world=e.world||new THREE.Matrix4,e.localworld=e.localworld||new THREE.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var n=e.channels[0],a=n.sampler.output[i];a instanceof THREE.Matrix4&&(e.world.copy(a),e.localworld.copy(a),0===i&&e.matrix.copy(a))}r&&e.world.multiplyMatrices(r,e.world),t.push(e);for(var o=0;o<e.nodes.length;o++)h(e.nodes[o],t,i,e.world)}function d(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=-1;if(\"JOINT\"==r.type){for(var a=0;a<t.joints.length;a++)if(r.sid===t.joints[a]){n=a;break}if(n>=0){var o=t.invBindMatrices[n];r.invBindMatrix=o,r.skinningMatrix=new THREE.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,o),r.animatrix=new THREE.Matrix4,r.animatrix.copy(r.localworld),r.weights=[];for(var a=0;a<t.weights.length;a++)for(var s=0;s<t.weights[a].length;s++){var c=t.weights[a][s];c.joint===n&&r.weights.push(c)}}else console.warn(\"ColladaLoader: Could not find joint '\"+r.sid+\"'.\"),r.skinningMatrix=new THREE.Matrix4,r.weights=[]}}}function p(e){var t=[],i=function(e,t,r){var n={};n.name=t.sid,n.parent=e,n.matrix=t.matrix;var a=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];n.matrix.decompose(a[0],a[1],a[2]),n.pos=[a[0].x,a[0].y,a[0].z],n.scl=[a[2].x,a[2].y,a[2].z],n.rotq=[a[1].x,a[1].y,a[1].z,a[1].w],r.push(n);for(var o in t.nodes)i(t.sid,t.nodes[o],r)};return i(-1,e,t),t}function f(e,t,i){var r=[];h(t,r,-1),d(r,i.skin);for(var n=new THREE.Vector3,a=[],o=0;o<e.vertices.length;o++)a.push(new THREE.Vector3);for(o=0;o<r.length;o++)if(\"JOINT\"==r[o].type)for(var s=0;s<r[o].weights.length;s++){var c=r[o].weights[s],u=c.index,l=c.weight,p=e.vertices[u],f=a[u];n.x=p.x,n.y=p.y,n.z=p.z,n.applyMatrix4(r[o].skinningMatrix),f.x+=n.x*l,f.y+=n.y*l,f.z+=n.z*l}for(var o=0;o<e.vertices.length;o++)e.vertices[o]=a[o]}function m(e,t,i){var r=Gt[t.url];if(i=void 0!==i?i:40,!r||!r.skin)return console.log(\"ColladaLoader: Could not find skin controller.\"),void 0;if(!t.skeleton||!t.skeleton.length)return console.log(\"ColladaLoader: Could not find the skeleton for the skin. \"),void 0;for(var n=u(),a=Nt.getChildById(t.skeleton[0],!0)||Nt.getChildBySid(t.skeleton[0],!0),o=p(a),s=r.skin.joints,c=[],l=0;l<s.length;l++)for(var m=0;m<o.length;m++)o[m].name===s[l]&&(c[l]=o[m]);for(var l=0;l<c.length;l++)for(var m=0;m<c.length;m++)c[l].parent===c[m].name&&(c[l].parent=m);{var l,m,g;new THREE.Vector3}for(l=0;l<e.vertices.length;l++)e.vertices[l].applyMatrix4(r.skin.bindShapeMatrix);for(var v=[],y=[],M=r.skin.weights,l=0;l<M.length;l++){var A=new THREE.Vector4(M[l][0]?M[l][0].joint:0,M[l][1]?M[l][1].joint:0,M[l][2]?M[l][2].joint:0,M[l][3]?M[l][3].joint:0),g=new THREE.Vector4(M[l][0]?M[l][0].weight:0,M[l][1]?M[l][1].weight:0,M[l][2]?M[l][2].weight:0,M[l][3]?M[l][3].weight:0);v.push(A),y.push(g)}e.skinIndices=v,e.skinWeights=y,e.bones=c;for(var x={name:n.ID,fps:30,length:n.frames/30,hierarchy:[]},m=0;m<c.length;m++)x.hierarchy.push({parent:c[m].parent,name:c[m].name,keys:[]});for(console.log(\"ColladaLoader:\",n.ID+\" has \"+c.length+\" bones.\"),f(e,a,r),i=0;i<n.frames;i++){var w=[];h(a,w,i),d(w,r.skin);for(var l=0;l<w.length;l++)for(var m=0;m<x.hierarchy.length;m++)if(x.hierarchy[m].name===w[l].sid){var E={};E.time=i/30,E.matrix=w[l].animatrix,0===i&&(w[l].matrix=E.matrix);var b=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];E.matrix.decompose(b[0],b[1],b[2]),E.pos=[b[0].x,b[0].y,b[0].z],E.scl=[b[2].x,b[2].y,b[2].z],E.rot=b[1],x.hierarchy[m].keys.push(E)}e.animation=x}}function g(){if(Dt&&0===Dt.joints.length)return Ct=void 0,void 0;var e={},t=function(t,i){var r=i.getAttribute(\"id\"),n=Nt.getChildById(r,!0),a=Dt.joints[t];Rt.traverse(function(i){i.colladaId==r&&(e[t]={node:i,transforms:n.transforms,joint:a,position:a.zeroPosition})})};Ct={joints:Dt&&Dt.joints,getJointValue:function(t){var i=e[t];return i?i.position:(console.log(\"getJointValue: joint \"+t+\" doesn't exist\"),void 0)},setJointValue:function(t,i){var n=e[t];if(n){var a=n.joint;if(i>a.limits.max||i<a.limits.min)console.log(\"setJointValue: joint \"+t+\" value \"+i+\" outside of limits (min: \"+a.limits.min+\", max: \"+a.limits.max+\")\");else if(a.static)console.log(\"setJointValue: joint \"+t+\" is static\");else{var o=n.node,s=a.axis,c=n.transforms,u=new THREE.Matrix4;for(r=0;r<c.length;r++){var l=c[r];if(l.sid&&-1!==l.sid.indexOf(\"joint\"+t))switch(a.type){case\"revolute\":u.multiply(h.makeRotationAxis(s,THREE.Math.degToRad(i)));break;case\"prismatic\":u.multiply(h.makeTranslation(s.x*i,s.y*i,s.z*i));break;default:console.warn(\"setJointValue: unknown joint type: \"+a.type)}else{var h=new THREE.Matrix4;switch(l.type){case\"matrix\":u.multiply(l.obj);break;case\"translate\":u.multiply(h.makeTranslation(l.obj.x,l.obj.y,l.obj.z));break;case\"rotate\":u.multiply(h.makeRotationAxis(l.obj,l.angle))}}}var d=u.elements,p=Array.prototype.slice.call(d),f=[p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]];o.matrix.set.apply(o.matrix,f),o.matrix.decompose(o.position,o.quaternion,o.scale)}}else console.log(\"setJointValue: joint \"+t+\" doesn't exist\")}};var i=kt.querySelector(\"scene instance_kinematics_scene\");if(i)for(var r=0;r<i.childNodes.length;r++){var n=i.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case\"bind_joint_axis\":var a=n.getAttribute(\"target\").split(\"/\").pop(),o=n.querySelector(\"axis param\").textContent,s=parseInt(o.split(\"joint\").pop().split(\".\")[0]),c=kt.querySelector('[sid=\"'+a+'\"]');if(c){var u=c.parentElement;t(s,u)}}}}function v(e){var t,i,r,n,a=new THREE.Object3D,o=!1;for(r=0;r<e.controllers.length;r++){var s=Gt[e.controllers[r].url];switch(s.type){case\"skin\":if(Vt[s.skin.source]){var c=new z;c.url=s.skin.source,c.instance_material=e.controllers[r].instance_material,e.geometries.push(c),o=!0,t=e.controllers[r]}else if(Gt[s.skin.source]){var u=Gt[s.skin.source];if(i=u,u.morph&&Vt[u.morph.source]){var c=new z;c.url=u.morph.source,c.instance_material=e.controllers[r].instance_material,e.geometries.push(c)}}break;case\"morph\":if(Vt[s.morph.source]){var c=new z;c.url=s.morph.source,c.instance_material=e.controllers[r].instance_material,e.geometries.push(c),i=e.controllers[r]}console.log(\"ColladaLoader: Morph-controller partially supported.\")}}var h={};for(r=0;r<e.geometries.length;r++){var d,p=e.geometries[r],f=p.instance_material,g=Vt[p.url],y={},M=[],A=0;if(g){if(!g.mesh||!g.mesh.primitives)continue;if(0===a.name.length&&(a.name=g.id),f)for(n=0;n<f.length;n++){var x=f[n],w=Qt[x.target],E=w.instance_effect.url,b=Yt[E].shader,T=b.material;if(g.doubleSided){if(!(x.symbol in h)){var L=T.clone();L.side=THREE.DoubleSide,h[x.symbol]=L}T=h[x.symbol]}T.opacity=T.opacity?T.opacity:1,y[x.symbol]=A,M.push(T),d=T,d.name=null===w.name||\"\"===w.name?w.id:w.name,A++}var N,D=d||new THREE.MeshLambertMaterial({color:14540253,side:g.doubleSided?THREE.DoubleSide:THREE.FrontSide}),S=g.mesh.geometry3js;if(A>1)for(D=new THREE.MultiMaterial(M),n=0;n<S.faces.length;n++){var C=S.faces[n];C.materialIndex=y[C.daeMaterial]}void 0!==t?(m(S,t),S.morphTargets.length>0?(D.morphTargets=!0,D.skinning=!1):(D.morphTargets=!1,D.skinning=!0),N=new THREE.SkinnedMesh(S,D,!1),N.name=\"skin_\"+zt.length,zt.push(N)):void 0!==i?(l(S,i),D.morphTargets=!0,N=new THREE.Mesh(S,D),N.name=\"morph_\"+Ot.length,Ot.push(N)):N=S.isLineStrip===!0?new THREE.Line(S):new THREE.Mesh(S,D),a.add(N)}}for(r=0;r<e.cameras.length;r++){var I=e.cameras[r],j=Ht[I.url],_=new THREE.PerspectiveCamera(j.yfov,parseFloat(j.aspect_ratio),parseFloat(j.znear),parseFloat(j.zfar));a.add(_)}for(r=0;r<e.lights.length;r++){var O=null,k=e.lights[r],R=Wt[k.url];if(R&&R.technique){var B=R.color.getHex(),U=R.intensity,P=R.distance,F=R.falloff_angle;switch(R.technique){case\"directional\":O=new THREE.DirectionalLight(B,U,P),O.position.set(0,0,1);break;case\"point\":O=new THREE.PointLight(B,U,P);break;case\"spot\":O=new THREE.SpotLight(B,U,P,F),O.position.set(0,0,1);break;case\"ambient\":O=new THREE.AmbientLight(B)}}O&&a.add(O)}if(a.name=e.name||e.id||\"\",a.colladaId=e.id||\"\",a.layer=e.layer||\"\",a.matrix=e.matrix,a.matrix.decompose(a.position,a.quaternion,a.scale),qt.centerGeometry&&a.geometry){var G=a.geometry.center();G.multiply(a.scale),G.applyQuaternion(a.quaternion),a.position.sub(G)}for(r=0;r<e.nodes.length;r++)a.add(v(e.nodes[r],e));return a}function y(e){for(var t=kt.querySelectorAll(\"library_nodes node\"),i=0;i<t.length;i++){var r=t[i].attributes.getNamedItem(\"id\");if(r&&r.value===e)return t[i]}return void 0}function M(e){var t=[],i=1e6,r=-1e6;for(var n in Ft)for(var a=Ft[n],o=0;o<a.channel.length;o++){var s=a.channel[o],c=a.sampler[o],n=s.target.split(\"/\")[0];n==e.id&&(c.create(),s.sampler=c,i=Math.min(i,c.startTime),r=Math.max(r,c.endTime),t.push(s))}return t.length&&(e.startTime=i,e.endTime=r),t}function A(e){if(e.channels&&e.channels.length){for(var t=[],i=[],r=0,n=e.channels.length;n>r;r++){var a,o=e.channels[r],s=o.fullSid,c=o.sampler,u=c.input,l=e.getTransformBySid(o.sid);\nif(o.arrIndices){a=[];for(var h=0,d=o.arrIndices.length;d>h;h++)a[h]=Tt(o.arrIndices[h])}else a=Lt(o.member);if(l){-1===i.indexOf(s)&&i.push(s);for(var h=0,d=u.length;d>h;h++){var p=u[h],f=c.getData(l.type,h,a),m=x(t,p);if(!m){m=new it(p);var g=w(t,p);t.splice(-1===g?t.length:g,0,m)}m.addTarget(s,l,a,f)}}else console.log('Could not find transform \"'+o.sid+'\" in node '+e.id)}for(var r=0;r<i.length;r++)for(var v=i[r],h=0;h<t.length;h++){var m=t[h];m.hasTarget(v)||E(t,m,h,v)}e.keys=t,e.sids=i}}function x(e,t){for(var i=null,r=0,n=e.length;n>r&&null===i;r++){var a=e[r];if(a.time===t)i=a;else if(a.time>t)break}return i}function w(e,t){for(var i=-1,r=0,n=e.length;n>r&&-1===i;r++){var a=e[r];a.time>=t&&(i=r)}return i}function E(e,t,i,r){var n=T(e,r,i?i-1:0),a=b(e,r,i+1);if(n&&a){var o,s=(t.time-n.time)/(a.time-n.time),c=n.getTarget(r),u=a.getTarget(r).data,l=c.data;if(\"matrix\"===c.type)o=l;else if(l.length){o=[];for(var h=0;h<l.length;++h)o[h]=l[h]+(u[h]-l[h])*s}else o=l+(u-l)*s;t.addTarget(r,c.transform,c.member,o)}}function b(e,t,i){for(;i<e.length;i++){var r=e[i];if(r.hasTarget(t))return r}return null}function T(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var r=e[i];if(r.hasTarget(t))return r}return null}function L(){this.id=\"\",this.init_from=\"\"}function N(){this.id=\"\",this.name=\"\",this.type=\"\",this.skin=null,this.morph=null}function D(){this.method=null,this.source=null,this.targets=null,this.weights=null}function S(){this.source=\"\",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function C(){this.id=\"\",this.name=\"\",this.nodes=[],this.scene=new THREE.Group}function I(){this.id=\"\",this.name=\"\",this.sid=\"\",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function j(){this.sid=\"\",this.type=\"\",this.data=[],this.obj=null}function _(){this.url=\"\",this.skeleton=[],this.instance_material=[]}function O(){this.symbol=\"\",this.target=\"\"}function z(){this.url=\"\",this.instance_material=[]}function k(){this.id=\"\",this.mesh=null}function R(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function B(){this.material=\"\",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function U(){B.call(this),this.vcount=[]}function P(){B.call(this),this.vcount=1}function F(){B.call(this),this.vcount=3}function G(){this.source=\"\",this.count=0,this.stride=0,this.params=[]}function V(){this.input={}}function Q(){this.semantic=\"\",this.offset=0,this.source=\"\",this.set=0}function Y(e){this.id=e,this.type=null}function H(){this.id=\"\",this.name=\"\",this.instance_effect=null}function W(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function X(e,t){this.type=e,this.effect=t,this.material=null}function q(e){this.effect=e,this.init_from=null,this.format=null}function Z(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function K(){this.id=\"\",this.name=\"\",this.shader=null,this.surface={},this.sampler={}}function J(){this.url=\"\"}function $(){this.id=\"\",this.name=\"\",this.source={},this.sampler=[],this.channel=[]}function et(e){this.animation=e,this.source=\"\",this.target=\"\",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function tt(e){this.id=\"\",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function it(e){this.targets=[],this.time=e}function rt(){this.id=\"\",this.name=\"\",this.technique=\"\"}function nt(){this.url=\"\"}function at(){this.id=\"\",this.name=\"\",this.technique=\"\"}function ot(){this.url=\"\"}function st(){this.id=\"\",this.name=\"\",this.joints=[],this.links=[]}function ct(){this.sid=\"\",this.name=\"\",this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type=\"\",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function ut(){this.sid=\"\",this.name=\"\",this.transforms=[],this.attachments=[]}function lt(){this.joint=\"\",this.transforms=[],this.links=[]}function ht(e){var t=e.getAttribute(\"id\");return void 0!=Ut[t]?Ut[t]:(Ut[t]=new Y(t).parse(e),Ut[t])}function dt(e){for(var t=mt(e),i=[],r=0,n=t.length;n>r;r++)i.push(\"true\"===t[r]||\"1\"===t[r]?!0:!1);return i}function pt(e){for(var t=mt(e),i=[],r=0,n=t.length;n>r;r++)i.push(parseFloat(t[r]));return i}function ft(e){for(var t=mt(e),i=[],r=0,n=t.length;n>r;r++)i.push(parseInt(t[r],10));return i}function mt(e){return e.length>0?gt(e).split(/\\s+/):[]}function gt(e){return e.replace(/^\\s+/,\"\").replace(/\\s+$/,\"\")}function vt(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function yt(e,t){var i=new THREE.ImageLoader;i.load(t,function(t){e.image=t,e.needsUpdate=!0})}function Mt(e,t){e.doubleSided=!1;var i=t.querySelectorAll(\"extra double_sided\")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function At(){if(qt.convertUpAxis!==!0||Kt===qt.upAxis)Jt=null;else switch(Kt){case\"X\":Jt=\"Y\"===qt.upAxis?\"XtoY\":\"XtoZ\";break;case\"Y\":Jt=\"X\"===qt.upAxis?\"YtoX\":\"YtoZ\";break;case\"Z\":Jt=\"X\"===qt.upAxis?\"ZtoX\":\"ZtoY\"}}function xt(e,t){if(qt.convertUpAxis===!0&&Kt!==qt.upAxis)switch(Jt){case\"XtoY\":var i=e[0];e[0]=t*e[1],e[1]=i;break;case\"XtoZ\":var i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case\"YtoX\":var i=e[0];e[0]=e[1],e[1]=t*i;break;case\"YtoZ\":var i=e[1];e[1]=t*e[2],e[2]=i;break;case\"ZtoX\":var i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case\"ZtoY\":var i=e[1];e[1]=e[2],e[2]=t*i}}function wt(e,t){if(qt.convertUpAxis!==!0||Kt===qt.upAxis)return t;switch(e){case\"X\":t=\"XtoY\"===Jt?-1*t:t;break;case\"Y\":t=\"YtoZ\"===Jt||\"YtoX\"===Jt?-1*t:t;break;case\"Z\":t=\"ZtoY\"===Jt?-1*t:t}return t}function Et(e,t){var i=[e[t],e[t+1],e[t+2]];return xt(i,-1),new THREE.Vector3(i[0],i[1],i[2])}function bt(e){if(qt.convertUpAxis){var t=[e[0],e[4],e[8]];xt(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],xt(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],xt(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],xt(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],xt(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],xt(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],xt(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return(new THREE.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Tt(e){if(e>-1&&3>e){var t=[\"X\",\"Y\",\"Z\"],i={X:0,Y:1,Z:2};e=Lt(t[e]),e=i[e]}return e}function Lt(e){if(qt.convertUpAxis)switch(e){case\"X\":switch(Jt){case\"XtoY\":case\"XtoZ\":case\"YtoX\":e=\"Y\";break;case\"ZtoX\":e=\"Z\"}break;case\"Y\":switch(Jt){case\"XtoY\":case\"YtoX\":case\"ZtoX\":e=\"X\";break;case\"XtoZ\":case\"YtoZ\":case\"ZtoY\":e=\"Z\"}break;case\"Z\":switch(Jt){case\"XtoZ\":e=\"X\";break;case\"YtoZ\":case\"ZtoX\":case\"ZtoY\":e=\"Y\"}}return e}var Nt,Dt,St,Ct,It,jt,_t,Ot,zt,kt=null,Rt=null,Bt=null,Ut={},Pt={},Ft={},Gt={},Vt={},Qt={},Yt={},Ht={},Wt={},Xt=THREE.SmoothShading,qt={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:\"Y\",defaultEnvMap:null},Zt=1,Kt=\"Y\",Jt=null;return L.prototype.parse=function(e){this.id=e.getAttribute(\"id\");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];\"init_from\"===i.nodeName&&(this.init_from=i.textContent)}return this},N.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.name=e.getAttribute(\"name\"),this.type=\"none\";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case\"skin\":this.skin=(new S).parse(i),this.type=i.nodeName;break;case\"morph\":this.morph=(new D).parse(i),this.type=i.nodeName}}return this},D.prototype.parse=function(e){var t,i={},r=[];for(this.method=e.getAttribute(\"method\"),this.source=e.getAttribute(\"source\").replace(/^#/,\"\"),t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(1==n.nodeType)switch(n.nodeName){case\"source\":var a=(new Y).parse(n);i[a.id]=a;break;case\"targets\":r=this.parseInputs(n);break;default:console.log(n.nodeName)}}for(t=0;t<r.length;t++){var o=r[t],a=i[o.source];switch(o.semantic){case\"MORPH_TARGET\":this.targets=a.read();break;case\"MORPH_WEIGHT\":this.weights=a.read()}}return this},D.prototype.parseInputs=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case\"input\":t.push((new Q).parse(r))}}return t},S.prototype.parse=function(e){var t,i,r={};this.source=e.getAttribute(\"source\").replace(/^#/,\"\"),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var n=0;n<e.childNodes.length;n++){var a=e.childNodes[n];if(1==a.nodeType)switch(a.nodeName){case\"bind_shape_matrix\":var o=pt(a.textContent);this.bindShapeMatrix=bt(o);break;case\"source\":var s=(new Y).parse(a);r[s.id]=s;break;case\"joints\":t=a;break;case\"vertex_weights\":i=a;break;default:console.log(a.nodeName)}}return this.parseJoints(t,r),this.parseWeights(i,r),this},S.prototype.parseJoints=function(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case\"input\":var n=(new Q).parse(r),a=t[n.source];\"JOINT\"===n.semantic?this.joints=a.read():\"INV_BIND_MATRIX\"===n.semantic&&(this.invBindMatrices=a.read())}}},S.prototype.parseWeights=function(e,t){for(var i,r,n=[],a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];if(1==o.nodeType)switch(o.nodeName){case\"input\":n.push((new Q).parse(o));break;case\"v\":i=ft(o.textContent);break;case\"vcount\":r=ft(o.textContent)}}for(var s=0,a=0;a<r.length;a++){for(var c=r[a],u=[],l=0;c>l;l++){for(var h={},d=0;d<n.length;d++){var p=n[d],f=i[s+p.offset];switch(p.semantic){case\"JOINT\":h.joint=f;break;case\"WEIGHT\":h.weight=t[p.source].data[f]}}u.push(h),s+=n.length}for(var l=0;l<u.length;l++)u[l].index=a;this.weights.push(u)}},C.prototype.getChildById=function(e,t){for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},C.prototype.getChildBySid=function(e,t){for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},C.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.name=e.getAttribute(\"name\"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"node\":this.nodes.push((new I).parse(i))}}return this},I.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var i,r,n=this.channels[t],a=n.target.split(\"/\"),o=(a.shift(),a.shift()),s=o.indexOf(\".\")>=0,c=o.indexOf(\"(\")>=0;if(s)a=o.split(\".\"),o=a.shift(),r=a.shift();else if(c){i=o.split(\"(\"),o=i.shift();for(var u=0;u<i.length;u++)i[u]=parseInt(i[u].replace(/\\)/,\"\"))}if(o===e)return n.info={sid:o,dotSyntax:s,arrSyntax:c,arrIndices:i},n}return null},I.prototype.getChildById=function(e,t){if(this.id===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},I.prototype.getChildBySid=function(e,t){if(this.sid===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},I.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid===e)return this.transforms[t];return null},I.prototype.parse=function(e){var t;this.id=e.getAttribute(\"id\"),this.sid=e.getAttribute(\"sid\"),this.name=e.getAttribute(\"name\"),this.type=e.getAttribute(\"type\"),this.layer=e.getAttribute(\"layer\"),this.type=\"JOINT\"===this.type?this.type:\"NODE\",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case\"node\":this.nodes.push((new I).parse(r));break;case\"instance_camera\":this.cameras.push((new nt).parse(r));break;case\"instance_controller\":this.controllers.push((new _).parse(r));break;case\"instance_geometry\":this.geometries.push((new z).parse(r));break;case\"instance_light\":this.lights.push((new ot).parse(r));break;case\"instance_node\":t=r.getAttribute(\"url\").replace(/^#/,\"\");var n=y(t);n&&this.nodes.push((new I).parse(n));break;case\"rotate\":case\"translate\":case\"scale\":case\"matrix\":case\"lookat\":case\"skew\":this.transforms.push((new j).parse(r));break;case\"extra\":break;default:console.log(r.nodeName)}}return this.channels=M(this),A(this),this.updateMatrix(),this},I.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},j.prototype.parse=function(e){return this.sid=e.getAttribute(\"sid\"),this.type=e.nodeName,this.data=pt(e.textContent),this.convert(),this},j.prototype.convert=function(){switch(this.type){case\"matrix\":this.obj=bt(this.data);break;case\"rotate\":this.angle=THREE.Math.degToRad(this.data[3]);case\"translate\":xt(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case\"scale\":xt(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log(\"Can not convert Transform of type \"+this.type)}},j.prototype.apply=function(){var e=new THREE.Matrix4;return function(t){switch(this.type){case\"matrix\":t.multiply(this.obj);break;case\"translate\":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case\"rotate\":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case\"scale\":t.scale(this.obj)}}}(),j.prototype.update=function(e,t){var i=[\"X\",\"Y\",\"Z\",\"ANGLE\"];switch(this.type){case\"matrix\":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r=\"n\"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log(\"Incorrect addressing of matrix in transform.\");else this.obj.copy(e);break;case\"translate\":case\"scale\":switch(\"[object Array]\"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case\"X\":this.obj.x=e;break;case\"Y\":this.obj.y=e;break;case\"Z\":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case\"rotate\":switch(\"[object Array]\"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case\"X\":this.obj.x=e;break;case\"Y\":this.obj.y=e;break;case\"Z\":this.obj.z=e;break;case\"ANGLE\":this.angle=THREE.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=THREE.Math.degToRad(e[3])}}},_.prototype.parse=function(e){this.url=e.getAttribute(\"url\").replace(/^#/,\"\"),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case\"skeleton\":this.skeleton.push(i.textContent.replace(/^#/,\"\"));break;case\"bind_material\":for(var r=i.querySelectorAll(\"instance_material\"),n=0;n<r.length;n++){var a=r[n];this.instance_material.push((new O).parse(a))}break;case\"extra\":}}return this},O.prototype.parse=function(e){return this.symbol=e.getAttribute(\"symbol\"),this.target=e.getAttribute(\"target\").replace(/^#/,\"\"),this},z.prototype.parse=function(e){this.url=e.getAttribute(\"url\").replace(/^#/,\"\"),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&\"bind_material\"===i.nodeName){for(var r=i.querySelectorAll(\"instance_material\"),n=0;n<r.length;n++){var a=r[n];this.instance_material.push((new O).parse(a))}break}}return this},k.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),Mt(this,e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case\"mesh\":this.mesh=new R(this).parse(i);break;case\"extra\":}}return this},R.prototype.parse=function(e){this.primitives=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case\"source\":ht(i);break;case\"vertices\":this.vertices=(new V).parse(i);break;case\"linestrips\":this.primitives.push((new P).parse(i));break;case\"triangles\":this.primitives.push((new F).parse(i));break;case\"polygons\":this.primitives.push((new B).parse(i));break;case\"polylist\":this.primitives.push((new U).parse(i))}}if(this.geometry3js=new THREE.Geometry,null===this.vertices)return this;for(var r=Ut[this.vertices.input.POSITION.source].data,t=0;t<r.length;t+=3)this.geometry3js.vertices.push(Et(r,t).clone());for(var t=0;t<this.primitives.length;t++){var n=this.primitives[t];n.setVertices(this.vertices),this.handlePrimitive(n,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},R.prototype.handlePrimitive=function(e,t){if(e instanceof P)return t.isLineStrip=!0,void 0;var i,r,n,a,o,s,c,u=e.p,l=e.inputs,h=0,d=3,p=0,f=[];for(i=0;i<l.length;i++){n=l[i];var m=n.offset+1;switch(p=m>p?m:p,n.semantic){case\"TEXCOORD\":f.push(n.set)}}for(var g=0;g<u.length;++g)for(var v=u[g],y=0;y<v.length;){var M=[],A=[],x=null,w=[];for(d=e.vcount?e.vcount.length?e.vcount[h++]:e.vcount:v.length/p,i=0;d>i;i++)for(r=0;r<l.length;r++)switch(n=l[r],s=Ut[n.source],a=v[y+i*p+n.offset],c=s.accessor.params.length,o=a*c,n.semantic){case\"VERTEX\":M.push(a);break;case\"NORMAL\":A.push(Et(s.data,o));break;case\"TEXCOORD\":x=x||{},void 0===x[n.set]&&(x[n.set]=[]),x[n.set].push(new THREE.Vector2(s.data[o],s.data[o+1]));break;case\"COLOR\":w.push((new THREE.Color).setRGB(s.data[o],s.data[o+1],s.data[o+2]))}if(0===A.length)if(n=this.vertices.input.NORMAL){s=Ut[n.source],c=s.accessor.params.length;for(var E=0,b=M.length;b>E;E++)A.push(Et(s.data,M[E]*c))}else t.calcNormals=!0;if(!x&&(x={},n=this.vertices.input.TEXCOORD)){f.push(n.set),s=Ut[n.source],c=s.accessor.params.length;for(var E=0,b=M.length;b>E;E++)o=M[E]*c,void 0===x[n.set]&&(x[n.set]=[]),x[n.set].push(new THREE.Vector2(s.data[o],1-s.data[o+1]))}if(0===w.length&&(n=this.vertices.input.COLOR)){s=Ut[n.source],c=s.accessor.params.length;for(var E=0,b=M.length;b>E;E++)o=M[E]*c,w.push((new THREE.Color).setRGB(s.data[o],s.data[o+1],s.data[o+2]))}var T,L,N=null,D=[];if(3===d)D.push(new THREE.Face3(M[0],M[1],M[2],A,w.length?w:new THREE.Color));else if(4===d)D.push(new THREE.Face3(M[0],M[1],M[3],A.length?[A[0].clone(),A[1].clone(),A[3].clone()]:[],w.length?[w[0],w[1],w[3]]:new THREE.Color)),D.push(new THREE.Face3(M[1],M[2],M[3],A.length?[A[1].clone(),A[2].clone(),A[3].clone()]:[],w.length?[w[1],w[2],w[3]]:new THREE.Color));else if(d>4&&qt.subdivideFaces){var S=w.length?w:new THREE.Color;for(r=1;d-1>r;)D.push(new THREE.Face3(M[0],M[r],M[r+1],A.length?[A[0].clone(),A[r++].clone(),A[r].clone()]:[],S))}if(D.length)for(var E=0,b=D.length;b>E;E++)for(N=D[E],N.daeMaterial=e.material,t.faces.push(N),r=0;r<f.length;r++)T=x[f[r]],L=d>4?[T[0],T[E+1],T[E+2]]:4===d?0===E?[T[0],T[1],T[3]]:[T[1].clone(),T[2],T[3].clone()]:[T[0],T[1],T[2]],void 0===t.faceVertexUvs[r]&&(t.faceVertexUvs[r]=[]),t.faceVertexUvs[r].push(L);else console.log(\"dropped face with vcount \"+d+\" for geometry with id: \"+t.id);y+=p*d}},B.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source===e.id&&(this.inputs[t].source=e.input.POSITION.source)},B.prototype.parse=function(e){this.material=e.getAttribute(\"material\"),this.count=vt(e,\"count\",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case\"input\":this.inputs.push((new Q).parse(e.childNodes[t]));break;case\"vcount\":this.vcount=ft(i.textContent);break;case\"p\":this.p.push(ft(i.textContent));break;case\"ph\":console.warn(\"polygon holes not yet supported!\")}}return this},U.prototype=Object.create(B.prototype),U.prototype.constructor=U,P.prototype=Object.create(B.prototype),P.prototype.constructor=P,F.prototype=Object.create(B.prototype),F.prototype.constructor=F,G.prototype.parse=function(e){this.params=[],this.source=e.getAttribute(\"source\"),this.count=vt(e,\"count\",0),this.stride=vt(e,\"stride\",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(\"param\"===i.nodeName){var r={};r.name=i.getAttribute(\"name\"),r.type=i.getAttribute(\"type\"),this.params.push(r)}}return this},V.prototype.parse=function(e){this.id=e.getAttribute(\"id\");for(var t=0;t<e.childNodes.length;t++)if(\"input\"===e.childNodes[t].nodeName){var i=(new Q).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},Q.prototype.parse=function(e){return this.semantic=e.getAttribute(\"semantic\"),this.source=e.getAttribute(\"source\").replace(/^#/,\"\"),this.set=vt(e,\"set\",-1),this.offset=vt(e,\"offset\",0),\"TEXCOORD\"===this.semantic&&this.set<0&&(this.set=0),this},Y.prototype.parse=function(e){this.id=e.getAttribute(\"id\");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case\"bool_array\":this.data=dt(i.textContent),this.type=i.nodeName;break;case\"float_array\":this.data=pt(i.textContent),this.type=i.nodeName;break;case\"int_array\":this.data=ft(i.textContent),this.type=i.nodeName;break;case\"IDREF_array\":case\"Name_array\":this.data=mt(i.textContent),this.type=i.nodeName;break;case\"technique_common\":for(var r=0;r<i.childNodes.length;r++)if(\"accessor\"===i.childNodes[r].nodeName){this.accessor=(new G).parse(i.childNodes[r]);break}}}return this},Y.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case\"IDREF\":case\"Name\":case\"name\":case\"float\":return this.data;case\"float4x4\":for(var i=0;i<this.data.length;i+=16){var r=this.data.slice(i,i+16),n=bt(r);e.push(n)}break;default:console.log(\"ColladaLoader: Source: Read dont know how to read \"+t.type+\".\")}return e},H.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.name=e.getAttribute(\"name\");for(var t=0;t<e.childNodes.length;t++)if(\"instance_effect\"===e.childNodes[t].nodeName){this.instance_effect=(new J).parse(e.childNodes[t]);break}return this},W.prototype.isColor=function(){return null===this.texture},W.prototype.isTexture=function(){return null!=this.texture},W.prototype.parse=function(e){\"transparent\"===e.nodeName&&(this.opaque=e.getAttribute(\"opaque\"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"color\":var r=pt(i.textContent);this.color=new THREE.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case\"texture\":this.texture=i.getAttribute(\"texture\"),this.texcoord=i.getAttribute(\"texcoord\"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},W.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&\"extra\"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&\"technique\"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case\"offsetU\":case\"offsetV\":case\"repeatU\":case\"repeatV\":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case\"wrapU\":case\"wrapV\":this.texOpts[i.nodeName]=\"TRUE\"===i.textContent.toUpperCase()?1:parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},X.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"emission\":case\"diffuse\":case\"specular\":case\"transparent\":this[i.nodeName]=(new W).parse(i);break;case\"bump\":var r=i.getAttribute(\"bumptype\");r?\"heightfield\"===r.toLowerCase()?this.bump=(new W).parse(i):\"normalmap\"===r.toLowerCase()?this.normal=(new W).parse(i):(console.error(\"Shader.prototype.parse: Invalid value for attribute 'bumptype' (\"+r+\") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'\"),this.bump=(new W).parse(i)):(console.warn(\"Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'\"),this.bump=(new W).parse(i));break;case\"shininess\":case\"reflectivity\":case\"index_of_refraction\":case\"transparency\":var n=i.querySelectorAll(\"float\");n.length>0&&(this[i.nodeName]=parseFloat(n[0].textContent))}}return this.create(),this},X.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var i=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);i>0&&(t=!0,e.transparent=!0,e.opacity=1-i)}var r={diffuse:\"map\",ambient:\"lightMap\",specular:\"specularMap\",emission:\"emissionMap\",bump:\"bumpMap\",normal:\"normalMap\"};for(var n in this)switch(n){case\"ambient\":case\"emission\":case\"diffuse\":case\"specular\":case\"bump\":case\"normal\":var a=this[n];if(a instanceof W)if(a.isTexture()){var o=a.texture,s=this.effect.sampler[o];if(void 0!==s&&void 0!==s.source){var c=this.effect.surface[s.source];if(void 0!==c){var u=Pt[c.init_from];if(u){var l,h=_t+u.init_from,d=THREE.Loader.Handlers.get(h);null!==d?l=d.load(h):(l=new THREE.Texture,yt(l,h)),l.wrapS=a.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,l.wrapT=a.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,l.offset.x=a.texOpts.offsetU,l.offset.y=a.texOpts.offsetV,l.repeat.x=a.texOpts.repeatU,l.repeat.y=a.texOpts.repeatV,e[r[n]]=l,\"emission\"===n&&(e.emissive=16777215)}}}}else\"diffuse\"!==n&&t||(\"emission\"===n?e.emissive=a.color.getHex():e[n]=a.color.getHex());break;case\"shininess\":e[n]=this[n];break;case\"reflectivity\":e[n]=this[n],e[n]>0&&(e.envMap=qt.defaultEnvMap),e.combine=THREE.MixOperation;break;case\"index_of_refraction\":e.refractionRatio=this[n],1!==this[n]&&(e.envMap=qt.defaultEnvMap);break;case\"transparency\":}switch(e.shading=Xt,e.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,void 0!==e.diffuse&&(e.color=e.diffuse,delete e.diffuse),this.type){case\"constant\":void 0!=e.emissive&&(e.color=e.emissive),this.material=new THREE.MeshBasicMaterial(e);break;case\"phong\":case\"blinn\":this.material=new THREE.MeshPhongMaterial(e);break;case\"lambert\":default:this.material=new THREE.MeshLambertMaterial(e)}return this.material},q.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"init_from\":this.init_from=i.textContent;break;case\"format\":this.format=i.textContent;break;default:console.log(\"unhandled Surface prop: \"+i.nodeName)}}return this},Z.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"source\":this.source=i.textContent;break;case\"minfilter\":this.minfilter=i.textContent;break;case\"magfilter\":this.magfilter=i.textContent;break;case\"mipfilter\":this.mipfilter=i.textContent;break;case\"wrap_s\":this.wrap_s=i.textContent;break;case\"wrap_t\":this.wrap_t=i.textContent;break;default:console.log(\"unhandled Sampler2D prop: \"+i.nodeName)}}return this},K.prototype.create=function(){return null===this.shader?null:void 0},K.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.name=e.getAttribute(\"name\"),Mt(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"profile_COMMON\":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},K.prototype.parseNewparam=function(e){for(var t=e.getAttribute(\"sid\"),i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case\"surface\":this.surface[t]=new q(this).parse(r);break;case\"sampler2D\":this.sampler[t]=new Z(this).parse(r);break;case\"extra\":break;default:console.log(r.nodeName)}}},K.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case\"profile_COMMON\":this.parseProfileCOMMON(r);break;case\"technique\":t=r;break;case\"newparam\":this.parseNewparam(r);break;case\"image\":var n=(new L).parse(r);Pt[n.id]=n;break;case\"extra\":break;default:console.log(r.nodeName)}}return t},K.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"constant\":case\"lambert\":case\"blinn\":case\"phong\":this.shader=new X(i.nodeName,this).parse(i);break;case\"extra\":this.parseExtra(i)}}},K.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"technique\":this.parseExtraTechnique(i)}}},K.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"bump\":this.shader.parse(e)}}},J.prototype.parse=function(e){return this.url=e.getAttribute(\"url\").replace(/^#/,\"\"),this},$.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.name=e.getAttribute(\"name\"),this.source={};for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"animation\":var r=(new $).parse(i);for(var n in r.source)this.source[n]=r.source[n];for(var a=0;a<r.channel.length;a++)this.channel.push(r.channel[a]),this.sampler.push(r.sampler[a]);break;case\"source\":var n=(new Y).parse(i);this.source[n.id]=n;break;case\"sampler\":this.sampler.push(new tt(this).parse(i));break;case\"channel\":this.channel.push(new et(this).parse(i))}}return this},et.prototype.parse=function(e){this.source=e.getAttribute(\"source\").replace(/^#/,\"\"),this.target=e.getAttribute(\"target\");var t=this.target.split(\"/\"),i=(t.shift(),t.shift()),r=i.indexOf(\".\")>=0,n=i.indexOf(\"(\")>=0;if(r)t=i.split(\".\"),this.sid=t.shift(),this.member=t.shift();else if(n){var a=i.split(\"(\");this.sid=a.shift();for(var o=0;o<a.length;o++)a[o]=parseInt(a[o].replace(/\\)/,\"\"));this.arrIndices=a}else this.sid=i;return this.fullSid=i,this.dotSyntax=r,this.arrSyntax=n,this},tt.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"input\":this.inputs.push((new Q).parse(i))}}return this},tt.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case\"INPUT\":this.input=i.read();break;case\"OUTPUT\":this.output=i.read(),this.strideOut=i.accessor.stride;break;case\"INTERPOLATION\":this.interpolation=i.read();break;case\"IN_TANGENT\":break;case\"OUT_TANGENT\":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},tt.prototype.getData=function(e,t,i){var r;if(\"matrix\"===e&&16===this.strideOut)r=this.output[t];else if(this.strideOut>1){r=[],t*=this.strideOut;for(var n=0;n<this.strideOut;++n)r[n]=this.output[t+n];if(3===this.strideOut)switch(e){case\"rotate\":case\"translate\":xt(r,-1);break;case\"scale\":xt(r,1)}else 4===this.strideOut&&\"matrix\"===e&&xt(r,-1)}else r=this.output[t],i&&\"translate\"===e&&(r=wt(i,r));return r},it.prototype.addTarget=function(e,t,i,r){this.targets.push({sid:e,member:i,transform:t,data:r})},it.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},it.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},it.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},it.prototype.interpolate=function(e,t){for(var i=0,r=this.targets.length;r>i;i++){var n,a=this.targets[i],o=e.getTarget(a.sid);if(\"matrix\"!==a.transform.type&&o){var s=(t-this.time)/(e.time-this.time),c=o.data,u=a.data;if(0>s&&(s=0),s>1&&(s=1),u.length){n=[];for(var l=0;l<u.length;++l)n[l]=u[l]+(c[l]-u[l])*s}else n=u+(c-u)*s}else n=a.data;a.transform.update(n,a.member)}},rt.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.name=e.getAttribute(\"name\");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"optics\":this.parseOptics(i)}}return this},rt.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if(\"technique_common\"===e.childNodes[t].nodeName)for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++)if(this.technique=i.childNodes[r].nodeName,\"perspective\"===this.technique)for(var n=i.childNodes[r],a=0;a<n.childNodes.length;a++){var o=n.childNodes[a];\nswitch(o.nodeName){case\"yfov\":this.yfov=o.textContent;break;case\"xfov\":this.xfov=o.textContent;break;case\"znear\":this.znear=o.textContent;break;case\"zfar\":this.zfar=o.textContent;break;case\"aspect_ratio\":this.aspect_ratio=o.textContent}}else if(\"orthographic\"===this.technique)for(var s=i.childNodes[r],a=0;a<s.childNodes.length;a++){var o=s.childNodes[a];switch(o.nodeName){case\"xmag\":this.xmag=o.textContent;break;case\"ymag\":this.ymag=o.textContent;break;case\"znear\":this.znear=o.textContent;break;case\"zfar\":this.zfar=o.textContent;break;case\"aspect_ratio\":this.aspect_ratio=o.textContent}}return this},nt.prototype.parse=function(e){return this.url=e.getAttribute(\"url\").replace(/^#/,\"\"),this},at.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.name=e.getAttribute(\"name\");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"technique_common\":this.parseCommon(i);break;case\"technique\":this.parseTechnique(i)}}return this},at.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case\"directional\":case\"point\":case\"spot\":case\"ambient\":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var n=i.childNodes[r];switch(n.nodeName){case\"color\":var a=pt(n.textContent);this.color=new THREE.Color(0),this.color.setRGB(a[0],a[1],a[2]),this.color.a=a[3];break;case\"falloff_angle\":this.falloff_angle=parseFloat(n.textContent);break;case\"quadratic_attenuation\":var o=parseFloat(n.textContent);this.distance=o?Math.sqrt(1/o):0}}}return this},at.prototype.parseTechnique=function(e){this.profile=e.getAttribute(\"profile\");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case\"intensity\":this.intensity=parseFloat(i.textContent)}}return this},ot.prototype.parse=function(e){return this.url=e.getAttribute(\"url\").replace(/^#/,\"\"),this},st.prototype.parse=function(e){this.id=e.getAttribute(\"id\"),this.name=e.getAttribute(\"name\"),this.joints=[],this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"technique_common\":this.parseCommon(i)}}return this},st.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(e.childNodes[t].nodeName){case\"joint\":this.joints.push((new ct).parse(i));break;case\"link\":this.links.push((new ut).parse(i))}}return this},ct.prototype.parse=function(e){this.sid=e.getAttribute(\"sid\"),this.name=e.getAttribute(\"name\"),this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type=\"\",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var t=e.querySelector(\"axis\"),i=pt(t.textContent);this.axis=Et(i,0);var r=e.querySelector(\"limits min\")?parseFloat(e.querySelector(\"limits min\").textContent):-360,n=e.querySelector(\"limits max\")?parseFloat(e.querySelector(\"limits max\").textContent):360;this.limits={min:r,max:n};for(var a=[\"prismatic\",\"revolute\"],o=0;o<a.length;o++){var s=a[o],c=e.querySelector(s);c&&(this.type=s)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},ut.prototype.parse=function(e){this.sid=e.getAttribute(\"sid\"),this.name=e.getAttribute(\"name\"),this.transforms=[],this.attachments=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"attachment_full\":this.attachments.push((new lt).parse(i));break;case\"rotate\":case\"translate\":case\"matrix\":this.transforms.push((new j).parse(i))}}return this},lt.prototype.parse=function(e){this.joint=e.getAttribute(\"joint\").split(\"/\").pop(),this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case\"link\":this.links.push((new ut).parse(i));break;case\"rotate\":case\"translate\":case\"matrix\":this.transforms.push((new j).parse(i))}}return this},{load:e,parse:t,setPreferredShading:i,applySkin:m,geometries:Vt,options:qt}}},{}],15:[function(){THREE.MTLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e,t,i,r){var n=this,a=new THREE.XHRLoader(this.manager);a.setPath(this.path),a.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){this.path=e},setBaseUrl:function(e){this.baseUrl=e},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split(\"\\n\"),i={},r=/\\s+/,n={},a=0;a<t.length;a++){var o=t[a];if(o=o.trim(),0!==o.length&&\"#\"!==o.charAt(0)){var s=o.indexOf(\" \"),c=s>=0?o.substring(0,s):o;c=c.toLowerCase();var u=s>=0?o.substring(s+1):\"\";if(u=u.trim(),\"newmtl\"===c)i={name:u},n[u]=i;else if(i)if(\"ka\"===c||\"kd\"===c||\"ks\"===c){var l=u.split(r,3);i[c]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else i[c]=u}}var h=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(n),h}},THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],n={};t[i]=n;for(var a in r){var o=!0,s=r[a],c=a.toLowerCase();switch(c){case\"kd\":case\"ka\":case\"ks\":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(o=!1)}o&&(n[c]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this.materialsInfo[e],i={name:e,side:this.side};for(var r in t){var n=t[r];if(\"\"!==n)switch(r.toLowerCase()){case\"kd\":i.color=(new THREE.Color).fromArray(n);break;case\"ks\":i.specular=(new THREE.Color).fromArray(n);break;case\"map_kd\":i.map=this.loadTexture(this.baseUrl+n),i.map.wrapS=this.wrap,i.map.wrapT=this.wrap;break;case\"ns\":i.shininess=parseFloat(n);break;case\"d\":1>n&&(i.opacity=n,i.transparent=!0);break;case\"Tr\":n>0&&(i.opacity=1-n,i.transparent=!0);break;case\"map_bump\":case\"bump\":if(i.bumpMap)break;i.bumpMap=this.loadTexture(this.baseUrl+n),i.bumpMap.wrapS=this.wrap,i.bumpMap.wrapT=this.wrap}}return this.materials[e]=new THREE.MeshPhongMaterial(i),this.materials[e]},loadTexture:function(e,t,i,r,n){var a,o=THREE.Loader.Handlers.get(e),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===o&&(o=new THREE.TextureLoader(s)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),a=o.load(e,i,r,n),void 0!==t&&(a.mapping=t),a}},THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype)},{}],16:[function(){THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,normal_pattern:/^vn\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,uv_pattern:/^vt\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,face_vertex:/^f\\s+(-?\\d+)\\s+(-?\\d+)\\s+(-?\\d+)(?:\\s+(-?\\d+))?/,face_vertex_uv:/^f\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+))?/,face_vertex_uv_normal:/^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/,face_vertex_normal:/^f\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)(?:\\s+(-?\\d+)\\/\\/(-?\\d+))?/,object_pattern:/^[og]\\s*(.+)?/,smoothing_pattern:/^s\\s+(\\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,i,r){var n=this,a=new THREE.XHRLoader(n.manager);a.setPath(this.path),a.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){return this.object&&this.object.fromDeclaration===!1?(this.object.name=e,this.object.fromDeclaration=t!==!1,void 0):(this.object={name:e||\"\",geometry:{vertices:[],normals:[],uvs:[]},material:{name:\"\",smooth:!0},fromDeclaration:t!==!1},this.objects.push(this.object),void 0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0]),n.push(r[e+1]),n.push(r[e+2]),n.push(r[t+0]),n.push(r[t+1]),n.push(r[t+2]),n.push(r[i+0]),n.push(r[i+1]),n.push(r[i+2])},addVertexLine:function(e){var t=this.vertices,i=this.object.geometry.vertices;i.push(t[e+0]),i.push(t[e+1]),i.push(t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0]),n.push(r[e+1]),n.push(r[e+2]),n.push(r[t+0]),n.push(r[t+1]),n.push(r[t+2]),n.push(r[i+0]),n.push(r[i+1]),n.push(r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0]),n.push(r[e+1]),n.push(r[t+0]),n.push(r[t+1]),n.push(r[i+0]),n.push(r[i+1])},addUVLine:function(e){var t=this.uvs,i=this.object.geometry.uvs;i.push(t[e+0]),i.push(t[e+1])},addFace:function(e,t,i,r,n,a,o,s,c,u,l,h){var d,p=this.vertices.length,f=this.parseVertexIndex(e,p),m=this.parseVertexIndex(t,p),g=this.parseVertexIndex(i,p);if(void 0===r?this.addVertex(f,m,g):(d=this.parseVertexIndex(r,p),this.addVertex(f,m,d),this.addVertex(m,g,d)),void 0!==n){var v=this.uvs.length;f=this.parseUVIndex(n,v),m=this.parseUVIndex(a,v),g=this.parseUVIndex(o,v),void 0===r?this.addUV(f,m,g):(d=this.parseUVIndex(s,v),this.addUV(f,m,d),this.addUV(m,g,d))}if(void 0!==c){var y=this.normals.length;f=this.parseNormalIndex(c,y),m=c===u?f:this.parseNormalIndex(u,y),g=c===l?f:this.parseNormalIndex(l,y),void 0===r?this.addNormal(f,m,g):(d=this.parseNormalIndex(h,y),this.addNormal(f,m,d),this.addNormal(m,g,d))}},addLineGeometry:function(e,t){this.object.geometry.type=\"Line\";for(var i=this.vertices.length,r=this.uvs.length,n=0,a=e.length;a>n;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));for(var o=0,a=t.length;a>o;o++)this.addUVLine(this.parseUVIndex(t[o],r))}};return e.startObject(\"\",!1),e},parse:function(e){console.time(\"OBJLoader\");var t=this._createParserState();-1!==e.indexOf(\"\\r\\n\")&&(e=e.replace(\"\\r\\n\",\"\\n\"));for(var i=e.split(\"\\n\"),r=\"\",n=\"\",a=\"\",o=0,s=[],c=\"function\"==typeof\"\".trimLeft,u=0,l=i.length;l>u;u++)if(r=i[u],r=c?r.trimLeft():r.trim(),o=r.length,0!==o&&(n=r.charAt(0),\"#\"!==n))if(\"v\"===n)if(a=r.charAt(1),\" \"===a&&null!==(s=this.regexp.vertex_pattern.exec(r)))t.vertices.push(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));else if(\"n\"===a&&null!==(s=this.regexp.normal_pattern.exec(r)))t.normals.push(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));else{if(\"t\"!==a||null===(s=this.regexp.uv_pattern.exec(r)))throw new Error(\"Unexpected vertex/normal/uv line: '\"+r+\"'\");t.uvs.push(parseFloat(s[1]),parseFloat(s[2]))}else if(\"f\"===n)if(null!==(s=this.regexp.face_vertex_uv_normal.exec(r)))t.addFace(s[1],s[4],s[7],s[10],s[2],s[5],s[8],s[11],s[3],s[6],s[9],s[12]);else if(null!==(s=this.regexp.face_vertex_uv.exec(r)))t.addFace(s[1],s[3],s[5],s[7],s[2],s[4],s[6],s[8]);else if(null!==(s=this.regexp.face_vertex_normal.exec(r)))t.addFace(s[1],s[3],s[5],s[7],void 0,void 0,void 0,void 0,s[2],s[4],s[6],s[8]);else{if(null===(s=this.regexp.face_vertex.exec(r)))throw new Error(\"Unexpected face line: '\"+r+\"'\");t.addFace(s[1],s[2],s[3],s[4])}else if(\"l\"===n){var h=r.substring(1).trim().split(\" \"),d=[],p=[];if(-1===r.indexOf(\"/\"))d=h;else for(var f=0,m=h.length;m>f;f++){var g=h[f].split(\"/\");\"\"!==g[0]&&d.push(g[0]),\"\"!==g[1]&&p.push(g[1])}t.addLineGeometry(d,p)}else if(null!==(s=this.regexp.object_pattern.exec(r))){var v=s[0].substr(1).trim();t.startObject(v)}else if(this.regexp.material_use_pattern.test(r))t.object.material.name=r.substring(7).trim();else if(this.regexp.material_library_pattern.test(r))t.materialLibraries.push(r.substring(7).trim());else{if(null===(s=this.regexp.smoothing_pattern.exec(r))){if(\"\\x00\"===r)continue;throw new Error(\"Unexpected line: '\"+r+\"'\")}var y=s[1].trim().toLowerCase();t.object.material.smooth=\"1\"===y||\"on\"===y}var M=new THREE.Group;M.materialLibraries=[].concat(t.materialLibraries);for(var u=0,l=t.objects.length;l>u;u++){var A=t.objects[u],x=A.geometry,w=\"Line\"===x.type;if(0!==x.vertices.length){var E=new THREE.BufferGeometry;E.addAttribute(\"position\",new THREE.BufferAttribute(new Float32Array(x.vertices),3)),x.normals.length>0?E.addAttribute(\"normal\",new THREE.BufferAttribute(new Float32Array(x.normals),3)):E.computeVertexNormals(),x.uvs.length>0&&E.addAttribute(\"uv\",new THREE.BufferAttribute(new Float32Array(x.uvs),2));var b;if(null!==this.materials&&(b=this.materials.create(A.material.name),w&&b&&!(b instanceof THREE.LineBasicMaterial))){var T=new THREE.LineBasicMaterial;T.copy(b),b=T}b||(b=w?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,b.name=A.material.name),b.shading=A.material.smooth?THREE.SmoothShading:THREE.FlatShading;var L=w?new THREE.Line(E,b):new THREE.Mesh(E,b);L.name=A.name,M.add(L)}}return console.timeEnd(\"OBJLoader\"),M}}},{}],17:[function(e,i,r){var n={REVISION:\"76\"};\"function\"==typeof t&&t.amd?t(\"three\",n):\"undefined\"!=typeof r&&\"undefined\"!=typeof i&&(i.exports=n),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:e>0?1:+e}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,\"name\",{get:function(){return this.toString().match(/^\\s*function\\s*(\\S*)\\s*\\(/)[1]}}),void 0===Object.assign&&Object.defineProperty(Object,\"assign\",{writable:!0,configurable:!0,value:function(e){\"use strict\";if(void 0===e||null===e)throw new TypeError(\"Cannot convert first argument to object\");for(var t=Object(e),i=1,r=arguments.length;i!==r;++i){var n=arguments[i];if(void 0!==n&&null!==n){n=Object(n);for(var a=Object.keys(n),o=0,s=a.length;o!==s;++o){var c=a[o],u=Object.getOwnPropertyDescriptor(n,c);void 0!==u&&u.enumerable&&(t[c]=n[c])}}}return t}}),n.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},n.CullFaceNone=0,n.CullFaceBack=1,n.CullFaceFront=2,n.CullFaceFrontBack=3,n.FrontFaceDirectionCW=0,n.FrontFaceDirectionCCW=1,n.BasicShadowMap=0,n.PCFShadowMap=1,n.PCFSoftShadowMap=2,n.FrontSide=0,n.BackSide=1,n.DoubleSide=2,n.FlatShading=1,n.SmoothShading=2,n.NoColors=0,n.FaceColors=1,n.VertexColors=2,n.NoBlending=0,n.NormalBlending=1,n.AdditiveBlending=2,n.SubtractiveBlending=3,n.MultiplyBlending=4,n.CustomBlending=5,n.AddEquation=100,n.SubtractEquation=101,n.ReverseSubtractEquation=102,n.MinEquation=103,n.MaxEquation=104,n.ZeroFactor=200,n.OneFactor=201,n.SrcColorFactor=202,n.OneMinusSrcColorFactor=203,n.SrcAlphaFactor=204,n.OneMinusSrcAlphaFactor=205,n.DstAlphaFactor=206,n.OneMinusDstAlphaFactor=207,n.DstColorFactor=208,n.OneMinusDstColorFactor=209,n.SrcAlphaSaturateFactor=210,n.NeverDepth=0,n.AlwaysDepth=1,n.LessDepth=2,n.LessEqualDepth=3,n.EqualDepth=4,n.GreaterEqualDepth=5,n.GreaterDepth=6,n.NotEqualDepth=7,n.MultiplyOperation=0,n.MixOperation=1,n.AddOperation=2,n.NoToneMapping=0,n.LinearToneMapping=1,n.ReinhardToneMapping=2,n.Uncharted2ToneMapping=3,n.CineonToneMapping=4,n.UVMapping=300,n.CubeReflectionMapping=301,n.CubeRefractionMapping=302,n.EquirectangularReflectionMapping=303,n.EquirectangularRefractionMapping=304,n.SphericalReflectionMapping=305,n.CubeUVReflectionMapping=306,n.CubeUVRefractionMapping=307,n.RepeatWrapping=1e3,n.ClampToEdgeWrapping=1001,n.MirroredRepeatWrapping=1002,n.NearestFilter=1003,n.NearestMipMapNearestFilter=1004,n.NearestMipMapLinearFilter=1005,n.LinearFilter=1006,n.LinearMipMapNearestFilter=1007,n.LinearMipMapLinearFilter=1008,n.UnsignedByteType=1009,n.ByteType=1010,n.ShortType=1011,n.UnsignedShortType=1012,n.IntType=1013,n.UnsignedIntType=1014,n.FloatType=1015,n.HalfFloatType=1025,n.UnsignedShort4444Type=1016,n.UnsignedShort5551Type=1017,n.UnsignedShort565Type=1018,n.AlphaFormat=1019,n.RGBFormat=1020,n.RGBAFormat=1021,n.LuminanceFormat=1022,n.LuminanceAlphaFormat=1023,n.RGBEFormat=n.RGBAFormat,n.DepthFormat=1026,n.RGB_S3TC_DXT1_Format=2001,n.RGBA_S3TC_DXT1_Format=2002,n.RGBA_S3TC_DXT3_Format=2003,n.RGBA_S3TC_DXT5_Format=2004,n.RGB_PVRTC_4BPPV1_Format=2100,n.RGB_PVRTC_2BPPV1_Format=2101,n.RGBA_PVRTC_4BPPV1_Format=2102,n.RGBA_PVRTC_2BPPV1_Format=2103,n.RGB_ETC1_Format=2151,n.LoopOnce=2200,n.LoopRepeat=2201,n.LoopPingPong=2202,n.InterpolateDiscrete=2300,n.InterpolateLinear=2301,n.InterpolateSmooth=2302,n.ZeroCurvatureEnding=2400,n.ZeroSlopeEnding=2401,n.WrapAroundEnding=2402,n.TrianglesDrawMode=0,n.TriangleStripDrawMode=1,n.TriangleFanDrawMode=2,n.LinearEncoding=3e3,n.sRGBEncoding=3001,n.GammaEncoding=3007,n.RGBEEncoding=3002,n.LogLuvEncoding=3003,n.RGBM7Encoding=3004,n.RGBM16Encoding=3005,n.RGBDEncoding=3006,n.BasicDepthPacking=3200,n.RGBADepthPacking=3201,n.Color=function(e){return 3===arguments.length?this.fromArray(arguments):this.set(e)},n.Color.prototype={constructor:n.Color,r:1,g:1,b:1,set:function(e){return e instanceof n.Color?this.copy(e):\"number\"==typeof e?this.setHex(e):\"string\"==typeof e&&this.setStyle(e),this},setScalar:function(e){this.r=e,this.g=e,this.b=e},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+6*(t-e)*(2/3-i):e}return function(t,i,r){if(t=n.Math.euclideanModulo(t,1),i=n.Math.clamp(i,0,1),r=n.Math.clamp(r,0,1),0===i)this.r=this.g=this.b=r;else{var a=.5>=r?r*(1+i):r+i-r*i,o=2*r-a;this.r=e(o,a,t+1/3),this.g=e(o,a,t),this.b=e(o,a,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn(\"THREE.Color: Alpha component of \"+e+\" will be ignored.\")}var i;if(i=/^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec(e)){var r,a=i[1],o=i[2];switch(a){case\"rgb\":case\"rgba\":if(r=/^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case\"hsl\":case\"hsla\":if(r=/^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(o)){var s=parseFloat(r[1])/360,c=parseInt(r[2],10)/100,u=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(s,c,u)}}}else if(i=/^\\#([A-Fa-f0-9]+)$/.exec(e)){var l=i[1],h=l.length;if(3===h)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}if(e&&e.length>0){var l=n.ColorKeywords[e];void 0!==l?this.setHex(l):console.warn(\"THREE.Color: Unknown color \"+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return(\"000000\"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,r=e||{h:0,s:0,l:0},n=this.r,a=this.g,o=this.b,s=Math.max(n,a,o),c=Math.min(n,a,o),u=(c+s)/2;if(c===s)t=0,i=0;else{var l=s-c;switch(i=.5>=u?l/(s+c):l/(2-s-c),s){case n:t=(a-o)/l+(o>a?6:0);break;case a:t=(o-n)/l+2;break;case o:t=(n-a)/l+4}t/=6}return r.h=t,r.s=i,r.l=u,r},getStyle:function(){return\"rgb(\"+(255*this.r|0)+\",\"+(255*this.g|0)+\",\"+(255*this.b|0)+\")\"},offsetHSL:function(e,t,i){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},n.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},n.Quaternion=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1},n.Quaternion.prototype={constructor:n.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof n.Euler==!1)throw new Error(\"THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");var i=Math.cos(e._x/2),r=Math.cos(e._y/2),a=Math.cos(e._z/2),o=Math.sin(e._x/2),s=Math.sin(e._y/2),c=Math.sin(e._z/2),u=e.order;return\"XYZ\"===u?(this._x=o*r*a+i*s*c,this._y=i*s*a-o*r*c,this._z=i*r*c+o*s*a,this._w=i*r*a-o*s*c):\"YXZ\"===u?(this._x=o*r*a+i*s*c,this._y=i*s*a-o*r*c,this._z=i*r*c-o*s*a,this._w=i*r*a+o*s*c):\"ZXY\"===u?(this._x=o*r*a-i*s*c,this._y=i*s*a+o*r*c,this._z=i*r*c+o*s*a,this._w=i*r*a-o*s*c):\"ZYX\"===u?(this._x=o*r*a-i*s*c,this._y=i*s*a+o*r*c,this._z=i*r*c-o*s*a,this._w=i*r*a+o*s*c):\"YZX\"===u?(this._x=o*r*a+i*s*c,this._y=i*s*a+o*r*c,this._z=i*r*c-o*s*a,this._w=i*r*a-o*s*c):\"XZY\"===u&&(this._x=o*r*a-i*s*c,this._y=i*s*a-o*r*c,this._z=i*r*c+o*s*a,this._w=i*r*a+o*s*c),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],a=i[8],o=i[1],s=i[5],c=i[9],u=i[2],l=i[6],h=i[10],d=r+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(l-c)*t,this._y=(a-u)*t,this._z=(o-n)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(l-c)/t,this._x=.25*t,this._y=(n+o)/t,this._z=(a+u)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(a-u)/t,this._x=(n+o)/t,this._y=.25*t,this._z=(c+l)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(o-n)/t,this._x=(a+u)/t,this._y=(c+l)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,i=1e-6;return function(r,a){return void 0===e&&(e=new n.Vector3),t=r.dot(a)+1,i>t?(t=0,Math.abs(r.x)>Math.abs(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,a),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn(\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,a=e._w,o=t._x,s=t._y,c=t._z,u=t._w;return this._x=i*u+a*o+r*c-n*s,this._y=r*u+a*s+n*o-i*c,this._z=n*u+a*c+i*s-r*o,this._w=a*u-i*o-r*s-n*c,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,a=this._w,o=a*e._w+i*e._x+r*e._y+n*e._z;if(0>o?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=i,this._y=r,this._z=n,this;var s=Math.sqrt(1-o*o);if(Math.abs(s)<.001)return this._w=.5*(a+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var c=Math.atan2(s,o),u=Math.sin((1-t)*c)/s,l=Math.sin(t*c)/s;return this._w=a*u+this._w*l,this._x=i*u+this._x*l,this._y=r*u+this._y*l,this._z=n*u+this._z*l,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},Object.assign(n.Quaternion,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,a,o){var s=i[r+0],c=i[r+1],u=i[r+2],l=i[r+3],h=n[a+0],d=n[a+1],p=n[a+2],f=n[a+3];if(l!==f||s!==h||c!==d||u!==p){var m=1-o,g=s*h+c*d+u*p+l*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var M=Math.sqrt(y),A=Math.atan2(M,g*v);m=Math.sin(m*A)/M,o=Math.sin(o*A)/M}var x=o*v;if(s=s*m+h*x,c=c*m+d*x,u=u*m+p*x,l=l*m+f*x,m===1-o){var w=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=w,c*=w,u*=w,l*=w}}e[t]=s,e[t+1]=c,e[t+2]=u,e[t+3]=l}}),n.Vector2=function(e,t){this.x=e||0,this.y=t||0},n.Vector2.prototype={constructor:n.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error(\"index is out of range: \"+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error(\"index is out of range: \"+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):(this.x=0,this.y=0),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e,t;\nreturn function(i,r){return void 0===e&&(e=new n.Vector2,t=new n.Vector2),e.set(i,i),t.set(r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var e=Math.atan2(this.y,this.x);return 0>e&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*i-a*r+e.x,this.y=n*r+a*i+e.y,this}},n.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},n.Vector3.prototype={constructor:n.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error(\"index is out of range: \"+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(\"index is out of range: \"+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.\"),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof n.Euler==!1&&console.error(\"THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.\"),void 0===e&&(e=new n.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,i){return void 0===e&&(e=new n.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,i)),this}}(),applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12],this.y=n[1]*t+n[5]*i+n[9]*r+n[13],this.z=n[2]*t+n[6]*i+n[10]*r+n[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,a=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*a,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*a,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*a,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,a=e.y,o=e.z,s=e.w,c=s*t+a*r-o*i,u=s*i+o*t-n*r,l=s*r+n*i-a*t,h=-n*t-a*i-o*r;return this.x=c*s+h*-n+u*-o-l*-a,this.y=u*s+h*-a+l*-n-c*-o,this.z=l*s+h*-o+c*-a-u*-n,this},project:function(){var e;return function(t){return void 0===e&&(e=new n.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new n.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new n.Vector3,t=new n.Vector3),e.set(i,i,i),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn(\"THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.\"),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-n*o,this.y=n*a-i*s,this.z=i*o-r*a,this},projectOnVector:function(){var e,t;return function(i){return void 0===e&&(e=new n.Vector3),e.copy(i).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new n.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new n.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(n.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromMatrixPosition:function(e){return this.setFromMatrixColumn(e,3)},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){return\"number\"==typeof e&&(console.warn(\"THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).\"),e=arguments[1],t=arguments[0]),this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},n.Vector4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},n.Vector4.prototype={constructor:n.Vector4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error(\"index is out of range: \"+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error(\"index is out of range: \"+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*n,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*n,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*n,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,a=.01,o=.1,s=e.elements,c=s[0],u=s[4],l=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(u-h)<a&&Math.abs(l-f)<a&&Math.abs(p-m)<a){if(Math.abs(u+h)<o&&Math.abs(l+f)<o&&Math.abs(p+m)<o&&Math.abs(c+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var v=(c+1)/2,y=(d+1)/2,M=(g+1)/2,A=(u+h)/4,x=(l+f)/4,w=(p+m)/4;return v>y&&v>M?a>v?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(v),r=A/i,n=x/i):y>M?a>y?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(y),i=A/r,n=w/r):a>M?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(M),i=x/n,r=w/n),this.set(i,r,n,t),this}var E=Math.sqrt((m-p)*(m-p)+(l-f)*(l-f)+(h-u)*(h-u));return Math.abs(E)<.001&&(E=1),this.x=(m-p)/E,this.y=(l-f)/E,this.z=(h-u)/E,this.w=Math.acos((c+d+g-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new n.Vector4,t=new n.Vector4),e.set(i,i,i,i),t.set(r,r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},n.Euler=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||n.Euler.DefaultOrder},n.Euler.RotationOrders=[\"XYZ\",\"YZX\",\"ZXY\",\"XZY\",\"YXZ\",\"ZYX\"],n.Euler.DefaultOrder=\"XYZ\",n.Euler.prototype={constructor:n.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=n.Math.clamp,a=e.elements,o=a[0],s=a[4],c=a[8],u=a[1],l=a[5],h=a[9],d=a[2],p=a[6],f=a[10];return t=t||this._order,\"XYZ\"===t?(this._y=Math.asin(r(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(p,l),this._z=0)):\"YXZ\"===t?(this._x=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(c,f),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-d,o),this._z=0)):\"ZXY\"===t?(this._x=Math.asin(r(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(u,o))):\"ZYX\"===t?(this._y=Math.asin(-r(d,-1,1)),Math.abs(d)<.99999?(this._x=Math.atan2(p,f),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-s,l))):\"YZX\"===t?(this._z=Math.asin(r(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(c,f))):\"XZY\"===t?(this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(p,l),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-h,f),this._y=0)):console.warn(\"THREE.Euler: .setFromRotationMatrix() given unsupported order: \"+t),this._order=t,i!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,i,r){return void 0===e&&(e=new n.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,r),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new n.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new n.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},n.Line3=function(e,t){this.start=void 0!==e?e:new n.Vector3,this.end=void 0!==t?t:new n.Vector3},n.Line3.prototype={constructor:n.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new n.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new n.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new n.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new n.Vector3,t=new n.Vector3;return function(i,r){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var a=t.dot(t),o=t.dot(e),s=o/a;return r&&(s=n.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t),a=i||new n.Vector3;return this.delta(a).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},n.Box2=function(e,t){this.min=void 0!==e?e:new n.Vector2(+1/0,+1/0),this.max=void 0!==t?t:new n.Vector2(-1/0,-1/0)},n.Box2.prototype={constructor:n.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;i>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new n.Vector2;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=+1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new n.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new n.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var i=t||new n.Vector2;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var i=t||new n.Vector2;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector2;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},n.Box3=function(e,t){this.min=void 0!==e?e:new n.Vector3(+1/0,+1/0,+1/0),this.max=void 0!==t?t:new n.Vector3(-1/0,-1/0,-1/0)},n.Box3.prototype={constructor:n.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=+1/0,i=+1/0,r=+1/0,n=-1/0,a=-1/0,o=-1/0,s=0,c=e.length;c>s;s+=3){var u=e[s],l=e[s+1],h=e[s+2];t>u&&(t=u),i>l&&(i=l),r>h&&(r=h),u>n&&(n=u),l>a&&(a=l),h>o&&(o=h)}this.min.set(t,i,r),this.max.set(n,a,o)},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;i>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new n.Vector3;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new n.Vector3;return function(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var r=t.geometry;if(void 0!==r)if(r instanceof n.Geometry)for(var a=r.vertices,o=0,s=a.length;s>o;o++)e.copy(a[o]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e);else if(r instanceof n.BufferGeometry&&void 0!==r.attributes.position)for(var c=r.attributes.position.array,o=0,s=c.length;s>o;o+=3)e.fromArray(c,o),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new n.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new n.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var i=t||new n.Vector3;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},intersectsSphere:function(){var e;return function(t){return void 0===e&&(e=new n.Vector3),this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant},clampPoint:function(e,t){var i=t||new n.Vector3;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector3;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),getBoundingSphere:function(){var e=new n.Vector3;return function(t){var i=t||new n.Sphere;return i.center=this.center(),i.radius=.5*this.size(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},n.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error(\"THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.\")},n.Matrix3.prototype={constructor:n.Matrix3,set:function(e,t,i,r,n,a,o,s,c){var u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=t,u[4]=n,u[5]=s,u[6]=i,u[7]=a,u[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToVector3Array:function(){var e;return function(t,i,r){void 0===e&&(e=new n.Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length);for(var a=0,o=i;r>a;a+=3,o+=3)e.fromArray(t,o),e.applyMatrix3(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function(t,i,r){void 0===e&&(e=new n.Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length/t.itemSize);for(var a=0,o=i;r>a;a++,o++)e.x=t.getX(o),e.y=t.getY(o),e.z=t.getZ(o),e.applyMatrix3(this),t.setXYZ(e.x,e.y,e.z);return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],c=e[7],u=e[8];return t*a*u-t*o*c-i*n*u+i*o*s+r*n*c-r*a*s},getInverse:function(e,t){e instanceof n.Matrix4&&console.error(\"THREE.Matrix3.getInverse no longer takes a Matrix4 argument.\");var i=e.elements,r=this.elements,a=i[0],o=i[1],s=i[2],c=i[3],u=i[4],l=i[5],h=i[6],d=i[7],p=i[8],f=p*u-l*d,m=l*h-p*c,g=d*c-u*h,v=a*f+o*m+s*g;if(0===v){var y=\"THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0\";if(t)throw new Error(y);return console.warn(y),this.identity()}return r[0]=f,r[1]=s*d-p*o,r[2]=l*o-s*u,r[3]=m,r[4]=p*a-s*h,r[5]=s*c-l*a,r[6]=g,r[7]=o*h-d*a,r[8]=u*a-o*c,this.multiplyScalar(1/v)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){return console.warn(\"THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.\"),this.toArray(e,t)},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}},n.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error(\"THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.\")},n.Matrix4.prototype={constructor:n.Matrix4,set:function(e,t,i,r,n,a,o,s,c,u,l,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=c,g[6]=u,g[10]=l,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new n.Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e;return function(t){void 0===e&&(e=new n.Vector3);var i=this.elements,r=t.elements,a=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e instanceof n.Euler==!1&&console.error(\"THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");var t=this.elements,i=e.x,r=e.y,a=e.z,o=Math.cos(i),s=Math.sin(i),c=Math.cos(r),u=Math.sin(r),l=Math.cos(a),h=Math.sin(a);if(\"XYZ\"===e.order){var d=o*l,p=o*h,f=s*l,m=s*h;t[0]=c*l,t[4]=-c*h,t[8]=u,t[1]=p+f*u,t[5]=d-m*u,t[9]=-s*c,t[2]=m-d*u,t[6]=f+p*u,t[10]=o*c}else if(\"YXZ\"===e.order){var g=c*l,v=c*h,y=u*l,M=u*h;t[0]=g+M*s,t[4]=y*s-v,t[8]=o*u,t[1]=o*h,t[5]=o*l,t[9]=-s,t[2]=v*s-y,t[6]=M+g*s,t[10]=o*c}else if(\"ZXY\"===e.order){var g=c*l,v=c*h,y=u*l,M=u*h;t[0]=g-M*s,t[4]=-o*h,t[8]=y+v*s,t[1]=v+y*s,t[5]=o*l,t[9]=M-g*s,t[2]=-o*u,t[6]=s,t[10]=o*c}else if(\"ZYX\"===e.order){var d=o*l,p=o*h,f=s*l,m=s*h;t[0]=c*l,t[4]=f*u-p,t[8]=d*u+m,t[1]=c*h,t[5]=m*u+d,t[9]=p*u-f,t[2]=-u,t[6]=s*c,t[10]=o*c}else if(\"YZX\"===e.order){var A=o*c,x=o*u,w=s*c,E=s*u;t[0]=c*l,t[4]=E-A*h,t[8]=w*h+x,t[1]=h,t[5]=o*l,t[9]=-s*l,t[2]=-u*l,t[6]=x*h+w,t[10]=A-E*h}else if(\"XZY\"===e.order){var A=o*c,x=o*u,w=s*c,E=s*u;t[0]=c*l,t[4]=-h,t[8]=u*l,t[1]=A*h+E,t[5]=o*l,t[9]=x*h-w,t[2]=w*h-x,t[6]=s*l,t[10]=E*h+A}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,a=e.w,o=i+i,s=r+r,c=n+n,u=i*o,l=i*s,h=i*c,d=r*s,p=r*c,f=n*c,m=a*o,g=a*s,v=a*c;\nreturn t[0]=1-(d+f),t[4]=l-v,t[8]=h+g,t[1]=l+v,t[5]=1-(u+f),t[9]=p-m,t[2]=h-g,t[6]=p+m,t[10]=1-(u+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,i;return function(r,a,o){void 0===e&&(e=new n.Vector3),void 0===t&&(t=new n.Vector3),void 0===i&&(i=new n.Vector3);var s=this.elements;return i.subVectors(r,a).normalize(),0===i.lengthSq()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.lengthSq()&&(i.x+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn(\"THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.\"),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,a=i[0],o=i[4],s=i[8],c=i[12],u=i[1],l=i[5],h=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],M=i[11],A=i[15],x=r[0],w=r[4],E=r[8],b=r[12],T=r[1],L=r[5],N=r[9],D=r[13],S=r[2],C=r[6],I=r[10],j=r[14],_=r[3],O=r[7],z=r[11],k=r[15];return n[0]=a*x+o*T+s*S+c*_,n[4]=a*w+o*L+s*C+c*O,n[8]=a*E+o*N+s*I+c*z,n[12]=a*b+o*D+s*j+c*k,n[1]=u*x+l*T+h*S+d*_,n[5]=u*w+l*L+h*C+d*O,n[9]=u*E+l*N+h*I+d*z,n[13]=u*b+l*D+h*j+d*k,n[2]=p*x+f*T+m*S+g*_,n[6]=p*w+f*L+m*C+g*O,n[10]=p*E+f*N+m*I+g*z,n[14]=p*b+f*D+m*j+g*k,n[3]=v*x+y*T+M*S+A*_,n[7]=v*w+y*L+M*C+A*O,n[11]=v*E+y*N+M*I+A*z,n[15]=v*b+y*D+M*j+A*k,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToVector3Array:function(){var e;return function(t,i,r){void 0===e&&(e=new n.Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length);for(var a=0,o=i;r>a;a+=3,o+=3)e.fromArray(t,o),e.applyMatrix4(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function(t,i,r){void 0===e&&(e=new n.Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length/t.itemSize);for(var a=0,o=i;r>a;a++,o++)e.x=t.getX(o),e.y=t.getY(o),e.z=t.getZ(o),e.applyMatrix4(this),t.setXYZ(e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],a=e[1],o=e[5],s=e[9],c=e[13],u=e[2],l=e[6],h=e[10],d=e[14],p=e[3],f=e[7],m=e[11],g=e[15];return p*(+n*s*l-r*c*l-n*o*h+i*c*h+r*o*d-i*s*d)+f*(+t*s*d-t*c*h+n*a*h-r*a*d+r*c*u-n*s*u)+m*(+t*c*l-t*o*d-n*a*l+i*a*d+n*o*u-i*c*u)+g*(-r*o*u-t*s*l+t*o*h+r*a*l-i*a*h+i*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){return console.warn(\"THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.\"),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new n.Vector3),console.warn(\"THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.\"),e.setFromMatrixColumn(this,3)}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],a=r[1],o=r[2],s=r[3],c=r[4],u=r[5],l=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],M=r[15],A=p*y*h-v*f*h+v*l*m-u*y*m-p*l*M+u*f*M,x=g*f*h-d*y*h-g*l*m+c*y*m+d*l*M-c*f*M,w=d*v*h-g*p*h+g*u*m-c*v*m-d*u*M+c*p*M,E=g*p*l-d*v*l-g*u*f+c*v*f+d*u*y-c*p*y,b=n*A+a*x+o*w+s*E;if(0===b){var T=\"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\";if(t)throw new Error(T);return console.warn(T),this.identity()}return i[0]=A,i[1]=v*f*s-p*y*s-v*o*m+a*y*m+p*o*M-a*f*M,i[2]=u*y*s-v*l*s+v*o*h-a*y*h-u*o*M+a*l*M,i[3]=p*l*s-u*f*s-p*o*h+a*f*h+u*o*m-a*l*m,i[4]=x,i[5]=d*y*s-g*f*s+g*o*m-n*y*m-d*o*M+n*f*M,i[6]=g*l*s-c*y*s-g*o*h+n*y*h+c*o*M-n*l*M,i[7]=c*f*s-d*l*s+d*o*h-n*f*h-c*o*m+n*l*m,i[8]=w,i[9]=g*p*s-d*v*s-g*a*m+n*v*m+d*a*M-n*p*M,i[10]=c*v*s-g*u*s+g*a*h-n*v*h-c*a*M+n*u*M,i[11]=d*u*s-c*p*s-d*a*h+n*p*h+c*a*m-n*u*m,i[12]=E,i[13]=d*v*o-g*p*o+g*a*f-n*v*f-d*a*y+n*p*y,i[14]=g*u*o-c*v*o-g*a*l+n*v*l+c*a*y-n*u*y,i[15]=c*p*o-d*u*o+d*a*l-n*p*l-c*a*f+n*u*f,this.multiplyScalar(1/b)},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,a=e.x,o=e.y,s=e.z,c=n*a,u=n*o;return this.set(c*a+i,c*o-r*s,c*s+r*o,0,c*o+r*s,u*o+i,u*s-r*a,0,c*s-r*o,u*s+r*a,n*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e,t;return function(i,r,a){void 0===e&&(e=new n.Vector3),void 0===t&&(t=new n.Matrix4);var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),c=e.set(o[4],o[5],o[6]).length(),u=e.set(o[8],o[9],o[10]).length(),l=this.determinant();0>l&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var h=1/s,d=1/c,p=1/u;return t.elements[0]*=h,t.elements[1]*=h,t.elements[2]*=h,t.elements[4]*=d,t.elements[5]*=d,t.elements[6]*=d,t.elements[8]*=p,t.elements[9]*=p,t.elements[10]*=p,r.setFromRotationMatrix(t),a.x=s,a.y=c,a.z=u,this}}(),makeFrustum:function(e,t,i,r,n,a){var o=this.elements,s=2*n/(t-e),c=2*n/(r-i),u=(t+e)/(t-e),l=(r+i)/(r-i),h=-(a+n)/(a-n),d=-2*a*n/(a-n);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,i,r){var a=i*Math.tan(n.Math.DEG2RAD*e*.5),o=-a,s=o*t,c=a*t;return this.makeFrustum(s,c,o,a,i,r)},makeOrthographic:function(e,t,i,r,n,a){var o=this.elements,s=1/(t-e),c=1/(i-r),u=1/(a-n),l=(t+e)*s,h=(i+r)*c,d=(a+n)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;16>r;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},n.Ray=function(e,t){this.origin=void 0!==e?e:new n.Vector3,this.direction=void 0!==t?t:new n.Vector3},n.Ray.prototype={constructor:n.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var i=t||new n.Vector3;return i.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){this.direction.copy(e).sub(this.origin).normalize()},recast:function(){var e=new n.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new n.Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);return 0>r?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new n.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return 0>i?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new n.Vector3,t=new n.Vector3,i=new n.Vector3;return function(r,n,a,o){e.copy(r).add(n).multiplyScalar(.5),t.copy(n).sub(r).normalize(),i.copy(this.origin).sub(e);var s,c,u,l,h=.5*r.distanceTo(n),d=-this.direction.dot(t),p=i.dot(this.direction),f=-i.dot(t),m=i.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(s=d*f-p,c=d*p-f,l=h*g,s>=0)if(c>=-l)if(l>=c){var v=1/g;s*=v,c*=v,u=s*(s+d*c+2*p)+c*(d*s+c+2*f)+m}else c=h,s=Math.max(0,-(d*c+p)),u=-s*s+c*(c+2*f)+m;else c=-h,s=Math.max(0,-(d*c+p)),u=-s*s+c*(c+2*f)+m;else-l>=c?(s=Math.max(0,-(-d*h+p)),c=s>0?-h:Math.min(Math.max(-h,-f),h),u=-s*s+c*(c+2*f)+m):l>=c?(s=0,c=Math.min(Math.max(-h,-f),h),u=c*(c+2*f)+m):(s=Math.max(0,-(d*h+p)),c=s>0?h:Math.min(Math.max(-h,-f),h),u=-s*s+c*(c+2*f)+m);else c=d>0?-h:h,s=Math.max(0,-(d*c+p)),u=-s*s+c*(c+2*f)+m;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(t).multiplyScalar(c).add(e),u}}(),intersectSphere:function(){var e=new n.Vector3;return function(t,i){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),n=e.dot(e)-r*r,a=t.radius*t.radius;if(n>a)return null;var o=Math.sqrt(a-n),s=r-o,c=r+o;return 0>s&&0>c?null:0>s?this.at(c,i):this.at(s,i)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var i=e.normal.dot(this.direction);return 0>i*t?!0:!1},intersectBox:function(e,t){var i,r,n,a,o,s,c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,h=this.origin;return c>=0?(i=(e.min.x-h.x)*c,r=(e.max.x-h.x)*c):(i=(e.max.x-h.x)*c,r=(e.min.x-h.x)*c),u>=0?(n=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(n=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),i>a||n>r?null:((n>i||i!==i)&&(i=n),(r>a||r!==r)&&(r=a),l>=0?(o=(e.min.z-h.z)*l,s=(e.max.z-h.z)*l):(o=(e.max.z-h.z)*l,s=(e.min.z-h.z)*l),i>s||o>r?null:((o>i||i!==i)&&(i=o),(r>s||r!==r)&&(r=s),0>r?null:this.at(i>=0?i:r,t)))},intersectsBox:function(){var e=new n.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new n.Vector3,t=new n.Vector3,i=new n.Vector3,r=new n.Vector3;return function(n,a,o,s,c){t.subVectors(a,n),i.subVectors(o,n),r.crossVectors(t,i);var u,l=this.direction.dot(r);if(l>0){if(s)return null;u=1}else{if(!(0>l))return null;u=-1,l=-l}e.subVectors(this.origin,n);var h=u*this.direction.dot(i.crossVectors(e,i));if(0>h)return null;var d=u*this.direction.dot(t.cross(e));if(0>d)return null;if(h+d>l)return null;var p=-u*e.dot(r);return 0>p?null:this.at(p/l,c)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},n.Sphere=function(e,t){this.center=void 0!==e?e:new n.Vector3,this.radius=void 0!==t?t:0},n.Sphere.prototype={constructor:n.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new n.Box3;return function(t,i){var r=this.center;void 0!==i?r.copy(i):e.setFromPoints(t).center(r);for(var n=0,a=0,o=t.length;o>a;a++)n=Math.max(n,r.distanceToSquared(t[a]));return this.radius=Math.sqrt(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(this.center.dot(e.normal)-e.constant)<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new n.Vector3;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new n.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},n.Frustum=function(e,t,i,r,a,o){this.planes=[void 0!==e?e:new n.Plane,void 0!==t?t:new n.Plane,void 0!==i?i:new n.Plane,void 0!==r?r:new n.Plane,void 0!==a?a:new n.Plane,void 0!==o?o:new n.Plane]},n.Frustum.prototype={constructor:n.Frustum,set:function(e,t,i,r,n,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],a=i[2],o=i[3],s=i[4],c=i[5],u=i[6],l=i[7],h=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(o-r,l-s,f-h,y-m).normalize(),t[1].setComponents(o+r,l+s,f+h,y+m).normalize(),t[2].setComponents(o+n,l+c,f+d,y+g).normalize(),t[3].setComponents(o-n,l-c,f-d,y-g).normalize(),t[4].setComponents(o-a,l-u,f-p,y-v).normalize(),t[5].setComponents(o+a,l+u,f+p,y+v).normalize(),this},intersectsObject:function(){var e=new n.Sphere;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;6>n;n++){var a=t[n].distanceToPoint(i);if(r>a)return!1}return!0},intersectsBox:function(){var e=new n.Vector3,t=new n.Vector3;return function(i){for(var r=this.planes,n=0;6>n;n++){var a=r[n];e.x=a.normal.x>0?i.min.x:i.max.x,t.x=a.normal.x>0?i.max.x:i.min.x,e.y=a.normal.y>0?i.min.y:i.max.y,t.y=a.normal.y>0?i.max.y:i.min.y,e.z=a.normal.z>0?i.min.z:i.max.z,t.z=a.normal.z>0?i.max.z:i.min.z;var o=a.distanceToPoint(e),s=a.distanceToPoint(t);if(0>o&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}},n.Plane=function(e,t){this.normal=void 0!==e?e:new n.Vector3(1,0,0),this.constant=void 0!==t?t:0},n.Plane.prototype={constructor:n.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new n.Vector3,t=new n.Vector3;return function(i,r,n){var a=e.subVectors(n,r).cross(t.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e),r=t||new n.Vector3;return r.copy(this.normal).multiplyScalar(i)},intersectLine:function(){var e=new n.Vector3;return function(t,i){var r=i||new n.Vector3,a=t.delta(e),o=this.normal.dot(a);if(0===o)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;return 0>s||s>1?void 0:r.copy(a).multiplyScalar(s).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return 0>t&&i>0||0>i&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){var t=e||new n.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new n.Vector3,t=new n.Matrix3;return function(i,r){var n=this.coplanarPoint(e).applyMatrix4(i),a=r||t.getNormalMatrix(i),o=this.normal.applyMatrix3(a).normalize();return this.constant=-n.dot(o),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},n.Spherical=function(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this},n.Spherical.prototype={constructor:n.Spherical,set:function(e,t,i){this.radius=e,this.phi=t,this.theta=i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius.copy(e.radius),this.phi.copy(e.phi),this.theta.copy(e.theta),this},makeSafe:function(){var e=1e-6;this.phi=Math.max(e,Math.min(Math.PI-e,this.phi))},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(n.Math.clamp(e.y/this.radius,-1,1))),this}},n.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\".split(\"\"),i=new Array(36),r=0;return function(){for(var n=0;36>n;n++)8===n||13===n||18===n||23===n?i[n]=\"-\":14===n?i[n]=\"4\":(2>=r&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join(\"\")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},smoothstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return console.warn(\"THREE.Math.random16() has been deprecated. Use Math.random() instead.\"),Math.random()},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*n.Math.DEG2RAD},radToDeg:function(e){return e*n.Math.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},n.Spline=function(e){function t(e,t,i,r,n,a,o){var s=.5*(i-e),c=.5*(r-t);return(2*(t-i)+s+c)*o+(-3*(t-i)-2*s-c)*a+s*n+t}this.points=e;var i,r,a,o,s,c,u,l,h,d=[],p={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,r=Math.floor(i),a=i-r,d[0]=0===r?r:r-1,d[1]=r,d[2]=r>this.points.length-2?this.points.length-1:r+1,d[3]=r>this.points.length-3?this.points.length-1:r+2,c=this.points[d[0]],u=this.points[d[1]],l=this.points[d[2]],h=this.points[d[3]],o=a*a,s=a*o,p.x=t(c.x,u.x,l.x,h.x,a,o,s),p.y=t(c.y,u.y,l.y,h.y,a,o,s),p.z=t(c.z,u.z,l.z,h.z,a,o,s),p},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;i>e;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r,a,o=0,s=0,c=0,u=new n.Vector3,l=new n.Vector3,h=[],d=0;for(h[0]=0,e||(e=100),r=this.points.length*e,u.copy(this.points[0]),t=1;r>t;t++)i=t/r,a=this.getPoint(i),l.copy(a),d+=l.distanceTo(u),u.copy(a),o=(this.points.length-1)*i,s=Math.floor(o),s!==c&&(h[s]=d,c=s);return h[h.length]=d,{chunks:h,total:d}},this.reparametrizeByArcLength=function(e){var t,i,r,a,o,s,c,u,l=[],h=new n.Vector3,d=this.getLength();for(l.push(h.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=d.chunks[t]-d.chunks[t-1],c=Math.ceil(e*s/d.total),a=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;c-1>i;i++)r=a+i*(1/c)*(o-a),u=this.getPoint(r),l.push(h.copy(u).clone());l.push(h.copy(this.points[t]).clone())}this.points=l}},n.Triangle=function(e,t,i){this.a=void 0!==e?e:new n.Vector3,this.b=void 0!==t?t:new n.Vector3,this.c=void 0!==i?i:new n.Vector3},n.Triangle.normal=function(){var e=new n.Vector3;return function(t,i,r,a){var o=a||new n.Vector3;o.subVectors(r,i),e.subVectors(t,i),o.cross(e);var s=o.lengthSq();return s>0?o.multiplyScalar(1/Math.sqrt(s)):o.set(0,0,0)}}(),n.Triangle.barycoordFromPoint=function(){var e=new n.Vector3,t=new n.Vector3,i=new n.Vector3;return function(r,a,o,s,c){e.subVectors(s,a),t.subVectors(o,a),i.subVectors(r,a);var u=e.dot(e),l=e.dot(t),h=e.dot(i),d=t.dot(t),p=t.dot(i),f=u*d-l*l,m=c||new n.Vector3;if(0===f)return m.set(-2,-1,-1);var g=1/f,v=(d*h-l*p)*g,y=(u*p-l*h)*g;return m.set(1-v-y,y,v)}}(),n.Triangle.containsPoint=function(){var e=new n.Vector3;return function(t,i,r,a){var o=n.Triangle.barycoordFromPoint(t,i,r,a,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),n.Triangle.prototype={constructor:n.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new n.Vector3,t=new n.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new n.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return n.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new n.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return n.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return n.Triangle.containsPoint(e,this.a,this.b,this.c)},closestPointToPoint:function(){var e,t,i,r;return function(a,o){void 0===e&&(e=new n.Plane,t=[new n.Line3,new n.Line3,new n.Line3],i=new n.Vector3,r=new n.Vector3);var s=o||new n.Vector3,c=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(a,i),this.containsPoint(i)===!0)s.copy(i);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var u=0;u<t.length;u++){t[u].closestPointToPoint(i,!0,r);var l=i.distanceToSquared(r);c>l&&(c=l,s.copy(r))}}return s}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},n.Interpolant=function(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i},n.Interpolant.prototype={constructor:n.Interpolant,evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var a;i:{r:if(!(r>e)){for(var o=i+2;;){if(void 0===r){if(n>e)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===o)break;if(n=r,r=t[++i],r>e)break t}a=t.length;break i}{if(e>=n)break e;var s=t[1];s>e&&(i=2,n=s);for(var o=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}a=i,i=0}}for(;a>i;){var c=i+a>>>1;e<t[c]?a=c:i=c+1}if(r=t[i],n=t[i-1],void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r,a=0;a!==r;++a)t[a]=i[n+a];return t},interpolate_:function(){throw new Error(\"call to abstract method\")},intervalChanged_:function(){}},Object.assign(n.Interpolant.prototype,{beforeStart_:n.Interpolant.prototype.copySampleValue_,afterEnd_:n.Interpolant.prototype.copySampleValue_}),n.CubicInterpolant=function(e,t,i,r){n.Interpolant.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0},n.CubicInterpolant.prototype=Object.assign(Object.create(n.Interpolant.prototype),{constructor:n.CubicInterpolant,DefaultSettings_:{endingStart:n.ZeroCurvatureEnding,endingEnd:n.ZeroCurvatureEnding},intervalChanged_:function(e,t,i){var r=this.parameterPositions,a=e-2,o=e+1,s=r[a],c=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case n.ZeroSlopeEnding:a=e,s=2*t-i;break;case n.WrapAroundEnding:a=r.length-2,s=t+r[a]-r[a+1];break;default:a=e,s=i}if(void 0===c)switch(this.getSettings_().endingEnd){case n.ZeroSlopeEnding:o=e,c=2*i-t;break;case n.WrapAroundEnding:o=1,c=i+r[1]-r[0];break;default:o=e-1,c=t}var u=.5*(i-t),l=this.valueSize;this._weightPrev=u/(t-s),this._weightNext=u/(c-i),this._offsetPrev=a*l,this._offsetNext=o*l},interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,u=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,M=d*m-d*f,A=0;A!==o;++A)n[A]=g*a[u+A]+v*a[c+A]+y*a[s+A]+M*a[l+A];return n}}),n.DiscreteInterpolant=function(e,t,i,r){n.Interpolant.call(this,e,t,i,r)},n.DiscreteInterpolant.prototype=Object.assign(Object.create(n.Interpolant.prototype),{constructor:n.DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}}),n.LinearInterpolant=function(e,t,i,r){n.Interpolant.call(this,e,t,i,r)},n.LinearInterpolant.prototype=Object.assign(Object.create(n.Interpolant.prototype),{constructor:n.LinearInterpolant,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,u=(i-t)/(r-t),l=1-u,h=0;h!==o;++h)n[h]=a[c+h]*l+a[s+h]*u;return n}}),n.QuaternionLinearInterpolant=function(e,t,i,r){n.Interpolant.call(this,e,t,i,r)},n.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(n.Interpolant.prototype),{constructor:n.QuaternionLinearInterpolant,interpolate_:function(e,t,i,r){for(var a=this.resultBuffer,o=this.sampleValues,s=this.valueSize,c=e*s,u=(i-t)/(r-t),l=c+s;c!==l;c+=4)n.Quaternion.slerpFlat(a,0,o,c-s,o,c,u);return a}}),n.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},n.Clock.prototype={constructor:n.Clock,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=(performance||Date).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}},n.EventDispatcher=function(){},n.EventDispatcher.prototype={constructor:n.EventDispatcher,apply:function(e){e.addEventListener=n.EventDispatcher.prototype.addEventListener,e.hasEventListener=n.EventDispatcher.prototype.hasEventListener,e.removeEventListener=n.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=n.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,r=i[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,i=t[e.type];if(void 0!==i){e.target=this;for(var r=[],n=i.length,a=0;n>a;a++)r[a]=i[a];for(var a=0;n>a;a++)r[a].call(this,e)}}}},n.Layers=function(){this.mask=1},n.Layers.prototype={constructor:n.Layers,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)},test:function(e){return 0!==(this.mask&e.mask)}},function(e){function t(e,t){return e.distance-t.distance}function i(e,t,r,n){if(e.visible!==!1&&(e.raycast(t,r),n===!0))for(var a=e.children,o=0,s=a.length;s>o;o++)i(a[o],t,r,!0)}e.Raycaster=function(t,i,r,n){this.ray=new e.Ray(t,i),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn(\"THREE.Raycaster: params.PointCloud has been renamed to params.Points.\"),this.Points}}})},e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,i){i instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize()):i instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld)):console.error(\"THREE.Raycaster: Unsupported camera type.\")},intersectObject:function(e,r){var n=[];return i(e,this,n,r),n.sort(t),n},intersectObjects:function(e,r){var n=[];if(Array.isArray(e)===!1)return console.warn(\"THREE.Raycaster.intersectObjects: objects is not an Array.\"),n;for(var a=0,o=e.length;o>a;a++)i(e[a],this,n,r);return n.sort(t),n}}}(n),n.Object3D=function(){function e(){a.setFromEuler(r,!1)}function t(){r.setFromQuaternion(a,void 0,!1)}Object.defineProperty(this,\"id\",{value:n.Object3DIdCount++}),this.uuid=n.Math.generateUUID(),this.name=\"\",this.type=\"Object3D\",this.parent=null,this.children=[],this.up=n.Object3D.DefaultUp.clone();var i=new n.Vector3,r=new n.Euler,a=new n.Quaternion,o=new n.Vector3(1,1,1);r.onChange(e),a.onChange(t),Object.defineProperties(this,{position:{enumerable:!0,value:i},rotation:{enumerable:!0,value:r},quaternion:{enumerable:!0,value:a},scale:{enumerable:!0,value:o},modelViewMatrix:{value:new n.Matrix4},normalMatrix:{value:new n.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.matrixAutoUpdate=n.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new n.Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},n.Object3D.DefaultUp=new n.Vector3(0,1,0),n.Object3D.DefaultMatrixAutoUpdate=!0,n.Object3D.prototype={constructor:n.Object3D,applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new n.Quaternion;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this\n}}(),rotateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new n.Vector3;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new n.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new n.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error(\"THREE.Object3D.add: object can't be added as a child of itself.\",e),this):(e instanceof n.Object3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:\"added\"}),this.children.push(e)):console.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var i=this.children.indexOf(e);-1!==i&&(e.parent=null,e.dispatchEvent({type:\"removed\"}),this.children.splice(i,1))},getObjectById:function(e){return this.getObjectByProperty(\"id\",e)},getObjectByName:function(e){return this.getObjectByProperty(\"name\",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;r>i;i++){var n=this.children[i],a=n.getObjectByProperty(e,t);if(void 0!==a)return a}return void 0},getWorldPosition:function(e){var t=e||new n.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new n.Vector3,t=new n.Vector3;return function(i){var r=i||new n.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldRotation:function(){var e=new n.Quaternion;return function(t){var i=t||new n.Euler;return this.getWorldQuaternion(e),i.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new n.Vector3,t=new n.Quaternion;return function(i){var r=i||new n.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new n.Quaternion;return function(t){var i=t||new n.Vector3;return this.getWorldQuaternion(e),i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;r>i;i++)t[i].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,i=0,r=t.length;r>i;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){function t(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}var i=void 0===e||\"\"===e,r={};i&&(e={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.4,type:\"Object\",generator:\"Object3D.toJSON\"});var n={};if(n.uuid=this.uuid,n.type=this.type,\"\"!==this.name&&(n.name=this.name),\"{}\"!==JSON.stringify(this.userData)&&(n.userData=this.userData),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),n.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===e.geometries[this.geometry.uuid]&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),n.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===e.materials[this.material.uuid]&&(e.materials[this.material.uuid]=this.material.toJSON(e)),n.material=this.material.uuid),this.children.length>0){n.children=[];for(var a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(i){var o=t(e.geometries),s=t(e.materials),c=t(e.textures),u=t(e.images);o.length>0&&(r.geometries=o),s.length>0&&(r.materials=s),c.length>0&&(r.textures=c),u.length>0&&(r.images=u)}return r.object=n,r},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.rotationAutoUpdate=e.rotationAutoUpdate,this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}return this}},n.EventDispatcher.prototype.apply(n.Object3D.prototype),n.Object3DIdCount=0,n.Face3=function(e,t,i,r,a,o){this.a=e,this.b=t,this.c=i,this.normal=r instanceof n.Vector3?r:new n.Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=a instanceof n.Color?a:new n.Color,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=void 0!==o?o:0},n.Face3.prototype={constructor:n.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;i>t;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,i=e.vertexColors.length;i>t;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},n.BufferAttribute=function(e,t,i){this.uuid=n.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0,this.normalized=i===!0},n.BufferAttribute.prototype={constructor:n.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;n>r;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,a=e.length;a>r;r++){var o=e[r];void 0===o&&(console.warn(\"THREE.BufferAttribute.copyColorsArray(): color is undefined\",r),o=new n.Color),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyIndicesArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;n>r;r++){var a=e[r];t[i++]=a.a,t[i++]=a.b,t[i++]=a.c}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,a=e.length;a>r;r++){var o=e[r];void 0===o&&(console.warn(\"THREE.BufferAttribute.copyVector2sArray(): vector is undefined\",r),o=new n.Vector2),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,a=e.length;a>r;r++){var o=e[r];void 0===o&&(console.warn(\"THREE.BufferAttribute.copyVector3sArray(): vector is undefined\",r),o=new n.Vector3),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,a=e.length;a>r;r++){var o=e[r];void 0===o&&(console.warn(\"THREE.BufferAttribute.copyVector4sArray(): vector is undefined\",r),o=new n.Vector4),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},clone:function(){return(new this.constructor).copy(this)}},n.Int8Attribute=function(e,t){return new n.BufferAttribute(new Int8Array(e),t)},n.Uint8Attribute=function(e,t){return new n.BufferAttribute(new Uint8Array(e),t)},n.Uint8ClampedAttribute=function(e,t){return new n.BufferAttribute(new Uint8ClampedArray(e),t)},n.Int16Attribute=function(e,t){return new n.BufferAttribute(new Int16Array(e),t)},n.Uint16Attribute=function(e,t){return new n.BufferAttribute(new Uint16Array(e),t)},n.Int32Attribute=function(e,t){return new n.BufferAttribute(new Int32Array(e),t)},n.Uint32Attribute=function(e,t){return new n.BufferAttribute(new Uint32Array(e),t)},n.Float32Attribute=function(e,t){return new n.BufferAttribute(new Float32Array(e),t)},n.Float64Attribute=function(e,t){return new n.BufferAttribute(new Float64Array(e),t)},n.DynamicBufferAttribute=function(e,t){return console.warn(\"THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.\"),new n.BufferAttribute(e,t).setDynamic(!0)},n.InstancedBufferAttribute=function(e,t,i){n.BufferAttribute.call(this,e,t),this.meshPerAttribute=i||1},n.InstancedBufferAttribute.prototype=Object.create(n.BufferAttribute.prototype),n.InstancedBufferAttribute.prototype.constructor=n.InstancedBufferAttribute,n.InstancedBufferAttribute.prototype.copy=function(e){return n.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},n.InterleavedBuffer=function(e,t){this.uuid=n.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},n.InterleavedBuffer.prototype={constructor:n.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;n>r;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)}},n.InstancedInterleavedBuffer=function(e,t,i){n.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=i||1},n.InstancedInterleavedBuffer.prototype=Object.create(n.InterleavedBuffer.prototype),n.InstancedInterleavedBuffer.prototype.constructor=n.InstancedInterleavedBuffer,n.InstancedInterleavedBuffer.prototype.copy=function(e){return n.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},n.InterleavedBufferAttribute=function(e,t,i){this.uuid=n.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=i},n.InterleavedBufferAttribute.prototype={constructor:n.InterleavedBufferAttribute,get length(){return console.warn(\"THREE.BufferAttribute: .length has been deprecated. Please use .count.\"),this.array.length},get count(){return this.data.count},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}},n.Geometry=function(){Object.defineProperty(this,\"id\",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name=\"\",this.type=\"Geometry\",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},n.Geometry.prototype={constructor:n.Geometry,applyMatrix:function(e){for(var t=(new n.Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;r>i;i++){var a=this.vertices[i];a.applyMatrix4(e)}for(var i=0,r=this.faces.length;r>i;i++){var o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(var s=0,c=o.vertexNormals.length;c>s;s++)o.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e;return function(t){return void 0===e&&(e=new n.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new n.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new n.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,i,r){return void 0===e&&(e=new n.Matrix4),e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,i,r){return void 0===e&&(e=new n.Matrix4),e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new n.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,r,a){var o=void 0!==s?[h[e].clone(),h[t].clone(),h[r].clone()]:[],f=void 0!==c?[i.colors[e].clone(),i.colors[t].clone(),i.colors[r].clone()]:[],m=new n.Face3(e,t,r,o,f,a);i.faces.push(m),void 0!==u&&i.faceVertexUvs[0].push([d[e].clone(),d[t].clone(),d[r].clone()]),void 0!==l&&i.faceVertexUvs[1].push([p[e].clone(),p[t].clone(),p[r].clone()])}var i=this,r=null!==e.index?e.index.array:void 0,a=e.attributes,o=a.position.array,s=void 0!==a.normal?a.normal.array:void 0,c=void 0!==a.color?a.color.array:void 0,u=void 0!==a.uv?a.uv.array:void 0,l=void 0!==a.uv2?a.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var h=[],d=[],p=[],f=0,m=0;f<o.length;f+=3,m+=2)i.vertices.push(new n.Vector3(o[f],o[f+1],o[f+2])),void 0!==s&&h.push(new n.Vector3(s[f],s[f+1],s[f+2])),void 0!==c&&i.colors.push(new n.Color(c[f],c[f+1],c[f+2])),void 0!==u&&d.push(new n.Vector2(u[m],u[m+1])),void 0!==l&&p.push(new n.Vector2(l[m],l[m+1]));if(void 0!==r){var g=e.groups;if(g.length>0)for(var f=0;f<g.length;f++)for(var v=g[f],y=v.start,M=v.count,m=y,A=y+M;A>m;m+=3)t(r[m],r[m+1],r[m+2],v.materialIndex);else for(var f=0;f<r.length;f+=3)t(r[f],r[f+1],r[f+2])}else for(var f=0;f<o.length/3;f+=3)t(f,f+1,f+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new n.Matrix4;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new n.Vector3,t=new n.Vector3,i=0,r=this.faces.length;r>i;i++){var a=this.faces[i],o=this.vertices[a.a],s=this.vertices[a.b],c=this.vertices[a.c];e.subVectors(c,s),t.subVectors(o,s),e.cross(t),e.normalize(),a.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);var t,i,r,a,o,s;for(s=new Array(this.vertices.length),t=0,i=this.vertices.length;i>t;t++)s[t]=new n.Vector3;if(e){var c,u,l,h=new n.Vector3,d=new n.Vector3;for(r=0,a=this.faces.length;a>r;r++)o=this.faces[r],c=this.vertices[o.a],u=this.vertices[o.b],l=this.vertices[o.c],h.subVectors(l,u),d.subVectors(c,u),h.cross(d),s[o.a].add(h),s[o.b].add(h),s[o.c].add(h)}else for(r=0,a=this.faces.length;a>r;r++)o=this.faces[r],s[o.a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,i=this.vertices.length;i>t;t++)s[t].normalize();for(r=0,a=this.faces.length;a>r;r++){o=this.faces[r];var p=o.vertexNormals;3===p.length?(p[0].copy(s[o.a]),p[1].copy(s[o.b]),p[2].copy(s[o.c])):(p[0]=s[o.a].clone(),p[1]=s[o.b].clone(),p[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,r,a;for(i=0,r=this.faces.length;r>i;i++)for(a=this.faces[i],a.__originalFaceNormal?a.__originalFaceNormal.copy(a.normal):a.__originalFaceNormal=a.normal.clone(),a.__originalVertexNormals||(a.__originalVertexNormals=[]),e=0,t=a.vertexNormals.length;t>e;e++)a.__originalVertexNormals[e]?a.__originalVertexNormals[e].copy(a.vertexNormals[e]):a.__originalVertexNormals[e]=a.vertexNormals[e].clone();var o=new n.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s,c,u=this.morphNormals[e].faceNormals,l=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;r>i;i++)s=new n.Vector3,c={a:new n.Vector3,b:new n.Vector3,c:new n.Vector3},u.push(s),l.push(c)}var h=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var s,c;for(i=0,r=this.faces.length;r>i;i++)a=this.faces[i],s=h.faceNormals[i],c=h.vertexNormals[i],s.copy(a.normal),c.a.copy(a.vertexNormals[0]),c.b.copy(a.vertexNormals[1]),c.c.copy(a.vertexNormals[2])}for(i=0,r=this.faces.length;r>i;i++)a=this.faces[i],a.normal=a.__originalFaceNormal,a.vertexNormals=a.__originalVertexNormals},computeTangents:function(){console.warn(\"THREE.Geometry: .computeTangents() has been removed.\")},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;r>i;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new n.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e instanceof n.Geometry==!1)return console.error(\"THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.\",e),void 0;var r,a=this.vertices.length,o=this.vertices,s=e.vertices,c=this.faces,u=e.faces,l=this.faceVertexUvs[0],h=e.faceVertexUvs[0];void 0===i&&(i=0),void 0!==t&&(r=(new n.Matrix3).getNormalMatrix(t));for(var d=0,p=s.length;p>d;d++){var f=s[d],m=f.clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(d=0,p=u.length;p>d;d++){var g,v,y,M=u[d],A=M.vertexNormals,x=M.vertexColors;g=new n.Face3(M.a+a,M.b+a,M.c+a),g.normal.copy(M.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var w=0,E=A.length;E>w;w++)v=A[w].clone(),void 0!==r&&v.applyMatrix3(r).normalize(),g.vertexNormals.push(v);g.color.copy(M.color);for(var w=0,E=x.length;E>w;w++)y=x[w],g.vertexColors.push(y.clone());g.materialIndex=M.materialIndex+i,c.push(g)}for(d=0,p=h.length;p>d;d++){var b=h[d],T=[];if(void 0!==b){for(var w=0,E=b.length;E>w;w++)T.push(b[w].clone());l.push(T)}}},mergeMesh:function(e){return e instanceof n.Mesh==!1?(console.error(\"THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.\",e),void 0):(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix),void 0)},mergeVertices:function(){var e,t,i,r,n,a,o,s,c={},u=[],l=[],h=4,d=Math.pow(10,h);for(i=0,r=this.vertices.length;r>i;i++)e=this.vertices[i],t=Math.round(e.x*d)+\"_\"+Math.round(e.y*d)+\"_\"+Math.round(e.z*d),void 0===c[t]?(c[t]=i,u.push(this.vertices[i]),l[i]=u.length-1):l[i]=l[c[t]];var p=[];for(i=0,r=this.faces.length;r>i;i++){n=this.faces[i],n.a=l[n.a],n.b=l[n.b],n.c=l[n.c],a=[n.a,n.b,n.c];for(var f=-1,m=0;3>m;m++)if(a[m]===a[(m+1)%3]){f=m,p.push(i);break}}for(i=p.length-1;i>=0;i--){var g=p[i];for(this.faces.splice(g,1),o=0,s=this.faceVertexUvs.length;s>o;o++)this.faceVertexUvs[o].splice(g,1)}var v=this.vertices.length-u.length;return this.vertices=u,v},sortFacesByMaterialIndex:function(){function e(e,t){return e.materialIndex-t.materialIndex}for(var t=this.faces,i=t.length,r=0;i>r;r++)t[r]._id=r;t.sort(e);var n,a,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===i&&(n=[]),s&&s.length===i&&(a=[]);for(var r=0;i>r;r++){var c=t[r]._id;n&&n.push(o[c]),a&&a.push(s[c])}n&&(this.faceVertexUvs[0]=n),a&&(this.faceVertexUvs[1]=a)},toJSON:function(){function e(e,t,i){return i?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/3,h.push(e.x,e.y,e.z),d[t])}function i(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==f[t]?f[t]:(f[t]=p.length,p.push(e.getHex()),f[t])}function r(e){var t=e.x.toString()+e.y.toString();return void 0!==g[t]?g[t]:(g[t]=m.length/2,m.push(e.x,e.y),g[t])}var n={metadata:{version:4.4,type:\"Geometry\",generator:\"Geometry.toJSON\"}};if(n.uuid=this.uuid,n.type=this.type,\"\"!==this.name&&(n.name=this.name),void 0!==this.parameters){var a=this.parameters;for(var o in a)void 0!==a[o]&&(n[o]=a[o]);return n}for(var s=[],c=0;c<this.vertices.length;c++){var u=this.vertices[c];s.push(u.x,u.y,u.z)}for(var l=[],h=[],d={},p=[],f={},m=[],g={},c=0;c<this.faces.length;c++){var v=this.faces[c],y=!0,M=!1,A=void 0!==this.faceVertexUvs[0][c],x=v.normal.length()>0,w=v.vertexNormals.length>0,E=1!==v.color.r||1!==v.color.g||1!==v.color.b,b=v.vertexColors.length>0,T=0;if(T=e(T,0,0),T=e(T,1,y),T=e(T,2,M),T=e(T,3,A),T=e(T,4,x),T=e(T,5,w),T=e(T,6,E),T=e(T,7,b),l.push(T),l.push(v.a,v.b,v.c),l.push(v.materialIndex),A){var L=this.faceVertexUvs[0][c];l.push(r(L[0]),r(L[1]),r(L[2]))}if(x&&l.push(t(v.normal)),w){var N=v.vertexNormals;l.push(t(N[0]),t(N[1]),t(N[2]))}if(E&&l.push(i(v.color)),b){var D=v.vertexColors;l.push(i(D[0]),i(D[1]),i(D[2]))}}return n.data={},n.data.vertices=s,n.data.normals=h,p.length>0&&(n.data.colors=p),m.length>0&&(n.data.uvs=[m]),n.data.faces=l,n},clone:function(){return(new n.Geometry).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var t=e.vertices,i=0,r=t.length;r>i;i++)this.vertices.push(t[i].clone());for(var n=e.faces,i=0,r=n.length;r>i;i++)this.faces.push(n[i].clone());for(var i=0,r=e.faceVertexUvs.length;r>i;i++){var a=e.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(var o=0,s=a.length;s>o;o++){for(var c=a[o],u=[],l=0,h=c.length;h>l;l++){var d=c[l];u.push(d.clone())}this.faceVertexUvs[i].push(u)}}return this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}},n.EventDispatcher.prototype.apply(n.Geometry.prototype),n.GeometryIdCount=0,n.DirectGeometry=function(){Object.defineProperty(this,\"id\",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name=\"\",this.type=\"DirectGeometry\",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},n.DirectGeometry.prototype={constructor:n.DirectGeometry,computeBoundingBox:n.Geometry.prototype.computeBoundingBox,computeBoundingSphere:n.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn(\"THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.\")},computeVertexNormals:function(){console.warn(\"THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.\")},computeGroups:function(e){for(var t,i,r=[],n=e.faces,a=0;a<n.length;a++){var o=n[a];o.materialIndex!==i&&(i=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,r.push(t)),t={start:3*a,materialIndex:i})}void 0!==t&&(t.count=3*a-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,i=e.faces,r=e.vertices,a=e.faceVertexUvs,o=a[0]&&a[0].length>0,s=a[1]&&a[1].length>0,c=e.morphTargets,u=c.length;if(u>0){t=[];for(var l=0;u>l;l++)t[l]=[];this.morphTargets.position=t}var h,d=e.morphNormals,p=d.length;if(p>0){h=[];for(var l=0;p>l;l++)h[l]=[];this.morphTargets.normal=h}for(var f=e.skinIndices,m=e.skinWeights,g=f.length===r.length,v=m.length===r.length,l=0;l<i.length;l++){var y=i[l];this.vertices.push(r[y.a],r[y.b],r[y.c]);var M=y.vertexNormals;if(3===M.length)this.normals.push(M[0],M[1],M[2]);else{var A=y.normal;this.normals.push(A,A,A)}var x=y.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var w=y.color;this.colors.push(w,w,w)}if(o===!0){var E=a[0][l];void 0!==E?this.uvs.push(E[0],E[1],E[2]):(console.warn(\"THREE.DirectGeometry.fromGeometry(): Undefined vertexUv \",l),this.uvs.push(new n.Vector2,new n.Vector2,new n.Vector2))}if(s===!0){var E=a[1][l];void 0!==E?this.uvs2.push(E[0],E[1],E[2]):(console.warn(\"THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 \",l),this.uvs2.push(new n.Vector2,new n.Vector2,new n.Vector2))}for(var b=0;u>b;b++){var T=c[b].vertices;t[b].push(T[y.a],T[y.b],T[y.c])}for(var b=0;p>b;b++){var L=d[b].vertexNormals[l];h[b].push(L.a,L.b,L.c)}g&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}},n.EventDispatcher.prototype.apply(n.DirectGeometry.prototype),n.BufferGeometry=function(){Object.defineProperty(this,\"id\",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name=\"\",this.type=\"BufferGeometry\",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},n.BufferGeometry.prototype={constructor:n.BufferGeometry,getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){return t instanceof n.BufferAttribute==!1&&t instanceof n.InterleavedBufferAttribute==!1?(console.warn(\"THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).\"),this.addAttribute(e,new n.BufferAttribute(arguments[1],arguments[2])),void 0):\"index\"===e?(console.warn(\"THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.\"),this.setIndex(t),void 0):(this.attributes[e]=t,this)},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){var r=(new n.Matrix3).getNormalMatrix(e);r.applyToVector3Array(i.array),i.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e;return function(t){return void 0===e&&(e=new n.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new n.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new n.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,i,r){return void 0===e&&(e=new n.Matrix4),e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,i,r){return void 0===e&&(e=new n.Matrix4),e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new n.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof n.Points||e instanceof n.Line){var i=new n.Float32Attribute(3*t.vertices.length,3),r=new n.Float32Attribute(3*t.colors.length,3);if(this.addAttribute(\"position\",i.copyVector3sArray(t.vertices)),this.addAttribute(\"color\",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var a=new n.Float32Attribute(t.lineDistances.length,1);this.addAttribute(\"lineDistance\",a.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e instanceof n.Mesh&&t instanceof n.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof n.Mesh){var i=t.__directGeometry;if(void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}if(t.verticesNeedUpdate===!0){var r=this.attributes.position;void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1}if(t.normalsNeedUpdate===!0){var r=this.attributes.normal;void 0!==r&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1}if(t.colorsNeedUpdate===!0){var r=this.attributes.color;void 0!==r&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var r=this.attributes.uv;void 0!==r&&(r.copyVector2sArray(t.uvs),r.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var r=this.attributes.lineDistance;void 0!==r&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new n.DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute(\"position\",new n.BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);\nthis.addAttribute(\"normal\",new n.BufferAttribute(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute(\"color\",new n.BufferAttribute(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var a=new Float32Array(2*e.uvs.length);this.addAttribute(\"uv\",new n.BufferAttribute(a,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute(\"uv2\",new n.BufferAttribute(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var s=e.vertices.length>65535?Uint32Array:Uint16Array,c=new s(3*e.indices.length);this.setIndex(new n.BufferAttribute(c,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var u in e.morphTargets){for(var l=[],h=e.morphTargets[u],d=0,p=h.length;p>d;d++){var f=h[d],m=new n.Float32Attribute(3*f.length,3);l.push(m.copyVector3sArray(f))}this.morphAttributes[u]=l}if(e.skinIndices.length>0){var g=new n.Float32Attribute(4*e.skinIndices.length,4);this.addAttribute(\"skinIndex\",g.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var v=new n.Float32Attribute(4*e.skinWeights.length,4);this.addAttribute(\"skinWeight\",v.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new n.Box3);var e=this.attributes.position.array;void 0!==e?this.boundingBox.setFromArray(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new n.Box3,t=new n.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere);var i=this.attributes.position.array;if(i){var r=this.boundingSphere.center;e.setFromArray(i),e.center(r);for(var a=0,o=0,s=i.length;s>o;o+=3)t.fromArray(i,o),a=Math.max(a,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,i=this.groups;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute(\"normal\",new n.BufferAttribute(new Float32Array(r.length),3));else for(var a=t.normal.array,o=0,s=a.length;s>o;o++)a[o]=0;var c,u,l,h=t.normal.array,d=new n.Vector3,p=new n.Vector3,f=new n.Vector3,m=new n.Vector3,g=new n.Vector3;if(e){var v=e.array;0===i.length&&this.addGroup(0,v.length);for(var y=0,M=i.length;M>y;++y)for(var A=i[y],x=A.start,w=A.count,o=x,s=x+w;s>o;o+=3)c=3*v[o+0],u=3*v[o+1],l=3*v[o+2],d.fromArray(r,c),p.fromArray(r,u),f.fromArray(r,l),m.subVectors(f,p),g.subVectors(d,p),m.cross(g),h[c]+=m.x,h[c+1]+=m.y,h[c+2]+=m.z,h[u]+=m.x,h[u+1]+=m.y,h[u+2]+=m.z,h[l]+=m.x,h[l+1]+=m.y,h[l+2]+=m.z}else for(var o=0,s=r.length;s>o;o+=9)d.fromArray(r,o),p.fromArray(r,o+3),f.fromArray(r,o+6),m.subVectors(f,p),g.subVectors(d,p),m.cross(g),h[o]=m.x,h[o+1]=m.y,h[o+2]=m.z,h[o+3]=m.x,h[o+4]=m.y,h[o+5]=m.z,h[o+6]=m.x,h[o+7]=m.y,h[o+8]=m.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e instanceof n.BufferGeometry==!1)return console.error(\"THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.\",e),void 0;void 0===t&&(t=0);var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var a=i[r],o=a.array,s=e.attributes[r],c=s.array,u=s.itemSize,l=0,h=u*t;l<c.length;l++,h++)o[h]=c[l];return this},normalizeNormals:function(){for(var e,t,i,r,n=this.attributes.normal.array,a=0,o=n.length;o>a;a+=3)e=n[a],t=n[a+1],i=n[a+2],r=1/Math.sqrt(e*e+t*t+i*i),n[a]*=r,n[a+1]*=r,n[a+2]*=r},toNonIndexed:function(){if(null===this.index)return console.warn(\"THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.\"),this;var e=new n.BufferGeometry,t=this.index.array,i=this.attributes;for(var r in i){for(var a=i[r],o=a.array,s=a.itemSize,c=new o.constructor(t.length*s),u=0,l=0,h=0,d=t.length;d>h;h++){u=t[h]*s;for(var p=0;s>p;p++)c[l++]=o[u++]}e.addAttribute(r,new n.BufferAttribute(c,s))}return e},toJSON:function(){var e={metadata:{version:4.4,type:\"BufferGeometry\",generator:\"BufferGeometry.toJSON\"}};if(e.uuid=this.uuid,e.type=this.type,\"\"!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var n=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:n}}var a=this.attributes;for(var i in a){var o=a[i],n=Array.prototype.slice.call(o.array);e.data.attributes[i]={itemSize:o.itemSize,type:o.array.constructor.name,array:n,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var c=this.boundingSphere;return null!==c&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e},clone:function(){return(new n.BufferGeometry).copy(this)},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var i=e.attributes;for(var r in i){var n=i[r];this.addAttribute(r,n.clone())}for(var a=e.groups,o=0,s=a.length;s>o;o++){var c=a[o];this.addGroup(c.start,c.count,c.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}},n.EventDispatcher.prototype.apply(n.BufferGeometry.prototype),n.BufferGeometry.MaxIndex=65535,n.InstancedBufferGeometry=function(){n.BufferGeometry.call(this),this.type=\"InstancedBufferGeometry\",this.maxInstancedCount=void 0},n.InstancedBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.InstancedBufferGeometry.prototype.constructor=n.InstancedBufferGeometry,n.InstancedBufferGeometry.prototype.addGroup=function(e,t,i){this.groups.push({start:e,count:t,instances:i})},n.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var i=e.attributes;for(var r in i){var n=i[r];this.addAttribute(r,n.clone())}for(var a=e.groups,o=0,s=a.length;s>o;o++){var c=a[o];this.addGroup(c.start,c.count,c.instances)}return this},n.EventDispatcher.prototype.apply(n.InstancedBufferGeometry.prototype),n.Uniform=function(e){\"string\"==typeof e&&(console.warn(\"THREE.Uniform: Type parameter is no longer needed.\"),e=arguments[1]),this.value=e,this.dynamic=!1},n.Uniform.prototype={constructor:n.Uniform,onUpdate:function(e){return this.dynamic=!0,this.onUpdateCallback=e,this}},n.AnimationClip=function(e,t,i){this.name=e||n.Math.generateUUID(),this.tracks=i,this.duration=void 0!==t?t:-1,this.duration<0&&this.resetDuration(),this.trim(),this.optimize()},n.AnimationClip.prototype={constructor:n.AnimationClip,resetDuration:function(){for(var e=this.tracks,t=0,i=0,r=e.length;i!==r;++i){var n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},Object.assign(n.AnimationClip,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),a=0,o=i.length;a!==o;++a)t.push(n.KeyframeTrack.parse(i[a]).scale(r));return new n.AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t},a=0,o=i.length;a!==o;++a)t.push(n.KeyframeTrack.toJSON(i[a]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){for(var a=t.length,o=[],s=0;a>s;s++){var c=[],u=[];c.push((s+a-1)%a,s,(s+1)%a),u.push(0,1,0);var l=n.AnimationUtils.getKeyframeOrder(c);c=n.AnimationUtils.sortedArray(c,1,l),u=n.AnimationUtils.sortedArray(u,1,l),r||0!==c[0]||(c.push(a),u.push(u[0])),o.push(new n.NumberKeyframeTrack(\".morphTargetInfluences[\"+t[s].name+\"]\",c,u).scale(1/i))}return new n.AnimationClip(e,-1,o)},findByName:function(e,t){for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},a=/^([\\w-]*?)([\\d]+)$/,o=0,s=e.length;s>o;o++){var c=e[o],u=c.name.match(a);if(u&&u.length>1){var l=u[1],h=r[l];h||(r[l]=h=[]),h.push(c)}}var d=[];for(var l in r)d.push(n.AnimationClip.CreateFromMorphTargetSequence(l,r[l],t,i));return d},parseAnimation:function(e,t){if(!e)return console.error(\"  no animation in JSONLoader data\"),null;for(var i=function(e,t,i,r,a){if(0!==i.length){var o=[],s=[];n.AnimationUtils.flattenJSON(i,o,s,r),0!==o.length&&a.push(new e(t,o,s))}},r=[],a=e.name||\"default\",o=e.length||-1,s=e.fps||30,c=e.hierarchy||[],u=0;u<c.length;u++){var l=c[u].keys;if(l&&0!=l.length)if(l[0].morphTargets){for(var h={},d=0;d<l.length;d++)if(l[d].morphTargets)for(var p=0;p<l[d].morphTargets.length;p++)h[l[d].morphTargets[p]]=-1;for(var f in h){for(var m=[],g=[],p=0;p!==l[d].morphTargets.length;++p){var v=l[d];m.push(v.time),g.push(v.morphTarget===f?1:0)}r.push(new n.NumberKeyframeTrack(\".morphTargetInfluence[\"+f+\"]\",m,g))}o=h.length*(s||1)}else{var y=\".bones[\"+t[u].name+\"]\";i(n.VectorKeyframeTrack,y+\".position\",l,\"pos\",r),i(n.QuaternionKeyframeTrack,y+\".quaternion\",l,\"rot\",r),i(n.VectorKeyframeTrack,y+\".scale\",l,\"scl\",r)}}if(0===r.length)return null;var M=new n.AnimationClip(a,o,r);return M}}),n.AnimationMixer=function(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1},n.AnimationMixer.prototype={constructor:n.AnimationMixer,clipAction:function(e,t){var i,r=t||this._root,a=r.uuid,o=\"string\"==typeof e?e:e.name,s=e!==o?e:null,c=this._actionsByClip[o];if(void 0!==c){var u=c.actionByRoot[a];if(void 0!==u)return u;if(i=c.knownActions[0],s=i._clip,e!==o&&e!==s)throw new Error(\"Different clips with the same name detected!\")}if(null===s)return null;var l=new n.AnimationMixer._Action(this,s,t);return this._bindAction(l,i),this._addInactiveAction(l,o,a),l},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n=\"string\"==typeof e?e:e.name,a=this._actionsByClip[n];return void 0!==a?a.actionByRoot[r]||null:null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(var n=0;n!==r;++n)i[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1,o=0;o!==i;++o){var s=t[o];s.enabled&&s._update(r,e,n,a)}for(var c=this._bindings,u=this._nActiveBindings,o=0;o!==u;++o)c[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.name,r=this._actionsByClip,n=r[i];if(void 0!==n){for(var a=n.knownActions,o=0,s=a.length;o!==s;++o){var c=a[o];this._deactivateAction(c);var u=c._cacheIndex,l=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=u,t[u]=l,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot,a=n[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var o=this._bindingsByRootAndName,s=o[t];if(void 0!==s)for(var c in s){var u=s[c];u.restoreOriginalState(),this._removeInactiveBinding(u)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},n.EventDispatcher.prototype.apply(n.AnimationMixer.prototype),n.AnimationMixer._Action=function(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var r=t.tracks,a=r.length,o=new Array(a),s={endingStart:n.ZeroCurvatureEnding,endingEnd:n.ZeroCurvatureEnding},c=0;c!==a;++c){var u=r[c].createInterpolant(null);o[c]=u,u.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=n.LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0},n.AnimationMixer._Action.prototype={constructor:n.AnimationMixer._Action,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){this._startTime;return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){this._mixer;if(e.fadeOut(t),this.fadeIn(t),i){var r=this._clip.duration,n=e._clip.duration,a=n/r,o=r/n;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._currentTimeScale,0,e)},warp:function(e,t,i){var r=this._mixer,n=r.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,c=a.sampleValues;return s[0]=n,s[1]=n+i,c[0]=e/o,c[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,r){var n=this._startTime;if(null!==n){var a=(e-n)*i;if(0>a||0===i)return;this._startTime=null,t=i*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var c=this._interpolants,u=this._propertyBindings,l=0,h=c.length;l!==h;++l)c[l].evaluate(o),u[l].accumulate(r,s)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.pause=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var i=this._clip.duration,r=this.loop,a=this._loopCount,o=!1;switch(r){case n.LoopOnce:if(-1===a&&(this.loopCount=0,this._setEndings(!0,!0,!1)),t>=i)t=i;else{if(!(0>t))break;t=0}this.clampWhenFinished?this.pause=!0:this.enabled=!1,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0>e?-1:1});break;case n.LoopPingPong:o=!0;case n.LoopRepeat:if(-1===a&&(e>0?(a=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||0>t){var s=Math.floor(t/i);t-=i*s,a+=Math.abs(s);var c=this.repetitions-a;if(0>c){this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:e>0?1:-1});break}if(0===c){var u=0>e;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=a,this._mixer.dispatchEvent({type:\"loop\",action:this,loopDelta:s})}if(r===n.LoopPingPong&&1===(1&a))return this.time=t,i-t}return this.time=t,t},_setEndings:function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=n.ZeroSlopeEnding,r.endingEnd=n.ZeroSlopeEnding):(r.endingStart=e?this.zeroSlopeAtStart?n.ZeroSlopeEnding:n.ZeroCurvatureEnding:n.WrapAroundEnding,r.endingEnd=t?this.zeroSlopeAtEnd?n.ZeroSlopeEnding:n.ZeroCurvatureEnding:n.WrapAroundEnding)},_scheduleFading:function(e,t,i){var r=this._mixer,n=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=n,s[0]=t,o[1]=n+e,s[1]=i,this}},Object.assign(n.AnimationMixer.prototype,{_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,a=r.length,o=e._propertyBindings,s=e._interpolants,c=i.uuid,u=this._bindingsByRootAndName,l=u[c];void 0===l&&(l={},u[c]=l);for(var h=0;h!==a;++h){var d=r[h],p=d.name,f=l[p];if(void 0!==f)o[h]=f;else{if(f=o[h],void 0!==f){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,c,p));continue}var m=t&&t._propertyBindings[h].binding.parsedPath;f=new n.PropertyMixer(n.PropertyBinding.create(i,p,m),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,c,p),o[h]=f}s[h].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.name,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(var n=e._propertyBindings,a=0,o=n.length;a!==o;++a){var s=n[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,a=n[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;var n=e._clip.name,a=this._actionsByClip,o=a[n],s=o.knownActions,c=s[s.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,s[u]=c,s.pop(),e._byClipCacheIndex=null;var l=o.actionByRoot,h=(t._localRoot||this._root).uuid;delete l[h],0===s.length&&delete a[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0===--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=r[t],a=this._bindings;void 0===n&&(n={},r[t]=n),n[i]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],c=e._cacheIndex;s._cacheIndex=c,t[c]=s,t.pop(),delete o[n];e:{for(var u in o)break e;delete a[r]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&(i=new n.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1)}),n.AnimationObjectGroup=function(){this.uuid=n.Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}},n.AnimationObjectGroup.prototype={constructor:n.AnimationObjectGroup,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,a=this._paths,o=this._parsedPaths,s=this._bindings,c=s.length,u=0,l=arguments.length;u!==l;++u){var h=arguments[u],d=h.uuid,p=r[d];if(void 0===p){p=t++,r[d]=p,e.push(h);for(var f=0,m=c;f!==m;++f)s[f].push(new n.PropertyBinding(h,a[f],o[f]))}else if(i>p){var g=e[p],v=--i,y=e[v];r[y.uuid]=p,e[p]=y,r[d]=v,e[v]=h;for(var f=0,m=c;f!==m;++f){var M=s[f],A=M[v],x=M[p];M[p]=A,void 0===x&&(x=new n.PropertyBinding(h,a[f],o[f])),M[v]=x}}else e[p]!==g&&console.error(\"Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...\")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=(e.length,this.nCachedObjects_),i=this._indicesByUUID,r=this._bindings,n=r.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],c=s.uuid,u=i[c];if(void 0!==u&&u>=t){var l=t++,h=e[l];i[h.uuid]=u,e[u]=h,i[c]=l,e[l]=s;for(var d=0,p=n;d!==p;++d){var f=r[d],m=f[l],g=f[u];f[u]=m,f[l]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,a=n.length,o=0,s=arguments.length;o!==s;++o){var c=arguments[o],u=c.uuid,l=r[u];if(void 0!==l)if(delete r[u],i>l){var h=--i,d=e[h],p=--t,f=e[p];r[d.uuid]=l,e[l]=d,r[f.uuid]=h,e[h]=f,e.pop();for(var m=0,g=a;m!==g;++m){var v=n[m],y=v[h],M=v[p];v[l]=y,v[h]=M,v.pop()}}else{var p=--t,f=e[p];r[f.uuid]=l,e[l]=f,e.pop();for(var m=0,g=a;m!==g;++m){var v=n[m];v[l]=v[p],v.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],a=this._bindings;if(void 0!==r)return a[r];var o=this._paths,s=this._parsedPaths,c=this._objects,u=c.length,l=this.nCachedObjects_,h=new Array(u);r=a.length,i[e]=r,o.push(e),s.push(t),a.push(h);for(var d=l,p=c.length;d!==p;++d){var f=c[d];h[d]=new n.PropertyBinding(f,e,t)}return h},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],c=e[o];t[c]=i,a[i]=s,a.pop(),n[i]=n[o],n.pop(),r[i]=r[o],r.pop()}}},n.AnimationUtils={arraySlice:function(e,t,i){return n.AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,i)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:\"number\"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,i){return e[t]-e[i]}for(var i=e.length,r=new Array(i),n=0;n!==i;++n)r[n]=n;return r.sort(t),r},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=i[a]*t,c=0;c!==t;++c)n[o++]=e[s+c];return n},flattenJSON:function(e,t,i,r){for(var n=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[n++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o)){do o=a[r],void 0!==o&&(t.push(a.time),i.push.apply(i,o)),a=e[n++];while(void 0!==a)}else if(void 0!==o.toArray){do o=a[r],void 0!==o&&(t.push(a.time),o.toArray(i,i.length)),a=e[n++];while(void 0!==a)}else do o=a[r],void 0!==o&&(t.push(a.time),i.push(o)),a=e[n++];while(void 0!==a)}}},n.KeyframeTrack=function(e,t,i,r){if(void 0===e)throw new Error(\"track name is undefined\");if(void 0===t||0===t.length)throw new Error(\"no keyframes in track named \"+e);this.name=e,this.times=n.AnimationUtils.convertArray(t,this.TimeBufferType),this.values=n.AnimationUtils.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation),this.validate(),this.optimize()},n.KeyframeTrack.prototype={constructor:n.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:n.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new n.DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new n.LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new n.CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t=void 0;switch(e){case n.InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case n.InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case n.InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var i=\"unsupported interpolation for \"+this.ValueTypeName+\" keyframe track named \"+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn(i),void 0}this.createInterpolant=t},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return n.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return n.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return n.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,a=0,o=r-1;a!==r&&i[a]<e;)++a;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==a||o!==r){a>=o&&(o=Math.max(o,1),a=o-1);var s=this.getValueSize();this.times=n.AnimationUtils.arraySlice(i,a,o),this.values=n.AnimationUtils.arraySlice(this.values,a*s,o*s)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error(\"invalid value size in track\",this),e=!1);var i=this.times,r=this.values,a=i.length;0===a&&(console.error(\"track is empty\",this),e=!1);for(var o=null,s=0;s!==a;s++){var c=i[s];if(\"number\"==typeof c&&isNaN(c)){console.error(\"time is not a valid number\",this,s,c),e=!1;break}if(null!==o&&o>c){console.error(\"out of order keys\",this,s,c,o),e=!1;break}o=c}if(void 0!==r&&n.AnimationUtils.isTypedArray(r))for(var s=0,u=r.length;s!==u;++s){var l=r[s];if(isNaN(l)){console.error(\"value is not a valid number\",this,s,l),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),r=1,a=1,o=e.length-1;o>=a;++a){var s=!1,c=e[a],u=e[a+1];if(c!==u&&(1!==a||c!==c[0]))for(var l=a*i,h=l-i,d=l+i,p=0;p!==i;++p){var f=t[l+p];if(f!==t[h+p]||f!==t[d+p]){s=!0;break}}if(s){if(a!==r){e[r]=e[a];for(var m=a*i,g=r*i,p=0;p!==i;++p)t[g+p]=t[m+p]}++r}}return r!==e.length&&(this.times=n.AnimationUtils.arraySlice(e,0,r),this.values=n.AnimationUtils.arraySlice(t,0,r*i)),this}},Object.assign(n.KeyframeTrack,{parse:function(e){if(void 0===e.type)throw new Error(\"track type undefined, can not parse\");var t=n.KeyframeTrack._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){console.warn(\"legacy JSON format detected, converting\");var i=[],r=[];n.AnimationUtils.flattenJSON(e.keys,i,r,\"value\"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:n.AnimationUtils.convertArray(e.times,Array),values:n.AnimationUtils.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case\"scalar\":case\"double\":case\"float\":case\"number\":case\"integer\":return n.NumberKeyframeTrack;case\"vector\":case\"vector2\":case\"vector3\":case\"vector4\":return n.VectorKeyframeTrack;case\"color\":return n.ColorKeyframeTrack;case\"quaternion\":return n.QuaternionKeyframeTrack;case\"bool\":case\"boolean\":return n.BooleanKeyframeTrack;case\"string\":return n.StringKeyframeTrack}throw new Error(\"Unsupported typeName: \"+e)}}),n.PropertyBinding=function(e,t,i){this.path=t,this.parsedPath=i||n.PropertyBinding.parseTrackName(t),this.node=n.PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e},n.PropertyBinding.prototype={constructor:n.PropertyBinding,getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,a=t.propertyIndex;if(e||(e=n.PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return console.error(\"  trying to update node for track: \"+this.path+\" but it wasn't found.\"),void 0;if(i){var o=t.objectIndex;switch(i){case\"materials\":if(!e.material)return console.error(\"  can not bind to material as node does not have a material\",this),void 0;if(!e.material.materials)return console.error(\"  can not bind to material.materials as node.material does not have a materials array\",this),void 0;e=e.material.materials;break;case\"bones\":if(!e.skeleton)return console.error(\"  can not bind to bones as node does not have a skeleton\",this),void 0;e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;default:if(void 0===e[i])return console.error(\"  can not bind to objectName of node, undefined\",this),void 0;e=e[i]}if(void 0!==o){if(void 0===e[o])return console.error(\"  trying to bind to objectIndex of objectName, but is undefined:\",this,e),void 0;e=e[o]}}var c=e[r];if(!c){var u=t.nodeName;return console.error(\"  trying to update property for track: \"+u+\".\"+r+\" but it wasn't found.\",e),void 0}var l=this.Versioning.None;void 0!==e.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var h=this.BindingType.Direct;if(void 0!==a){if(\"morphTargetInfluences\"===r){if(!e.geometry)return console.error(\"  can not bind to morphTargetInfluences becasuse node does not have a geometry\",this),void 0;if(!e.geometry.morphTargets)return console.error(\"  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets\",this),void 0;for(var s=0;s<this.node.geometry.morphTargets.length;s++)if(e.geometry.morphTargets[s].name===a){a=s;\nbreak}}h=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=a}else void 0!==c.fromArray&&void 0!==c.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=c):void 0!==c.length?(h=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=r;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(n.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:n.PropertyBinding.prototype.getValue,_setValue_unbound:n.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.node[this.propertyName]=e[t]},function(e,t){this.node[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.node[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),n.PropertyBinding.Composite=function(e,t,i){var r=i||n.PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)},n.PropertyBinding.Composite.prototype={constructor:n.PropertyBinding.Composite,getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},n.PropertyBinding.create=function(e,t,i){return e instanceof n.AnimationObjectGroup?new n.PropertyBinding.Composite(e,t,i):new n.PropertyBinding(e,t,i)},n.PropertyBinding.parseTrackName=function(e){var t=/^(([\\w]+\\/)*)([\\w-\\d]+)?(\\.([\\w]+)(\\[([\\w\\d\\[\\]\\_.:\\- ]+)\\])?)?(\\.([\\w.]+)(\\[([\\w\\d\\[\\]\\_. ]+)\\])?)$/,i=t.exec(e);if(!i)throw new Error(\"cannot parse trackName at all: \"+e);i.index===t.lastIndex&&t.lastIndex++;var r={nodeName:i[3],objectName:i[5],objectIndex:i[7],propertyName:i[9],propertyIndex:i[11]};if(null===r.propertyName||0===r.propertyName.length)throw new Error(\"can not parse propertyName from trackName: \"+e);return r},n.PropertyBinding.findNode=function(e,t){if(!t||\"\"===t||\"root\"===t||\".\"===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=function(e){for(var i=0;i<e.bones.length;i++){var r=e.bones[i];if(r.name===t)return r}return null},r=i(e.skeleton);if(r)return r}if(e.children){var n=function(e){for(var i=0;i<e.length;i++){var r=e[i];if(r.name===t||r.uuid===t)return r;var a=n(r.children);if(a)return a}return null},a=n(e.children);if(a)return a}return null},n.PropertyMixer=function(e,t,i){this.binding=e,this.valueSize=i;var r,n=Float64Array;switch(t){case\"quaternion\":r=this._slerp;break;case\"string\":case\"bool\":n=Array,r=this._select;break;default:r=this._lerp}this.buffer=new n(4*i),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0},n.PropertyMixer.prototype={constructor:n.PropertyMixer,accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==r;++o)i[n+o]=i[o];a=t}else{a+=t;var s=t/a;this._mixBufferRegion(i,n,0,s,r)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,1>n){var o=3*t;this._mixBufferRegion(i,r,o,1-n,t)}for(var s=t,c=t+t;s!==c;++s)if(i[s]!==i[s+t]){a.setValue(i,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,r=3*i;e.getValue(t,r);for(var n=i,a=r;n!==a;++n)t[n]=t[r+n%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,r,n){if(r>=.5)for(var a=0;a!==n;++a)e[t+a]=e[i+a]},_slerp:function(e,t,i,r){n.Quaternion.slerpFlat(e,t,e,t,e,i,r)},_lerp:function(e,t,i,r,n){for(var a=1-r,o=0;o!==n;++o){var s=t+o;e[s]=e[s]*a+e[i+o]*r}}},n.BooleanKeyframeTrack=function(e,t,i){n.KeyframeTrack.call(this,e,t,i)},n.BooleanKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.BooleanKeyframeTrack,ValueTypeName:\"bool\",ValueBufferType:Array,DefaultInterpolation:n.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),n.ColorKeyframeTrack=function(e,t,i,r){n.KeyframeTrack.call(this,e,t,i,r)},n.ColorKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.ColorKeyframeTrack,ValueTypeName:\"color\"}),n.NumberKeyframeTrack=function(e,t,i,r){n.KeyframeTrack.call(this,e,t,i,r)},n.NumberKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.NumberKeyframeTrack,ValueTypeName:\"number\"}),n.QuaternionKeyframeTrack=function(e,t,i,r){n.KeyframeTrack.call(this,e,t,i,r)},n.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.QuaternionKeyframeTrack,ValueTypeName:\"quaternion\",DefaultInterpolation:n.InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new n.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),n.StringKeyframeTrack=function(e,t,i,r){n.KeyframeTrack.call(this,e,t,i,r)},n.StringKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.StringKeyframeTrack,ValueTypeName:\"string\",ValueBufferType:Array,DefaultInterpolation:n.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),n.VectorKeyframeTrack=function(e,t,i,r){n.KeyframeTrack.call(this,e,t,i,r)},n.VectorKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.VectorKeyframeTrack,ValueTypeName:\"vector\"}),n.Audio=function(e){n.Object3D.call(this),this.type=\"Audio\",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType=\"empty\",this.filter=null},n.Audio.prototype=Object.create(n.Object3D.prototype),n.Audio.prototype.constructor=n.Audio,n.Audio.prototype.getOutput=function(){return this.gain},n.Audio.prototype.setNodeSource=function(e){return this.hasPlaybackControl=!1,this.sourceType=\"audioNode\",this.source=e,this.connect(),this},n.Audio.prototype.setBuffer=function(e){var t=this;return t.source.buffer=e,t.sourceType=\"buffer\",t.autoplay&&t.play(),this},n.Audio.prototype.play=function(){if(this.isPlaying===!0)return console.warn(\"THREE.Audio: Audio is already playing.\"),void 0;if(this.hasPlaybackControl===!1)return console.warn(\"THREE.Audio: this Audio has no playback control.\"),void 0;var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()},n.Audio.prototype.pause=function(){return this.hasPlaybackControl===!1?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),void 0):(this.source.stop(),this.startTime=this.context.currentTime,void 0)},n.Audio.prototype.stop=function(){return this.hasPlaybackControl===!1?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),void 0):(this.source.stop(),this.startTime=0,void 0)},n.Audio.prototype.connect=function(){null!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.getOutput())):this.source.connect(this.getOutput())},n.Audio.prototype.disconnect=function(){null!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.getOutput())):this.source.disconnect(this.getOutput())},n.Audio.prototype.getFilter=function(){return this.filter},n.Audio.prototype.setFilter=function(e){void 0===e&&(e=null),this.isPlaying===!0?(this.disconnect(),this.filter=e,this.connect()):this.filter=e},n.Audio.prototype.setPlaybackRate=function(e){return this.hasPlaybackControl===!1?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),void 0):(this.playbackRate=e,this.isPlaying===!0&&(this.source.playbackRate.value=this.playbackRate),void 0)},n.Audio.prototype.getPlaybackRate=function(){return this.playbackRate},n.Audio.prototype.onEnded=function(){this.isPlaying=!1},n.Audio.prototype.setLoop=function(e){return this.hasPlaybackControl===!1?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),void 0):(this.source.loop=e,void 0)},n.Audio.prototype.getLoop=function(){return this.hasPlaybackControl===!1?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),!1):this.source.loop},n.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},n.Audio.prototype.getVolume=function(){return this.gain.gain.value},n.AudioAnalyser=function(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)},n.AudioAnalyser.prototype={constructor:n.AudioAnalyser,getData:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},Object.defineProperty(n,\"AudioContext\",{get:function(){var e;return function(){return void 0===e&&(e=new(window.AudioContext||window.webkitAudioContext)),e}}()}),n.PositionalAudio=function(e){n.Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},n.PositionalAudio.prototype=Object.create(n.Audio.prototype),n.PositionalAudio.prototype.constructor=n.PositionalAudio,n.PositionalAudio.prototype.getOutput=function(){return this.panner},n.PositionalAudio.prototype.setRefDistance=function(e){this.panner.refDistance=e},n.PositionalAudio.prototype.getRefDistance=function(){return this.panner.refDistance},n.PositionalAudio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},n.PositionalAudio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},n.PositionalAudio.prototype.setDistanceModel=function(e){this.panner.distanceModel=e},n.PositionalAudio.prototype.getDistanceModel=function(){return this.panner.distanceModel},n.PositionalAudio.prototype.setMaxDistance=function(e){this.panner.maxDistance=e},n.PositionalAudio.prototype.getMaxDistance=function(){return this.panner.maxDistance},n.PositionalAudio.prototype.updateMatrixWorld=function(){var e=new n.Vector3;return function(t){n.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),n.AudioListener=function(){n.Object3D.call(this),this.type=\"AudioListener\",this.context=n.AudioContext,this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null},n.AudioListener.prototype=Object.create(n.Object3D.prototype),n.AudioListener.prototype.constructor=n.AudioListener,n.AudioListener.prototype.getInput=function(){return this.gain},n.AudioListener.prototype.removeFilter=function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},n.AudioListener.prototype.setFilter=function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},n.AudioListener.prototype.getFilter=function(){return this.filter},n.AudioListener.prototype.setMasterVolume=function(e){this.gain.gain.value=e},n.AudioListener.prototype.getMasterVolume=function(){return this.gain.gain.value},n.AudioListener.prototype.updateMatrixWorld=function(){var e=new n.Vector3,t=new n.Quaternion,i=new n.Vector3,r=new n.Vector3;return function(a){n.Object3D.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z,s.x,s.y,s.z)}}(),n.Camera=function(){n.Object3D.call(this),this.type=\"Camera\",this.matrixWorldInverse=new n.Matrix4,this.projectionMatrix=new n.Matrix4},n.Camera.prototype=Object.create(n.Object3D.prototype),n.Camera.prototype.constructor=n.Camera,n.Camera.prototype.getWorldDirection=function(){var e=new n.Quaternion;return function(t){var i=t||new n.Vector3;return this.getWorldQuaternion(e),i.set(0,0,-1).applyQuaternion(e)}}(),n.Camera.prototype.lookAt=function(){var e=new n.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),n.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},n.Camera.prototype.copy=function(e){return n.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},n.CubeCamera=function(e,t,i){n.Object3D.call(this),this.type=\"CubeCamera\";var r=90,a=1,o=new n.PerspectiveCamera(r,a,e,t);o.up.set(0,-1,0),o.lookAt(new n.Vector3(1,0,0)),this.add(o);var s=new n.PerspectiveCamera(r,a,e,t);s.up.set(0,-1,0),s.lookAt(new n.Vector3(-1,0,0)),this.add(s);var c=new n.PerspectiveCamera(r,a,e,t);c.up.set(0,0,1),c.lookAt(new n.Vector3(0,1,0)),this.add(c);var u=new n.PerspectiveCamera(r,a,e,t);u.up.set(0,0,-1),u.lookAt(new n.Vector3(0,-1,0)),this.add(u);var l=new n.PerspectiveCamera(r,a,e,t);l.up.set(0,-1,0),l.lookAt(new n.Vector3(0,0,1)),this.add(l);var h=new n.PerspectiveCamera(r,a,e,t);h.up.set(0,-1,0),h.lookAt(new n.Vector3(0,0,-1)),this.add(h);var d={format:n.RGBFormat,magFilter:n.LinearFilter,minFilter:n.LinearFilter};this.renderTarget=new n.WebGLRenderTargetCube(i,i,d),this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,r=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,o,i),i.activeCubeFace=1,e.render(t,s,i),i.activeCubeFace=2,e.render(t,c,i),i.activeCubeFace=3,e.render(t,u,i),i.activeCubeFace=4,e.render(t,l,i),i.texture.generateMipmaps=r,i.activeCubeFace=5,e.render(t,h,i),e.setRenderTarget(null)}},n.CubeCamera.prototype=Object.create(n.Object3D.prototype),n.CubeCamera.prototype.constructor=n.CubeCamera,n.OrthographicCamera=function(e,t,i,r,a,o){n.Camera.call(this),this.type=\"OrthographicCamera\",this.zoom=1,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==a?a:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},n.OrthographicCamera.prototype=Object.create(n.Camera.prototype),n.OrthographicCamera.prototype.constructor=n.OrthographicCamera,n.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(i-e,i+e,r+t,r-t,this.near,this.far)},n.OrthographicCamera.prototype.copy=function(e){return n.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},n.OrthographicCamera.prototype.toJSON=function(e){var t=n.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,t},n.PerspectiveCamera=function(e,t,i,r){n.Camera.call(this),this.type=\"PerspectiveCamera\",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype=Object.create(n.Camera.prototype),n.PerspectiveCamera.prototype.constructor=n.PerspectiveCamera,n.PerspectiveCamera.prototype.setLens=function(e,t){console.warn(\"THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.\"),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},n.PerspectiveCamera.prototype.setFocalLength=function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*n.Math.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.getFocalLength=function(){var e=Math.tan(.5*n.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},n.PerspectiveCamera.prototype.getEffectiveFOV=function(){return 2*n.Math.RAD2DEG*Math.atan(Math.tan(.5*n.Math.DEG2RAD*this.fov)/this.zoom)},n.PerspectiveCamera.prototype.getFilmWidth=function(){return this.filmGauge*Math.min(this.aspect,1)},n.PerspectiveCamera.prototype.getFilmHeight=function(){return this.filmGauge/Math.max(this.aspect,1)},n.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,n,a){this.aspect=e/t,this.view={fullWidth:e,fullHeight:t,offsetX:i,offsetY:r,width:n,height:a},this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=this.near,t=e*Math.tan(.5*n.Math.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,a=-.5*r,o=this.view;if(null!==o){var s=o.fullWidth,c=o.fullHeight;a+=o.offsetX*r/s,t-=o.offsetY*i/c,r*=o.width/s,i*=o.height/c}var u=this.filmOffset;0!==u&&(a+=e*u/this.getFilmWidth()),this.projectionMatrix.makeFrustum(a,a+r,t-i,t,e,this.far)},n.PerspectiveCamera.prototype.copy=function(e){return n.Camera.prototype.copy.call(this,e),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},n.PerspectiveCamera.prototype.toJSON=function(e){var t=n.Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t},n.StereoCamera=function(){this.type=\"StereoCamera\",this.aspect=1,this.cameraL=new n.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new n.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1},n.StereoCamera.prototype={constructor:n.StereoCamera,update:function(){var e,t,i,r,a,o=new n.Matrix4,s=new n.Matrix4;return function(c){var u=e!==c.focus||t!==c.fov||i!==c.aspect*this.aspect||r!==c.near||a!==c.far;if(u){e=c.focus,t=c.fov,i=c.aspect*this.aspect,r=c.near,a=c.far;var l,h,d=c.projectionMatrix.clone(),p=.032,f=p*r/e,m=r*Math.tan(n.Math.DEG2RAD*t*.5);s.elements[12]=-p,o.elements[12]=p,l=-m*i+f,h=m*i+f,d.elements[0]=2*r/(h-l),d.elements[8]=(h+l)/(h-l),this.cameraL.projectionMatrix.copy(d),l=-m*i-f,h=m*i-f,d.elements[0]=2*r/(h-l),d.elements[8]=(h+l)/(h-l),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(s),this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(o)}}()},n.Light=function(e,t){n.Object3D.call(this),this.type=\"Light\",this.color=new n.Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0},n.Light.prototype=Object.create(n.Object3D.prototype),n.Light.prototype.constructor=n.Light,n.Light.prototype.copy=function(e){return n.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},n.Light.prototype.toJSON=function(e){var t=n.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),t},n.LightShadow=function(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new n.Vector2(512,512),this.map=null,this.matrix=new n.Matrix4},n.LightShadow.prototype={constructor:n.LightShadow,copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)}},n.AmbientLight=function(e,t){n.Light.call(this,e,t),this.type=\"AmbientLight\",this.castShadow=void 0},n.AmbientLight.prototype=Object.create(n.Light.prototype),n.AmbientLight.prototype.constructor=n.AmbientLight,n.DirectionalLight=function(e,t){n.Light.call(this,e,t),this.type=\"DirectionalLight\",this.position.set(0,1,0),this.updateMatrix(),this.target=new n.Object3D,this.shadow=new n.DirectionalLightShadow},n.DirectionalLight.prototype=Object.create(n.Light.prototype),n.DirectionalLight.prototype.constructor=n.DirectionalLight,n.DirectionalLight.prototype.copy=function(e){return n.Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},n.DirectionalLightShadow=function(){n.LightShadow.call(this,new n.OrthographicCamera(-5,5,5,-5,.5,500))},n.DirectionalLightShadow.prototype=Object.create(n.LightShadow.prototype),n.DirectionalLightShadow.prototype.constructor=n.DirectionalLightShadow,n.HemisphereLight=function(e,t,i){n.Light.call(this,e,i),this.type=\"HemisphereLight\",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new n.Color(t)},n.HemisphereLight.prototype=Object.create(n.Light.prototype),n.HemisphereLight.prototype.constructor=n.HemisphereLight,n.HemisphereLight.prototype.copy=function(e){return n.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this},n.PointLight=function(e,t,i,r){n.Light.call(this,e,t),this.type=\"PointLight\",this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new n.LightShadow(new n.PerspectiveCamera(90,1,.5,500))},n.PointLight.prototype=Object.create(n.Light.prototype),n.PointLight.prototype.constructor=n.PointLight,Object.defineProperty(n.PointLight.prototype,\"power\",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),n.PointLight.prototype.copy=function(e){return n.Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this},n.SpotLight=function(e,t,i,r,a,o){n.Light.call(this,e,t),this.type=\"SpotLight\",this.position.set(0,1,0),this.updateMatrix(),this.target=new n.Object3D,this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==a?a:0,this.decay=void 0!==o?o:1,this.shadow=new n.SpotLightShadow},n.SpotLight.prototype=Object.create(n.Light.prototype),n.SpotLight.prototype.constructor=n.SpotLight,Object.defineProperty(n.SpotLight.prototype,\"power\",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),n.SpotLight.prototype.copy=function(e){return n.Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},n.SpotLightShadow=function(){n.LightShadow.call(this,new n.PerspectiveCamera(50,1,.5,500))},n.SpotLightShadow.prototype=Object.create(n.LightShadow.prototype),n.SpotLightShadow.prototype.constructor=n.SpotLightShadow,n.SpotLightShadow.prototype.update=function(e){var t=2*n.Math.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||500,a=this.camera;(t!==a.fov||i!==a.aspect||r!==a.far)&&(a.fov=t,a.aspect=i,a.far=r,a.updateProjectionMatrix())},n.AudioLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.AudioLoader.prototype={constructor:n.AudioLoader,load:function(e,t,i,r){var a=new n.XHRLoader(this.manager);a.setResponseType(\"arraybuffer\"),a.load(e,function(e){var i=n.AudioContext;i.decodeAudioData(e,function(e){t(e)})},i,r)}},n.Cache={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){return this.enabled!==!1?this.files[e]:void 0},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},n.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},n.Loader.prototype={constructor:n.Loader,crossOrigin:void 0,extractUrlBase:function(e){var t=e.split(\"/\");return 1===t.length?\"./\":(t.pop(),t.join(\"/\")+\"/\")},initMaterials:function(e,t,i){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t,i);return r},createMaterial:function(){var e,t,i;return function(r,a,o){function s(e,i,r,s,u){var l,h=a+e,d=n.Loader.Handlers.get(h);null!==d?l=d.load(h):(t.setCrossOrigin(o),l=t.load(h)),void 0!==i&&(l.repeat.fromArray(i),1!==i[0]&&(l.wrapS=n.RepeatWrapping),1!==i[1]&&(l.wrapT=n.RepeatWrapping)),void 0!==r&&l.offset.fromArray(r),void 0!==s&&(\"repeat\"===s[0]&&(l.wrapS=n.RepeatWrapping),\"mirror\"===s[0]&&(l.wrapS=n.MirroredRepeatWrapping),\"repeat\"===s[1]&&(l.wrapT=n.RepeatWrapping),\"mirror\"===s[1]&&(l.wrapT=n.MirroredRepeatWrapping)),void 0!==u&&(l.anisotropy=u);var p=n.Math.generateUUID();return c[p]=l,p}void 0===e&&(e=new n.Color),void 0===t&&(t=new n.TextureLoader),void 0===i&&(i=new n.MaterialLoader);var c={},u={uuid:n.Math.generateUUID(),type:\"MeshLambertMaterial\"};for(var l in r){var h=r[l];switch(l){case\"DbgColor\":case\"DbgIndex\":case\"opticalDensity\":case\"illumination\":break;case\"DbgName\":u.name=h;break;case\"blending\":u.blending=n[h];break;case\"colorAmbient\":case\"mapAmbient\":console.warn(\"THREE.Loader.createMaterial:\",l,\"is no longer supported.\");break;case\"colorDiffuse\":u.color=e.fromArray(h).getHex();break;case\"colorSpecular\":u.specular=e.fromArray(h).getHex();break;case\"colorEmissive\":u.emissive=e.fromArray(h).getHex();break;case\"specularCoef\":u.shininess=h;break;case\"shading\":\"basic\"===h.toLowerCase()&&(u.type=\"MeshBasicMaterial\"),\"phong\"===h.toLowerCase()&&(u.type=\"MeshPhongMaterial\");break;case\"mapDiffuse\":u.map=s(h,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case\"mapDiffuseRepeat\":case\"mapDiffuseOffset\":case\"mapDiffuseWrap\":case\"mapDiffuseAnisotropy\":break;case\"mapLight\":u.lightMap=s(h,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case\"mapLightRepeat\":case\"mapLightOffset\":case\"mapLightWrap\":case\"mapLightAnisotropy\":break;case\"mapAO\":u.aoMap=s(h,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case\"mapAORepeat\":case\"mapAOOffset\":case\"mapAOWrap\":case\"mapAOAnisotropy\":break;case\"mapBump\":u.bumpMap=s(h,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case\"mapBumpScale\":u.bumpScale=h;break;case\"mapBumpRepeat\":case\"mapBumpOffset\":case\"mapBumpWrap\":case\"mapBumpAnisotropy\":break;case\"mapNormal\":u.normalMap=s(h,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case\"mapNormalFactor\":u.normalScale=[h,h];break;case\"mapNormalRepeat\":case\"mapNormalOffset\":case\"mapNormalWrap\":case\"mapNormalAnisotropy\":break;case\"mapSpecular\":u.specularMap=s(h,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case\"mapSpecularRepeat\":case\"mapSpecularOffset\":case\"mapSpecularWrap\":case\"mapSpecularAnisotropy\":break;case\"mapAlpha\":u.alphaMap=s(h,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case\"mapAlphaRepeat\":case\"mapAlphaOffset\":case\"mapAlphaWrap\":case\"mapAlphaAnisotropy\":break;case\"flipSided\":u.side=n.BackSide;break;case\"doubleSided\":u.side=n.DoubleSide;break;case\"transparency\":console.warn(\"THREE.Loader.createMaterial: transparency has been renamed to opacity\"),u.opacity=h;break;case\"depthTest\":case\"depthWrite\":case\"colorWrite\":case\"opacity\":case\"reflectivity\":case\"transparent\":case\"visible\":case\"wireframe\":u[l]=h;break;case\"vertexColors\":h===!0&&(u.vertexColors=n.VertexColors),\"face\"===h&&(u.vertexColors=n.FaceColors);break;default:console.error(\"THREE.Loader.createMaterial: Unsupported\",l,h)}}return\"MeshBasicMaterial\"===u.type&&delete u.emissive,\"MeshPhongMaterial\"!==u.type&&delete u.specular,u.opacity<1&&(u.transparent=!0),i.setTextures(c),i.parse(u)}}()},n.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,r=t.length;r>i;i+=2){var n=t[i],a=t[i+1];if(n.test(e))return a}return null}},n.XHRLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.XHRLoader.prototype={constructor:n.XHRLoader,load:function(e,t,i,r){void 0!==this.path&&(e=this.path+e);var a=this,o=n.Cache.get(e);if(void 0!==o)return t&&setTimeout(function(){t(o)},0),o;var s=new XMLHttpRequest;return s.overrideMimeType(\"text/plain\"),s.open(\"GET\",e,!0),s.addEventListener(\"load\",function(i){var o=i.target.response;n.Cache.add(e,o),200===this.status?(t&&t(o),a.manager.itemEnd(e)):0===this.status?(console.warn(\"THREE.XHRLoader: HTTP Status 0 received.\"),t&&t(o),a.manager.itemEnd(e)):(r&&r(i),a.manager.itemError(e))},!1),void 0!==i&&s.addEventListener(\"progress\",function(e){i(e)},!1),s.addEventListener(\"error\",function(t){r&&r(t),a.manager.itemError(e)},!1),void 0!==this.responseType&&(s.responseType=this.responseType),void 0!==this.withCredentials&&(s.withCredentials=this.withCredentials),s.send(null),a.manager.itemStart(e),s},setPath:function(e){this.path=e},setResponseType:function(e){this.responseType=e},setWithCredentials:function(e){this.withCredentials=e}},n.FontLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.FontLoader.prototype={constructor:n.FontLoader,load:function(e,t,i,r){var a=new n.XHRLoader(this.manager);a.load(e,function(e){t(new n.Font(JSON.parse(e.substring(65,e.length-2))))},i,r)}},n.ImageLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.ImageLoader.prototype={constructor:n.ImageLoader,load:function(e,t,i,r){void 0!==this.path&&(e=this.path+e);var a=this,o=n.Cache.get(e);if(void 0!==o)return a.manager.itemStart(e),t?setTimeout(function(){t(o),a.manager.itemEnd(e)},0):a.manager.itemEnd(e),o;var s=document.createElement(\"img\");return s.addEventListener(\"load\",function(){n.Cache.add(e,this),t&&t(this),a.manager.itemEnd(e)},!1),void 0!==i&&s.addEventListener(\"progress\",function(e){i(e)},!1),s.addEventListener(\"error\",function(t){r&&r(t),a.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),a.manager.itemStart(e),s.src=e,s},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},n.JSONLoader=function(e){\"boolean\"==typeof e&&(console.warn(\"THREE.JSONLoader: showStatus parameter has been removed from constructor.\"),e=void 0),this.manager=void 0!==e?e:n.DefaultLoadingManager,this.withCredentials=!1},n.JSONLoader.prototype={constructor:n.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement(\"div\")),console.warn(\"THREE.JSONLoader: .statusDomElement has been removed.\"),this._statusDomElement\n},load:function(e,t,i,r){var a=this,o=this.texturePath&&\"string\"==typeof this.texturePath?this.texturePath:n.Loader.prototype.extractUrlBase(e),s=new n.XHRLoader(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,function(i){var r=JSON.parse(i),n=r.metadata;if(void 0!==n){var s=n.type;if(void 0!==s){if(\"object\"===s.toLowerCase())return console.error(\"THREE.JSONLoader: \"+e+\" should be loaded with THREE.ObjectLoader instead.\"),void 0;if(\"scene\"===s.toLowerCase())return console.error(\"THREE.JSONLoader: \"+e+\" should be loaded with THREE.SceneLoader instead.\"),void 0}}var c=a.parse(r,o);t(c.geometry,c.materials)},i,r)},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){function i(t){function i(e,t){return e&1<<t}var r,a,o,c,u,l,h,d,p,f,m,g,v,y,M,A,x,w,E,b,T,L,N,D,S,C,I,j=e.faces,_=e.vertices,O=e.normals,z=e.colors,k=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&k++;for(r=0;k>r;r++)s.faceVertexUvs[r]=[]}for(c=0,u=_.length;u>c;)w=new n.Vector3,w.x=_[c++]*t,w.y=_[c++]*t,w.z=_[c++]*t,s.vertices.push(w);for(c=0,u=j.length;u>c;)if(f=j[c++],m=i(f,0),g=i(f,1),v=i(f,3),y=i(f,4),M=i(f,5),A=i(f,6),x=i(f,7),m){if(b=new n.Face3,b.a=j[c],b.b=j[c+1],b.c=j[c+3],T=new n.Face3,T.a=j[c+1],T.b=j[c+2],T.c=j[c+3],c+=4,g&&(p=j[c++],b.materialIndex=p,T.materialIndex=p),o=s.faces.length,v)for(r=0;k>r;r++)for(D=e.uvs[r],s.faceVertexUvs[r][o]=[],s.faceVertexUvs[r][o+1]=[],a=0;4>a;a++)d=j[c++],C=D[2*d],I=D[2*d+1],S=new n.Vector2(C,I),2!==a&&s.faceVertexUvs[r][o].push(S),0!==a&&s.faceVertexUvs[r][o+1].push(S);if(y&&(h=3*j[c++],b.normal.set(O[h++],O[h++],O[h]),T.normal.copy(b.normal)),M)for(r=0;4>r;r++)h=3*j[c++],N=new n.Vector3(O[h++],O[h++],O[h]),2!==r&&b.vertexNormals.push(N),0!==r&&T.vertexNormals.push(N);if(A&&(l=j[c++],L=z[l],b.color.setHex(L),T.color.setHex(L)),x)for(r=0;4>r;r++)l=j[c++],L=z[l],2!==r&&b.vertexColors.push(new n.Color(L)),0!==r&&T.vertexColors.push(new n.Color(L));s.faces.push(b),s.faces.push(T)}else{if(E=new n.Face3,E.a=j[c++],E.b=j[c++],E.c=j[c++],g&&(p=j[c++],E.materialIndex=p),o=s.faces.length,v)for(r=0;k>r;r++)for(D=e.uvs[r],s.faceVertexUvs[r][o]=[],a=0;3>a;a++)d=j[c++],C=D[2*d],I=D[2*d+1],S=new n.Vector2(C,I),s.faceVertexUvs[r][o].push(S);if(y&&(h=3*j[c++],E.normal.set(O[h++],O[h++],O[h])),M)for(r=0;3>r;r++)h=3*j[c++],N=new n.Vector3(O[h++],O[h++],O[h]),E.vertexNormals.push(N);if(A&&(l=j[c++],E.color.setHex(z[l])),x)for(r=0;3>r;r++)l=j[c++],E.vertexColors.push(new n.Color(z[l]));s.faces.push(E)}}function r(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var i=0,r=e.skinWeights.length;r>i;i+=t){var a=e.skinWeights[i],o=t>1?e.skinWeights[i+1]:0,c=t>2?e.skinWeights[i+2]:0,u=t>3?e.skinWeights[i+3]:0;s.skinWeights.push(new n.Vector4(a,o,c,u))}if(e.skinIndices)for(var i=0,r=e.skinIndices.length;r>i;i+=t){var l=e.skinIndices[i],h=t>1?e.skinIndices[i+1]:0,d=t>2?e.skinIndices[i+2]:0,p=t>3?e.skinIndices[i+3]:0;s.skinIndices.push(new n.Vector4(l,h,d,p))}s.bones=e.bones,s.bones&&s.bones.length>0&&(s.skinWeights.length!==s.skinIndices.length||s.skinIndices.length!==s.vertices.length)&&console.warn(\"When skinning, number of vertices (\"+s.vertices.length+\"), skinIndices (\"+s.skinIndices.length+\"), and skinWeights (\"+s.skinWeights.length+\") should match.\")}function a(t){if(void 0!==e.morphTargets)for(var i=0,r=e.morphTargets.length;r>i;i++){s.morphTargets[i]={},s.morphTargets[i].name=e.morphTargets[i].name,s.morphTargets[i].vertices=[];for(var a=s.morphTargets[i].vertices,o=e.morphTargets[i].vertices,c=0,u=o.length;u>c;c+=3){var l=new n.Vector3;l.x=o[c]*t,l.y=o[c+1]*t,l.z=o[c+2]*t,a.push(l)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: \"morphColors\" no longer supported. Using them as face colors.');for(var h=s.faces,d=e.morphColors[0].colors,i=0,r=h.length;r>i;i++)h[i].color.fromArray(d,3*i)}}function o(){var t=[],i=[];void 0!==e.animation&&i.push(e.animation),void 0!==e.animations&&(e.animations.length?i=i.concat(e.animations):i.push(e.animations));for(var r=0;r<i.length;r++){var a=n.AnimationClip.parseAnimation(i[r],s.bones);a&&t.push(a)}if(s.morphTargets){var o=n.AnimationClip.CreateClipsFromMorphTargetSequences(s.morphTargets,10);t=t.concat(o)}t.length>0&&(s.animations=t)}var s=new n.Geometry,c=void 0!==e.scale?1/e.scale:1;if(i(c),r(),a(c),o(),s.computeFaceNormals(),s.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:s};var u=n.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:s,materials:u}}},n.LoadingManager=function(e,t,i){var r=this,n=!1,a=0,o=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,n===!1&&void 0!==r.onStart&&r.onStart(e,a,o),n=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)}},n.DefaultLoadingManager=new n.LoadingManager,n.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.BufferGeometryLoader.prototype={constructor:n.BufferGeometryLoader,load:function(e,t,i,r){var a=this,o=new n.XHRLoader(a.manager);o.load(e,function(e){t(a.parse(JSON.parse(e)))},i,r)},parse:function(e){var t=new n.BufferGeometry,i=e.data.index,r={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(void 0!==i){var a=new r[i.type](i.array);t.setIndex(new n.BufferAttribute(a,1))}var o=e.data.attributes;for(var s in o){var c=o[s],a=new r[c.type](c.array);t.addAttribute(s,new n.BufferAttribute(a,c.itemSize,c.normalized))}var u=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==u)for(var l=0,h=u.length;l!==h;++l){var d=u[l];t.addGroup(d.start,d.count,d.materialIndex)}var p=e.data.boundingSphere;if(void 0!==p){var f=new n.Vector3;void 0!==p.center&&f.fromArray(p.center),t.boundingSphere=new n.Sphere(f,p.radius)}return t}},n.MaterialLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.textures={}},n.MaterialLoader.prototype={constructor:n.MaterialLoader,load:function(e,t,i,r){var a=this,o=new n.XHRLoader(a.manager);o.load(e,function(e){t(a.parse(JSON.parse(e)))},i,r)},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return void 0===t[e]&&console.warn(\"THREE.MaterialLoader: Undefined texture\",e),t[e]},parse:function(e){var t=new n[e.type];if(void 0!==e.uuid&&(t.uuid=e.uuid),void 0!==e.name&&(t.name=e.name),void 0!==e.color&&t.color.setHex(e.color),void 0!==e.roughness&&(t.roughness=e.roughness),void 0!==e.metalness&&(t.metalness=e.metalness),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.alphaTest&&(t.alphaTest=e.alphaTest),void 0!==e.depthTest&&(t.depthTest=e.depthTest),void 0!==e.depthWrite&&(t.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(t.colorWrite=e.colorWrite),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(t.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(t.map=this.getTexture(e.map)),void 0!==e.alphaMap&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),void 0!==e.bumpMap&&(t.bumpMap=this.getTexture(e.bumpMap)),void 0!==e.bumpScale&&(t.bumpScale=e.bumpScale),void 0!==e.normalMap&&(t.normalMap=this.getTexture(e.normalMap)),void 0!==e.normalScale){var i=e.normalScale;Array.isArray(i)===!1&&(i=[i,i]),t.normalScale=(new n.Vector2).fromArray(i)}if(void 0!==e.displacementMap&&(t.displacementMap=this.getTexture(e.displacementMap)),void 0!==e.displacementScale&&(t.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(t.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(t.roughnessMap=this.getTexture(e.roughnessMap)),void 0!==e.metalnessMap&&(t.metalnessMap=this.getTexture(e.metalnessMap)),void 0!==e.emissiveMap&&(t.emissiveMap=this.getTexture(e.emissiveMap)),void 0!==e.emissiveIntensity&&(t.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(t.specularMap=this.getTexture(e.specularMap)),void 0!==e.envMap&&(t.envMap=this.getTexture(e.envMap),t.combine=n.MultiplyOperation),e.reflectivity&&(t.reflectivity=e.reflectivity),void 0!==e.lightMap&&(t.lightMap=this.getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(t.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(t.aoMap=this.getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity),void 0!==e.materials)for(var r=0,a=e.materials.length;a>r;r++)t.materials.push(this.parse(e.materials[r]));return t}},n.ObjectLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.texturePath=\"\"},n.ObjectLoader.prototype={constructor:n.ObjectLoader,load:function(e,t,i,r){\"\"===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf(\"/\")+1));var a=this,o=new n.XHRLoader(a.manager);o.load(e,function(e){a.parse(JSON.parse(e),t)},i,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseGeometries(e.geometries),r=this.parseImages(e.images,function(){void 0!==t&&t(o)}),n=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,n),o=this.parseObject(e.object,i,a);return e.animations&&(o.animations=this.parseAnimations(e.animations)),(void 0===e.images||0===e.images.length)&&void 0!==t&&t(o),o},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new n.JSONLoader,r=new n.BufferGeometryLoader,a=0,o=e.length;o>a;a++){var s,c=e[a];switch(c.type){case\"PlaneGeometry\":case\"PlaneBufferGeometry\":s=new n[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case\"BoxGeometry\":case\"BoxBufferGeometry\":case\"CubeGeometry\":s=new n[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case\"CircleGeometry\":case\"CircleBufferGeometry\":s=new n[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case\"CylinderGeometry\":case\"CylinderBufferGeometry\":s=new n[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case\"SphereGeometry\":case\"SphereBufferGeometry\":s=new n[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case\"DodecahedronGeometry\":s=new n.DodecahedronGeometry(c.radius,c.detail);break;case\"IcosahedronGeometry\":s=new n.IcosahedronGeometry(c.radius,c.detail);break;case\"OctahedronGeometry\":s=new n.OctahedronGeometry(c.radius,c.detail);break;case\"TetrahedronGeometry\":s=new n.TetrahedronGeometry(c.radius,c.detail);break;case\"RingGeometry\":case\"RingBufferGeometry\":s=new n[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case\"TorusGeometry\":case\"TorusBufferGeometry\":s=new n[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case\"TorusKnotGeometry\":case\"TorusKnotBufferGeometry\":s=new n[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case\"LatheGeometry\":case\"LatheBufferGeometry\":s=new n[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case\"BufferGeometry\":s=r.parse(c);break;case\"Geometry\":s=i.parse(c.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type \"'+c.type+'\"');continue}s.uuid=c.uuid,void 0!==c.name&&(s.name=c.name),t[c.uuid]=s}return t},parseMaterials:function(e,t){var i={};if(void 0!==e){var r=new n.MaterialLoader;r.setTextures(t);for(var a=0,o=e.length;o>a;a++){var s=r.parse(e[a]);i[s.uuid]=s}}return i},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=n.AnimationClip.parse(e[i]);t.push(r)}return t},parseImages:function(e,t){function i(e){return r.manager.itemStart(e),s.load(e,function(){r.manager.itemEnd(e)})}var r=this,a={};if(void 0!==e&&e.length>0){var o=new n.LoadingManager(t),s=new n.ImageLoader(o);s.setCrossOrigin(this.crossOrigin);for(var c=0,u=e.length;u>c;c++){var l=e[c],h=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;a[l.uuid]=i(h)}}return a},parseTextures:function(e,t){function i(e){return\"number\"==typeof e?e:(console.warn(\"THREE.ObjectLoader.parseTexture: Constant should be in numeric form.\",e),n[e])}var r={};if(void 0!==e)for(var a=0,o=e.length;o>a;a++){var s=e[a];void 0===s.image&&console.warn('THREE.ObjectLoader: No \"image\" specified for',s.uuid),void 0===t[s.image]&&console.warn(\"THREE.ObjectLoader: Undefined image\",s.image);var c=new n.Texture(t[s.image]);c.needsUpdate=!0,c.uuid=s.uuid,void 0!==s.name&&(c.name=s.name),void 0!==s.mapping&&(c.mapping=i(s.mapping)),void 0!==s.offset&&(c.offset=new n.Vector2(s.offset[0],s.offset[1])),void 0!==s.repeat&&(c.repeat=new n.Vector2(s.repeat[0],s.repeat[1])),void 0!==s.minFilter&&(c.minFilter=i(s.minFilter)),void 0!==s.magFilter&&(c.magFilter=i(s.magFilter)),void 0!==s.anisotropy&&(c.anisotropy=s.anisotropy),Array.isArray(s.wrap)&&(c.wrapS=i(s.wrap[0]),c.wrapT=i(s.wrap[1])),r[s.uuid]=c}return r},parseObject:function(){var e=new n.Matrix4;return function(t,i,r){function a(e){return void 0===i[e]&&console.warn(\"THREE.ObjectLoader: Undefined geometry\",e),i[e]}function o(e){return void 0===e?void 0:(void 0===r[e]&&console.warn(\"THREE.ObjectLoader: Undefined material\",e),r[e])}var s;switch(t.type){case\"Scene\":s=new n.Scene;break;case\"PerspectiveCamera\":s=new n.PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case\"OrthographicCamera\":s=new n.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case\"AmbientLight\":s=new n.AmbientLight(t.color,t.intensity);break;case\"DirectionalLight\":s=new n.DirectionalLight(t.color,t.intensity);break;case\"PointLight\":s=new n.PointLight(t.color,t.intensity,t.distance,t.decay);break;case\"SpotLight\":s=new n.SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case\"HemisphereLight\":s=new n.HemisphereLight(t.color,t.groundColor,t.intensity);break;case\"Mesh\":var c=a(t.geometry),u=o(t.material);s=c.bones&&c.bones.length>0?new n.SkinnedMesh(c,u):new n.Mesh(c,u);break;case\"LOD\":s=new n.LOD;break;case\"Line\":s=new n.Line(a(t.geometry),o(t.material),t.mode);break;case\"PointCloud\":case\"Points\":s=new n.Points(a(t.geometry),o(t.material));break;case\"Sprite\":s=new n.Sprite(o(t.material));break;case\"Group\":s=new n.Group;break;default:s=new n.Object3D}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.children)for(var l in t.children)s.add(this.parseObject(t.children[l],i,r));if(\"LOD\"===t.type)for(var h=t.levels,d=0;d<h.length;d++){var p=h[d],l=s.getObjectByProperty(\"uuid\",p.object);void 0!==l&&s.addLevel(l,p.distance)}return s}}()},n.TextureLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.TextureLoader.prototype={constructor:n.TextureLoader,load:function(e,t,i,r){var a=new n.Texture,o=new n.ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(e){a.image=e,a.needsUpdate=!0,void 0!==t&&t(a)},i,r),a},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},n.CubeTextureLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.CubeTextureLoader.prototype={constructor:n.CubeTextureLoader,load:function(e,t,i,r){function a(i){s.load(e[i],function(e){o.images[i]=e,c++,6===c&&(o.needsUpdate=!0,t&&t(o))},void 0,r)}var o=new n.CubeTexture,s=new n.ImageLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);for(var c=0,u=0;u<e.length;++u)a(u);return o},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},n.DataTextureLoader=n.BinaryTextureLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this._parser=null},n.BinaryTextureLoader.prototype={constructor:n.BinaryTextureLoader,load:function(e,t,i,r){var a=this,o=new n.DataTexture,s=new n.XHRLoader(this.manager);return s.setResponseType(\"arraybuffer\"),s.load(e,function(e){var i=a._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:n.ClampToEdgeWrapping,o.wrapT=void 0!==i.wrapT?i.wrapT:n.ClampToEdgeWrapping,o.magFilter=void 0!==i.magFilter?i.magFilter:n.LinearFilter,o.minFilter=void 0!==i.minFilter?i.minFilter:n.LinearMipMapLinearFilter,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=n.LinearFilter),o.needsUpdate=!0,t&&t(o,i))},i,r),o}},n.CompressedTextureLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this._parser=null},n.CompressedTextureLoader.prototype={constructor:n.CompressedTextureLoader,load:function(e,t,i,r){function a(a){u.load(e[a],function(e){var i=o._parser(e,!0);s[a]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(c.minFilter=n.LinearFilter),c.format=i.format,c.needsUpdate=!0,t&&t(c))},i,r)}var o=this,s=[],c=new n.CompressedTexture;c.image=s;var u=new n.XHRLoader(this.manager);if(u.setPath(this.path),u.setResponseType(\"arraybuffer\"),Array.isArray(e))for(var l=0,h=0,d=e.length;d>h;++h)a(h);else u.load(e,function(e){var i=o._parser(e,!0);if(i.isCubemap)for(var r=i.mipmaps.length/i.mipmapCount,a=0;r>a;a++){s[a]={mipmaps:[]};for(var u=0;u<i.mipmapCount;u++)s[a].mipmaps.push(i.mipmaps[a*i.mipmapCount+u]),s[a].format=i.format,s[a].width=i.width,s[a].height=i.height}else c.image.width=i.width,c.image.height=i.height,c.mipmaps=i.mipmaps;1===i.mipmapCount&&(c.minFilter=n.LinearFilter),c.format=i.format,c.needsUpdate=!0,t&&t(c)},i,r);return c},setPath:function(e){this.path=e}},n.Material=function(){Object.defineProperty(this,\"id\",{value:n.MaterialIdCount++}),this.uuid=n.Math.generateUUID(),this.name=\"\",this.type=\"Material\",this.side=n.FrontSide,this.opacity=1,this.transparent=!1,this.blending=n.NormalBlending,this.blendSrc=n.SrcAlphaFactor,this.blendDst=n.OneMinusSrcAlphaFactor,this.blendEquation=n.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=n.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},n.Material.prototype={constructor:n.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){var r=this[t];void 0!==r?r instanceof n.Color?r.set(i):r instanceof n.Vector3&&i instanceof n.Vector3?r.copy(i):this[t]=\"overdraw\"===t?Number(i):i:console.warn(\"THREE.\"+this.type+\": '\"+t+\"' is not a property of this material.\")}else console.warn(\"THREE.Material: '\"+t+\"' parameter is undefined.\")}},toJSON:function(e){function t(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}var i=void 0===e;i&&(e={textures:{},images:{}});var r={metadata:{version:4.4,type:\"Material\",generator:\"Material.toJSON\"}};if(r.uuid=this.uuid,r.type=this.type,\"\"!==this.name&&(r.name=this.name),this.color instanceof n.Color&&(r.color=this.color.getHex()),.5!==this.roughness&&(r.roughness=this.roughness),.5!==this.metalness&&(r.metalness=this.metalness),this.emissive instanceof n.Color&&(r.emissive=this.emissive.getHex()),this.specular instanceof n.Color&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),this.map instanceof n.Texture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap instanceof n.Texture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof n.Texture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof n.Texture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap instanceof n.Texture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap instanceof n.Texture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap instanceof n.Texture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap instanceof n.Texture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap instanceof n.Texture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap instanceof n.Texture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof n.Texture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==n.NoColors&&(r.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==n.SmoothShading&&(r.shading=this.shading),void 0!==this.blending&&this.blending!==n.NormalBlending&&(r.blending=this.blending),void 0!==this.side&&this.side!==n.FrontSide&&(r.side=this.side),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),i){var a=t(e.textures),o=t(e.images);a.length>0&&(r.textures=a),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.side=e.side,this.opacity=e.opacity,this.transparent=e.transparent,this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.clipShadows=e.clipShadows;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this},update:function(){this.dispatchEvent({type:\"update\"})},dispose:function(){this.dispatchEvent({type:\"dispose\"})}},n.EventDispatcher.prototype.apply(n.Material.prototype),n.MaterialIdCount=0,n.LineBasicMaterial=function(e){n.Material.call(this),this.type=\"LineBasicMaterial\",this.color=new n.Color(16777215),this.linewidth=1,this.linecap=\"round\",this.linejoin=\"round\",this.blending=n.NormalBlending,this.vertexColors=n.NoColors,this.fog=!0,this.setValues(e)},n.LineBasicMaterial.prototype=Object.create(n.Material.prototype),n.LineBasicMaterial.prototype.constructor=n.LineBasicMaterial,n.LineBasicMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.vertexColors=e.vertexColors,this.fog=e.fog,this},n.LineDashedMaterial=function(e){n.Material.call(this),this.type=\"LineDashedMaterial\",this.color=new n.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.blending=n.NormalBlending,this.vertexColors=n.NoColors,this.fog=!0,this.setValues(e)},n.LineDashedMaterial.prototype=Object.create(n.Material.prototype),n.LineDashedMaterial.prototype.constructor=n.LineDashedMaterial,n.LineDashedMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this.vertexColors=e.vertexColors,this.fog=e.fog,this},n.MeshBasicMaterial=function(e){n.Material.call(this),this.type=\"MeshBasicMaterial\",this.color=new n.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.blending=n.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},n.MeshBasicMaterial.prototype=Object.create(n.Material.prototype),n.MeshBasicMaterial.prototype.constructor=n.MeshBasicMaterial,n.MeshBasicMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},n.MeshDepthMaterial=function(e){n.Material.call(this),this.type=\"MeshDepthMaterial\",this.depthPacking=n.BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},n.MeshDepthMaterial.prototype=Object.create(n.Material.prototype),n.MeshDepthMaterial.prototype.constructor=n.MeshDepthMaterial,n.MeshDepthMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},n.MeshLambertMaterial=function(e){n.Material.call(this),this.type=\"MeshLambertMaterial\",this.color=new n.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new n.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.blending=n.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshLambertMaterial.prototype=Object.create(n.Material.prototype),n.MeshLambertMaterial.prototype.constructor=n.MeshLambertMaterial,n.MeshLambertMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},n.MeshNormalMaterial=function(e){n.Material.call(this,e),this.type=\"MeshNormalMaterial\",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},n.MeshNormalMaterial.prototype=Object.create(n.Material.prototype),n.MeshNormalMaterial.prototype.constructor=n.MeshNormalMaterial,n.MeshNormalMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},n.MeshPhongMaterial=function(e){n.Material.call(this),this.type=\"MeshPhongMaterial\",this.color=new n.Color(16777215),this.specular=new n.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new n.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.blending=n.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshPhongMaterial.prototype=Object.create(n.Material.prototype),n.MeshPhongMaterial.prototype.constructor=n.MeshPhongMaterial,n.MeshPhongMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},n.MeshStandardMaterial=function(e){n.Material.call(this),this.defines={STANDARD:\"\"},this.type=\"MeshStandardMaterial\",this.color=new n.Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new n.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.blending=n.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)\n},n.MeshStandardMaterial.prototype=Object.create(n.Material.prototype),n.MeshStandardMaterial.prototype.constructor=n.MeshStandardMaterial,n.MeshStandardMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.defines={STANDARD:\"\"},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},n.MeshPhysicalMaterial=function(e){n.MeshStandardMaterial.call(this),this.defines={PHYSICAL:\"\"},this.type=\"MeshPhysicalMaterial\",this.reflectivity=.5,this.setValues(e)},n.MeshPhysicalMaterial.prototype=Object.create(n.MeshStandardMaterial.prototype),n.MeshPhysicalMaterial.prototype.constructor=n.MeshPhysicalMaterial,n.MeshPhysicalMaterial.prototype.copy=function(e){return n.MeshStandardMaterial.prototype.copy.call(this,e),this.defines={PHYSICAL:\"\"},this.reflectivity=e.reflectivity,this},n.MultiMaterial=function(e){this.uuid=n.Math.generateUUID(),this.type=\"MultiMaterial\",this.materials=e instanceof Array?e:[],this.visible=!0},n.MultiMaterial.prototype={constructor:n.MultiMaterial,toJSON:function(e){for(var t={metadata:{version:4.2,type:\"material\",generator:\"MaterialExporter\"},uuid:this.uuid,type:this.type,materials:[]},i=this.materials,r=0,n=i.length;n>r;r++){var a=i[r].toJSON(e);delete a.metadata,t.materials.push(a)}return t.visible=this.visible,t},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},n.PointsMaterial=function(e){n.Material.call(this),this.type=\"PointsMaterial\",this.color=new n.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.blending=n.NormalBlending,this.vertexColors=n.NoColors,this.fog=!0,this.setValues(e)},n.PointsMaterial.prototype=Object.create(n.Material.prototype),n.PointsMaterial.prototype.constructor=n.PointsMaterial,n.PointsMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.vertexColors=e.vertexColors,this.fog=e.fog,this},n.ShaderMaterial=function(e){n.Material.call(this),this.type=\"ShaderMaterial\",this.defines={},this.uniforms={},this.vertexShader=\"void main() {\\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}\",this.fragmentShader=\"void main() {\\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\",this.shading=n.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error(\"THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.\"),this.setValues(e))},n.ShaderMaterial.prototype=Object.create(n.Material.prototype),n.ShaderMaterial.prototype.constructor=n.ShaderMaterial,n.ShaderMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=n.UniformsUtils.clone(e.uniforms),this.defines=e.defines,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},n.ShaderMaterial.prototype.toJSON=function(e){var t=n.Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},n.RawShaderMaterial=function(e){n.ShaderMaterial.call(this,e),this.type=\"RawShaderMaterial\"},n.RawShaderMaterial.prototype=Object.create(n.ShaderMaterial.prototype),n.RawShaderMaterial.prototype.constructor=n.RawShaderMaterial,n.SpriteMaterial=function(e){n.Material.call(this),this.type=\"SpriteMaterial\",this.color=new n.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},n.SpriteMaterial.prototype=Object.create(n.Material.prototype),n.SpriteMaterial.prototype.constructor=n.SpriteMaterial,n.SpriteMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.fog=e.fog,this},n.Texture=function(e,t,i,r,a,o,s,c,u,l){Object.defineProperty(this,\"id\",{value:n.TextureIdCount++}),this.uuid=n.Math.generateUUID(),this.name=\"\",this.sourceFile=\"\",this.image=void 0!==e?e:n.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:n.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:n.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:n.ClampToEdgeWrapping,this.magFilter=void 0!==a?a:n.LinearFilter,this.minFilter=void 0!==o?o:n.LinearMipMapLinearFilter,this.anisotropy=void 0!==u?u:1,this.format=void 0!==s?s:n.RGBAFormat,this.type=void 0!==c?c:n.UnsignedByteType,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:n.LinearEncoding,this.version=0,this.onUpdate=null},n.Texture.DEFAULT_IMAGE=void 0,n.Texture.DEFAULT_MAPPING=n.UVMapping,n.Texture.prototype={constructor:n.Texture,set needsUpdate(e){e===!0&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){function t(e){var t;return void 0!==e.toDataURL?t=e:(t=document.createElement(\"canvas\"),t.width=e.width,t.height=e.height,t.getContext(\"2d\").drawImage(e,0,0,e.width,e.height)),t.width>2048||t.height>2048?t.toDataURL(\"image/jpeg\",.6):t.toDataURL(\"image/png\")}if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.4,type:\"Texture\",generator:\"Texture.toJSON\"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var r=this.image;void 0===r.uuid&&(r.uuid=n.Math.generateUUID()),void 0===e.images[r.uuid]&&(e.images[r.uuid]={uuid:r.uuid,url:t(r)}),i.image=r.uuid}return e.textures[this.uuid]=i,i},dispose:function(){this.dispatchEvent({type:\"dispose\"})},transformUv:function(e){if(this.mapping===n.UVMapping){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||e.x>1)switch(this.wrapS){case n.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case n.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case n.MirroredRepeatWrapping:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case n.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case n.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case n.MirroredRepeatWrapping:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}},n.EventDispatcher.prototype.apply(n.Texture.prototype),n.TextureIdCount=0,n.DepthTexture=function(e,t,i,r,a,o,s,c,u){n.Texture.call(this,null,r,a,o,s,c,n.DepthFormat,i,u),this.image={width:e,height:t},this.type=void 0!==i?i:n.UnsignedShortType,this.magFilter=void 0!==s?s:n.NearestFilter,this.minFilter=void 0!==c?c:n.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},n.DepthTexture.prototype=Object.create(n.Texture.prototype),n.DepthTexture.prototype.constructor=n.DepthTexture,n.CanvasTexture=function(e,t,i,r,a,o,s,c,u){n.Texture.call(this,e,t,i,r,a,o,s,c,u),this.needsUpdate=!0},n.CanvasTexture.prototype=Object.create(n.Texture.prototype),n.CanvasTexture.prototype.constructor=n.CanvasTexture,n.CubeTexture=function(e,t,i,r,a,o,s,c,u,l){e=void 0!==e?e:[],t=void 0!==t?t:n.CubeReflectionMapping,n.Texture.call(this,e,t,i,r,a,o,s,c,u,l),this.flipY=!1},n.CubeTexture.prototype=Object.create(n.Texture.prototype),n.CubeTexture.prototype.constructor=n.CubeTexture,Object.defineProperty(n.CubeTexture.prototype,\"images\",{get:function(){return this.image},set:function(e){this.image=e}}),n.CompressedTexture=function(e,t,i,r,a,o,s,c,u,l,h,d){n.Texture.call(this,null,o,s,c,u,l,r,a,h,d),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},n.CompressedTexture.prototype=Object.create(n.Texture.prototype),n.CompressedTexture.prototype.constructor=n.CompressedTexture,n.DataTexture=function(e,t,i,r,a,o,s,c,u,l,h,d){n.Texture.call(this,null,o,s,c,u,l,r,a,h,d),this.image={data:e,width:t,height:i},this.magFilter=void 0!==u?u:n.NearestFilter,this.minFilter=void 0!==l?l:n.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},n.DataTexture.prototype=Object.create(n.Texture.prototype),n.DataTexture.prototype.constructor=n.DataTexture,n.VideoTexture=function(e,t,i,r,a,o,s,c,u){function l(){requestAnimationFrame(l),e.readyState>=e.HAVE_CURRENT_DATA&&(h.needsUpdate=!0)}n.Texture.call(this,e,t,i,r,a,o,s,c,u),this.generateMipmaps=!1;var h=this;l()},n.VideoTexture.prototype=Object.create(n.Texture.prototype),n.VideoTexture.prototype.constructor=n.VideoTexture,n.Group=function(){n.Object3D.call(this),this.type=\"Group\"},n.Group.prototype=Object.create(n.Object3D.prototype),n.Group.prototype.constructor=n.Group,n.Points=function(e,t){n.Object3D.call(this),this.type=\"Points\",this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.PointsMaterial({color:16777215*Math.random()})},n.Points.prototype=Object.create(n.Object3D.prototype),n.Points.prototype.constructor=n.Points,n.Points.prototype.raycast=function(){var e=new n.Matrix4,t=new n.Ray,i=new n.Sphere;return function(r,a){function o(e,i){var n=t.distanceSqToPoint(e);if(d>n){var o=t.closestPointToPoint(e);o.applyMatrix4(u);var c=r.ray.origin.distanceTo(o);if(c<r.near||c>r.far)return;a.push({distance:c,distanceToRay:Math.sqrt(n),point:o.clone(),index:i,face:null,object:s})}}var s=this,c=this.geometry,u=this.matrixWorld,l=r.params.Points.threshold;if(null===c.boundingSphere&&c.computeBoundingSphere(),i.copy(c.boundingSphere),i.applyMatrix4(u),r.ray.intersectsSphere(i)!==!1){e.getInverse(u),t.copy(r.ray).applyMatrix4(e);var h=l/((this.scale.x+this.scale.y+this.scale.z)/3),d=h*h,p=new n.Vector3;if(c instanceof n.BufferGeometry){var f=c.index,m=c.attributes,g=m.position.array;if(null!==f)for(var v=f.array,y=0,M=v.length;M>y;y++){var A=v[y];p.fromArray(g,3*A),o(p,A)}else for(var y=0,x=g.length/3;x>y;y++)p.fromArray(g,3*y),o(p,y)}else for(var w=c.vertices,y=0,x=w.length;x>y;y++)o(w[y],y)}}}(),n.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},n.Line=function(e,t,i){return 1===i?(console.warn(\"THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.\"),new n.LineSegments(e,t)):(n.Object3D.call(this),this.type=\"Line\",this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.LineBasicMaterial({color:16777215*Math.random()}),void 0)},n.Line.prototype=Object.create(n.Object3D.prototype),n.Line.prototype.constructor=n.Line,n.Line.prototype.raycast=function(){var e=new n.Matrix4,t=new n.Ray,i=new n.Sphere;return function(r,a){var o=r.linePrecision,s=o*o,c=this.geometry,u=this.matrixWorld;if(null===c.boundingSphere&&c.computeBoundingSphere(),i.copy(c.boundingSphere),i.applyMatrix4(u),r.ray.intersectsSphere(i)!==!1){e.getInverse(u),t.copy(r.ray).applyMatrix4(e);var l=new n.Vector3,h=new n.Vector3,d=new n.Vector3,p=new n.Vector3,f=this instanceof n.LineSegments?2:1;if(c instanceof n.BufferGeometry){var m=c.index,g=c.attributes,v=g.position.array;if(null!==m)for(var y=m.array,M=0,A=y.length-1;A>M;M+=f){var x=y[M],w=y[M+1];l.fromArray(v,3*x),h.fromArray(v,3*w);var E=t.distanceSqToSegment(l,h,p,d);if(!(E>s)){p.applyMatrix4(this.matrixWorld);var b=r.ray.origin.distanceTo(p);b<r.near||b>r.far||a.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}else for(var M=0,A=v.length/3-1;A>M;M+=f){l.fromArray(v,3*M),h.fromArray(v,3*M+3);var E=t.distanceSqToSegment(l,h,p,d);if(!(E>s)){p.applyMatrix4(this.matrixWorld);var b=r.ray.origin.distanceTo(p);b<r.near||b>r.far||a.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}}else if(c instanceof n.Geometry)for(var T=c.vertices,L=T.length,M=0;L-1>M;M+=f){var E=t.distanceSqToSegment(T[M],T[M+1],p,d);if(!(E>s)){p.applyMatrix4(this.matrixWorld);var b=r.ray.origin.distanceTo(p);b<r.near||b>r.far||a.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}}}}(),n.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},n.LineStrip=0,n.LinePieces=1,n.LineSegments=function(e,t){n.Line.call(this,e,t),this.type=\"LineSegments\"},n.LineSegments.prototype=Object.create(n.Line.prototype),n.LineSegments.prototype.constructor=n.LineSegments,n.Mesh=function(e,t){n.Object3D.call(this),this.type=\"Mesh\",this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=n.TrianglesDrawMode,this.updateMorphTargets()},n.Mesh.prototype=Object.create(n.Object3D.prototype),n.Mesh.prototype.constructor=n.Mesh,n.Mesh.prototype.setDrawMode=function(e){this.drawMode=e},n.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},n.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.warn(\"THREE.Mesh.getMorphTargetIndexByName: morph target \"+e+\" does not exist. Returning 0.\"),0)},n.Mesh.prototype.raycast=function(){function e(e,t,i,r,a,o,s){return n.Triangle.barycoordFromPoint(e,t,i,r,g),a.multiplyScalar(g.x),o.multiplyScalar(g.y),s.multiplyScalar(g.z),a.add(o).add(s),a.clone()}function t(e,t,i,r,a,o,s){var c,u=e.material;if(c=u.side===n.BackSide?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,u.side!==n.DoubleSide,s),null===c)return null;y.copy(s),y.applyMatrix4(e.matrixWorld);var l=t.ray.origin.distanceTo(y);return l<t.near||l>t.far?null:{distance:l,point:y.clone(),object:e}}function i(i,r,a,o,l,h,d,g){s.fromArray(o,3*h),c.fromArray(o,3*d),u.fromArray(o,3*g);var y=t(i,r,a,s,c,u,v);return y&&(l&&(p.fromArray(l,2*h),f.fromArray(l,2*d),m.fromArray(l,2*g),y.uv=e(v,s,c,u,p,f,m)),y.face=new n.Face3(h,d,g,n.Triangle.normal(s,c,u)),y.faceIndex=h),y}var r=new n.Matrix4,a=new n.Ray,o=new n.Sphere,s=new n.Vector3,c=new n.Vector3,u=new n.Vector3,l=new n.Vector3,h=new n.Vector3,d=new n.Vector3,p=new n.Vector2,f=new n.Vector2,m=new n.Vector2,g=new n.Vector3,v=new n.Vector3,y=new n.Vector3;return function(g,y){var M=this.geometry,A=this.material,x=this.matrixWorld;if(void 0!==A&&(null===M.boundingSphere&&M.computeBoundingSphere(),o.copy(M.boundingSphere),o.applyMatrix4(x),g.ray.intersectsSphere(o)!==!1&&(r.getInverse(x),a.copy(g.ray).applyMatrix4(r),null===M.boundingBox||a.intersectsBox(M.boundingBox)!==!1))){var w,E;if(M instanceof n.BufferGeometry){var b,T,L,N=M.index,D=M.attributes,S=D.position.array;if(void 0!==D.uv&&(w=D.uv.array),null!==N)for(var C=N.array,I=0,j=C.length;j>I;I+=3)b=C[I],T=C[I+1],L=C[I+2],E=i(this,g,a,S,w,b,T,L),E&&(E.faceIndex=Math.floor(I/3),y.push(E));else for(var I=0,j=S.length;j>I;I+=9)b=I/3,T=b+1,L=b+2,E=i(this,g,a,S,w,b,T,L),E&&(E.index=b,y.push(E))}else if(M instanceof n.Geometry){var _,O,z,k=A instanceof n.MultiMaterial,R=k===!0?A.materials:null,B=M.vertices,U=M.faces,P=M.faceVertexUvs[0];P.length>0&&(w=P);for(var F=0,G=U.length;G>F;F++){var V=U[F],Q=k===!0?R[V.materialIndex]:A;if(void 0!==Q){if(_=B[V.a],O=B[V.b],z=B[V.c],Q.morphTargets===!0){var Y=M.morphTargets,H=this.morphTargetInfluences;s.set(0,0,0),c.set(0,0,0),u.set(0,0,0);for(var W=0,X=Y.length;X>W;W++){var q=H[W];if(0!==q){var Z=Y[W].vertices;s.addScaledVector(l.subVectors(Z[V.a],_),q),c.addScaledVector(h.subVectors(Z[V.b],O),q),u.addScaledVector(d.subVectors(Z[V.c],z),q)}}s.add(_),c.add(O),u.add(z),_=s,O=c,z=u}if(E=t(this,g,a,_,O,z,v)){if(w){var K=w[F];p.copy(K[0]),f.copy(K[1]),m.copy(K[2]),E.uv=e(v,_,O,z,p,f,m)}E.face=V,E.faceIndex=F,y.push(E)}}}}}}}(),n.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},n.Bone=function(e){n.Object3D.call(this),this.type=\"Bone\",this.skin=e},n.Bone.prototype=Object.create(n.Object3D.prototype),n.Bone.prototype.constructor=n.Bone,n.Bone.prototype.copy=function(e){return n.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this},n.Skeleton=function(e,t,i){if(this.useVertexTexture=void 0!==i?i:!0,this.identityMatrix=new n.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var r=Math.sqrt(4*this.bones.length);r=n.Math.nextPowerOfTwo(Math.ceil(r)),r=Math.max(r,4),this.boneTextureWidth=r,this.boneTextureHeight=r,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new n.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,n.RGBAFormat,n.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn(\"THREE.Skeleton bonInverses is the wrong length.\"),this.boneInverses=[];for(var a=0,o=this.bones.length;o>a;a++)this.boneInverses.push(new n.Matrix4)}},n.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;t>e;e++){var i=new n.Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},n.Skeleton.prototype.pose=function(){for(var e,t=0,i=this.bones.length;i>t;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,i=this.bones.length;i>t;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},n.Skeleton.prototype.update=function(){var e=new n.Matrix4;return function(){for(var t=0,i=this.bones.length;i>t;t++){var r=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(r,this.boneInverses[t]),e.toArray(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),n.Skeleton.prototype.clone=function(){return new n.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},n.SkinnedMesh=function(e,t,i){n.Mesh.call(this,e,t),this.type=\"SkinnedMesh\",this.bindMode=\"attached\",this.bindMatrix=new n.Matrix4,this.bindMatrixInverse=new n.Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var a,o,s=0,c=this.geometry.bones.length;c>s;++s)o=this.geometry.bones[s],a=new n.Bone(this),r.push(a),a.name=o.name,a.position.fromArray(o.pos),a.quaternion.fromArray(o.rotq),void 0!==o.scl&&a.scale.fromArray(o.scl);for(var s=0,c=this.geometry.bones.length;c>s;++s)o=this.geometry.bones[s],-1!==o.parent&&null!==o.parent&&void 0!==r[o.parent]?r[o.parent].add(r[s]):this.add(r[s])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new n.Skeleton(r,void 0,i),this.matrixWorld)},n.SkinnedMesh.prototype=Object.create(n.Mesh.prototype),n.SkinnedMesh.prototype.constructor=n.SkinnedMesh,n.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},n.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},n.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof n.Geometry)for(var e=0;e<this.geometry.skinWeights.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();1/0!==i?t.multiplyScalar(i):t.set(1,0,0,0)}else if(this.geometry instanceof n.BufferGeometry)for(var r=new n.Vector4,a=this.geometry.attributes.skinWeight,e=0;e<a.count;e++){r.x=a.getX(e),r.y=a.getY(e),r.z=a.getZ(e),r.w=a.getW(e);var i=1/r.lengthManhattan();1/0!==i?r.multiplyScalar(i):r.set(1,0,0,0),a.setXYZW(e,r.x,r.y,r.z,r.w)}},n.SkinnedMesh.prototype.updateMatrixWorld=function(){n.Mesh.prototype.updateMatrixWorld.call(this,!0),\"attached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):\"detached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn(\"THREE.SkinnedMesh unrecognized bindMode: \"+this.bindMode)},n.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},n.LOD=function(){n.Object3D.call(this),this.type=\"LOD\",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})},n.LOD.prototype=Object.create(n.Object3D.prototype),n.LOD.prototype.constructor=n.LOD,n.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,r=0;r<i.length&&!(t<i[r].distance);r++);i.splice(r,0,{distance:t,object:e}),this.add(e)},n.LOD.prototype.getObjectForDistance=function(e){for(var t=this.levels,i=1,r=t.length;r>i&&!(e<t[i].distance);i++);return t[i-1].object},n.LOD.prototype.raycast=function(){var e=new n.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,i)}}(),n.LOD.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3;return function(i){var r=this.levels;if(r.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);r[0].object.visible=!0;for(var a=1,o=r.length;o>a&&n>=r[a].distance;a++)r[a-1].object.visible=!1,r[a].object.visible=!0;for(;o>a;a++)r[a].object.visible=!1}}}(),n.LOD.prototype.copy=function(e){n.Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;r>i;i++){var a=t[i];this.addLevel(a.object.clone(),a.distance)}return this},n.LOD.prototype.toJSON=function(e){var t=n.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var i=this.levels,r=0,a=i.length;a>r;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t},n.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),i=new Float32Array([0,0,1,0,1,1,0,1]),r=new n.BufferGeometry;return r.setIndex(new n.BufferAttribute(e,1)),r.addAttribute(\"position\",new n.BufferAttribute(t,3)),r.addAttribute(\"uv\",new n.BufferAttribute(i,2)),function(e){n.Object3D.call(this),this.type=\"Sprite\",this.geometry=r,this.material=void 0!==e?e:new n.SpriteMaterial}}(),n.Sprite.prototype=Object.create(n.Object3D.prototype),n.Sprite.prototype.constructor=n.Sprite,n.Sprite.prototype.raycast=function(){var e=new n.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.distanceSqToPoint(e),n=this.scale.x*this.scale.y/4;r>n||i.push({distance:Math.sqrt(r),point:this.position,face:null,object:this})}}(),n.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},n.Particle=n.Sprite,n.LensFlare=function(e,t,i,r,a){n.Object3D.call(this),this.lensFlares=[],this.positionScreen=new n.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,r,a)},n.LensFlare.prototype=Object.create(n.Object3D.prototype),n.LensFlare.prototype.constructor=n.LensFlare,n.LensFlare.prototype.add=function(e,t,i,r,a,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===a&&(a=new n.Color(16777215)),void 0===r&&(r=n.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:a,blending:r})},n.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},n.LensFlare.prototype.copy=function(e){n.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;i>t;t++)this.lensFlares.push(e.lensFlares[t]);return this},n.Scene=function(){n.Object3D.call(this),this.type=\"Scene\",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},n.Scene.prototype=Object.create(n.Object3D.prototype),n.Scene.prototype.constructor=n.Scene,n.Scene.prototype.copy=function(e,t){return n.Object3D.prototype.copy.call(this,e,t),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},n.Fog=function(e,t,i){this.name=\"\",this.color=new n.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},n.Fog.prototype.clone=function(){return new n.Fog(this.color.getHex(),this.near,this.far)},n.FogExp2=function(e,t){this.name=\"\",this.color=new n.Color(e),this.density=void 0!==t?t:25e-5},n.FogExp2.prototype.clone=function(){return new n.FogExp2(this.color.getHex(),this.density)},n.ShaderChunk={},n.ShaderChunk.alphamap_fragment=\"#ifdef USE_ALPHAMAP\\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n#endif\\n\",n.ShaderChunk.alphamap_pars_fragment=\"#ifdef USE_ALPHAMAP\\n\tuniform sampler2D alphaMap;\\n#endif\\n\",n.ShaderChunk.alphatest_fragment=\"#ifdef ALPHATEST\\n\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\\n\",n.ShaderChunk.aomap_fragment=\"#ifdef USE_AOMAP\\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\t#endif\\n#endif\\n\",n.ShaderChunk.aomap_pars_fragment=\"#ifdef USE_AOMAP\\n\tuniform sampler2D aoMap;\\n\tuniform float aoMapIntensity;\\n#endif\",n.ShaderChunk.begin_vertex=\"\\nvec3 transformed = vec3( position );\\n\",n.ShaderChunk.beginnormal_vertex=\"\\nvec3 objectNormal = vec3( normal );\\n\",n.ShaderChunk.bsdfs=\"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\\n}\\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n\t\tif( decayExponent > 0.0 ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\\n#else\\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n#endif\\n\t\t}\\n\t\treturn 1.0;\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\tfloat a2 = pow2( alpha );\\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\tfloat a2 = pow2( alpha );\\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\tfloat a2 = pow2( alpha );\\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\tfloat alpha = pow2( roughness );\\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\tvec3 F = F_Schlick( specularColor, dotLH );\\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\tfloat D = D_GGX( alpha, dotNH );\\n\treturn F * ( G * D );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\tvec4 r = roughness * c0 + c1;\\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\\n\treturn specularColor * AB.x + AB.y;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\tvec3 F = F_Schlick( specularColor, dotLH );\\n\tfloat G = G_BlinnPhong_Implicit( );\\n\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\\n\",n.ShaderChunk.bumpmap_pars_fragment=\"#ifdef USE_BUMPMAP\\n\tuniform sampler2D bumpMap;\\n\tuniform float bumpScale;\\n\tvec2 dHdxy_fwd() {\\n\t\tvec2 dSTdx = dFdx( vUv );\\n\t\tvec2 dSTdy = dFdy( vUv );\\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\t\treturn vec2( dBx, dBy );\\n\t}\\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\t\tvec3 vSigmaX = dFdx( surf_pos );\\n\t\tvec3 vSigmaY = dFdy( surf_pos );\\n\t\tvec3 vN = surf_norm;\\n\t\tvec3 R1 = cross( vSigmaY, vN );\\n\t\tvec3 R2 = cross( vN, vSigmaX );\\n\t\tfloat fDet = dot( vSigmaX, R1 );\\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\t}\\n#endif\\n\",n.ShaderChunk.clipping_planes_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\\n\t\tvec4 plane = clippingPlanes[ i ];\\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\\n\t}\\n#endif\\n\",n.ShaderChunk.clipping_planes_pars_fragment=\"#if NUM_CLIPPING_PLANES > 0\\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\\n\t\tvarying vec3 vViewPosition;\\n\t#endif\\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\\n\",n.ShaderChunk.clipping_planes_pars_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\tvarying vec3 vViewPosition;\\n#endif\\n\",n.ShaderChunk.clipping_planes_vertex=\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\\n\tvViewPosition = - mvPosition.xyz;\\n#endif\\n\",n.ShaderChunk.color_fragment=\"#ifdef USE_COLOR\\n\tdiffuseColor.rgb *= vColor;\\n#endif\",n.ShaderChunk.color_pars_fragment=\"#ifdef USE_COLOR\\n\tvarying vec3 vColor;\\n#endif\\n\",n.ShaderChunk.color_pars_vertex=\"#ifdef USE_COLOR\\n\tvarying vec3 vColor;\\n#endif\",n.ShaderChunk.color_vertex=\"#ifdef USE_COLOR\\n\tvColor.xyz = color.xyz;\\n#endif\",n.ShaderChunk.common=\"#define PI 3.14159265359\\n#define PI2 6.28318530718\\n#define RECIPROCAL_PI 0.31830988618\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\treturn fract(sin(sn) * c);\\n}\\nstruct IncidentLight {\\n\tvec3 color;\\n\tvec3 direction;\\n\tbool visible;\\n};\\nstruct ReflectedLight {\\n\tvec3 directDiffuse;\\n\tvec3 directSpecular;\\n\tvec3 indirectDiffuse;\\n\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\tvec3 position;\\n\tvec3 normal;\\n\tvec3 viewDir;\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\n\",n.ShaderChunk.cube_uv_reflection_fragment=\"#ifdef ENVMAP_TYPE_CUBE_UV\\nconst float cubeUV_textureSize = 1024.0;\\nint getFaceFromDirection(vec3 direction) {\\n\tvec3 absDirection = abs(direction);\\n\tint face = -1;\\n\tif( absDirection.x > absDirection.z ) {\\n\t\tif(absDirection.x > absDirection.y )\\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\\n\t\telse\\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\\n\t}\\n\telse {\\n\t\tif(absDirection.z > absDirection.y )\\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\\n\t\telse\\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\\n\t}\\n\treturn face;\\n}\\nfloat cubeUV_maxLods1 = log2(cubeUV_textureSize*0.25) - 1.0;\\nfloat cubeUV_rangeClamp = exp2((6.0 - 1.0) * 2.0);\\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\\n\tfloat dxRoughness = dFdx(roughness);\\n\tfloat dyRoughness = dFdy(roughness);\\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\\n\tfloat mipLevel = 0.5 * log2(d);\\n\treturn vec2(floor(mipLevel), fract(mipLevel));\\n}\\nfloat cubeUV_maxLods2 = log2(cubeUV_textureSize*0.25) - 2.0;\\nconst float cubeUV_rcpTextureSize = 1.0 / cubeUV_textureSize;\\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\\n\tbool bRes = mipLevel == 0.0;\\n\tscale =  bRes && (scale < a) ? a : scale;\\n\tvec3 r;\\n\tvec2 offset;\\n\tint face = getFaceFromDirection(direction);\\n\tfloat rcpPowScale = 1.0 / powScale;\\n\tif( face == 0) {\\n\t\tr = vec3(direction.x, -direction.z, direction.y);\\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\t}\\n\telse if( face == 1) {\\n\t\tr = vec3(direction.y, direction.x, direction.z);\\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\t}\\n\telse if( face == 2) {\\n\t\tr = vec3(direction.z, direction.x, direction.y);\\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\\n\t}\\n\telse if( face == 3) {\\n\t\tr = vec3(direction.x, direction.z, direction.y);\\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\t}\\n\telse if( face == 4) {\\n\t\tr = vec3(direction.y, direction.x, -direction.z);\\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\t}\\n\telse {\\n\t\tr = vec3(direction.z, -direction.x, direction.y);\\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\\n\t}\\n\tr = normalize(r);\\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\\n\tvec2 base = offset + vec2( texelOffset );\\n\treturn base + s * ( scale - 2.0 * texelOffset );\\n}\\nfloat cubeUV_maxLods3 = log2(cubeUV_textureSize*0.25) - 3.0;\\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\\n\tfloat r1 = floor(roughnessVal);\\n\tfloat r2 = r1 + 1.0;\\n\tfloat t = fract(roughnessVal);\\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\\n\tfloat s = mipInfo.y;\\n\tfloat level0 = mipInfo.x;\\n\tfloat level1 = level0 + 1.0;\\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\\n\tvec4 result = mix(color10, color20, t);\\n\treturn vec4(result.rgb, 1.0);\\n}\\n#endif\\n\",n.ShaderChunk.defaultnormal_vertex=\"#ifdef FLIP_SIDED\\n\tobjectNormal = -objectNormal;\\n#endif\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\",n.ShaderChunk.displacementmap_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n#endif\\n\",n.ShaderChunk.displacementmap_pars_vertex=\"#ifdef USE_DISPLACEMENTMAP\\n\tuniform sampler2D displacementMap;\\n\tuniform float displacementScale;\\n\tuniform float displacementBias;\\n#endif\\n\",n.ShaderChunk.emissivemap_fragment=\"#ifdef USE_EMISSIVEMAP\\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\\n\",n.ShaderChunk.emissivemap_pars_fragment=\"#ifdef USE_EMISSIVEMAP\\n\tuniform sampler2D emissiveMap;\\n#endif\\n\",n.ShaderChunk.encodings_pars_fragment=\"\\nvec4 LinearToLinear( in vec4 value ) {\\n  return value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n  float maxComponent = max( max( value.r, value.g ), value.b );\\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n  float maxRGB = max( value.x, max( value.g, value.b ) );\\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n  M            = ceil( M * 255.0 ) / 255.0;\\n  return vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n    float maxRGB = max( value.x, max( value.g, value.b ) );\\n    float D      = max( maxRange / maxRGB, 1.0 );\\n    D            = min( floor( D ) / 255.0, 1.0 );\\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value )  {\\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\\n  vec4 vResult;\\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n  vResult.w = fract(Le);\\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\\n  return vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n  float Le = value.z * 255.0 + value.w;\\n  vec3 Xp_Y_XYZp;\\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\\n  return vec4( max(vRGB, 0.0), 1.0 );\\n}\\n\",n.ShaderChunk.encodings_fragment=\"  gl_FragColor = linearToOutputTexel( gl_FragColor );\\n\",n.ShaderChunk.envmap_fragment=\"#ifdef USE_ENVMAP\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\t\t#else\\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\t\t#endif\\n\t#else\\n\t\tvec3 reflectVec = vReflect;\\n\t#endif\\n\t#ifdef DOUBLE_SIDED\\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\t#else\\n\t\tfloat flipNormal = 1.0;\\n\t#endif\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\tvec2 sampleUV;\\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\\n\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\t#endif\\n\tenvColor = envMapTexelToLinear( envColor );\\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\t#elif defined( ENVMAP_BLENDING_MIX )\\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\t#elif defined( ENVMAP_BLENDING_ADD )\\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\t#endif\\n#endif\\n\",n.ShaderChunk.envmap_pars_fragment=\"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\\n\tuniform float reflectivity;\\n\tuniform float envMapIntenstiy;\\n#endif\\n#ifdef USE_ENVMAP\\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\\n\t\tvarying vec3 vWorldPosition;\\n\t#endif\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tuniform samplerCube envMap;\\n\t#else\\n\t\tuniform sampler2D envMap;\\n\t#endif\\n\tuniform float flipEnvMap;\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\\n\t\tuniform float refractionRatio;\\n\t#else\\n\t\tvarying vec3 vReflect;\\n\t#endif\\n#endif\\n\",n.ShaderChunk.envmap_pars_vertex=\"#ifdef USE_ENVMAP\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\t\tvarying vec3 vWorldPosition;\\n\t#else\\n\t\tvarying vec3 vReflect;\\n\t\tuniform float refractionRatio;\\n\t#endif\\n#endif\\n\",n.ShaderChunk.envmap_vertex=\"#ifdef USE_ENVMAP\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\t\tvWorldPosition = worldPosition.xyz;\\n\t#else\\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\\n\t\t#else\\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\t\t#endif\\n\t#endif\\n#endif\\n\",n.ShaderChunk.fog_fragment=\"#ifdef USE_FOG\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\t#else\\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\t#endif\\n\t#ifdef FOG_EXP2\\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\\n\t#else\\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\t#endif\\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\\n\",n.ShaderChunk.fog_pars_fragment=\"#ifdef USE_FOG\\n\tuniform vec3 fogColor;\\n\t#ifdef FOG_EXP2\\n\t\tuniform float fogDensity;\\n\t#else\\n\t\tuniform float fogNear;\\n\t\tuniform float fogFar;\\n\t#endif\\n#endif\",n.ShaderChunk.lightmap_fragment=\"#ifdef USE_LIGHTMAP\\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n#endif\\n\",n.ShaderChunk.lightmap_pars_fragment=\"#ifdef USE_LIGHTMAP\\n\tuniform sampler2D lightMap;\\n\tuniform float lightMapIntensity;\\n#endif\",n.ShaderChunk.lights_lambert_vertex=\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\tvLightBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\n#if NUM_POINT_LIGHTS > 0\\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\t\tdotNL = dot( geometry.normal, directLight.direction );\\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\t\t#ifdef DOUBLE_SIDED\\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\t\t#endif\\n\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\t\tdotNL = dot( geometry.normal, directLight.direction );\\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\t\t#ifdef DOUBLE_SIDED\\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\t\t#endif\\n\t}\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\t\tdotNL = dot( geometry.normal, directLight.direction );\\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\t\t#ifdef DOUBLE_SIDED\\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\t\t#endif\\n\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\t\t#ifdef DOUBLE_SIDED\\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\t\t#endif\\n\t}\\n#endif\\n\",n.ShaderChunk.lights_pars=\"uniform vec3 ambientLightColor;\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\tvec3 irradiance = ambientLightColor;\\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\t\tirradiance *= PI;\\n\t#endif\\n\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\tstruct DirectionalLight {\\n\t\tvec3 direction;\\n\t\tvec3 color;\\n\t\tint shadow;\\n\t\tfloat shadowBias;\\n\t\tfloat shadowRadius;\\n\t\tvec2 shadowMapSize;\\n\t};\\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\t\tdirectLight.color = directionalLight.color;\\n\t\tdirectLight.direction = directionalLight.direction;\\n\t\tdirectLight.visible = true;\\n\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\tstruct PointLight {\\n\t\tvec3 position;\\n\t\tvec3 color;\\n\t\tfloat distance;\\n\t\tfloat decay;\\n\t\tint shadow;\\n\t\tfloat shadowBias;\\n\t\tfloat shadowRadius;\\n\t\tvec2 shadowMapSize;\\n\t};\\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\t\tvec3 lVector = pointLight.position - geometry.position;\\n\t\tdirectLight.direction = normalize( lVector );\\n\t\tfloat lightDistance = length( lVector );\\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\\n\t\t\tdirectLight.color = pointLight.color;\\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\t\t\tdirectLight.visible = true;\\n\t\t} else {\\n\t\t\tdirectLight.color = vec3( 0.0 );\\n\t\t\tdirectLight.visible = false;\\n\t\t}\\n\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\tstruct SpotLight {\\n\t\tvec3 position;\\n\t\tvec3 direction;\\n\t\tvec3 color;\\n\t\tfloat distance;\\n\t\tfloat decay;\\n\t\tfloat coneCos;\\n\t\tfloat penumbraCos;\\n\t\tint shadow;\\n\t\tfloat shadowBias;\\n\t\tfloat shadowRadius;\\n\t\tvec2 shadowMapSize;\\n\t};\\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\\n\t\tvec3 lVector = spotLight.position - geometry.position;\\n\t\tdirectLight.direction = normalize( lVector );\\n\t\tfloat lightDistance = length( lVector );\\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\t\t\tdirectLight.color = spotLight.color;\\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\t\t\tdirectLight.visible = true;\\n\t\t} else {\\n\t\t\tdirectLight.color = vec3( 0.0 );\\n\t\t\tdirectLight.visible = false;\\n\t\t}\\n\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\tstruct HemisphereLight {\\n\t\tvec3 direction;\\n\t\tvec3 skyColor;\\n\t\tvec3 groundColor;\\n\t};\\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\t\t\tirradiance *= PI;\\n\t\t#endif\\n\t\treturn irradiance;\\n\t}\\n#endif\\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\t\t#ifdef DOUBLE_SIDED\\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\t\t#else\\n\t\t\tfloat flipNormal = 1.0;\\n\t\t#endif\\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\t\t#ifdef ENVMAP_TYPE_CUBE\\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\t\t\t#ifdef TEXTURE_LOD_EXT\\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\t\t\t#else\\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\t\t\t#endif\\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\\n\t\t#else\\n\t\t\tvec4 envMapColor = vec4( 0.0 );\\n\t\t#endif\\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\\n\t}\\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\t}\\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\\n\t\t#else\\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\\n\t\t#endif\\n\t\t#ifdef DOUBLE_SIDED\\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\t\t#else\\n\t\t\tfloat flipNormal = 1.0;\\n\t\t#endif\\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\\n\t\t#ifdef ENVMAP_TYPE_CUBE\\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\t\t\t#ifdef TEXTURE_LOD_EXT\\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\t\t\t#else\\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\t\t\t#endif\\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\t\tvec2 sampleUV;\\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\t\t#ifdef TEXTURE_LOD_EXT\\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\\n\t\t\t#else\\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\\n\t\t\t#endif\\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\t\t#ifdef TEXTURE_LOD_EXT\\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\t\t\t#else\\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\t\t\t#endif\\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\t\t#endif\\n\t\treturn envMapColor.rgb * envMapIntensity;\\n\t}\\n#endif\\n\",n.ShaderChunk.lights_phong_fragment=\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\\n\",n.ShaderChunk.lights_phong_pars_fragment=\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\tvec3\tdiffuseColor;\\n\tvec3\tspecularColor;\\n\tfloat\tspecularShininess;\\n\tfloat\tspecularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\tvec3 irradiance = dotNL * directLight.color;\\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\t\tirradiance *= PI;\\n\t#endif\\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\t(0)\\n\",n.ShaderChunk.lights_physical_fragment=\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\\n#ifdef STANDARD\\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\\n#else\\n\tmaterial.specularColor = mix( vec3( 0.16 * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\\n#endif\\n\",n.ShaderChunk.lights_physical_pars_fragment=\"struct PhysicalMaterial {\\n\tvec3\tdiffuseColor;\\n\tfloat\tspecularRoughness;\\n\tvec3\tspecularColor;\\n\t#ifndef STANDARD\\n\t#endif\\n};\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\tvec3 irradiance = dotNL * directLight.color;\\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\t\tirradiance *= PI;\\n\t#endif\\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\\n}\\n#define RE_Direct\t\t\t\tRE_Direct_Physical\\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\\n\",n.ShaderChunk.lights_template=\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = normalize( vViewPosition );\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\tPointLight pointLight;\\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\t\tpointLight = pointLights[ i ];\\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\t\t#ifdef USE_SHADOWMAP\\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\t\t#endif\\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\t}\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\tSpotLight spotLight;\\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\t\tspotLight = spotLights[ i ];\\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\t\t#ifdef USE_SHADOWMAP\\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\t\t#endif\\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\t}\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\tDirectionalLight directionalLight;\\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\t\tdirectionalLight = directionalLights[ i ];\\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\t\t#ifdef USE_SHADOWMAP\\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\t\t#endif\\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\t}\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\t#ifdef USE_LIGHTMAP\\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\t\t\tlightMapIrradiance *= PI;\\n\t\t#endif\\n\t\tirradiance += lightMapIrradiance;\\n\t#endif\\n\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\t\t}\\n\t#endif\\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\\n\t#endif\\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\\n\tRE_IndirectSpecular( radiance, geometry, material, reflectedLight );\\n#endif\\n\",n.ShaderChunk.logdepthbuf_fragment=\"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n#endif\",n.ShaderChunk.logdepthbuf_pars_fragment=\"#ifdef USE_LOGDEPTHBUF\\n\tuniform float logDepthBufFC;\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\t\tvarying float vFragDepth;\\n\t#endif\\n#endif\\n\",n.ShaderChunk.logdepthbuf_pars_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\t\tvarying float vFragDepth;\\n\t#endif\\n\tuniform float logDepthBufFC;\\n#endif\",n.ShaderChunk.logdepthbuf_vertex=\"#ifdef USE_LOGDEPTHBUF\\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\t\tvFragDepth = 1.0 + gl_Position.w;\\n\t#else\\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\t#endif\\n#endif\\n\",n.ShaderChunk.map_fragment=\"#ifdef USE_MAP\\n\tvec4 texelColor = texture2D( map, vUv );\\n\ttexelColor = mapTexelToLinear( texelColor );\\n\tdiffuseColor *= texelColor;\\n#endif\\n\",n.ShaderChunk.map_pars_fragment=\"#ifdef USE_MAP\\n\tuniform sampler2D map;\\n#endif\\n\",n.ShaderChunk.map_particle_fragment=\"#ifdef USE_MAP\\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\\n\",n.ShaderChunk.map_particle_pars_fragment=\"#ifdef USE_MAP\\n\tuniform vec4 offsetRepeat;\\n\tuniform sampler2D map;\\n#endif\\n\",n.ShaderChunk.metalnessmap_fragment=\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\tmetalnessFactor *= texelMetalness.r;\\n#endif\\n\",n.ShaderChunk.metalnessmap_pars_fragment=\"#ifdef USE_METALNESSMAP\\n\tuniform sampler2D metalnessMap;\\n#endif\",n.ShaderChunk.morphnormal_vertex=\"#ifdef USE_MORPHNORMALS\\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n#endif\\n\",n.ShaderChunk.morphtarget_pars_vertex=\"#ifdef USE_MORPHTARGETS\\n\t#ifndef USE_MORPHNORMALS\\n\tuniform float morphTargetInfluences[ 8 ];\\n\t#else\\n\tuniform float morphTargetInfluences[ 4 ];\\n\t#endif\\n#endif\",n.ShaderChunk.morphtarget_vertex=\"#ifdef USE_MORPHTARGETS\\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\t#ifndef USE_MORPHNORMALS\\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\t#endif\\n#endif\\n\",n.ShaderChunk.normal_fragment=\"#ifdef FLAT_SHADED\\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\tvec3 normal = normalize( vNormal );\\n\t#ifdef DOUBLE_SIDED\\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\t#endif\\n#endif\\n#ifdef USE_NORMALMAP\\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n#elif defined( USE_BUMPMAP )\\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n#endif\\n\",n.ShaderChunk.normalmap_pars_fragment=\"#ifdef USE_NORMALMAP\\n\tuniform sampler2D normalMap;\\n\tuniform vec2 normalScale;\\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\\n\t\tvec2 st0 = dFdx( vUv.st );\\n\t\tvec2 st1 = dFdy( vUv.st );\\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\t\tvec3 N = normalize( surf_norm );\\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\t\tmapN.xy = normalScale * mapN.xy;\\n\t\tmat3 tsn = mat3( S, T, N );\\n\t\treturn normalize( tsn * mapN );\\n\t}\\n#endif\\n\",n.ShaderChunk.packing=\"vec3 packNormalToRGB( const in vec3 normal ) {\\n  return normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n  return 1.0 - 2.0 * rgb.xyz;\\n}\\nvec4 packDepthToRGBA( const in float value ) {\\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\\n\tvec4 res = mod( value * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\\n\tres -= res.xxyz * bit_mask;\\n\treturn res;\\n}\\nfloat unpackRGBAToDepth( const in vec4 rgba ) {\\n\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\\n\treturn dot( rgba, bitSh );\\n}\\nfloat viewZToOrthoDepth( const in float viewZ, const in float near, const in float far ) {\\n  return ( viewZ + near ) / ( near - far );\\n}\\nfloat OrthoDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n  return linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\\n\",n.ShaderChunk.premultiplied_alpha_fragment=\"#ifdef PREMULTIPLIED_ALPHA\\n\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\\n\",n.ShaderChunk.project_vertex=\"#ifdef USE_SKINNING\\n\tvec4 mvPosition = modelViewMatrix * skinned;\\n#else\\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\n#endif\\ngl_Position = projectionMatrix * mvPosition;\\n\",n.ShaderChunk.roughnessmap_fragment=\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\troughnessFactor *= texelRoughness.r;\\n#endif\\n\",n.ShaderChunk.roughnessmap_pars_fragment=\"#ifdef USE_ROUGHNESSMAP\\n\tuniform sampler2D roughnessMap;\\n#endif\",n.ShaderChunk.shadowmap_pars_fragment=\"#ifdef USE_SHADOWMAP\\n\t#if NUM_DIR_LIGHTS > 0\\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\t#endif\\n\t#if NUM_SPOT_LIGHTS > 0\\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\t#endif\\n\t#if NUM_POINT_LIGHTS > 0\\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\t#endif\\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\t}\\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\\n\t\tvec2 f = fract( uv * size + 0.5 );\\n\t\tfloat a = mix( lb, lt, f.y );\\n\t\tfloat b = mix( rb, rt, f.y );\\n\t\tfloat c = mix( a, b, f.x );\\n\t\treturn c;\\n\t}\\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\t\tshadowCoord.xyz /= shadowCoord.w;\\n\t\tshadowCoord.z += shadowBias;\\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\t\tbool inFrustum = all( inFrustumVec );\\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\t\tbool frustumTest = all( frustumTestVec );\\n\t\tif ( frustumTest ) {\\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\\n\t\t\treturn (\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\t\t\t) * ( 1.0 / 9.0 );\\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\\n\t\t\treturn (\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\t\t\t) * ( 1.0 / 9.0 );\\n\t\t#else\\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\t\t#endif\\n\t\t}\\n\t\treturn 1.0;\\n\t}\\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\t\tvec3 absV = abs( v );\\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\t\tabsV *= scaleToCube;\\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\t\tvec2 planar = v.xy;\\n\t\tfloat almostATexel = 1.5 * texelSizeY;\\n\t\tfloat almostOne = 1.0 - almostATexel;\\n\t\tif ( absV.z >= almostOne ) {\\n\t\t\tif ( v.z > 0.0 )\\n\t\t\t\tplanar.x = 4.0 - v.x;\\n\t\t} else if ( absV.x >= almostOne ) {\\n\t\t\tfloat signX = sign( v.x );\\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\\n\t\t} else if ( absV.y >= almostOne ) {\\n\t\t\tfloat signY = sign( v.y );\\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\t\t\tplanar.y = v.z * signY - 2.0;\\n\t\t}\\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\t}\\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\t\tvec3 lightToPosition = shadowCoord.xyz;\\n\t\tvec3 bd3D = normalize( lightToPosition );\\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\t\t\treturn (\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\t\t\t) * ( 1.0 / 9.0 );\\n\t\t#else\\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\t\t#endif\\n\t}\\n#endif\\n\",n.ShaderChunk.shadowmap_pars_vertex=\"#ifdef USE_SHADOWMAP\\n\t#if NUM_DIR_LIGHTS > 0\\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\t#endif\\n\t#if NUM_SPOT_LIGHTS > 0\\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\t#endif\\n\t#if NUM_POINT_LIGHTS > 0\\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\t#endif\\n#endif\\n\",n.ShaderChunk.shadowmap_vertex=\"#ifdef USE_SHADOWMAP\\n\t#if NUM_DIR_LIGHTS > 0\\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\\n\t}\\n\t#endif\\n\t#if NUM_SPOT_LIGHTS > 0\\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\\n\t}\\n\t#endif\\n\t#if NUM_POINT_LIGHTS > 0\\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\\n\t}\\n\t#endif\\n#endif\\n\",n.ShaderChunk.shadowmask_pars_fragment=\"float getShadowMask() {\\n\tfloat shadow = 1.0;\\n\t#ifdef USE_SHADOWMAP\\n\t#if NUM_DIR_LIGHTS > 0\\n\tDirectionalLight directionalLight;\\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\t\tdirectionalLight = directionalLights[ i ];\\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\t}\\n\t#endif\\n\t#if NUM_SPOT_LIGHTS > 0\\n\tSpotLight spotLight;\\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\t\tspotLight = spotLights[ i ];\\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\t}\\n\t#endif\\n\t#if NUM_POINT_LIGHTS > 0\\n\tPointLight pointLight;\\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\t\tpointLight = pointLights[ i ];\\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\\n\t}\\n\t#endif\\n\t#endif\\n\treturn shadow;\\n}\\n\",n.ShaderChunk.skinbase_vertex=\"#ifdef USE_SKINNING\\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\",n.ShaderChunk.skinning_pars_vertex=\"#ifdef USE_SKINNING\\n\tuniform mat4 bindMatrix;\\n\tuniform mat4 bindMatrixInverse;\\n\t#ifdef BONE_TEXTURE\\n\t\tuniform sampler2D boneTexture;\\n\t\tuniform int boneTextureWidth;\\n\t\tuniform int boneTextureHeight;\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\t\t\tfloat j = i * 4.0;\\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\\n\t\t\ty = dy * ( y + 0.5 );\\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\t\t\treturn bone;\\n\t\t}\\n\t#else\\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\\n\t\t\treturn bone;\\n\t\t}\\n\t#endif\\n#endif\\n\",n.ShaderChunk.skinning_vertex=\"#ifdef USE_SKINNING\\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\tvec4 skinned = vec4( 0.0 );\\n\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\tskinned  = bindMatrixInverse * skinned;\\n#endif\\n\",n.ShaderChunk.skinnormal_vertex=\"#ifdef USE_SKINNING\\n\tmat4 skinMatrix = mat4( 0.0 );\\n\tskinMatrix += skinWeight.x * boneMatX;\\n\tskinMatrix += skinWeight.y * boneMatY;\\n\tskinMatrix += skinWeight.z * boneMatZ;\\n\tskinMatrix += skinWeight.w * boneMatW;\\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n#endif\\n\",n.ShaderChunk.specularmap_fragment=\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\tspecularStrength = texelSpecular.r;\\n#else\\n\tspecularStrength = 1.0;\\n#endif\",n.ShaderChunk.specularmap_pars_fragment=\"#ifdef USE_SPECULARMAP\\n\tuniform sampler2D specularMap;\\n#endif\",n.ShaderChunk.tonemapping_fragment=\"#if defined( TONE_MAPPING )\\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\\n\",n.ShaderChunk.tonemapping_pars_fragment=\"#define saturate(a) clamp( a, 0.0, 1.0 )\\nuniform float toneMappingExposure;\\nuniform float toneMappingWhitePoint;\\nvec3 LinearToneMapping( vec3 color ) {\\n  return toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\\nvec3 Uncharted2ToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n  color *= toneMappingExposure;\\n  color = max( vec3( 0.0 ), color - 0.004 );\\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\n\",n.ShaderChunk.uv2_pars_fragment=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\tvarying vec2 vUv2;\\n#endif\",n.ShaderChunk.uv2_pars_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\tattribute vec2 uv2;\\n\tvarying vec2 vUv2;\\n#endif\",n.ShaderChunk.uv2_vertex=\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\tvUv2 = uv2;\\n#endif\",n.ShaderChunk.uv_pars_fragment=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\tvarying vec2 vUv;\\n#endif\",n.ShaderChunk.uv_pars_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\tvarying vec2 vUv;\\n\tuniform vec4 offsetRepeat;\\n#endif\\n\",n.ShaderChunk.uv_vertex=\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n#endif\",n.ShaderChunk.worldpos_vertex=\"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\t#ifdef USE_SKINNING\\n\t\tvec4 worldPosition = modelMatrix * skinned;\\n\t#else\\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\t#endif\\n#endif\\n\",n.UniformsUtils={merge:function(e){for(var t={},i=0;i<e.length;i++){var r=this.clone(e[i]);\nfor(var n in r)t[n]=r[n]}return t},clone:function(e){var t={};for(var i in e){t[i]={};for(var r in e[i]){var a=e[i][r];t[i][r]=a instanceof n.Color||a instanceof n.Vector2||a instanceof n.Vector3||a instanceof n.Vector4||a instanceof n.Matrix3||a instanceof n.Matrix4||a instanceof n.Texture?a.clone():Array.isArray(a)?a.slice():a}}return t}},n.UniformsLib={common:{diffuse:{type:\"c\",value:new n.Color(15658734)},opacity:{type:\"1f\",value:1},map:{type:\"t\",value:null},offsetRepeat:{type:\"v4\",value:new n.Vector4(0,0,1,1)},specularMap:{type:\"t\",value:null},alphaMap:{type:\"t\",value:null},envMap:{type:\"t\",value:null},flipEnvMap:{type:\"1f\",value:-1},reflectivity:{type:\"1f\",value:1},refractionRatio:{type:\"1f\",value:.98}},aomap:{aoMap:{type:\"t\",value:null},aoMapIntensity:{type:\"1f\",value:1}},lightmap:{lightMap:{type:\"t\",value:null},lightMapIntensity:{type:\"1f\",value:1}},emissivemap:{emissiveMap:{type:\"t\",value:null}},bumpmap:{bumpMap:{type:\"t\",value:null},bumpScale:{type:\"1f\",value:1}},normalmap:{normalMap:{type:\"t\",value:null},normalScale:{type:\"v2\",value:new n.Vector2(1,1)}},displacementmap:{displacementMap:{type:\"t\",value:null},displacementScale:{type:\"1f\",value:1},displacementBias:{type:\"1f\",value:0}},roughnessmap:{roughnessMap:{type:\"t\",value:null}},metalnessmap:{metalnessMap:{type:\"t\",value:null}},fog:{fogDensity:{type:\"1f\",value:25e-5},fogNear:{type:\"1f\",value:1},fogFar:{type:\"1f\",value:2e3},fogColor:{type:\"c\",value:new n.Color(16777215)}},lights:{ambientLightColor:{type:\"3fv\",value:[]},directionalLights:{type:\"sa\",value:[],properties:{direction:{type:\"v3\"},color:{type:\"c\"},shadow:{type:\"1i\"},shadowBias:{type:\"1f\"},shadowRadius:{type:\"1f\"},shadowMapSize:{type:\"v2\"}}},directionalShadowMap:{type:\"tv\",value:[]},directionalShadowMatrix:{type:\"m4v\",value:[]},spotLights:{type:\"sa\",value:[],properties:{color:{type:\"c\"},position:{type:\"v3\"},direction:{type:\"v3\"},distance:{type:\"1f\"},coneCos:{type:\"1f\"},penumbraCos:{type:\"1f\"},decay:{type:\"1f\"},shadow:{type:\"1i\"},shadowBias:{type:\"1f\"},shadowRadius:{type:\"1f\"},shadowMapSize:{type:\"v2\"}}},spotShadowMap:{type:\"tv\",value:[]},spotShadowMatrix:{type:\"m4v\",value:[]},pointLights:{type:\"sa\",value:[],properties:{color:{type:\"c\"},position:{type:\"v3\"},decay:{type:\"1f\"},distance:{type:\"1f\"},shadow:{type:\"1i\"},shadowBias:{type:\"1f\"},shadowRadius:{type:\"1f\"},shadowMapSize:{type:\"v2\"}}},pointShadowMap:{type:\"tv\",value:[]},pointShadowMatrix:{type:\"m4v\",value:[]},hemisphereLights:{type:\"sa\",value:[],properties:{direction:{type:\"v3\"},skyColor:{type:\"c\"},groundColor:{type:\"c\"}}}},points:{diffuse:{type:\"c\",value:new n.Color(15658734)},opacity:{type:\"1f\",value:1},size:{type:\"1f\",value:1},scale:{type:\"1f\",value:1},map:{type:\"t\",value:null},offsetRepeat:{type:\"v4\",value:new n.Vector4(0,0,1,1)}}},n.ShaderChunk.cube_frag=\"uniform samplerCube tCube;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\\n\t#include <logdepthbuf_fragment>\\n}\\n\",n.ShaderChunk.cube_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\tvWorldPosition = transformDirection( position, modelMatrix );\\n\t#include <begin_vertex>\\n\t#include <project_vertex>\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n}\\n\",n.ShaderChunk.depth_frag=\"#if DEPTH_PACKING == 3200\\n\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tvec4 diffuseColor = vec4( 1.0 );\\n\t#if DEPTH_PACKING == 3200\\n\t\tdiffuseColor.a = opacity;\\n\t#endif\\n\t#include <map_fragment>\\n\t#include <alphamap_fragment>\\n\t#include <alphatest_fragment>\\n\t#include <logdepthbuf_fragment>\\n\t#if DEPTH_PACKING == 3200\\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\\n\t#elif DEPTH_PACKING == 3201\\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\\n\t#endif\\n}\\n\",n.ShaderChunk.depth_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\t#include <uv_vertex>\\n\t#include <skinbase_vertex>\\n\t#include <begin_vertex>\\n\t#include <displacementmap_vertex>\\n\t#include <morphtarget_vertex>\\n\t#include <skinning_vertex>\\n\t#include <project_vertex>\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n}\\n\",n.ShaderChunk.distanceRGBA_frag=\"uniform vec3 lightPos;\\nvarying vec4 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\t#include <clipping_planes_fragment>\\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\\n}\\n\",n.ShaderChunk.distanceRGBA_vert=\"varying vec4 vWorldPosition;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\t#include <skinbase_vertex>\\n\t#include <begin_vertex>\\n\t#include <morphtarget_vertex>\\n\t#include <skinning_vertex>\\n\t#include <project_vertex>\\n\t#include <worldpos_vertex>\\n\t#include <clipping_planes_vertex>\\n\tvWorldPosition = worldPosition;\\n}\\n\",n.ShaderChunk.equirect_frag=\"uniform sampler2D tEquirect;\\nuniform float tFlip;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tvec3 direction = normalize( vWorldPosition );\\n\tvec2 sampleUV;\\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\t#include <logdepthbuf_fragment>\\n}\\n\",n.ShaderChunk.equirect_vert=\"varying vec3 vWorldPosition;\\n#include <common>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\tvWorldPosition = transformDirection( position, modelMatrix );\\n\t#include <begin_vertex>\\n\t#include <project_vertex>\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n}\\n\",n.ShaderChunk.linedashed_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\t\tdiscard;\\n\t}\\n\tvec3 outgoingLight = vec3( 0.0 );\\n\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\t#include <logdepthbuf_fragment>\\n\t#include <color_fragment>\\n\toutgoingLight = diffuseColor.rgb;\\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\t#include <premultiplied_alpha_fragment>\\n\t#include <tonemapping_fragment>\\n\t#include <encodings_fragment>\\n\t#include <fog_fragment>\\n}\\n\",n.ShaderChunk.linedashed_vert=\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\t#include <color_vertex>\\n\tvLineDistance = scale * lineDistance;\\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\tgl_Position = projectionMatrix * mvPosition;\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n}\\n\",n.ShaderChunk.meshbasic_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\t#include <logdepthbuf_fragment>\\n\t#include <map_fragment>\\n\t#include <color_fragment>\\n\t#include <alphamap_fragment>\\n\t#include <alphatest_fragment>\\n\t#include <specularmap_fragment>\\n\tReflectedLight reflectedLight;\\n\treflectedLight.directDiffuse = vec3( 0.0 );\\n\treflectedLight.directSpecular = vec3( 0.0 );\\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\\n\treflectedLight.indirectSpecular = vec3( 0.0 );\\n\t#include <aomap_fragment>\\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\t#include <envmap_fragment>\\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\t#include <premultiplied_alpha_fragment>\\n\t#include <tonemapping_fragment>\\n\t#include <encodings_fragment>\\n\t#include <fog_fragment>\\n}\\n\",n.ShaderChunk.meshbasic_vert=\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\t#include <uv_vertex>\\n\t#include <uv2_vertex>\\n\t#include <color_vertex>\\n\t#include <skinbase_vertex>\\n\t#ifdef USE_ENVMAP\\n\t#include <beginnormal_vertex>\\n\t#include <morphnormal_vertex>\\n\t#include <skinnormal_vertex>\\n\t#include <defaultnormal_vertex>\\n\t#endif\\n\t#include <begin_vertex>\\n\t#include <morphtarget_vertex>\\n\t#include <skinning_vertex>\\n\t#include <project_vertex>\\n\t#include <logdepthbuf_vertex>\\n\t#include <worldpos_vertex>\\n\t#include <clipping_planes_vertex>\\n\t#include <envmap_vertex>\\n}\\n\",n.ShaderChunk.meshlambert_frag=\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\tvec3 totalEmissiveRadiance = emissive;\\n\t#include <logdepthbuf_fragment>\\n\t#include <map_fragment>\\n\t#include <color_fragment>\\n\t#include <alphamap_fragment>\\n\t#include <alphatest_fragment>\\n\t#include <specularmap_fragment>\\n\t#include <emissivemap_fragment>\\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\\n\t#include <lightmap_fragment>\\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\t#ifdef DOUBLE_SIDED\\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\t#else\\n\t\treflectedLight.directDiffuse = vLightFront;\\n\t#endif\\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\t#include <aomap_fragment>\\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\t#include <envmap_fragment>\\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\t#include <premultiplied_alpha_fragment>\\n\t#include <tonemapping_fragment>\\n\t#include <encodings_fragment>\\n\t#include <fog_fragment>\\n}\\n\",n.ShaderChunk.meshlambert_vert=\"#define LAMBERT\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\t#include <uv_vertex>\\n\t#include <uv2_vertex>\\n\t#include <color_vertex>\\n\t#include <beginnormal_vertex>\\n\t#include <morphnormal_vertex>\\n\t#include <skinbase_vertex>\\n\t#include <skinnormal_vertex>\\n\t#include <defaultnormal_vertex>\\n\t#include <begin_vertex>\\n\t#include <morphtarget_vertex>\\n\t#include <skinning_vertex>\\n\t#include <project_vertex>\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n\t#include <worldpos_vertex>\\n\t#include <envmap_vertex>\\n\t#include <lights_lambert_vertex>\\n\t#include <shadowmap_vertex>\\n}\\n\",n.ShaderChunk.meshphong_frag=\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\tvec3 totalEmissiveRadiance = emissive;\\n\t#include <logdepthbuf_fragment>\\n\t#include <map_fragment>\\n\t#include <color_fragment>\\n\t#include <alphamap_fragment>\\n\t#include <alphatest_fragment>\\n\t#include <specularmap_fragment>\\n\t#include <normal_fragment>\\n\t#include <emissivemap_fragment>\\n\t#include <lights_phong_fragment>\\n\t#include <lights_template>\\n\t#include <aomap_fragment>\\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\t#include <envmap_fragment>\\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\t#include <premultiplied_alpha_fragment>\\n\t#include <tonemapping_fragment>\\n\t#include <encodings_fragment>\\n\t#include <fog_fragment>\\n}\\n\",n.ShaderChunk.meshphong_vert=\"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\t#include <uv_vertex>\\n\t#include <uv2_vertex>\\n\t#include <color_vertex>\\n\t#include <beginnormal_vertex>\\n\t#include <morphnormal_vertex>\\n\t#include <skinbase_vertex>\\n\t#include <skinnormal_vertex>\\n\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\tvNormal = normalize( transformedNormal );\\n#endif\\n\t#include <begin_vertex>\\n\t#include <displacementmap_vertex>\\n\t#include <morphtarget_vertex>\\n\t#include <skinning_vertex>\\n\t#include <project_vertex>\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n\tvViewPosition = - mvPosition.xyz;\\n\t#include <worldpos_vertex>\\n\t#include <envmap_vertex>\\n\t#include <shadowmap_vertex>\\n}\\n\",n.ShaderChunk.meshphysical_frag=\"#define PHYSICAL\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\nuniform float envMapIntensity;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\tvec3 totalEmissiveRadiance = emissive;\\n\t#include <logdepthbuf_fragment>\\n\t#include <map_fragment>\\n\t#include <color_fragment>\\n\t#include <alphamap_fragment>\\n\t#include <alphatest_fragment>\\n\t#include <specularmap_fragment>\\n\t#include <roughnessmap_fragment>\\n\t#include <metalnessmap_fragment>\\n\t#include <normal_fragment>\\n\t#include <emissivemap_fragment>\\n\t#include <lights_physical_fragment>\\n\t#include <lights_template>\\n\t#include <aomap_fragment>\\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\t#include <premultiplied_alpha_fragment>\\n\t#include <tonemapping_fragment>\\n\t#include <encodings_fragment>\\n\t#include <fog_fragment>\\n}\\n\",n.ShaderChunk.meshphysical_vert=\"#define PHYSICAL\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\t#include <uv_vertex>\\n\t#include <uv2_vertex>\\n\t#include <color_vertex>\\n\t#include <beginnormal_vertex>\\n\t#include <morphnormal_vertex>\\n\t#include <skinbase_vertex>\\n\t#include <skinnormal_vertex>\\n\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\tvNormal = normalize( transformedNormal );\\n#endif\\n\t#include <begin_vertex>\\n\t#include <displacementmap_vertex>\\n\t#include <morphtarget_vertex>\\n\t#include <skinning_vertex>\\n\t#include <project_vertex>\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n\tvViewPosition = - mvPosition.xyz;\\n\t#include <worldpos_vertex>\\n\t#include <shadowmap_vertex>\\n}\\n\",n.ShaderChunk.normal_frag=\"uniform float opacity;\\nvarying vec3 vNormal;\\n#include <common>\\n#include <packing>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\\n\t#include <logdepthbuf_fragment>\\n}\\n\",n.ShaderChunk.normal_vert=\"varying vec3 vNormal;\\n#include <common>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\tvNormal = normalize( normalMatrix * normal );\\n\t#include <begin_vertex>\\n\t#include <morphtarget_vertex>\\n\t#include <project_vertex>\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n}\\n\",n.ShaderChunk.points_frag=\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\t#include <clipping_planes_fragment>\\n\tvec3 outgoingLight = vec3( 0.0 );\\n\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\t#include <logdepthbuf_fragment>\\n\t#include <map_particle_fragment>\\n\t#include <color_fragment>\\n\t#include <alphatest_fragment>\\n\toutgoingLight = diffuseColor.rgb;\\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\t#include <premultiplied_alpha_fragment>\\n\t#include <tonemapping_fragment>\\n\t#include <encodings_fragment>\\n\t#include <fog_fragment>\\n}\\n\",n.ShaderChunk.points_vert=\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\t#include <color_vertex>\\n\t#include <begin_vertex>\\n\t#include <project_vertex>\\n\t#ifdef USE_SIZEATTENUATION\\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\\n\t#else\\n\t\tgl_PointSize = size;\\n\t#endif\\n\t#include <logdepthbuf_vertex>\\n\t#include <clipping_planes_vertex>\\n\t#include <worldpos_vertex>\\n\t#include <shadowmap_vertex>\\n}\\n\",n.ShaderLib={basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.fog]),vertexShader:n.ShaderChunk.meshbasic_vert,fragmentShader:n.ShaderChunk.meshbasic_frag},lambert:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.lightmap,n.UniformsLib.emissivemap,n.UniformsLib.fog,n.UniformsLib.lights,{emissive:{type:\"c\",value:new n.Color(0)}}]),vertexShader:n.ShaderChunk.meshlambert_vert,fragmentShader:n.ShaderChunk.meshlambert_frag},phong:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.lightmap,n.UniformsLib.emissivemap,n.UniformsLib.bumpmap,n.UniformsLib.normalmap,n.UniformsLib.displacementmap,n.UniformsLib.fog,n.UniformsLib.lights,{emissive:{type:\"c\",value:new n.Color(0)},specular:{type:\"c\",value:new n.Color(1118481)},shininess:{type:\"1f\",value:30}}]),vertexShader:n.ShaderChunk.meshphong_vert,fragmentShader:n.ShaderChunk.meshphong_frag},standard:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.lightmap,n.UniformsLib.emissivemap,n.UniformsLib.bumpmap,n.UniformsLib.normalmap,n.UniformsLib.displacementmap,n.UniformsLib.roughnessmap,n.UniformsLib.metalnessmap,n.UniformsLib.fog,n.UniformsLib.lights,{emissive:{type:\"c\",value:new n.Color(0)},roughness:{type:\"1f\",value:.5},metalness:{type:\"1f\",value:0},envMapIntensity:{type:\"1f\",value:1}}]),vertexShader:n.ShaderChunk.meshphysical_vert,fragmentShader:n.ShaderChunk.meshphysical_frag},points:{uniforms:n.UniformsUtils.merge([n.UniformsLib.points,n.UniformsLib.fog]),vertexShader:n.ShaderChunk.points_vert,fragmentShader:n.ShaderChunk.points_frag},dashed:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,{scale:{type:\"1f\",value:1},dashSize:{type:\"1f\",value:1},totalSize:{type:\"1f\",value:2}}]),vertexShader:n.ShaderChunk.linedashed_vert,fragmentShader:n.ShaderChunk.linedashed_frag},depth:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.displacementmap]),vertexShader:n.ShaderChunk.depth_vert,fragmentShader:n.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{type:\"1f\",value:1}},vertexShader:n.ShaderChunk.normal_vert,fragmentShader:n.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{type:\"t\",value:null},tFlip:{type:\"1f\",value:-1}},vertexShader:n.ShaderChunk.cube_vert,fragmentShader:n.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{type:\"t\",value:null},tFlip:{type:\"1f\",value:-1}},vertexShader:n.ShaderChunk.equirect_vert,fragmentShader:n.ShaderChunk.equirect_frag},distanceRGBA:{uniforms:{lightPos:{type:\"v3\",value:new n.Vector3}},vertexShader:n.ShaderChunk.distanceRGBA_vert,fragmentShader:n.ShaderChunk.distanceRGBA_frag}},n.ShaderLib.physical={uniforms:n.UniformsUtils.merge([n.ShaderLib.standard.uniforms,{}]),vertexShader:n.ShaderChunk.meshphysical_vert,fragmentShader:n.ShaderChunk.meshphysical_frag},n.WebGLRenderer=function(e){function t(){return null===bt?Rt:1}function i(e,t,i,r){dt===!0&&(e*=r,t*=r,i*=r),ui.clearColor(e,t,i,r)}function r(){ui.init(),ui.scissor(St.copy(Bt).multiplyScalar(Rt)),ui.viewport(It.copy(Pt).multiplyScalar(Rt)),i(_t.r,_t.g,_t.b,Ot)}function a(){Et=null,Dt=null,Nt=\"\",Lt=-1,ui.reset()}function o(e){e.preventDefault(),a(),r(),li.clear()}function s(e){var t=e.target;t.removeEventListener(\"dispose\",s),l(t),ti.textures--}function c(e){var t=e.target;t.removeEventListener(\"dispose\",c),h(t),ti.textures--}function u(e){var t=e.target;t.removeEventListener(\"dispose\",u),d(t)}function l(e){var t=li.get(e);if(e.image&&t.__image__webglTextureCube)ri.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)return;ri.deleteTexture(t.__webglTexture)}li.delete(e)}function h(e){var t=li.get(e),i=li.get(e.texture);if(e){if(void 0!==i.__webglTexture&&ri.deleteTexture(i.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e instanceof n.WebGLRenderTargetCube)for(var r=0;6>r;r++)ri.deleteFramebuffer(t.__webglFramebuffer[r]),t.__webglDepthbuffer&&ri.deleteRenderbuffer(t.__webglDepthbuffer[r]);else ri.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&ri.deleteRenderbuffer(t.__webglDepthbuffer);li.delete(e.texture),li.delete(e)}}function d(e){p(e),li.delete(e)}function p(e){var t=li.get(e).program;e.program=void 0,void 0!==t&&di.releaseProgram(t)}function f(e,t,i,r){var a;if(i instanceof n.InstancedBufferGeometry&&(a=si.get(\"ANGLE_instanced_arrays\"),null===a))return console.error(\"THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\"),void 0;void 0===r&&(r=0),ui.initAttributes();var o=i.attributes,s=t.getAttributes(),c=e.defaultAttributeValues;for(var u in s){var l=s[u];if(l>=0){var h=o[u];if(void 0!==h){var d=ri.FLOAT,p=h.array,f=h.normalized;p instanceof Float32Array?d=ri.FLOAT:p instanceof Float64Array?console.warn(\"Unsupported data buffer format: Float64Array\"):p instanceof Uint16Array?d=ri.UNSIGNED_SHORT:p instanceof Int16Array?d=ri.SHORT:p instanceof Uint32Array?d=ri.UNSIGNED_INT:p instanceof Int32Array?d=ri.INT:p instanceof Int8Array?d=ri.BYTE:p instanceof Uint8Array&&(d=ri.UNSIGNED_BYTE);var m=h.itemSize,g=hi.getAttributeBuffer(h);if(h instanceof n.InterleavedBufferAttribute){var v=h.data,y=v.stride,M=h.offset;v instanceof n.InstancedInterleavedBuffer?(ui.enableAttributeAndDivisor(l,v.meshPerAttribute,a),void 0===i.maxInstancedCount&&(i.maxInstancedCount=v.meshPerAttribute*v.count)):ui.enableAttribute(l),ri.bindBuffer(ri.ARRAY_BUFFER,g),ri.vertexAttribPointer(l,m,d,f,y*v.array.BYTES_PER_ELEMENT,(r*y+M)*v.array.BYTES_PER_ELEMENT)}else h instanceof n.InstancedBufferAttribute?(ui.enableAttributeAndDivisor(l,h.meshPerAttribute,a),void 0===i.maxInstancedCount&&(i.maxInstancedCount=h.meshPerAttribute*h.count)):ui.enableAttribute(l),ri.bindBuffer(ri.ARRAY_BUFFER,g),ri.vertexAttribPointer(l,m,d,f,0,r*m*h.array.BYTES_PER_ELEMENT)}else if(void 0!==c){var A=c[u];if(void 0!==A)switch(A.length){case 2:ri.vertexAttrib2fv(l,A);break;case 3:ri.vertexAttrib3fv(l,A);break;case 4:ri.vertexAttrib4fv(l,A);break;default:ri.vertexAttrib1fv(l,A)}}}}ui.disableUnusedAttributes()}function m(e,t){return Math.abs(t[0])-Math.abs(e[0])}function g(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function v(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function y(e,t,i,r,n){var a,o;i.transparent?(a=vt,o=++yt):(a=mt,o=++gt);var s=a[o];void 0!==s?(s.id=e.id,s.object=e,s.geometry=t,s.material=i,s.z=$t.z,s.group=n):(s={id:e.id,object:e,geometry:t,material:i,z:$t.z,group:n},a.push(s))}function M(e){var t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere();var i=Zt.copy(t.boundingSphere).applyMatrix4(e.matrixWorld);if(!Ft.intersectsSphere(i))return!1;if(0===Yt)return!0;var r=wt.clippingPlanes,n=i.center,a=-i.radius,o=0;do if(r[o].distanceToPoint(n)<a)return!1;while(++o!==Yt);return!0}function A(e,t){if(e.visible!==!1){if(e.layers.test(t.layers))if(e instanceof n.Light)ft.push(e);else if(e instanceof n.Sprite)(e.frustumCulled===!1||M(e)===!0)&&At.push(e);else if(e instanceof n.LensFlare)xt.push(e);else if(e instanceof n.ImmediateRenderObject)wt.sortObjects===!0&&($t.setFromMatrixPosition(e.matrixWorld),$t.applyProjection(Jt)),y(e,null,e.material,$t.z,null);else if((e instanceof n.Mesh||e instanceof n.Line||e instanceof n.Points)&&(e instanceof n.SkinnedMesh&&e.skeleton.update(),e.frustumCulled===!1||M(e)===!0)){var i=e.material;if(i.visible===!0){wt.sortObjects===!0&&($t.setFromMatrixPosition(e.matrixWorld),$t.applyProjection(Jt));var r=hi.update(e);if(i instanceof n.MultiMaterial)for(var a=r.groups,o=i.materials,s=0,c=a.length;c>s;s++){var u=a[s],l=o[u.materialIndex];l.visible===!0&&y(e,r,l,$t.z,u)}else y(e,r,i,$t.z,null)}}for(var h=e.children,s=0,c=h.length;c>s;s++)A(h[s],t)}}function x(e,t,i,r){for(var a=0,o=e.length;o>a;a++){var s=e[a],c=s.object,u=s.geometry,l=void 0===r?s.material:r,h=s.group;if(c.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,c.matrixWorld),c.normalMatrix.getNormalMatrix(c.modelViewMatrix),c instanceof n.ImmediateRenderObject){E(l);var d=T(t,i,l,c);Nt=\"\",c.render(function(e){wt.renderBufferImmediate(e,d,l)})}else wt.renderBufferDirect(t,i,u,l,c,h)}}function w(e,t,i){var r=li.get(e),a=di.getParameters(e,ei,t,Yt,i),o=di.getProgramCode(e,a),s=r.program,c=!0;if(void 0===s)e.addEventListener(\"dispose\",u);else if(s.code!==o)p(e);else{if(void 0!==a.shaderID)return;c=!1}if(c){if(a.shaderID){var l=n.ShaderLib[a.shaderID];r.__webglShader={name:e.type,uniforms:n.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else r.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=r.__webglShader,s=di.acquireProgram(e,a,o),r.program=s,e.program=s}var h=s.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var d=0;d<wt.maxMorphTargets;d++)h[\"morphTarget\"+d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var d=0;d<wt.maxMorphNormals;d++)h[\"morphNormal\"+d]>=0&&e.numSupportedMorphNormals++}var f=r.__webglShader.uniforms;(e instanceof n.ShaderMaterial||e instanceof n.RawShaderMaterial)&&e.clipping!==!0||(r.numClippingPlanes=Yt,f.clippingPlanes=Ht),(e instanceof n.MeshPhongMaterial||e instanceof n.MeshLambertMaterial||e instanceof n.MeshStandardMaterial||e.lights)&&(r.lightsHash=ei.hash,f.ambientLightColor.value=ei.ambient,f.directionalLights.value=ei.directional,f.spotLights.value=ei.spot,f.pointLights.value=ei.point,f.hemisphereLights.value=ei.hemi,f.directionalShadowMap.value=ei.directionalShadowMap,f.directionalShadowMatrix.value=ei.directionalShadowMatrix,f.spotShadowMap.value=ei.spotShadowMap,f.spotShadowMatrix.value=ei.spotShadowMatrix,f.pointShadowMap.value=ei.pointShadowMap,f.pointShadowMatrix.value=ei.pointShadowMatrix);var m=r.program.getUniforms(),g=n.WebGLUniforms.seqWithValue(m.seq,f);r.uniformsList=g,r.dynamicUniforms=n.WebGLUniforms.splitDynamic(g,f)}function E(e){b(e),e.transparent===!0?ui.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):ui.setBlending(n.NoBlending),ui.setDepthFunc(e.depthFunc),ui.setDepthTest(e.depthTest),ui.setDepthWrite(e.depthWrite),ui.setColorWrite(e.colorWrite),ui.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function b(e){e.side!==n.DoubleSide?ui.enable(ri.CULL_FACE):ui.disable(ri.CULL_FACE),ui.setFlipSided(e.side===n.BackSide)\n}function T(e,t,i,r){jt=0;var a=li.get(i);if(Gt){if(Vt||e!==Dt){var o=e===Dt&&i.id===Lt;F(i.clippingPlanes,i.clipShadows,e,a,o)}void 0!==a.numClippingPlanes&&a.numClippingPlanes!==Yt&&(i.needsUpdate=!0)}void 0===a.program&&(i.needsUpdate=!0),void 0!==a.lightsHash&&a.lightsHash!==ei.hash&&(i.needsUpdate=!0),i.needsUpdate&&(w(i,t,r),i.needsUpdate=!1);var s=!1,c=!1,u=!1,l=a.program,h=l.getUniforms(),d=a.__webglShader.uniforms;if(l.id!==Et&&(ri.useProgram(l.program),Et=l.id,s=!0,c=!0,u=!0),i.id!==Lt&&(Lt=i.id,c=!0),s||e!==Dt){if(h.set(ri,e,\"projectionMatrix\"),ci.logarithmicDepthBuffer&&h.setValue(ri,\"logDepthBufFC\",2/(Math.log(e.far+1)/Math.LN2)),e!==Dt&&(Dt=e,c=!0,u=!0),i instanceof n.ShaderMaterial||i instanceof n.MeshPhongMaterial||i instanceof n.MeshStandardMaterial||i.envMap){var p=h.map.cameraPosition;void 0!==p&&p.setValue(ri,$t.setFromMatrixPosition(e.matrixWorld))}(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshBasicMaterial||i instanceof n.MeshStandardMaterial||i instanceof n.ShaderMaterial||i.skinning)&&h.setValue(ri,\"viewMatrix\",e.matrixWorldInverse),h.set(ri,wt,\"toneMappingExposure\"),h.set(ri,wt,\"toneMappingWhitePoint\")}if(i.skinning){h.setOptional(ri,r,\"bindMatrix\"),h.setOptional(ri,r,\"bindMatrixInverse\");var f=r.skeleton;f&&(ci.floatVertexTextures&&f.useVertexTexture?(h.set(ri,f,\"boneTexture\"),h.set(ri,f,\"boneTextureWidth\"),h.set(ri,f,\"boneTextureHeight\")):h.setOptional(ri,f,\"boneMatrices\"))}c&&((i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshStandardMaterial||i.lights)&&z(d,u),t&&i.fog&&C(d,t),(i instanceof n.MeshBasicMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshPhongMaterial||i instanceof n.MeshStandardMaterial||i instanceof n.MeshDepthMaterial)&&L(d,i),i instanceof n.LineBasicMaterial?N(d,i):i instanceof n.LineDashedMaterial?(N(d,i),D(d,i)):i instanceof n.PointsMaterial?S(d,i):i instanceof n.MeshLambertMaterial?I(d,i):i instanceof n.MeshPhongMaterial?j(d,i):i instanceof n.MeshPhysicalMaterial?O(d,i):i instanceof n.MeshStandardMaterial?_(d,i):i instanceof n.MeshDepthMaterial?i.displacementMap&&(d.displacementMap.value=i.displacementMap,d.displacementScale.value=i.displacementScale,d.displacementBias.value=i.displacementBias):i instanceof n.MeshNormalMaterial&&(d.opacity.value=i.opacity),n.WebGLUniforms.upload(ri,a.uniformsList,d,wt)),h.set(ri,r,\"modelViewMatrix\"),h.set(ri,r,\"normalMatrix\"),h.setValue(ri,\"modelMatrix\",r.matrixWorld);var m=a.dynamicUniforms;return null!==m&&(n.WebGLUniforms.evalDynamic(m,d,r,e),n.WebGLUniforms.upload(ri,m,d,wt)),l}function L(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i){i instanceof n.WebGLRenderTarget&&(i=i.texture);var r=i.offset,a=i.repeat;e.offsetRepeat.value.set(r.x,r.y,a.x,a.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof n.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function N(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function D(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function S(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*Rt,e.scale.value=.5*ot.clientHeight,e.map.value=t.map,null!==t.map){var i=t.map.offset,r=t.map.repeat;e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}}function C(e,t){e.fogColor.value=t.color,t instanceof n.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof n.FogExp2&&(e.fogDensity.value=t.density)}function I(e,t){t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function j(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function _(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}function O(e,t){_(e,t)}function z(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function k(e){for(var t=0,i=0,r=e.length;r>i;i++){var n=e[i];n.castShadow&&(ei.shadows[t++]=n)}ei.shadows.length=t}function R(e,t){var i,r,a,o,s,c,u=0,l=0,h=0,d=t.matrixWorldInverse,p=0,f=0,m=0,g=0;for(i=0,r=e.length;r>i;i++)if(a=e[i],o=a.color,s=a.intensity,c=a.distance,a instanceof n.AmbientLight)u+=o.r*s,l+=o.g*s,h+=o.b*s;else if(a instanceof n.DirectionalLight){var v=pi.get(a);v.color.copy(a.color).multiplyScalar(a.intensity),v.direction.setFromMatrixPosition(a.matrixWorld),$t.setFromMatrixPosition(a.target.matrixWorld),v.direction.sub($t),v.direction.transformDirection(d),v.shadow=a.castShadow,a.castShadow&&(v.shadowBias=a.shadow.bias,v.shadowRadius=a.shadow.radius,v.shadowMapSize=a.shadow.mapSize),ei.directionalShadowMap[p]=a.shadow.map,ei.directionalShadowMatrix[p]=a.shadow.matrix,ei.directional[p++]=v}else if(a instanceof n.SpotLight){var v=pi.get(a);v.position.setFromMatrixPosition(a.matrixWorld),v.position.applyMatrix4(d),v.color.copy(o).multiplyScalar(s),v.distance=c,v.direction.setFromMatrixPosition(a.matrixWorld),$t.setFromMatrixPosition(a.target.matrixWorld),v.direction.sub($t),v.direction.transformDirection(d),v.coneCos=Math.cos(a.angle),v.penumbraCos=Math.cos(a.angle*(1-a.penumbra)),v.decay=0===a.distance?0:a.decay,v.shadow=a.castShadow,a.castShadow&&(v.shadowBias=a.shadow.bias,v.shadowRadius=a.shadow.radius,v.shadowMapSize=a.shadow.mapSize),ei.spotShadowMap[m]=a.shadow.map,ei.spotShadowMatrix[m]=a.shadow.matrix,ei.spot[m++]=v}else if(a instanceof n.PointLight){var v=pi.get(a);v.position.setFromMatrixPosition(a.matrixWorld),v.position.applyMatrix4(d),v.color.copy(a.color).multiplyScalar(a.intensity),v.distance=a.distance,v.decay=0===a.distance?0:a.decay,v.shadow=a.castShadow,a.castShadow&&(v.shadowBias=a.shadow.bias,v.shadowRadius=a.shadow.radius,v.shadowMapSize=a.shadow.mapSize),ei.pointShadowMap[f]=a.shadow.map,void 0===ei.pointShadowMatrix[f]&&(ei.pointShadowMatrix[f]=new n.Matrix4),$t.setFromMatrixPosition(a.matrixWorld).negate(),ei.pointShadowMatrix[f].identity().setPosition($t),ei.point[f++]=v}else if(a instanceof n.HemisphereLight){var v=pi.get(a);v.direction.setFromMatrixPosition(a.matrixWorld),v.direction.transformDirection(d),v.direction.normalize(),v.skyColor.copy(a.color).multiplyScalar(s),v.groundColor.copy(a.groundColor).multiplyScalar(s),ei.hemi[g++]=v}ei.ambient[0]=u,ei.ambient[1]=l,ei.ambient[2]=h,ei.directional.length=p,ei.spot.length=m,ei.point.length=f,ei.hemi.length=g,ei.hash=p+\",\"+f+\",\"+m+\",\"+g+\",\"+ei.shadows.length}function B(e,t){Gt=0!==wt.clippingPlanes.length||wt.localClippingEnabled||0!==Xt||Vt,Vt=wt.localClippingEnabled,Wt=U(e,t,0),Xt=null!==e?e.length:0}function U(e,t,i,r){var n=null!==e?e.length:0,a=null;if(0!==n){if(a=Ht.value,r!==!0||null===a){var o=i+4*n,s=t.matrixWorldInverse,c=qt.getNormalMatrix(s);(null===a||a.length<o)&&(a=new Float32Array(o));for(var u=0,l=i;u!==n;++u,l+=4){var h=Kt.copy(e[u]).applyMatrix4(s,c);h.normal.toArray(a,l),a[l+3]=h.constant}}Ht.value=a,Ht.needsUpdate=!0}return Yt=n,a}function P(){Ht.value!==Wt&&(Ht.value=Wt,Ht.needsUpdate=Xt>0),Yt=Xt}function F(e,t,i,r,n){if(!Vt||null===e||0===e.length||Qt&&!t)Qt?U(null):P();else{var a=Qt?0:Xt,o=4*a,s=r.clippingState||null;Ht.value=s,s=U(e,i,o,n);for(var c=0;c!==o;++c)s[c]=Wt[c];r.clippingState=s,Yt+=a}}function G(){var e=jt;return e>=ci.maxTextures&&console.warn(\"WebGLRenderer: trying to use \"+e+\" texture units while this GPU supports only \"+ci.maxTextures),jt+=1,e}function V(e,t,i){var r;if(i?(ri.texParameteri(e,ri.TEXTURE_WRAP_S,at(t.wrapS)),ri.texParameteri(e,ri.TEXTURE_WRAP_T,at(t.wrapT)),ri.texParameteri(e,ri.TEXTURE_MAG_FILTER,at(t.magFilter)),ri.texParameteri(e,ri.TEXTURE_MIN_FILTER,at(t.minFilter))):(ri.texParameteri(e,ri.TEXTURE_WRAP_S,ri.CLAMP_TO_EDGE),ri.texParameteri(e,ri.TEXTURE_WRAP_T,ri.CLAMP_TO_EDGE),(t.wrapS!==n.ClampToEdgeWrapping||t.wrapT!==n.ClampToEdgeWrapping)&&console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.\",t),ri.texParameteri(e,ri.TEXTURE_MAG_FILTER,nt(t.magFilter)),ri.texParameteri(e,ri.TEXTURE_MIN_FILTER,nt(t.minFilter)),t.minFilter!==n.NearestFilter&&t.minFilter!==n.LinearFilter&&console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.\",t)),r=si.get(\"EXT_texture_filter_anisotropic\")){if(t.type===n.FloatType&&null===si.get(\"OES_texture_float_linear\"))return;if(t.type===n.HalfFloatType&&null===si.get(\"OES_texture_half_float_linear\"))return;(t.anisotropy>1||li.get(t).__currentAnisotropy)&&(ri.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,wt.getMaxAnisotropy())),li.get(t).__currentAnisotropy=t.anisotropy)}}function Q(e,t,i){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener(\"dispose\",s),e.__webglTexture=ri.createTexture(),ti.textures++),ui.activeTexture(ri.TEXTURE0+i),ui.bindTexture(ri.TEXTURE_2D,e.__webglTexture),ri.pixelStorei(ri.UNPACK_FLIP_Y_WEBGL,t.flipY),ri.pixelStorei(ri.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ri.pixelStorei(ri.UNPACK_ALIGNMENT,t.unpackAlignment);var r=H(t.image,ci.maxTextureSize);X(t)&&W(r)===!1&&(r=q(r));var a=W(r),o=at(t.format),c=at(t.type);V(ri.TEXTURE_2D,t,a);var u,l=t.mipmaps;if(t instanceof n.DepthTexture){var h=ri.DEPTH_COMPONENT;if(t.type===n.FloatType){if(!oi)throw new Error(\"Float Depth Texture only supported in WebGL2.0\");h=ri.DEPTH_COMPONENT32F}else oi&&(h=ri.DEPTH_COMPONENT16);ui.texImage2D(ri.TEXTURE_2D,0,h,r.width,r.height,0,o,c,null)}else if(t instanceof n.DataTexture)if(l.length>0&&a){for(var d=0,p=l.length;p>d;d++)u=l[d],ui.texImage2D(ri.TEXTURE_2D,d,o,u.width,u.height,0,o,c,u.data);t.generateMipmaps=!1}else ui.texImage2D(ri.TEXTURE_2D,0,o,r.width,r.height,0,o,c,r.data);else if(t instanceof n.CompressedTexture)for(var d=0,p=l.length;p>d;d++)u=l[d],t.format!==n.RGBAFormat&&t.format!==n.RGBFormat?ui.getCompressedTextureFormats().indexOf(o)>-1?ui.compressedTexImage2D(ri.TEXTURE_2D,d,o,u.width,u.height,0,u.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\"):ui.texImage2D(ri.TEXTURE_2D,d,o,u.width,u.height,0,o,c,u.data);else if(l.length>0&&a){for(var d=0,p=l.length;p>d;d++)u=l[d],ui.texImage2D(ri.TEXTURE_2D,d,o,o,c,u);t.generateMipmaps=!1}else ui.texImage2D(ri.TEXTURE_2D,0,o,o,c,r);t.generateMipmaps&&a&&ri.generateMipmap(ri.TEXTURE_2D),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function Y(e,t){e instanceof n.WebGLRenderTarget&&(e=e.texture);var i=li.get(e);if(e.version>0&&i.__version!==e.version){var r=e.image;return void 0===r?(console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is undefined\",e),void 0):r.complete===!1?(console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is incomplete\",e),void 0):(Q(i,e,t),void 0)}ui.activeTexture(ri.TEXTURE0+t),ui.bindTexture(ri.TEXTURE_2D,i.__webglTexture)}function H(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),r=document.createElement(\"canvas\");r.width=Math.floor(e.width*i),r.height=Math.floor(e.height*i);var n=r.getContext(\"2d\");return n.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn(\"THREE.WebGLRenderer: image is too big (\"+e.width+\"x\"+e.height+\"). Resized to \"+r.width+\"x\"+r.height,e),r}return e}function W(e){return n.Math.isPowerOfTwo(e.width)&&n.Math.isPowerOfTwo(e.height)}function X(e){return e.wrapS!==n.ClampToEdgeWrapping||e.wrapT!==n.ClampToEdgeWrapping?!0:e.minFilter!==n.NearestFilter&&e.minFilter!==n.LinearFilter?!0:!1}function q(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElement(\"canvas\");t.width=n.Math.nearestPowerOfTwo(e.width),t.height=n.Math.nearestPowerOfTwo(e.height);var i=t.getContext(\"2d\");return i.drawImage(e,0,0,t.width,t.height),console.warn(\"THREE.WebGLRenderer: image is not power of two (\"+e.width+\"x\"+e.height+\"). Resized to \"+t.width+\"x\"+t.height,e),t}return e}function Z(e,t){var i=li.get(e);if(6===e.image.length)if(e.version>0&&i.__version!==e.version){i.__image__webglTextureCube||(e.addEventListener(\"dispose\",s),i.__image__webglTextureCube=ri.createTexture(),ti.textures++),ui.activeTexture(ri.TEXTURE0+t),ui.bindTexture(ri.TEXTURE_CUBE_MAP,i.__image__webglTextureCube),ri.pixelStorei(ri.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof n.CompressedTexture,a=e.image[0]instanceof n.DataTexture,o=[],c=0;6>c;c++)o[c]=!wt.autoScaleCubemaps||r||a?a?e.image[c].image:e.image[c]:H(e.image[c],ci.maxCubemapSize);var u=o[0],l=W(u),h=at(e.format),d=at(e.type);V(ri.TEXTURE_CUBE_MAP,e,l);for(var c=0;6>c;c++)if(r)for(var p,f=o[c].mipmaps,m=0,g=f.length;g>m;m++)p=f[m],e.format!==n.RGBAFormat&&e.format!==n.RGBFormat?ui.getCompressedTextureFormats().indexOf(h)>-1?ui.compressedTexImage2D(ri.TEXTURE_CUBE_MAP_POSITIVE_X+c,m,h,p.width,p.height,0,p.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()\"):ui.texImage2D(ri.TEXTURE_CUBE_MAP_POSITIVE_X+c,m,h,p.width,p.height,0,h,d,p.data);else a?ui.texImage2D(ri.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,h,o[c].width,o[c].height,0,h,d,o[c].data):ui.texImage2D(ri.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,h,h,d,o[c]);e.generateMipmaps&&l&&ri.generateMipmap(ri.TEXTURE_CUBE_MAP),i.__version=e.version,e.onUpdate&&e.onUpdate(e)}else ui.activeTexture(ri.TEXTURE0+t),ui.bindTexture(ri.TEXTURE_CUBE_MAP,i.__image__webglTextureCube)}function K(e,t){ui.activeTexture(ri.TEXTURE0+t),ui.bindTexture(ri.TEXTURE_CUBE_MAP,li.get(e).__webglTexture)}function J(e,t,i,r){var n=at(t.texture.format),a=at(t.texture.type);ui.texImage2D(r,0,n,t.width,t.height,0,n,a,null),ri.bindFramebuffer(ri.FRAMEBUFFER,e),ri.framebufferTexture2D(ri.FRAMEBUFFER,i,r,li.get(t.texture).__webglTexture,0),ri.bindFramebuffer(ri.FRAMEBUFFER,null)}function $(e,t){ri.bindRenderbuffer(ri.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(ri.renderbufferStorage(ri.RENDERBUFFER,ri.DEPTH_COMPONENT16,t.width,t.height),ri.framebufferRenderbuffer(ri.FRAMEBUFFER,ri.DEPTH_ATTACHMENT,ri.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(ri.renderbufferStorage(ri.RENDERBUFFER,ri.DEPTH_STENCIL,t.width,t.height),ri.framebufferRenderbuffer(ri.FRAMEBUFFER,ri.DEPTH_STENCIL_ATTACHMENT,ri.RENDERBUFFER,e)):ri.renderbufferStorage(ri.RENDERBUFFER,ri.RGBA4,t.width,t.height),ri.bindRenderbuffer(ri.RENDERBUFFER,null)}function et(e,t){var i=t instanceof n.WebGLRenderTargetCube;if(i)throw new Error(\"Depth Texture with cube render targets is not supported!\");if(ri.bindFramebuffer(ri.FRAMEBUFFER,e),!(t.depthTexture instanceof n.DepthTexture))throw new Error(\"renderTarget.depthTexture must be an instance of THREE.DepthTexture\");li.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),wt.setTexture(t.depthTexture,0);var r=li.get(t.depthTexture).__webglTexture;ri.framebufferTexture2D(ri.FRAMEBUFFER,ri.DEPTH_ATTACHMENT,ri.TEXTURE_2D,r,0)}function tt(e){var t=li.get(e),i=e instanceof n.WebGLRenderTargetCube;if(e.depthTexture){if(i)throw new Error(\"target.depthTexture not supported in Cube render targets\");et(t.__webglFramebuffer,e)}else if(i){t.__webglDepthbuffer=[];for(var r=0;6>r;r++)ri.bindFramebuffer(ri.FRAMEBUFFER,t.__webglFramebuffer[r]),t.__webglDepthbuffer[r]=ri.createRenderbuffer(),$(t.__webglDepthbuffer[r],e)}else ri.bindFramebuffer(ri.FRAMEBUFFER,t.__webglFramebuffer),t.__webglDepthbuffer=ri.createRenderbuffer(),$(t.__webglDepthbuffer,e);ri.bindFramebuffer(ri.FRAMEBUFFER,null)}function it(e){var t=li.get(e),i=li.get(e.texture);e.addEventListener(\"dispose\",c),i.__webglTexture=ri.createTexture(),ti.textures++;var r=e instanceof n.WebGLRenderTargetCube,a=n.Math.isPowerOfTwo(e.width)&&n.Math.isPowerOfTwo(e.height);if(r){t.__webglFramebuffer=[];for(var o=0;6>o;o++)t.__webglFramebuffer[o]=ri.createFramebuffer()}else t.__webglFramebuffer=ri.createFramebuffer();if(r){ui.bindTexture(ri.TEXTURE_CUBE_MAP,i.__webglTexture),V(ri.TEXTURE_CUBE_MAP,e.texture,a);for(var o=0;6>o;o++)J(t.__webglFramebuffer[o],e,ri.COLOR_ATTACHMENT0,ri.TEXTURE_CUBE_MAP_POSITIVE_X+o);e.texture.generateMipmaps&&a&&ri.generateMipmap(ri.TEXTURE_CUBE_MAP),ui.bindTexture(ri.TEXTURE_CUBE_MAP,null)}else ui.bindTexture(ri.TEXTURE_2D,i.__webglTexture),V(ri.TEXTURE_2D,e.texture,a),J(t.__webglFramebuffer,e,ri.COLOR_ATTACHMENT0,ri.TEXTURE_2D),e.texture.generateMipmaps&&a&&ri.generateMipmap(ri.TEXTURE_2D),ui.bindTexture(ri.TEXTURE_2D,null);e.depthBuffer&&tt(e)}function rt(e){var t=e instanceof n.WebGLRenderTargetCube?ri.TEXTURE_CUBE_MAP:ri.TEXTURE_2D,i=li.get(e.texture).__webglTexture;ui.bindTexture(t,i),ri.generateMipmap(t),ui.bindTexture(t,null)}function nt(e){return e===n.NearestFilter||e===n.NearestMipMapNearestFilter||e===n.NearestMipMapLinearFilter?ri.NEAREST:ri.LINEAR}function at(e){var t;if(e===n.RepeatWrapping)return ri.REPEAT;if(e===n.ClampToEdgeWrapping)return ri.CLAMP_TO_EDGE;if(e===n.MirroredRepeatWrapping)return ri.MIRRORED_REPEAT;if(e===n.NearestFilter)return ri.NEAREST;if(e===n.NearestMipMapNearestFilter)return ri.NEAREST_MIPMAP_NEAREST;if(e===n.NearestMipMapLinearFilter)return ri.NEAREST_MIPMAP_LINEAR;if(e===n.LinearFilter)return ri.LINEAR;if(e===n.LinearMipMapNearestFilter)return ri.LINEAR_MIPMAP_NEAREST;if(e===n.LinearMipMapLinearFilter)return ri.LINEAR_MIPMAP_LINEAR;if(e===n.UnsignedByteType)return ri.UNSIGNED_BYTE;if(e===n.UnsignedShort4444Type)return ri.UNSIGNED_SHORT_4_4_4_4;if(e===n.UnsignedShort5551Type)return ri.UNSIGNED_SHORT_5_5_5_1;if(e===n.UnsignedShort565Type)return ri.UNSIGNED_SHORT_5_6_5;if(e===n.ByteType)return ri.BYTE;if(e===n.ShortType)return ri.SHORT;if(e===n.UnsignedShortType)return ri.UNSIGNED_SHORT;if(e===n.IntType)return ri.INT;if(e===n.UnsignedIntType)return ri.UNSIGNED_INT;if(e===n.FloatType)return ri.FLOAT;if(t=si.get(\"OES_texture_half_float\"),null!==t&&e===n.HalfFloatType)return t.HALF_FLOAT_OES;if(e===n.AlphaFormat)return ri.ALPHA;if(e===n.RGBFormat)return ri.RGB;if(e===n.RGBAFormat)return ri.RGBA;if(e===n.LuminanceFormat)return ri.LUMINANCE;if(e===n.LuminanceAlphaFormat)return ri.LUMINANCE_ALPHA;if(e===n.DepthFormat)return ri.DEPTH_COMPONENT;if(e===n.AddEquation)return ri.FUNC_ADD;if(e===n.SubtractEquation)return ri.FUNC_SUBTRACT;if(e===n.ReverseSubtractEquation)return ri.FUNC_REVERSE_SUBTRACT;if(e===n.ZeroFactor)return ri.ZERO;if(e===n.OneFactor)return ri.ONE;if(e===n.SrcColorFactor)return ri.SRC_COLOR;if(e===n.OneMinusSrcColorFactor)return ri.ONE_MINUS_SRC_COLOR;if(e===n.SrcAlphaFactor)return ri.SRC_ALPHA;if(e===n.OneMinusSrcAlphaFactor)return ri.ONE_MINUS_SRC_ALPHA;if(e===n.DstAlphaFactor)return ri.DST_ALPHA;if(e===n.OneMinusDstAlphaFactor)return ri.ONE_MINUS_DST_ALPHA;if(e===n.DstColorFactor)return ri.DST_COLOR;if(e===n.OneMinusDstColorFactor)return ri.ONE_MINUS_DST_COLOR;if(e===n.SrcAlphaSaturateFactor)return ri.SRC_ALPHA_SATURATE;if(t=si.get(\"WEBGL_compressed_texture_s3tc\"),null!==t){if(e===n.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===n.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===n.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===n.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t=si.get(\"WEBGL_compressed_texture_pvrtc\"),null!==t){if(e===n.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===n.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===n.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===n.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t=si.get(\"WEBGL_compressed_texture_etc1\"),null!==t&&e===n.RGB_ETC1_Format)return t.COMPRESSED_RGB_ETC1_WEBGL;if(t=si.get(\"EXT_blend_minmax\"),null!==t){if(e===n.MinEquation)return t.MIN_EXT;if(e===n.MaxEquation)return t.MAX_EXT}return 0}console.log(\"THREE.WebGLRenderer\",n.REVISION),e=e||{};var ot=void 0!==e.canvas?e.canvas:document.createElement(\"canvas\"),st=void 0!==e.context?e.context:null,ct=void 0!==e.alpha?e.alpha:!1,ut=void 0!==e.depth?e.depth:!0,lt=void 0!==e.stencil?e.stencil:!0,ht=void 0!==e.antialias?e.antialias:!1,dt=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,pt=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,ft=[],mt=[],gt=-1,vt=[],yt=-1,Mt=new Float32Array(8),At=[],xt=[];this.domElement=ot,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=n.LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var wt=this,Et=null,bt=null,Tt=null,Lt=-1,Nt=\"\",Dt=null,St=new n.Vector4,Ct=null,It=new n.Vector4,jt=0,_t=new n.Color(0),Ot=0,zt=ot.width,kt=ot.height,Rt=1,Bt=new n.Vector4(0,0,zt,kt),Ut=!1,Pt=new n.Vector4(0,0,zt,kt),Ft=new n.Frustum,Gt=!1,Vt=!1,Qt=!1,Yt=0,Ht={type:\"4fv\",value:null,needsUpdate:!1},Wt=null,Xt=0,qt=new n.Matrix3,Zt=new n.Sphere,Kt=new n.Plane,Jt=new n.Matrix4,$t=new n.Vector3,ei={hash:\"\",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},ti={geometries:0,textures:0},ii={calls:0,vertices:0,faces:0,points:0};this.info={render:ii,memory:ti,programs:null};var ri;try{var ni={alpha:ct,depth:ut,stencil:lt,antialias:ht,premultipliedAlpha:dt,preserveDrawingBuffer:pt};if(ri=st||ot.getContext(\"webgl\",ni)||ot.getContext(\"experimental-webgl\",ni),null===ri)throw null!==ot.getContext(\"webgl\")?\"Error creating WebGL context with your selected attributes.\":\"Error creating WebGL context.\";void 0===ri.getShaderPrecisionFormat&&(ri.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),ot.addEventListener(\"webglcontextlost\",o,!1)}catch(ai){console.error(\"THREE.WebGLRenderer: \"+ai)}var oi=\"undefined\"!=typeof WebGL2RenderingContext&&ri instanceof WebGL2RenderingContext,si=new n.WebGLExtensions(ri);si.get(\"WEBGL_depth_texture\"),si.get(\"OES_texture_float\"),si.get(\"OES_texture_float_linear\"),si.get(\"OES_texture_half_float\"),si.get(\"OES_texture_half_float_linear\"),si.get(\"OES_standard_derivatives\"),si.get(\"ANGLE_instanced_arrays\"),si.get(\"OES_element_index_uint\")&&(n.BufferGeometry.MaxIndex=4294967296);var ci=new n.WebGLCapabilities(ri,si,e),ui=new n.WebGLState(ri,si,at),li=new n.WebGLProperties,hi=new n.WebGLObjects(ri,li,this.info),di=new n.WebGLPrograms(this,ci),pi=new n.WebGLLights;this.info.programs=di.programs;var fi=new n.WebGLBufferRenderer(ri,si,ii),mi=new n.WebGLIndexedBufferRenderer(ri,si,ii);r(),this.context=ri,this.capabilities=ci,this.extensions=si,this.properties=li,this.state=ui;var gi=new n.WebGLShadowMap(this,ei,hi);this.shadowMap=gi;var vi=new n.SpritePlugin(this,At),yi=new n.LensFlarePlugin(this,xt);this.getContext=function(){return ri},this.getContextAttributes=function(){return ri.getContextAttributes()},this.forceContextLoss=function(){si.get(\"WEBGL_lose_context\").loseContext()},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=si.get(\"EXT_texture_filter_anisotropic\");return e=null!==t?ri.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return ci.precision},this.getPixelRatio=function(){return Rt},this.setPixelRatio=function(e){void 0!==e&&(Rt=e,this.setSize(Pt.z,Pt.w,!1))},this.getSize=function(){return{width:zt,height:kt}},this.setSize=function(e,t,i){zt=e,kt=t,ot.width=e*Rt,ot.height=t*Rt,i!==!1&&(ot.style.width=e+\"px\",ot.style.height=t+\"px\"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,r){ui.viewport(Pt.set(e,t,i,r))},this.setScissor=function(e,t,i,r){ui.scissor(Bt.set(e,t,i,r))},this.setScissorTest=function(e){ui.setScissorTest(Ut=e)},this.getClearColor=function(){return _t},this.setClearColor=function(e,t){_t.set(e),Ot=void 0!==t?t:1,i(_t.r,_t.g,_t.b,Ot)},this.getClearAlpha=function(){return Ot},this.setClearAlpha=function(e){Ot=e,i(_t.r,_t.g,_t.b,Ot)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=ri.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=ri.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=ri.STENCIL_BUFFER_BIT),ri.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.resetGLState=a,this.dispose=function(){ot.removeEventListener(\"webglcontextlost\",o,!1)},this.renderBufferImmediate=function(e,t,i){ui.initAttributes();var r=li.get(e);e.hasPositions&&!r.position&&(r.position=ri.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=ri.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=ri.createBuffer()),e.hasColors&&!r.color&&(r.color=ri.createBuffer());var a=t.getAttributes();if(e.hasPositions&&(ri.bindBuffer(ri.ARRAY_BUFFER,r.position),ri.bufferData(ri.ARRAY_BUFFER,e.positionArray,ri.DYNAMIC_DRAW),ui.enableAttribute(a.position),ri.vertexAttribPointer(a.position,3,ri.FLOAT,!1,0,0)),e.hasNormals){if(ri.bindBuffer(ri.ARRAY_BUFFER,r.normal),\"MeshPhongMaterial\"!==i.type&&\"MeshStandardMaterial\"!==i.type&&\"MeshPhysicalMaterial\"!==i.type&&i.shading===n.FlatShading)for(var o=0,s=3*e.count;s>o;o+=9){var c=e.normalArray,u=(c[o+0]+c[o+3]+c[o+6])/3,l=(c[o+1]+c[o+4]+c[o+7])/3,h=(c[o+2]+c[o+5]+c[o+8])/3;c[o+0]=u,c[o+1]=l,c[o+2]=h,c[o+3]=u,c[o+4]=l,c[o+5]=h,c[o+6]=u,c[o+7]=l,c[o+8]=h}ri.bufferData(ri.ARRAY_BUFFER,e.normalArray,ri.DYNAMIC_DRAW),ui.enableAttribute(a.normal),ri.vertexAttribPointer(a.normal,3,ri.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(ri.bindBuffer(ri.ARRAY_BUFFER,r.uv),ri.bufferData(ri.ARRAY_BUFFER,e.uvArray,ri.DYNAMIC_DRAW),ui.enableAttribute(a.uv),ri.vertexAttribPointer(a.uv,2,ri.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==n.NoColors&&(ri.bindBuffer(ri.ARRAY_BUFFER,r.color),ri.bufferData(ri.ARRAY_BUFFER,e.colorArray,ri.DYNAMIC_DRAW),ui.enableAttribute(a.color),ri.vertexAttribPointer(a.color,3,ri.FLOAT,!1,0,0)),ui.disableUnusedAttributes(),ri.drawArrays(ri.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,i,r,a,o,s){E(a);var c=T(e,i,a,o),u=!1,l=r.id+\"_\"+c.id+\"_\"+a.wireframe;l!==Nt&&(Nt=l,u=!0);var h=o.morphTargetInfluences;if(void 0!==h){for(var d=[],p=0,g=h.length;g>p;p++){var v=h[p];d.push([v,p])}d.sort(m),d.length>8&&(d.length=8);for(var y=r.morphAttributes,p=0,g=d.length;g>p;p++){var v=d[p];if(Mt[p]=v[0],0!==v[0]){var M=v[1];a.morphTargets===!0&&y.position&&r.addAttribute(\"morphTarget\"+p,y.position[M]),a.morphNormals===!0&&y.normal&&r.addAttribute(\"morphNormal\"+p,y.normal[M])}else a.morphTargets===!0&&r.removeAttribute(\"morphTarget\"+p),a.morphNormals===!0&&r.removeAttribute(\"morphNormal\"+p)}c.getUniforms().setValue(ri,\"morphTargetInfluences\",Mt),u=!0}var M=r.index,A=r.attributes.position;a.wireframe===!0&&(M=hi.getWireframeAttribute(r));var x;null!==M?(x=mi,x.setIndex(M)):x=fi,u&&(f(a,c,r),null!==M&&ri.bindBuffer(ri.ELEMENT_ARRAY_BUFFER,hi.getAttributeBuffer(M)));var w=0,b=1/0;null!==M?b=M.count:void 0!==A&&(b=A.count);var L=r.drawRange.start,N=r.drawRange.count,D=null!==s?s.start:0,S=null!==s?s.count:1/0,C=Math.max(w,L,D),I=Math.min(w+b,L+N,D+S)-1,j=Math.max(0,I-C+1);if(o instanceof n.Mesh)if(a.wireframe===!0)ui.setLineWidth(a.wireframeLinewidth*t()),x.setMode(ri.LINES);else switch(o.drawMode){case n.TrianglesDrawMode:x.setMode(ri.TRIANGLES);break;case n.TriangleStripDrawMode:x.setMode(ri.TRIANGLE_STRIP);break;case n.TriangleFanDrawMode:x.setMode(ri.TRIANGLE_FAN)}else if(o instanceof n.Line){var _=a.linewidth;void 0===_&&(_=1),ui.setLineWidth(_*t()),o instanceof n.LineSegments?x.setMode(ri.LINES):x.setMode(ri.LINE_STRIP)}else o instanceof n.Points&&x.setMode(ri.POINTS);r instanceof n.InstancedBufferGeometry?r.maxInstancedCount>0&&x.renderInstances(r,C,j):x.render(C,j)},this.render=function(e,t,i,r){if(t instanceof n.Camera==!1)return console.error(\"THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.\"),void 0;var a=e.fog;if(Nt=\"\",Lt=-1,Dt=null,e.autoUpdate===!0&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),Jt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Ft.setFromMatrix(Jt),ft.length=0,gt=-1,yt=-1,At.length=0,xt.length=0,B(this.clippingPlanes,t),A(e,t),mt.length=gt+1,vt.length=yt+1,wt.sortObjects===!0&&(mt.sort(g),vt.sort(v)),Gt&&(Qt=!0,U(null)),k(ft),gi.render(e,t),R(ft,t),Gt&&(Qt=!1,P()),ii.calls=0,ii.vertices=0,ii.faces=0,ii.points=0,void 0===i&&(i=null),this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){var o=e.overrideMaterial;x(mt,t,a,o),x(vt,t,a,o)}else ui.setBlending(n.NoBlending),x(mt,t,a),x(vt,t,a);if(vi.render(e,t),yi.render(e,t,It),i){var s=i.texture;s.generateMipmaps&&W(i)&&s.minFilter!==n.NearestFilter&&s.minFilter!==n.LinearFilter&&rt(i)}ui.setDepthTest(!0),ui.setDepthWrite(!0),ui.setColorWrite(!0)},this.setFaceCulling=function(e,t){e===n.CullFaceNone?ui.disable(ri.CULL_FACE):(t===n.FrontFaceDirectionCW?ri.frontFace(ri.CW):ri.frontFace(ri.CCW),e===n.CullFaceBack?ri.cullFace(ri.BACK):e===n.CullFaceFront?ri.cullFace(ri.FRONT):ri.cullFace(ri.FRONT_AND_BACK),ui.enable(ri.CULL_FACE))};var Mi=!1;this.setTexture=function(e,t){Mi||(console.warn(\"THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.\"),Mi=!0),Y(e,t)},this.allocTextureUnit=G,this.setTexture2D=Y,this.setTextureCube=function(e,t){e instanceof n.CubeTexture||Array.isArray(e.image)&&6===e.image.length?Z(e,t):K(e.texture,t)},this.getCurrentRenderTarget=function(){return bt},this.setRenderTarget=function(e){bt=e,e&&void 0===li.get(e).__webglFramebuffer&&it(e);var t,i=e instanceof n.WebGLRenderTargetCube;if(e){var r=li.get(e);t=i?r.__webglFramebuffer[e.activeCubeFace]:r.__webglFramebuffer,St.copy(e.scissor),Ct=e.scissorTest,It.copy(e.viewport)}else t=null,St.copy(Bt).multiplyScalar(Rt),Ct=Ut,It.copy(Pt).multiplyScalar(Rt);if(Tt!==t&&(ri.bindFramebuffer(ri.FRAMEBUFFER,t),Tt=t),ui.scissor(St),ui.setScissorTest(Ct),ui.viewport(It),i){var a=li.get(e.texture);ri.framebufferTexture2D(ri.FRAMEBUFFER,ri.COLOR_ATTACHMENT0,ri.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,a.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,i,r,a,o){if(e instanceof n.WebGLRenderTarget==!1)return console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.\"),void 0;\nvar s=li.get(e).__webglFramebuffer;if(s){var c=!1;s!==Tt&&(ri.bindFramebuffer(ri.FRAMEBUFFER,s),c=!0);try{var u=e.texture;if(u.format!==n.RGBAFormat&&at(u.format)!==ri.getParameter(ri.IMPLEMENTATION_COLOR_READ_FORMAT))return console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.\"),void 0;if(!(u.type===n.UnsignedByteType||at(u.type)===ri.getParameter(ri.IMPLEMENTATION_COLOR_READ_TYPE)||u.type===n.FloatType&&si.get(\"WEBGL_color_buffer_float\")||u.type===n.HalfFloatType&&si.get(\"EXT_color_buffer_half_float\")))return console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.\"),void 0;ri.checkFramebufferStatus(ri.FRAMEBUFFER)===ri.FRAMEBUFFER_COMPLETE?t>0&&t<=e.width-r&&i>0&&i<=e.height-a&&ri.readPixels(t,i,r,a,at(u.format),at(u.type),o):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.\")}finally{c&&ri.bindFramebuffer(ri.FRAMEBUFFER,Tt)}}}},n.WebGLRenderTarget=function(e,t,i){this.uuid=n.Math.generateUUID(),this.width=e,this.height=t,this.scissor=new n.Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new n.Vector4(0,0,e,t),i=i||{},void 0===i.minFilter&&(i.minFilter=n.LinearFilter),this.texture=new n.Texture(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0,this.depthTexture=null},n.WebGLRenderTarget.prototype={constructor:n.WebGLRenderTarget,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}},n.EventDispatcher.prototype.apply(n.WebGLRenderTarget.prototype),n.WebGLRenderTargetCube=function(e,t,i){n.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0,this.activeMipMapLevel=0},n.WebGLRenderTargetCube.prototype=Object.create(n.WebGLRenderTarget.prototype),n.WebGLRenderTargetCube.prototype.constructor=n.WebGLRenderTargetCube,n.WebGLBufferRenderer=function(e,t,i){function r(e){s=e}function a(t,r){e.drawArrays(s,t,r),i.calls++,i.vertices+=r,s===e.TRIANGLES&&(i.faces+=r/3)}function o(r){var a=t.get(\"ANGLE_instanced_arrays\");if(null===a)return console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\"),void 0;var o=r.attributes.position,c=0;o instanceof n.InterleavedBufferAttribute?(c=o.data.count,a.drawArraysInstancedANGLE(s,0,c,r.maxInstancedCount)):(c=o.count,a.drawArraysInstancedANGLE(s,0,c,r.maxInstancedCount)),i.calls++,i.vertices+=c*r.maxInstancedCount,s===e.TRIANGLES&&(i.faces+=r.maxInstancedCount*c/3)}var s;this.setMode=r,this.render=a,this.renderInstances=o},n.WebGLIndexedBufferRenderer=function(e,t,i){function r(e){s=e}function n(i){i.array instanceof Uint32Array&&t.get(\"OES_element_index_uint\")?(c=e.UNSIGNED_INT,u=4):(c=e.UNSIGNED_SHORT,u=2)}function a(t,r){e.drawElements(s,r,c,t*u),i.calls++,i.vertices+=r,s===e.TRIANGLES&&(i.faces+=r/3)}function o(r,n,a){var o=t.get(\"ANGLE_instanced_arrays\");return null===o?(console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\"),void 0):(o.drawElementsInstancedANGLE(s,a,c,n*u,r.maxInstancedCount),i.calls++,i.vertices+=a*r.maxInstancedCount,s===e.TRIANGLES&&(i.faces+=r.maxInstancedCount*a/3),void 0)}var s,c,u;this.setMode=r,this.setIndex=n,this.render=a,this.renderInstances=o},n.WebGLExtensions=function(e){var t={};this.get=function(i){if(void 0!==t[i])return t[i];var r;switch(i){case\"WEBGL_depth_texture\":r=e.getExtension(\"WEBGL_depth_texture\")||e.getExtension(\"MOZ_WEBGL_depth_texture\")||e.getExtension(\"WEBKIT_WEBGL_depth_texture\");case\"EXT_texture_filter_anisotropic\":r=e.getExtension(\"EXT_texture_filter_anisotropic\")||e.getExtension(\"MOZ_EXT_texture_filter_anisotropic\")||e.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\");break;case\"WEBGL_compressed_texture_s3tc\":r=e.getExtension(\"WEBGL_compressed_texture_s3tc\")||e.getExtension(\"MOZ_WEBGL_compressed_texture_s3tc\")||e.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");break;case\"WEBGL_compressed_texture_pvrtc\":r=e.getExtension(\"WEBGL_compressed_texture_pvrtc\")||e.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\");break;case\"WEBGL_compressed_texture_etc1\":r=e.getExtension(\"WEBGL_compressed_texture_etc1\");break;default:r=e.getExtension(i)}return null===r&&console.warn(\"THREE.WebGLRenderer: \"+i+\" extension not supported.\"),t[i]=r,r}},n.WebGLCapabilities=function(e,t,i){function r(t){if(\"highp\"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return\"highp\";t=\"mediump\"}return\"mediump\"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?\"mediump\":\"lowp\"}this.getMaxPrecision=r,this.precision=void 0!==i.precision?i.precision:\"highp\",this.logarithmicDepthBuffer=void 0!==i.logarithmicDepthBuffer?i.logarithmicDepthBuffer:!1,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!t.get(\"OES_texture_float\"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var n=r(this.precision);n!==this.precision&&(console.warn(\"THREE.WebGLRenderer:\",this.precision,\"not supported, using\",n,\"instead.\"),this.precision=n),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!t.get(\"EXT_frag_depth\"))},n.WebGLGeometries=function(e,t,i){function r(e){var t=e.geometry;if(void 0!==l[t.id])return l[t.id];t.addEventListener(\"dispose\",a);var r;return t instanceof n.BufferGeometry?r=t:t instanceof n.Geometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new n.BufferGeometry).setFromObject(e)),r=t._bufferGeometry),l[t.id]=r,i.memory.geometries++,r}function a(e){var r=e.target,n=l[r.id];null!==n.index&&s(n.index),c(n.attributes),r.removeEventListener(\"dispose\",a),delete l[r.id];var o=t.get(r);o.wireframe&&s(o.wireframe),t.delete(r);var u=t.get(n);u.wireframe&&s(u.wireframe),t.delete(n),i.memory.geometries--}function o(e){return e instanceof n.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function s(t){var i=o(t);void 0!==i&&(e.deleteBuffer(i),u(t))}function c(e){for(var t in e)s(e[t])}function u(e){e instanceof n.InterleavedBufferAttribute?t.delete(e.data):t.delete(e)}var l={};this.get=r},n.WebGLLights=function(){var e={};this.get=function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case\"DirectionalLight\":i={direction:new n.Vector3,color:new n.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n.Vector2};break;case\"SpotLight\":i={position:new n.Vector3,direction:new n.Vector3,color:new n.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n.Vector2};break;case\"PointLight\":i={position:new n.Vector3,color:new n.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n.Vector2};break;case\"HemisphereLight\":i={direction:new n.Vector3,skyColor:new n.Color,groundColor:new n.Color}}return e[t.id]=i,i}},n.WebGLObjects=function(e,t,i){function r(t){var i=h.get(t);t.geometry instanceof n.Geometry&&i.updateFromObject(t);var r=i.index,o=i.attributes;null!==r&&a(r,e.ELEMENT_ARRAY_BUFFER);for(var s in o)a(o[s],e.ARRAY_BUFFER);var c=i.morphAttributes;for(var s in c)for(var u=c[s],l=0,d=u.length;d>l;l++)a(u[l],e.ARRAY_BUFFER);return i}function a(e,i){var r=e instanceof n.InterleavedBufferAttribute?e.data:e,a=t.get(r);void 0===a.__webglBuffer?o(a,r,i):a.version!==r.version&&s(a,r,i)}function o(t,i,r){t.__webglBuffer=e.createBuffer(),e.bindBuffer(r,t.__webglBuffer);var n=i.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(r,i.array,n),t.version=i.version}function s(t,i,r){e.bindBuffer(r,t.__webglBuffer),i.dynamic===!1||-1===i.updateRange.count?e.bufferSubData(r,0,i.array):0===i.updateRange.count?console.error(\"THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.\"):(e.bufferSubData(r,i.updateRange.offset*i.array.BYTES_PER_ELEMENT,i.array.subarray(i.updateRange.offset,i.updateRange.offset+i.updateRange.count)),i.updateRange.count=0),t.version=i.version}function c(e){return e instanceof n.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function u(i){var r=t.get(i);if(void 0!==r.wireframe)return r.wireframe;var o=[],s=i.index,c=i.attributes,u=c.position;if(null!==s)for(var h={},d=s.array,p=0,f=d.length;f>p;p+=3){var m=d[p+0],g=d[p+1],v=d[p+2];l(h,m,g)&&o.push(m,g),l(h,g,v)&&o.push(g,v),l(h,v,m)&&o.push(v,m)}else for(var d=c.position.array,p=0,f=d.length/3-1;f>p;p+=3){var m=p+0,g=p+1,v=p+2;o.push(m,g,g,v,v,m)}var y=u.count>65535?Uint32Array:Uint16Array,M=new n.BufferAttribute(new y(o),1);return a(M,e.ELEMENT_ARRAY_BUFFER),r.wireframe=M,M}function l(e,t,i){if(t>i){var r=t;t=i,i=r}var n=e[t];return void 0===n?(e[t]=[i],!0):-1===n.indexOf(i)?(n.push(i),!0):!1}var h=new n.WebGLGeometries(e,t,i);this.getAttributeBuffer=c,this.getWireframeAttribute=u,this.update=r},n.WebGLProgram=function(){function e(e){switch(e){case n.LinearEncoding:return[\"Linear\",\"( value )\"];case n.sRGBEncoding:return[\"sRGB\",\"( value )\"];case n.RGBEEncoding:return[\"RGBE\",\"( value )\"];case n.RGBM7Encoding:return[\"RGBM\",\"( value, 7.0 )\"];case n.RGBM16Encoding:return[\"RGBM\",\"( value, 16.0 )\"];case n.RGBDEncoding:return[\"RGBD\",\"( value, 256.0 )\"];case n.GammaEncoding:return[\"Gamma\",\"( value, float( GAMMA_FACTOR ) )\"];default:throw new Error(\"unsupported encoding: \"+e)}}function t(t,i){var r=e(i);return\"vec4 \"+t+\"( vec4 value ) { return \"+r[0]+\"ToLinear\"+r[1]+\"; }\"}function i(t,i){var r=e(i);return\"vec4 \"+t+\"( vec4 value ) { return LinearTo\"+r[0]+r[1]+\"; }\"}function r(e,t){var i;switch(t){case n.LinearToneMapping:i=\"Linear\";break;case n.ReinhardToneMapping:i=\"Reinhard\";break;case n.Uncharted2ToneMapping:i=\"Uncharted2\";break;case n.CineonToneMapping:i=\"OptimizedCineon\";break;default:throw new Error(\"unsupported toneMapping: \"+t)}return\"vec3 \"+e+\"( vec3 color ) { return \"+i+\"ToneMapping( color ); }\"}function a(e,t,i){e=e||{};var r=[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?\"#extension GL_OES_standard_derivatives : enable\":\"\",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get(\"EXT_frag_depth\")?\"#extension GL_EXT_frag_depth : enable\":\"\",e.drawBuffers&&i.get(\"WEBGL_draw_buffers\")?\"#extension GL_EXT_draw_buffers : require\":\"\",(e.shaderTextureLOD||t.envMap)&&i.get(\"EXT_shader_texture_lod\")?\"#extension GL_EXT_shader_texture_lod : enable\":\"\"];return r.filter(c).join(\"\\n\")}function o(e){var t=[];for(var i in e){var r=e[i];r!==!1&&t.push(\"#define \"+i+\" \"+r)}return t.join(\"\\n\")}function s(e,t){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;r>n;n++){var a=e.getActiveAttrib(t,n),o=a.name;i[o]=e.getAttribLocation(t,o)}return i}function c(e){return\"\"!==e}function u(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function l(e){function t(e,t){var i=n.ShaderChunk[t];if(void 0===i)throw new Error(\"Can not resolve #include <\"+t+\">\");return l(i)}var i=/#include +<([\\w\\d.]+)>/g;return e.replace(i,t)}function h(e){function t(e,t,i,r){for(var n=\"\",a=parseInt(t);a<parseInt(i);a++)n+=r.replace(/\\[ i \\]/g,\"[ \"+a+\" ]\");return n}var i=/for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g;return e.replace(i,t)}var d=0;return function(e,p,f,m){var g=e.context,v=f.extensions,y=f.defines,M=f.__webglShader.vertexShader,A=f.__webglShader.fragmentShader,x=\"SHADOWMAP_TYPE_BASIC\";m.shadowMapType===n.PCFShadowMap?x=\"SHADOWMAP_TYPE_PCF\":m.shadowMapType===n.PCFSoftShadowMap&&(x=\"SHADOWMAP_TYPE_PCF_SOFT\");var w=\"ENVMAP_TYPE_CUBE\",E=\"ENVMAP_MODE_REFLECTION\",b=\"ENVMAP_BLENDING_MULTIPLY\";if(m.envMap){switch(f.envMap.mapping){case n.CubeReflectionMapping:case n.CubeRefractionMapping:w=\"ENVMAP_TYPE_CUBE\";break;case n.CubeUVReflectionMapping:case n.CubeUVRefractionMapping:w=\"ENVMAP_TYPE_CUBE_UV\";break;case n.EquirectangularReflectionMapping:case n.EquirectangularRefractionMapping:w=\"ENVMAP_TYPE_EQUIREC\";break;case n.SphericalReflectionMapping:w=\"ENVMAP_TYPE_SPHERE\"}switch(f.envMap.mapping){case n.CubeRefractionMapping:case n.EquirectangularRefractionMapping:E=\"ENVMAP_MODE_REFRACTION\"}switch(f.combine){case n.MultiplyOperation:b=\"ENVMAP_BLENDING_MULTIPLY\";break;case n.MixOperation:b=\"ENVMAP_BLENDING_MIX\";break;case n.AddOperation:b=\"ENVMAP_BLENDING_ADD\"}}var T,L,N=e.gammaFactor>0?e.gammaFactor:1,D=a(v,m,e.extensions),S=o(y),C=g.createProgram();f instanceof n.RawShaderMaterial?(T=\"\",L=\"\"):(T=[\"precision \"+m.precision+\" float;\",\"precision \"+m.precision+\" int;\",\"#define SHADER_NAME \"+f.__webglShader.name,S,m.supportsVertexTextures?\"#define VERTEX_TEXTURES\":\"\",\"#define GAMMA_FACTOR \"+N,\"#define MAX_BONES \"+m.maxBones,m.map?\"#define USE_MAP\":\"\",m.envMap?\"#define USE_ENVMAP\":\"\",m.envMap?\"#define \"+E:\"\",m.lightMap?\"#define USE_LIGHTMAP\":\"\",m.aoMap?\"#define USE_AOMAP\":\"\",m.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",m.bumpMap?\"#define USE_BUMPMAP\":\"\",m.normalMap?\"#define USE_NORMALMAP\":\"\",m.displacementMap&&m.supportsVertexTextures?\"#define USE_DISPLACEMENTMAP\":\"\",m.specularMap?\"#define USE_SPECULARMAP\":\"\",m.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",m.metalnessMap?\"#define USE_METALNESSMAP\":\"\",m.alphaMap?\"#define USE_ALPHAMAP\":\"\",m.vertexColors?\"#define USE_COLOR\":\"\",m.flatShading?\"#define FLAT_SHADED\":\"\",m.skinning?\"#define USE_SKINNING\":\"\",m.useVertexTexture?\"#define BONE_TEXTURE\":\"\",m.morphTargets?\"#define USE_MORPHTARGETS\":\"\",m.morphNormals&&m.flatShading===!1?\"#define USE_MORPHNORMALS\":\"\",m.doubleSided?\"#define DOUBLE_SIDED\":\"\",m.flipSided?\"#define FLIP_SIDED\":\"\",\"#define NUM_CLIPPING_PLANES \"+m.numClippingPlanes,m.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",m.shadowMapEnabled?\"#define \"+x:\"\",m.sizeAttenuation?\"#define USE_SIZEATTENUATION\":\"\",m.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",m.logarithmicDepthBuffer&&e.extensions.get(\"EXT_frag_depth\")?\"#define USE_LOGDEPTHBUF_EXT\":\"\",\"uniform mat4 modelMatrix;\",\"uniform mat4 modelViewMatrix;\",\"uniform mat4 projectionMatrix;\",\"uniform mat4 viewMatrix;\",\"uniform mat3 normalMatrix;\",\"uniform vec3 cameraPosition;\",\"attribute vec3 position;\",\"attribute vec3 normal;\",\"attribute vec2 uv;\",\"#ifdef USE_COLOR\",\"\tattribute vec3 color;\",\"#endif\",\"#ifdef USE_MORPHTARGETS\",\"\tattribute vec3 morphTarget0;\",\"\tattribute vec3 morphTarget1;\",\"\tattribute vec3 morphTarget2;\",\"\tattribute vec3 morphTarget3;\",\"\t#ifdef USE_MORPHNORMALS\",\"\t\tattribute vec3 morphNormal0;\",\"\t\tattribute vec3 morphNormal1;\",\"\t\tattribute vec3 morphNormal2;\",\"\t\tattribute vec3 morphNormal3;\",\"\t#else\",\"\t\tattribute vec3 morphTarget4;\",\"\t\tattribute vec3 morphTarget5;\",\"\t\tattribute vec3 morphTarget6;\",\"\t\tattribute vec3 morphTarget7;\",\"\t#endif\",\"#endif\",\"#ifdef USE_SKINNING\",\"\tattribute vec4 skinIndex;\",\"\tattribute vec4 skinWeight;\",\"#endif\",\"\\n\"].filter(c).join(\"\\n\"),L=[D,\"precision \"+m.precision+\" float;\",\"precision \"+m.precision+\" int;\",\"#define SHADER_NAME \"+f.__webglShader.name,S,m.alphaTest?\"#define ALPHATEST \"+m.alphaTest:\"\",\"#define GAMMA_FACTOR \"+N,m.useFog&&m.fog?\"#define USE_FOG\":\"\",m.useFog&&m.fogExp?\"#define FOG_EXP2\":\"\",m.map?\"#define USE_MAP\":\"\",m.envMap?\"#define USE_ENVMAP\":\"\",m.envMap?\"#define \"+w:\"\",m.envMap?\"#define \"+E:\"\",m.envMap?\"#define \"+b:\"\",m.lightMap?\"#define USE_LIGHTMAP\":\"\",m.aoMap?\"#define USE_AOMAP\":\"\",m.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",m.bumpMap?\"#define USE_BUMPMAP\":\"\",m.normalMap?\"#define USE_NORMALMAP\":\"\",m.specularMap?\"#define USE_SPECULARMAP\":\"\",m.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",m.metalnessMap?\"#define USE_METALNESSMAP\":\"\",m.alphaMap?\"#define USE_ALPHAMAP\":\"\",m.vertexColors?\"#define USE_COLOR\":\"\",m.flatShading?\"#define FLAT_SHADED\":\"\",m.doubleSided?\"#define DOUBLE_SIDED\":\"\",m.flipSided?\"#define FLIP_SIDED\":\"\",\"#define NUM_CLIPPING_PLANES \"+m.numClippingPlanes,m.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",m.shadowMapEnabled?\"#define \"+x:\"\",m.premultipliedAlpha?\"#define PREMULTIPLIED_ALPHA\":\"\",m.physicallyCorrectLights?\"#define PHYSICALLY_CORRECT_LIGHTS\":\"\",m.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",m.logarithmicDepthBuffer&&e.extensions.get(\"EXT_frag_depth\")?\"#define USE_LOGDEPTHBUF_EXT\":\"\",m.envMap&&e.extensions.get(\"EXT_shader_texture_lod\")?\"#define TEXTURE_LOD_EXT\":\"\",\"uniform mat4 viewMatrix;\",\"uniform vec3 cameraPosition;\",m.toneMapping!==n.NoToneMapping?\"#define TONE_MAPPING\":\"\",m.toneMapping!==n.NoToneMapping?n.ShaderChunk.tonemapping_pars_fragment:\"\",m.toneMapping!==n.NoToneMapping?r(\"toneMapping\",m.toneMapping):\"\",m.outputEncoding||m.mapEncoding||m.envMapEncoding||m.emissiveMapEncoding?n.ShaderChunk.encodings_pars_fragment:\"\",m.mapEncoding?t(\"mapTexelToLinear\",m.mapEncoding):\"\",m.envMapEncoding?t(\"envMapTexelToLinear\",m.envMapEncoding):\"\",m.emissiveMapEncoding?t(\"emissiveMapTexelToLinear\",m.emissiveMapEncoding):\"\",m.outputEncoding?i(\"linearToOutputTexel\",m.outputEncoding):\"\",m.depthPacking?\"#define DEPTH_PACKING \"+f.depthPacking:\"\",\"\\n\"].filter(c).join(\"\\n\")),M=l(M,m),M=u(M,m),A=l(A,m),A=u(A,m),f instanceof n.ShaderMaterial==!1&&(M=h(M),A=h(A));var I=T+M,j=L+A,_=n.WebGLShader(g,g.VERTEX_SHADER,I),O=n.WebGLShader(g,g.FRAGMENT_SHADER,j);g.attachShader(C,_),g.attachShader(C,O),void 0!==f.index0AttributeName?g.bindAttribLocation(C,0,f.index0AttributeName):m.morphTargets===!0&&g.bindAttribLocation(C,0,\"position\"),g.linkProgram(C);var z=g.getProgramInfoLog(C),k=g.getShaderInfoLog(_),R=g.getShaderInfoLog(O),B=!0,U=!0;g.getProgramParameter(C,g.LINK_STATUS)===!1?(B=!1,console.error(\"THREE.WebGLProgram: shader error: \",g.getError(),\"gl.VALIDATE_STATUS\",g.getProgramParameter(C,g.VALIDATE_STATUS),\"gl.getProgramInfoLog\",z,k,R)):\"\"!==z?console.warn(\"THREE.WebGLProgram: gl.getProgramInfoLog()\",z):(\"\"===k||\"\"===R)&&(U=!1),U&&(this.diagnostics={runnable:B,material:f,programLog:z,vertexShader:{log:k,prefix:T},fragmentShader:{log:R,prefix:L}}),g.deleteShader(_),g.deleteShader(O);var P;this.getUniforms=function(){return void 0===P&&(P=new n.WebGLUniforms(g,C,e)),P};var F;return this.getAttributes=function(){return void 0===F&&(F=s(g,C)),F},this.destroy=function(){g.deleteProgram(C),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn(\"THREE.WebGLProgram: .uniforms is now .getUniforms().\"),this.getUniforms()}},attributes:{get:function(){return console.warn(\"THREE.WebGLProgram: .attributes is now .getAttributes().\"),this.getAttributes()}}}),this.id=d++,this.code=p,this.usedTimes=1,this.program=C,this.vertexShader=_,this.fragmentShader=O,this}}(),n.WebGLPrograms=function(e,t){function i(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var i=t.maxVertexUniforms,r=Math.floor((i-20)/4),a=r;return void 0!==e&&e instanceof n.SkinnedMesh&&(a=Math.min(e.skeleton.bones.length,a),a<e.skeleton.bones.length&&console.warn(\"WebGLRenderer: too many bones - \"+e.skeleton.bones.length+\", this GPU supports just \"+a+\" (try OpenGL instead of ANGLE)\")),a}function r(e,t){var i;return e?e instanceof n.Texture?i=e.encoding:e instanceof n.WebGLRenderTarget&&(i=e.texture.encoding):i=n.LinearEncoding,i===n.LinearEncoding&&t&&(i=n.GammaEncoding),i}var a=[],o={MeshDepthMaterial:\"depth\",MeshNormalMaterial:\"normal\",MeshBasicMaterial:\"basic\",MeshLambertMaterial:\"lambert\",MeshPhongMaterial:\"phong\",MeshStandardMaterial:\"physical\",MeshPhysicalMaterial:\"physical\",LineBasicMaterial:\"basic\",LineDashedMaterial:\"dashed\",PointsMaterial:\"points\"},s=[\"precision\",\"supportsVertexTextures\",\"map\",\"mapEncoding\",\"envMap\",\"envMapMode\",\"envMapEncoding\",\"lightMap\",\"aoMap\",\"emissiveMap\",\"emissiveMapEncoding\",\"bumpMap\",\"normalMap\",\"displacementMap\",\"specularMap\",\"roughnessMap\",\"metalnessMap\",\"alphaMap\",\"combine\",\"vertexColors\",\"fog\",\"useFog\",\"fogExp\",\"flatShading\",\"sizeAttenuation\",\"logarithmicDepthBuffer\",\"skinning\",\"maxBones\",\"useVertexTexture\",\"morphTargets\",\"morphNormals\",\"maxMorphTargets\",\"maxMorphNormals\",\"premultipliedAlpha\",\"numDirLights\",\"numPointLights\",\"numSpotLights\",\"numHemiLights\",\"shadowMapEnabled\",\"shadowMapType\",\"toneMapping\",\"physicallyCorrectLights\",\"alphaTest\",\"doubleSided\",\"flipSided\",\"numClippingPlanes\",\"depthPacking\"];this.getParameters=function(a,s,c,u,l){var h=o[a.type],d=i(l),p=e.getPrecision();null!==a.precision&&(p=t.getMaxPrecision(a.precision),p!==a.precision&&console.warn(\"THREE.WebGLProgram.getParameters:\",a.precision,\"not supported, using\",p,\"instead.\"));var f={shaderID:h,precision:p,supportsVertexTextures:t.vertexTextures,outputEncoding:r(e.getCurrentRenderTarget(),e.gammaOutput),map:!!a.map,mapEncoding:r(a.map,e.gammaInput),envMap:!!a.envMap,envMapMode:a.envMap&&a.envMap.mapping,envMapEncoding:r(a.envMap,e.gammaInput),envMapCubeUV:!!a.envMap&&(a.envMap.mapping===n.CubeUVReflectionMapping||a.envMap.mapping===n.CubeUVRefractionMapping),lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:r(a.emissiveMap,e.gammaInput),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,alphaMap:!!a.alphaMap,combine:a.combine,vertexColors:a.vertexColors,fog:c,useFog:a.fog,fogExp:c instanceof n.FogExp2,flatShading:a.shading===n.FlatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:a.skinning,maxBones:d,useVertexTexture:t.floatVertexTextures&&l&&l.skeleton&&l.skeleton.useVertexTexture,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numHemiLights:s.hemi.length,numClippingPlanes:u,shadowMapEnabled:e.shadowMap.enabled&&l.receiveShadow&&s.shadows.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,alphaTest:a.alphaTest,doubleSided:a.side===n.DoubleSide,flipSided:a.side===n.BackSide,depthPacking:void 0!==a.depthPacking?a.depthPacking:!1};return f},this.getProgramCode=function(e,t){var i=[];if(t.shaderID?i.push(t.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)i.push(r),i.push(e.defines[r]);for(var n=0;n<s.length;n++)i.push(t[s[n]]);return i.join()},this.acquireProgram=function(t,i,r){for(var o,s=0,c=a.length;c>s;s++){var u=a[s];if(u.code===r){o=u,++o.usedTimes;break}}return void 0===o&&(o=new n.WebGLProgram(e,r,t,i),a.push(o)),o},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},this.programs=a},n.WebGLProperties=function(){var e={};this.get=function(t){var i=t.uuid,r=e[i];return void 0===r&&(r={},e[i]=r),r},this.delete=function(t){delete e[t.uuid]},this.clear=function(){e={}}},n.WebGLShader=function(){function e(e){for(var t=e.split(\"\\n\"),i=0;i<t.length;i++)t[i]=i+1+\": \"+t[i];return t.join(\"\\n\")}return function(t,i,r){var n=t.createShader(i);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)===!1&&console.error(\"THREE.WebGLShader: Shader couldn't compile.\"),\"\"!==t.getShaderInfoLog(n)&&console.warn(\"THREE.WebGLShader: gl.getShaderInfoLog()\",i===t.VERTEX_SHADER?\"vertex\":\"fragment\",t.getShaderInfoLog(n),e(r)),n}}(),n.WebGLShadowMap=function(e,t,i){function r(t,i,r,a){var o=t.geometry,s=null,c=y,u=t.customDepthMaterial;if(r&&(c=M,u=t.customDistanceMaterial),u)s=u;else{var l=void 0!==o.morphTargets&&o.morphTargets.length>0&&i.morphTargets,h=t instanceof n.SkinnedMesh&&i.skinning,d=0;l&&(d|=m),h&&(d|=g),s=c[d]}if(e.localClippingEnabled&&i.clipShadows===!0&&0!==i.clippingPlanes.length){var p=s.uuid,f=i.uuid,v=A[p];void 0===v&&(v={},A[p]=v);var x=v[f];void 0===x&&(x=s.clone(),v[f]=x),s=x}return s.visible=i.visible,s.wireframe=i.wireframe,s.side=i.side,s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,r&&void 0!==s.uniforms.lightPos&&s.uniforms.lightPos.value.copy(a),s}function a(e,t,i){if(e.visible!==!1){if(e.layers.test(t.layers)&&(e instanceof n.Mesh||e instanceof n.Line||e instanceof n.Points)&&e.castShadow&&(e.frustumCulled===!1||c.intersectsObject(e)===!0)){var r=e.material;r.visible===!0&&(e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),f.push(e))}for(var o=e.children,s=0,u=o.length;u>s;s++)a(o[s],t,i)}}var o=e.context,s=e.state,c=new n.Frustum,u=new n.Matrix4,l=t.shadows,h=new n.Vector2,d=new n.Vector3,p=new n.Vector3,f=[],m=1,g=2,v=(m|g)+1,y=new Array(v),M=new Array(v),A={},x=[new n.Vector3(1,0,0),new n.Vector3(-1,0,0),new n.Vector3(0,0,1),new n.Vector3(0,0,-1),new n.Vector3(0,1,0),new n.Vector3(0,-1,0)],w=[new n.Vector3(0,1,0),new n.Vector3(0,1,0),new n.Vector3(0,1,0),new n.Vector3(0,1,0),new n.Vector3(0,0,1),new n.Vector3(0,0,-1)],E=[new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4],b=new n.MeshDepthMaterial;b.depthPacking=n.RGBADepthPacking,b.clipping=!0;for(var T=n.ShaderLib.distanceRGBA,L=n.UniformsUtils.clone(T.uniforms),N=0;N!==v;++N){var D=0!==(N&m),S=0!==(N&g),C=b.clone();C.morphTargets=D,C.skinning=S,y[N]=C;var I=new n.ShaderMaterial({defines:{USE_SHADOWMAP:\"\"},uniforms:L,vertexShader:T.vertexShader,fragmentShader:T.fragmentShader,morphTargets:D,skinning:S,clipping:!0});M[N]=I}var j=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=n.PCFShadowMap,this.cullFace=n.CullFaceFront,this.render=function(t,m){if(j.enabled!==!1&&(j.autoUpdate!==!1||j.needsUpdate!==!1)&&0!==l.length){s.clearColor(1,1,1,1),s.disable(o.BLEND),s.enable(o.CULL_FACE),o.frontFace(o.CCW),o.cullFace(j.cullFace===n.CullFaceFront?o.FRONT:o.BACK),s.setDepthTest(!0),s.setScissorTest(!1);for(var g,v,y=0,M=l.length;M>y;y++){var A=l[y],b=A.shadow,T=b.camera;if(h.copy(b.mapSize),A instanceof n.PointLight){g=6,v=!0;var L=h.x,N=h.y;E[0].set(2*L,N,L,N),E[1].set(0,N,L,N),E[2].set(3*L,N,L,N),E[3].set(L,N,L,N),E[4].set(3*L,0,L,N),E[5].set(L,0,L,N),h.x*=4,h.y*=2}else g=1,v=!1;if(null===b.map){var D={minFilter:n.NearestFilter,magFilter:n.NearestFilter,format:n.RGBAFormat};b.map=new n.WebGLRenderTarget(h.x,h.y,D),T.updateProjectionMatrix()}b instanceof n.SpotLightShadow&&b.update(A);var S=b.map,C=b.matrix;p.setFromMatrixPosition(A.matrixWorld),T.position.copy(p),e.setRenderTarget(S),e.clear();for(var I=0;g>I;I++){if(v){d.copy(T.position),d.add(x[I]),T.up.copy(w[I]),T.lookAt(d);var _=E[I];s.viewport(_)}else d.setFromMatrixPosition(A.target.matrixWorld),T.lookAt(d);T.updateMatrixWorld(),T.matrixWorldInverse.getInverse(T.matrixWorld),C.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),C.multiply(T.projectionMatrix),C.multiply(T.matrixWorldInverse),u.multiplyMatrices(T.projectionMatrix,T.matrixWorldInverse),c.setFromMatrix(u),f.length=0,a(t,m,T);for(var O=0,z=f.length;z>O;O++){var k=f[O],R=i.update(k),B=k.material;if(B instanceof n.MultiMaterial)for(var U=R.groups,P=B.materials,F=0,G=U.length;G>F;F++){var V=U[F],Q=P[V.materialIndex];if(Q.visible===!0){var Y=r(k,Q,v,p);e.renderBufferDirect(T,null,R,Y,k,V)}}else{var Y=r(k,B,v,p);e.renderBufferDirect(T,null,R,Y,k,null)}}}}var H=e.getClearColor(),W=e.getClearAlpha();e.setClearColor(H,W),s.enable(o.BLEND),j.cullFace===n.CullFaceFront&&o.cullFace(o.BACK),j.needsUpdate=!1}}},n.WebGLState=function(e,t,i){var r=this,a=new n.Vector4,o=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=new Uint8Array(o),c=new Uint8Array(o),u=new Uint8Array(o),l={},h=null,d=null,p=null,f=null,m=null,g=null,v=null,y=null,M=!1,A=null,x=null,w=null,E=null,b=null,T=null,L=null,N=null,D=null,S=null,C=null,I=null,j=null,_=null,O=null,z=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),k=void 0,R={},B=new n.Vector4,U=null,P=null,F=new n.Vector4,G=new n.Vector4;this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),this.enable(e.CULL_FACE),this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var e=0,t=s.length;t>e;e++)s[e]=0},this.enableAttribute=function(i){if(s[i]=1,0===c[i]&&(e.enableVertexAttribArray(i),c[i]=1),0!==u[i]){var r=t.get(\"ANGLE_instanced_arrays\");r.vertexAttribDivisorANGLE(i,0),u[i]=0}},this.enableAttributeAndDivisor=function(t,i,r){s[t]=1,0===c[t]&&(e.enableVertexAttribArray(t),c[t]=1),u[t]!==i&&(r.vertexAttribDivisorANGLE(t,i),u[t]=i)},this.disableUnusedAttributes=function(){for(var t=0,i=c.length;i>t;t++)c[t]!==s[t]&&(e.disableVertexAttribArray(t),c[t]=0)},this.enable=function(t){l[t]!==!0&&(e.enable(t),l[t]=!0)},this.disable=function(t){l[t]!==!1&&(e.disable(t),l[t]=!1)},this.getCompressedTextureFormats=function(){if(null===h&&(h=[],t.get(\"WEBGL_compressed_texture_pvrtc\")||t.get(\"WEBGL_compressed_texture_s3tc\")||t.get(\"WEBGL_compressed_texture_etc1\")))for(var i=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<i.length;r++)h.push(i[r]);return h},this.setBlending=function(t,r,a,o,s,c,u,l){t===n.NoBlending?this.disable(e.BLEND):this.enable(e.BLEND),(t!==d||l!==M)&&(t===n.AdditiveBlending?l?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===n.SubtractiveBlending?l?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===n.MultiplyBlending?l?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.SRC_COLOR,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):l?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),d=t,M=l),t===n.CustomBlending?(s=s||r,c=c||a,u=u||o,(r!==p||s!==g)&&(e.blendEquationSeparate(i(r),i(s)),p=r,g=s),(a!==f||o!==m||c!==v||u!==y)&&(e.blendFuncSeparate(i(a),i(o),i(c),i(u)),f=a,m=o,v=c,y=u)):(p=null,f=null,m=null,g=null,v=null,y=null)},this.setDepthFunc=function(t){if(A!==t){if(t)switch(t){case n.NeverDepth:e.depthFunc(e.NEVER);break;case n.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case n.LessDepth:e.depthFunc(e.LESS);break;case n.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case n.EqualDepth:e.depthFunc(e.EQUAL);break;case n.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case n.GreaterDepth:e.depthFunc(e.GREATER);break;case n.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);A=t}},this.setDepthTest=function(t){t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)},this.setDepthWrite=function(t){x!==t&&(e.depthMask(t),x=t)\n},this.setColorWrite=function(t){w!==t&&(e.colorMask(t,t,t,t),w=t)},this.setStencilFunc=function(t,i,r){(b!==t||T!==i||L!==r)&&(e.stencilFunc(t,i,r),b=t,T=i,L=r)},this.setStencilOp=function(t,i,r){(N!==t||D!==i||S!==r)&&(e.stencilOp(t,i,r),N=t,D=i,S=r)},this.setStencilTest=function(t){t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)},this.setStencilWrite=function(t){E!==t&&(e.stencilMask(t),E=t)},this.setFlipSided=function(t){C!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),C=t)},this.setLineWidth=function(t){t!==I&&(e.lineWidth(t),I=t)},this.setPolygonOffset=function(t,i,r){t?this.enable(e.POLYGON_OFFSET_FILL):this.disable(e.POLYGON_OFFSET_FILL),!t||j===i&&_===r||(e.polygonOffset(i,r),j=i,_=r)},this.getScissorTest=function(){return O},this.setScissorTest=function(t){O=t,t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(t){void 0===t&&(t=e.TEXTURE0+z-1),k!==t&&(e.activeTexture(t),k=t)},this.bindTexture=function(t,i){void 0===k&&r.activeTexture();var n=R[k];void 0===n&&(n={type:void 0,texture:void 0},R[k]=n),(n.type!==t||n.texture!==i)&&(e.bindTexture(t,i),n.type=t,n.texture=i)},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.clearColor=function(t,i,r,n){a.set(t,i,r,n),B.equals(a)===!1&&(e.clearColor(t,i,r,n),B.copy(a))},this.clearDepth=function(t){U!==t&&(e.clearDepth(t),U=t)},this.clearStencil=function(t){P!==t&&(e.clearStencil(t),P=t)},this.scissor=function(t){F.equals(t)===!1&&(e.scissor(t.x,t.y,t.z,t.w),F.copy(t))},this.viewport=function(t){G.equals(t)===!1&&(e.viewport(t.x,t.y,t.z,t.w),G.copy(t))},this.reset=function(){for(var t=0;t<c.length;t++)1===c[t]&&(e.disableVertexAttribArray(t),c[t]=0);l={},h=null,k=void 0,R={},d=null,w=null,x=null,E=null,C=null}},n.WebGLUniforms=function(){var e=function(){this.seq=[],this.map={}},t=[],i=[],r=function(e,i,r){var n=e[0];if(0>=n||n>0)return e;var a=i*r,o=t[a];if(void 0===o&&(o=new Float32Array(a),t[a]=o),0!==i){n.toArray(o,0);for(var s=1,c=0;s!==i;++s)c+=r,e[s].toArray(o,c)}return o},n=function(e,t){var r=i[t];void 0===r&&(r=new Int32Array(t),i[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocTextureUnit();return r},a=function(e,t){e.uniform1f(this.addr,t)},o=function(e,t){e.uniform1i(this.addr,t)},s=function(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)},c=function(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)},u=function(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)},l=function(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)},h=function(e,t){e.uniformMatrix3fv(this.addr,!1,t.elements||t)},d=function(e,t){e.uniformMatrix4fv(this.addr,!1,t.elements||t)},p=function(e,t,i){var r=i.allocTextureUnit();e.uniform1i(this.addr,r),t&&i.setTexture2D(t,r)},f=function(e,t,i){var r=i.allocTextureUnit();e.uniform1i(this.addr,r),t&&i.setTextureCube(t,r)},m=function(e,t){e.uniform2iv(this.addr,t)},g=function(e,t){e.uniform3iv(this.addr,t)},v=function(e,t){e.uniform4iv(this.addr,t)},y=function(e){switch(e){case 5126:return a;case 35664:return s;case 35665:return c;case 35666:return u;case 35674:return l;case 35675:return h;case 35676:return d;case 35678:return p;case 35680:return f;case 5124:case 35670:return o;case 35667:case 35671:return m;case 35668:case 35672:return g;case 35669:case 35673:return v}},M=function(e,t){e.uniform1fv(this.addr,t)},A=function(e,t){e.uniform1iv(this.addr,t)},x=function(e,t){e.uniform2fv(this.addr,r(t,this.size,2))},w=function(e,t){e.uniform3fv(this.addr,r(t,this.size,3))},E=function(e,t){e.uniform4fv(this.addr,r(t,this.size,4))},b=function(e,t){e.uniformMatrix2fv(this.addr,!1,r(t,this.size,4))},T=function(e,t){e.uniformMatrix3fv(this.addr,!1,r(t,this.size,9))},L=function(e,t){e.uniformMatrix4fv(this.addr,!1,r(t,this.size,16))},N=function(e,t,i){var r=t.length,a=n(i,r);e.uniform1iv(this.addr,a);for(var o=0;o!==r;++o){var s=t[o];s&&i.setTexture2D(s,a[o])}},D=function(e,t,i){var r=t.length,a=n(i,r);e.uniform1iv(this.addr,a);for(var o=0;o!==r;++o){var s=t[o];s&&i.setTextureCube(s,a[o])}},S=function(e){switch(e){case 5126:return M;case 35664:return x;case 35665:return w;case 35666:return E;case 35674:return b;case 35675:return T;case 35676:return L;case 35678:return N;case 35680:return D;case 5124:case 35670:return A;case 35667:case 35671:return m;case 35668:case 35672:return g;case 35669:case 35673:return v}},C=function(e,t,i){this.id=e,this.addr=i,this.setValue=y(t.type)},I=function(e,t,i){this.id=e,this.addr=i,this.size=t.size,this.setValue=S(t.type)},j=function(t){this.id=t,e.call(this)};j.prototype.setValue=function(e,t){for(var i=this.seq,r=0,n=i.length;r!==n;++r){var a=i[r];a.setValue(e,t[a.id])}};var _=/([\\w\\d_]+)(\\])?(\\[|\\.)?/g,O=function(e,t){e.seq.push(t),e.map[t.id]=t},z=function(e,t,i){var r=e.name,n=r.length;for(_.lastIndex=0;;){var a=_.exec(r),o=_.lastIndex,s=a[1],c=\"]\"===a[2],u=a[3];if(c&&(s=0|s),void 0===u||\"[\"===u&&o+2===n){O(i,void 0===u?new C(s,e,t):new I(s,e,t));break}var l=i.map,h=l[s];void 0===h&&(h=new j(s),O(i,h)),i=h}},k=function(t,i,r){e.call(this),this.renderer=r;for(var n=t.getProgramParameter(i,t.ACTIVE_UNIFORMS),a=0;a!==n;++a){var o=t.getActiveUniform(i,a),s=o.name,c=t.getUniformLocation(i,s);z(o,c,this)}};return k.prototype.setValue=function(e,t,i){var r=this.map[t];void 0!==r&&r.setValue(e,i,this.renderer)},k.prototype.set=function(e,t,i){var r=this.map[i];void 0!==r&&r.setValue(e,t[i],this.renderer)},k.prototype.setOptional=function(e,t,i){var r=t[i];void 0!==r&&this.setValue(e,i,r)},k.upload=function(e,t,i,r){for(var n=0,a=t.length;n!==a;++n){var o=t[n],s=i[o.id];s.needsUpdate!==!1&&o.setValue(e,s.value,r)}},k.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var a=e[r];a.id in t&&i.push(a)}return i},k.splitDynamic=function(e,t){for(var i=null,r=e.length,n=0,a=0;a!==r;++a){var o=e[a],s=t[o.id];s&&s.dynamic===!0?(null===i&&(i=[]),i.push(o)):(a>n&&(e[n]=o),++n)}return r>n&&(e.length=n),i},k.evalDynamic=function(e,t,i,r){for(var n=0,a=e.length;n!==a;++n){var o=t[e[n].id],s=o.onUpdateCallback;void 0!==s&&s.call(o,i,r)}},k}(),n.LensFlarePlugin=function(e,t){function i(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);a=p.createBuffer(),o=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,a),p.bufferData(p.ARRAY_BUFFER,e,p.STATIC_DRAW),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),p.bufferData(p.ELEMENT_ARRAY_BUFFER,t,p.STATIC_DRAW),h=p.createTexture(),d=p.createTexture(),f.bindTexture(p.TEXTURE_2D,h),p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),f.bindTexture(p.TEXTURE_2D,d),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),s={vertexShader:[\"uniform lowp int renderType;\",\"uniform vec3 screenPosition;\",\"uniform vec2 scale;\",\"uniform float rotation;\",\"uniform sampler2D occlusionMap;\",\"attribute vec2 position;\",\"attribute vec2 uv;\",\"varying vec2 vUV;\",\"varying float vVisibility;\",\"void main() {\",\"vUV = uv;\",\"vec2 pos = position;\",\"if ( renderType == 2 ) {\",\"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\",\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\",\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\",\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\",\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\",\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\",\"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\",\"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\",\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\",\"vVisibility =        visibility.r / 9.0;\",\"vVisibility *= 1.0 - visibility.g / 9.0;\",\"vVisibility *=       visibility.b / 9.0;\",\"vVisibility *= 1.0 - visibility.a / 9.0;\",\"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\"}\",\"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\"}\"].join(\"\\n\"),fragmentShader:[\"uniform lowp int renderType;\",\"uniform sampler2D map;\",\"uniform float opacity;\",\"uniform vec3 color;\",\"varying vec2 vUV;\",\"varying float vVisibility;\",\"void main() {\",\"if ( renderType == 0 ) {\",\"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\",\"} else if ( renderType == 1 ) {\",\"gl_FragColor = texture2D( map, vUV );\",\"} else {\",\"vec4 texture = texture2D( map, vUV );\",\"texture.a *= opacity * vVisibility;\",\"gl_FragColor = texture;\",\"gl_FragColor.rgb *= color;\",\"}\",\"}\"].join(\"\\n\")},c=r(s),u={vertex:p.getAttribLocation(c,\"position\"),uv:p.getAttribLocation(c,\"uv\")},l={renderType:p.getUniformLocation(c,\"renderType\"),map:p.getUniformLocation(c,\"map\"),occlusionMap:p.getUniformLocation(c,\"occlusionMap\"),opacity:p.getUniformLocation(c,\"opacity\"),color:p.getUniformLocation(c,\"color\"),scale:p.getUniformLocation(c,\"scale\"),rotation:p.getUniformLocation(c,\"rotation\"),screenPosition:p.getUniformLocation(c,\"screenPosition\")}}function r(t){var i=p.createProgram(),r=p.createShader(p.FRAGMENT_SHADER),n=p.createShader(p.VERTEX_SHADER),a=\"precision \"+e.getPrecision()+\" float;\\n\";return p.shaderSource(r,a+t.fragmentShader),p.shaderSource(n,a+t.vertexShader),p.compileShader(r),p.compileShader(n),p.attachShader(i,r),p.attachShader(i,n),p.linkProgram(i),i}var a,o,s,c,u,l,h,d,p=e.context,f=e.state;this.render=function(r,s,m){if(0!==t.length){var g=new n.Vector3,v=m.w/m.z,y=.5*m.z,M=.5*m.w,A=16/m.w,x=new n.Vector2(A*v,A),w=new n.Vector3(1,1,0),E=new n.Vector2(1,1),b=new n.Box2;b.min.set(0,0),b.max.set(m.z-16,m.w-16),void 0===c&&i(),p.useProgram(c),f.initAttributes(),f.enableAttribute(u.vertex),f.enableAttribute(u.uv),f.disableUnusedAttributes(),p.uniform1i(l.occlusionMap,0),p.uniform1i(l.map,1),p.bindBuffer(p.ARRAY_BUFFER,a),p.vertexAttribPointer(u.vertex,2,p.FLOAT,!1,16,0),p.vertexAttribPointer(u.uv,2,p.FLOAT,!1,16,8),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),f.disable(p.CULL_FACE),f.setDepthWrite(!1);for(var T=0,L=t.length;L>T;T++){A=16/m.w,x.set(A*v,A);var N=t[T];if(g.set(N.matrixWorld.elements[12],N.matrixWorld.elements[13],N.matrixWorld.elements[14]),g.applyMatrix4(s.matrixWorldInverse),g.applyProjection(s.projectionMatrix),w.copy(g),E.x=m.x+w.x*y+y-8,E.y=m.y+w.y*M+M-8,b.containsPoint(E)===!0){f.activeTexture(p.TEXTURE0),f.bindTexture(p.TEXTURE_2D,null),f.activeTexture(p.TEXTURE1),f.bindTexture(p.TEXTURE_2D,h),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,E.x,E.y,16,16,0),p.uniform1i(l.renderType,0),p.uniform2f(l.scale,x.x,x.y),p.uniform3f(l.screenPosition,w.x,w.y,w.z),f.disable(p.BLEND),f.enable(p.DEPTH_TEST),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),f.activeTexture(p.TEXTURE0),f.bindTexture(p.TEXTURE_2D,d),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,E.x,E.y,16,16,0),p.uniform1i(l.renderType,1),f.disable(p.DEPTH_TEST),f.activeTexture(p.TEXTURE1),f.bindTexture(p.TEXTURE_2D,h),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),N.positionScreen.copy(w),N.customUpdateCallback?N.customUpdateCallback(N):N.updateLensFlares(),p.uniform1i(l.renderType,2),f.enable(p.BLEND);for(var D=0,S=N.lensFlares.length;S>D;D++){var C=N.lensFlares[D];C.opacity>.001&&C.scale>.001&&(w.x=C.x,w.y=C.y,w.z=C.z,A=C.size*C.scale/m.w,x.x=A*v,x.y=A,p.uniform3f(l.screenPosition,w.x,w.y,w.z),p.uniform2f(l.scale,x.x,x.y),p.uniform1f(l.rotation,C.rotation),p.uniform1f(l.opacity,C.opacity),p.uniform3f(l.color,C.color.r,C.color.g,C.color.b),f.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),e.setTexture2D(C.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}}f.enable(p.CULL_FACE),f.enable(p.DEPTH_TEST),f.setDepthWrite(!0),e.resetGLState()}}},n.SpritePlugin=function(e,t){function i(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);o=d.createBuffer(),s=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,o),d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),d.bufferData(d.ELEMENT_ARRAY_BUFFER,t,d.STATIC_DRAW),c=r(),u={position:d.getAttribLocation(c,\"position\"),uv:d.getAttribLocation(c,\"uv\")},l={uvOffset:d.getUniformLocation(c,\"uvOffset\"),uvScale:d.getUniformLocation(c,\"uvScale\"),rotation:d.getUniformLocation(c,\"rotation\"),scale:d.getUniformLocation(c,\"scale\"),color:d.getUniformLocation(c,\"color\"),map:d.getUniformLocation(c,\"map\"),opacity:d.getUniformLocation(c,\"opacity\"),modelViewMatrix:d.getUniformLocation(c,\"modelViewMatrix\"),projectionMatrix:d.getUniformLocation(c,\"projectionMatrix\"),fogType:d.getUniformLocation(c,\"fogType\"),fogDensity:d.getUniformLocation(c,\"fogDensity\"),fogNear:d.getUniformLocation(c,\"fogNear\"),fogFar:d.getUniformLocation(c,\"fogFar\"),fogColor:d.getUniformLocation(c,\"fogColor\"),alphaTest:d.getUniformLocation(c,\"alphaTest\")};var i=document.createElement(\"canvas\");i.width=8,i.height=8;var a=i.getContext(\"2d\");a.fillStyle=\"white\",a.fillRect(0,0,8,8),h=new n.Texture(i),h.needsUpdate=!0}function r(){var t=d.createProgram(),i=d.createShader(d.VERTEX_SHADER),r=d.createShader(d.FRAGMENT_SHADER);return d.shaderSource(i,[\"precision \"+e.getPrecision()+\" float;\",\"uniform mat4 modelViewMatrix;\",\"uniform mat4 projectionMatrix;\",\"uniform float rotation;\",\"uniform vec2 scale;\",\"uniform vec2 uvOffset;\",\"uniform vec2 uvScale;\",\"attribute vec2 position;\",\"attribute vec2 uv;\",\"varying vec2 vUV;\",\"void main() {\",\"vUV = uvOffset + uv * uvScale;\",\"vec2 alignedPosition = position * scale;\",\"vec2 rotatedPosition;\",\"rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\",\"rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\",\"vec4 finalPosition;\",\"finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\",\"finalPosition.xy += rotatedPosition;\",\"finalPosition = projectionMatrix * finalPosition;\",\"gl_Position = finalPosition;\",\"}\"].join(\"\\n\")),d.shaderSource(r,[\"precision \"+e.getPrecision()+\" float;\",\"uniform vec3 color;\",\"uniform sampler2D map;\",\"uniform float opacity;\",\"uniform int fogType;\",\"uniform vec3 fogColor;\",\"uniform float fogDensity;\",\"uniform float fogNear;\",\"uniform float fogFar;\",\"uniform float alphaTest;\",\"varying vec2 vUV;\",\"void main() {\",\"vec4 texture = texture2D( map, vUV );\",\"if ( texture.a < alphaTest ) discard;\",\"gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\",\"if ( fogType > 0 ) {\",\"float depth = gl_FragCoord.z / gl_FragCoord.w;\",\"float fogFactor = 0.0;\",\"if ( fogType == 1 ) {\",\"fogFactor = smoothstep( fogNear, fogFar, depth );\",\"} else {\",\"const float LOG2 = 1.442695;\",\"fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\",\"fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\",\"}\",\"gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\",\"}\",\"}\"].join(\"\\n\")),d.compileShader(i),d.compileShader(r),d.attachShader(t,i),d.attachShader(t,r),d.linkProgram(t),t}function a(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}var o,s,c,u,l,h,d=e.context,p=e.state,f=new n.Vector3,m=new n.Quaternion,g=new n.Vector3;this.render=function(r,v){if(0!==t.length){void 0===c&&i(),d.useProgram(c),p.initAttributes(),p.enableAttribute(u.position),p.enableAttribute(u.uv),p.disableUnusedAttributes(),p.disable(d.CULL_FACE),p.enable(d.BLEND),d.bindBuffer(d.ARRAY_BUFFER,o),d.vertexAttribPointer(u.position,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(u.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),d.uniformMatrix4fv(l.projectionMatrix,!1,v.projectionMatrix.elements),p.activeTexture(d.TEXTURE0),d.uniform1i(l.map,0);var y=0,M=0,A=r.fog;A?(d.uniform3f(l.fogColor,A.color.r,A.color.g,A.color.b),A instanceof n.Fog?(d.uniform1f(l.fogNear,A.near),d.uniform1f(l.fogFar,A.far),d.uniform1i(l.fogType,1),y=1,M=1):A instanceof n.FogExp2&&(d.uniform1f(l.fogDensity,A.density),d.uniform1i(l.fogType,2),y=2,M=2)):(d.uniform1i(l.fogType,0),y=0,M=0);for(var x=0,w=t.length;w>x;x++){var E=t[x];E.modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,E.matrixWorld),E.z=-E.modelViewMatrix.elements[14]}t.sort(a);for(var b=[],x=0,w=t.length;w>x;x++){var E=t[x],T=E.material;d.uniform1f(l.alphaTest,T.alphaTest),d.uniformMatrix4fv(l.modelViewMatrix,!1,E.modelViewMatrix.elements),E.matrixWorld.decompose(f,m,g),b[0]=g.x,b[1]=g.y;var L=0;r.fog&&T.fog&&(L=M),y!==L&&(d.uniform1i(l.fogType,L),y=L),null!==T.map?(d.uniform2f(l.uvOffset,T.map.offset.x,T.map.offset.y),d.uniform2f(l.uvScale,T.map.repeat.x,T.map.repeat.y)):(d.uniform2f(l.uvOffset,0,0),d.uniform2f(l.uvScale,1,1)),d.uniform1f(l.opacity,T.opacity),d.uniform3f(l.color,T.color.r,T.color.g,T.color.b),d.uniform1f(l.rotation,T.rotation),d.uniform2fv(l.scale,b),p.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),p.setDepthTest(T.depthTest),p.setDepthWrite(T.depthWrite),T.map?e.setTexture2D(T.map,0):e.setTexture2D(h,0),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}p.enable(d.CULL_FACE),e.resetGLState()}}},Object.defineProperties(n.Box2.prototype,{empty:{value:function(){return console.warn(\"THREE.Box2: .empty() has been renamed to .isEmpty().\"),this.isEmpty()}},isIntersectionBox:{value:function(e){return console.warn(\"THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)}}}),Object.defineProperties(n.Box3.prototype,{empty:{value:function(){return console.warn(\"THREE.Box3: .empty() has been renamed to .isEmpty().\"),this.isEmpty()}},isIntersectionBox:{value:function(e){return console.warn(\"THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)}},isIntersectionSphere:{value:function(e){return console.warn(\"THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().\"),this.intersectsSphere(e)}}}),Object.defineProperties(n.Matrix3.prototype,{multiplyVector3:{value:function(e){return console.warn(\"THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.\"),e.applyMatrix3(this)}},multiplyVector3Array:{value:function(e){return console.warn(\"THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.\"),this.applyToVector3Array(e)}}}),Object.defineProperties(n.Matrix4.prototype,{extractPosition:{value:function(e){return console.warn(\"THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().\"),this.copyPosition(e)}},setRotationFromQuaternion:{value:function(e){return console.warn(\"THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().\"),this.makeRotationFromQuaternion(e)}},multiplyVector3:{value:function(e){return console.warn(\"THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.\"),e.applyProjection(this)}},multiplyVector4:{value:function(e){return console.warn(\"THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)}},multiplyVector3Array:{value:function(e){return console.warn(\"THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.\"),this.applyToVector3Array(e)}},rotateAxis:{value:function(e){console.warn(\"THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.\"),e.transformDirection(this)}},crossVector:{value:function(e){return console.warn(\"THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)}},translate:{value:function(){console.error(\"THREE.Matrix4: .translate() has been removed.\")}},rotateX:{value:function(){console.error(\"THREE.Matrix4: .rotateX() has been removed.\")}},rotateY:{value:function(){console.error(\"THREE.Matrix4: .rotateY() has been removed.\")}},rotateZ:{value:function(){console.error(\"THREE.Matrix4: .rotateZ() has been removed.\")}},rotateByAxis:{value:function(){console.error(\"THREE.Matrix4: .rotateByAxis() has been removed.\")}}}),Object.defineProperties(n.Plane.prototype,{isIntersectionLine:{value:function(e){return console.warn(\"THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().\"),this.intersectsLine(e)}}}),Object.defineProperties(n.Quaternion.prototype,{multiplyVector3:{value:function(e){return console.warn(\"THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.\"),e.applyQuaternion(this)}}}),Object.defineProperties(n.Ray.prototype,{isIntersectionBox:{value:function(e){return console.warn(\"THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)}},isIntersectionPlane:{value:function(e){return console.warn(\"THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().\"),this.intersectsPlane(e)}},isIntersectionSphere:{value:function(e){return console.warn(\"THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().\"),this.intersectsSphere(e)}}}),Object.defineProperties(n.Vector3.prototype,{setEulerFromRotationMatrix:{value:function(){console.error(\"THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.\")}},setEulerFromQuaternion:{value:function(){console.error(\"THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.\")}},getPositionFromMatrix:{value:function(e){return console.warn(\"THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().\"),this.setFromMatrixPosition(e)}},getScaleFromMatrix:{value:function(e){return console.warn(\"THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().\"),this.setFromMatrixScale(e)}},getColumnFromMatrix:{value:function(e,t){return console.warn(\"THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().\"),this.setFromMatrixColumn(e,t)}}}),n.Face4=function(e,t,i,r,a,o,s){return console.warn(\"THREE.Face4 has been removed. A THREE.Face3 will be created instead.\"),new n.Face3(e,t,i,a,o,s)},n.Vertex=function(e,t,i){return console.warn(\"THREE.Vertex has been removed. Use THREE.Vector3 instead.\"),new n.Vector3(e,t,i)},Object.defineProperties(n.Object3D.prototype,{eulerOrder:{get:function(){return console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\"),this.rotation.order},set:function(e){console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\"),this.rotation.order=e}},getChildByName:{value:function(e){return console.warn(\"THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().\"),this.getObjectByName(e)}},renderDepth:{set:function(){console.warn(\"THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.\")}},translate:{value:function(e,t){return console.warn(\"THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.\"),this.translateOnAxis(t,e)}},useQuaternion:{get:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")},set:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")}}}),Object.defineProperties(n,{PointCloud:{value:function(e,t){return console.warn(\"THREE.PointCloud has been renamed to THREE.Points.\"),new n.Points(e,t)}},ParticleSystem:{value:function(e,t){return console.warn(\"THREE.ParticleSystem has been renamed to THREE.Points.\"),new n.Points(e,t)}}}),Object.defineProperties(n.Light.prototype,{onlyShadow:{set:function(){console.warn(\"THREE.Light: .onlyShadow has been removed.\")}},shadowCameraFov:{set:function(e){console.warn(\"THREE.Light: .shadowCameraFov is now .shadow.camera.fov.\"),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn(\"THREE.Light: .shadowCameraLeft is now .shadow.camera.left.\"),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn(\"THREE.Light: .shadowCameraRight is now .shadow.camera.right.\"),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn(\"THREE.Light: .shadowCameraTop is now .shadow.camera.top.\"),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn(\"THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.\"),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn(\"THREE.Light: .shadowCameraNear is now .shadow.camera.near.\"),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn(\"THREE.Light: .shadowCameraFar is now .shadow.camera.far.\"),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn(\"THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.\")}},shadowBias:{set:function(e){console.warn(\"THREE.Light: .shadowBias is now .shadow.bias.\"),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn(\"THREE.Light: .shadowDarkness has been removed.\")}},shadowMapWidth:{set:function(e){console.warn(\"THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.\"),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn(\"THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.\"),this.shadow.mapSize.height=e}}}),Object.defineProperties(n.BufferAttribute.prototype,{length:{get:function(){return console.warn(\"THREE.BufferAttribute: .length has been deprecated. Please use .count.\"),this.array.length}}}),Object.defineProperties(n.BufferGeometry.prototype,{drawcalls:{get:function(){return console.error(\"THREE.BufferGeometry: .drawcalls has been renamed to .groups.\"),this.groups}},offsets:{get:function(){return console.warn(\"THREE.BufferGeometry: .offsets has been renamed to .groups.\"),this.groups}},addIndex:{value:function(e){console.warn(\"THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().\"),this.setIndex(e)}},addDrawCall:{value:function(e,t,i){void 0!==i&&console.warn(\"THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.\"),console.warn(\"THREE.BufferGeometry: .addDrawCall() is now .addGroup().\"),this.addGroup(e,t)}},clearDrawCalls:{value:function(){console.warn(\"THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().\"),this.clearGroups()}},computeTangents:{value:function(){console.warn(\"THREE.BufferGeometry: .computeTangents() has been removed.\")}},computeOffsets:{value:function(){console.warn(\"THREE.BufferGeometry: .computeOffsets() has been removed.\")}}}),Object.defineProperties(n.Material.prototype,{wrapAround:{get:function(){console.warn(\"THREE.\"+this.type+\": .wrapAround has been removed.\")},set:function(){console.warn(\"THREE.\"+this.type+\": .wrapAround has been removed.\")}},wrapRGB:{get:function(){return console.warn(\"THREE.\"+this.type+\": .wrapRGB has been removed.\"),new n.Color}}}),Object.defineProperties(n,{PointCloudMaterial:{value:function(e){return console.warn(\"THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.\"),new n.PointsMaterial(e)}},ParticleBasicMaterial:{value:function(e){return console.warn(\"THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.\"),new n.PointsMaterial(e)}},ParticleSystemMaterial:{value:function(e){return console.warn(\"THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.\"),new n.PointsMaterial(e)}}}),Object.defineProperties(n.MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn(\"THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.\"),!1},set:function(){console.warn(\"THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead\")}}}),Object.defineProperties(n.ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn(\"THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\"),this.extensions.derivatives},set:function(e){console.warn(\"THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\"),this.extensions.derivatives=e}}}),Object.defineProperties(n.WebGLRenderer.prototype,{supportsFloatTextures:{value:function(){return console.warn(\"THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).\"),this.extensions.get(\"OES_texture_float\")}},supportsHalfFloatTextures:{value:function(){return console.warn(\"THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).\"),this.extensions.get(\"OES_texture_half_float\")}},supportsStandardDerivatives:{value:function(){return console.warn(\"THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).\"),this.extensions.get(\"OES_standard_derivatives\")}},supportsCompressedTextureS3TC:{value:function(){return console.warn(\"THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).\"),this.extensions.get(\"WEBGL_compressed_texture_s3tc\")}},supportsCompressedTexturePVRTC:{value:function(){return console.warn(\"THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).\"),this.extensions.get(\"WEBGL_compressed_texture_pvrtc\")}},supportsBlendMinMax:{value:function(){return console.warn(\"THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).\"),this.extensions.get(\"EXT_blend_minmax\")}},supportsVertexTextures:{value:function(){return this.capabilities.vertexTextures}},supportsInstancedArrays:{value:function(){return console.warn(\"THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).\"),this.extensions.get(\"ANGLE_instanced_arrays\")}},enableScissorTest:{value:function(e){console.warn(\"THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().\"),this.setScissorTest(e)}},initMaterial:{value:function(){console.warn(\"THREE.WebGLRenderer: .initMaterial() has been removed.\")}},addPrePlugin:{value:function(){console.warn(\"THREE.WebGLRenderer: .addPrePlugin() has been removed.\")}},addPostPlugin:{value:function(){console.warn(\"THREE.WebGLRenderer: .addPostPlugin() has been removed.\")}},updateShadowMap:{value:function(){console.warn(\"THREE.WebGLRenderer: .updateShadowMap() has been removed.\")}},shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.\"),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.\"),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.\"),this.shadowMap.cullFace=e}}}),Object.defineProperties(n.WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\"),this.texture.wrapS},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\"),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\"),this.texture.wrapT},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\"),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\"),this.texture.magFilter},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\"),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\"),this.texture.minFilter\n},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\"),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\"),this.texture.anisotropy},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\"),this.texture.anisotropy=e}},offset:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\"),this.texture.offset},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\"),this.texture.offset=e}},repeat:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\"),this.texture.repeat},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\"),this.texture.repeat=e}},format:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\"),this.texture.format},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\"),this.texture.format=e}},type:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\"),this.texture.type},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\"),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\"),this.texture.generateMipmaps},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\"),this.texture.generateMipmaps=e}}}),Object.defineProperties(n.Audio.prototype,{load:{value:function(e){console.warn(\"THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.\");var t=this,i=new n.AudioLoader;return i.load(e,function(e){t.setBuffer(e)}),this}}}),n.GeometryUtils={merge:function(e,t,i){console.warn(\"THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.\");var r;t instanceof n.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return console.warn(\"THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.\"),e.center()}},n.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,i,r){console.warn(\"THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.\");var a=new n.TextureLoader;a.setCrossOrigin(this.crossOrigin);var o=a.load(e,i,void 0,r);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,i,r){console.warn(\"THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.\");var a=new n.CubeTextureLoader;a.setCrossOrigin(this.crossOrigin);var o=a.load(e,i,void 0,r);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error(\"THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.\")},loadCompressedTextureCube:function(){console.error(\"THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.\")}},n.Projector=function(){console.error(\"THREE.Projector has been moved to /examples/js/renderers/Projector.js.\"),this.projectVector=function(e,t){console.warn(\"THREE.Projector: .projectVector() is now vector.project().\"),e.project(t)},this.unprojectVector=function(e,t){console.warn(\"THREE.Projector: .unprojectVector() is now vector.unproject().\"),e.unproject(t)},this.pickingRay=function(){console.error(\"THREE.Projector: .pickingRay() is now raycaster.setFromCamera().\")}},n.CanvasRenderer=function(){console.error(\"THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js\"),this.domElement=document.createElement(\"canvas\"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},n.MeshFaceMaterial=n.MultiMaterial,Object.defineProperties(n.LOD.prototype,{objects:{get:function(){return console.warn(\"THREE.LOD: .objects has been renamed to .levels.\"),this.levels}}}),n.CurveUtils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e){var t=6*e*e-6*e,i=3*e*e-4*e+1,r=-6*e*e+6*e,n=3*e*e-2*e;return t+i+r+n},interpolate:function(e,t,i,r,n){var a=.5*(i-e),o=.5*(r-t),s=n*n,c=n*s;return(2*t-2*i+a+o)*c+(-3*t+3*i-2*a-o)*s+a*n+t}},n.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new n.Group,r=0,a=t.length;a>r;r++)i.add(new n.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var r=new n.Matrix4;r.getInverse(i.matrixWorld),e.applyMatrix(r),t.remove(e),i.add(e)}},n.ShapeUtils={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;t>n;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},triangulate:function(){function e(e,t,i,r,n,a){var o,s,c,u,l,h,d,p,f;if(s=e[a[t]].x,c=e[a[t]].y,u=e[a[i]].x,l=e[a[i]].y,h=e[a[r]].x,d=e[a[r]].y,Number.EPSILON>(u-s)*(d-c)-(l-c)*(h-s))return!1;var m,g,v,y,M,A,x,w,E,b,T,L,N,D,S;for(m=h-u,g=d-l,v=s-h,y=c-d,M=u-s,A=l-c,o=0;n>o;o++)if(p=e[a[o]].x,f=e[a[o]].y,!(p===s&&f===c||p===u&&f===l||p===h&&f===d)&&(x=p-s,w=f-c,E=p-u,b=f-l,T=p-h,L=f-d,S=m*b-g*E,N=M*w-A*x,D=v*L-y*T,S>=-Number.EPSILON&&D>=-Number.EPSILON&&N>=-Number.EPSILON))return!1;return!0}return function(t,i){var r=t.length;if(3>r)return null;var a,o,s,c=[],u=[],l=[];if(n.ShapeUtils.area(t)>0)for(o=0;r>o;o++)u[o]=o;else for(o=0;r>o;o++)u[o]=r-1-o;var h=r,d=2*h;for(o=h-1;h>2;){if(d--<=0)return console.warn(\"THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()\"),i?l:c;if(a=o,a>=h&&(a=0),o=a+1,o>=h&&(o=0),s=o+1,s>=h&&(s=0),e(t,a,o,s,h,u)){var p,f,m,g,v;for(p=u[a],f=u[o],m=u[s],c.push([t[p],t[f],t[m]]),l.push([u[a],u[o],u[s]]),g=o,v=o+1;h>v;g++,v++)u[g]=u[v];h--,d=2*h}}return i?l:c}}(),triangulateShape:function(e,t){function i(e,t,i){return e.x!==t.x?e.x<t.x?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:e.y<t.y?e.y<=i.y&&i.y<=t.y:t.y<=i.y&&i.y<=e.y}function r(e,t,r,n,a){var o=t.x-e.x,s=t.y-e.y,c=n.x-r.x,u=n.y-r.y,l=e.x-r.x,h=e.y-r.y,d=s*c-o*u,p=s*l-o*h;if(Math.abs(d)>Number.EPSILON){var f;if(d>0){if(0>p||p>d)return[];if(f=u*l-c*h,0>f||f>d)return[]}else{if(p>0||d>p)return[];if(f=u*l-c*h,f>0||d>f)return[]}if(0===f)return!a||0!==p&&p!==d?[e]:[];if(f===d)return!a||0!==p&&p!==d?[t]:[];if(0===p)return[r];if(p===d)return[n];var m=f/d;return[{x:e.x+m*o,y:e.y+m*s}]}if(0!==p||u*l!==c*h)return[];var g=0===o&&0===s,v=0===c&&0===u;if(g&&v)return e.x!==r.x||e.y!==r.y?[]:[e];if(g)return i(r,n,e)?[e]:[];if(v)return i(e,t,r)?[r]:[];var y,M,A,x,w,E,b,T;return 0!==o?(e.x<t.x?(y=e,A=e.x,M=t,x=t.x):(y=t,A=t.x,M=e,x=e.x),r.x<n.x?(w=r,b=r.x,E=n,T=n.x):(w=n,b=n.x,E=r,T=r.x)):(e.y<t.y?(y=e,A=e.y,M=t,x=t.y):(y=t,A=t.y,M=e,x=e.y),r.y<n.y?(w=r,b=r.y,E=n,T=n.y):(w=n,b=n.y,E=r,T=r.y)),b>=A?b>x?[]:x===b?a?[]:[w]:T>=x?[w,M]:[w,E]:A>T?[]:A===T?a?[]:[y]:T>=x?[y,M]:[y,E]}function a(e,t,i,r){var n=t.x-e.x,a=t.y-e.y,o=i.x-e.x,s=i.y-e.y,c=r.x-e.x,u=r.y-e.y,l=n*s-a*o,h=n*u-a*c;if(Math.abs(l)>Number.EPSILON){var d=c*s-u*o;return l>0?h>=0&&d>=0:h>=0||d>=0}return h>0}function o(e,t){function i(e,t){var i=y.length-1,r=e-1;0>r&&(r=i);var n=e+1;n>i&&(n=0);var o=a(y[e],y[r],y[n],s[t]);if(!o)return!1;var c=s.length-1,u=t-1;0>u&&(u=c);var l=t+1;return l>c&&(l=0),o=a(s[t],s[u],s[l],y[e]),o?!0:!1}function n(e,t){var i,n,a;for(i=0;i<y.length;i++)if(n=i+1,n%=y.length,a=r(e,t,y[i],y[n],!0),a.length>0)return!0;return!1}function o(e,i){var n,a,o,s,c;for(n=0;n<M.length;n++)for(a=t[M[n]],o=0;o<a.length;o++)if(s=o+1,s%=a.length,c=r(e,i,a[o],a[s],!0),c.length>0)return!0;return!1}for(var s,c,u,l,h,d,p,f,m,g,v,y=e.concat(),M=[],A=[],x=0,w=t.length;w>x;x++)M.push(x);for(var E=0,b=2*M.length;M.length>0;){if(b--,0>b){console.log(\"Infinite Loop! Holes left:\"+M.length+\", Probably Hole outside Shape!\");break}for(u=E;u<y.length;u++){l=y[u],c=-1;for(var x=0;x<M.length;x++)if(d=M[x],p=l.x+\":\"+l.y+\":\"+d,void 0===A[p]){s=t[d];for(var T=0;T<s.length;T++)if(h=s[T],i(u,T)&&!n(l,h)&&!o(l,h)){c=T,M.splice(x,1),f=y.slice(0,u+1),m=y.slice(u),g=s.slice(c),v=s.slice(0,c+1),y=f.concat(g).concat(v).concat(m),E=u;break}if(c>=0)break;A[p]=!0}if(c>=0)break}}return y}for(var s,c,u,l,h,d,p={},f=e.concat(),m=0,g=t.length;g>m;m++)Array.prototype.push.apply(f,t[m]);for(s=0,c=f.length;c>s;s++)h=f[s].x+\":\"+f[s].y,void 0!==p[h]&&console.warn(\"THREE.Shape: Duplicate point\",h),p[h]=s;var v=o(e,t),y=n.ShapeUtils.triangulate(v,!1);for(s=0,c=y.length;c>s;s++)for(l=y[s],u=0;3>u;u++)h=l[u].x+\":\"+l[u].y,d=p[h],void 0!==d&&(l[u]=d);return y.concat()},isClockWise:function(e){return n.ShapeUtils.area(e)<0},b2:function(){function e(e,t){var i=1-e;return i*i*t}function t(e,t){return 2*(1-e)*e*t}function i(e,t){return e*e*t}return function(r,n,a,o){return e(r,n)+t(r,a)+i(r,o)}}(),b3:function(){function e(e,t){var i=1-e;return i*i*i*t}function t(e,t){var i=1-e;return 3*i*i*e*t}function i(e,t){var i=1-e;return 3*i*e*e*t}function r(e,t){return e*e*e*t}return function(n,a,o,s,c){return e(n,a)+t(n,o)+i(n,s)+r(n,c)}}()},n.Curve=function(){},n.Curve.prototype={constructor:n.Curve,getPoint:function(){return console.warn(\"THREE.Curve: Warning, getPoint() not implemented!\"),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},getSpacedPoints:function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),a=0;for(r.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),a+=t.distanceTo(n),r.push(a),n=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,a=r.length;i=t?t:e*r[a-1];for(var o,s=0,c=a-1;c>=s;)if(n=Math.floor(s+(c-s)/2),o=r[n]-i,0>o)s=n+1;else{if(!(o>0)){c=n;break}c=n-1}if(n=c,r[n]===i){var u=n/(a-1);return u}var l=r[n],h=r[n+1],d=h-l,p=(i-l)/d,u=(n+p)/(a-1);return u},getTangent:function(e){var t=1e-4,i=e-t,r=e+t;0>i&&(i=0),r>1&&(r=1);var n=this.getPoint(i),a=this.getPoint(r),o=a.clone().sub(n);return o.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)}},n.Curve.create=function(e,t){return e.prototype=Object.create(n.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},n.CurvePath=function(){this.curves=[],this.autoClose=!1},n.CurvePath.prototype=Object.create(n.Curve.prototype),n.CurvePath.prototype.constructor=n.CurvePath,n.CurvePath.prototype.add=function(e){this.curves.push(e)},n.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new n.LineCurve(t,e))},n.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=t){var n=i[r]-t,a=this.curves[r],o=1-n/a.getLength();return a.getPointAt(o)}r++}return null},n.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},n.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;r>i;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},n.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e);return this.createGeometry(t)},n.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e);return this.createGeometry(t)},n.CurvePath.prototype.createGeometry=function(e){for(var t=new n.Geometry,i=0,r=e.length;r>i;i++){var a=e[i];t.vertices.push(new n.Vector3(a.x,a.y,a.z||0))}return t},n.Font=function(e){this.data=e},n.Font.prototype={constructor:n.Font,generateShapes:function(e,t,i){function r(e){for(var i=String(e).split(\"\"),r=t/o.resolution,n=0,s=[],c=0;c<i.length;c++){var u=a(i[c],r,n);n+=u.offset,s.push(u.path)}return s}function a(e,t,r){var a=o.glyphs[e]||o.glyphs[\"?\"];if(a){var s,c,u,l,h,d,p,f,m,g,v,y=new n.Path,M=[],A=n.ShapeUtils.b2,x=n.ShapeUtils.b3;if(a.o)for(var w=a._cachedOutline||(a._cachedOutline=a.o.split(\" \")),E=0,b=w.length;b>E;){var T=w[E++];switch(T){case\"m\":s=w[E++]*t+r,c=w[E++]*t,y.moveTo(s,c);break;case\"l\":s=w[E++]*t+r,c=w[E++]*t,y.lineTo(s,c);break;case\"q\":if(u=w[E++]*t+r,l=w[E++]*t,p=w[E++]*t+r,f=w[E++]*t,y.quadraticCurveTo(p,f,u,l),v=M[M.length-1]){h=v.x,d=v.y;for(var L=1;i>=L;L++){var N=L/i;A(N,h,p,u),A(N,d,f,l)}}break;case\"b\":if(u=w[E++]*t+r,l=w[E++]*t,p=w[E++]*t+r,f=w[E++]*t,m=w[E++]*t+r,g=w[E++]*t,y.bezierCurveTo(p,f,m,g,u,l),v=M[M.length-1]){h=v.x,d=v.y;for(var L=1;i>=L;L++){var N=L/i;x(N,h,p,m,u),x(N,d,f,g,l)}}}}return{offset:a.ha*t,path:y}}}void 0===t&&(t=100),void 0===i&&(i=4);for(var o=this.data,s=r(e),c=[],u=0,l=s.length;l>u;u++)Array.prototype.push.apply(c,s[u].toShapes());return c}},n.Path=function(e){n.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},n.Path.prototype=Object.create(n.CurvePath.prototype),n.Path.prototype.constructor=n.Path,n.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},n.Path.prototype.moveTo=function(e,t){this.actions.push({action:\"moveTo\",args:[e,t]})},n.Path.prototype.lineTo=function(e,t){var i=this.actions[this.actions.length-1].args,r=i[i.length-2],a=i[i.length-1],o=new n.LineCurve(new n.Vector2(r,a),new n.Vector2(e,t));this.curves.push(o),this.actions.push({action:\"lineTo\",args:[e,t]})},n.Path.prototype.quadraticCurveTo=function(e,t,i,r){var a=this.actions[this.actions.length-1].args,o=a[a.length-2],s=a[a.length-1],c=new n.QuadraticBezierCurve(new n.Vector2(o,s),new n.Vector2(e,t),new n.Vector2(i,r));this.curves.push(c),this.actions.push({action:\"quadraticCurveTo\",args:[e,t,i,r]})},n.Path.prototype.bezierCurveTo=function(e,t,i,r,a,o){var s=this.actions[this.actions.length-1].args,c=s[s.length-2],u=s[s.length-1],l=new n.CubicBezierCurve(new n.Vector2(c,u),new n.Vector2(e,t),new n.Vector2(i,r),new n.Vector2(a,o));this.curves.push(l),this.actions.push({action:\"bezierCurveTo\",args:[e,t,i,r,a,o]})},n.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],a=i[i.length-1],o=[new n.Vector2(r,a)];Array.prototype.push.apply(o,e);var s=new n.SplineCurve(o);this.curves.push(s),this.actions.push({action:\"splineThru\",args:t})},n.Path.prototype.arc=function(e,t,i,r,n,a){var o=this.actions[this.actions.length-1].args,s=o[o.length-2],c=o[o.length-1];this.absarc(e+s,t+c,i,r,n,a)},n.Path.prototype.absarc=function(e,t,i,r,n,a){this.absellipse(e,t,i,i,r,n,a)},n.Path.prototype.ellipse=function(e,t,i,r,n,a,o,s){var c=this.actions[this.actions.length-1].args,u=c[c.length-2],l=c[c.length-1];this.absellipse(e+u,t+l,i,r,n,a,o,s)},n.Path.prototype.absellipse=function(e,t,i,r,a,o,s,c){var u=[e,t,i,r,a,o,s,c||0],l=new n.EllipseCurve(e,t,i,r,a,o,s,c);this.curves.push(l);var h=l.getPoint(1);u.push(h.x),u.push(h.y),this.actions.push({action:\"ellipse\",args:u})},n.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;e>i;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},n.Path.prototype.getPoints=function(e){e=e||12;for(var t,i,r,a,o,s,c,u,l,h,d,p=n.ShapeUtils.b2,f=n.ShapeUtils.b3,m=[],g=0,v=this.actions.length;v>g;g++){var y=this.actions[g],M=y.action,A=y.args;switch(M){case\"moveTo\":m.push(new n.Vector2(A[0],A[1]));break;case\"lineTo\":m.push(new n.Vector2(A[0],A[1]));break;case\"quadraticCurveTo\":t=A[2],i=A[3],o=A[0],s=A[1],m.length>0?(l=m[m.length-1],c=l.x,u=l.y):(l=this.actions[g-1].args,c=l[l.length-2],u=l[l.length-1]);for(var x=1;e>=x;x++){var w=x/e;h=p(w,c,o,t),d=p(w,u,s,i),m.push(new n.Vector2(h,d))}break;case\"bezierCurveTo\":t=A[4],i=A[5],o=A[0],s=A[1],r=A[2],a=A[3],m.length>0?(l=m[m.length-1],c=l.x,u=l.y):(l=this.actions[g-1].args,c=l[l.length-2],u=l[l.length-1]);for(var x=1;e>=x;x++){var w=x/e;h=f(w,c,o,r,t),d=f(w,u,s,a,i),m.push(new n.Vector2(h,d))}break;case\"splineThru\":l=this.actions[g-1].args;var E=new n.Vector2(l[l.length-2],l[l.length-1]),b=[E],T=e*A[0].length;b=b.concat(A[0]);for(var L=new n.SplineCurve(b),x=1;T>=x;x++)m.push(L.getPointAt(x/T));break;case\"arc\":for(var N,D=A[0],S=A[1],C=A[2],I=A[3],j=A[4],_=!!A[5],O=j-I,z=2*e,x=1;z>=x;x++){var w=x/z;_||(w=1-w),N=I+w*O,h=D+C*Math.cos(N),d=S+C*Math.sin(N),m.push(new n.Vector2(h,d))}break;case\"ellipse\":var N,k,R,D=A[0],S=A[1],B=A[2],U=A[3],I=A[4],j=A[5],_=!!A[6],P=A[7],O=j-I,z=2*e;0!==P&&(k=Math.cos(P),R=Math.sin(P));for(var x=1;z>=x;x++){var w=x/z;if(_||(w=1-w),N=I+w*O,h=D+B*Math.cos(N),d=S+U*Math.sin(N),0!==P){var F=h,G=d;h=(F-D)*k-(G-S)*R+D,d=(F-D)*R+(G-S)*k+S}m.push(new n.Vector2(h,d))}}}var V=m[m.length-1];return Math.abs(V.x-m[0].x)<Number.EPSILON&&Math.abs(V.y-m[0].y)<Number.EPSILON&&m.splice(m.length-1,1),this.autoClose&&m.push(m[0]),m},n.Path.prototype.toShapes=function(e,t){function i(e){for(var t=[],i=new n.Path,r=0,a=e.length;a>r;r++){var o=e[r],s=o.args,c=o.action;\"moveTo\"===c&&0!==i.actions.length&&(t.push(i),i=new n.Path),i[c].apply(i,s)}return 0!==i.actions.length&&t.push(i),t}function r(e){for(var t=[],i=0,r=e.length;r>i;i++){var a=e[i],o=new n.Shape;o.actions=a.actions,o.curves=a.curves,t.push(o)}return t}function a(e,t){for(var i=t.length,r=!1,n=i-1,a=0;i>a;n=a++){var o=t[n],s=t[a],c=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(0>u&&(o=t[a],c=-c,s=t[n],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var l=u*(e.x-o.x)-c*(e.y-o.y);if(0===l)return!0;if(0>l)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var o=n.ShapeUtils.isClockWise,s=i(this.actions);if(0===s.length)return[];if(t===!0)return r(s);var c,u,l,h=[];if(1===s.length)return u=s[0],l=new n.Shape,l.actions=u.actions,l.curves=u.curves,h.push(l),h;var d=!o(s[0].getPoints());d=e?!d:d;var p,f=[],m=[],g=[],v=0;m[v]=void 0,g[v]=[];for(var y=0,M=s.length;M>y;y++)u=s[y],p=u.getPoints(),c=o(p),c=e?!c:c,c?(!d&&m[v]&&v++,m[v]={s:new n.Shape,p:p},m[v].s.actions=u.actions,m[v].s.curves=u.curves,d&&v++,g[v]=[]):g[v].push({h:u,p:p[0]});if(!m[0])return r(s);if(m.length>1){for(var A=!1,x=[],w=0,E=m.length;E>w;w++)f[w]=[];for(var w=0,E=m.length;E>w;w++)for(var b=g[w],T=0;T<b.length;T++){for(var L=b[T],N=!0,D=0;D<m.length;D++)a(L.p,m[D].p)&&(w!==D&&x.push({froms:w,tos:D,hole:T}),N?(N=!1,f[D].push(L)):A=!0);N&&f[w].push(L)}x.length>0&&(A||(g=f))}for(var S,y=0,C=m.length;C>y;y++){l=m[y].s,h.push(l),S=g[y];for(var I=0,j=S.length;j>I;I++)l.holes.push(S[I].h)}return h},n.Shape=function(){n.Path.apply(this,arguments),this.holes=[]},n.Shape.prototype=Object.create(n.Path.prototype),n.Shape.prototype.constructor=n.Shape,n.Shape.prototype.extrude=function(e){return new n.ExtrudeGeometry(this,e)},n.Shape.prototype.makeGeometry=function(e){return new n.ShapeGeometry(this,e)},n.Shape.prototype.getPointsHoles=function(e){for(var t=[],i=0,r=this.holes.length;r>i;i++)t[i]=this.holes[i].getPoints(e);return t},n.Shape.prototype.extractAllPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},n.Shape.prototype.extractPoints=function(e){return this.extractAllPoints(e)},n.LineCurve=function(e,t){this.v1=e,this.v2=t},n.LineCurve.prototype=Object.create(n.Curve.prototype),n.LineCurve.prototype.constructor=n.LineCurve,n.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},n.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},n.LineCurve.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},n.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},n.QuadraticBezierCurve.prototype=Object.create(n.Curve.prototype),n.QuadraticBezierCurve.prototype.constructor=n.QuadraticBezierCurve,n.QuadraticBezierCurve.prototype.getPoint=function(e){var t=n.ShapeUtils.b2;return new n.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},n.QuadraticBezierCurve.prototype.getTangent=function(e){var t=n.CurveUtils.tangentQuadraticBezier;return new n.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()},n.CubicBezierCurve=function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},n.CubicBezierCurve.prototype=Object.create(n.Curve.prototype),n.CubicBezierCurve.prototype.constructor=n.CubicBezierCurve,n.CubicBezierCurve.prototype.getPoint=function(e){var t=n.ShapeUtils.b3;return new n.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},n.CubicBezierCurve.prototype.getTangent=function(e){var t=n.CurveUtils.tangentCubicBezier;return new n.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},n.SplineCurve=function(e){this.points=void 0==e?[]:e},n.SplineCurve.prototype=Object.create(n.Curve.prototype),n.SplineCurve.prototype.constructor=n.SplineCurve,n.SplineCurve.prototype.getPoint=function(e){var t=this.points,i=(t.length-1)*e,r=Math.floor(i),a=i-r,o=t[0===r?r:r-1],s=t[r],c=t[r>t.length-2?t.length-1:r+1],u=t[r>t.length-3?t.length-1:r+2],l=n.CurveUtils.interpolate;return new n.Vector2(l(o.x,s.x,c.x,u.x,a),l(o.y,s.y,c.y,u.y,a))},n.EllipseCurve=function(e,t,i,r,n,a,o,s){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s||0},n.EllipseCurve.prototype=Object.create(n.Curve.prototype),n.EllipseCurve.prototype.constructor=n.EllipseCurve,n.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI);var i;i=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t;var r=this.aX+this.xRadius*Math.cos(i),a=this.aY+this.yRadius*Math.sin(i);if(0!==this.aRotation){var o=Math.cos(this.aRotation),s=Math.sin(this.aRotation),c=r,u=a;r=(c-this.aX)*o-(u-this.aY)*s+this.aX,a=(c-this.aX)*s+(u-this.aY)*o+this.aY}return new n.Vector2(r,a)},n.ArcCurve=function(e,t,i,r,a,o){n.EllipseCurve.call(this,e,t,i,i,r,a,o)},n.ArcCurve.prototype=Object.create(n.EllipseCurve.prototype),n.ArcCurve.prototype.constructor=n.ArcCurve,n.LineCurve3=n.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new n.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),n.QuadraticBezierCurve3=n.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t=n.ShapeUtils.b2;return new n.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),n.CubicBezierCurve3=n.Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t=n.ShapeUtils.b3;return new n.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),n.SplineCurve3=n.Curve.create(function(e){console.warn(\"THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3\"),this.points=void 0==e?[]:e},function(e){var t=this.points,i=(t.length-1)*e,r=Math.floor(i),a=i-r,o=t[0==r?r:r-1],s=t[r],c=t[r>t.length-2?t.length-1:r+1],u=t[r>t.length-3?t.length-1:r+2],l=n.CurveUtils.interpolate;return new n.Vector3(l(o.x,s.x,c.x,u.x,a),l(o.y,s.y,c.y,u.y,a),l(o.z,s.z,c.z,u.z,a))}),n.CatmullRomCurve3=function(){function e(){}var t=new n.Vector3,i=new e,r=new e,a=new e;return e.prototype.init=function(e,t,i,r){this.c0=e,this.c1=i,this.c2=-3*e+3*t-2*i-r,this.c3=2*e-2*t+i+r},e.prototype.initNonuniformCatmullRom=function(e,t,i,r,n,a,o){var s=(t-e)/n-(i-e)/(n+a)+(i-t)/a,c=(i-t)/a-(r-t)/(a+o)+(r-i)/o;s*=a,c*=a,this.init(t,i,s,c)},e.prototype.initCatmullRom=function(e,t,i,r,n){this.init(t,i,n*(i-e),n*(r-t))},e.prototype.calc=function(e){var t=e*e,i=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*i},n.Curve.create(function(e){this.points=e||[],this.closed=!1},function(e){var o,s,c,u,l=this.points;u=l.length,2>u&&console.log(\"duh, you need at least 2 points\"),o=(u-(this.closed?0:1))*e,s=Math.floor(o),c=o-s,this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/l.length)+1)*l.length:0===c&&s===u-1&&(s=u-2,c=1);var h,d,p,f;if(this.closed||s>0?h=l[(s-1)%u]:(t.subVectors(l[0],l[1]).add(l[0]),h=t),d=l[s%u],p=l[(s+1)%u],this.closed||u>s+2?f=l[(s+2)%u]:(t.subVectors(l[u-1],l[u-2]).add(l[u-1]),f=t),void 0===this.type||\"centripetal\"===this.type||\"chordal\"===this.type){var m=\"chordal\"===this.type?.5:.25,g=Math.pow(h.distanceToSquared(d),m),v=Math.pow(d.distanceToSquared(p),m),y=Math.pow(p.distanceToSquared(f),m);1e-4>v&&(v=1),1e-4>g&&(g=v),1e-4>y&&(y=v),i.initNonuniformCatmullRom(h.x,d.x,p.x,f.x,g,v,y),r.initNonuniformCatmullRom(h.y,d.y,p.y,f.y,g,v,y),a.initNonuniformCatmullRom(h.z,d.z,p.z,f.z,g,v,y)}else if(\"catmullrom\"===this.type){var M=void 0!==this.tension?this.tension:.5;i.initCatmullRom(h.x,d.x,p.x,f.x,M),r.initCatmullRom(h.y,d.y,p.y,f.y,M),a.initCatmullRom(h.z,d.z,p.z,f.z,M)}var A=new n.Vector3(i.calc(c),r.calc(c),a.calc(c));return A})}(),n.ClosedSplineCurve3=function(e){console.warn(\"THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.\"),n.CatmullRomCurve3.call(this,e),this.type=\"catmullrom\",this.closed=!0},n.ClosedSplineCurve3.prototype=Object.create(n.CatmullRomCurve3.prototype),n.BoxGeometry=function(e,t,i,r,a,o){n.Geometry.call(this),this.type=\"BoxGeometry\",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:a,depthSegments:o},this.fromBufferGeometry(new n.BoxBufferGeometry(e,t,i,r,a,o)),this.mergeVertices()},n.BoxGeometry.prototype=Object.create(n.Geometry.prototype),n.BoxGeometry.prototype.constructor=n.BoxGeometry,n.CubeGeometry=n.BoxGeometry,n.BoxBufferGeometry=function(e,t,i,r,a,o){function s(e,t,i){var r=0;return r+=e*t*2,r+=e*i*2,r+=i*t*2,4*r}function c(e,t,i,r,a,o,s,c,l,h,x){for(var w=o/l,E=s/h,b=o/2,T=s/2,L=c/2,N=l+1,D=h+1,S=0,C=0,I=new n.Vector3,j=0;D>j;j++)for(var _=j*E-T,O=0;N>O;O++){var z=O*w-b;I[e]=z*r,I[t]=_*a,I[i]=L,p[g]=I.x,p[g+1]=I.y,p[g+2]=I.z,I[e]=0,I[t]=0,I[i]=c>0?1:-1,f[g]=I.x,f[g+1]=I.y,f[g+2]=I.z,m[v]=O/l,m[v+1]=1-j/h,g+=3,v+=2,S+=1}for(j=0;h>j;j++)for(O=0;l>O;O++){var k=M+O+N*j,R=M+O+N*(j+1),B=M+(O+1)+N*(j+1),U=M+(O+1)+N*j;d[y]=k,d[y+1]=R,d[y+2]=U,d[y+3]=R,d[y+4]=B,d[y+5]=U,y+=6,C+=6}u.addGroup(A,C,x),A+=C,M+=S}n.BufferGeometry.call(this),this.type=\"BoxBufferGeometry\",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:a,depthSegments:o};var u=this;r=Math.floor(r)||1,a=Math.floor(a)||1,o=Math.floor(o)||1;var l=s(r,a,o),h=l/4*6,d=new(h>65535?Uint32Array:Uint16Array)(h),p=new Float32Array(3*l),f=new Float32Array(3*l),m=new Float32Array(2*l),g=0,v=0,y=0,M=0,A=0;c(\"z\",\"y\",\"x\",-1,-1,i,t,e,o,a,0),c(\"z\",\"y\",\"x\",1,-1,i,t,-e,o,a,1),c(\"x\",\"z\",\"y\",1,1,e,i,t,r,o,2),c(\"x\",\"z\",\"y\",1,-1,e,i,-t,r,o,3),c(\"x\",\"y\",\"z\",1,-1,e,t,i,r,a,4),c(\"x\",\"y\",\"z\",-1,-1,e,t,-i,r,a,5),this.setIndex(new n.BufferAttribute(d,1)),this.addAttribute(\"position\",new n.BufferAttribute(p,3)),this.addAttribute(\"normal\",new n.BufferAttribute(f,3)),this.addAttribute(\"uv\",new n.BufferAttribute(m,2))},n.BoxBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.BoxBufferGeometry.prototype.constructor=n.BoxBufferGeometry,n.CircleGeometry=function(e,t,i,r){n.Geometry.call(this),this.type=\"CircleGeometry\",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new n.CircleBufferGeometry(e,t,i,r))},n.CircleGeometry.prototype=Object.create(n.Geometry.prototype),n.CircleGeometry.prototype.constructor=n.CircleGeometry,n.CircleBufferGeometry=function(e,t,i,r){n.BufferGeometry.call(this),this.type=\"CircleBufferGeometry\",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||50,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var a=t+2,o=new Float32Array(3*a),s=new Float32Array(3*a),c=new Float32Array(2*a);s[2]=1,c[0]=.5,c[1]=.5;for(var u=0,l=3,h=2;t>=u;u++,l+=3,h+=2){var d=i+u/t*r;o[l]=e*Math.cos(d),o[l+1]=e*Math.sin(d),s[l+2]=1,c[h]=(o[l]/e+1)/2,c[h+1]=(o[l+1]/e+1)/2}for(var p=[],l=1;t>=l;l++)p.push(l,l+1,0);this.setIndex(new n.BufferAttribute(new Uint16Array(p),1)),this.addAttribute(\"position\",new n.BufferAttribute(o,3)),this.addAttribute(\"normal\",new n.BufferAttribute(s,3)),this.addAttribute(\"uv\",new n.BufferAttribute(c,2)),this.boundingSphere=new n.Sphere(new n.Vector3,e)},n.CircleBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.CircleBufferGeometry.prototype.constructor=n.CircleBufferGeometry,n.CylinderBufferGeometry=function(e,t,i,r,a,o,s,c){function u(){var e=(r+1)*(a+1);return o===!1&&(e+=2*(r+1)+2*r),e}function l(){var e=r*a*2*3;return o===!1&&(e+=2*r*3),e}function h(){var o,u,l=new n.Vector3,h=new n.Vector3,d=0,f=(t-e)/i;for(u=0;a>=u;u++){var m=[],T=u/a,L=T*(t-e)+e;for(o=0;r>=o;o++){var N=o/r;h.x=L*Math.sin(N*c+s),h.y=-T*i+E,h.z=L*Math.cos(N*c+s),v.setXYZ(A,h.x,h.y,h.z),l.copy(h),(0===e&&0===u||0===t&&u===a)&&(l.x=Math.sin(N*c+s),l.z=Math.cos(N*c+s)),l.setY(Math.sqrt(l.x*l.x+l.z*l.z)*f).normalize(),y.setXYZ(A,l.x,l.y,l.z),M.setXY(A,N,1-T),m.push(A),A++}w.push(m)}for(o=0;r>o;o++)for(u=0;a>u;u++){var D=w[u][o],S=w[u+1][o],C=w[u+1][o+1],I=w[u][o+1];g.setX(x,D),x++,g.setX(x,S),x++,g.setX(x,I),x++,g.setX(x,S),x++,g.setX(x,C),x++,g.setX(x,I),x++,d+=6}p.addGroup(b,d,0),b+=d}function d(i){var a,o,u,l=new n.Vector2,h=new n.Vector3,d=0,f=i===!0?e:t,m=i===!0?1:-1;for(o=A,a=1;r>=a;a++)v.setXYZ(A,0,E*m,0),y.setXYZ(A,0,m,0),i===!0?(l.x=a/r,l.y=0):(l.x=(a-1)/r,l.y=1),M.setXY(A,l.x,l.y),A++;for(u=A,a=0;r>=a;a++){var w=a/r;h.x=f*Math.sin(w*c+s),h.y=E*m,h.z=f*Math.cos(w*c+s),v.setXYZ(A,h.x,h.y,h.z),y.setXYZ(A,0,m,0),M.setXY(A,w,i===!0?1:0),A++}for(a=0;r>a;a++){var T=o+a,L=u+a;i===!0?(g.setX(x,L),x++,g.setX(x,L+1),x++,g.setX(x,T),x++):(g.setX(x,L+1),x++,g.setX(x,L),x++,g.setX(x,T),x++),d+=3}p.addGroup(b,d,i===!0?1:2),b+=d}n.BufferGeometry.call(this),this.type=\"CylinderBufferGeometry\",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:c};var p=this;e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100,r=Math.floor(r)||8,a=Math.floor(a)||1,o=void 0!==o?o:!1,s=void 0!==s?s:0,c=void 0!==c?c:2*Math.PI;var f=u(),m=l(),g=new n.BufferAttribute(new(m>65535?Uint32Array:Uint16Array)(m),1),v=new n.BufferAttribute(new Float32Array(3*f),3),y=new n.BufferAttribute(new Float32Array(3*f),3),M=new n.BufferAttribute(new Float32Array(2*f),2),A=0,x=0,w=[],E=i/2,b=0;h(),o===!1&&(e>0&&d(!0),t>0&&d(!1)),this.setIndex(g),this.addAttribute(\"position\",v),this.addAttribute(\"normal\",y),this.addAttribute(\"uv\",M)},n.CylinderBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.CylinderBufferGeometry.prototype.constructor=n.CylinderBufferGeometry,n.CylinderGeometry=function(e,t,i,r,a,o,s,c){n.Geometry.call(this),this.type=\"CylinderGeometry\",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:c},this.fromBufferGeometry(new n.CylinderBufferGeometry(e,t,i,r,a,o,s,c)),this.mergeVertices()},n.CylinderGeometry.prototype=Object.create(n.Geometry.prototype),n.CylinderGeometry.prototype.constructor=n.CylinderGeometry,n.EdgesGeometry=function(e,t){function i(e,t){return e-t}n.BufferGeometry.call(this),t=void 0!==t?t:1;var r,a=Math.cos(n.Math.DEG2RAD*t),o=[0,0],s={},c=[\"a\",\"b\",\"c\"];e instanceof n.BufferGeometry?(r=new n.Geometry,r.fromBufferGeometry(e)):r=e.clone(),r.mergeVertices(),r.computeFaceNormals();for(var u=r.vertices,l=r.faces,h=0,d=l.length;d>h;h++)for(var p=l[h],f=0;3>f;f++){o[0]=p[c[f]],o[1]=p[c[(f+1)%3]],o.sort(i);var m=o.toString();void 0===s[m]?s[m]={vert1:o[0],vert2:o[1],face1:h,face2:void 0}:s[m].face2=h}var g=[];\nfor(var m in s){var v=s[m];if(void 0===v.face2||l[v.face1].normal.dot(l[v.face2].normal)<=a){var y=u[v.vert1];g.push(y.x),g.push(y.y),g.push(y.z),y=u[v.vert2],g.push(y.x),g.push(y.y),g.push(y.z)}}this.addAttribute(\"position\",new n.BufferAttribute(new Float32Array(g),3))},n.EdgesGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.EdgesGeometry.prototype.constructor=n.EdgesGeometry,n.ExtrudeGeometry=function(e,t){return\"undefined\"==typeof e?(e=[],void 0):(n.Geometry.call(this),this.type=\"ExtrudeGeometry\",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeFaceNormals(),void 0)},n.ExtrudeGeometry.prototype=Object.create(n.Geometry.prototype),n.ExtrudeGeometry.prototype.constructor=n.ExtrudeGeometry,n.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;i>r;r++){var n=e[r];this.addShape(n,t)}},n.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.error(\"THREE.ExtrudeGeometry: vec does not exist\"),t.clone().multiplyScalar(i).add(e)}function r(e,t,i){var r,a,o=1,s=e.x-t.x,c=e.y-t.y,u=i.x-e.x,l=i.y-e.y,h=s*s+c*c,d=s*l-c*u;if(Math.abs(d)>Number.EPSILON){var p=Math.sqrt(h),f=Math.sqrt(u*u+l*l),m=t.x-c/p,g=t.y+s/p,v=i.x-l/f,y=i.y+u/f,M=((v-m)*l-(y-g)*u)/(s*l-c*u);r=m+s*M-e.x,a=g+c*M-e.y;var A=r*r+a*a;if(2>=A)return new n.Vector2(r,a);o=Math.sqrt(A/2)}else{var x=!1;s>Number.EPSILON?u>Number.EPSILON&&(x=!0):s<-Number.EPSILON?u<-Number.EPSILON&&(x=!0):Math.sign(c)===Math.sign(l)&&(x=!0),x?(r=-c,a=s,o=Math.sqrt(h)):(r=s,a=c,o=Math.sqrt(h/2))}return new n.Vector2(r/o,a/o)}function a(){if(A){var e=0,t=V*e;for(H=0;Q>H;H++)G=z[H],u(G[2]+t,G[1]+t,G[0]+t);for(e=w+2*M,t=V*e,H=0;Q>H;H++)G=z[H],u(G[0]+t,G[1]+t,G[2]+t)}else{for(H=0;Q>H;H++)G=z[H],u(G[2],G[1],G[0]);for(H=0;Q>H;H++)G=z[H],u(G[0]+V*w,G[1]+V*w,G[2]+V*w)}}function o(){var e=0;for(s(k,e),e+=k.length,N=0,D=_.length;D>N;N++)L=_[N],s(L,e),e+=L.length}function s(e,t){var i,r;for(H=e.length;--H>=0;){i=H,r=H-1,0>r&&(r=e.length-1);var n=0,a=w+2*M;for(n=0;a>n;n++){var o=V*n,s=V*(n+1),c=t+i+o,u=t+r+o,h=t+r+s,d=t+i+s;l(c,u,h,d,e,n,a,i,r)}}}function c(e,t,i){S.vertices.push(new n.Vector3(e,t,i))}function u(e,t,i){e+=C,t+=C,i+=C,S.faces.push(new n.Face3(e,t,i,null,null,0));var r=T.generateTopUV(S,e,t,i);S.faceVertexUvs[0].push(r)}function l(e,t,i,r){e+=C,t+=C,i+=C,r+=C,S.faces.push(new n.Face3(e,t,r,null,null,1)),S.faces.push(new n.Face3(t,i,r,null,null,1));var a=T.generateSideWallUV(S,e,t,i,r);S.faceVertexUvs[0].push([a[0],a[1],a[3]]),S.faceVertexUvs[0].push([a[1],a[2],a[3]])}var h,d,p,f,m,g=void 0!==t.amount?t.amount:100,v=void 0!==t.bevelThickness?t.bevelThickness:6,y=void 0!==t.bevelSize?t.bevelSize:v-2,M=void 0!==t.bevelSegments?t.bevelSegments:3,A=void 0!==t.bevelEnabled?t.bevelEnabled:!0,x=void 0!==t.curveSegments?t.curveSegments:12,w=void 0!==t.steps?t.steps:1,E=t.extrudePath,b=!1,T=void 0!==t.UVGenerator?t.UVGenerator:n.ExtrudeGeometry.WorldUVGenerator;E&&(h=E.getSpacedPoints(w),b=!0,A=!1,d=void 0!==t.frames?t.frames:new n.TubeGeometry.FrenetFrames(E,w,!1),p=new n.Vector3,f=new n.Vector3,m=new n.Vector3),A||(M=0,v=0,y=0);var L,N,D,S=this,C=this.vertices.length,I=e.extractPoints(x),j=I.shape,_=I.holes,O=!n.ShapeUtils.isClockWise(j);if(O){for(j=j.reverse(),N=0,D=_.length;D>N;N++)L=_[N],n.ShapeUtils.isClockWise(L)&&(_[N]=L.reverse());O=!1}var z=n.ShapeUtils.triangulateShape(j,_),k=j;for(N=0,D=_.length;D>N;N++)L=_[N],j=j.concat(L);for(var R,B,U,P,F,G,V=j.length,Q=z.length,Y=[],H=0,W=k.length,X=W-1,q=H+1;W>H;H++,X++,q++)X===W&&(X=0),q===W&&(q=0),Y[H]=r(k[H],k[X],k[q]);var Z,K=[],J=Y.concat();for(N=0,D=_.length;D>N;N++){for(L=_[N],Z=[],H=0,W=L.length,X=W-1,q=H+1;W>H;H++,X++,q++)X===W&&(X=0),q===W&&(q=0),Z[H]=r(L[H],L[X],L[q]);K.push(Z),J=J.concat(Z)}for(R=0;M>R;R++){for(U=R/M,P=v*(1-U),B=y*Math.sin(U*Math.PI/2),H=0,W=k.length;W>H;H++)F=i(k[H],Y[H],B),c(F.x,F.y,-P);for(N=0,D=_.length;D>N;N++)for(L=_[N],Z=K[N],H=0,W=L.length;W>H;H++)F=i(L[H],Z[H],B),c(F.x,F.y,-P)}for(B=y,H=0;V>H;H++)F=A?i(j[H],J[H],B):j[H],b?(f.copy(d.normals[0]).multiplyScalar(F.x),p.copy(d.binormals[0]).multiplyScalar(F.y),m.copy(h[0]).add(f).add(p),c(m.x,m.y,m.z)):c(F.x,F.y,0);var $;for($=1;w>=$;$++)for(H=0;V>H;H++)F=A?i(j[H],J[H],B):j[H],b?(f.copy(d.normals[$]).multiplyScalar(F.x),p.copy(d.binormals[$]).multiplyScalar(F.y),m.copy(h[$]).add(f).add(p),c(m.x,m.y,m.z)):c(F.x,F.y,g/w*$);for(R=M-1;R>=0;R--){for(U=R/M,P=v*(1-U),B=y*Math.sin(U*Math.PI/2),H=0,W=k.length;W>H;H++)F=i(k[H],Y[H],B),c(F.x,F.y,g+P);for(N=0,D=_.length;D>N;N++)for(L=_[N],Z=K[N],H=0,W=L.length;W>H;H++)F=i(L[H],Z[H],B),b?c(F.x,F.y+h[w-1].y,h[w-1].x+P):c(F.x,F.y,g+P)}a(),o()},n.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r){var a=e.vertices,o=a[t],s=a[i],c=a[r];return[new n.Vector2(o.x,o.y),new n.Vector2(s.x,s.y),new n.Vector2(c.x,c.y)]},generateSideWallUV:function(e,t,i,r,a){var o=e.vertices,s=o[t],c=o[i],u=o[r],l=o[a];return Math.abs(s.y-c.y)<.01?[new n.Vector2(s.x,1-s.z),new n.Vector2(c.x,1-c.z),new n.Vector2(u.x,1-u.z),new n.Vector2(l.x,1-l.z)]:[new n.Vector2(s.y,1-s.z),new n.Vector2(c.y,1-c.z),new n.Vector2(u.y,1-u.z),new n.Vector2(l.y,1-l.z)]}},n.ShapeGeometry=function(e,t){n.Geometry.call(this),this.type=\"ShapeGeometry\",Array.isArray(e)===!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},n.ShapeGeometry.prototype=Object.create(n.Geometry.prototype),n.ShapeGeometry.prototype.constructor=n.ShapeGeometry,n.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;r>i;i++)this.addShape(e[i],t);return this},n.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,r,a,o=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,c=void 0===t.UVGenerator?n.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,u=this.vertices.length,l=e.extractPoints(o),h=l.shape,d=l.holes,p=!n.ShapeUtils.isClockWise(h);if(p){for(h=h.reverse(),i=0,r=d.length;r>i;i++)a=d[i],n.ShapeUtils.isClockWise(a)&&(d[i]=a.reverse());p=!1}var f=n.ShapeUtils.triangulateShape(h,d);for(i=0,r=d.length;r>i;i++)a=d[i],h=h.concat(a);var m,g,v=h.length,y=f.length;for(i=0;v>i;i++)m=h[i],this.vertices.push(new n.Vector3(m.x,m.y,0));for(i=0;y>i;i++){g=f[i];var M=g[0]+u,A=g[1]+u,x=g[2]+u;this.faces.push(new n.Face3(M,A,x,null,null,s)),this.faceVertexUvs[0].push(c.generateTopUV(this,M,A,x))}},n.LatheBufferGeometry=function(e,t,i,r){n.BufferGeometry.call(this),this.type=\"LatheBufferGeometry\",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t)||12,i=i||0,r=r||2*Math.PI,r=n.Math.clamp(r,0,2*Math.PI);var a,o,s,c=(t+1)*e.length,u=t*e.length*2*3,l=new n.BufferAttribute(new(u>65535?Uint32Array:Uint16Array)(u),1),h=new n.BufferAttribute(new Float32Array(3*c),3),d=new n.BufferAttribute(new Float32Array(2*c),2),p=0,f=0,m=(1/(e.length-1),1/t),g=new n.Vector3,v=new n.Vector2;for(o=0;t>=o;o++){var y=i+o*m*r,M=Math.sin(y),A=Math.cos(y);for(s=0;s<=e.length-1;s++)g.x=e[s].x*M,g.y=e[s].y,g.z=e[s].x*A,h.setXYZ(p,g.x,g.y,g.z),v.x=o/t,v.y=s/(e.length-1),d.setXY(p,v.x,v.y),p++}for(o=0;t>o;o++)for(s=0;s<e.length-1;s++){a=s+o*e.length;var x=a,w=a+e.length,E=a+e.length+1,b=a+1;l.setX(f,x),f++,l.setX(f,w),f++,l.setX(f,b),f++,l.setX(f,w),f++,l.setX(f,E),f++,l.setX(f,b),f++}if(this.setIndex(l),this.addAttribute(\"position\",h),this.addAttribute(\"uv\",d),this.computeVertexNormals(),r===2*Math.PI){var T=this.attributes.normal.array,L=new n.Vector3,N=new n.Vector3,D=new n.Vector3;for(a=t*e.length*3,o=0,s=0;o<e.length;o++,s+=3)L.x=T[s+0],L.y=T[s+1],L.z=T[s+2],N.x=T[a+s+0],N.y=T[a+s+1],N.z=T[a+s+2],D.addVectors(L,N).normalize(),T[s+0]=T[a+s+0]=D.x,T[s+1]=T[a+s+1]=D.y,T[s+2]=T[a+s+2]=D.z}},n.LatheBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.LatheBufferGeometry.prototype.constructor=n.LatheBufferGeometry,n.LatheGeometry=function(e,t,i,r){n.Geometry.call(this),this.type=\"LatheGeometry\",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},this.fromBufferGeometry(new n.LatheBufferGeometry(e,t,i,r)),this.mergeVertices()},n.LatheGeometry.prototype=Object.create(n.Geometry.prototype),n.LatheGeometry.prototype.constructor=n.LatheGeometry,n.PlaneGeometry=function(e,t,i,r){n.Geometry.call(this),this.type=\"PlaneGeometry\",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new n.PlaneBufferGeometry(e,t,i,r))},n.PlaneGeometry.prototype=Object.create(n.Geometry.prototype),n.PlaneGeometry.prototype.constructor=n.PlaneGeometry,n.PlaneBufferGeometry=function(e,t,i,r){n.BufferGeometry.call(this),this.type=\"PlaneBufferGeometry\",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};for(var a=e/2,o=t/2,s=Math.floor(i)||1,c=Math.floor(r)||1,u=s+1,l=c+1,h=e/s,d=t/c,p=new Float32Array(u*l*3),f=new Float32Array(u*l*3),m=new Float32Array(u*l*2),g=0,v=0,y=0;l>y;y++)for(var M=y*d-o,A=0;u>A;A++){var x=A*h-a;p[g]=x,p[g+1]=-M,f[g+2]=1,m[v]=A/s,m[v+1]=1-y/c,g+=3,v+=2}g=0;for(var w=new(p.length/3>65535?Uint32Array:Uint16Array)(s*c*6),y=0;c>y;y++)for(var A=0;s>A;A++){var E=A+u*y,b=A+u*(y+1),T=A+1+u*(y+1),L=A+1+u*y;w[g]=E,w[g+1]=b,w[g+2]=L,w[g+3]=b,w[g+4]=T,w[g+5]=L,g+=6}this.setIndex(new n.BufferAttribute(w,1)),this.addAttribute(\"position\",new n.BufferAttribute(p,3)),this.addAttribute(\"normal\",new n.BufferAttribute(f,3)),this.addAttribute(\"uv\",new n.BufferAttribute(m,2))},n.PlaneBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.PlaneBufferGeometry.prototype.constructor=n.PlaneBufferGeometry,n.RingBufferGeometry=function(e,t,i,r,a,o){n.BufferGeometry.call(this),this.type=\"RingBufferGeometry\",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:a,thetaLength:o},e=e||20,t=t||50,a=void 0!==a?a:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8,r=void 0!==r?Math.max(1,r):1;var s,c,u,l=(i+1)*(r+1),h=i*r*2*3,d=new n.BufferAttribute(new(h>65535?Uint32Array:Uint16Array)(h),1),p=new n.BufferAttribute(new Float32Array(3*l),3),f=new n.BufferAttribute(new Float32Array(3*l),3),m=new n.BufferAttribute(new Float32Array(2*l),2),g=0,v=0,y=e,M=(t-e)/r,A=new n.Vector3,x=new n.Vector2;for(c=0;r>=c;c++){for(u=0;i>=u;u++)s=a+u/i*o,A.x=y*Math.cos(s),A.y=y*Math.sin(s),p.setXYZ(g,A.x,A.y,A.z),f.setXYZ(g,0,0,1),x.x=(A.x/t+1)/2,x.y=(A.y/t+1)/2,m.setXY(g,x.x,x.y),g++;y+=M}for(c=0;r>c;c++){var w=c*(i+1);for(u=0;i>u;u++){s=u+w;var E=s,b=s+i+1,T=s+i+2,L=s+1;d.setX(v,E),v++,d.setX(v,b),v++,d.setX(v,T),v++,d.setX(v,E),v++,d.setX(v,T),v++,d.setX(v,L),v++}}this.setIndex(d),this.addAttribute(\"position\",p),this.addAttribute(\"normal\",f),this.addAttribute(\"uv\",m)},n.RingBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.RingBufferGeometry.prototype.constructor=n.RingBufferGeometry,n.RingGeometry=function(e,t,i,r,a,o){n.Geometry.call(this),this.type=\"RingGeometry\",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new n.RingBufferGeometry(e,t,i,r,a,o))},n.RingGeometry.prototype=Object.create(n.Geometry.prototype),n.RingGeometry.prototype.constructor=n.RingGeometry,n.SphereGeometry=function(e,t,i,r,a,o,s){n.Geometry.call(this),this.type=\"SphereGeometry\",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new n.SphereBufferGeometry(e,t,i,r,a,o,s))},n.SphereGeometry.prototype=Object.create(n.Geometry.prototype),n.SphereGeometry.prototype.constructor=n.SphereGeometry,n.SphereBufferGeometry=function(e,t,i,r,a,o,s){n.BufferGeometry.call(this),this.type=\"SphereBufferGeometry\",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:a,thetaStart:o,thetaLength:s},e=e||50,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;for(var c=o+s,u=(t+1)*(i+1),l=new n.BufferAttribute(new Float32Array(3*u),3),h=new n.BufferAttribute(new Float32Array(3*u),3),d=new n.BufferAttribute(new Float32Array(2*u),2),p=0,f=[],m=new n.Vector3,g=0;i>=g;g++){for(var v=[],y=g/i,M=0;t>=M;M++){var A=M/t,x=-e*Math.cos(r+A*a)*Math.sin(o+y*s),w=e*Math.cos(o+y*s),E=e*Math.sin(r+A*a)*Math.sin(o+y*s);m.set(x,w,E).normalize(),l.setXYZ(p,x,w,E),h.setXYZ(p,m.x,m.y,m.z),d.setXY(p,A,1-y),v.push(p),p++}f.push(v)}for(var b=[],g=0;i>g;g++)for(var M=0;t>M;M++){var T=f[g][M+1],L=f[g][M],N=f[g+1][M],D=f[g+1][M+1];(0!==g||o>0)&&b.push(T,L,D),(g!==i-1||c<Math.PI)&&b.push(L,N,D)}this.setIndex(new(l.count>65535?n.Uint32Attribute:n.Uint16Attribute)(b,1)),this.addAttribute(\"position\",l),this.addAttribute(\"normal\",h),this.addAttribute(\"uv\",d),this.boundingSphere=new n.Sphere(new n.Vector3,e)},n.SphereBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.SphereBufferGeometry.prototype.constructor=n.SphereBufferGeometry,n.TextGeometry=function(e,t){t=t||{};var i=t.font;if(i instanceof n.Font==!1)return console.error(\"THREE.TextGeometry: font parameter is not an instance of THREE.Font.\"),new n.Geometry;var r=i.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),n.ExtrudeGeometry.call(this,r,t),this.type=\"TextGeometry\"},n.TextGeometry.prototype=Object.create(n.ExtrudeGeometry.prototype),n.TextGeometry.prototype.constructor=n.TextGeometry,n.TorusBufferGeometry=function(e,t,i,r,a){n.BufferGeometry.call(this),this.type=\"TorusBufferGeometry\",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:a},e=e||100,t=t||40,i=Math.floor(i)||8,r=Math.floor(r)||6,a=a||2*Math.PI;var o,s,c=(i+1)*(r+1),u=i*r*2*3,l=new(u>65535?Uint32Array:Uint16Array)(u),h=new Float32Array(3*c),d=new Float32Array(3*c),p=new Float32Array(2*c),f=0,m=0,g=0,v=new n.Vector3,y=new n.Vector3,M=new n.Vector3;for(o=0;i>=o;o++)for(s=0;r>=s;s++){var A=s/r*a,x=o/i*Math.PI*2;y.x=(e+t*Math.cos(x))*Math.cos(A),y.y=(e+t*Math.cos(x))*Math.sin(A),y.z=t*Math.sin(x),h[f]=y.x,h[f+1]=y.y,h[f+2]=y.z,v.x=e*Math.cos(A),v.y=e*Math.sin(A),M.subVectors(y,v).normalize(),d[f]=M.x,d[f+1]=M.y,d[f+2]=M.z,p[m]=s/r,p[m+1]=o/i,f+=3,m+=2}for(o=1;i>=o;o++)for(s=1;r>=s;s++){var w=(r+1)*o+s-1,E=(r+1)*(o-1)+s-1,b=(r+1)*(o-1)+s,T=(r+1)*o+s;l[g]=w,l[g+1]=E,l[g+2]=T,l[g+3]=E,l[g+4]=b,l[g+5]=T,g+=6}this.setIndex(new n.BufferAttribute(l,1)),this.addAttribute(\"position\",new n.BufferAttribute(h,3)),this.addAttribute(\"normal\",new n.BufferAttribute(d,3)),this.addAttribute(\"uv\",new n.BufferAttribute(p,2))},n.TorusBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.TorusBufferGeometry.prototype.constructor=n.TorusBufferGeometry,n.TorusGeometry=function(e,t,i,r,a){n.Geometry.call(this),this.type=\"TorusGeometry\",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:a},this.fromBufferGeometry(new n.TorusBufferGeometry(e,t,i,r,a))},n.TorusGeometry.prototype=Object.create(n.Geometry.prototype),n.TorusGeometry.prototype.constructor=n.TorusGeometry,n.TorusKnotBufferGeometry=function(e,t,i,r,a,o){function s(e,t,i,r,n){var a=Math.cos(e),o=Math.sin(e),s=i/t*e,c=Math.cos(s);n.x=r*(2+c)*.5*a,n.y=r*(2+c)*o*.5,n.z=r*Math.sin(s)*.5}n.BufferGeometry.call(this),this.type=\"TorusKnotBufferGeometry\",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:a,q:o},e=e||100,t=t||40,i=Math.floor(i)||64,r=Math.floor(r)||8,a=a||2,o=o||3;var c,u,l=(r+1)*(i+1),h=r*i*2*3,d=new n.BufferAttribute(new(h>65535?Uint32Array:Uint16Array)(h),1),p=new n.BufferAttribute(new Float32Array(3*l),3),f=new n.BufferAttribute(new Float32Array(3*l),3),m=new n.BufferAttribute(new Float32Array(2*l),2),g=0,v=0,y=new n.Vector3,M=new n.Vector3,A=new n.Vector2,x=new n.Vector3,w=new n.Vector3,E=new n.Vector3,b=new n.Vector3,T=new n.Vector3;for(c=0;i>=c;++c){var L=c/i*a*Math.PI*2;for(s(L,a,o,e,x),s(L+.01,a,o,e,w),b.subVectors(w,x),T.addVectors(w,x),E.crossVectors(b,T),T.crossVectors(E,b),E.normalize(),T.normalize(),u=0;r>=u;++u){var N=u/r*Math.PI*2,D=-t*Math.cos(N),S=t*Math.sin(N);y.x=x.x+(D*T.x+S*E.x),y.y=x.y+(D*T.y+S*E.y),y.z=x.z+(D*T.z+S*E.z),p.setXYZ(g,y.x,y.y,y.z),M.subVectors(y,x).normalize(),f.setXYZ(g,M.x,M.y,M.z),A.x=c/i,A.y=u/r,m.setXY(g,A.x,A.y),g++}}for(u=1;i>=u;u++)for(c=1;r>=c;c++){var C=(r+1)*(u-1)+(c-1),I=(r+1)*u+(c-1),j=(r+1)*u+c,_=(r+1)*(u-1)+c;d.setX(v,C),v++,d.setX(v,I),v++,d.setX(v,_),v++,d.setX(v,I),v++,d.setX(v,j),v++,d.setX(v,_),v++}this.setIndex(d),this.addAttribute(\"position\",p),this.addAttribute(\"normal\",f),this.addAttribute(\"uv\",m)},n.TorusKnotBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.TorusKnotBufferGeometry.prototype.constructor=n.TorusKnotBufferGeometry,n.TorusKnotGeometry=function(e,t,i,r,a,o,s){n.Geometry.call(this),this.type=\"TorusKnotGeometry\",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:a,q:o},void 0!==s&&console.warn(\"THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.\"),this.fromBufferGeometry(new n.TorusKnotBufferGeometry(e,t,i,r,a,o)),this.mergeVertices()},n.TorusKnotGeometry.prototype=Object.create(n.Geometry.prototype),n.TorusKnotGeometry.prototype.constructor=n.TorusKnotGeometry,n.TubeGeometry=function(e,t,i,r,a,o){function s(e,t,i){return C.vertices.push(new n.Vector3(e,t,i))-1}n.Geometry.call(this),this.type=\"TubeGeometry\",this.parameters={path:e,segments:t,radius:i,radialSegments:r,closed:a,taper:o},t=t||64,i=i||1,r=r||8,a=a||!1,o=o||n.TubeGeometry.NoTaper;var c,u,l,h,d,p,f,m,g,v,y,M,A,x,w,E,b,T,L,N,D,S=[],C=this,I=t+1,j=new n.Vector3,_=new n.TubeGeometry.FrenetFrames(e,t,a),O=_.tangents,z=_.normals,k=_.binormals;for(this.tangents=O,this.normals=z,this.binormals=k,v=0;I>v;v++)for(S[v]=[],h=v/(I-1),g=e.getPointAt(h),c=O[v],u=z[v],l=k[v],p=i*o(h),y=0;r>y;y++)d=y/r*2*Math.PI,f=-p*Math.cos(d),m=p*Math.sin(d),j.copy(g),j.x+=f*u.x+m*l.x,j.y+=f*u.y+m*l.y,j.z+=f*u.z+m*l.z,S[v][y]=s(j.x,j.y,j.z);for(v=0;t>v;v++)for(y=0;r>y;y++)M=a?(v+1)%t:v+1,A=(y+1)%r,x=S[v][y],w=S[M][y],E=S[M][A],b=S[v][A],T=new n.Vector2(v/t,y/r),L=new n.Vector2((v+1)/t,y/r),N=new n.Vector2((v+1)/t,(y+1)/r),D=new n.Vector2(v/t,(y+1)/r),this.faces.push(new n.Face3(x,w,b)),this.faceVertexUvs[0].push([T,L,D]),this.faces.push(new n.Face3(w,E,b)),this.faceVertexUvs[0].push([L.clone(),N,D.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},n.TubeGeometry.prototype=Object.create(n.Geometry.prototype),n.TubeGeometry.prototype.constructor=n.TubeGeometry,n.TubeGeometry.NoTaper=function(){return 1},n.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},n.TubeGeometry.FrenetFrames=function(e,t,i){function r(){f[0]=new n.Vector3,m[0]=new n.Vector3,o=Number.MAX_VALUE,s=Math.abs(p[0].x),c=Math.abs(p[0].y),u=Math.abs(p[0].z),o>=s&&(o=s,d.set(1,0,0)),o>=c&&(o=c,d.set(0,1,0)),o>=u&&d.set(0,0,1),g.crossVectors(p[0],d).normalize(),f[0].crossVectors(p[0],g),m[0].crossVectors(p[0],f[0])}var a,o,s,c,u,l,h,d=new n.Vector3,p=[],f=[],m=[],g=new n.Vector3,v=new n.Matrix4,y=t+1;for(this.tangents=p,this.normals=f,this.binormals=m,l=0;y>l;l++)h=l/(y-1),p[l]=e.getTangentAt(h),p[l].normalize();for(r(),l=1;y>l;l++)f[l]=f[l-1].clone(),m[l]=m[l-1].clone(),g.crossVectors(p[l-1],p[l]),g.length()>Number.EPSILON&&(g.normalize(),a=Math.acos(n.Math.clamp(p[l-1].dot(p[l]),-1,1)),f[l].applyMatrix4(v.makeRotationAxis(g,a))),m[l].crossVectors(p[l],f[l]);if(i)for(a=Math.acos(n.Math.clamp(f[0].dot(f[y-1]),-1,1)),a/=y-1,p[0].dot(g.crossVectors(f[0],f[y-1]))>0&&(a=-a),l=1;y>l;l++)f[l].applyMatrix4(v.makeRotationAxis(p[l],a*l)),m[l].crossVectors(p[l],f[l])},n.PolyhedronGeometry=function(e,t,i,r){function a(e){var t=e.normalize().clone();t.index=h.vertices.push(t)-1;var i=c(e)/2/Math.PI+.5,r=u(e)/Math.PI+.5;return t.uv=new n.Vector2(i,1-r),t}function o(e,t,i,r){var a=new n.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()],void 0,r);h.faces.push(a),A.copy(e).add(t).add(i).divideScalar(3);var o=c(A);h.faceVertexUvs[0].push([l(e.uv,e,o),l(t.uv,t,o),l(i.uv,i,o)])}function s(e,t){for(var i=Math.pow(2,t),r=a(h.vertices[e.a]),n=a(h.vertices[e.b]),s=a(h.vertices[e.c]),c=[],u=e.materialIndex,l=0;i>=l;l++){c[l]=[];for(var d=a(r.clone().lerp(s,l/i)),p=a(n.clone().lerp(s,l/i)),f=i-l,m=0;f>=m;m++)c[l][m]=0===m&&l===i?d:a(d.clone().lerp(p,m/f))}for(var l=0;i>l;l++)for(var m=0;2*(i-l)-1>m;m++){var g=Math.floor(m/2);m%2===0?o(c[l][g+1],c[l+1][g],c[l][g],u):o(c[l][g+1],c[l+1][g+1],c[l+1][g],u)}}function c(e){return Math.atan2(e.z,-e.x)}function u(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function l(e,t,i){return 0>i&&1===e.x&&(e=new n.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new n.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}n.Geometry.call(this),this.type=\"PolyhedronGeometry\",this.parameters={vertices:e,indices:t,radius:i,detail:r},i=i||1,r=r||0;for(var h=this,d=0,p=e.length;p>d;d+=3)a(new n.Vector3(e[d],e[d+1],e[d+2]));for(var f=this.vertices,m=[],d=0,g=0,p=t.length;p>d;d+=3,g++){var v=f[t[d]],y=f[t[d+1]],M=f[t[d+2]];m[g]=new n.Face3(v.index,y.index,M.index,[v.clone(),y.clone(),M.clone()],void 0,g)}for(var A=new n.Vector3,d=0,p=m.length;p>d;d++)s(m[d],r);for(var d=0,p=this.faceVertexUvs[0].length;p>d;d++){var x=this.faceVertexUvs[0][d],w=x[0].x,E=x[1].x,b=x[2].x,T=Math.max(w,E,b),L=Math.min(w,E,b);T>.9&&.1>L&&(.2>w&&(x[0].x+=1),.2>E&&(x[1].x+=1),.2>b&&(x[2].x+=1))}for(var d=0,p=this.vertices.length;p>d;d++)this.vertices[d].multiplyScalar(i);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,i)},n.PolyhedronGeometry.prototype=Object.create(n.Geometry.prototype),n.PolyhedronGeometry.prototype.constructor=n.PolyhedronGeometry,n.DodecahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,r=1/i,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];n.PolyhedronGeometry.call(this,a,o,e,t),this.type=\"DodecahedronGeometry\",this.parameters={radius:e,detail:t}},n.DodecahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.DodecahedronGeometry.prototype.constructor=n.DodecahedronGeometry,n.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];n.PolyhedronGeometry.call(this,r,a,e,t),this.type=\"IcosahedronGeometry\",this.parameters={radius:e,detail:t}},n.IcosahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.IcosahedronGeometry.prototype.constructor=n.IcosahedronGeometry,n.OctahedronGeometry=function(e,t){var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];n.PolyhedronGeometry.call(this,i,r,e,t),this.type=\"OctahedronGeometry\",this.parameters={radius:e,detail:t}},n.OctahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.OctahedronGeometry.prototype.constructor=n.OctahedronGeometry,n.TetrahedronGeometry=function(e,t){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];n.PolyhedronGeometry.call(this,i,r,e,t),this.type=\"TetrahedronGeometry\",this.parameters={radius:e,detail:t}},n.TetrahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.TetrahedronGeometry.prototype.constructor=n.TetrahedronGeometry,n.ParametricGeometry=function(e,t,i){n.Geometry.call(this),this.type=\"ParametricGeometry\",this.parameters={func:e,slices:t,stacks:i};var r,a,o,s,c,u=this.vertices,l=this.faces,h=this.faceVertexUvs[0],d=t+1;for(r=0;i>=r;r++)for(c=r/i,a=0;t>=a;a++)s=a/t,o=e(s,c),u.push(o);var p,f,m,g,v,y,M,A;for(r=0;i>r;r++)for(a=0;t>a;a++)p=r*d+a,f=r*d+a+1,m=(r+1)*d+a+1,g=(r+1)*d+a,v=new n.Vector2(a/t,r/i),y=new n.Vector2((a+1)/t,r/i),M=new n.Vector2((a+1)/t,(r+1)/i),A=new n.Vector2(a/t,(r+1)/i),l.push(new n.Face3(p,f,g)),h.push([v,y,A]),l.push(new n.Face3(f,m,g)),h.push([y.clone(),M,A.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},n.ParametricGeometry.prototype=Object.create(n.Geometry.prototype),n.ParametricGeometry.prototype.constructor=n.ParametricGeometry,n.WireframeGeometry=function(e){function t(e,t){return e-t}n.BufferGeometry.call(this);var i=[0,0],r={},a=[\"a\",\"b\",\"c\"];if(e instanceof n.Geometry){for(var o=e.vertices,s=e.faces,c=0,u=new Uint32Array(6*s.length),l=0,h=s.length;h>l;l++)for(var d=s[l],p=0;3>p;p++){i[0]=d[a[p]],i[1]=d[a[(p+1)%3]],i.sort(t);var f=i.toString();void 0===r[f]&&(u[2*c]=i[0],u[2*c+1]=i[1],r[f]=!0,c++)}for(var m=new Float32Array(2*c*3),l=0,h=c;h>l;l++)for(var p=0;2>p;p++){var g=o[u[2*l+p]],v=6*l+3*p;m[v+0]=g.x,m[v+1]=g.y,m[v+2]=g.z}this.addAttribute(\"position\",new n.BufferAttribute(m,3))}else if(e instanceof n.BufferGeometry)if(null!==e.index){var y=e.index.array,o=e.attributes.position,M=e.groups,c=0;0===M.length&&e.addGroup(0,y.length);for(var u=new Uint32Array(2*y.length),A=0,x=M.length;x>A;++A)for(var w=M[A],E=w.start,b=w.count,l=E,T=E+b;T>l;l+=3)for(var p=0;3>p;p++){i[0]=y[l+p],i[1]=y[l+(p+1)%3],i.sort(t);var f=i.toString();void 0===r[f]&&(u[2*c]=i[0],u[2*c+1]=i[1],r[f]=!0,c++)}for(var m=new Float32Array(2*c*3),l=0,h=c;h>l;l++)for(var p=0;2>p;p++){var v=6*l+3*p,L=u[2*l+p];m[v+0]=o.getX(L),m[v+1]=o.getY(L),m[v+2]=o.getZ(L)}this.addAttribute(\"position\",new n.BufferAttribute(m,3))}else{for(var o=e.attributes.position.array,c=o.length/3,N=c/3,m=new Float32Array(2*c*3),l=0,h=N;h>l;l++)for(var p=0;3>p;p++){var v=18*l+6*p,D=9*l+3*p;m[v+0]=o[D],m[v+1]=o[D+1],m[v+2]=o[D+2];var L=9*l+3*((p+1)%3);m[v+3]=o[L],m[v+4]=o[L+1],m[v+5]=o[L+2]}this.addAttribute(\"position\",new n.BufferAttribute(m,3))}},n.WireframeGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.WireframeGeometry.prototype.constructor=n.WireframeGeometry,n.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),i=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),r=new n.BufferGeometry;r.addAttribute(\"position\",new n.BufferAttribute(t,3)),r.addAttribute(\"color\",new n.BufferAttribute(i,3));var a=new n.LineBasicMaterial({vertexColors:n.VertexColors});n.LineSegments.call(this,r,a)},n.AxisHelper.prototype=Object.create(n.LineSegments.prototype),n.AxisHelper.prototype.constructor=n.AxisHelper,n.ArrowHelper=function(){var e=new n.Geometry;e.vertices.push(new n.Vector3(0,0,0),new n.Vector3(0,1,0));var t=new n.CylinderGeometry(0,.5,1,5,1);return t.translate(0,-.5,0),function(i,r,a,o,s,c){n.Object3D.call(this),void 0===o&&(o=16776960),void 0===a&&(a=1),void 0===s&&(s=.2*a),void 0===c&&(c=.2*s),this.position.copy(r),this.line=new n.Line(e,new n.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new n.Mesh(t,new n.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(a,s,c)}}(),n.ArrowHelper.prototype=Object.create(n.Object3D.prototype),n.ArrowHelper.prototype.constructor=n.ArrowHelper,n.ArrowHelper.prototype.setDirection=function(){var e,t=new n.Vector3;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),n.ArrowHelper.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},n.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},n.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new n.BufferGeometry;r.setIndex(new n.BufferAttribute(t,1)),r.addAttribute(\"position\",new n.BufferAttribute(i,3)),n.LineSegments.call(this,r,new n.LineBasicMaterial({color:16776960})),void 0!==e&&this.update(e)},n.BoxHelper.prototype=Object.create(n.LineSegments.prototype),n.BoxHelper.prototype.constructor=n.BoxHelper,n.BoxHelper.prototype.update=function(){var e=new n.Box3;return function(t){if(t instanceof n.Box3?e.copy(t):e.setFromObject(t),!e.isEmpty()){var i=e.min,r=e.max,a=this.geometry.attributes.position,o=a.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=i.x,o[4]=r.y,o[5]=r.z,o[6]=i.x,o[7]=i.y,o[8]=r.z,o[9]=r.x,o[10]=i.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=i.z,o[15]=i.x,o[16]=r.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=r.x,o[22]=i.y,o[23]=i.z,a.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),n.BoundingBoxHelper=function(e,t){var i=void 0!==t?t:8947848;this.object=e,this.box=new n.Box3,n.Mesh.call(this,new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial({color:i,wireframe:!0}))},n.BoundingBoxHelper.prototype=Object.create(n.Mesh.prototype),n.BoundingBoxHelper.prototype.constructor=n.BoundingBoxHelper,n.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},n.CameraHelper=function(e){function t(e,t,r){i(e,r),i(t,r)}function i(e,t){r.vertices.push(new n.Vector3),r.colors.push(new n.Color(t)),void 0===o[e]&&(o[e]=[]),o[e].push(r.vertices.length-1)}var r=new n.Geometry,a=new n.LineBasicMaterial({color:16777215,vertexColors:n.FaceColors}),o={},s=16755200,c=16711680,u=43775,l=16777215,h=3355443;t(\"n1\",\"n2\",s),t(\"n2\",\"n4\",s),t(\"n4\",\"n3\",s),t(\"n3\",\"n1\",s),t(\"f1\",\"f2\",s),t(\"f2\",\"f4\",s),t(\"f4\",\"f3\",s),t(\"f3\",\"f1\",s),t(\"n1\",\"f1\",s),t(\"n2\",\"f2\",s),t(\"n3\",\"f3\",s),t(\"n4\",\"f4\",s),t(\"p\",\"n1\",c),t(\"p\",\"n2\",c),t(\"p\",\"n3\",c),t(\"p\",\"n4\",c),t(\"u1\",\"u2\",u),t(\"u2\",\"u3\",u),t(\"u3\",\"u1\",u),t(\"c\",\"t\",l),t(\"p\",\"c\",h),t(\"cn1\",\"cn2\",h),t(\"cn3\",\"cn4\",h),t(\"cf1\",\"cf2\",h),t(\"cf3\",\"cf4\",h),n.LineSegments.call(this,r,a),this.camera=e,this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},n.CameraHelper.prototype=Object.create(n.LineSegments.prototype),n.CameraHelper.prototype.constructor=n.CameraHelper,n.CameraHelper.prototype.update=function(){function e(e,n,o,s){r.set(n,o,s).unproject(a);var c=i[e];if(void 0!==c)for(var u=0,l=c.length;l>u;u++)t.vertices[c[u]].copy(r)}var t,i,r=new n.Vector3,a=new n.Camera;return function(){t=this.geometry,i=this.pointMap;var r=1,n=1;a.projectionMatrix.copy(this.camera.projectionMatrix),e(\"c\",0,0,-1),e(\"t\",0,0,1),e(\"n1\",-r,-n,-1),e(\"n2\",r,-n,-1),e(\"n3\",-r,n,-1),e(\"n4\",r,n,-1),e(\"f1\",-r,-n,1),e(\"f2\",r,-n,1),e(\"f3\",-r,n,1),e(\"f4\",r,n,1),e(\"u1\",.7*r,1.1*n,-1),e(\"u2\",.7*-r,1.1*n,-1),e(\"u3\",0,2*n,-1),e(\"cf1\",-r,0,1),e(\"cf2\",r,0,1),e(\"cf3\",0,-n,1),e(\"cf4\",0,n,1),e(\"cn1\",-r,0,-1),e(\"cn2\",r,0,-1),e(\"cn3\",0,-n,-1),e(\"cn4\",0,n,-1),t.verticesNeedUpdate=!0}}(),n.DirectionalLightHelper=function(e,t){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var i=new n.Geometry;i.vertices.push(new n.Vector3(-t,t,0),new n.Vector3(t,t,0),new n.Vector3(t,-t,0),new n.Vector3(-t,-t,0),new n.Vector3(-t,t,0));var r=new n.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new n.Line(i,r),this.add(this.lightPlane),i=new n.Geometry,i.vertices.push(new n.Vector3,new n.Vector3),r=new n.LineBasicMaterial({fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new n.Line(i,r),this.add(this.targetLine),this.update()},n.DirectionalLightHelper.prototype=Object.create(n.Object3D.prototype),n.DirectionalLightHelper.prototype.constructor=n.DirectionalLightHelper,n.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},n.DirectionalLightHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3,i=new n.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(i),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(i),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)\n}}(),n.EdgesHelper=function(e,t,i){var r=void 0!==t?t:16777215;n.LineSegments.call(this,new n.EdgesGeometry(e.geometry,i),new n.LineBasicMaterial({color:r})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},n.EdgesHelper.prototype=Object.create(n.LineSegments.prototype),n.EdgesHelper.prototype.constructor=n.EdgesHelper,n.FaceNormalsHelper=function(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var a=void 0!==i?i:16776960,o=void 0!==r?r:1,s=0,c=this.object.geometry;c instanceof n.Geometry?s=c.faces.length:console.warn(\"THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.\");var u=new n.BufferGeometry,l=new n.Float32Attribute(2*s*3,3);u.addAttribute(\"position\",l),n.LineSegments.call(this,u,new n.LineBasicMaterial({color:a,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},n.FaceNormalsHelper.prototype=Object.create(n.LineSegments.prototype),n.FaceNormalsHelper.prototype.constructor=n.FaceNormalsHelper,n.FaceNormalsHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3,i=new n.Matrix3;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,n=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,c=0,u=0,l=s.length;l>u;u++){var h=s[u],d=h.normal;e.copy(o[h.a]).add(o[h.b]).add(o[h.c]).divideScalar(3).applyMatrix4(r),t.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),n.setXYZ(c,e.x,e.y,e.z),c+=1,n.setXYZ(c,t.x,t.y,t.z),c+=1}return n.needsUpdate=!0,this}}(),n.GridHelper=function(e,t){var i=new n.Geometry,r=new n.LineBasicMaterial({vertexColors:n.VertexColors});this.color1=new n.Color(4473924),this.color2=new n.Color(8947848);for(var a=-e;e>=a;a+=t){i.vertices.push(new n.Vector3(-e,0,a),new n.Vector3(e,0,a),new n.Vector3(a,0,-e),new n.Vector3(a,0,e));var o=0===a?this.color1:this.color2;i.colors.push(o,o,o,o)}n.LineSegments.call(this,i,r)},n.GridHelper.prototype=Object.create(n.LineSegments.prototype),n.GridHelper.prototype.constructor=n.GridHelper,n.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},n.HemisphereLightHelper=function(e,t){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new n.Color,new n.Color];var i=new n.SphereGeometry(t,4,2);i.rotateX(-Math.PI/2);for(var r=0,a=8;a>r;r++)i.faces[r].color=this.colors[4>r?0:1];var o=new n.MeshBasicMaterial({vertexColors:n.FaceColors,wireframe:!0});this.lightSphere=new n.Mesh(i,o),this.add(this.lightSphere),this.update()},n.HemisphereLightHelper.prototype=Object.create(n.Object3D.prototype),n.HemisphereLightHelper.prototype.constructor=n.HemisphereLightHelper,n.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},n.HemisphereLightHelper.prototype.update=function(){var e=new n.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),n.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var i=new n.SphereGeometry(t,4,2),r=new n.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),n.Mesh.call(this,i,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},n.PointLightHelper.prototype=Object.create(n.Mesh.prototype),n.PointLightHelper.prototype.constructor=n.PointLightHelper,n.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},n.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},n.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new n.Geometry,i=0;i<this.bones.length;i++){var r=this.bones[i];r.parent instanceof n.Bone&&(t.vertices.push(new n.Vector3),t.vertices.push(new n.Vector3),t.colors.push(new n.Color(0,0,1)),t.colors.push(new n.Color(0,1,0)))}t.dynamic=!0;var a=new n.LineBasicMaterial({vertexColors:n.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});n.LineSegments.call(this,t,a),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},n.SkeletonHelper.prototype=Object.create(n.LineSegments.prototype),n.SkeletonHelper.prototype.constructor=n.SkeletonHelper,n.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof n.Bone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},n.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new n.Matrix4).getInverse(this.root.matrixWorld),i=new n.Matrix4,r=0,a=0;a<this.bones.length;a++){var o=this.bones[a];o.parent instanceof n.Bone&&(i.multiplyMatrices(t,o.matrixWorld),e.vertices[r].setFromMatrixPosition(i),i.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[r+1].setFromMatrixPosition(i),r+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},n.SpotLightHelper=function(e){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;for(var t=new n.BufferGeometry,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,a=1,o=32;o>r;r++,a++){var s=r/o*Math.PI*2,c=a/o*Math.PI*2;i.push(Math.cos(s),Math.sin(s),1,Math.cos(c),Math.sin(c),1)}t.addAttribute(\"position\",new n.Float32Attribute(i,3));var u=new n.LineBasicMaterial({fog:!1});this.cone=new n.LineSegments(t,u),this.add(this.cone),this.update()},n.SpotLightHelper.prototype=Object.create(n.Object3D.prototype),n.SpotLightHelper.prototype.constructor=n.SpotLightHelper,n.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},n.SpotLightHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3;return function(){var i=this.light.distance?this.light.distance:1e3,r=i*Math.tan(this.light.angle);this.cone.scale.set(r,r,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),n.VertexNormalsHelper=function(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var a=void 0!==i?i:16711680,o=void 0!==r?r:1,s=0,c=this.object.geometry;c instanceof n.Geometry?s=3*c.faces.length:c instanceof n.BufferGeometry&&(s=c.attributes.normal.count);var u=new n.BufferGeometry,l=new n.Float32Attribute(2*s*3,3);u.addAttribute(\"position\",l),n.LineSegments.call(this,u,new n.LineBasicMaterial({color:a,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},n.VertexNormalsHelper.prototype=Object.create(n.LineSegments.prototype),n.VertexNormalsHelper.prototype.constructor=n.VertexNormalsHelper,n.VertexNormalsHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3,i=new n.Matrix3;return function(){var r=[\"a\",\"b\",\"c\"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var a=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s instanceof n.Geometry)for(var c=s.vertices,u=s.faces,l=0,h=0,d=u.length;d>h;h++)for(var p=u[h],f=0,m=p.vertexNormals.length;m>f;f++){var g=c[p[r[f]]],v=p.vertexNormals[f];e.copy(g).applyMatrix4(a),t.copy(v).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(l,e.x,e.y,e.z),l+=1,o.setXYZ(l,t.x,t.y,t.z),l+=1}else if(s instanceof n.BufferGeometry)for(var y=s.attributes.position,M=s.attributes.normal,l=0,f=0,m=y.count;m>f;f++)e.set(y.getX(f),y.getY(f),y.getZ(f)).applyMatrix4(a),t.set(M.getX(f),M.getY(f),M.getZ(f)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(l,e.x,e.y,e.z),l+=1,o.setXYZ(l,t.x,t.y,t.z),l+=1;return o.needsUpdate=!0,this}}(),n.WireframeHelper=function(e,t){var i=void 0!==t?t:16777215;n.LineSegments.call(this,new n.WireframeGeometry(e.geometry),new n.LineBasicMaterial({color:i})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},n.WireframeHelper.prototype=Object.create(n.LineSegments.prototype),n.WireframeHelper.prototype.constructor=n.WireframeHelper,n.ImmediateRenderObject=function(e){n.Object3D.call(this),this.material=e,this.render=function(){}},n.ImmediateRenderObject.prototype=Object.create(n.Object3D.prototype),n.ImmediateRenderObject.prototype.constructor=n.ImmediateRenderObject,n.MorphBlendMesh=function(e,t){n.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,r=\"__default\",a=0,o=i-1,s=i/1;this.createAnimation(r,a,o,s),this.setAnimationWeight(r,1)},n.MorphBlendMesh.prototype=Object.create(n.Mesh.prototype),n.MorphBlendMesh.prototype.constructor=n.MorphBlendMesh,n.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var n={start:t,end:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},n.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)_?(\\d+)/i,r={},n=this.geometry,a=0,o=n.morphTargets.length;o>a;a++){var s=n.morphTargets[a],c=s.name.match(i);if(c&&c.length>1){var u=c[1];r[u]||(r[u]={start:1/0,end:-1/0});var l=r[u];a<l.start&&(l.start=a),a>l.end&&(l.end=a),t||(t=u)}}for(var u in r){var l=r[u];this.createAnimation(u,l.start,l.end,e)}this.firstAnimation=t},n.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},n.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},n.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},n.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},n.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},n.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},n.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},n.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},n.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn(\"THREE.MorphBlendMesh: animation[\"+e+\"] undefined in .playAnimation()\")},n.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},n.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;i>t;t++){var r=this.animationsList[t];if(r.active){var a=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.start+n.Math.clamp(Math.floor(r.time/a),0,r.length-1),s=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*s,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var c=r.time%a/a;r.directionBackwards&&(c=1-c),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=c*s,this.morphTargetInfluences[r.lastFrame]=(1-c)*s):this.morphTargetInfluences[r.currentFrame]=s}}},\"undefined\"!=typeof r?(\"undefined\"!=typeof i&&i.exports&&(r=i.exports=n),r.THREE=n):this.THREE=n},{}],18:[function(e,i,r){!function(e){if(\"performance\"in e==!1&&(e.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},\"now\"in e.performance==!1){var t=e.performance.timing&&e.performance.timing.navigationStart?performance.timing.navigationStart:Date.now();e.performance.now=function(){return Date.now()-t}}}(this);var n=n||function(){var e=[];return{REVISION:\"14\",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},update:function(t){if(0===e.length)return!1;var i=0;for(t=void 0!==t?t:window.performance.now();i<e.length;)e[i].update(t)?i++:e.splice(i,1);return!0}}}();n.Tween=function(e){var t=e,i={},r={},a={},o=1e3,s=0,c=!1,u=!1,l=!1,h=0,d=null,p=n.Easing.Linear.None,f=n.Interpolation.Linear,m=[],g=null,v=!1,y=null,M=null,A=null;for(var x in e)i[x]=parseFloat(e[x],10);this.to=function(e,t){return void 0!==t&&(o=t),r=e,this},this.start=function(e){n.add(this),u=!0,v=!1,d=void 0!==e?e:window.performance.now(),d+=h;for(var o in r){if(r[o]instanceof Array){if(0===r[o].length)continue;r[o]=[t[o]].concat(r[o])}i[o]=t[o],i[o]instanceof Array==!1&&(i[o]*=1),a[o]=i[o]||0}return this},this.stop=function(){return u?(n.remove(this),u=!1,null!==A&&A.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=m.length;t>e;e++)m[e].stop()},this.delay=function(e){return h=e,this},this.repeat=function(e){return s=e,this},this.yoyo=function(e){return c=e,this},this.easing=function(e){return p=e,this},this.interpolation=function(e){return f=e,this},this.chain=function(){return m=arguments,this},this.onStart=function(e){return g=e,this},this.onUpdate=function(e){return y=e,this},this.onComplete=function(e){return M=e,this},this.onStop=function(e){return A=e,this},this.update=function(e){var n;if(d>e)return!0;v===!1&&(null!==g&&g.call(t),v=!0);var u=(e-d)/o;u=u>1?1:u;var A=p(u);for(n in r){var x=i[n]||0,w=r[n];w instanceof Array?t[n]=f(w,A):(\"string\"==typeof w&&(w=x+parseFloat(w,10)),\"number\"==typeof w&&(t[n]=x+(w-x)*A))}if(null!==y&&y.call(t,A),1==u){if(s>0){isFinite(s)&&s--;for(n in a){if(\"string\"==typeof r[n]&&(a[n]=a[n]+parseFloat(r[n],10)),c){var E=a[n];a[n]=r[n],r[n]=E}i[n]=a[n]}return c&&(l=!l),d=e+h,!0}null!==M&&M.call(t);for(var b=0,T=m.length;T>b;b++)m[b].start(e);return!1}return!0}},n.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,i=.1,r=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=r/4):t=r*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r)))},Out:function(e){var t,i=.1,r=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=r/4):t=r*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/r)+1)},InOut:function(e){var t,i=.1,r=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=r/4):t=r*Math.asin(1/i)/(2*Math.PI),(e*=2)<1?-.5*i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r):i*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-n.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*n.Easing.Bounce.In(2*e):.5*n.Easing.Bounce.Out(2*e-1)+.5}}},n.Interpolation={Linear:function(e,t){var i=e.length-1,r=i*t,a=Math.floor(r),o=n.Interpolation.Utils.Linear;return 0>t?o(e[0],e[1],r):t>1?o(e[i],e[i-1],i-r):o(e[a],e[a+1>i?i:a+1],r-a)},Bezier:function(e,t){var i,r=0,a=e.length-1,o=Math.pow,s=n.Interpolation.Utils.Bernstein;for(i=0;a>=i;i++)r+=o(1-t,a-i)*o(t,i)*e[i]*s(a,i);return r},CatmullRom:function(e,t){var i=e.length-1,r=i*t,a=Math.floor(r),o=n.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(0>t&&(a=Math.floor(r=i*(1+t))),o(e[(a-1+i)%i],e[a],e[(a+1)%i],e[(a+2)%i],r-a)):0>t?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):o(e[a?a-1:0],e[a],e[a+1>i?i:a+1],e[a+2>i?i:a+2],r-a)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=n.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i,r=1;if(e[t])return e[t];for(i=t;i>1;i--)r*=i;return e[t]=r}}(),CatmullRom:function(e,t,i,r,n){var a=.5*(i-e),o=.5*(r-t),s=n*n,c=n*s;return(2*t-2*i+a+o)*c+(-3*t+3*i-2*a-o)*s+a*n+t}}},function(e){\"function\"==typeof t&&t.amd?t([],function(){return n}):\"object\"==typeof r?i.exports=n:e.TWEEN=n}(this)},{}],19:[function(e){(function(i){!function r(t,i,n){function a(s,c){if(!i[s]){if(!t[s]){var u=\"function\"==typeof e&&e;if(!c&&u)return u(s,!0);if(o)return o(s,!0);var l=new Error(\"Cannot find module '\"+s+\"'\");throw l.code=\"MODULE_NOT_FOUND\",l}var h=i[s]={exports:{}};t[s][0].call(h.exports,function(e){var i=t[s][1][e];return a(i?i:e)},h,h.exports,r,t,i,n)}return i[s].exports}for(var o=\"function\"==typeof e&&e,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,t){function i(){u=!1,o.length?c=o.concat(c):l=-1,c.length&&r()}function r(){if(!u){var e=setTimeout(i);u=!0;for(var t=c.length;t;){for(o=c,c=[];++l<t;)o&&o[l].run();l=-1,t=c.length}o=null,u=!1,clearTimeout(e)}}function n(e,t){this.fun=e,this.array=t}function a(){}var o,s=t.exports={},c=[],u=!1,l=-1;s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new n(e,t)),1!==c.length||u||setTimeout(r,0)},n.prototype.run=function(){this.fun.apply(null,this.array)},s.title=\"browser\",s.browser=!0,s.env={},s.argv=[],s.version=\"\",s.versions={},s.on=a,s.addListener=a,s.once=a,s.off=a,s.removeListener=a,s.removeAllListeners=a,s.emit=a,s.binding=function(){throw new Error(\"process.binding is not supported\")},s.cwd=function(){return\"/\"},s.chdir=function(){throw new Error(\"process.chdir is not supported\")},s.umask=function(){return 0}},{}],2:[function(e,r){(function(i,n){(function(){\"use strict\";function a(e){return\"function\"==typeof e||\"object\"==typeof e&&null!==e}function o(e){return\"function\"==typeof e}function s(e){H=e}function c(e){Z=e}function u(){return function(){i.nextTick(f)}}function l(){return function(){Y(f)}}function h(){var e=0,t=new $(f),i=document.createTextNode(\"\");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=f,function(){e.port2.postMessage(0)}}function p(){return function(){setTimeout(f,1)}}function f(){for(var e=0;q>e;e+=2){var t=it[e],i=it[e+1];t(i),it[e]=void 0,it[e+1]=void 0}q=0}function m(){try{var t=e,i=t(\"vertx\");return Y=i.runOnLoop||i.runOnContext,l()}catch(r){return p()}}function g(e,t){var i=this,r=i._state;if(r===ot&&!e||r===st&&!t)return this;var n=new this.constructor(y),a=i._result;if(r){var o=arguments[r-1];Z(function(){O(r,n,o,a)})}else C(i,n,e,t);return n}function v(e){var t=this;if(e&&\"object\"==typeof e&&e.constructor===t)return e;var i=new t(y);return L(i,e),i}function y(){}function M(){return new TypeError(\"You cannot resolve a promise with itself\")}function A(){return new TypeError(\"A promises callback cannot return that same promise.\")}function x(e){try{return e.then}catch(t){return ct.error=t,ct}}function w(e,t,i,r){try{e.call(t,i,r)}catch(n){return n}}function E(e,t,i){Z(function(e){var r=!1,n=w(i,t,function(i){r||(r=!0,t!==i?L(e,i):D(e,i))},function(t){r||(r=!0,S(e,t))},\"Settle: \"+(e._label||\" unknown promise\"));!r&&n&&(r=!0,S(e,n))},e)}function b(e,t){t._state===ot?D(e,t._result):t._state===st?S(e,t._result):C(t,void 0,function(t){L(e,t)},function(t){S(e,t)})}function T(e,t,i){t.constructor===e.constructor&&i===rt&&constructor.resolve===nt?b(e,t):i===ct?S(e,ct.error):void 0===i?D(e,t):o(i)?E(e,t,i):D(e,t)}function L(e,t){e===t?S(e,M()):a(t)?T(e,t,x(t)):D(e,t)}function N(e){e._onerror&&e._onerror(e._result),I(e)}function D(e,t){e._state===at&&(e._result=t,e._state=ot,0!==e._subscribers.length&&Z(I,e))}function S(e,t){e._state===at&&(e._state=st,e._result=t,Z(N,e))}function C(e,t,i,r){var n=e._subscribers,a=n.length;e._onerror=null,n[a]=t,n[a+ot]=i,n[a+st]=r,0===a&&e._state&&Z(I,e)}function I(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var r,n,a=e._result,o=0;o<t.length;o+=3)r=t[o],n=t[o+i],r?O(i,r,n,a):n(a);e._subscribers.length=0}}function j(){this.error=null}function _(e,t){try{return e(t)}catch(i){return ut.error=i,ut}}function O(e,t,i,r){var n,a,s,c,u=o(i);if(u){if(n=_(i,r),n===ut?(c=!0,a=n.error,n=null):s=!0,t===n)return S(t,A()),void 0}else n=r,s=!0;t._state!==at||(u&&s?L(t,n):c?S(t,a):e===ot?D(t,n):e===st&&S(t,n))}function z(e,t){try{t(function(t){L(e,t)},function(t){S(e,t)})}catch(i){S(e,i)}}function k(e){return new mt(this,e).promise}function R(e){function t(e){L(n,e)}function i(e){S(n,e)}var r=this,n=new r(y);if(!X(e))return S(n,new TypeError(\"You must pass an array to race.\")),n;for(var a=e.length,o=0;n._state===at&&a>o;o++)C(r.resolve(e[o]),void 0,t,i);return n}function B(e){var t=this,i=new t(y);return S(i,e),i}function U(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}function P(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}function F(e){this._id=pt++,this._state=void 0,this._result=void 0,this._subscribers=[],y!==e&&(\"function\"!=typeof e&&U(),this instanceof F?z(this,e):P())}function G(e,t){this._instanceConstructor=e,this.promise=new e(y),Array.isArray(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?D(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&D(this.promise,this._result))):S(this.promise,this._validationError())}function V(){var e;if(\"undefined\"!=typeof n)e=n;else if(\"undefined\"!=typeof self)e=self;else try{e=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var i=e.Promise;(!i||\"[object Promise]\"!==Object.prototype.toString.call(i.resolve())||i.cast)&&(e.Promise=ft)}var Q;Q=Array.isArray?Array.isArray:function(e){return\"[object Array]\"===Object.prototype.toString.call(e)};var Y,H,W,X=Q,q=0,Z=function(e,t){it[q]=e,it[q+1]=t,q+=2,2===q&&(H?H(f):W())},K=\"undefined\"!=typeof window?window:void 0,J=K||{},$=J.MutationObserver||J.WebKitMutationObserver,et=\"undefined\"!=typeof i&&\"[object process]\"==={}.toString.call(i),tt=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel,it=new Array(1e3);W=et?u():$?h():tt?d():void 0===K&&\"function\"==typeof e?m():p();var rt=g,nt=v,at=void 0,ot=1,st=2,ct=new j,ut=new j,lt=k,ht=R,dt=B,pt=0,ft=F;F.all=lt,F.race=ht,F.resolve=nt,F.reject=dt,F._setScheduler=s,F._setAsap=c,F._asap=Z,F.prototype={constructor:F,then:rt,\"catch\":function(e){return this.then(null,e)}};var mt=G;G.prototype._validationError=function(){return new Error(\"Array Methods must be provided an Array\")},G.prototype._enumerate=function(){for(var e=this.length,t=this._input,i=0;this._state===at&&e>i;i++)this._eachEntry(t[i],i)},G.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===nt){var n=x(e);if(n===rt&&e._state!==at)this._settledAt(e._state,t,e._result);else if(\"function\"!=typeof n)this._remaining--,this._result[t]=e;else if(i===ft){var a=new i(y);T(a,e,n),this._willSettleAt(a,t)}else this._willSettleAt(new i(function(t){t(e)}),t)}else this._willSettleAt(r(e),t)},G.prototype._settledAt=function(e,t,i){var r=this.promise;r._state===at&&(this._remaining--,e===st?S(r,i):this._result[t]=i),0===this._remaining&&D(r,this._result)},G.prototype._willSettleAt=function(e,t){var i=this;C(e,void 0,function(e){i._settledAt(ot,t,e)},function(e){i._settledAt(st,t,e)})};var gt=V,vt={Promise:ft,polyfill:gt};\"function\"==typeof t&&t.amd?t(function(){return vt}):\"undefined\"!=typeof r&&r.exports?r.exports=vt:\"undefined\"!=typeof this&&(this.ES6Promise=vt),gt()}).call(this)}).call(this,e(\"_process\"),\"undefined\"!=typeof i?i:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{_process:1}],3:[function(e,t){\"use strict\";function i(e){if(null===e||void 0===e)throw new TypeError(\"Object.assign cannot be called with null or undefined\");return Object(e)}var r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;t.exports=Object.assign||function(e){for(var t,a,o=i(e),s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var c in t)r.call(t,c)&&(o[c]=t[c]);if(Object.getOwnPropertySymbols){a=Object.getOwnPropertySymbols(t);for(var u=0;u<a.length;u++)n.call(t,a[u])&&(o[a[u]]=t[a[u]])}}return o}},{}],4:[function(e,t){function i(){this.isPolyfilled=!0,this.displayId=c++,this.displayName=\"webvr-polyfill displayName\",this.isConnected=!0,this.isPresenting=!1,this.capabilities={hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1},this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,this.wakelock_=new s,this.presentModeClassName=\"WEBVR_POLYFILL_PRESENT\"}function r(){this.isPolyfilled=!0,this.hardwareUnitId=\"webvr-polyfill hardwareUnitId\",this.deviceId=\"webvr-polyfill deviceId\",this.deviceName=\"webvr-polyfill deviceName\"}function n(){}function a(){}var o=e(\"./util.js\"),s=e(\"./wakelock.js\"),c=1e3,u=!1;i.prototype.getPose=function(){return this.getImmediatePose()},i.prototype.requestAnimationFrame=function(e){return window.requestAnimationFrame(e)},i.prototype.cancelAnimationFrame=function(e){return window.cancelAnimationFrame(e)},i.prototype.wrapForFullscreen=function(e){if(o.isIOS())return e;if(this.fullscreenWrapper_||(this.fullscreenWrapper_=document.createElement(\"div\"),this.fullscreenWrapper_.classList.add(\"webvr-polyfill-fullscreen-wrapper\"),this.fullscreenWrapper_.style.width=\"100%\",this.fullscreenWrapper_.style.height=\"100%\"),this.fullscreenElement_==e)return this.fullscreenWrapper_;this.removeFullscreenWrapper(),this.fullscreenElement_=e;var t=this.fullscreenElement_.parentElement;return t.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),t.removeChild(this.fullscreenElement_),this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenWrapper_},i.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElement_=null;var t=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),t.insertBefore(e,this.fullscreenWrapper_),t.removeChild(this.fullscreenWrapper_),e}},i.prototype.requestPresent=function(e){var t=this;return e instanceof Array||(u||(console.warn(\"Using a deprecated form of requestPresent. Should pass in an array of VRLayers.\"),u=!0),e=[e]),new Promise(function(i,r){function n(){var e=o.getFullscreenElement();t.isPresenting=s===e,t.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock(\"landscape-primary\"),t.waitingForPresent_=!1,t.beginPresent_(),t.setForceCanvasFullscreen_(!0),i()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),t.setForceCanvasFullscreen_(!1),t.removeFullscreenWrapper(),t.wakelock_.release(),t.endPresent_(),t.removeFullscreenListeners_()),t.fireVRDisplayPresentChange_()}function a(){t.waitingForPresent_&&(t.removeFullscreenWrapper(),t.removeFullscreenListeners_(),t.wakelock_.release(),t.waitingForPresent_=!1,t.isPresenting=!1,r(new Error(\"Unable to present.\")))}if(!t.capabilities.canPresent)return r(new Error(\"VRDisplay is not capable of presenting.\")),void 0;if(0==e.length||e.length>t.capabilities.maxLayers)return r(new Error(\"Invalid number of layers.\")),void 0;if(t.layer_=e[0],t.waitingForPresent_=!1,t.layer_&&t.layer_.source){var s=t.wrapForFullscreen(t.layer_.source);t.addFullscreenListeners_(s,n,a),o.requestFullscreen(s)?(t.wakelock_.request(),t.waitingForPresent_=!0):o.isIOS()&&(t.wakelock_.request(),t.isPresenting=!0,t.beginPresent_(),t.fireVRDisplayPresentChange_(),i())}t.waitingForPresent_||o.isIOS()||(o.exitFullscreen(),r(new Error(\"Unable to present.\")))})},i.prototype.exitPresent=function(){var e=this.isPresenting,t=this;return this.isPresenting=!1,this.layer_=null,this.wakelock_.release(),new Promise(function(i,r){e?(!o.exitFullscreen()&&o.isIOS()&&(t.endPresent_(),t.fireVRDisplayPresentChange_()),i()):r(new Error(\"Was not presenting to VRDisplay.\"))})},i.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},i.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent(\"vrdisplaypresentchange\",{detail:{vrdisplay:this}});window.dispatchEvent(e)},i.prototype.addFullscreenListeners_=function(e,t,i){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=t,this.fullscreenErrorHandler_=i,t&&(e.addEventListener(\"fullscreenchange\",t,!1),e.addEventListener(\"webkitfullscreenchange\",t,!1),document.addEventListener(\"mozfullscreenchange\",t,!1),e.addEventListener(\"msfullscreenchange\",t,!1)),i&&(e.addEventListener(\"fullscreenerror\",i,!1),e.addEventListener(\"webkitfullscreenerror\",i,!1),document.addEventListener(\"mozfullscreenerror\",i,!1),e.addEventListener(\"msfullscreenerror\",i,!1))},i.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var t=this.fullscreenChangeHandler_;e.removeEventListener(\"fullscreenchange\",t,!1),e.removeEventListener(\"webkitfullscreenchange\",t,!1),document.removeEventListener(\"mozfullscreenchange\",t,!1),e.removeEventListener(\"msfullscreenchange\",t,!1)}if(this.fullscreenErrorHandler_){var i=this.fullscreenErrorHandler_;e.removeEventListener(\"fullscreenerror\",i,!1),e.removeEventListener(\"webkitfullscreenerror\",i,!1),document.removeEventListener(\"mozfullscreenerror\",i,!1),e.removeEventListener(\"msfullscreenerror\",i,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},i.prototype.beginPresent_=function(){},i.prototype.endPresent_=function(){},i.prototype.submitFrame=function(){},i.prototype.getEyeParameters=function(){return null},i.prototype.setForceCanvasFullscreen_=function(e){e?this.fullscreenElement_.classList.add(this.presentModeClassName):this.fullscreenElement_.classList.remove(this.presentModeClassName)},n.prototype=new r,a.prototype=new r,t.exports.VRDisplay=i,t.exports.VRDevice=r,t.exports.HMDVRDevice=n,t.exports.PositionSensorVRDevice=a},{\"./util.js\":24,\"./wakelock.js\":26}],5:[function(e,t){function i(e){this.gl=e,this.ctxAttribs=e.getContextAttributes(),this.meshWidth=20,this.meshHeight=20,this.bufferScale=WebVRConfig.BUFFER_SCALE,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,n.isIOS()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,\"width\"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,\"height\")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=n.linkProgram(e,o,s,this.attribs),this.uniforms=n.getProgramUniforms(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize(),WebVRConfig.CARDBOARD_UI_DISABLED||(this.cardboardUI=new r(e))\n}var r=e(\"./cardboard-ui.js\"),n=e(\"./util.js\"),a=e(\"./deps/wglu-preserve-state.js\"),o=[\"attribute vec2 position;\",\"attribute vec3 texCoord;\",\"varying vec2 vTexCoord;\",\"uniform vec4 viewportOffsetScale[2];\",\"void main() {\",\"  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\",\"  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\",\"  gl_Position = vec4( position, 1.0, 1.0 );\",\"}\"].join(\"\\n\"),s=[\"precision mediump float;\",\"uniform sampler2D diffuse;\",\"varying vec2 vTexCoord;\",\"void main() {\",\"  gl_FragColor = texture2D(diffuse, vTexCoord);\",\"}\"].join(\"\\n\");i.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},i.prototype.onResize=function(){var e=this.gl,t=this,i=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];a(e,i,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.framebuffer),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.texImage2D(e.TEXTURE_2D,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,t.bufferWidth,t.bufferHeight,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.renderTarget,0),t.ctxAttribs.depth&&t.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t.depthStencilBuffer)):t.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)):t.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,t.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t.stencilBuffer)),!e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&console.error(\"Framebuffer incomplete!\"),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),t.realClearColor.apply(e,t.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},i.prototype.patch=function(){if(!this.isPatched){var e=this,t=this.gl.canvas,i=this.gl;n.isIOS()||(t.width=n.getScreenWidth()*this.bufferScale,t.height=n.getScreenHeight()*this.bufferScale,Object.defineProperty(t,\"width\",{configurable:!0,enumerable:!0,get:function(){return e.bufferWidth},set:function(t){e.bufferWidth=t,e.onResize()}}),Object.defineProperty(t,\"height\",{configurable:!0,enumerable:!0,get:function(){return e.bufferHeight},set:function(t){e.bufferHeight=t,e.onResize()}})),this.lastBoundFramebuffer=i.getParameter(i.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(t,r){e.lastBoundFramebuffer=r?r:e.framebuffer,e.realBindFramebuffer.call(i,t,e.lastBoundFramebuffer)},this.cullFace=i.getParameter(i.CULL_FACE),this.depthTest=i.getParameter(i.DEPTH_TEST),this.blend=i.getParameter(i.BLEND),this.scissorTest=i.getParameter(i.SCISSOR_TEST),this.stencilTest=i.getParameter(i.STENCIL_TEST),i.enable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!0;break;case i.DEPTH_TEST:e.depthTest=!0;break;case i.BLEND:e.blend=!0;break;case i.SCISSOR_TEST:e.scissorTest=!0;break;case i.STENCIL_TEST:e.stencilTest=!0}e.realEnable.call(i,t)},i.disable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!1;break;case i.DEPTH_TEST:e.depthTest=!1;break;case i.BLEND:e.blend=!1;break;case i.SCISSOR_TEST:e.scissorTest=!1;break;case i.STENCIL_TEST:e.stencilTest=!1}e.realDisable.call(i,t)},this.colorMask=i.getParameter(i.COLOR_WRITEMASK),i.colorMask=function(t,r,n,a){e.colorMask[0]=t,e.colorMask[1]=r,e.colorMask[2]=n,e.colorMask[3]=a,e.realColorMask.call(i,t,r,n,a)},this.clearColor=i.getParameter(i.COLOR_CLEAR_VALUE),i.clearColor=function(t,r,n,a){e.clearColor[0]=t,e.clearColor[1]=r,e.clearColor[2]=n,e.clearColor[3]=a,e.realClearColor.call(i,t,r,n,a)},this.viewport=i.getParameter(i.VIEWPORT),i.viewport=function(t,r,n,a){e.viewport[0]=t,e.viewport[1]=r,e.viewport[2]=n,e.viewport[3]=a,e.realViewport.call(i,t,r,n,a)},this.isPatched=!0}},i.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,t=this.gl.canvas;n.isIOS()||(Object.defineProperty(t,\"width\",this.realCanvasWidth),Object.defineProperty(t,\"height\",this.realCanvasHeight)),t.width=this.bufferWidth,t.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1}},i.prototype.setTextureBounds=function(e,t){e||(e=[0,0,.5,1]),t||(t=[.5,0,.5,1]),this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=t[0],this.viewportOffsetScale[5]=t[1],this.viewportOffsetScale[6]=t[2],this.viewportOffsetScale[7]=t[3]},i.prototype.submitFrame=function(){var e=this.gl,t=this,i=[];if(WebVRConfig.DIRTY_SUBMIT_FRAME_BINDINGS||i.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),a(e,i,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.cullFace&&t.realDisable.call(e,e.CULL_FACE),t.depthTest&&t.realDisable.call(e,e.DEPTH_TEST),t.blend&&t.realDisable.call(e,e.BLEND),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realDisable.call(e,e.STENCIL_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(t.ctxAttribs.alpha||n.isIOS())&&(t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(t.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(t.attribs.position),e.enableVertexAttribArray(t.attribs.texCoord),e.vertexAttribPointer(t.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(t.attribs.texCoord,3,e.FLOAT,!1,20,8),e.activeTexture(e.TEXTURE0),e.uniform1i(t.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.uniform4fv(t.uniforms.viewportOffsetScale,t.viewportOffsetScale),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_SHORT,0),t.cardboardUI&&t.cardboardUI.renderNoState(),t.realBindFramebuffer.call(t.gl,e.FRAMEBUFFER,t.framebuffer),t.ctxAttribs.preserveDrawingBuffer||(t.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),WebVRConfig.DIRTY_SUBMIT_FRAME_BINDINGS||t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.cullFace&&t.realEnable.call(e,e.CULL_FACE),t.depthTest&&t.realEnable.call(e,e.DEPTH_TEST),t.blend&&t.realEnable.call(e,e.BLEND),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realEnable.call(e,e.STENCIL_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),(t.ctxAttribs.alpha||!t.ctxAttribs.preserveDrawingBuffer)&&t.realClearColor.apply(e,t.clearColor)}),n.isIOS()){var r=e.canvas;(r.width!=t.bufferWidth||r.height!=t.bufferHeight)&&(t.bufferWidth=r.width,t.bufferHeight=r.height,t.onResize())}},i.prototype.updateDeviceInfo=function(e){var t=this.gl,i=this,r=[t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING];a(t,r,function(t){var r=i.computeMeshVertices_(i.meshWidth,i.meshHeight,e);if(t.bindBuffer(t.ARRAY_BUFFER,i.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),!i.indexCount){var n=i.computeMeshIndices_(i.meshWidth,i.meshHeight);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW),i.indexCount=n.length}})},i.prototype.computeMeshVertices_=function(e,t,i){for(var r=new Float32Array(2*e*t*5),a=i.getLeftEyeVisibleTanAngles(),o=i.getLeftEyeNoLensTanAngles(),s=i.getLeftEyeVisibleScreenRect(o),c=0,u=0;2>u;u++){for(var l=0;t>l;l++)for(var h=0;e>h;h++,c++){var d=h/(e-1),p=l/(t-1),f=d,m=p,g=n.lerp(a[0],a[2],d),v=n.lerp(a[3],a[1],p),y=Math.sqrt(g*g+v*v),M=i.distortion.distortInverse(y),A=g*M/y,x=v*M/y;d=(A-o[0])/(o[2]-o[0]),p=(x-o[3])/(o[1]-o[3]);{i.device.widthMeters/i.device.heightMeters}d=2*(s.x+d*s.width-.5),p=2*(s.y+p*s.height-.5),r[5*c+0]=d,r[5*c+1]=p,r[5*c+2]=f,r[5*c+3]=m,r[5*c+4]=u}var w=a[2]-a[0];a[0]=-(w+a[0]),a[2]=w-a[2],w=o[2]-o[0],o[0]=-(w+o[0]),o[2]=w-o[2],s.x=1-(s.x+s.width)}return r},i.prototype.computeMeshIndices_=function(e,t){for(var i=new Uint16Array(2*(e-1)*(t-1)*6),r=e/2,n=t/2,a=0,o=0,s=0;2>s;s++)for(var c=0;t>c;c++)for(var u=0;e>u;u++,a++)0!=u&&0!=c&&(r>=u==n>=c?(i[o++]=a,i[o++]=a-e-1,i[o++]=a-e,i[o++]=a-e-1,i[o++]=a,i[o++]=a-1):(i[o++]=a-1,i[o++]=a-e,i[o++]=a,i[o++]=a-e,i[o++]=a-1,i[o++]=a-e-1));return i},i.prototype.getOwnPropertyDescriptor_=function(e,t){var i=Object.getOwnPropertyDescriptor(e,t);return(void 0===i.get||void 0===i.set)&&(i.configurable=!0,i.enumerable=!0,i.get=function(){return this.getAttribute(t)},i.set=function(e){this.setAttribute(t,e)}),i},t.exports=i},{\"./cardboard-ui.js\":6,\"./deps/wglu-preserve-state.js\":8,\"./util.js\":24}],6:[function(e,t){function i(e){this.gl=e,this.attribs={position:0},this.program=r.linkProgram(e,a,o,this.attribs),this.uniforms=r.getProgramUniforms(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}var r=e(\"./util.js\"),n=e(\"./deps/wglu-preserve-state.js\"),a=[\"attribute vec2 position;\",\"uniform mat4 projectionMat;\",\"void main() {\",\"  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\",\"}\"].join(\"\\n\"),o=[\"precision mediump float;\",\"uniform vec4 color;\",\"void main() {\",\"  gl_FragColor = color;\",\"}\"].join(\"\\n\"),s=Math.PI/180,c=60,u=12,l=20,h=1,d=.75,p=.3125,f=4,m=28,g=1.5;i.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener(\"click\",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},i.prototype.listen=function(e,t){var i=this.gl.canvas;this.listener=function(r){var n=i.clientWidth/2,a=m*g;r.clientX>n-a&&r.clientX<n+a&&r.clientY>i.clientHeight-a?e(r):r.clientX<a&&r.clientY<a&&t(r)},i.addEventListener(\"click\",this.listener,!1)},i.prototype.onResize=function(){var e=this.gl,t=this,i=[e.ARRAY_BUFFER_BINDING];n(e,i,function(e){function i(e,t){var i=(90-e)*s,r=Math.cos(i),n=Math.sin(i);a.push(p*r*A+o,p*n*A+A),a.push(t*r*A+o,t*n*A+A)}function n(t,i){a.push(x+t,e.drawingBufferHeight-x-i)}var a=[],o=e.drawingBufferWidth/2,v=e.drawingBufferWidth/(screen.width*window.devicePixelRatio);r.isIOS()||(v*=window.devicePixelRatio);var y=f*v/2,M=m*g*v,A=m*v/2,x=(m*g-m)*v;a.push(o-y,M),a.push(o-y,e.drawingBufferHeight),a.push(o+y,M),a.push(o+y,e.drawingBufferHeight),t.gearOffset=a.length/2;for(var w=0;6>=w;w++){var E=w*c;i(E,h),i(E+u,h),i(E+l,d),i(E+(c-l),d),i(E+(c-u),h)}t.gearVertexCount=a.length/2-t.gearOffset,t.arrowOffset=a.length/2;var b=y/Math.sin(45*s);n(0,A),n(A,0),n(A+b,b),n(b,A+b),n(b,A-b),n(0,A),n(A,2*A),n(A+b,2*A-b),n(b,A-b),n(0,A),n(b,A-y),n(m*v,A-y),n(b,A+y),n(m*v,A+y),t.arrowVertexCount=a.length/2-t.arrowOffset,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(a),e.STATIC_DRAW)})},i.prototype.render=function(){var e=this.gl,t=this,i=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];n(e,i,function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.renderNoState()})},i.prototype.renderNoState=function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(this.attribs.position),e.vertexAttribPointer(this.attribs.position,2,e.FLOAT,!1,8,0),e.uniform4f(this.uniforms.color,1,1,1,1),r.orthoMatrix(this.projMat,0,e.drawingBufferWidth,0,e.drawingBufferHeight,.1,1024),e.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.drawArrays(e.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),e.drawArrays(e.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},t.exports=i},{\"./deps/wglu-preserve-state.js\":8,\"./util.js\":24}],7:[function(e,t){function i(){this.displayName=\"Cardboard VRDisplay (webvr-polyfill)\",this.capabilities.hasOrientation=!0,this.capabilities.canPresent=!0,this.bufferScale_=WebVRConfig.BUFFER_SCALE,this.poseSensor_=new s,this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new o(!0,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new a(this.dpdb_.getDeviceParams()),this.viewerSelector_=new u,this.viewerSelector_.on(\"change\",this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.injectPresentModeCssClass_(),WebVRConfig.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new c)}var r=e(\"./cardboard-distorter.js\"),n=e(\"./cardboard-ui.js\"),a=e(\"./device-info.js\"),o=e(\"./dpdb/dpdb.js\"),s=e(\"./sensor-fusion/fusion-pose-sensor.js\"),c=e(\"./rotate-instructions.js\"),u=e(\"./viewer-selector.js\"),l=e(\"./base.js\").VRDisplay,h=e(\"./util.js\"),d={LEFT:\"left\",RIGHT:\"right\"};i.prototype=new l,i.prototype.getImmediatePose=function(){return{position:this.poseSensor_.getPosition(),orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},i.prototype.resetPose=function(){this.poseSensor_.resetPose()},i.prototype.getEyeParameters=function(e){var t,i=[.5*this.deviceInfo_.viewer.interLensDistance,0,0];if(e==d.LEFT)i[0]*=-1,t=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=d.RIGHT)return console.error(\"Invalid eye provided: %s\",e),null;t=this.deviceInfo_.getFieldOfViewRightEye()}return{fieldOfView:t,offset:i,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_}},i.prototype.onDeviceParamsUpdated_=function(e){console.log(\"DPDB reported that device params were updated.\"),this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter.updateDeviceInfo(this.deviceInfo_)},i.prototype.beginPresent_=function(){var e=this.layer_.source.getContext(\"webgl\");e||(e=this.layer_.source.getContext(\"experimental-webgl\")),e||(e=this.layer_.source.getContext(\"webgl2\")),e&&(this.layer_.predistorted?WebVRConfig.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new n(e)):(this.distorter_=new r(e),this.distorter_.updateDeviceInfo(this.deviceInfo_),this.cardboardUI_=this.distorter_.cardboardUI,(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)),this.carboardUI_&&this.cardboardUI_.listen(function(){this.viewerSelector_.show(this.layer_.source.parentElement)}.bind(this),function(){this.exitPresent()}.bind(this)),this.rotateInstructions_&&(h.isLandscapeMode()&&h.isMobile()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener(\"orientationchange\",this.orientationHandler),this.fireVRDisplayDeviceParamsChange_())},i.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener(\"orientationchange\",this.orientationHandler)},i.prototype.submitFrame=function(){this.distorter_?this.distorter_.submitFrame():this.cardboardUI_&&this.cardboardUI_.render()},i.prototype.onOrientationChange_=function(){console.log(\"onOrientationChange_\"),this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update()},i.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},i.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent(\"vrdisplaydeviceparamschange\",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},i.prototype.injectPresentModeCssClass_=function(){var e=[\"width: 100% !important\",\"height: 100% !important\",\"top: 0 !important\",\"left: 0 !important\",\"right: 0 !important\",\"bottom: 0 !important\",\"z-index: 999999 !important\",\"position: fixed\"],t=document.createElement(\"style\");t.type=\"text/css\",t.innerHTML=\".\"+this.presentModeClassName+\"{\"+e.join(\";\")+\"}\",document.getElementsByTagName(\"head\")[0].appendChild(t)},t.exports=i},{\"./base.js\":4,\"./cardboard-distorter.js\":5,\"./cardboard-ui.js\":6,\"./device-info.js\":9,\"./dpdb/dpdb.js\":13,\"./rotate-instructions.js\":18,\"./sensor-fusion/fusion-pose-sensor.js\":20,\"./util.js\":24,\"./viewer-selector.js\":25}],8:[function(e,t){function i(e,t,i){if(!t)return i(e),void 0;for(var r=[],n=null,a=0;a<t.length;++a){var o=t[a];switch(o){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:var s=t[++a];if(s<e.TEXTURE0||s>e.TEXTURE31){console.error(\"TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit\"),r.push(null,null);break}n||(n=e.getParameter(e.ACTIVE_TEXTURE)),e.activeTexture(s),r.push(e.getParameter(o),null);break;case e.ACTIVE_TEXTURE:n=e.getParameter(e.ACTIVE_TEXTURE),r.push(null);break;default:r.push(e.getParameter(o))}}i(e);for(var a=0;a<t.length;++a){var o=t[a],c=r[a];switch(o){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,c);break;case e.COLOR_CLEAR_VALUE:e.clearColor(c[0],c[1],c[2],c[3]);break;case e.COLOR_WRITEMASK:e.colorMask(c[0],c[1],c[2],c[3]);break;case e.CURRENT_PROGRAM:e.useProgram(c);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,c);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,c);break;case e.TEXTURE_BINDING_2D:var s=t[++a];if(s<e.TEXTURE0||s>e.TEXTURE31)break;e.activeTexture(s),e.bindTexture(e.TEXTURE_2D,c);break;case e.TEXTURE_BINDING_CUBE_MAP:var s=t[++a];if(s<e.TEXTURE0||s>e.TEXTURE31)break;e.activeTexture(s),e.bindTexture(e.TEXTURE_CUBE_MAP,c);break;case e.VIEWPORT:e.viewport(c[0],c[1],c[2],c[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:c?e.enable(o):e.disable(o);break;default:console.log(\"No GL restore behavior for 0x\"+o.toString(16))}n&&e.activeTexture(n)}}t.exports=i},{}],9:[function(e,t){function i(e){this.width=e.width||s.getScreenWidth(),this.height=e.height||s.getScreenHeight(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}function r(e){this.viewer=l.CardboardV2,this.updateDeviceParams(e),this.distortion=new a(this.viewer.distortionCoefficients)}function n(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}var a=e(\"./distortion/distortion.js\"),o=e(\"./math-util.js\"),s=e(\"./util.js\"),c=new i({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),u=new i({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),l={CardboardV1:new n({id:\"CardboardV1\",label:\"Cardboard I/O 2014\",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new n({id:\"CardboardV2\",label:\"Cardboard I/O 2015\",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};r.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},r.prototype.getDevice=function(){return this.device},r.prototype.setViewer=function(e){this.viewer=e,this.distortion=new a(this.viewer.distortionCoefficients)},r.prototype.determineDevice_=function(e){if(!e)return s.isIOS()?(console.warn(\"Using fallback Android device measurements.\"),u):(console.warn(\"Using fallback iOS device measurements.\"),c);var t=.0254,r=t/e.xdpi,n=t/e.ydpi,a=s.getScreenWidth(),o=s.getScreenHeight();return new i({widthMeters:r*a,heightMeters:n*o,bevelMeters:.001*e.bevelMm})},r.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,i=this.distortion,r=e.screenLensDistance,n=(t.widthMeters-e.interLensDistance)/2,a=e.interLensDistance/2,s=e.baselineLensDistance-t.bevelMeters,c=t.heightMeters-s,u=o.radToDeg*Math.atan(i.distort(n/r)),l=o.radToDeg*Math.atan(i.distort(a/r)),h=o.radToDeg*Math.atan(i.distort(s/r)),d=o.radToDeg*Math.atan(i.distort(c/r));return{leftDegrees:Math.min(u,e.fov),rightDegrees:Math.min(l,e.fov),downDegrees:Math.min(h,e.fov),upDegrees:Math.min(d,e.fov)}},r.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,r=Math.tan(-o.degToRad*e.fov),n=Math.tan(o.degToRad*e.fov),a=Math.tan(o.degToRad*e.fov),s=Math.tan(-o.degToRad*e.fov),c=t.widthMeters/4,u=t.heightMeters/2,l=e.baselineLensDistance-t.bevelMeters-u,h=e.interLensDistance/2-c,d=-l,p=e.screenLensDistance,f=i.distort((h-c)/p),m=i.distort((d+u)/p),g=i.distort((h+c)/p),v=i.distort((d-u)/p),y=new Float32Array(4);return y[0]=Math.max(r,f),y[1]=Math.min(n,m),y[2]=Math.min(a,g),y[3]=Math.max(s,v),y},r.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,r=new Float32Array(4),n=i.distortInverse(Math.tan(-o.degToRad*e.fov)),a=i.distortInverse(Math.tan(o.degToRad*e.fov)),s=i.distortInverse(Math.tan(o.degToRad*e.fov)),c=i.distortInverse(Math.tan(-o.degToRad*e.fov)),u=t.widthMeters/4,l=t.heightMeters/2,h=e.baselineLensDistance-t.bevelMeters-l,d=e.interLensDistance/2-u,p=-h,f=e.screenLensDistance,m=(d-u)/f,g=(p+l)/f,v=(d+u)/f,y=(p-l)/f;return r[0]=Math.max(n,m),r[1]=Math.min(a,g),r[2]=Math.min(s,v),r[3]=Math.max(c,y),r},r.prototype.getLeftEyeVisibleScreenRect=function(e){var t=this.viewer,i=this.device,r=t.screenLensDistance,n=(i.widthMeters-t.interLensDistance)/2,a=t.baselineLensDistance-i.bevelMeters,o=(e[0]*r+n)/i.widthMeters,s=(e[1]*r+a)/i.heightMeters,c=(e[2]*r+n)/i.widthMeters,u=(e[3]*r+a)/i.heightMeters;return{x:o,y:u,width:c-o,height:s-u}},r.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},r.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},r.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:o.radToDeg*Math.atan(e.outerDist),rightDegrees:o.radToDeg*Math.atan(e.innerDist),downDegrees:o.radToDeg*Math.atan(e.bottomDist),upDegrees:o.radToDeg*Math.atan(e.topDist)}},r.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,i=this.distortion,r=e.screenLensDistance,n=e.interLensDistance/2/r,a=t.widthMeters/r,s=t.heightMeters/r,c=a/2-n,u=(e.baselineLensDistance-t.bevelMeters)/r,l=e.fov,h=i.distortInverse(Math.tan(o.degToRad*l)),d=Math.min(c,h),p=Math.min(n,h),f=Math.min(u,h),m=Math.min(s-u,h);return{outerDist:d,innerDist:p,topDist:m,bottomDist:f,eyePosX:c,eyePosY:u}},r.Viewers=l,t.exports=r},{\"./distortion/distortion.js\":11,\"./math-util.js\":16,\"./util.js\":24}],10:[function(e,t){function i(e){this.display=e,this.hardwareUnitId=e.displayId,this.deviceId=\"webvr-polyfill:HMD:\"+e.displayId,this.deviceName=e.displayName+\" (HMD)\"}function r(e){this.display=e,this.hardwareUnitId=e.displayId,this.deviceId=\"webvr-polyfill:PositionSensor: \"+e.displayId,this.deviceName=e.displayName+\" (PositionSensor)\"}var n=(e(\"./base.js\").VRDisplay,e(\"./base.js\").HMDVRDevice),a=e(\"./base.js\").PositionSensorVRDevice;i.prototype=new n,i.prototype.getEyeParameters=function(e){var t=this.display.getEyeParameters(e);return{currentFieldOfView:t.fieldOfView,maximumFieldOfView:t.fieldOfView,minimumFieldOfView:t.fieldOfView,recommendedFieldOfView:t.fieldOfView,eyeTranslation:{x:t.offset[0],y:t.offset[1],z:t.offset[2]},renderRect:{x:\"right\"==e?t.renderWidth:0,y:0,width:t.renderWidth,height:t.renderHeight}}},i.prototype.setFieldOfView=function(){},r.prototype=new a,r.prototype.getState=function(){var e=this.display.getPose();return{position:e.position?{x:e.position[0],y:e.position[1],z:e.position[2]}:null,orientation:e.orientation?{x:e.orientation[0],y:e.orientation[1],z:e.orientation[2],w:e.orientation[3]}:null,linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},r.prototype.resetState=function(){return this.positionDevice.resetPose()},t.exports.VRDisplayHMDDevice=i,t.exports.VRDisplayPositionSensorDevice=r},{\"./base.js\":4}],11:[function(e,t){function i(e){this.coefficients=e}i.prototype.distortInverse=function(e){for(var t=0,i=1,r=e-this.distort(t);Math.abs(i-t)>1e-4;){var n=e-this.distort(i),a=i-n*((i-t)/(n-r));t=i,i=a,r=n}return i},i.prototype.distort=function(e){for(var t=e*e,i=0,r=0;r<this.coefficients.length;r++)i=t*(i+this.coefficients[r]);return(i+1)*e},i.prototype.solveLinear_=function(e,t){for(var i=e.length,r=0;i-1>r;++r)for(var n=r+1;i>n;++n){for(var a=e[r][n]/e[r][r],o=r+1;i>o;++o)e[o][n]-=a*e[o][r];t[n]-=a*t[r]}for(var s=new Array(i),r=i-1;r>=0;--r){for(var c=t[r],o=r+1;i>o;++o)c-=e[o][r]*s[o];s[r]=c/e[r][r]}return s},i.prototype.solveLeastSquares_=function(e,t){var i,r,n,a,o=e.length,s=e[0].length;if(o!=t.Length)throw new Error(\"Matrix / vector dimension mismatch\");var c=new Array(s);for(n=0;s>n;++n)for(c[n]=new Array(s),r=0;s>r;++r){for(a=0,i=0;o>i;++i)a+=e[r][i]*e[n][i];c[n][r]=a}var u=new Array(s);for(r=0;s>r;++r){for(a=0,i=0;o>i;++i)a+=e[r][i]*t[i];u[r]=a}return this.solveLinear_(c,u)},i.prototype.approximateInverse=function(e,t){e=e||1,t=t||100;var r,n,a=6,o=new Array(a);for(n=0;a>n;++n)o[n]=new Array(t);var s=new Array(t);for(r=0;t>r;++r){var c=e*(r+1)/t,u=this.distort(c),l=u;for(n=0;a>n;++n)l*=u*u,o[n][r]=l;s[r]=c-u}var h=this.solveLeastSquares_(o,s);return new i(h)},t.exports=i},{}],12:[function(e,t){var i={format:1,last_updated:\"2016-01-20T00:18:35Z\",devices:[{type:\"android\",rules:[{mdmh:\"asus/*/Nexus 7/*\"},{ua:\"Nexus 7\"}],dpi:[320.8,323],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"asus/*/ASUS_Z00AD/*\"},{ua:\"ASUS_Z00AD\"}],dpi:[403,404.6],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"HTC/*/HTC6435LVW/*\"},{ua:\"HTC6435LVW\"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"HTC/*/HTC One XL/*\"},{ua:\"HTC One XL\"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"htc/*/Nexus 9/*\"},{ua:\"Nexus 9\"}],dpi:289,bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"HTC/*/HTC One M9/*\"},{ua:\"HTC One M9\"}],dpi:[442.5,443.3],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"HTC/*/HTC One_M8/*\"},{ua:\"HTC One_M8\"}],dpi:[449.7,447.4],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"HTC/*/HTC One/*\"},{ua:\"HTC One\"}],dpi:472.8,bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"Huawei/*/Nexus 6P/*\"},{ua:\"Nexus 6P\"}],dpi:[515.1,518],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"LGE/*/Nexus 5X/*\"},{ua:\"Nexus 5X\"}],dpi:[422,419.9],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"LGE/*/LGMS345/*\"},{ua:\"LGMS345\"}],dpi:[221.7,219.1],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"LGE/*/LG-D800/*\"},{ua:\"LG-D800\"}],dpi:[422,424.1],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"LGE/*/LG-D850/*\"},{ua:\"LG-D850\"}],dpi:[537.9,541.9],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"LGE/*/VS985 4G/*\"},{ua:\"VS985 4G\"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"LGE/*/Nexus 5/*\"},{ua:\"Nexus 5 \"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"LGE/*/Nexus 4/*\"},{ua:\"Nexus 4\"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"LGE/*/LG-P769/*\"},{ua:\"LG-P769\"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"LGE/*/LGMS323/*\"},{ua:\"LGMS323\"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"LGE/*/LGLS996/*\"},{ua:\"LGLS996\"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"Micromax/*/4560MMX/*\"},{ua:\"4560MMX\"}],dpi:[240,219.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"Micromax/*/A250/*\"},{ua:\"Micromax A250\"}],dpi:[480,446.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"Micromax/*/Micromax AQ4501/*\"},{ua:\"Micromax AQ4501\"}],dpi:240,bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"motorola/*/DROID RAZR/*\"},{ua:\"DROID RAZR\"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"motorola/*/XT830C/*\"},{ua:\"XT830C\"}],dpi:[254,255.9],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1021/*\"},{ua:\"XT1021\"}],dpi:[254,256.7],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1023/*\"},{ua:\"XT1023\"}],dpi:[254,256.7],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1028/*\"},{ua:\"XT1028\"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1034/*\"},{ua:\"XT1034\"}],dpi:[326.6,328.4],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1053/*\"},{ua:\"XT1053\"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1562/*\"},{ua:\"XT1562\"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"motorola/*/Nexus 6/*\"},{ua:\"Nexus 6 \"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1063/*\"},{ua:\"XT1063\"}],dpi:[295,296.6],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1064/*\"},{ua:\"XT1064\"}],dpi:[295,295.6],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1092/*\"},{ua:\"XT1092\"}],dpi:[422,424.1],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"motorola/*/XT1095/*\"},{ua:\"XT1095\"}],dpi:[422,423.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"OnePlus/*/A0001/*\"},{ua:\"A0001\"}],dpi:[403.4,401],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"OnePlus/*/ONE E1005/*\"},{ua:\"ONE E1005\"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"OnePlus/*/ONE A2005/*\"},{ua:\"ONE A2005\"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"OPPO/*/X909/*\"},{ua:\"X909\"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/GT-I9082/*\"},{ua:\"GT-I9082\"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G360P/*\"},{ua:\"SM-G360P\"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/Nexus S/*\"},{ua:\"Nexus S\"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/GT-I9300/*\"},{ua:\"GT-I9300\"}],dpi:[304.8,303.9],bw:5,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-T230NU/*\"},{ua:\"SM-T230NU\"}],dpi:216,bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SGH-T399/*\"},{ua:\"SGH-T399\"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-N9005/*\"},{ua:\"SM-N9005\"}],dpi:[386.4,387],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SAMSUNG-SM-N900A/*\"},{ua:\"SAMSUNG-SM-N900A\"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/GT-I9500/*\"},{ua:\"GT-I9500\"}],dpi:[442.5,443.3],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/GT-I9505/*\"},{ua:\"GT-I9505\"}],dpi:439.4,bw:4,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G900F/*\"},{ua:\"SM-G900F\"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G900M/*\"},{ua:\"SM-G900M\"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G800F/*\"},{ua:\"SM-G800F\"}],dpi:326.8,bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G906S/*\"},{ua:\"SM-G906S\"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/GT-I9300/*\"},{ua:\"GT-I9300\"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-T535/*\"},{ua:\"SM-T535\"}],dpi:[142.6,136.4],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-N920C/*\"},{ua:\"SM-N920C\"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/GT-I9300I/*\"},{ua:\"GT-I9300I\"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/GT-I9195/*\"},{ua:\"GT-I9195\"}],dpi:[249.4,256.7],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SPH-L520/*\"},{ua:\"SPH-L520\"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SAMSUNG-SGH-I717/*\"},{ua:\"SAMSUNG-SGH-I717\"}],dpi:285.8,bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SPH-D710/*\"},{ua:\"SPH-D710\"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/GT-N7100/*\"},{ua:\"GT-N7100\"}],dpi:265.1,bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SCH-I605/*\"},{ua:\"SCH-I605\"}],dpi:265.1,bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/Galaxy Nexus/*\"},{ua:\"Galaxy Nexus\"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-N910H/*\"},{ua:\"SM-N910H\"}],dpi:[515.1,518],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-N910C/*\"},{ua:\"SM-N910C\"}],dpi:[515.2,520.2],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G130M/*\"},{ua:\"SM-G130M\"}],dpi:[165.9,164.8],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G928I/*\"},{ua:\"SM-G928I\"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G920F/*\"},{ua:\"SM-G920F\"}],dpi:580.6,bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G920P/*\"},{ua:\"SM-G920P\"}],dpi:[522.5,577],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G925F/*\"},{ua:\"SM-G925F\"}],dpi:580.6,bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"samsung/*/SM-G925V/*\"},{ua:\"SM-G925V\"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"Sony/*/C6903/*\"},{ua:\"C6903\"}],dpi:[442.5,443.3],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"Sony/*/D6653/*\"},{ua:\"D6653\"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"Sony/*/E6653/*\"},{ua:\"E6653\"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"Sony/*/E6853/*\"},{ua:\"E6853\"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"Sony/*/SGP321/*\"},{ua:\"SGP321\"}],dpi:[224.7,224.1],bw:3,ac:500},{type:\"android\",rules:[{mdmh:\"TCT/*/ALCATEL ONE TOUCH Fierce/*\"},{ua:\"ALCATEL ONE TOUCH Fierce\"}],dpi:[240,247.5],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"THL/*/thl 5000/*\"},{ua:\"thl 5000\"}],dpi:[480,443.3],bw:3,ac:1e3},{type:\"android\",rules:[{mdmh:\"ZTE/*/ZTE Blade L2/*\"},{ua:\"ZTE Blade L2\"}],dpi:240,bw:3,ac:500},{type:\"ios\",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:\"ios\",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:\"ios\",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:\"ios\",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:\"ios\",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:\"ios\",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:\"ios\",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:\"ios\",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3}]};\nt.exports=i},{}],13:[function(e,t){function i(e,t){if(this.dpdb=n,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t,console.log(\"Fetching DPDB...\");var i=new XMLHttpRequest,r=this;i.open(\"GET\",o,!0),i.addEventListener(\"load\",function(){r.loading=!1,i.status>=200&&i.status<=299?(console.log(\"Successfully loaded online DPDB.\"),r.dpdb=JSON.parse(i.response),r.recalculateDeviceParams_()):console.error(\"Error loading online DPDB!\")}),i.send()}}function r(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}var n=e(\"./dpdb-cache.js\"),a=e(\"../util.js\"),o=\"https://storage.googleapis.com/cardboard-dpdb/dpdb.json\";i.prototype.getDeviceParams=function(){return this.deviceParams},i.prototype.recalculateDeviceParams_=function(){console.log(\"Recalculating device params.\");var e=this.calcDeviceParams_();console.log(\"New device parameters:\"),console.log(e),e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error(\"Failed to recalculate device parameters.\")},i.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return console.error(\"DPDB not available.\"),null;if(1!=e.format)return console.error(\"DPDB has unexpected format version.\"),null;if(!e.devices||!e.devices.length)return console.error(\"DPDB does not have a devices section.\"),null;var t=navigator.userAgent||navigator.vendor||window.opera,i=a.getScreenWidth(),n=a.getScreenHeight();if(console.log(\"User agent: \"+t),console.log(\"Pixel width: \"+i),console.log(\"Pixel height: \"+n),!e.devices)return console.error(\"DPDB has no devices section.\"),null;for(var o=0;o<e.devices.length;o++){var s=e.devices[o];if(s.rules)if(\"ios\"==s.type||\"android\"==s.type){if(a.isIOS()==(\"ios\"==s.type)){for(var c=!1,u=0;u<s.rules.length;u++){var l=s.rules[u];if(this.matchRule_(l,t,i,n)){console.log(\"Rule matched:\"),console.log(l),c=!0;break}}if(c){var h=s.dpi[0]||s.dpi,d=s.dpi[1]||s.dpi;return new r({xdpi:h,ydpi:d,bevelMm:s.bw})}}}else console.warn(\"Device[\"+o+\"] has invalid type.\");else console.warn(\"Device[\"+o+\"] has no rules section.\")}return console.warn(\"No DPDB device match.\"),null},i.prototype.matchRule_=function(e,t,i,r){if(!e.ua&&!e.res)return!1;if(e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var n=e.res[0],a=e.res[1];if(Math.min(i,r)!=Math.min(n,a)||Math.max(i,r)!=Math.max(n,a))return!1}return!0},t.exports=i},{\"../util.js\":24,\"./dpdb-cache.js\":12}],14:[function(e,t){function i(){this.callbacks={}}i.prototype.emit=function(e){var t=this.callbacks[e];if(t){var i=[].slice.call(arguments);i.shift();for(var r=0;r<t.length;r++)t[r].apply(this,i)}},i.prototype.on=function(e,t){e in this.callbacks?this.callbacks[e].push(t):this.callbacks[e]=[t]},t.exports=i},{}],15:[function(e){var t=e(\"./util.js\"),i=e(\"./webvr-polyfill.js\");window.WebVRConfig=t.extend({FORCE_ENABLE_VR:!1,K_FILTER:.98,PREDICTION_TIME_S:.04,TOUCH_PANNER_DISABLED:!1,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,MOUSE_KEYBOARD_CONTROLS_DISABLED:!1,DEFER_INITIALIZATION:!1,ENABLE_DEPRECATED_API:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},window.WebVRConfig),window.WebVRConfig.DEFER_INITIALIZATION?window.InitializeWebVRPolyfill=function(){new i}:new i},{\"./util.js\":24,\"./webvr-polyfill.js\":27}],16:[function(e,t){var i=window.MathUtil||{};i.degToRad=Math.PI/180,i.radToDeg=180/Math.PI,i.Vector2=function(e,t){this.x=e||0,this.y=t||0},i.Vector2.prototype={constructor:i.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},i.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},i.Vector3.prototype={constructor:i.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();if(0!==e){var t=1/e;this.multiplyScalar(t)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,a=e.y,o=e.z,s=e.w,c=s*t+a*r-o*i,u=s*i+o*t-n*r,l=s*r+n*i-a*t,h=-n*t-a*i-o*r;return this.x=c*s+h*-n+u*-o-l*-a,this.y=u*s+h*-a+l*-n-c*-o,this.z=l*s+h*-o+c*-a-u*-n,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-n*o,this.y=n*a-i*s,this.z=i*o-r*a,this}},i.Quaternion=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},i.Quaternion.prototype={constructor:i.Quaternion,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,t,i){var r=Math.cos(e/2),n=Math.cos(t/2),a=Math.cos(i/2),o=Math.sin(e/2),s=Math.sin(t/2),c=Math.sin(i/2);return this.x=o*n*a+r*s*c,this.y=r*s*a-o*n*c,this.z=r*n*c+o*s*a,this.w=r*n*a-o*s*c,this},setFromEulerYXZ:function(e,t,i){var r=Math.cos(e/2),n=Math.cos(t/2),a=Math.cos(i/2),o=Math.sin(e/2),s=Math.sin(t/2),c=Math.sin(i/2);return this.x=o*n*a+r*s*c,this.y=r*s*a-o*n*c,this.z=r*n*c-o*s*a,this.w=r*n*a+o*s*c,this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,n=e.z,a=e.w,o=t.x,s=t.y,c=t.z,u=t.w;return this.x=i*u+a*o+r*c-n*s,this.y=r*u+a*s+n*o-i*c,this.z=n*u+a*c+i*s-r*o,this.w=a*u-i*o-r*s-n*c,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this.x,r=this.y,n=this.z,a=this.w,o=a*e.w+i*e.x+r*e.y+n*e.z;if(0>o?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=a,this.x=i,this.y=r,this.z=n,this;var s=Math.acos(o),c=Math.sqrt(1-o*o);if(Math.abs(c)<.001)return this.w=.5*(a+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(n+this.z),this;var u=Math.sin((1-t)*s)/c,l=Math.sin(t*s)/c;return this.w=a*u+this.w*l,this.x=i*u+this.x*l,this.y=r*u+this.y*l,this.z=n*u+this.z*l,this},setFromUnitVectors:function(){var e,t,r=1e-6;return function(n,a){return void 0===e&&(e=new i.Vector3),t=n.dot(a)+1,r>t?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,a),this.x=e.x,this.y=e.y,this.z=e.z,this.w=t,this.normalize(),this}}()},t.exports=i},{}],17:[function(e,t){function i(){this.displayName=\"Mouse and Keyboard VRDisplay (webvr-polyfill)\",this.capabilities.hasOrientation=!0,window.addEventListener(\"keydown\",this.onKeyDown_.bind(this)),window.addEventListener(\"mousemove\",this.onMouseMove_.bind(this)),window.addEventListener(\"mousedown\",this.onMouseDown_.bind(this)),window.addEventListener(\"mouseup\",this.onMouseUp_.bind(this)),this.phi_=0,this.theta_=0,this.targetAngle_=null,this.angleAnimation_=null,this.orientation_=new n.Quaternion,this.rotateStart_=new n.Vector2,this.rotateEnd_=new n.Vector2,this.rotateDelta_=new n.Vector2,this.isDragging_=!1,this.orientationOut_=new Float32Array(4)}var r=e(\"./base.js\").VRDisplay,n=e(\"./math-util.js\"),a=e(\"./util.js\"),o=.15,s=80,c=.5,u=.3;i.prototype=new r,i.prototype.getImmediatePose=function(){return this.orientation_.setFromEulerYXZ(this.phi_,this.theta_,0),this.orientationOut_[0]=this.orientation_.x,this.orientationOut_[1]=this.orientation_.y,this.orientationOut_[2]=this.orientation_.z,this.orientationOut_[3]=this.orientation_.w,{position:null,orientation:this.orientationOut_,linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},i.prototype.onKeyDown_=function(e){38==e.keyCode?this.animatePhi_(this.phi_+o):39==e.keyCode?this.animateTheta_(this.theta_-o):40==e.keyCode?this.animatePhi_(this.phi_-o):37==e.keyCode&&this.animateTheta_(this.theta_+o)},i.prototype.animateTheta_=function(e){this.animateKeyTransitions_(\"theta_\",e)},i.prototype.animatePhi_=function(e){e=a.clamp(e,-Math.PI/2,Math.PI/2),this.animateKeyTransitions_(\"phi_\",e)},i.prototype.animateKeyTransitions_=function(e,t){this.angleAnimation_&&clearInterval(this.angleAnimation_);var i=this[e],r=new Date;this.angleAnimation_=setInterval(function(){var n=new Date-r;if(n>=s)return this[e]=t,clearInterval(this.angleAnimation_),void 0;var a=n/s;this[e]=i+(t-i)*a}.bind(this),1e3/60)},i.prototype.onMouseDown_=function(e){this.rotateStart_.set(e.clientX,e.clientY),this.isDragging_=!0},i.prototype.onMouseMove_=function(e){if(this.isDragging_||this.isPointerLocked_()){if(this.isPointerLocked_()){var t=e.movementX||e.mozMovementX||0,i=e.movementY||e.mozMovementY||0;this.rotateEnd_.set(this.rotateStart_.x-t,this.rotateStart_.y-i)}else this.rotateEnd_.set(e.clientX,e.clientY);this.rotateDelta_.subVectors(this.rotateEnd_,this.rotateStart_),this.rotateStart_.copy(this.rotateEnd_),this.phi_+=2*Math.PI*this.rotateDelta_.y/screen.height*u,this.theta_+=2*Math.PI*this.rotateDelta_.x/screen.width*c,this.phi_=a.clamp(this.phi_,-Math.PI/2,Math.PI/2)}},i.prototype.onMouseUp_=function(){this.isDragging_=!1},i.prototype.isPointerLocked_=function(){var e=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement;return void 0!==e},i.prototype.resetPose=function(){this.phi_=0,this.theta_=0},t.exports=i},{\"./base.js\":4,\"./math-util.js\":16,\"./util.js\":24}],18:[function(e,t){function i(){this.loadIcon_();var e=document.createElement(\"div\"),t=e.style;t.position=\"fixed\",t.top=0,t.right=0,t.bottom=0,t.left=0,t.backgroundColor=\"gray\",t.fontFamily=\"sans-serif\";var i=document.createElement(\"img\");i.src=this.icon;var t=i.style;t.marginLeft=\"25%\",t.marginTop=\"25%\",t.width=\"50%\",e.appendChild(i);var r=document.createElement(\"div\"),t=r.style;t.textAlign=\"center\",t.fontSize=\"16px\",t.lineHeight=\"24px\",t.margin=\"24px 25%\",t.width=\"50%\",r.innerHTML=\"Place your phone into your Cardboard viewer.\",e.appendChild(r);var n=document.createElement(\"div\"),t=n.style;t.backgroundColor=\"#CFD8DC\",t.position=\"fixed\",t.bottom=0,t.width=\"100%\",t.height=\"48px\",t.padding=\"14px 24px\",t.boxSizing=\"border-box\",t.color=\"#656A6B\",e.appendChild(n);var a=document.createElement(\"div\");a.style.float=\"left\",a.innerHTML=\"No Cardboard viewer?\";var o=document.createElement(\"a\");o.href=\"https://www.google.com/get/cardboard/get-cardboard/\",o.innerHTML=\"get one\",o.target=\"_blank\";var t=o.style;t.float=\"right\",t.fontWeight=600,t.textTransform=\"uppercase\",t.borderLeft=\"1px solid gray\",t.paddingLeft=\"24px\",t.textDecoration=\"none\",t.color=\"#656A6B\",n.appendChild(a),n.appendChild(o),this.overlay=e,this.text=r,this.hide()}var r=e(\"./util.js\");i.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display=\"block\";var t=this.overlay.querySelector(\"img\"),i=t.style;r.isLandscapeMode()?(i.width=\"20%\",i.marginLeft=\"40%\",i.marginTop=\"3%\"):(i.width=\"50%\",i.marginLeft=\"25%\",i.marginTop=\"25%\")},i.prototype.hide=function(){this.overlay.style.display=\"none\"},i.prototype.showTemporarily=function(e,t){this.show(t),this.timer=setTimeout(this.hide.bind(this),e)},i.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},i.prototype.update=function(){this.disableShowTemporarily(),!r.isLandscapeMode()&&r.isMobile()?this.show():this.hide()},i.prototype.loadIcon_=function(){this.icon=r.base64(\"image/svg+xml\",\"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE5OHB4IiBoZWlnaHQ9IjI0MHB4IiB2aWV3Qm94PSIwIDAgMTk4IDI0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpza2V0Y2g9Imh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaC9ucyI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDMuMy4zICgxMjA4MSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+dHJhbnNpdGlvbjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHNrZXRjaDp0eXBlPSJNU1BhZ2UiPgogICAgICAgIDxnIGlkPSJ0cmFuc2l0aW9uIiBza2V0Y2g6dHlwZT0iTVNBcnRib2FyZEdyb3VwIj4KICAgICAgICAgICAgPGcgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTQtKy1JbXBvcnRlZC1MYXllcnMtQ29weS0rLUltcG9ydGVkLUxheWVycy1Db3B5LTItQ29weSIgc2tldGNoOnR5cGU9Ik1TTGF5ZXJHcm91cCI+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHktNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDEwNy4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjYyNSwyLjUyNyBDMTQ5LjYyNSwyLjUyNyAxNTUuODA1LDYuMDk2IDE1Ni4zNjIsNi40MTggTDE1Ni4zNjIsNy4zMDQgQzE1Ni4zNjIsNy40ODEgMTU2LjM3NSw3LjY2NCAxNTYuNCw3Ljg1MyBDMTU2LjQxLDcuOTM0IDE1Ni40Miw4LjAxNSAxNTYuNDI3LDguMDk1IEMxNTYuNTY3LDkuNTEgMTU3LjQwMSwxMS4wOTMgMTU4LjUzMiwxMi4wOTQgTDE2NC4yNTIsMTcuMTU2IEwxNjQuMzMzLDE3LjA2NiBDMTY0LjMzMywxNy4wNjYgMTY4LjcxNSwxNC41MzYgMTY5LjU2OCwxNC4wNDIgQzE3MS4wMjUsMTQuODgzIDE5NS41MzgsMjkuMDM1IDE5NS41MzgsMjkuMDM1IEwxOTUuNTM4LDgzLjAzNiBDMTk1LjUzOCw4My44MDcgMTk1LjE1Miw4NC4yNTMgMTk0LjU5LDg0LjI1MyBDMTk0LjM1Nyw4NC4yNTMgMTk0LjA5NSw4NC4xNzcgMTkzLjgxOCw4NC4wMTcgTDE2OS44NTEsNzAuMTc5IEwxNjkuODM3LDcwLjIwMyBMMTQyLjUxNSw4NS45NzggTDE0MS42NjUsODQuNjU1IEMxMzYuOTM0LDgzLjEyNiAxMzEuOTE3LDgxLjkxNSAxMjYuNzE0LDgxLjA0NSBDMTI2LjcwOSw4MS4wNiAxMjYuNzA3LDgxLjA2OSAxMjYuNzA3LDgxLjA2OSBMMTIxLjY0LDk4LjAzIEwxMTMuNzQ5LDEwMi41ODYgTDExMy43MTIsMTAyLjUyMyBMMTEzLjcxMiwxMzAuMTEzIEMxMTMuNzEyLDEzMC44ODUgMTEzLjMyNiwxMzEuMzMgMTEyLjc2NCwxMzEuMzMgQzExMi41MzIsMTMxLjMzIDExMi4yNjksMTMxLjI1NCAxMTEuOTkyLDEzMS4wOTQgTDY5LjUxOSwxMDYuNTcyIEM2OC41NjksMTA2LjAyMyA2Ny43OTksMTA0LjY5NSA2Ny43OTksMTAzLjYwNSBMNjcuNzk5LDEwMi41NyBMNjcuNzc4LDEwMi42MTcgQzY3LjI3LDEwMi4zOTMgNjYuNjQ4LDEwMi4yNDkgNjUuOTYyLDEwMi4yMTggQzY1Ljg3NSwxMDIuMjE0IDY1Ljc4OCwxMDIuMjEyIDY1LjcwMSwxMDIuMjEyIEM2NS42MDYsMTAyLjIxMiA2NS41MTEsMTAyLjIxNSA2NS40MTYsMTAyLjIxOSBDNjUuMTk1LDEwMi4yMjkgNjQuOTc0LDEwMi4yMzUgNjQuNzU0LDEwMi4yMzUgQzY0LjMzMSwxMDIuMjM1IDYzLjkxMSwxMDIuMjE2IDYzLjQ5OCwxMDIuMTc4IEM2MS44NDMsMTAyLjAyNSA2MC4yOTgsMTAxLjU3OCA1OS4wOTQsMTAwLjg4MiBMMTIuNTE4LDczLjk5MiBMMTIuNTIzLDc0LjAwNCBMMi4yNDUsNTUuMjU0IEMxLjI0NCw1My40MjcgMi4wMDQsNTEuMDM4IDMuOTQzLDQ5LjkxOCBMNTkuOTU0LDE3LjU3MyBDNjAuNjI2LDE3LjE4NSA2MS4zNSwxNy4wMDEgNjIuMDUzLDE3LjAwMSBDNjMuMzc5LDE3LjAwMSA2NC42MjUsMTcuNjYgNjUuMjgsMTguODU0IEw2NS4yODUsMTguODUxIEw2NS41MTIsMTkuMjY0IEw2NS41MDYsMTkuMjY4IEM2NS45MDksMjAuMDAzIDY2LjQwNSwyMC42OCA2Ni45ODMsMjEuMjg2IEw2Ny4yNiwyMS41NTYgQzY5LjE3NCwyMy40MDYgNzEuNzI4LDI0LjM1NyA3NC4zNzMsMjQuMzU3IEM3Ni4zMjIsMjQuMzU3IDc4LjMyMSwyMy44NCA4MC4xNDgsMjIuNzg1IEM4MC4xNjEsMjIuNzg1IDg3LjQ2NywxOC41NjYgODcuNDY3LDE4LjU2NiBDODguMTM5LDE4LjE3OCA4OC44NjMsMTcuOTk0IDg5LjU2NiwxNy45OTQgQzkwLjg5MiwxNy45OTQgOTIuMTM4LDE4LjY1MiA5Mi43OTIsMTkuODQ3IEw5Ni4wNDIsMjUuNzc1IEw5Ni4wNjQsMjUuNzU3IEwxMDIuODQ5LDI5LjY3NCBMMTAyLjc0NCwyOS40OTIgTDE0OS42MjUsMi41MjcgTTE0OS42MjUsMC44OTIgQzE0OS4zNDMsMC44OTIgMTQ5LjA2MiwwLjk2NSAxNDguODEsMS4xMSBMMTAyLjY0MSwyNy42NjYgTDk3LjIzMSwyNC41NDIgTDk0LjIyNiwxOS4wNjEgQzkzLjMxMywxNy4zOTQgOTEuNTI3LDE2LjM1OSA4OS41NjYsMTYuMzU4IEM4OC41NTUsMTYuMzU4IDg3LjU0NiwxNi42MzIgODYuNjQ5LDE3LjE1IEM4My44NzgsMTguNzUgNzkuNjg3LDIxLjE2OSA3OS4zNzQsMjEuMzQ1IEM3OS4zNTksMjEuMzUzIDc5LjM0NSwyMS4zNjEgNzkuMzMsMjEuMzY5IEM3Ny43OTgsMjIuMjU0IDc2LjA4NCwyMi43MjIgNzQuMzczLDIyLjcyMiBDNzIuMDgxLDIyLjcyMiA2OS45NTksMjEuODkgNjguMzk3LDIwLjM4IEw2OC4xNDUsMjAuMTM1IEM2Ny43MDYsMTkuNjcyIDY3LjMyMywxOS4xNTYgNjcuMDA2LDE4LjYwMSBDNjYuOTg4LDE4LjU1OSA2Ni45NjgsMTguNTE5IDY2Ljk0NiwxOC40NzkgTDY2LjcxOSwxOC4wNjUgQzY2LjY5LDE4LjAxMiA2Ni42NTgsMTcuOTYgNjYuNjI0LDE3LjkxMSBDNjUuNjg2LDE2LjMzNyA2My45NTEsMTUuMzY2IDYyLjA1MywxNS4zNjYgQzYxLjA0MiwxNS4zNjYgNjAuMDMzLDE1LjY0IDU5LjEzNiwxNi4xNTggTDMuMTI1LDQ4LjUwMiBDMC40MjYsNTAuMDYxIC0wLjYxMyw1My40NDIgMC44MTEsNTYuMDQgTDExLjA4OSw3NC43OSBDMTEuMjY2LDc1LjExMyAxMS41MzcsNzUuMzUzIDExLjg1LDc1LjQ5NCBMNTguMjc2LDEwMi4yOTggQzU5LjY3OSwxMDMuMTA4IDYxLjQzMywxMDMuNjMgNjMuMzQ4LDEwMy44MDYgQzYzLjgxMiwxMDMuODQ4IDY0LjI4NSwxMDMuODcgNjQuNzU0LDEwMy44NyBDNjUsMTAzLjg3IDY1LjI0OSwxMDMuODY0IDY1LjQ5NCwxMDMuODUyIEM2NS41NjMsMTAzLjg0OSA2NS42MzIsMTAzLjg0NyA2NS43MDEsMTAzLjg0NyBDNjUuNzY0LDEwMy44NDcgNjUuODI4LDEwMy44NDkgNjUuODksMTAzLjg1MiBDNjUuOTg2LDEwMy44NTYgNjYuMDgsMTAzLjg2MyA2Ni4xNzMsMTAzLjg3NCBDNjYuMjgyLDEwNS40NjcgNjcuMzMyLDEwNy4xOTcgNjguNzAyLDEwNy45ODggTDExMS4xNzQsMTMyLjUxIEMxMTEuNjk4LDEzMi44MTIgMTEyLjIzMiwxMzIuOTY1IDExMi43NjQsMTMyLjk2NSBDMTE0LjI2MSwxMzIuOTY1IDExNS4zNDcsMTMxLjc2NSAxMTUuMzQ3LDEzMC4xMTMgTDExNS4zNDcsMTAzLjU1MSBMMTIyLjQ1OCw5OS40NDYgQzEyMi44MTksOTkuMjM3IDEyMy4wODcsOTguODk4IDEyMy4yMDcsOTguNDk4IEwxMjcuODY1LDgyLjkwNSBDMTMyLjI3OSw4My43MDIgMTM2LjU1Nyw4NC43NTMgMTQwLjYwNyw4Ni4wMzMgTDE0MS4xNCw4Ni44NjIgQzE0MS40NTEsODcuMzQ2IDE0MS45NzcsODcuNjEzIDE0Mi41MTYsODcuNjEzIEMxNDIuNzk0LDg3LjYxMyAxNDMuMDc2LDg3LjU0MiAxNDMuMzMzLDg3LjM5MyBMMTY5Ljg2NSw3Mi4wNzYgTDE5Myw4NS40MzMgQzE5My41MjMsODUuNzM1IDE5NC4wNTgsODUuODg4IDE5NC41OSw4NS44ODggQzE5Ni4wODcsODUuODg4IDE5Ny4xNzMsODQuNjg5IDE5Ny4xNzMsODMuMDM2IEwxOTcuMTczLDI5LjAzNSBDMTk3LjE3MywyOC40NTEgMTk2Ljg2MSwyNy45MTEgMTk2LjM1NSwyNy42MTkgQzE5Ni4zNTUsMjcuNjE5IDE3MS44NDMsMTMuNDY3IDE3MC4zODUsMTIuNjI2IEMxNzAuMTMyLDEyLjQ4IDE2OS44NSwxMi40MDcgMTY5LjU2OCwxMi40MDcgQzE2OS4yODUsMTIuNDA3IDE2OS4wMDIsMTIuNDgxIDE2OC43NDksMTIuNjI3IEMxNjguMTQzLDEyLjk3OCAxNjUuNzU2LDE0LjM1NyAxNjQuNDI0LDE1LjEyNSBMMTU5LjYxNSwxMC44NyBDMTU4Ljc5NiwxMC4xNDUgMTU4LjE1NCw4LjkzNyAxNTguMDU0LDcuOTM0IEMxNTguMDQ1LDcuODM3IDE1OC4wMzQsNy43MzkgMTU4LjAyMSw3LjY0IEMxNTguMDA1LDcuNTIzIDE1Ny45OTgsNy40MSAxNTcuOTk4LDcuMzA0IEwxNTcuOTk4LDYuNDE4IEMxNTcuOTk4LDUuODM0IDE1Ny42ODYsNS4yOTUgMTU3LjE4MSw1LjAwMiBDMTU2LjYyNCw0LjY4IDE1MC40NDIsMS4xMTEgMTUwLjQ0MiwxLjExMSBDMTUwLjE4OSwwLjk2NSAxNDkuOTA3LDAuODkyIDE0OS42MjUsMC44OTIiIGlkPSJGaWxsLTEiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTYuMDI3LDI1LjYzNiBMMTQyLjYwMyw1Mi41MjcgQzE0My44MDcsNTMuMjIyIDE0NC41ODIsNTQuMTE0IDE0NC44NDUsNTUuMDY4IEwxNDQuODM1LDU1LjA3NSBMNjMuNDYxLDEwMi4wNTcgTDYzLjQ2LDEwMi4wNTcgQzYxLjgwNiwxMDEuOTA1IDYwLjI2MSwxMDEuNDU3IDU5LjA1NywxMDAuNzYyIEwxMi40ODEsNzMuODcxIEw5Ni4wMjcsMjUuNjM2IiBpZD0iRmlsbC0yIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYzLjQ2MSwxMDIuMTc0IEM2My40NTMsMTAyLjE3NCA2My40NDYsMTAyLjE3NCA2My40MzksMTAyLjE3MiBDNjEuNzQ2LDEwMi4wMTYgNjAuMjExLDEwMS41NjMgNTguOTk4LDEwMC44NjMgTDEyLjQyMiw3My45NzMgQzEyLjM4Niw3My45NTIgMTIuMzY0LDczLjkxNCAxMi4zNjQsNzMuODcxIEMxMi4zNjQsNzMuODMgMTIuMzg2LDczLjc5MSAxMi40MjIsNzMuNzcgTDk1Ljk2OCwyNS41MzUgQzk2LjAwNCwyNS41MTQgOTYuMDQ5LDI1LjUxNCA5Ni4wODUsMjUuNTM1IEwxNDIuNjYxLDUyLjQyNiBDMTQzLjg4OCw1My4xMzQgMTQ0LjY4Miw1NC4wMzggMTQ0Ljk1Nyw1NS4wMzcgQzE0NC45Nyw1NS4wODMgMTQ0Ljk1Myw1NS4xMzMgMTQ0LjkxNSw1NS4xNjEgQzE0NC45MTEsNTUuMTY1IDE0NC44OTgsNTUuMTc0IDE0NC44OTQsNTUuMTc3IEw2My41MTksMTAyLjE1OCBDNjMuNTAxLDEwMi4xNjkgNjMuNDgxLDEwMi4xNzQgNjMuNDYxLDEwMi4xNzQgTDYzLjQ2MSwxMDIuMTc0IFogTTEyLjcxNCw3My44NzEgTDU5LjExNSwxMDAuNjYxIEM2MC4yOTMsMTAxLjM0MSA2MS43ODYsMTAxLjc4MiA2My40MzUsMTAxLjkzNyBMMTQ0LjcwNyw1NS4wMTUgQzE0NC40MjgsNTQuMTA4IDE0My42ODIsNTMuMjg1IDE0Mi41NDQsNTIuNjI4IEw5Ni4wMjcsMjUuNzcxIEwxMi43MTQsNzMuODcxIEwxMi43MTQsNzMuODcxIFoiIGlkPSJGaWxsLTMiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ4LjMyNyw1OC40NzEgQzE0OC4xNDUsNTguNDggMTQ3Ljk2Miw1OC40OCAxNDcuNzgxLDU4LjQ3MiBDMTQ1Ljg4Nyw1OC4zODkgMTQ0LjQ3OSw1Ny40MzQgMTQ0LjYzNiw1Ni4zNCBDMTQ0LjY4OSw1NS45NjcgMTQ0LjY2NCw1NS41OTcgMTQ0LjU2NCw1NS4yMzUgTDYzLjQ2MSwxMDIuMDU3IEM2NC4wODksMTAyLjExNSA2NC43MzMsMTAyLjEzIDY1LjM3OSwxMDIuMDk5IEM2NS41NjEsMTAyLjA5IDY1Ljc0MywxMDIuMDkgNjUuOTI1LDEwMi4wOTggQzY3LjgxOSwxMDIuMTgxIDY5LjIyNywxMDMuMTM2IDY5LjA3LDEwNC4yMyBMMTQ4LjMyNyw1OC40NzEiIGlkPSJGaWxsLTQiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNjkuMDcsMTA0LjM0NyBDNjkuMDQ4LDEwNC4zNDcgNjkuMDI1LDEwNC4zNCA2OS4wMDUsMTA0LjMyNyBDNjguOTY4LDEwNC4zMDEgNjguOTQ4LDEwNC4yNTcgNjguOTU1LDEwNC4yMTMgQzY5LDEwMy44OTYgNjguODk4LDEwMy41NzYgNjguNjU4LDEwMy4yODggQzY4LjE1MywxMDIuNjc4IDY3LjEwMywxMDIuMjY2IDY1LjkyLDEwMi4yMTQgQzY1Ljc0MiwxMDIuMjA2IDY1LjU2MywxMDIuMjA3IDY1LjM4NSwxMDIuMjE1IEM2NC43NDIsMTAyLjI0NiA2NC4wODcsMTAyLjIzMiA2My40NSwxMDIuMTc0IEM2My4zOTksMTAyLjE2OSA2My4zNTgsMTAyLjEzMiA2My4zNDcsMTAyLjA4MiBDNjMuMzM2LDEwMi4wMzMgNjMuMzU4LDEwMS45ODEgNjMuNDAyLDEwMS45NTYgTDE0NC41MDYsNTUuMTM0IEMxNDQuNTM3LDU1LjExNiAxNDQuNTc1LDU1LjExMyAxNDQuNjA5LDU1LjEyNyBDMTQ0LjY0Miw1NS4xNDEgMTQ0LjY2OCw1NS4xNyAxNDQuNjc3LDU1LjIwNCBDMTQ0Ljc4MSw1NS41ODUgMTQ0LjgwNiw1NS45NzIgMTQ0Ljc1MSw1Ni4zNTcgQzE0NC43MDYsNTYuNjczIDE0NC44MDgsNTYuOTk0IDE0NS4wNDcsNTcuMjgyIEMxNDUuNTUzLDU3Ljg5MiAxNDYuNjAyLDU4LjMwMyAxNDcuNzg2LDU4LjM1NSBDMTQ3Ljk2NCw1OC4zNjMgMTQ4LjE0Myw1OC4zNjMgMTQ4LjMyMSw1OC4zNTQgQzE0OC4zNzcsNTguMzUyIDE0OC40MjQsNTguMzg3IDE0OC40MzksNTguNDM4IEMxNDguNDU0LDU4LjQ5IDE0OC40MzIsNTguNTQ1IDE0OC4zODUsNTguNTcyIEw2OS4xMjksMTA0LjMzMSBDNjkuMTExLDEwNC4zNDIgNjkuMDksMTA0LjM0NyA2OS4wNywxMDQuMzQ3IEw2OS4wNywxMDQuMzQ3IFogTTY1LjY2NSwxMDEuOTc1IEM2NS43NTQsMTAxLjk3NSA2NS44NDIsMTAxLjk3NyA2NS45MywxMDEuOTgxIEM2Ny4xOTYsMTAyLjAzNyA2OC4yODMsMTAyLjQ2OSA2OC44MzgsMTAzLjEzOSBDNjkuMDY1LDEwMy40MTMgNjkuMTg4LDEwMy43MTQgNjkuMTk4LDEwNC4wMjEgTDE0Ny44ODMsNTguNTkyIEMxNDcuODQ3LDU4LjU5MiAxNDcuODExLDU4LjU5MSAxNDcuNzc2LDU4LjU4OSBDMTQ2LjUwOSw1OC41MzMgMTQ1LjQyMiw1OC4xIDE0NC44NjcsNTcuNDMxIEMxNDQuNTg1LDU3LjA5MSAxNDQuNDY1LDU2LjcwNyAxNDQuNTIsNTYuMzI0IEMxNDQuNTYzLDU2LjAyMSAxNDQuNTUyLDU1LjcxNiAxNDQuNDg4LDU1LjQxNCBMNjMuODQ2LDEwMS45NyBDNjQuMzUzLDEwMi4wMDIgNjQuODY3LDEwMi4wMDYgNjUuMzc0LDEwMS45ODIgQzY1LjQ3MSwxMDEuOTc3IDY1LjU2OCwxMDEuOTc1IDY1LjY2NSwxMDEuOTc1IEw2NS42NjUsMTAxLjk3NSBaIiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTIuMjA4LDU1LjEzNCBDMS4yMDcsNTMuMzA3IDEuOTY3LDUwLjkxNyAzLjkwNiw0OS43OTcgTDU5LjkxNywxNy40NTMgQzYxLjg1NiwxNi4zMzMgNjQuMjQxLDE2LjkwNyA2NS4yNDMsMTguNzM0IEw2NS40NzUsMTkuMTQ0IEM2NS44NzIsMTkuODgyIDY2LjM2OCwyMC41NiA2Ni45NDUsMjEuMTY1IEw2Ny4yMjMsMjEuNDM1IEM3MC41NDgsMjQuNjQ5IDc1LjgwNiwyNS4xNTEgODAuMTExLDIyLjY2NSBMODcuNDMsMTguNDQ1IEM4OS4zNywxNy4zMjYgOTEuNzU0LDE3Ljg5OSA5Mi43NTUsMTkuNzI3IEw5Ni4wMDUsMjUuNjU1IEwxMi40ODYsNzMuODg0IEwyLjIwOCw1NS4xMzQgWiIgaWQ9IkZpbGwtNiIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMi40ODYsNzQuMDAxIEMxMi40NzYsNzQuMDAxIDEyLjQ2NSw3My45OTkgMTIuNDU1LDczLjk5NiBDMTIuNDI0LDczLjk4OCAxMi4zOTksNzMuOTY3IDEyLjM4NCw3My45NCBMMi4xMDYsNTUuMTkgQzEuMDc1LDUzLjMxIDEuODU3LDUwLjg0NSAzLjg0OCw0OS42OTYgTDU5Ljg1OCwxNy4zNTIgQzYwLjUyNSwxNi45NjcgNjEuMjcxLDE2Ljc2NCA2Mi4wMTYsMTYuNzY0IEM2My40MzEsMTYuNzY0IDY0LjY2NiwxNy40NjYgNjUuMzI3LDE4LjY0NiBDNjUuMzM3LDE4LjY1NCA2NS4zNDUsMTguNjYzIDY1LjM1MSwxOC42NzQgTDY1LjU3OCwxOS4wODggQzY1LjU4NCwxOS4xIDY1LjU4OSwxOS4xMTIgNjUuNTkxLDE5LjEyNiBDNjUuOTg1LDE5LjgzOCA2Ni40NjksMjAuNDk3IDY3LjAzLDIxLjA4NSBMNjcuMzA1LDIxLjM1MSBDNjkuMTUxLDIzLjEzNyA3MS42NDksMjQuMTIgNzQuMzM2LDI0LjEyIEM3Ni4zMTMsMjQuMTIgNzguMjksMjMuNTgyIDgwLjA1MywyMi41NjMgQzgwLjA2NCwyMi41NTcgODAuMDc2LDIyLjU1MyA4MC4wODgsMjIuNTUgTDg3LjM3MiwxOC4zNDQgQzg4LjAzOCwxNy45NTkgODguNzg0LDE3Ljc1NiA4OS41MjksMTcuNzU2IEM5MC45NTYsMTcuNzU2IDkyLjIwMSwxOC40NzIgOTIuODU4LDE5LjY3IEw5Ni4xMDcsMjUuNTk5IEM5Ni4xMzgsMjUuNjU0IDk2LjExOCwyNS43MjQgOTYuMDYzLDI1Ljc1NiBMMTIuNTQ1LDczLjk4NSBDMTIuNTI2LDczLjk5NiAxMi41MDYsNzQuMDAxIDEyLjQ4Niw3NC4wMDEgTDEyLjQ4Niw3NC4wMDEgWiBNNjIuMDE2LDE2Ljk5NyBDNjEuMzEyLDE2Ljk5NyA2MC42MDYsMTcuMTkgNTkuOTc1LDE3LjU1NCBMMy45NjUsNDkuODk5IEMyLjA4Myw1MC45ODUgMS4zNDEsNTMuMzA4IDIuMzEsNTUuMDc4IEwxMi41MzEsNzMuNzIzIEw5NS44NDgsMjUuNjExIEw5Mi42NTMsMTkuNzgyIEM5Mi4wMzgsMTguNjYgOTAuODcsMTcuOTkgODkuNTI5LDE3Ljk5IEM4OC44MjUsMTcuOTkgODguMTE5LDE4LjE4MiA4Ny40ODksMTguNTQ3IEw4MC4xNzIsMjIuNzcyIEM4MC4xNjEsMjIuNzc4IDgwLjE0OSwyMi43ODIgODAuMTM3LDIyLjc4NSBDNzguMzQ2LDIzLjgxMSA3Ni4zNDEsMjQuMzU0IDc0LjMzNiwyNC4zNTQgQzcxLjU4OCwyNC4zNTQgNjkuMDMzLDIzLjM0NyA2Ny4xNDIsMjEuNTE5IEw2Ni44NjQsMjEuMjQ5IEM2Ni4yNzcsMjAuNjM0IDY1Ljc3NCwxOS45NDcgNjUuMzY3LDE5LjIwMyBDNjUuMzYsMTkuMTkyIDY1LjM1NiwxOS4xNzkgNjUuMzU0LDE5LjE2NiBMNjUuMTYzLDE4LjgxOSBDNjUuMTU0LDE4LjgxMSA2NS4xNDYsMTguODAxIDY1LjE0LDE4Ljc5IEM2NC41MjUsMTcuNjY3IDYzLjM1NywxNi45OTcgNjIuMDE2LDE2Ljk5NyBMNjIuMDE2LDE2Ljk5NyBaIiBpZD0iRmlsbC03IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTQyLjQzNCw0OC44MDggTDQyLjQzNCw0OC44MDggQzM5LjkyNCw0OC44MDcgMzcuNzM3LDQ3LjU1IDM2LjU4Miw0NS40NDMgQzM0Ljc3MSw0Mi4xMzkgMzYuMTQ0LDM3LjgwOSAzOS42NDEsMzUuNzg5IEw1MS45MzIsMjguNjkxIEM1My4xMDMsMjguMDE1IDU0LjQxMywyNy42NTggNTUuNzIxLDI3LjY1OCBDNTguMjMxLDI3LjY1OCA2MC40MTgsMjguOTE2IDYxLjU3MywzMS4wMjMgQzYzLjM4NCwzNC4zMjcgNjIuMDEyLDM4LjY1NyA1OC41MTQsNDAuNjc3IEw0Ni4yMjMsNDcuNzc1IEM0NS4wNTMsNDguNDUgNDMuNzQyLDQ4LjgwOCA0Mi40MzQsNDguODA4IEw0Mi40MzQsNDguODA4IFogTTU1LjcyMSwyOC4xMjUgQzU0LjQ5NSwyOC4xMjUgNTMuMjY1LDI4LjQ2MSA1Mi4xNjYsMjkuMDk2IEwzOS44NzUsMzYuMTk0IEMzNi41OTYsMzguMDg3IDM1LjMwMiw0Mi4xMzYgMzYuOTkyLDQ1LjIxOCBDMzguMDYzLDQ3LjE3MyA0MC4wOTgsNDguMzQgNDIuNDM0LDQ4LjM0IEM0My42NjEsNDguMzQgNDQuODksNDguMDA1IDQ1Ljk5LDQ3LjM3IEw1OC4yODEsNDAuMjcyIEM2MS41NiwzOC4zNzkgNjIuODUzLDM0LjMzIDYxLjE2NCwzMS4yNDggQzYwLjA5MiwyOS4yOTMgNTguMDU4LDI4LjEyNSA1NS43MjEsMjguMTI1IEw1NS43MjEsMjguMTI1IFoiIGlkPSJGaWxsLTgiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjU4OCwyLjQwNyBDMTQ5LjU4OCwyLjQwNyAxNTUuNzY4LDUuOTc1IDE1Ni4zMjUsNi4yOTcgTDE1Ni4zMjUsNy4xODQgQzE1Ni4zMjUsNy4zNiAxNTYuMzM4LDcuNTQ0IDE1Ni4zNjIsNy43MzMgQzE1Ni4zNzMsNy44MTQgMTU2LjM4Miw3Ljg5NCAxNTYuMzksNy45NzUgQzE1Ni41Myw5LjM5IDE1Ny4zNjMsMTAuOTczIDE1OC40OTUsMTEuOTc0IEwxNjUuODkxLDE4LjUxOSBDMTY2LjA2OCwxOC42NzUgMTY2LjI0OSwxOC44MTQgMTY2LjQzMiwxOC45MzQgQzE2OC4wMTEsMTkuOTc0IDE2OS4zODIsMTkuNCAxNjkuNDk0LDE3LjY1MiBDMTY5LjU0MywxNi44NjggMTY5LjU1MSwxNi4wNTcgMTY5LjUxNywxNS4yMjMgTDE2OS41MTQsMTUuMDYzIEwxNjkuNTE0LDEzLjkxMiBDMTcwLjc4LDE0LjY0MiAxOTUuNTAxLDI4LjkxNSAxOTUuNTAxLDI4LjkxNSBMMTk1LjUwMSw4Mi45MTUgQzE5NS41MDEsODQuMDA1IDE5NC43MzEsODQuNDQ1IDE5My43ODEsODMuODk3IEwxNTEuMzA4LDU5LjM3NCBDMTUwLjM1OCw1OC44MjYgMTQ5LjU4OCw1Ny40OTcgMTQ5LjU4OCw1Ni40MDggTDE0OS41ODgsMjIuMzc1IiBpZD0iRmlsbC05IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE5NC41NTMsODQuMjUgQzE5NC4yOTYsODQuMjUgMTk0LjAxMyw4NC4xNjUgMTkzLjcyMiw4My45OTcgTDE1MS4yNSw1OS40NzYgQzE1MC4yNjksNTguOTA5IDE0OS40NzEsNTcuNTMzIDE0OS40NzEsNTYuNDA4IEwxNDkuNDcxLDIyLjM3NSBMMTQ5LjcwNSwyMi4zNzUgTDE0OS43MDUsNTYuNDA4IEMxNDkuNzA1LDU3LjQ1OSAxNTAuNDUsNTguNzQ0IDE1MS4zNjYsNTkuMjc0IEwxOTMuODM5LDgzLjc5NSBDMTk0LjI2Myw4NC4wNCAxOTQuNjU1LDg0LjA4MyAxOTQuOTQyLDgzLjkxNyBDMTk1LjIyNyw4My43NTMgMTk1LjM4NCw4My4zOTcgMTk1LjM4NCw4Mi45MTUgTDE5NS4zODQsMjguOTgyIEMxOTQuMTAyLDI4LjI0MiAxNzIuMTA0LDE1LjU0MiAxNjkuNjMxLDE0LjExNCBMMTY5LjYzNCwxNS4yMiBDMTY5LjY2OCwxNi4wNTIgMTY5LjY2LDE2Ljg3NCAxNjkuNjEsMTcuNjU5IEMxNjkuNTU2LDE4LjUwMyAxNjkuMjE0LDE5LjEyMyAxNjguNjQ3LDE5LjQwNSBDMTY4LjAyOCwxOS43MTQgMTY3LjE5NywxOS41NzggMTY2LjM2NywxOS4wMzIgQzE2Ni4xODEsMTguOTA5IDE2NS45OTUsMTguNzY2IDE2NS44MTQsMTguNjA2IEwxNTguNDE3LDEyLjA2MiBDMTU3LjI1OSwxMS4wMzYgMTU2LjQxOCw5LjQzNyAxNTYuMjc0LDcuOTg2IEMxNTYuMjY2LDcuOTA3IDE1Ni4yNTcsNy44MjcgMTU2LjI0Nyw3Ljc0OCBDMTU2LjIyMSw3LjU1NSAxNTYuMjA5LDcuMzY1IDE1Ni4yMDksNy4xODQgTDE1Ni4yMDksNi4zNjQgQzE1NS4zNzUsNS44ODMgMTQ5LjUyOSwyLjUwOCAxNDkuNTI5LDIuNTA4IEwxNDkuNjQ2LDIuMzA2IEMxNDkuNjQ2LDIuMzA2IDE1NS44MjcsNS44NzQgMTU2LjM4NCw2LjE5NiBMMTU2LjQ0Miw2LjIzIEwxNTYuNDQyLDcuMTg0IEMxNTYuNDQyLDcuMzU1IDE1Ni40NTQsNy41MzUgMTU2LjQ3OCw3LjcxNyBDMTU2LjQ4OSw3LjggMTU2LjQ5OSw3Ljg4MiAxNTYuNTA3LDcuOTYzIEMxNTYuNjQ1LDkuMzU4IDE1Ny40NTUsMTAuODk4IDE1OC41NzIsMTEuODg2IEwxNjUuOTY5LDE4LjQzMSBDMTY2LjE0MiwxOC41ODQgMTY2LjMxOSwxOC43MiAxNjYuNDk2LDE4LjgzNyBDMTY3LjI1NCwxOS4zMzYgMTY4LDE5LjQ2NyAxNjguNTQzLDE5LjE5NiBDMTY5LjAzMywxOC45NTMgMTY5LjMyOSwxOC40MDEgMTY5LjM3NywxNy42NDUgQzE2OS40MjcsMTYuODY3IDE2OS40MzQsMTYuMDU0IDE2OS40MDEsMTUuMjI4IEwxNjkuMzk3LDE1LjA2NSBMMTY5LjM5NywxMy43MSBMMTY5LjU3MiwxMy44MSBDMTcwLjgzOSwxNC41NDEgMTk1LjU1OSwyOC44MTQgMTk1LjU1OSwyOC44MTQgTDE5NS42MTgsMjguODQ3IEwxOTUuNjE4LDgyLjkxNSBDMTk1LjYxOCw4My40ODQgMTk1LjQyLDgzLjkxMSAxOTUuMDU5LDg0LjExOSBDMTk0LjkwOCw4NC4yMDYgMTk0LjczNyw4NC4yNSAxOTQuNTUzLDg0LjI1IiBpZD0iRmlsbC0xMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDUuNjg1LDU2LjE2MSBMMTY5LjgsNzAuMDgzIEwxNDMuODIyLDg1LjA4MSBMMTQyLjM2LDg0Ljc3NCBDMTM1LjgyNiw4Mi42MDQgMTI4LjczMiw4MS4wNDYgMTIxLjM0MSw4MC4xNTggQzExNi45NzYsNzkuNjM0IDExMi42NzgsODEuMjU0IDExMS43NDMsODMuNzc4IEMxMTEuNTA2LDg0LjQxNCAxMTEuNTAzLDg1LjA3MSAxMTEuNzMyLDg1LjcwNiBDMTEzLjI3LDg5Ljk3MyAxMTUuOTY4LDk0LjA2OSAxMTkuNzI3LDk3Ljg0MSBMMTIwLjI1OSw5OC42ODYgQzEyMC4yNiw5OC42ODUgOTQuMjgyLDExMy42ODMgOTQuMjgyLDExMy42ODMgTDcwLjE2Nyw5OS43NjEgTDE0NS42ODUsNTYuMTYxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik05NC4yODIsMTEzLjgxOCBMOTQuMjIzLDExMy43ODUgTDY5LjkzMyw5OS43NjEgTDcwLjEwOCw5OS42NiBMMTQ1LjY4NSw1Ni4wMjYgTDE0NS43NDMsNTYuMDU5IEwxNzAuMDMzLDcwLjA4MyBMMTQzLjg0Miw4NS4yMDUgTDE0My43OTcsODUuMTk1IEMxNDMuNzcyLDg1LjE5IDE0Mi4zMzYsODQuODg4IDE0Mi4zMzYsODQuODg4IEMxMzUuNzg3LDgyLjcxNCAxMjguNzIzLDgxLjE2MyAxMjEuMzI3LDgwLjI3NCBDMTIwLjc4OCw4MC4yMDkgMTIwLjIzNiw4MC4xNzcgMTE5LjY4OSw4MC4xNzcgQzExNS45MzEsODAuMTc3IDExMi42MzUsODEuNzA4IDExMS44NTIsODMuODE5IEMxMTEuNjI0LDg0LjQzMiAxMTEuNjIxLDg1LjA1MyAxMTEuODQyLDg1LjY2NyBDMTEzLjM3Nyw4OS45MjUgMTE2LjA1OCw5My45OTMgMTE5LjgxLDk3Ljc1OCBMMTE5LjgyNiw5Ny43NzkgTDEyMC4zNTIsOTguNjE0IEMxMjAuMzU0LDk4LjYxNyAxMjAuMzU2LDk4LjYyIDEyMC4zNTgsOTguNjI0IEwxMjAuNDIyLDk4LjcyNiBMMTIwLjMxNyw5OC43ODcgQzEyMC4yNjQsOTguODE4IDk0LjU5OSwxMTMuNjM1IDk0LjM0LDExMy43ODUgTDk0LjI4MiwxMTMuODE4IEw5NC4yODIsMTEzLjgxOCBaIE03MC40MDEsOTkuNzYxIEw5NC4yODIsMTEzLjU0OSBMMTE5LjA4NCw5OS4yMjkgQzExOS42Myw5OC45MTQgMTE5LjkzLDk4Ljc0IDEyMC4xMDEsOTguNjU0IEwxMTkuNjM1LDk3LjkxNCBDMTE1Ljg2NCw5NC4xMjcgMTEzLjE2OCw5MC4wMzMgMTExLjYyMiw4NS43NDYgQzExMS4zODIsODUuMDc5IDExMS4zODYsODQuNDA0IDExMS42MzMsODMuNzM4IEMxMTIuNDQ4LDgxLjUzOSAxMTUuODM2LDc5Ljk0MyAxMTkuNjg5LDc5Ljk0MyBDMTIwLjI0Niw3OS45NDMgMTIwLjgwNiw3OS45NzYgMTIxLjM1NSw4MC4wNDIgQzEyOC43NjcsODAuOTMzIDEzNS44NDYsODIuNDg3IDE0Mi4zOTYsODQuNjYzIEMxNDMuMjMyLDg0LjgzOCAxNDMuNjExLDg0LjkxNyAxNDMuNzg2LDg0Ljk2NyBMMTY5LjU2Niw3MC4wODMgTDE0NS42ODUsNTYuMjk1IEw3MC40MDEsOTkuNzYxIEw3MC40MDEsOTkuNzYxIFoiIGlkPSJGaWxsLTEyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2Ny4yMywxOC45NzkgTDE2Ny4yMyw2OS44NSBMMTM5LjkwOSw4NS42MjMgTDEzMy40NDgsNzEuNDU2IEMxMzIuNTM4LDY5LjQ2IDEzMC4wMiw2OS43MTggMTI3LjgyNCw3Mi4wMyBDMTI2Ljc2OSw3My4xNCAxMjUuOTMxLDc0LjU4NSAxMjUuNDk0LDc2LjA0OCBMMTE5LjAzNCw5Ny42NzYgTDkxLjcxMiwxMTMuNDUgTDkxLjcxMiw2Mi41NzkgTDE2Ny4yMywxOC45NzkiIGlkPSJGaWxsLTEzIiBmaWxsPSIjRkZGRkZGIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTkxLjcxMiwxMTMuNTY3IEM5MS42OTIsMTEzLjU2NyA5MS42NzIsMTEzLjU2MSA5MS42NTMsMTEzLjU1MSBDOTEuNjE4LDExMy41MyA5MS41OTUsMTEzLjQ5MiA5MS41OTUsMTEzLjQ1IEw5MS41OTUsNjIuNTc5IEM5MS41OTUsNjIuNTM3IDkxLjYxOCw2Mi40OTkgOTEuNjUzLDYyLjQ3OCBMMTY3LjE3MiwxOC44NzggQzE2Ny4yMDgsMTguODU3IDE2Ny4yNTIsMTguODU3IDE2Ny4yODgsMTguODc4IEMxNjcuMzI0LDE4Ljg5OSAxNjcuMzQ3LDE4LjkzNyAxNjcuMzQ3LDE4Ljk3OSBMMTY3LjM0Nyw2OS44NSBDMTY3LjM0Nyw2OS44OTEgMTY3LjMyNCw2OS45MyAxNjcuMjg4LDY5Ljk1IEwxMzkuOTY3LDg1LjcyNSBDMTM5LjkzOSw4NS43NDEgMTM5LjkwNSw4NS43NDUgMTM5Ljg3Myw4NS43MzUgQzEzOS44NDIsODUuNzI1IDEzOS44MTYsODUuNzAyIDEzOS44MDIsODUuNjcyIEwxMzMuMzQyLDcxLjUwNCBDMTMyLjk2Nyw3MC42ODIgMTMyLjI4LDcwLjIyOSAxMzEuNDA4LDcwLjIyOSBDMTMwLjMxOSw3MC4yMjkgMTI5LjA0NCw3MC45MTUgMTI3LjkwOCw3Mi4xMSBDMTI2Ljg3NCw3My4yIDEyNi4wMzQsNzQuNjQ3IDEyNS42MDYsNzYuMDgyIEwxMTkuMTQ2LDk3LjcwOSBDMTE5LjEzNyw5Ny43MzggMTE5LjExOCw5Ny43NjIgMTE5LjA5Miw5Ny43NzcgTDkxLjc3LDExMy41NTEgQzkxLjc1MiwxMTMuNTYxIDkxLjczMiwxMTMuNTY3IDkxLjcxMiwxMTMuNTY3IEw5MS43MTIsMTEzLjU2NyBaIE05MS44MjksNjIuNjQ3IEw5MS44MjksMTEzLjI0OCBMMTE4LjkzNSw5Ny41OTggTDEyNS4zODIsNzYuMDE1IEMxMjUuODI3LDc0LjUyNSAxMjYuNjY0LDczLjA4MSAxMjcuNzM5LDcxLjk1IEMxMjguOTE5LDcwLjcwOCAxMzAuMjU2LDY5Ljk5NiAxMzEuNDA4LDY5Ljk5NiBDMTMyLjM3Nyw2OS45OTYgMTMzLjEzOSw3MC40OTcgMTMzLjU1NCw3MS40MDcgTDEzOS45NjEsODUuNDU4IEwxNjcuMTEzLDY5Ljc4MiBMMTY3LjExMywxOS4xODEgTDkxLjgyOSw2Mi42NDcgTDkxLjgyOSw2Mi42NDcgWiIgaWQ9IkZpbGwtMTQiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTY4LjU0MywxOS4yMTMgTDE2OC41NDMsNzAuMDgzIEwxNDEuMjIxLDg1Ljg1NyBMMTM0Ljc2MSw3MS42ODkgQzEzMy44NTEsNjkuNjk0IDEzMS4zMzMsNjkuOTUxIDEyOS4xMzcsNzIuMjYzIEMxMjguMDgyLDczLjM3NCAxMjcuMjQ0LDc0LjgxOSAxMjYuODA3LDc2LjI4MiBMMTIwLjM0Niw5Ny45MDkgTDkzLjAyNSwxMTMuNjgzIEw5My4wMjUsNjIuODEzIEwxNjguNTQzLDE5LjIxMyIgaWQ9IkZpbGwtMTUiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTMuMDI1LDExMy44IEM5My4wMDUsMTEzLjggOTIuOTg0LDExMy43OTUgOTIuOTY2LDExMy43ODUgQzkyLjkzMSwxMTMuNzY0IDkyLjkwOCwxMTMuNzI1IDkyLjkwOCwxMTMuNjg0IEw5Mi45MDgsNjIuODEzIEM5Mi45MDgsNjIuNzcxIDkyLjkzMSw2Mi43MzMgOTIuOTY2LDYyLjcxMiBMMTY4LjQ4NCwxOS4xMTIgQzE2OC41MiwxOS4wOSAxNjguNTY1LDE5LjA5IDE2OC42MDEsMTkuMTEyIEMxNjguNjM3LDE5LjEzMiAxNjguNjYsMTkuMTcxIDE2OC42NiwxOS4yMTIgTDE2OC42Niw3MC4wODMgQzE2OC42Niw3MC4xMjUgMTY4LjYzNyw3MC4xNjQgMTY4LjYwMSw3MC4xODQgTDE0MS4yOCw4NS45NTggQzE0MS4yNTEsODUuOTc1IDE0MS4yMTcsODUuOTc5IDE0MS4xODYsODUuOTY4IEMxNDEuMTU0LDg1Ljk1OCAxNDEuMTI5LDg1LjkzNiAxNDEuMTE1LDg1LjkwNiBMMTM0LjY1NSw3MS43MzggQzEzNC4yOCw3MC45MTUgMTMzLjU5Myw3MC40NjMgMTMyLjcyLDcwLjQ2MyBDMTMxLjYzMiw3MC40NjMgMTMwLjM1Nyw3MS4xNDggMTI5LjIyMSw3Mi4zNDQgQzEyOC4xODYsNzMuNDMzIDEyNy4zNDcsNzQuODgxIDEyNi45MTksNzYuMzE1IEwxMjAuNDU4LDk3Ljk0MyBDMTIwLjQ1LDk3Ljk3MiAxMjAuNDMxLDk3Ljk5NiAxMjAuNDA1LDk4LjAxIEw5My4wODMsMTEzLjc4NSBDOTMuMDY1LDExMy43OTUgOTMuMDQ1LDExMy44IDkzLjAyNSwxMTMuOCBMOTMuMDI1LDExMy44IFogTTkzLjE0Miw2Mi44ODEgTDkzLjE0MiwxMTMuNDgxIEwxMjAuMjQ4LDk3LjgzMiBMMTI2LjY5NSw3Ni4yNDggQzEyNy4xNCw3NC43NTggMTI3Ljk3Nyw3My4zMTUgMTI5LjA1Miw3Mi4xODMgQzEzMC4yMzEsNzAuOTQyIDEzMS41NjgsNzAuMjI5IDEzMi43Miw3MC4yMjkgQzEzMy42ODksNzAuMjI5IDEzNC40NTIsNzAuNzMxIDEzNC44NjcsNzEuNjQxIEwxNDEuMjc0LDg1LjY5MiBMMTY4LjQyNiw3MC4wMTYgTDE2OC40MjYsMTkuNDE1IEw5My4xNDIsNjIuODgxIEw5My4xNDIsNjIuODgxIFoiIGlkPSJGaWxsLTE2IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS44LDcwLjA4MyBMMTQyLjQ3OCw4NS44NTcgTDEzNi4wMTgsNzEuNjg5IEMxMzUuMTA4LDY5LjY5NCAxMzIuNTksNjkuOTUxIDEzMC4zOTMsNzIuMjYzIEMxMjkuMzM5LDczLjM3NCAxMjguNSw3NC44MTkgMTI4LjA2NCw3Ni4yODIgTDEyMS42MDMsOTcuOTA5IEw5NC4yODIsMTEzLjY4MyBMOTQuMjgyLDYyLjgxMyBMMTY5LjgsMTkuMjEzIEwxNjkuOCw3MC4wODMgWiIgaWQ9IkZpbGwtMTciIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTQuMjgyLDExMy45MTcgQzk0LjI0MSwxMTMuOTE3IDk0LjIwMSwxMTMuOTA3IDk0LjE2NSwxMTMuODg2IEM5NC4wOTMsMTEzLjg0NSA5NC4wNDgsMTEzLjc2NyA5NC4wNDgsMTEzLjY4NCBMOTQuMDQ4LDYyLjgxMyBDOTQuMDQ4LDYyLjczIDk0LjA5Myw2Mi42NTIgOTQuMTY1LDYyLjYxMSBMMTY5LjY4MywxOS4wMSBDMTY5Ljc1NSwxOC45NjkgMTY5Ljg0NCwxOC45NjkgMTY5LjkxNywxOS4wMSBDMTY5Ljk4OSwxOS4wNTIgMTcwLjAzMywxOS4xMjkgMTcwLjAzMywxOS4yMTIgTDE3MC4wMzMsNzAuMDgzIEMxNzAuMDMzLDcwLjE2NiAxNjkuOTg5LDcwLjI0NCAxNjkuOTE3LDcwLjI4NSBMMTQyLjU5NSw4Ni4wNiBDMTQyLjUzOCw4Ni4wOTIgMTQyLjQ2OSw4Ni4xIDE0Mi40MDcsODYuMDggQzE0Mi4zNDQsODYuMDYgMTQyLjI5Myw4Ni4wMTQgMTQyLjI2Niw4NS45NTQgTDEzNS44MDUsNzEuNzg2IEMxMzUuNDQ1LDcwLjk5NyAxMzQuODEzLDcwLjU4IDEzMy45NzcsNzAuNTggQzEzMi45MjEsNzAuNTggMTMxLjY3Niw3MS4yNTIgMTMwLjU2Miw3Mi40MjQgQzEyOS41NCw3My41MDEgMTI4LjcxMSw3NC45MzEgMTI4LjI4Nyw3Ni4zNDggTDEyMS44MjcsOTcuOTc2IEMxMjEuODEsOTguMDM0IDEyMS43NzEsOTguMDgyIDEyMS43Miw5OC4xMTIgTDk0LjM5OCwxMTMuODg2IEM5NC4zNjIsMTEzLjkwNyA5NC4zMjIsMTEzLjkxNyA5NC4yODIsMTEzLjkxNyBMOTQuMjgyLDExMy45MTcgWiBNOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDExMy4yNzkgTDEyMS40MDYsOTcuNzU0IEwxMjcuODQsNzYuMjE1IEMxMjguMjksNzQuNzA4IDEyOS4xMzcsNzMuMjQ3IDEzMC4yMjQsNzIuMTAzIEMxMzEuNDI1LDcwLjgzOCAxMzIuNzkzLDcwLjExMiAxMzMuOTc3LDcwLjExMiBDMTM0Ljk5NSw3MC4xMTIgMTM1Ljc5NSw3MC42MzggMTM2LjIzLDcxLjU5MiBMMTQyLjU4NCw4NS41MjYgTDE2OS41NjYsNjkuOTQ4IEwxNjkuNTY2LDE5LjYxNyBMOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDYyLjk0OCBaIiBpZD0iRmlsbC0xOCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMDkuODk0LDkyLjk0MyBMMTA5Ljg5NCw5Mi45NDMgQzEwOC4xMiw5Mi45NDMgMTA2LjY1Myw5Mi4yMTggMTA1LjY1LDkwLjgyMyBDMTA1LjU4Myw5MC43MzEgMTA1LjU5Myw5MC42MSAxMDUuNjczLDkwLjUyOSBDMTA1Ljc1Myw5MC40NDggMTA1Ljg4LDkwLjQ0IDEwNS45NzQsOTAuNTA2IEMxMDYuNzU0LDkxLjA1MyAxMDcuNjc5LDkxLjMzMyAxMDguNzI0LDkxLjMzMyBDMTEwLjA0Nyw5MS4zMzMgMTExLjQ3OCw5MC44OTQgMTEyLjk4LDkwLjAyNyBDMTE4LjI5MSw4Ni45NiAxMjIuNjExLDc5LjUwOSAxMjIuNjExLDczLjQxNiBDMTIyLjYxMSw3MS40ODkgMTIyLjE2OSw2OS44NTYgMTIxLjMzMyw2OC42OTIgQzEyMS4yNjYsNjguNiAxMjEuMjc2LDY4LjQ3MyAxMjEuMzU2LDY4LjM5MiBDMTIxLjQzNiw2OC4zMTEgMTIxLjU2Myw2OC4yOTkgMTIxLjY1Niw2OC4zNjUgQzEyMy4zMjcsNjkuNTM3IDEyNC4yNDcsNzEuNzQ2IDEyNC4yNDcsNzQuNTg0IEMxMjQuMjQ3LDgwLjgyNiAxMTkuODIxLDg4LjQ0NyAxMTQuMzgyLDkxLjU4NyBDMTEyLjgwOCw5Mi40OTUgMTExLjI5OCw5Mi45NDMgMTA5Ljg5NCw5Mi45NDMgTDEwOS44OTQsOTIuOTQzIFogTTEwNi45MjUsOTEuNDAxIEMxMDcuNzM4LDkyLjA1MiAxMDguNzQ1LDkyLjI3OCAxMDkuODkzLDkyLjI3OCBMMTA5Ljg5NCw5Mi4yNzggQzExMS4yMTUsOTIuMjc4IDExMi42NDcsOTEuOTUxIDExNC4xNDgsOTEuMDg0IEMxMTkuNDU5LDg4LjAxNyAxMjMuNzgsODAuNjIxIDEyMy43OCw3NC41MjggQzEyMy43OCw3Mi41NDkgMTIzLjMxNyw3MC45MjkgMTIyLjQ1NCw2OS43NjcgQzEyMi44NjUsNzAuODAyIDEyMy4wNzksNzIuMDQyIDEyMy4wNzksNzMuNDAyIEMxMjMuMDc5LDc5LjY0NSAxMTguNjUzLDg3LjI4NSAxMTMuMjE0LDkwLjQyNSBDMTExLjY0LDkxLjMzNCAxMTAuMTMsOTEuNzQyIDEwOC43MjQsOTEuNzQyIEMxMDguMDgzLDkxLjc0MiAxMDcuNDgxLDkxLjU5MyAxMDYuOTI1LDkxLjQwMSBMMTA2LjkyNSw5MS40MDEgWiIgaWQ9IkZpbGwtMTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjA5Nyw5MC4yMyBDMTE4LjQ4MSw4Ny4xMjIgMTIyLjg0NSw3OS41OTQgMTIyLjg0NSw3My40MTYgQzEyMi44NDUsNzEuMzY1IDEyMi4zNjIsNjkuNzI0IDEyMS41MjIsNjguNTU2IEMxMTkuNzM4LDY3LjMwNCAxMTcuMTQ4LDY3LjM2MiAxMTQuMjY1LDY5LjAyNiBDMTA4Ljg4MSw3Mi4xMzQgMTA0LjUxNyw3OS42NjIgMTA0LjUxNyw4NS44NCBDMTA0LjUxNyw4Ny44OTEgMTA1LDg5LjUzMiAxMDUuODQsOTAuNyBDMTA3LjYyNCw5MS45NTIgMTEwLjIxNCw5MS44OTQgMTEzLjA5Nyw5MC4yMyIgaWQ9IkZpbGwtMjAiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTA4LjcyNCw5MS42MTQgTDEwOC43MjQsOTEuNjE0IEMxMDcuNTgyLDkxLjYxNCAxMDYuNTY2LDkxLjQwMSAxMDUuNzA1LDkwLjc5NyBDMTA1LjY4NCw5MC43ODMgMTA1LjY2NSw5MC44MTEgMTA1LjY1LDkwLjc5IEMxMDQuNzU2LDg5LjU0NiAxMDQuMjgzLDg3Ljg0MiAxMDQuMjgzLDg1LjgxNyBDMTA0LjI4Myw3OS41NzUgMTA4LjcwOSw3MS45NTMgMTE0LjE0OCw2OC44MTIgQzExNS43MjIsNjcuOTA0IDExNy4yMzIsNjcuNDQ5IDExOC42MzgsNjcuNDQ5IEMxMTkuNzgsNjcuNDQ5IDEyMC43OTYsNjcuNzU4IDEyMS42NTYsNjguMzYyIEMxMjEuNjc4LDY4LjM3NyAxMjEuNjk3LDY4LjM5NyAxMjEuNzEyLDY4LjQxOCBDMTIyLjYwNiw2OS42NjIgMTIzLjA3OSw3MS4zOSAxMjMuMDc5LDczLjQxNSBDMTIzLjA3OSw3OS42NTggMTE4LjY1Myw4Ny4xOTggMTEzLjIxNCw5MC4zMzggQzExMS42NCw5MS4yNDcgMTEwLjEzLDkxLjYxNCAxMDguNzI0LDkxLjYxNCBMMTA4LjcyNCw5MS42MTQgWiBNMTA2LjAwNiw5MC41MDUgQzEwNi43OCw5MS4wMzcgMTA3LjY5NCw5MS4yODEgMTA4LjcyNCw5MS4yODEgQzExMC4wNDcsOTEuMjgxIDExMS40NzgsOTAuODY4IDExMi45OCw5MC4wMDEgQzExOC4yOTEsODYuOTM1IDEyMi42MTEsNzkuNDk2IDEyMi42MTEsNzMuNDAzIEMxMjIuNjExLDcxLjQ5NCAxMjIuMTc3LDY5Ljg4IDEyMS4zNTYsNjguNzE4IEMxMjAuNTgyLDY4LjE4NSAxMTkuNjY4LDY3LjkxOSAxMTguNjM4LDY3LjkxOSBDMTE3LjMxNSw2Ny45MTkgMTE1Ljg4Myw2OC4zNiAxMTQuMzgyLDY5LjIyNyBDMTA5LjA3MSw3Mi4yOTMgMTA0Ljc1MSw3OS43MzMgMTA0Ljc1MSw4NS44MjYgQzEwNC43NTEsODcuNzM1IDEwNS4xODUsODkuMzQzIDEwNi4wMDYsOTAuNTA1IEwxMDYuMDA2LDkwLjUwNSBaIiBpZD0iRmlsbC0yMSIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDkuMzE4LDcuMjYyIEwxMzkuMzM0LDE2LjE0IEwxNTUuMjI3LDI3LjE3MSBMMTYwLjgxNiwyMS4wNTkgTDE0OS4zMTgsNy4yNjIiIGlkPSJGaWxsLTIyIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS42NzYsMTMuODQgTDE1OS45MjgsMTkuNDY3IEMxNTYuMjg2LDIxLjU3IDE1MC40LDIxLjU4IDE0Ni43ODEsMTkuNDkxIEMxNDMuMTYxLDE3LjQwMiAxNDMuMTgsMTQuMDAzIDE0Ni44MjIsMTEuOSBMMTU2LjMxNyw2LjI5MiBMMTQ5LjU4OCwyLjQwNyBMNjcuNzUyLDQ5LjQ3OCBMMTEzLjY3NSw3NS45OTIgTDExNi43NTYsNzQuMjEzIEMxMTcuMzg3LDczLjg0OCAxMTcuNjI1LDczLjMxNSAxMTcuMzc0LDcyLjgyMyBDMTE1LjAxNyw2OC4xOTEgMTE0Ljc4MSw2My4yNzcgMTE2LjY5MSw1OC41NjEgQzEyMi4zMjksNDQuNjQxIDE0MS4yLDMzLjc0NiAxNjUuMzA5LDMwLjQ5MSBDMTczLjQ3OCwyOS4zODggMTgxLjk4OSwyOS41MjQgMTkwLjAxMywzMC44ODUgQzE5MC44NjUsMzEuMDMgMTkxLjc4OSwzMC44OTMgMTkyLjQyLDMwLjUyOCBMMTk1LjUwMSwyOC43NSBMMTY5LjY3NiwxMy44NCIgaWQ9IkZpbGwtMjMiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3Ni40NTkgQzExMy41OTQsNzYuNDU5IDExMy41MTQsNzYuNDM4IDExMy40NDIsNzYuMzk3IEw2Ny41MTgsNDkuODgyIEM2Ny4zNzQsNDkuNzk5IDY3LjI4NCw0OS42NDUgNjcuMjg1LDQ5LjQ3OCBDNjcuMjg1LDQ5LjMxMSA2Ny4zNzQsNDkuMTU3IDY3LjUxOSw0OS4wNzMgTDE0OS4zNTUsMi4wMDIgQzE0OS40OTksMS45MTkgMTQ5LjY3NywxLjkxOSAxNDkuODIxLDIuMDAyIEwxNTYuNTUsNS44ODcgQzE1Ni43NzQsNi4wMTcgMTU2Ljg1LDYuMzAyIDE1Ni43MjIsNi41MjYgQzE1Ni41OTIsNi43NDkgMTU2LjMwNyw2LjgyNiAxNTYuMDgzLDYuNjk2IEwxNDkuNTg3LDIuOTQ2IEw2OC42ODcsNDkuNDc5IEwxMTMuNjc1LDc1LjQ1MiBMMTE2LjUyMyw3My44MDggQzExNi43MTUsNzMuNjk3IDExNy4xNDMsNzMuMzk5IDExNi45NTgsNzMuMDM1IEMxMTQuNTQyLDY4LjI4NyAxMTQuMyw2My4yMjEgMTE2LjI1OCw1OC4zODUgQzExOS4wNjQsNTEuNDU4IDEyNS4xNDMsNDUuMTQzIDEzMy44NCw0MC4xMjIgQzE0Mi40OTcsMzUuMTI0IDE1My4zNTgsMzEuNjMzIDE2NS4yNDcsMzAuMDI4IEMxNzMuNDQ1LDI4LjkyMSAxODIuMDM3LDI5LjA1OCAxOTAuMDkxLDMwLjQyNSBDMTkwLjgzLDMwLjU1IDE5MS42NTIsMzAuNDMyIDE5Mi4xODYsMzAuMTI0IEwxOTQuNTY3LDI4Ljc1IEwxNjkuNDQyLDE0LjI0NCBDMTY5LjIxOSwxNC4xMTUgMTY5LjE0MiwxMy44MjkgMTY5LjI3MSwxMy42MDYgQzE2OS40LDEzLjM4MiAxNjkuNjg1LDEzLjMwNiAxNjkuOTA5LDEzLjQzNSBMMTk1LjczNCwyOC4zNDUgQzE5NS44NzksMjguNDI4IDE5NS45NjgsMjguNTgzIDE5NS45NjgsMjguNzUgQzE5NS45NjgsMjguOTE2IDE5NS44NzksMjkuMDcxIDE5NS43MzQsMjkuMTU0IEwxOTIuNjUzLDMwLjkzMyBDMTkxLjkzMiwzMS4zNSAxOTAuODksMzEuNTA4IDE4OS45MzUsMzEuMzQ2IEMxODEuOTcyLDI5Ljk5NSAxNzMuNDc4LDI5Ljg2IDE2NS4zNzIsMzAuOTU0IEMxNTMuNjAyLDMyLjU0MyAxNDIuODYsMzUuOTkzIDEzNC4zMDcsNDAuOTMxIEMxMjUuNzkzLDQ1Ljg0NyAxMTkuODUxLDUyLjAwNCAxMTcuMTI0LDU4LjczNiBDMTE1LjI3LDYzLjMxNCAxMTUuNTAxLDY4LjExMiAxMTcuNzksNzIuNjExIEMxMTguMTYsNzMuMzM2IDExNy44NDUsNzQuMTI0IDExNi45OSw3NC42MTcgTDExMy45MDksNzYuMzk3IEMxMTMuODM2LDc2LjQzOCAxMTMuNzU2LDc2LjQ1OSAxMTMuNjc1LDc2LjQ1OSIgaWQ9IkZpbGwtMjQiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUzLjMxNiwyMS4yNzkgQzE1MC45MDMsMjEuMjc5IDE0OC40OTUsMjAuNzUxIDE0Ni42NjQsMTkuNjkzIEMxNDQuODQ2LDE4LjY0NCAxNDMuODQ0LDE3LjIzMiAxNDMuODQ0LDE1LjcxOCBDMTQzLjg0NCwxNC4xOTEgMTQ0Ljg2LDEyLjc2MyAxNDYuNzA1LDExLjY5OCBMMTU2LjE5OCw2LjA5MSBDMTU2LjMwOSw2LjAyNSAxNTYuNDUyLDYuMDYyIDE1Ni41MTgsNi4xNzMgQzE1Ni41ODMsNi4yODQgMTU2LjU0Nyw2LjQyNyAxNTYuNDM2LDYuNDkzIEwxNDYuOTQsMTIuMTAyIEMxNDUuMjQ0LDEzLjA4MSAxNDQuMzEyLDE0LjM2NSAxNDQuMzEyLDE1LjcxOCBDMTQ0LjMxMiwxNy4wNTggMTQ1LjIzLDE4LjMyNiAxNDYuODk3LDE5LjI4OSBDMTUwLjQ0NiwyMS4zMzggMTU2LjI0LDIxLjMyNyAxNTkuODExLDE5LjI2NSBMMTY5LjU1OSwxMy42MzcgQzE2OS42NywxMy41NzMgMTY5LjgxMywxMy42MTEgMTY5Ljg3OCwxMy43MjMgQzE2OS45NDMsMTMuODM0IDE2OS45MDQsMTMuOTc3IDE2OS43OTMsMTQuMDQyIEwxNjAuMDQ1LDE5LjY3IEMxNTguMTg3LDIwLjc0MiAxNTUuNzQ5LDIxLjI3OSAxNTMuMzE2LDIxLjI3OSIgaWQ9IkZpbGwtMjUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3NS45OTIgTDY3Ljc2Miw0OS40ODQiIGlkPSJGaWxsLTI2IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMy42NzUsNzYuMzQyIEMxMTMuNjE1LDc2LjM0MiAxMTMuNTU1LDc2LjMyNyAxMTMuNSw3Ni4yOTUgTDY3LjU4Nyw0OS43ODcgQzY3LjQxOSw0OS42OSA2Ny4zNjIsNDkuNDc2IDY3LjQ1OSw0OS4zMDkgQzY3LjU1Niw0OS4xNDEgNjcuNzcsNDkuMDgzIDY3LjkzNyw0OS4xOCBMMTEzLjg1LDc1LjY4OCBDMTE0LjAxOCw3NS43ODUgMTE0LjA3NSw3NiAxMTMuOTc4LDc2LjE2NyBDMTEzLjkxNCw3Ni4yNzkgMTEzLjc5Niw3Ni4zNDIgMTEzLjY3NSw3Ni4zNDIiIGlkPSJGaWxsLTI3IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY3Ljc2Miw0OS40ODQgTDY3Ljc2MiwxMDMuNDg1IEM2Ny43NjIsMTA0LjU3NSA2OC41MzIsMTA1LjkwMyA2OS40ODIsMTA2LjQ1MiBMMTExLjk1NSwxMzAuOTczIEMxMTIuOTA1LDEzMS41MjIgMTEzLjY3NSwxMzEuMDgzIDExMy42NzUsMTI5Ljk5MyBMMTEzLjY3NSw3NS45OTIiIGlkPSJGaWxsLTI4IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMi43MjcsMTMxLjU2MSBDMTEyLjQzLDEzMS41NjEgMTEyLjEwNywxMzEuNDY2IDExMS43OCwxMzEuMjc2IEw2OS4zMDcsMTA2Ljc1NSBDNjguMjQ0LDEwNi4xNDIgNjcuNDEyLDEwNC43MDUgNjcuNDEyLDEwMy40ODUgTDY3LjQxMiw0OS40ODQgQzY3LjQxMiw0OS4yOSA2Ny41NjksNDkuMTM0IDY3Ljc2Miw0OS4xMzQgQzY3Ljk1Niw0OS4xMzQgNjguMTEzLDQ5LjI5IDY4LjExMyw0OS40ODQgTDY4LjExMywxMDMuNDg1IEM2OC4xMTMsMTA0LjQ0NSA2OC44MiwxMDUuNjY1IDY5LjY1NywxMDYuMTQ4IEwxMTIuMTMsMTMwLjY3IEMxMTIuNDc0LDEzMC44NjggMTEyLjc5MSwxMzAuOTEzIDExMywxMzAuNzkyIEMxMTMuMjA2LDEzMC42NzMgMTEzLjMyNSwxMzAuMzgxIDExMy4zMjUsMTI5Ljk5MyBMMTEzLjMyNSw3NS45OTIgQzExMy4zMjUsNzUuNzk4IDExMy40ODIsNzUuNjQxIDExMy42NzUsNzUuNjQxIEMxMTMuODY5LDc1LjY0MSAxMTQuMDI1LDc1Ljc5OCAxMTQuMDI1LDc1Ljk5MiBMMTE0LjAyNSwxMjkuOTkzIEMxMTQuMDI1LDEzMC42NDggMTEzLjc4NiwxMzEuMTQ3IDExMy4zNSwxMzEuMzk5IEMxMTMuMTYyLDEzMS41MDcgMTEyLjk1MiwxMzEuNTYxIDExMi43MjcsMTMxLjU2MSIgaWQ9IkZpbGwtMjkiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEyLjg2LDQwLjUxMiBDMTEyLjg2LDQwLjUxMiAxMTIuODYsNDAuNTEyIDExMi44NTksNDAuNTEyIEMxMTAuNTQxLDQwLjUxMiAxMDguMzYsMzkuOTkgMTA2LjcxNywzOS4wNDEgQzEwNS4wMTIsMzguMDU3IDEwNC4wNzQsMzYuNzI2IDEwNC4wNzQsMzUuMjkyIEMxMDQuMDc0LDMzLjg0NyAxMDUuMDI2LDMyLjUwMSAxMDYuNzU0LDMxLjUwNCBMMTE4Ljc5NSwyNC41NTEgQzEyMC40NjMsMjMuNTg5IDEyMi42NjksMjMuMDU4IDEyNS4wMDcsMjMuMDU4IEMxMjcuMzI1LDIzLjA1OCAxMjkuNTA2LDIzLjU4MSAxMzEuMTUsMjQuNTMgQzEzMi44NTQsMjUuNTE0IDEzMy43OTMsMjYuODQ1IDEzMy43OTMsMjguMjc4IEMxMzMuNzkzLDI5LjcyNCAxMzIuODQxLDMxLjA2OSAxMzEuMTEzLDMyLjA2NyBMMTE5LjA3MSwzOS4wMTkgQzExNy40MDMsMzkuOTgyIDExNS4xOTcsNDAuNTEyIDExMi44Niw0MC41MTIgTDExMi44Niw0MC41MTIgWiBNMTI1LjAwNywyMy43NTkgQzEyMi43OSwyMy43NTkgMTIwLjcwOSwyNC4yNTYgMTE5LjE0NiwyNS4xNTggTDEwNy4xMDQsMzIuMTEgQzEwNS42MDIsMzIuOTc4IDEwNC43NzQsMzQuMTA4IDEwNC43NzQsMzUuMjkyIEMxMDQuNzc0LDM2LjQ2NSAxMDUuNTg5LDM3LjU4MSAxMDcuMDY3LDM4LjQzNCBDMTA4LjYwNSwzOS4zMjMgMTEwLjY2MywzOS44MTIgMTEyLjg1OSwzOS44MTIgTDExMi44NiwzOS44MTIgQzExNS4wNzYsMzkuODEyIDExNy4xNTgsMzkuMzE1IDExOC43MjEsMzguNDEzIEwxMzAuNzYyLDMxLjQ2IEMxMzIuMjY0LDMwLjU5MyAxMzMuMDkyLDI5LjQ2MyAxMzMuMDkyLDI4LjI3OCBDMTMzLjA5MiwyNy4xMDYgMTMyLjI3OCwyNS45OSAxMzAuOCwyNS4xMzYgQzEyOS4yNjEsMjQuMjQ4IDEyNy4yMDQsMjMuNzU5IDEyNS4wMDcsMjMuNzU5IEwxMjUuMDA3LDIzLjc1OSBaIiBpZD0iRmlsbC0zMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNjUuNjMsMTYuMjE5IEwxNTkuODk2LDE5LjUzIEMxNTYuNzI5LDIxLjM1OCAxNTEuNjEsMjEuMzY3IDE0OC40NjMsMTkuNTUgQzE0NS4zMTYsMTcuNzMzIDE0NS4zMzIsMTQuNzc4IDE0OC40OTksMTIuOTQ5IEwxNTQuMjMzLDkuNjM5IEwxNjUuNjMsMTYuMjE5IiBpZD0iRmlsbC0zMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNTQuMjMzLDEwLjQ0OCBMMTY0LjIyOCwxNi4yMTkgTDE1OS41NDYsMTguOTIzIEMxNTguMTEyLDE5Ljc1IDE1Ni4xOTQsMjAuMjA2IDE1NC4xNDcsMjAuMjA2IEMxNTIuMTE4LDIwLjIwNiAxNTAuMjI0LDE5Ljc1NyAxNDguODE0LDE4Ljk0MyBDMTQ3LjUyNCwxOC4xOTkgMTQ2LjgxNCwxNy4yNDkgMTQ2LjgxNCwxNi4yNjkgQzE0Ni44MTQsMTUuMjc4IDE0Ny41MzcsMTQuMzE0IDE0OC44NSwxMy41NTYgTDE1NC4yMzMsMTAuNDQ4IE0xNTQuMjMzLDkuNjM5IEwxNDguNDk5LDEyLjk0OSBDMTQ1LjMzMiwxNC43NzggMTQ1LjMxNiwxNy43MzMgMTQ4LjQ2MywxOS41NSBDMTUwLjAzMSwyMC40NTUgMTUyLjA4NiwyMC45MDcgMTU0LjE0NywyMC45MDcgQzE1Ni4yMjQsMjAuOTA3IDE1OC4zMDYsMjAuNDQ3IDE1OS44OTYsMTkuNTMgTDE2NS42MywxNi4yMTkgTDE1NC4yMzMsOS42MzkiIGlkPSJGaWxsLTMyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NS40NDUsNzIuNjY3IEwxNDUuNDQ1LDcyLjY2NyBDMTQzLjY3Miw3Mi42NjcgMTQyLjIwNCw3MS44MTcgMTQxLjIwMiw3MC40MjIgQzE0MS4xMzUsNzAuMzMgMTQxLjE0NSw3MC4xNDcgMTQxLjIyNSw3MC4wNjYgQzE0MS4zMDUsNjkuOTg1IDE0MS40MzIsNjkuOTQ2IDE0MS41MjUsNzAuMDExIEMxNDIuMzA2LDcwLjU1OSAxNDMuMjMxLDcwLjgyMyAxNDQuMjc2LDcwLjgyMiBDMTQ1LjU5OCw3MC44MjIgMTQ3LjAzLDcwLjM3NiAxNDguNTMyLDY5LjUwOSBDMTUzLjg0Miw2Ni40NDMgMTU4LjE2Myw1OC45ODcgMTU4LjE2Myw1Mi44OTQgQzE1OC4xNjMsNTAuOTY3IDE1Ny43MjEsNDkuMzMyIDE1Ni44ODQsNDguMTY4IEMxNTYuODE4LDQ4LjA3NiAxNTYuODI4LDQ3Ljk0OCAxNTYuOTA4LDQ3Ljg2NyBDMTU2Ljk4OCw0Ny43ODYgMTU3LjExNCw0Ny43NzQgMTU3LjIwOCw0Ny44NCBDMTU4Ljg3OCw0OS4wMTIgMTU5Ljc5OCw1MS4yMiAxNTkuNzk4LDU0LjA1OSBDMTU5Ljc5OCw2MC4zMDEgMTU1LjM3Myw2OC4wNDYgMTQ5LjkzMyw3MS4xODYgQzE0OC4zNiw3Mi4wOTQgMTQ2Ljg1LDcyLjY2NyAxNDUuNDQ1LDcyLjY2NyBMMTQ1LjQ0NSw3Mi42NjcgWiBNMTQyLjQ3Niw3MSBDMTQzLjI5LDcxLjY1MSAxNDQuMjk2LDcyLjAwMiAxNDUuNDQ1LDcyLjAwMiBDMTQ2Ljc2Nyw3Mi4wMDIgMTQ4LjE5OCw3MS41NSAxNDkuNyw3MC42ODIgQzE1NS4wMSw2Ny42MTcgMTU5LjMzMSw2MC4xNTkgMTU5LjMzMSw1NC4wNjUgQzE1OS4zMzEsNTIuMDg1IDE1OC44NjgsNTAuNDM1IDE1OC4wMDYsNDkuMjcyIEMxNTguNDE3LDUwLjMwNyAxNTguNjMsNTEuNTMyIDE1OC42Myw1Mi44OTIgQzE1OC42Myw1OS4xMzQgMTU0LjIwNSw2Ni43NjcgMTQ4Ljc2NSw2OS45MDcgQzE0Ny4xOTIsNzAuODE2IDE0NS42ODEsNzEuMjgzIDE0NC4yNzYsNzEuMjgzIEMxNDMuNjM0LDcxLjI4MyAxNDMuMDMzLDcxLjE5MiAxNDIuNDc2LDcxIEwxNDIuNDc2LDcxIFoiIGlkPSJGaWxsLTMzIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0OC42NDgsNjkuNzA0IEMxNTQuMDMyLDY2LjU5NiAxNTguMzk2LDU5LjA2OCAxNTguMzk2LDUyLjg5MSBDMTU4LjM5Niw1MC44MzkgMTU3LjkxMyw0OS4xOTggMTU3LjA3NCw0OC4wMyBDMTU1LjI4OSw0Ni43NzggMTUyLjY5OSw0Ni44MzYgMTQ5LjgxNiw0OC41MDEgQzE0NC40MzMsNTEuNjA5IDE0MC4wNjgsNTkuMTM3IDE0MC4wNjgsNjUuMzE0IEMxNDAuMDY4LDY3LjM2NSAxNDAuNTUyLDY5LjAwNiAxNDEuMzkxLDcwLjE3NCBDMTQzLjE3Niw3MS40MjcgMTQ1Ljc2NSw3MS4zNjkgMTQ4LjY0OCw2OS43MDQiIGlkPSJGaWxsLTM0IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NC4yNzYsNzEuMjc2IEwxNDQuMjc2LDcxLjI3NiBDMTQzLjEzMyw3MS4yNzYgMTQyLjExOCw3MC45NjkgMTQxLjI1Nyw3MC4zNjUgQzE0MS4yMzYsNzAuMzUxIDE0MS4yMTcsNzAuMzMyIDE0MS4yMDIsNzAuMzExIEMxNDAuMzA3LDY5LjA2NyAxMzkuODM1LDY3LjMzOSAxMzkuODM1LDY1LjMxNCBDMTM5LjgzNSw1OS4wNzMgMTQ0LjI2LDUxLjQzOSAxNDkuNyw0OC4yOTggQzE1MS4yNzMsNDcuMzkgMTUyLjc4NCw0Ni45MjkgMTU0LjE4OSw0Ni45MjkgQzE1NS4zMzIsNDYuOTI5IDE1Ni4zNDcsNDcuMjM2IDE1Ny4yMDgsNDcuODM5IEMxNTcuMjI5LDQ3Ljg1NCAxNTcuMjQ4LDQ3Ljg3MyAxNTcuMjYzLDQ3Ljg5NCBDMTU4LjE1Nyw0OS4xMzggMTU4LjYzLDUwLjg2NSAxNTguNjMsNTIuODkxIEMxNTguNjMsNTkuMTMyIDE1NC4yMDUsNjYuNzY2IDE0OC43NjUsNjkuOTA3IEMxNDcuMTkyLDcwLjgxNSAxNDUuNjgxLDcxLjI3NiAxNDQuMjc2LDcxLjI3NiBMMTQ0LjI3Niw3MS4yNzYgWiBNMTQxLjU1OCw3MC4xMDQgQzE0Mi4zMzEsNzAuNjM3IDE0My4yNDUsNzEuMDA1IDE0NC4yNzYsNzEuMDA1IEMxNDUuNTk4LDcxLjAwNSAxNDcuMDMsNzAuNDY3IDE0OC41MzIsNjkuNiBDMTUzLjg0Miw2Ni41MzQgMTU4LjE2Myw1OS4wMzMgMTU4LjE2Myw1Mi45MzkgQzE1OC4xNjMsNTEuMDMxIDE1Ny43MjksNDkuMzg1IDE1Ni45MDcsNDguMjIzIEMxNTYuMTMzLDQ3LjY5MSAxNTUuMjE5LDQ3LjQwOSAxNTQuMTg5LDQ3LjQwOSBDMTUyLjg2Nyw0Ny40MDkgMTUxLjQzNSw0Ny44NDIgMTQ5LjkzMyw0OC43MDkgQzE0NC42MjMsNTEuNzc1IDE0MC4zMDIsNTkuMjczIDE0MC4zMDIsNjUuMzY2IEMxNDAuMzAyLDY3LjI3NiAxNDAuNzM2LDY4Ljk0MiAxNDEuNTU4LDcwLjEwNCBMMTQxLjU1OCw3MC4xMDQgWiIgaWQ9IkZpbGwtMzUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUwLjcyLDY1LjM2MSBMMTUwLjM1Nyw2NS4wNjYgQzE1MS4xNDcsNjQuMDkyIDE1MS44NjksNjMuMDQgMTUyLjUwNSw2MS45MzggQzE1My4zMTMsNjAuNTM5IDE1My45NzgsNTkuMDY3IDE1NC40ODIsNTcuNTYzIEwxNTQuOTI1LDU3LjcxMiBDMTU0LjQxMiw1OS4yNDUgMTUzLjczMyw2MC43NDUgMTUyLjkxLDYyLjE3MiBDMTUyLjI2Miw2My4yOTUgMTUxLjUyNSw2NC4zNjggMTUwLjcyLDY1LjM2MSIgaWQ9IkZpbGwtMzYiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE1LjkxNyw4NC41MTQgTDExNS41NTQsODQuMjIgQzExNi4zNDQsODMuMjQ1IDExNy4wNjYsODIuMTk0IDExNy43MDIsODEuMDkyIEMxMTguNTEsNzkuNjkyIDExOS4xNzUsNzguMjIgMTE5LjY3OCw3Ni43MTcgTDEyMC4xMjEsNzYuODY1IEMxMTkuNjA4LDc4LjM5OCAxMTguOTMsNzkuODk5IDExOC4xMDYsODEuMzI2IEMxMTcuNDU4LDgyLjQ0OCAxMTYuNzIyLDgzLjUyMSAxMTUuOTE3LDg0LjUxNCIgaWQ9IkZpbGwtMzciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE0LDEzMC40NzYgTDExNCwxMzAuMDA4IEwxMTQsNzYuMDUyIEwxMTQsNzUuNTg0IEwxMTQsNzYuMDUyIEwxMTQsMTMwLjAwOCBMMTE0LDEzMC40NzYiIGlkPSJGaWxsLTM4IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYyLjAwMDAwMCwgMC4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTkuODIyLDM3LjQ3NCBDMTkuODM5LDM3LjMzOSAxOS43NDcsMzcuMTk0IDE5LjU1NSwzNy4wODIgQzE5LjIyOCwzNi44OTQgMTguNzI5LDM2Ljg3MiAxOC40NDYsMzcuMDM3IEwxMi40MzQsNDAuNTA4IEMxMi4zMDMsNDAuNTg0IDEyLjI0LDQwLjY4NiAxMi4yNDMsNDAuNzkzIEMxMi4yNDUsNDAuOTI1IDEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQxLjM3MSBMMTIuMjQ1LDQxLjQxNCBMMTIuMjM4LDQxLjU0MiBDOC4xNDgsNDMuODg3IDUuNjQ3LDQ1LjMyMSA1LjY0Nyw0NS4zMjEgQzUuNjQ2LDQ1LjMyMSAzLjU3LDQ2LjM2NyAyLjg2LDUwLjUxMyBDMi44Niw1MC41MTMgMS45NDgsNTcuNDc0IDEuOTYyLDcwLjI1OCBDMS45NzcsODIuODI4IDIuNTY4LDg3LjMyOCAzLjEyOSw5MS42MDkgQzMuMzQ5LDkzLjI5MyA2LjEzLDkzLjczNCA2LjEzLDkzLjczNCBDNi40NjEsOTMuNzc0IDYuODI4LDkzLjcwNyA3LjIxLDkzLjQ4NiBMODIuNDgzLDQ5LjkzNSBDODQuMjkxLDQ4Ljg2NiA4NS4xNSw0Ni4yMTYgODUuNTM5LDQzLjY1MSBDODYuNzUyLDM1LjY2MSA4Ny4yMTQsMTAuNjczIDg1LjI2NCwzLjc3MyBDODUuMDY4LDMuMDggODQuNzU0LDIuNjkgODQuMzk2LDIuNDkxIEw4Mi4zMSwxLjcwMSBDODEuNTgzLDEuNzI5IDgwLjg5NCwyLjE2OCA4MC43NzYsMi4yMzYgQzgwLjYzNiwyLjMxNyA0MS44MDcsMjQuNTg1IDIwLjAzMiwzNy4wNzIgTDE5LjgyMiwzNy40NzQiIGlkPSJGaWxsLTEiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNODIuMzExLDEuNzAxIEw4NC4zOTYsMi40OTEgQzg0Ljc1NCwyLjY5IDg1LjA2OCwzLjA4IDg1LjI2NCwzLjc3MyBDODcuMjEzLDEwLjY3MyA4Ni43NTEsMzUuNjYgODUuNTM5LDQzLjY1MSBDODUuMTQ5LDQ2LjIxNiA4NC4yOSw0OC44NjYgODIuNDgzLDQ5LjkzNSBMNy4yMSw5My40ODYgQzYuODk3LDkzLjY2NyA2LjU5NSw5My43NDQgNi4zMTQsOTMuNzQ0IEw2LjEzMSw5My43MzMgQzYuMTMxLDkzLjczNCAzLjM0OSw5My4yOTMgMy4xMjgsOTEuNjA5IEMyLjU2OCw4Ny4zMjcgMS45NzcsODIuODI4IDEuOTYzLDcwLjI1OCBDMS45NDgsNTcuNDc0IDIuODYsNTAuNTEzIDIuODYsNTAuNTEzIEMzLjU3LDQ2LjM2NyA1LjY0Nyw0NS4zMjEgNS42NDcsNDUuMzIxIEM1LjY0Nyw0NS4zMjEgOC4xNDgsNDMuODg3IDEyLjIzOCw0MS41NDIgTDEyLjI0NSw0MS40MTQgTDEyLjI0NSw0MS4zNzEgQzEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQwLjkyNSAxMi4yNDMsNDAuNzkzIEMxMi4yNCw0MC42ODYgMTIuMzAyLDQwLjU4MyAxMi40MzQsNDAuNTA4IEwxOC40NDYsMzcuMDM2IEMxOC41NzQsMzYuOTYyIDE4Ljc0NiwzNi45MjYgMTguOTI3LDM2LjkyNiBDMTkuMTQ1LDM2LjkyNiAxOS4zNzYsMzYuOTc5IDE5LjU1NCwzNy4wODIgQzE5Ljc0NywzNy4xOTQgMTkuODM5LDM3LjM0IDE5LjgyMiwzNy40NzQgTDIwLjAzMywzNy4wNzIgQzQxLjgwNiwyNC41ODUgODAuNjM2LDIuMzE4IDgwLjc3NywyLjIzNiBDODAuODk0LDIuMTY4IDgxLjU4MywxLjcyOSA4Mi4zMTEsMS43MDEgTTgyLjMxMSwwLjcwNCBMODIuMjcyLDAuNzA1IEM4MS42NTQsMC43MjggODAuOTg5LDAuOTQ5IDgwLjI5OCwxLjM2MSBMODAuMjc3LDEuMzczIEM4MC4xMjksMS40NTggNTkuNzY4LDEzLjEzNSAxOS43NTgsMzYuMDc5IEMxOS41LDM1Ljk4MSAxOS4yMTQsMzUuOTI5IDE4LjkyNywzNS45MjkgQzE4LjU2MiwzNS45MjkgMTguMjIzLDM2LjAxMyAxNy45NDcsMzYuMTczIEwxMS45MzUsMzkuNjQ0IEMxMS40OTMsMzkuODk5IDExLjIzNiw0MC4zMzQgMTEuMjQ2LDQwLjgxIEwxMS4yNDcsNDAuOTYgTDUuMTY3LDQ0LjQ0NyBDNC43OTQsNDQuNjQ2IDIuNjI1LDQ1Ljk3OCAxLjg3Nyw1MC4zNDUgTDEuODcxLDUwLjM4NCBDMS44NjIsNTAuNDU0IDAuOTUxLDU3LjU1NyAwLjk2NSw3MC4yNTkgQzAuOTc5LDgyLjg3OSAxLjU2OCw4Ny4zNzUgMi4xMzcsOTEuNzI0IEwyLjEzOSw5MS43MzkgQzIuNDQ3LDk0LjA5NCA1LjYxNCw5NC42NjIgNS45NzUsOTQuNzE5IEw2LjAwOSw5NC43MjMgQzYuMTEsOTQuNzM2IDYuMjEzLDk0Ljc0MiA2LjMxNCw5NC43NDIgQzYuNzksOTQuNzQyIDcuMjYsOTQuNjEgNy43MSw5NC4zNSBMODIuOTgzLDUwLjc5OCBDODQuNzk0LDQ5LjcyNyA4NS45ODIsNDcuMzc1IDg2LjUyNSw0My44MDEgQzg3LjcxMSwzNS45ODcgODguMjU5LDEwLjcwNSA4Ni4yMjQsMy41MDIgQzg1Ljk3MSwyLjYwOSA4NS41MiwxLjk3NSA4NC44ODEsMS42MiBMODQuNzQ5LDEuNTU4IEw4Mi42NjQsMC43NjkgQzgyLjU1MSwwLjcyNSA4Mi40MzEsMC43MDQgODIuMzExLDAuNzA0IiBpZD0iRmlsbC0yIiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY2LjI2NywxMS41NjUgTDY3Ljc2MiwxMS45OTkgTDExLjQyMyw0NC4zMjUiIGlkPSJGaWxsLTMiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMjAyLDkwLjU0NSBDMTIuMDI5LDkwLjU0NSAxMS44NjIsOTAuNDU1IDExLjc2OSw5MC4yOTUgQzExLjYzMiw5MC4wNTcgMTEuNzEzLDg5Ljc1MiAxMS45NTIsODkuNjE0IEwzMC4zODksNzguOTY5IEMzMC42MjgsNzguODMxIDMwLjkzMyw3OC45MTMgMzEuMDcxLDc5LjE1MiBDMzEuMjA4LDc5LjM5IDMxLjEyNyw3OS42OTYgMzAuODg4LDc5LjgzMyBMMTIuNDUxLDkwLjQ3OCBMMTIuMjAyLDkwLjU0NSIgaWQ9IkZpbGwtNCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMy43NjQsNDIuNjU0IEwxMy42NTYsNDIuNTkyIEwxMy43MDIsNDIuNDIxIEwxOC44MzcsMzkuNDU3IEwxOS4wMDcsMzkuNTAyIEwxOC45NjIsMzkuNjczIEwxMy44MjcsNDIuNjM3IEwxMy43NjQsNDIuNjU0IiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTguNTIsOTAuMzc1IEw4LjUyLDQ2LjQyMSBMOC41ODMsNDYuMzg1IEw3NS44NCw3LjU1NCBMNzUuODQsNTEuNTA4IEw3NS43NzgsNTEuNTQ0IEw4LjUyLDkwLjM3NSBMOC41Miw5MC4zNzUgWiBNOC43Nyw0Ni41NjQgTDguNzcsODkuOTQ0IEw3NS41OTEsNTEuMzY1IEw3NS41OTEsNy45ODUgTDguNzcsNDYuNTY0IEw4Ljc3LDQ2LjU2NCBaIiBpZD0iRmlsbC02IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTI0Ljk4Niw4My4xODIgQzI0Ljc1Niw4My4zMzEgMjQuMzc0LDgzLjU2NiAyNC4xMzcsODMuNzA1IEwxMi42MzIsOTAuNDA2IEMxMi4zOTUsOTAuNTQ1IDEyLjQyNiw5MC42NTggMTIuNyw5MC42NTggTDEzLjI2NSw5MC42NTggQzEzLjU0LDkwLjY1OCAxMy45NTgsOTAuNTQ1IDE0LjE5NSw5MC40MDYgTDI1LjcsODMuNzA1IEMyNS45MzcsODMuNTY2IDI2LjEyOCw4My40NTIgMjYuMTI1LDgzLjQ0OSBDMjYuMTIyLDgzLjQ0NyAyNi4xMTksODMuMjIgMjYuMTE5LDgyLjk0NiBDMjYuMTE5LDgyLjY3MiAyNS45MzEsODIuNTY5IDI1LjcwMSw4Mi43MTkgTDI0Ljk4Niw4My4xODIiIGlkPSJGaWxsLTciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTMuMjY2LDkwLjc4MiBMMTIuNyw5MC43ODIgQzEyLjUsOTAuNzgyIDEyLjM4NCw5MC43MjYgMTIuMzU0LDkwLjYxNiBDMTIuMzI0LDkwLjUwNiAxMi4zOTcsOTAuMzk5IDEyLjU2OSw5MC4yOTkgTDI0LjA3NCw4My41OTcgQzI0LjMxLDgzLjQ1OSAyNC42ODksODMuMjI2IDI0LjkxOCw4My4wNzggTDI1LjYzMyw4Mi42MTQgQzI1LjcyMyw4Mi41NTUgMjUuODEzLDgyLjUyNSAyNS44OTksODIuNTI1IEMyNi4wNzEsODIuNTI1IDI2LjI0NCw4Mi42NTUgMjYuMjQ0LDgyLjk0NiBDMjYuMjQ0LDgzLjE2IDI2LjI0NSw4My4zMDkgMjYuMjQ3LDgzLjM4MyBMMjYuMjUzLDgzLjM4NyBMMjYuMjQ5LDgzLjQ1NiBDMjYuMjQ2LDgzLjUzMSAyNi4yNDYsODMuNTMxIDI1Ljc2Myw4My44MTIgTDE0LjI1OCw5MC41MTQgQzE0LDkwLjY2NSAxMy41NjQsOTAuNzgyIDEzLjI2Niw5MC43ODIgTDEzLjI2Niw5MC43ODIgWiBNMTIuNjY2LDkwLjUzMiBMMTIuNyw5MC41MzMgTDEzLjI2Niw5MC41MzMgQzEzLjUxOCw5MC41MzMgMTMuOTE1LDkwLjQyNSAxNC4xMzIsOTAuMjk5IEwyNS42MzcsODMuNTk3IEMyNS44MDUsODMuNDk5IDI1LjkzMSw4My40MjQgMjUuOTk4LDgzLjM4MyBDMjUuOTk0LDgzLjI5OSAyNS45OTQsODMuMTY1IDI1Ljk5NCw4Mi45NDYgTDI1Ljg5OSw4Mi43NzUgTDI1Ljc2OCw4Mi44MjQgTDI1LjA1NCw4My4yODcgQzI0LjgyMiw4My40MzcgMjQuNDM4LDgzLjY3MyAyNC4yLDgzLjgxMiBMMTIuNjk1LDkwLjUxNCBMMTIuNjY2LDkwLjUzMiBMMTIuNjY2LDkwLjUzMiBaIiBpZD0iRmlsbC04IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEzLjI2Niw4OS44NzEgTDEyLjcsODkuODcxIEMxMi41LDg5Ljg3MSAxMi4zODQsODkuODE1IDEyLjM1NCw4OS43MDUgQzEyLjMyNCw4OS41OTUgMTIuMzk3LDg5LjQ4OCAxMi41NjksODkuMzg4IEwyNC4wNzQsODIuNjg2IEMyNC4zMzIsODIuNTM1IDI0Ljc2OCw4Mi40MTggMjUuMDY3LDgyLjQxOCBMMjUuNjMyLDgyLjQxOCBDMjUuODMyLDgyLjQxOCAyNS45NDgsODIuNDc0IDI1Ljk3OCw4Mi41ODQgQzI2LjAwOCw4Mi42OTQgMjUuOTM1LDgyLjgwMSAyNS43NjMsODIuOTAxIEwxNC4yNTgsODkuNjAzIEMxNCw4OS43NTQgMTMuNTY0LDg5Ljg3MSAxMy4yNjYsODkuODcxIEwxMy4yNjYsODkuODcxIFogTTEyLjY2Niw4OS42MjEgTDEyLjcsODkuNjIyIEwxMy4yNjYsODkuNjIyIEMxMy41MTgsODkuNjIyIDEzLjkxNSw4OS41MTUgMTQuMTMyLDg5LjM4OCBMMjUuNjM3LDgyLjY4NiBMMjUuNjY3LDgyLjY2OCBMMjUuNjMyLDgyLjY2NyBMMjUuMDY3LDgyLjY2NyBDMjQuODE1LDgyLjY2NyAyNC40MTgsODIuNzc1IDI0LjIsODIuOTAxIEwxMi42OTUsODkuNjAzIEwxMi42NjYsODkuNjIxIEwxMi42NjYsODkuNjIxIFoiIGlkPSJGaWxsLTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMzcsOTAuODAxIEwxMi4zNyw4OS41NTQgTDEyLjM3LDkwLjgwMSIgaWQ9IkZpbGwtMTAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNi4xMyw5My45MDEgQzUuMzc5LDkzLjgwOCA0LjgxNiw5My4xNjQgNC42OTEsOTIuNTI1IEMzLjg2LDg4LjI4NyAzLjU0LDgzLjc0MyAzLjUyNiw3MS4xNzMgQzMuNTExLDU4LjM4OSA0LjQyMyw1MS40MjggNC40MjMsNTEuNDI4IEM1LjEzNCw0Ny4yODIgNy4yMSw0Ni4yMzYgNy4yMSw0Ni4yMzYgQzcuMjEsNDYuMjM2IDgxLjY2NywzLjI1IDgyLjA2OSwzLjAxNyBDODIuMjkyLDIuODg4IDg0LjU1NiwxLjQzMyA4NS4yNjQsMy45NCBDODcuMjE0LDEwLjg0IDg2Ljc1MiwzNS44MjcgODUuNTM5LDQzLjgxOCBDODUuMTUsNDYuMzgzIDg0LjI5MSw0OS4wMzMgODIuNDgzLDUwLjEwMSBMNy4yMSw5My42NTMgQzYuODI4LDkzLjg3NCA2LjQ2MSw5My45NDEgNi4xMyw5My45MDEgQzYuMTMsOTMuOTAxIDMuMzQ5LDkzLjQ2IDMuMTI5LDkxLjc3NiBDMi41NjgsODcuNDk1IDEuOTc3LDgyLjk5NSAxLjk2Miw3MC40MjUgQzEuOTQ4LDU3LjY0MSAyLjg2LDUwLjY4IDIuODYsNTAuNjggQzMuNTcsNDYuNTM0IDUuNjQ3LDQ1LjQ4OSA1LjY0Nyw0NS40ODkgQzUuNjQ2LDQ1LjQ4OSA4LjA2NSw0NC4wOTIgMTIuMjQ1LDQxLjY3OSBMMTMuMTE2LDQxLjU2IEwxOS43MTUsMzcuNzMgTDE5Ljc2MSwzNy4yNjkgTDYuMTMsOTMuOTAxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjMxNyw5NC4xNjEgTDYuMTAyLDk0LjE0OCBMNi4xMDEsOTQuMTQ4IEw1Ljg1Nyw5NC4xMDEgQzUuMTM4LDkzLjk0NSAzLjA4NSw5My4zNjUgMi44ODEsOTEuODA5IEMyLjMxMyw4Ny40NjkgMS43MjcsODIuOTk2IDEuNzEzLDcwLjQyNSBDMS42OTksNTcuNzcxIDIuNjA0LDUwLjcxOCAyLjYxMyw1MC42NDggQzMuMzM4LDQ2LjQxNyA1LjQ0NSw0NS4zMSA1LjUzNSw0NS4yNjYgTDEyLjE2Myw0MS40MzkgTDEzLjAzMyw0MS4zMiBMMTkuNDc5LDM3LjU3OCBMMTkuNTEzLDM3LjI0NCBDMTkuNTI2LDM3LjEwNyAxOS42NDcsMzcuMDA4IDE5Ljc4NiwzNy4wMjEgQzE5LjkyMiwzNy4wMzQgMjAuMDIzLDM3LjE1NiAyMC4wMDksMzcuMjkzIEwxOS45NSwzNy44ODIgTDEzLjE5OCw0MS44MDEgTDEyLjMyOCw0MS45MTkgTDUuNzcyLDQ1LjcwNCBDNS43NDEsNDUuNzIgMy43ODIsNDYuNzcyIDMuMTA2LDUwLjcyMiBDMy4wOTksNTAuNzgyIDIuMTk4LDU3LjgwOCAyLjIxMiw3MC40MjQgQzIuMjI2LDgyLjk2MyAyLjgwOSw4Ny40MiAzLjM3Myw5MS43MjkgQzMuNDY0LDkyLjQyIDQuMDYyLDkyLjg4MyA0LjY4Miw5My4xODEgQzQuNTY2LDkyLjk4NCA0LjQ4Niw5Mi43NzYgNC40NDYsOTIuNTcyIEMzLjY2NSw4OC41ODggMy4yOTEsODQuMzcgMy4yNzYsNzEuMTczIEMzLjI2Miw1OC41MiA0LjE2Nyw1MS40NjYgNC4xNzYsNTEuMzk2IEM0LjkwMSw0Ny4xNjUgNy4wMDgsNDYuMDU5IDcuMDk4LDQ2LjAxNCBDNy4wOTQsNDYuMDE1IDgxLjU0MiwzLjAzNCA4MS45NDQsMi44MDIgTDgxLjk3MiwyLjc4NSBDODIuODc2LDIuMjQ3IDgzLjY5MiwyLjA5NyA4NC4zMzIsMi4zNTIgQzg0Ljg4NywyLjU3MyA4NS4yODEsMy4wODUgODUuNTA0LDMuODcyIEM4Ny41MTgsMTEgODYuOTY0LDM2LjA5MSA4NS43ODUsNDMuODU1IEM4NS4yNzgsNDcuMTk2IDg0LjIxLDQ5LjM3IDgyLjYxLDUwLjMxNyBMNy4zMzUsOTMuODY5IEM2Ljk5OSw5NC4wNjMgNi42NTgsOTQuMTYxIDYuMzE3LDk0LjE2MSBMNi4zMTcsOTQuMTYxIFogTTYuMTcsOTMuNjU0IEM2LjQ2Myw5My42OSA2Ljc3NCw5My42MTcgNy4wODUsOTMuNDM3IEw4Mi4zNTgsNDkuODg2IEM4NC4xODEsNDguODA4IDg0Ljk2LDQ1Ljk3MSA4NS4yOTIsNDMuNzggQzg2LjQ2NiwzNi4wNDkgODcuMDIzLDExLjA4NSA4NS4wMjQsNC4wMDggQzg0Ljg0NiwzLjM3NyA4NC41NTEsMi45NzYgODQuMTQ4LDIuODE2IEM4My42NjQsMi42MjMgODIuOTgyLDIuNzY0IDgyLjIyNywzLjIxMyBMODIuMTkzLDMuMjM0IEM4MS43OTEsMy40NjYgNy4zMzUsNDYuNDUyIDcuMzM1LDQ2LjQ1MiBDNy4zMDQsNDYuNDY5IDUuMzQ2LDQ3LjUyMSA0LjY2OSw1MS40NzEgQzQuNjYyLDUxLjUzIDMuNzYxLDU4LjU1NiAzLjc3NSw3MS4xNzMgQzMuNzksODQuMzI4IDQuMTYxLDg4LjUyNCA0LjkzNiw5Mi40NzYgQzUuMDI2LDkyLjkzNyA1LjQxMiw5My40NTkgNS45NzMsOTMuNjE1IEM2LjA4Nyw5My42NCA2LjE1OCw5My42NTIgNi4xNjksOTMuNjU0IEw2LjE3LDkzLjY1NCBMNi4xNyw5My42NTQgWiIgaWQ9IkZpbGwtMTIiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4zMTcsNjguOTgyIEM3LjgwNiw2OC43MDEgOC4yMDIsNjguOTI2IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNi44MjksNzEuMjk0IDYuNDMzLDcxLjA2OSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIiBpZD0iRmlsbC0xMyIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjkyLDcxLjEzMyBDNi42MzEsNzEuMTMzIDYuNDMzLDcwLjkwNSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIEM3LjQ2LDY4LjkgNy41OTUsNjguODYxIDcuNzE0LDY4Ljg2MSBDOC4wMDMsNjguODYxIDguMjAyLDY5LjA5IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNy4xNzQsNzEuMDk0IDcuMDM5LDcxLjEzMyA2LjkyLDcxLjEzMyBNNy43MTQsNjguNjc0IEM3LjU1Nyw2OC42NzQgNy4zOTIsNjguNzIzIDcuMjI0LDY4LjgyMSBDNi42NzYsNjkuMTM4IDYuMjQ2LDY5Ljg3OSA2LjI0Niw3MC41MDggQzYuMjQ2LDcwLjk5NCA2LjUxNyw3MS4zMiA2LjkyLDcxLjMyIEM3LjA3OCw3MS4zMiA3LjI0Myw3MS4yNzEgNy40MTEsNzEuMTc0IEM3Ljk1OSw3MC44NTcgOC4zODksNzAuMTE3IDguMzg5LDY5LjQ4NyBDOC4zODksNjkuMDAxIDguMTE3LDY4LjY3NCA3LjcxNCw2OC42NzQiIGlkPSJGaWxsLTE0IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYuOTIsNzAuOTQ3IEM2LjY0OSw3MC45NDcgNi42MjEsNzAuNjQgNi42MjEsNzAuNTA4IEM2LjYyMSw3MC4wMTcgNi45ODIsNjkuMzkyIDcuNDExLDY5LjE0NSBDNy41MjEsNjkuMDgyIDcuNjI1LDY5LjA0OSA3LjcxNCw2OS4wNDkgQzcuOTg2LDY5LjA0OSA4LjAxNSw2OS4zNTUgOC4wMTUsNjkuNDg3IEM4LjAxNSw2OS45NzggNy42NTIsNzAuNjAzIDcuMjI0LDcwLjg1MSBDNy4xMTUsNzAuOTE0IDcuMDEsNzAuOTQ3IDYuOTIsNzAuOTQ3IE03LjcxNCw2OC44NjEgQzcuNTk1LDY4Ljg2MSA3LjQ2LDY4LjkgNy4zMTcsNjguOTgyIEM2LjgyOSw2OS4yNjUgNi40MzMsNjkuOTQ4IDYuNDMzLDcwLjUwOCBDNi40MzMsNzAuOTA1IDYuNjMxLDcxLjEzMyA2LjkyLDcxLjEzMyBDNy4wMzksNzEuMTMzIDcuMTc0LDcxLjA5NCA3LjMxNyw3MS4wMTIgQzcuODA2LDcwLjczIDguMjAyLDcwLjA0NyA4LjIwMiw2OS40ODcgQzguMjAyLDY5LjA5IDguMDAzLDY4Ljg2MSA3LjcxNCw2OC44NjEiIGlkPSJGaWxsLTE1IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTcuNDQ0LDg1LjM1IEM3LjcwOCw4NS4xOTggNy45MjEsODUuMzE5IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuOTI1IDcuNzA4LDg2LjI5MiA3LjQ0NCw4Ni40NDQgQzcuMTgxLDg2LjU5NyA2Ljk2Nyw4Ni40NzUgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IiBpZD0iRmlsbC0xNiIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LjIzLDg2LjUxIEM3LjA3NCw4Ni41MSA2Ljk2Nyw4Ni4zODcgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IEM3LjUyMSw4NS4zMDUgNy41OTQsODUuMjg0IDcuNjU4LDg1LjI4NCBDNy44MTQsODUuMjg0IDcuOTIxLDg1LjQwOCA3LjkyMSw4NS42MjIgQzcuOTIxLDg1LjkyNSA3LjcwOCw4Ni4yOTIgNy40NDQsODYuNDQ0IEM3LjM2Nyw4Ni40ODkgNy4yOTQsODYuNTEgNy4yMyw4Ni41MSBNNy42NTgsODUuMDk4IEM3LjU1OCw4NS4wOTggNy40NTUsODUuMTI3IDcuMzUxLDg1LjE4OCBDNy4wMzEsODUuMzczIDYuNzgxLDg1LjgwNiA2Ljc4MSw4Ni4xNzMgQzYuNzgxLDg2LjQ4MiA2Ljk2Niw4Ni42OTcgNy4yMyw4Ni42OTcgQzcuMzMsODYuNjk3IDcuNDMzLDg2LjY2NiA3LjUzOCw4Ni42MDcgQzcuODU4LDg2LjQyMiA4LjEwOCw4NS45ODkgOC4xMDgsODUuNjIyIEM4LjEwOCw4NS4zMTMgNy45MjMsODUuMDk4IDcuNjU4LDg1LjA5OCIgaWQ9IkZpbGwtMTciIGZpbGw9IiM4MDk3QTIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4yMyw4Ni4zMjIgTDcuMTU0LDg2LjE3MyBDNy4xNTQsODUuOTM4IDcuMzMzLDg1LjYyOSA3LjUzOCw4NS41MTIgTDcuNjU4LDg1LjQ3MSBMNy43MzQsODUuNjIyIEM3LjczNCw4NS44NTYgNy41NTUsODYuMTY0IDcuMzUxLDg2LjI4MiBMNy4yMyw4Ni4zMjIgTTcuNjU4LDg1LjI4NCBDNy41OTQsODUuMjg0IDcuNTIxLDg1LjMwNSA3LjQ0NCw4NS4zNSBDNy4xODEsODUuNTAyIDYuOTY3LDg1Ljg3MSA2Ljk2Nyw4Ni4xNzMgQzYuOTY3LDg2LjM4NyA3LjA3NCw4Ni41MSA3LjIzLDg2LjUxIEM3LjI5NCw4Ni41MSA3LjM2Nyw4Ni40ODkgNy40NDQsODYuNDQ0IEM3LjcwOCw4Ni4yOTIgNy45MjEsODUuOTI1IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuNDA4IDcuODE0LDg1LjI4NCA3LjY1OCw4NS4yODQiIGlkPSJGaWxsLTE4IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTc3LjI3OCw3Ljc2OSBMNzcuMjc4LDUxLjQzNiBMMTAuMjA4LDkwLjE2IEwxMC4yMDgsNDYuNDkzIEw3Ny4yNzgsNy43NjkiIGlkPSJGaWxsLTE5IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEwLjA4Myw5MC4zNzUgTDEwLjA4Myw0Ni40MjEgTDEwLjE0Niw0Ni4zODUgTDc3LjQwMyw3LjU1NCBMNzcuNDAzLDUxLjUwOCBMNzcuMzQxLDUxLjU0NCBMMTAuMDgzLDkwLjM3NSBMMTAuMDgzLDkwLjM3NSBaIE0xMC4zMzMsNDYuNTY0IEwxMC4zMzMsODkuOTQ0IEw3Ny4xNTQsNTEuMzY1IEw3Ny4xNTQsNy45ODUgTDEwLjMzMyw0Ni41NjQgTDEwLjMzMyw0Ni41NjQgWiIgaWQ9IkZpbGwtMjAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMjUuNzM3LDg4LjY0NyBMMTE4LjA5OCw5MS45ODEgTDExOC4wOTgsODQgTDEwNi42MzksODguNzEzIEwxMDYuNjM5LDk2Ljk4MiBMOTksMTAwLjMxNSBMMTEyLjM2OSwxMDMuOTYxIEwxMjUuNzM3LDg4LjY0NyIgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTIiIGZpbGw9IiM0NTVBNjQiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+\")\n},t.exports=i},{\"./util.js\":24}],19:[function(e,t){function i(e){this.kFilter=e,this.currentAccelMeasurement=new r,this.currentGyroMeasurement=new r,this.previousGyroMeasurement=new r,this.filterQ=new n.Quaternion,this.previousFilterQ=new n.Quaternion,this.accelQ=new n.Quaternion,this.isOrientationInitialized=!1,this.estimatedGravity=new n.Vector3,this.measuredGravity=new n.Vector3,this.gyroIntegralQ=new n.Quaternion}var r=e(\"./sensor-sample.js\"),n=e(\"../math-util.js\"),a=e(\"../util.js\"),o=!1;i.prototype.addAccelMeasurement=function(e,t){this.currentAccelMeasurement.set(e,t)},i.prototype.addGyroMeasurement=function(e,t){this.currentGyroMeasurement.set(e,t);var i=t-this.previousGyroMeasurement.timestampS;a.isTimestampDeltaValid(i)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},i.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0,void 0;var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(t),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(t);var i=new n.Quaternion;i.copy(this.filterQ),i.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(i),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var r=new n.Quaternion;r.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),r.inverse(),o&&console.log(\"Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)\",n.radToDeg*a.getQuaternionAngle(r),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var s=new n.Quaternion;s.copy(this.filterQ),s.multiply(r),this.filterQ.slerp(s,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},i.prototype.getOrientation=function(){return this.filterQ},i.prototype.accelToQuaternion_=function(e){var t=new n.Vector3;t.copy(e),t.normalize();var i=new n.Quaternion;return i.setFromUnitVectors(new n.Vector3(0,0,-1),t),i.inverse(),i},i.prototype.gyroToQuaternionDelta_=function(e,t){var i=new n.Quaternion,r=new n.Vector3;return r.copy(e),r.normalize(),i.setFromAxisAngle(r,e.length()*t),i},t.exports=i},{\"../math-util.js\":16,\"../util.js\":24,\"./sensor-sample.js\":22}],20:[function(e,t){function i(){this.deviceId=\"webvr-polyfill:fused\",this.deviceName=\"VR Position Device (webvr-polyfill:fused)\",this.accelerometer=new o.Vector3,this.gyroscope=new o.Vector3,window.addEventListener(\"devicemotion\",this.onDeviceMotionChange_.bind(this)),window.addEventListener(\"orientationchange\",this.onScreenOrientationChange_.bind(this)),this.filter=new r(WebVRConfig.K_FILTER),this.posePredictor=new n(WebVRConfig.PREDICTION_TIME_S),this.touchPanner=new a,this.filterToWorldQ=new o.Quaternion,s.isIOS()?this.filterToWorldQ.setFromAxisAngle(new o.Vector3(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new o.Vector3(1,0,0),-Math.PI/2),this.landscapeAdjustQ=new o.Quaternion,this.landscapeAdjustQ.setFromAxisAngle(new o.Vector3(0,0,1),window.orientation/Math.PI/2),s.isLandscapeMode()&&this.filterToWorldQ.multiply(this.landscapeAdjustQ),this.worldToScreenQ=new o.Quaternion,this.setScreenTransform_(),this.resetQ=new o.Quaternion,this.isFirefoxAndroid=s.isFirefoxAndroid(),this.isIOS=s.isIOS(),this.orientationOut_=new Float32Array(4)}var r=e(\"./complementary-filter.js\"),n=e(\"./pose-predictor.js\"),a=e(\"../touch-panner.js\"),o=e(\"../math-util.js\"),s=e(\"../util.js\");i.prototype.getPosition=function(){return null},i.prototype.getOrientation=function(){var e=this.filter.getOrientation();this.predictedQ=this.posePredictor.getPrediction(e,this.gyroscope,this.previousTimestampS);var t=new o.Quaternion;return t.copy(this.filterToWorldQ),t.multiply(this.resetQ),WebVRConfig.TOUCH_PANNER_DISABLED||t.multiply(this.touchPanner.getOrientation()),t.multiply(this.predictedQ),t.multiply(this.worldToScreenQ),WebVRConfig.YAW_ONLY&&(t.x=0,t.z=0,t.normalize()),this.orientationOut_[0]=t.x,this.orientationOut_[1]=t.y,this.orientationOut_[2]=t.z,this.orientationOut_[3]=t.w,this.orientationOut_},i.prototype.resetPose=function(){s.isLandscapeMode()||this.resetQ.multiply(this.landscapeAdjustQ),this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),WebVRConfig.TOUCH_PANNER_DISABLED||this.touchPanner.resetSensor()},i.prototype.onDeviceMotionChange_=function(e){var t=e.accelerationIncludingGravity,i=e.rotationRate,r=e.timeStamp/1e3;this.isFirefoxAndroid&&(r/=1e3);var n=r-this.previousTimestampS;return n<=s.MIN_TIMESTEP||n>s.MAX_TIMESTEP?(console.warn(\"Invalid timestamps detected. Time step between successive gyroscope sensor samples is very small or not monotonic\"),this.previousTimestampS=r,void 0):(this.accelerometer.set(-t.x,-t.y,-t.z),this.gyroscope.set(i.alpha,i.beta,i.gamma),(this.isIOS||this.isFirefoxAndroid)&&this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,r),this.filter.addGyroMeasurement(this.gyroscope,r),this.previousTimestampS=r,void 0)},i.prototype.onScreenOrientationChange_=function(){this.setScreenTransform_()},i.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new o.Vector3(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new o.Vector3(0,0,1),Math.PI/2);break;case 180:}},t.exports=i},{\"../math-util.js\":16,\"../touch-panner.js\":23,\"../util.js\":24,\"./complementary-filter.js\":19,\"./pose-predictor.js\":21}],21:[function(e,t){function i(e){this.predictionTimeS=e,this.previousQ=new r.Quaternion,this.previousTimestampS=null,this.deltaQ=new r.Quaternion,this.outQ=new r.Quaternion}var r=e(\"../math-util.js\"),n=!1;i.prototype.getPrediction=function(e,t,i){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=i,e;var a=new r.Vector3;a.copy(t),a.normalize();var o=t.length();if(o<20*r.degToRad)return n&&console.log(\"Moving slowly, at %s deg/s: no prediction\",(r.radToDeg*o).toFixed(1)),this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var s=(i-this.previousTimestampS,o*this.predictionTimeS);return this.deltaQ.setFromAxisAngle(a,s),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.outQ},t.exports=i},{\"../math-util.js\":16}],22:[function(e,t){function i(e,t){this.set(e,t)}i.prototype.set=function(e,t){this.sample=e,this.timestampS=t},i.prototype.copy=function(e){this.set(e.sample,e.timestampS)},t.exports=i},{}],23:[function(e,t){function i(){window.addEventListener(\"touchstart\",this.onTouchStart_.bind(this)),window.addEventListener(\"touchmove\",this.onTouchMove_.bind(this)),window.addEventListener(\"touchend\",this.onTouchEnd_.bind(this)),this.isTouching=!1,this.rotateStart=new r.Vector2,this.rotateEnd=new r.Vector2,this.rotateDelta=new r.Vector2,this.theta=0,this.orientation=new r.Quaternion}var r=e(\"./math-util.js\"),n=e(\"./util.js\"),a=.5;i.prototype.getOrientation=function(){return this.orientation.setFromEulerXYZ(0,0,this.theta),this.orientation},i.prototype.resetSensor=function(){this.theta=0},i.prototype.onTouchStart_=function(e){1==e.touches.length&&(this.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),this.isTouching=!0)},i.prototype.onTouchMove_=function(e){if(this.isTouching){this.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd),n.isIOS()&&(this.rotateDelta.x*=-1);var t=document.body;this.theta+=2*Math.PI*this.rotateDelta.x/t.clientWidth*a}},i.prototype.onTouchEnd_=function(){this.isTouching=!1},t.exports=i},{\"./math-util.js\":16,\"./util.js\":24}],24:[function(e,t){var i=e(\"object-assign\"),r=window.Util||{};r.MIN_TIMESTEP=.001,r.MAX_TIMESTEP=1,r.base64=function(e,t){return\"data:\"+e+\";base64,\"+t},r.clamp=function(e,t,i){return Math.min(Math.max(t,e),i)},r.lerp=function(e,t,i){return e+(t-e)*i},r.isIOS=function(){var e=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return e}}(),r.isSafari=function(){var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return e}}(),r.isFirefoxAndroid=function(){var e=-1!==navigator.userAgent.indexOf(\"Firefox\")&&-1!==navigator.userAgent.indexOf(\"Android\");return function(){return e}}(),r.isLandscapeMode=function(){return 90==window.orientation||-90==window.orientation},r.isTimestampDeltaValid=function(e){return isNaN(e)?!1:e<=r.MIN_TIMESTEP?!1:e>r.MAX_TIMESTEP?!1:!0},r.getScreenWidth=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},r.getScreenHeight=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},r.requestFullscreen=function(e){if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else{if(!e.msRequestFullscreen)return!1;e.msRequestFullscreen()}return!0},r.exitFullscreen=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},r.getFullscreenElement=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},r.linkProgram=function(e,t,i,r){var n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t),e.compileShader(n);var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,i),e.compileShader(a);var o=e.createProgram();e.attachShader(o,n),e.attachShader(o,a);for(var s in r)e.bindAttribLocation(o,r[s],s);return e.linkProgram(o),e.deleteShader(n),e.deleteShader(a),o},r.getProgramUniforms=function(e,t){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=\"\",a=0;r>a;a++){var o=e.getActiveUniform(t,a);n=o.name.replace(\"[0]\",\"\"),i[n]=e.getUniformLocation(t,n)}return i},r.orthoMatrix=function(e,t,i,r,n,a,o){var s=1/(t-i),c=1/(r-n),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*c,e[14]=(o+a)*u,e[15]=1,e},r.isMobile=function(){var e=!1;return function(t){(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},r.extend=i,t.exports=r},{\"object-assign\":3}],25:[function(e,t){function i(){try{this.selectedKey=localStorage.getItem(o)||a}catch(e){console.error(\"Failed to load viewer profile: %s\",e)}this.dialog=this.createDialog_(n.Viewers),this.root=null}var r=e(\"./emitter.js\"),n=(e(\"./util.js\"),e(\"./device-info.js\")),a=\"CardboardV1\",o=\"WEBVR_CARDBOARD_VIEWER\",s=\"webvr-polyfill-viewer-selector\";i.prototype=new r,i.prototype.show=function(e){this.root=e,e.appendChild(this.dialog);var t=this.dialog.querySelector(\"#\"+this.selectedKey);t.checked=!0,this.dialog.style.display=\"block\"},i.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display=\"none\"},i.prototype.getCurrentViewer=function(){return n.Viewers[this.selectedKey]},i.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector(\"input[name=field]:checked\");return e?e.id:null},i.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!n.Viewers[this.selectedKey])return console.error(\"ViewerSelector.onSave_: this should never happen!\"),void 0;this.emit(\"change\",n.Viewers[this.selectedKey]);try{localStorage.setItem(o,this.selectedKey)}catch(e){console.error(\"Failed to save viewer profile: %s\",e)}this.hide()},i.prototype.createDialog_=function(e){var t=document.createElement(\"div\");t.classList.add(s),t.style.display=\"none\";var i=document.createElement(\"div\"),r=i.style;r.position=\"fixed\",r.left=0,r.top=0,r.width=\"100%\",r.height=\"100%\",r.background=\"rgba(0, 0, 0, 0.3)\",i.addEventListener(\"click\",this.hide.bind(this));var n=280,a=document.createElement(\"div\"),r=a.style;r.boxSizing=\"border-box\",r.position=\"fixed\",r.top=\"24px\",r.left=\"50%\",r.marginLeft=-n/2+\"px\",r.width=n+\"px\",r.padding=\"24px\",r.overflow=\"hidden\",r.background=\"#fafafa\",r.fontFamily=\"'Roboto', sans-serif\",r.boxShadow=\"0px 5px 20px #666\",a.appendChild(this.createH1_(\"Select your viewer\"));for(var o in e)a.appendChild(this.createChoice_(o,e[o].label));return a.appendChild(this.createButton_(\"Save\",this.onSave_.bind(this))),t.appendChild(i),t.appendChild(a),t},i.prototype.createH1_=function(e){var t=document.createElement(\"h1\"),i=t.style;return i.color=\"black\",i.fontSize=\"20px\",i.fontWeight=\"bold\",i.marginTop=0,i.marginBottom=\"24px\",t.innerHTML=e,t},i.prototype.createChoice_=function(e,t){var i=document.createElement(\"div\");i.style.marginTop=\"8px\",i.style.color=\"black\";var r=document.createElement(\"input\");r.style.fontSize=\"30px\",r.setAttribute(\"id\",e),r.setAttribute(\"type\",\"radio\"),r.setAttribute(\"value\",e),r.setAttribute(\"name\",\"field\");var n=document.createElement(\"label\");return n.style.marginLeft=\"4px\",n.setAttribute(\"for\",e),n.innerHTML=t,i.appendChild(r),i.appendChild(n),i},i.prototype.createButton_=function(e,t){var i=document.createElement(\"button\");i.innerHTML=e;var r=i.style;return r.float=\"right\",r.textTransform=\"uppercase\",r.color=\"#1094f7\",r.fontSize=\"14px\",r.letterSpacing=0,r.border=0,r.background=\"none\",r.marginTop=\"16px\",i.addEventListener(\"click\",t),i},t.exports=i},{\"./device-info.js\":9,\"./emitter.js\":14,\"./util.js\":24}],26:[function(e,t){function i(){var e=document.createElement(\"video\");e.addEventListener(\"ended\",function(){e.play()}),this.request=function(){e.paused&&(e.src=a.base64(\"video/mp4\",\"AAAAGGZ0eXBpc29tAAAAAG1wNDFhdmMxAAAIA21vb3YAAABsbXZoZAAAAADSa9v60mvb+gABX5AAlw/gAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAdkdHJhawAAAFx0a2hkAAAAAdJr2/rSa9v6AAAAAQAAAAAAlw/gAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAQAAAAHAAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAJcP4AAAAAAAAQAAAAAG3G1kaWEAAAAgbWRoZAAAAADSa9v60mvb+gAPQkAGjneAFccAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAABodtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAZHc3RibAAAAJdzdHNkAAAAAAAAAAEAAACHYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAMABwASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADFhdmNDAWQAC//hABlnZAALrNlfllw4QAAAAwBAAAADAKPFCmWAAQAFaOvssiwAAAAYc3R0cwAAAAAAAAABAAAAbgAPQkAAAAAUc3RzcwAAAAAAAAABAAAAAQAAA4BjdHRzAAAAAAAAAG4AAAABAD0JAAAAAAEAehIAAAAAAQA9CQAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEATEtAAAAAAQAehIAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEATEtAAAAAAQAehIAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEATEtAAAAAAQAehIAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEATEtAAAAAAQAehIAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEATEtAAAAAAQAehIAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEATEtAAAAAAQAehIAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEATEtAAAAAAQAehIAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEATEtAAAAAAQAehIAAAAABAAAAAAAAAAEAD0JAAAAAAQBMS0AAAAABAB6EgAAAAAEAAAAAAAAAAQAPQkAAAAABAExLQAAAAAEAHoSAAAAAAQAAAAAAAAABAA9CQAAAAAEALcbAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAABuAAAAAQAAAcxzdHN6AAAAAAAAAAAAAABuAAADCQAAABgAAAAOAAAADgAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABIAAAAOAAAADAAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABIAAAAOAAAADAAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABIAAAAOAAAADAAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABIAAAAOAAAADAAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABIAAAAOAAAADAAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABIAAAAOAAAADAAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABIAAAAOAAAADAAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABIAAAAOAAAADAAAAAwAAAASAAAADgAAAAwAAAAMAAAAEgAAAA4AAAAMAAAADAAAABMAAAAUc3RjbwAAAAAAAAABAAAIKwAAACt1ZHRhAAAAI6llbmMAFwAAdmxjIDIuMi4xIHN0cmVhbSBvdXRwdXQAAAAId2lkZQAACRRtZGF0AAACrgX//6vcRem95tlIt5Ys2CDZI+7veDI2NCAtIGNvcmUgMTQyIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDEzIG1lPWhleCBzdWJtZT03IHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MTYgY2hyb21hX21lPTEgdHJlbGxpcz0xIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MTIgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTEgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1hYnIgbWJ0cmVlPTEgYml0cmF0ZT0xMDAgcmF0ZXRvbD0xLjAgcWNvbXA9MC42MCBxcG1pbj0xMCBxcG1heD01MSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAU2WIhAAQ/8ltlOe+cTZuGkKg+aRtuivcDZ0pBsfsEi9p/i1yU9DxS2lq4dXTinViF1URBKXgnzKBd/Uh1bkhHtMrwrRcOJslD01UB+fyaL6ef+DBAAAAFEGaJGxBD5B+v+a+4QqF3MgBXz9MAAAACkGeQniH/+94r6EAAAAKAZ5hdEN/8QytwAAAAAgBnmNqQ3/EgQAAAA5BmmhJqEFomUwIIf/+4QAAAApBnoZFESw//76BAAAACAGepXRDf8SBAAAACAGep2pDf8SAAAAADkGarEmoQWyZTAgh//7gAAAACkGeykUVLD//voEAAAAIAZ7pdEN/xIAAAAAIAZ7rakN/xIAAAAAOQZrwSahBbJlMCCH//uEAAAAKQZ8ORRUsP/++gQAAAAgBny10Q3/EgQAAAAgBny9qQ3/EgAAAAA5BmzRJqEFsmUwIIf/+4AAAAApBn1JFFSw//76BAAAACAGfcXRDf8SAAAAACAGfc2pDf8SAAAAADkGbeEmoQWyZTAgh//7hAAAACkGflkUVLD//voAAAAAIAZ+1dEN/xIEAAAAIAZ+3akN/xIEAAAAOQZu8SahBbJlMCCH//uAAAAAKQZ/aRRUsP/++gQAAAAgBn/l0Q3/EgAAAAAgBn/tqQ3/EgQAAAA5Bm+BJqEFsmUwIIf/+4QAAAApBnh5FFSw//76AAAAACAGePXRDf8SAAAAACAGeP2pDf8SBAAAADkGaJEmoQWyZTAgh//7gAAAACkGeQkUVLD//voEAAAAIAZ5hdEN/xIAAAAAIAZ5jakN/xIEAAAAOQZpoSahBbJlMCCH//uEAAAAKQZ6GRRUsP/++gQAAAAgBnqV0Q3/EgQAAAAgBnqdqQ3/EgAAAAA5BmqxJqEFsmUwIIf/+4AAAAApBnspFFSw//76BAAAACAGe6XRDf8SAAAAACAGe62pDf8SAAAAADkGa8EmoQWyZTAgh//7hAAAACkGfDkUVLD//voEAAAAIAZ8tdEN/xIEAAAAIAZ8vakN/xIAAAAAOQZs0SahBbJlMCCH//uAAAAAKQZ9SRRUsP/++gQAAAAgBn3F0Q3/EgAAAAAgBn3NqQ3/EgAAAAA5Bm3hJqEFsmUwIIf/+4QAAAApBn5ZFFSw//76AAAAACAGftXRDf8SBAAAACAGft2pDf8SBAAAADkGbvEmoQWyZTAgh//7gAAAACkGf2kUVLD//voEAAAAIAZ/5dEN/xIAAAAAIAZ/7akN/xIEAAAAOQZvgSahBbJlMCCH//uEAAAAKQZ4eRRUsP/++gAAAAAgBnj10Q3/EgAAAAAgBnj9qQ3/EgQAAAA5BmiRJqEFsmUwIIf/+4AAAAApBnkJFFSw//76BAAAACAGeYXRDf8SAAAAACAGeY2pDf8SBAAAADkGaaEmoQWyZTAgh//7hAAAACkGehkUVLD//voEAAAAIAZ6ldEN/xIEAAAAIAZ6nakN/xIAAAAAOQZqsSahBbJlMCCH//uAAAAAKQZ7KRRUsP/++gQAAAAgBnul0Q3/EgAAAAAgBnutqQ3/EgAAAAA5BmvBJqEFsmUwIIf/+4QAAAApBnw5FFSw//76BAAAACAGfLXRDf8SBAAAACAGfL2pDf8SAAAAADkGbNEmoQWyZTAgh//7gAAAACkGfUkUVLD//voEAAAAIAZ9xdEN/xIAAAAAIAZ9zakN/xIAAAAAOQZt4SahBbJlMCCH//uEAAAAKQZ+WRRUsP/++gAAAAAgBn7V0Q3/EgQAAAAgBn7dqQ3/EgQAAAA5Bm7xJqEFsmUwIIf/+4AAAAApBn9pFFSw//76BAAAACAGf+XRDf8SAAAAACAGf+2pDf8SBAAAADkGb4EmoQWyZTAgh//7hAAAACkGeHkUVLD//voAAAAAIAZ49dEN/xIAAAAAIAZ4/akN/xIEAAAAOQZokSahBbJlMCCH//uAAAAAKQZ5CRRUsP/++gQAAAAgBnmF0Q3/EgAAAAAgBnmNqQ3/EgQAAAA5BmmhJqEFsmUwIIf/+4QAAAApBnoZFFSw//76BAAAACAGepXRDf8SBAAAACAGep2pDf8SAAAAADkGarEmoQWyZTAgh//7gAAAACkGeykUVLD//voEAAAAIAZ7pdEN/xIAAAAAIAZ7rakN/xIAAAAAPQZruSahBbJlMFEw3//7B\"),e.play())},this.release=function(){e.pause(),e.src=\"\"}}function r(){var e=null;this.request=function(){e||(e=setInterval(function(){window.location=window.location,setTimeout(window.stop,0)},3e4))},this.release=function(){e&&(clearInterval(e),e=null)}}function n(){var e=navigator.userAgent||navigator.vendor||window.opera;return e.match(/iPhone/i)||e.match(/iPod/i)?r:i}var a=e(\"./util.js\");t.exports=n()},{\"./util.js\":24}],27:[function(e,t){function i(){this.displays=[],this.devices=[],this.devicesPopulated=!1,this.nativeWebVRAvailable=this.isWebVRAvailable(),this.nativeLegacyWebVRAvailable=this.isDeprecatedWebVRAvailable(),this.nativeLegacyWebVRAvailable||(this.nativeWebVRAvailable||this.enablePolyfill(),WebVRConfig.ENABLE_DEPRECATED_API&&this.enableDeprecatedPolyfill())}e(\"es6-promise\").polyfill();var r=e(\"./cardboard-vr-display.js\"),n=e(\"./mouse-keyboard-vr-display.js\"),a=e(\"./base.js\").VRDisplay,o=e(\"./base.js\").HMDVRDevice,s=e(\"./base.js\").PositionSensorVRDevice,c=e(\"./display-wrappers.js\").VRDisplayHMDDevice,u=e(\"./display-wrappers.js\").VRDisplayPositionSensorDevice;i.prototype.isWebVRAvailable=function(){return\"getVRDisplays\"in navigator},i.prototype.isDeprecatedWebVRAvailable=function(){return\"getVRDevices\"in navigator||\"mozGetVRDevices\"in navigator},i.prototype.populateDevices=function(){if(!this.devicesPopulated){var e=null;this.isCardboardCompatible()&&(e=new r,this.displays.push(e),WebVRConfig.ENABLE_DEPRECATED_API&&(this.devices.push(new c(e)),this.devices.push(new u(e)))),this.isMobile()||WebVRConfig.MOUSE_KEYBOARD_CONTROLS_DISABLED||(e=new n,this.displays.push(e),WebVRConfig.ENABLE_DEPRECATED_API&&(this.devices.push(new c(e)),this.devices.push(new u(e)))),this.devicesPopulated=!0}},i.prototype.enablePolyfill=function(){navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=a},i.prototype.enableDeprecatedPolyfill=function(){navigator.getVRDevices=this.getVRDevices.bind(this),window.HMDVRDevice=o,window.PositionSensorVRDevice=s},i.prototype.getVRDisplays=function(){this.populateDevices();var e=this.displays;return new Promise(function(t,i){try{t(e)}catch(r){i(r)}})},i.prototype.getVRDevices=function(){console.warn(\"getVRDevices is deprecated. Please update your code to use getVRDisplays instead.\");var e=this;return new Promise(function(t,i){try{if(!e.devicesPopulated){if(e.nativeWebVRAvailable)return navigator.getVRDisplays(function(i){for(var r=0;r<i.length;++r)e.devices.push(new c(i[r])),e.devices.push(new u(i[r]));e.devicesPopulated=!0,t(e.devices)},i);if(e.nativeLegacyWebVRAvailable)return(navigator.getVRDDevices||navigator.mozGetVRDevices)(function(i){for(var r=0;r<i.length;++r)i[r]instanceof o&&e.devices.push(i[r]),i[r]instanceof s&&e.devices.push(i[r]);e.devicesPopulated=!0,t(e.devices)},i)}e.populateDevices(),t(e.devices)}catch(r){i(r)}})},i.prototype.isMobile=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},i.prototype.isCardboardCompatible=function(){return this.isMobile()||WebVRConfig.FORCE_ENABLE_VR},t.exports=i},{\"./base.js\":4,\"./cardboard-vr-display.js\":7,\"./display-wrappers.js\":10,\"./mouse-keyboard-vr-display.js\":17,\"es6-promise\":2}]},{},[15])}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],20:[function(e,t){t.exports={name:\"aframe\",version:\"0.2.0\",description:\"Building blocks for the VR Web\",homepage:\"https://aframe.io/\",main:\"dist/aframe.js\",scripts:{browserify:\"browserify src/index.js -s 'AFRAME' -p browserify-derequire\",build:\"mkdirp build/ && npm run browserify -- --debug -o build/aframe.js\",dev:\"npm run build && node ./scripts/budo\",dist:\"mkdirp dist/ && npm run browserify -s -- --debug | exorcist dist/aframe.js.map > dist/aframe.js && uglifyjs dist/aframe.js -c warnings=false -m -o dist/aframe.min.js\",\"gh-pages\":\"npm run ghpages\",ghpages:\"node ./scripts/gh-pages\",lint:\"semistandard -v | snazzy\",precommit:\"npm run lint\",preghpages:\"npm run dist && rimraf gh-pages && mkdirp gh-pages && cp -r {.nojekyll,dist,lib,examples,index.html,style} gh-pages/. 2>/dev/null || : && git checkout dist/ && replace 'build/aframe.js' 'dist/aframe.min.js' gh-pages/ -r --silent\",\"release:bump\":\"npm run dist && git commit -am 'bump dist' && npm version patch --preminor\",\"release:push\":\"npm login && npm publish && git push --follow-tags\",start:\"npm run dev\",test:\"karma start ./tests/karma.conf.js\",\"test:firefox\":\"karma start ./tests/karma.conf.js --browsers firefox_latest\",\"test:chrome\":\"karma start ./tests/karma.conf.js --browsers Chrome\",\"test:ci\":\"TEST_ENV=ci karma start ./tests/karma.conf.js --single-run --browsers firefox_latest\",version:\"npm run dist\"},repository:\"aframevr/aframe\",license:\"MIT\",dependencies:{\"browserify-css\":\"^0.8.2\",debug:\"^2.2.0\",\"deep-assign\":\"^2.0.0\",\"document-register-element\":\"dmarcos/document-register-element#8ccc532b7\",\"promise-polyfill\":\"^3.1.0\",\"object-assign\":\"^4.0.1\",present:\"0.0.6\",\"style-attr\":\"^1.0.2\",three:\"^0.76.1\",\"tween.js\":\"^15.0.0\",\"webvr-polyfill\":\"0.9.15\"},devDependencies:{browserify:\"^11.0.1\",\"browserify-derequire\":\"^0.9.4\",budo:\"^8.1.0\",chai:\"^3.5.0\",\"chai-shallow-deep-equal\":\"^1.3.0\",exorcist:\"^0.4.0\",\"gh-pages\":\"^0.6.0\",husky:\"^0.10.1\",karma:\"^0.13.15\",\"karma-browserify\":\"^4.4.0\",\"karma-chai-shallow-deep-equal\":\"0.0.4\",\"karma-chrome-launcher\":\"^0.2.3\",\"karma-env-preprocessor\":\"^0.1.1\",\"karma-firefox-launcher\":\"^0.1.6\",\"karma-mocha\":\"^0.2.0\",\"karma-mocha-reporter\":\"^1.1.0\",\"karma-sinon-chai\":\"^1.1.0\",lolex:\"^1.4.0\",mkdirp:\"0.5.1\",mocha:\"^2.3.3\",\"mozilla-download\":\"^1.0.5\",open:\"0.0.5\",replace:\"^0.3.0\",rimraf:\"2.5.0\",semistandard:\"^7.0.2\",sinon:\"^1.17.3\",\"sinon-chai\":\"^2.8.0\",snazzy:\"^3.0.0\",uglifyjs:\"^2.4.10\"},link:!0,browserify:{transform:[\"browserify-css\"]},semistandard:{ignore:[\"build/**\",\"dist/**\",\"examples/**/shaders/*.js\",\"**/vendor/**\"]},keywords:[\"aframe\",\"vr\",\"webvr\",\"3d\",\"three\",\"components\",\"elements\"],\"browserify-css\":{minify:!0},engines:{node:\">= 0.12.7\",npm:\"^2.12.1\"}}},{}],21:[function(e,t){var i=e(\"../core/component\").registerComponent,r=e(\"../lib/three\");t.exports.Component=i(\"blend-character-model\",{schema:{type:\"src\"},init:function(){this.model=null},update:function(){var e=this,t=this.el,i=this.data;i&&(this.remove(),this.model=new r.BlendCharacter,this.model.load(i,function(){t.setObject3D(\"mesh\",e.model),t.emit(\"model-loaded\",{format:\"blend\",model:e.model}),e.model.castShadow=!0,e.model.receiveShadow=!0,e.model.material.shading=r.FlatShading,e.model.geometry.computeBoundingBox()}))},remove:function(){this.model&&this.el.removeObject3D(\"mesh\")}})},{\"../core/component\":57,\"../lib/three\":101}],22:[function(e,t){var i=e(\"../core/component\").registerComponent,r=e(\"../lib/three\"),n=e(\"../utils/\"),a=n.checkHeadsetConnected;t.exports.Component=i(\"camera\",{schema:{active:{\"default\":!0},far:{\"default\":1e4},fov:{\"default\":80,min:0},near:{\"default\":.5,min:0},userHeight:{\"default\":0,min:0},zoom:{\"default\":1,min:0}},init:function(){var e=this.camera=new r.PerspectiveCamera,t=this.el.sceneEl;this.el.setObject3D(\"camera\",e),this.bindMethods(),t.addEventListener(\"enter-vr\",this.removeHeightOffset),t.addEventListener(\"enter-vr\",this.saveCameraPose),t.addEventListener(\"exit-vr\",this.restoreCameraPose),t.addEventListener(\"exit-vr\",this.addHeightOffset)},bindMethods:function(){this.addHeightOffset=this.addHeightOffset.bind(this),this.removeHeightOffset=this.removeHeightOffset.bind(this),this.saveCameraPose=this.saveCameraPose.bind(this),this.restoreCameraPose=this.restoreCameraPose.bind(this)},addHeightOffset:function(){var e,t=this.el;this.userHeightOffset||(e=t.getComputedAttribute(\"position\")||{x:0,y:0,z:0},this.userHeightOffset=this.data.userHeight,t.setAttribute(\"position\",{x:e.x,y:e.y+this.userHeightOffset,z:e.z}))},removeHeightOffset:function(){var e,t=this.el,i=this.userHeightOffset,r=this.headsetConnected||a();i&&r&&(this.userHeightOffset=void 0,e=t.getAttribute(\"position\")||{x:0,y:0,z:0},t.setAttribute(\"position\",{x:e.x,y:e.y-i,z:e.z}))},saveCameraPose:function(){var e=this.el,t=this.headsetConnected||a();!this.savedPose&&t&&(this.savedPose={position:e.getAttribute(\"position\"),rotation:e.getAttribute(\"rotation\")})},restoreCameraPose:function(){var e=this.el,t=this.savedPose;t&&(e.setAttribute(\"position\",t.position),e.setAttribute(\"rotation\",t.rotation),this.savedPose=void 0)},remove:function(){var e=this.el.sceneEl;this.el.removeObject3D(\"camera\"),e.removeEventListener(\"enter-vr\",this.removeHeightOffset),e.removeEventListener(\"enter-vr\",this.saveCameraPose),e.removeEventListener(\"exit-vr\",this.restoreCameraPose),e.removeEventListener(\"exit-vr\",this.addHeightOffset)},update:function(e){var t=this.el,i=this.data,r=this.camera,n=this.system;e&&e.userHeight===i.userHeight||(this.removeHeightOffset(),this.addHeightOffset()),r.aspect=i.aspect||window.innerWidth/window.innerHeight,r.far=i.far,r.fov=i.fov,r.near=i.near,r.zoom=i.zoom,r.updateProjectionMatrix(),e&&e.active===i.active||(i.active&&n.activeCameraEl!==this.el?n.setActiveCamera(t):i.active||n.activeCameraEl!==this.el||n.disableActiveCamera())}})},{\"../core/component\":57,\"../lib/three\":101,\"../utils/\":117}],23:[function(e,t){var i=e(\"../core/component\").registerComponent,r=e(\"../lib/three\");t.exports.Component=i(\"collada-model\",{schema:{type:\"src\"},init:function(){this.model=null,this.loader=new r.ColladaLoader,this.loader.options.convertUpAxis=!0},update:function(){var e=this,t=this.el,i=this.data;i&&(this.remove(),this.loader.load(i,function(i){e.model=i.scene,t.setObject3D(\"mesh\",e.model),t.emit(\"model-loaded\",{format:\"collada\",model:e.model})}))},remove:function(){this.model&&this.el.removeObject3D(\"mesh\")}})},{\"../core/component\":57,\"../lib/three\":101}],24:[function(e,t){var i=e(\"../core/component\").registerComponent,r=e(\"../utils/\"),n={CLICK:\"click\",MOUSEENTER:\"mouseenter\",MOUSEDOWN:\"mousedown\",MOUSELEAVE:\"mouseleave\",MOUSEUP:\"mouseup\"},a={FUSING:\"cursor-fusing\",HOVERING:\"cursor-hovering\",HOVERED:\"cursor-hovered\"};t.exports.Component=i(\"cursor\",{dependencies:[\"raycaster\"],schema:{fuse:{\"default\":r.isMobile()},fuseTimeout:{\"default\":1500,min:0}},init:function(){var e=this.el,t=e.sceneEl.canvas;return this.fuseTimeout=void 0,this.mouseDownEl=null,this.intersectedEl=null,t?(t.addEventListener(\"mousedown\",this.onMouseDown.bind(this)),t.addEventListener(\"mouseup\",this.onMouseUp.bind(this)),e.addEventListener(\"raycaster-intersection\",this.onIntersection.bind(this)),e.addEventListener(\"raycaster-intersection-cleared\",this.onIntersectionCleared.bind(this)),void 0):(e.sceneEl.addEventListener(\"render-target-loaded\",this.init.bind(this)),void 0)\n},onMouseDown:function(){this.twoWayEmit(n.MOUSEDOWN),this.mouseDownEl=this.intersectedEl},onMouseUp:function(){this.twoWayEmit(n.MOUSEUP),!this.data.fuse&&this.intersectedEl&&this.mouseDownEl===this.intersectedEl&&this.twoWayEmit(n.CLICK)},onIntersection:function(e){var t=this,i=this.el,r=this.data,o=e.detail.els[0];this.intersectedEl!==o&&(this.intersectedEl=o,i.addState(a.HOVERING),o.addState(a.HOVERED),t.twoWayEmit(n.MOUSEENTER),0!==r.fuseTimeout&&r.fuse&&(i.addState(a.FUSING),this.fuseTimeout=setTimeout(function(){i.removeState(a.FUSING),t.twoWayEmit(n.CLICK)},r.fuseTimeout)))},onIntersectionCleared:function(e){var t=this.el,i=e.detail.el;i&&this.intersectedEl&&(i.removeState(a.HOVERED),t.removeState(a.HOVERING),t.removeState(a.FUSING),this.twoWayEmit(n.MOUSELEAVE),this.intersectedEl=null,clearTimeout(this.fuseTimeout))},twoWayEmit:function(e){var t=this.intersectedEl;this.el.emit(e,{intersectedEl:this.intersectedEl}),t&&t.emit(e,{cursorEl:this.el})}})},{\"../core/component\":57,\"../utils/\":117}],25:[function(e,t){var i=e(\"../utils/debug\"),r=e(\"../core/geometry\").geometries,n=e(\"../core/geometry\").geometryNames,a=e(\"../core/component\").registerComponent,o=e(\"../lib/three\"),s=new o.Geometry,c=i(\"components:geometry:warn\");t.exports.Component=a(\"geometry\",{schema:{buffer:{\"default\":!0},mergeTo:{type:\"selector\"},primitive:{\"default\":\"box\",oneOf:n},skipCache:{\"default\":!1}},init:function(){this.geometry=null},update:function(e){var t=this.data,i=this.el.getOrCreateObject3D(\"mesh\",o.Mesh),r=this.system;this.geometry&&(r.unuseGeometry(e),this.geometry=null),this.geometry=i.geometry=r.getOrCreateGeometry(t),t.mergeTo&&this.mergeTo(t.mergeTo)},mergeTo:function(e){var t,i=this.el,r=i.getObject3D(\"mesh\");return e?e===i?(c(\"Source and target geometries cannot be the same for merge\"),void 0):(t=e.getObject3D(\"mesh\"))?t.geometry instanceof o.Geometry==!1||r.geometry instanceof o.Geometry==!1?(c(\"Geometry merge is only available for `THREE.Geometry` types. Check that both of the merging geometry and the target geometry have `buffer` set to false\"),void 0):this.data.skipCache===!1?(c(\"Cached geometries are not allowed to merge. Set `skipCache` to true\"),void 0):(r.parent.updateMatrixWorld(),t.geometry.merge(r.geometry,r.matrixWorld),i.emit(\"geometry-merged\",{mergeTarget:e}),i.parentNode.removeChild(i),void 0):(t=e.getOrCreateObject3D(\"mesh\",o.Mesh),e.setAttribute(\"material\",i.getComputedAttribute(\"material\")),void 0):(c(\"There is not a valid entity to merge the geometry to\"),void 0)},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D(\"mesh\").geometry=s,this.geometry=null},updateSchema:function(e){var t=e.primitive,i=this.data&&this.data.primitive,n=r[t]&&r[t].schema;if(!n)throw new Error(\"Unknown geometry schema `\"+t+\"`\");i&&i===t||this.extendSchema(n)}})},{\"../core/component\":57,\"../core/geometry\":58,\"../lib/three\":101,\"../utils/debug\":115}],26:[function(e,t){var i=e(\"../core/component\").registerComponent,r=\"https://cdn.aframe.io/controllers/hands/leftHand.json\",n=\"https://cdn.aframe.io/controllers/hands/rightHand.json\";t.exports.Component=i(\"hand-controls\",{schema:{\"default\":\"left\"},init:function(){var e=this;this.onGripDown=function(){e.handleButton(\"grip\",\"down\")},this.onGripUp=function(){e.handleButton(\"grip\",\"up\")},this.onTrackpadDown=function(){e.handleButton(\"trackpad\",\"down\")},this.onTrackpadUp=function(){e.handleButton(\"trackpad\",\"up\")},this.onTriggerDown=function(){e.handleButton(\"trigger\",\"down\")},this.onTriggerUp=function(){e.handleButton(\"trigger\",\"up\")},this.addEventListeners()},play:function(){this.addEventListeners()},stop:function(){this.removeEventListeners()},addEventListeners:function(){var e=this.el;e.addEventListener(\"gripdown\",this.onGripDown),e.addEventListener(\"gripup\",this.onGripUp),e.addEventListener(\"trackpaddown\",this.onTrackpadDown),e.addEventListener(\"trackpadup\",this.onTrackpadUp),e.addEventListener(\"triggerdown\",this.onTriggerDown),e.addEventListener(\"triggerup\",this.onTriggerUp)},removeEventListeners:function(){var e=this.el;e.removeEventListener(\"gripdown\",this.onGripDown),e.removeEventListener(\"gripup\",this.onGripUp),e.removeEventListener(\"trackpaddown\",this.onTrackpadDown),e.removeEventListener(\"trackpadup\",this.onTrackpadUp),e.removeEventListener(\"triggerdown\",this.onTriggerDown),e.removeEventListener(\"triggerup\",this.onTriggerUp)},update:function(){var e,t=this.el,i=this.data;e=\"left\"===i?\"url(\"+r+\")\":\"url(\"+n+\")\",t.setAttribute(\"vive-controls\",{hand:i,model:!1}),t.setAttribute(\"blend-character-model\",e)},handleButton:function(e,t){var i=this.el,r=\"down\"===t;switch(e){case\"trackpad\":if(r===this.trackpadPressed)return;this.trackpadPressed=r,this.playAnimation(\"thumb\",!r),t=r?\"thumbup\":\"thumbdown\",i.emit(t);break;case\"trigger\":if(r===this.triggerPressed)return;this.triggerPressed=r,this.playAnimation(\"pointing\",!r),t=r?\"pointup\":\"pointdown\",i.emit(t);break;case\"grip\":if(r===this.gripPressed)return;this.gripPressed=r,this.playAnimation(\"close\",!r),t=r?\"gripclose\":\"gripopen\",i.emit(t)}},playAnimation:function(e,t){var i=this.animationActive,r=1,n=this.el.getObject3D(\"mesh\");n&&(t&&(r=-1),i&&n.play(i,0),n.mixer.clipAction(e).loop=2200,n.mixer.clipAction(e).clampWhenFinished=!0,n.mixer.clipAction(e).timeScale=r,n.play(e,1),this.animationActive=e)}})},{\"../core/component\":57}],27:[function(e){e(\"./blend-character-model\"),e(\"./camera\"),e(\"./collada-model\"),e(\"./cursor\"),e(\"./geometry\"),e(\"./hand-controls\"),e(\"./light\"),e(\"./look-at\"),e(\"./look-controls\"),e(\"./material\"),e(\"./obj-model\"),e(\"./position\"),e(\"./raycaster\"),e(\"./rotation\"),e(\"./scale\"),e(\"./sound\"),e(\"./tracked-controls\"),e(\"./visible\"),e(\"./vive-controls\"),e(\"./wasd-controls\"),e(\"./scene/canvas\"),e(\"./scene/debug\"),e(\"./scene/embedded\"),e(\"./scene/fog\"),e(\"./scene/keyboard-shortcuts\"),e(\"./scene/stats\"),e(\"./scene/vr-mode-ui\")},{\"./blend-character-model\":21,\"./camera\":22,\"./collada-model\":23,\"./cursor\":24,\"./geometry\":25,\"./hand-controls\":26,\"./light\":28,\"./look-at\":29,\"./look-controls\":30,\"./material\":31,\"./obj-model\":32,\"./position\":33,\"./raycaster\":34,\"./rotation\":35,\"./scale\":36,\"./scene/canvas\":37,\"./scene/debug\":38,\"./scene/embedded\":39,\"./scene/fog\":40,\"./scene/keyboard-shortcuts\":41,\"./scene/stats\":42,\"./scene/vr-mode-ui\":43,\"./sound\":44,\"./tracked-controls\":45,\"./visible\":46,\"./vive-controls\":47,\"./wasd-controls\":48}],28:[function(e,t){function i(e){var t=e.angle,i=new o.Color(e.color).getHex(),r=e.decay,n=e.distance,a=new o.Color(e.groundColor).getHex(),u=e.intensity,l=e.type;switch(l.toLowerCase()){case\"ambient\":return new o.AmbientLight(i,u);case\"directional\":return new o.DirectionalLight(i,u);case\"hemisphere\":return new o.HemisphereLight(i,a,u);case\"point\":return new o.PointLight(i,u,n,r);case\"spot\":return new o.SpotLight(i,u,n,s(t),e.penumbra,r);default:c(\"%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.\",l)}}var r=e(\"../utils\").diff,n=e(\"../utils/debug\"),a=e(\"../core/component\").registerComponent,o=e(\"../lib/three\"),s=o.Math.degToRad,c=n(\"components:light:warn\");t.exports.Component=a(\"light\",{schema:{angle:{\"default\":60,\"if\":{type:[\"spot\"]}},color:{type:\"color\"},groundColor:{type:\"color\",\"if\":{type:[\"hemisphere\"]}},decay:{\"default\":1,\"if\":{type:[\"point\",\"spot\"]}},distance:{\"default\":0,min:0,\"if\":{type:[\"point\",\"spot\"]}},intensity:{\"default\":1,min:0,\"if\":{type:[\"ambient\",\"directional\",\"hemisphere\",\"point\",\"spot\"]}},penumbra:{\"default\":0,min:0,max:1,\"if\":{type:[\"spot\"]}},type:{\"default\":\"directional\",oneOf:[\"ambient\",\"directional\",\"hemisphere\",\"point\",\"spot\"]}},init:function(){var e=this.el;this.light=null,this.system.registerLight(e)},update:function(e){var t=this.data,i=r(t,e),n=this.light;return!n||\"type\"in i?(this.setLight(this.data),void 0):(Object.keys(i).forEach(function(e){var i=t[e];-1!==[\"color\",\"groundColor\"].indexOf(e)&&(i=new o.Color(i)),n[e]=i}),void 0)},setLight:function(e){var t=this.el,r=i(e);r&&(this.light&&t.removeObject3D(\"light\"),this.light=r,this.light.el=t,t.setObject3D(\"light\",this.light))},remove:function(){this.el.removeObject3D(\"light\")}})},{\"../core/component\":57,\"../lib/three\":101,\"../utils\":117,\"../utils/debug\":115}],29:[function(e,t){var i=e(\"../utils/debug\"),r=e(\"../utils/coordinates\"),n=e(\"../core/component\").registerComponent,a=e(\"../lib/three\"),o=i(\"components:look-at:warn\"),s=r.isCoordinate;t.exports.Component=n(\"look-at\",{schema:{\"default\":\"\",parse:function(e){return s(e)||\"object\"==typeof e?r.parse(e):e},stringify:function(e){return\"object\"==typeof e?r.stringify(e):e}},init:function(){this.target3D=null,this.vector=new a.Vector3,o(\"The `look-at` component is deprecated - use https://github.com/ngokevin/aframe-look-at-component instead.\")},update:function(){var e,t=this,i=t.data,r=t.el.object3D;return!i||\"object\"==typeof i&&!Object.keys(i).length?t.remove():\"object\"==typeof i?r.lookAt(new a.Vector3(i.x,i.y,i.z)):(e=t.el.sceneEl.querySelector(i),e?e.hasLoaded?t.beginTracking(e):e.addEventListener(\"loaded\",function(){t.beginTracking(e)}):(o('\"'+i+'\" does not point to a valid entity to look-at'),void 0))},tick:function(){var e=this.target3D;return e?this.el.object3D.lookAt(this.vector.setFromMatrixPosition(e.matrixWorld)):void 0},beginTracking:function(e){this.target3D=e.object3D}})},{\"../core/component\":57,\"../lib/three\":101,\"../utils/coordinates\":114,\"../utils/debug\":115}],30:[function(e,t){function i(e){return 0===e.x&&0===e.y&&0===e.z}var r=e(\"../core/component\").registerComponent,n=e(\"../lib/three\"),a=e(\"../utils/\").isMobile(),o=Math.PI/2,s=n.Math.radToDeg;t.exports.Component=r(\"look-controls\",{dependencies:[\"position\",\"rotation\"],schema:{enabled:{\"default\":!0},hmdEnabled:{\"default\":!0},standing:{\"default\":!0}},init:function(){function e(){t.canvas.classList.add(\"a-grab-cursor\")}var t=this.el.sceneEl;this.previousHMDPosition=new n.Vector3,this.setupMouseControls(),this.setupHMDControls(),this.bindMethods(),t.canvas?e():t.addEventListener(\"render-target-loaded\",e)},update:function(e){var t=this.data,i=t.hmdEnabled;t.enabled&&(!i&&e&&i!==e.hmdEnabled&&(this.pitchObject.rotation.set(0,0,0),this.yawObject.rotation.set(0,0,0)),this.controls.standing=t.standing,this.controls.update(),this.updateOrientation(),this.updatePosition())},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(){this.update()},remove:function(){this.pause()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.releaseMouse=this.releaseMouse.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new n.Object3D,this.yawObject=new n.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},setupHMDControls:function(){this.dolly=new n.Object3D,this.euler=new n.Euler,this.controls=new n.VRControls(this.dolly),this.controls.userHeight=0},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;return t?(t.addEventListener(\"mousedown\",this.onMouseDown,!1),window.addEventListener(\"mousemove\",this.onMouseMove,!1),window.addEventListener(\"mouseup\",this.releaseMouse,!1),t.addEventListener(\"touchstart\",this.onTouchStart),window.addEventListener(\"touchmove\",this.onTouchMove),window.addEventListener(\"touchend\",this.onTouchEnd),void 0):(e.addEventListener(\"render-target-loaded\",this.addEventListeners.bind(this)),void 0)},removeEventListeners:function(){var e=this.el.sceneEl,t=e&&e.canvas;t&&(t.removeEventListener(\"mousedown\",this.onMouseDown),t.removeEventListener(\"mousemove\",this.onMouseMove),t.removeEventListener(\"mouseup\",this.releaseMouse),t.removeEventListener(\"mouseout\",this.releaseMouse),t.removeEventListener(\"touchstart\",this.onTouchStart),t.removeEventListener(\"touchmove\",this.onTouchMove),t.removeEventListener(\"touchend\",this.onTouchEnd))},updateOrientation:function(){var e=new n.Euler;return function(){var t,r,n,o=this.pitchObject,c=this.yawObject,u=this.calculateHMDQuaternion(),l=this.el.sceneEl;e.setFromQuaternion(u,\"YXZ\"),a?n={x:s(e.x)+s(o.rotation.x),y:s(e.y)+s(c.rotation.y),z:s(e.z)}:l.is(\"vr-mode\")&&!i(e)&&this.data.hmdEnabled?n={x:s(e.x),y:s(e.y),z:s(e.z)}:(t=this.el.getComputedAttribute(\"rotation\"),r=this.calculateDeltaRotation(),n={x:t.x+r.x,y:t.y+r.y,z:t.z}),this.el.setAttribute(\"rotation\",n)}}(),calculateDeltaRotation:function(){var e,t;return function(){var i,r=s(this.pitchObject.rotation.x),n=s(this.yawObject.rotation.y);return e=e||r,t=t||n,i={x:r-e,y:n-t},e=r,t=n,i}}(),calculateHMDQuaternion:function(){var e=new n.Quaternion;return function(){return e.copy(this.dolly.quaternion),e}}(),updatePosition:function(){var e=new n.Vector3;return function(){var t,r=this.el,n=r.getComputedAttribute(\"position\"),a=this.previousHMDPosition,o=this.el.sceneEl;t=this.calculateHMDPosition(),e.copy(t).sub(a),o.is(\"vr-mode\")&&!i(e)&&(a.copy(t),o.is(\"vr-mode\")&&r.setAttribute(\"position\",{x:n.x+e.x,y:n.y+e.y,z:n.z+e.z}))}}(),calculateHMDPosition:function(){var e=this.dolly,t=new n.Vector3;return e.updateMatrix(),t.setFromMatrixPosition(e.matrix),t},onMouseMove:function(e){var t=this.pitchObject,i=this.yawObject,r=this.previousMouseEvent;if(this.mouseDown&&this.data.enabled){var n=e.movementX||e.mozMovementX,a=e.movementY||e.mozMovementY;(void 0===n||void 0===a)&&(n=e.screenX-r.screenX,a=e.screenY-r.screenY),this.previousMouseEvent=e,i.rotation.y-=.002*n,t.rotation.x-=.002*a,t.rotation.x=Math.max(-o,Math.min(o,t.rotation.x))}},onMouseDown:function(e){this.mouseDown=!0,this.previousMouseEvent=e,document.body.classList.add(\"a-grabbing\"),e.preventDefault()},releaseMouse:function(){this.mouseDown=!1,document.body.classList.remove(\"a-grabbing\")},onTouchStart:function(e){1===e.touches.length&&(this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(e){var t,i=this.yawObject;this.touchStarted&&(t=2*Math.PI*(e.touches[0].pageX-this.touchStart.x)/this.el.sceneEl.canvas.clientWidth,i.rotation.y-=.5*t,this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1}})},{\"../core/component\":57,\"../lib/three\":101,\"../utils/\":117}],31:[function(e,t){function i(e){switch(e){case\"back\":return o.BackSide;case\"double\":return o.DoubleSide;default:return o.FrontSide}}function r(e,t){e.dispose(),t.unregisterMaterial(e)}var n=e(\"../utils/\"),a=e(\"../core/component\"),o=e(\"../lib/three\"),s=e(\"../core/shader\"),c=n.debug(\"components:material:error\"),u=a.registerComponent,l=s.shaders,h=s.shaderNames;t.exports.Component=u(\"material\",{schema:{depthTest:{\"default\":!0},flatShading:{\"default\":!1},opacity:{\"default\":1,min:0,max:1},shader:{\"default\":\"standard\",oneOf:h},side:{\"default\":\"front\",oneOf:[\"front\",\"back\",\"double\"]},transparent:{\"default\":!1},visible:{\"default\":!0}},init:function(){this.material=null},update:function(e){var t=this.data;this.shader&&t.shader===e.shader||this.updateShader(t.shader),this.shader.update(this.data),this.updateMaterial()},updateSchema:function(e){var t=e.shader,i=this.data&&this.data.shader,r=t||i,n=l[r]&&l[r].schema;n||c(\"Unknown shader schema \"+r),i&&t===i||(this.extendSchema(n),this.updateBehavior())},updateBehavior:function(){var e=this.el.sceneEl,t=this.schema,i=this,r={},n=function(e){function t(t){r[t]=e}var n=Object.keys(r);n.forEach(t),i.shader.update(r)},a=Object.keys(t);a.forEach(function(a){\"time\"===t[a].type&&(i.tick=n,r[a]=!0,e.addBehavior(i))}),0===Object.keys(r).length&&e.removeBehavior(this)},updateShader:function(e){var t,i=this.data,r=l[e]&&l[e].Shader;if(!r)throw new Error(\"Unknown shader \"+e);t=this.shader=new r,t.el=this.el,t.init(i),this.setMaterial(t.material),this.updateSchema(i)},updateMaterial:function(){var e=this.data,t=this.material;t.side=i(e.side),t.opacity=e.opacity,t.transparent=e.transparent!==!1||e.opacity<1,t.depthTest=e.depthTest!==!1,t.shading=e.flatShading?o.FlatShading:o.SmoothShading,t.visible=e.visible},remove:function(){var e=new o.MeshBasicMaterial,t=this.material,i=this.el.getObject3D(\"mesh\");i&&(i.material=e),r(t,this.system)},setMaterial:function(e){var t=this.el.getOrCreateObject3D(\"mesh\",o.Mesh),i=this.system;this.material&&r(this.material,i),this.material=t.material=e,i.registerMaterial(e)}})},{\"../core/component\":57,\"../core/shader\":65,\"../lib/three\":101,\"../utils/\":117}],32:[function(e,t){var i=e(\"../utils/debug\"),r=e(\"../core/component\").registerComponent,n=e(\"../lib/three\"),a=i(\"components:obj-model:warn\");t.exports.Component=r(\"obj-model\",{dependencies:[\"material\"],schema:{mtl:{type:\"src\"},obj:{type:\"src\"}},init:function(){this.model=null,this.objLoader=new n.OBJLoader,this.mtlLoader=new n.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin=\"\"},update:function(){var e=this.data;e.obj&&(this.remove(),this.loadObj(e.obj,e.mtl))},remove:function(){this.model&&this.el.removeObject3D(\"mesh\")},loadObj:function(e,t){var i=this,r=this.el,o=this.mtlLoader,s=this.objLoader;return t?(r.hasAttribute(\"material\")&&a(\"Material component properties are ignored when a .MTL is provided\"),o.setBaseUrl(t.substr(0,t.lastIndexOf(\"/\")+1)),o.load(t,function(t){t.preload(),s.setMaterials(t),s.load(e,function(e){i.model=e,r.setObject3D(\"mesh\",e),r.emit(\"model-loaded\",{format:\"obj\",model:e})})}),void 0):(s.load(e,function(e){var t=r.components.material;t&&e.traverse(function(e){e instanceof n.Mesh&&(e.material=t.material)}),i.model=e,r.setObject3D(\"mesh\",e),r.emit(\"model-loaded\",{format:\"obj\",model:e})}),void 0)}})},{\"../core/component\":57,\"../lib/three\":101,\"../utils/debug\":115}],33:[function(e,t){var i=e(\"../core/component\").registerComponent;t.exports.Component=i(\"position\",{schema:{type:\"vec3\"},update:function(){var e=this.el.object3D,t=this.data;e.position.set(t.x,t.y,t.z)}})},{\"../core/component\":57}],34:[function(e,t){var i=e(\"../core/component\").registerComponent,r=e(\"../lib/three\"),n=new r.Vector3;t.exports.Component=i(\"raycaster\",{schema:{far:{\"default\":1/0},interval:{\"default\":100},near:{\"default\":0},objects:{\"default\":\"\"},recursive:{\"default\":!0}},init:function(){this.direction=new r.Vector3,this.intersectedEls=[],this.objects=null,this.prevCheckTime=void 0,this.raycaster=new r.Raycaster,this.updateOriginDirection()},update:function(){var e=this.data,t=this.raycaster;t.far=e.far,t.near=e.near,this.refreshObjects()},refreshObjects:function(){var e,t,i=this.data;if(i.objects)for(t=this.el.sceneEl.querySelectorAll(i.objects),this.objects=[],e=0;e<t.length;e++)this.objects.push(t[e].object3D);else this.objects=this.el.sceneEl.object3D.children},tick:function(e){var t,i,r,n=this.el,a=this.data,o=this.prevCheckTime;o&&e-o<a.interval||(r=this.intersectedEls.slice(),this.updateOriginDirection(),i=this.raycaster.intersectObjects(this.objects,a.recursive),i=i.filter(function(e){return!!e.object.el}),t=this.intersectedEls=i.map(function(e){return e.object.el}),i.forEach(function(e){var t=e.object.el;t.emit(\"raycaster-intersected\",{el:n,intersection:e})}),i.length&&n.emit(\"raycaster-intersection\",{els:t,intersections:i}),r.forEach(function(e){-1===t.indexOf(e)&&(n.emit(\"raycaster-intersection-cleared\",{el:e}),e.emit(\"raycaster-intersected-cleared\",{el:n}))}))},updateOriginDirection:function(){var e=new r.Quaternion,t=new r.Vector3;return function(){var i=this.el,r=i.object3D;r.updateMatrixWorld(),r.matrixWorld.decompose(t,e,n),this.direction.set(0,0,-1),this.direction.applyQuaternion(e),this.raycaster.set(t,this.direction)}}()})},{\"../core/component\":57,\"../lib/three\":101}],35:[function(e,t){var i=e(\"../lib/three\").Math.degToRad,r=e(\"../core/component\").registerComponent;t.exports.Component=r(\"rotation\",{schema:{type:\"vec3\"},update:function(){var e=this.data,t=this.el.object3D;t.rotation.set(i(e.x),i(e.y),i(e.z)),t.rotation.order=\"YXZ\"}})},{\"../core/component\":57,\"../lib/three\":101}],36:[function(e,t){var i=e(\"../core/component\").registerComponent,r=1e-5;t.exports.Component=i(\"scale\",{schema:{type:\"vec3\",\"default\":{x:1,y:1,z:1}},update:function(){var e=this.data,t=this.el.object3D,i=0===e.x?r:e.x,n=0===e.y?r:e.y,a=0===e.z?r:e.z;t.scale.set(i,n,a)}})},{\"../core/component\":57}],37:[function(e,t){var i=e(\"../../core/component\").registerComponent;t.exports.Component=i(\"canvas\",{init:function(){function e(){n.classList.add(\"fullscreen\")}function t(){n.classList.remove(\"fullscreen\")}function i(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;e||r.exitVR(),document.activeElement.blur(),document.body.focus(),setTimeout(r.resize.bind(r),0)}var r=this.el,n=document.createElement(\"canvas\");n.classList.add(\"a-canvas\"),n.dataset.aframeCanvas=!0,r.appendChild(n),document.addEventListener(\"fullscreenchange\",i),document.addEventListener(\"mozfullscreenchange\",i),document.addEventListener(\"webkitfullscreenchange\",i),n.addEventListener(\"touchmove\",function(e){e.preventDefault()}),r.addEventListener(\"enter-vr\",e),r.addEventListener(\"exit-vr\",t),r.canvas=n,r.emit(\"render-target-loaded\",{target:n})}})},{\"../../core/component\":57}],38:[function(e,t){var i=e(\"../../core/component\").registerComponent;t.exports.Component=i(\"debug\",{schema:{\"default\":!0}})},{\"../../core/component\":57}],39:[function(e,t){var i=e(\"../../core/component\").registerComponent;t.exports.Component=i(\"embedded\",{dependencies:[\"vr-mode-ui\"],schema:{\"default\":!0},update:function(){var e=this.el,t=e.querySelector(\".a-enter-vr\");this.data===!0?(t.classList.add(\"embedded\"),e.removeFullScreenStyles()):(t.classList.remove(\"embedded\"),e.addFullScreenStyles())}})},{\"../../core/component\":57}],40:[function(e,t){function i(e){var t;return t=\"exponential\"===e.type?new n.FogExp2(e.color,e.density):new n.Fog(e.color,e.near,e.far),t.name=e.type,t}var r=e(\"../../core/component\").registerComponent,n=e(\"../../lib/three\"),a=e(\"../../utils/debug\"),o=a(\"components:fog:warn\");t.exports.Component=r(\"fog\",{schema:{color:{\"default\":\"#000\"},density:{\"default\":25e-5},far:{\"default\":1e3,min:0},near:{\"default\":1,min:0},type:{\"default\":\"linear\",oneOf:[\"linear\",\"exponential\"]}},update:function(){var e=this.data,t=this.el,r=this.el.object3D.fog;return t.isScene?r&&e.type===r.name?(Object.keys(this.schema).forEach(function(t){var i=e[t];\"color\"===t&&(i=new n.Color(i)),r[t]=i}),void 0):(t.object3D.fog=i(e),t.systems.material.updateMaterials(),void 0):(o(\"Fog component can only be applied to <a-scene>\"),void 0)},remove:function(){var e=this.el.object3D.fog;e&&(e.density=0,e.far=0,e.near=0)}})},{\"../../core/component\":57,\"../../lib/three\":101,\"../../utils/debug\":115}],41:[function(e,t){var i=e(\"../../core/component\").registerComponent,r=e(\"../../utils/\").shouldCaptureKeyEvent,n=e(\"../../lib/three\"),a=new n.VRControls(new n.Object3D);t.exports.Component=i(\"keyboard-shortcuts\",{schema:{enterVR:{\"default\":!0},exitVR:{\"default\":!0},resetSensor:{\"default\":!0}},init:function(){var e=this,t=this.el;this.listener=window.addEventListener(\"keyup\",function(i){r(i)&&(e.enterVREnabled&&70===i.keyCode&&t.enterVR(),e.enterVREnabled&&27===i.keyCode&&t.exitVR(),e.resetSensorEnabled&&90===i.keyCode&&a.resetSensor())},!1)},update:function(){var e=this.data;this.enterVREnabled=e.enterVR,this.resetSensorEnabled=e.resetSensor},remove:function(){window.removeEventListener(\"keyup\",this.listener)}})},{\"../../core/component\":57,\"../../lib/three\":101,\"../../utils/\":117}],42:[function(e,t){function i(e){var t=new o(e.renderer),i=new s(e),r=e.isMobile?[]:[t,i];return new n({css:[],values:{fps:{caption:\"fps\",below:30}},groups:[{caption:\"Framerate\",values:[\"fps\",\"raf\"]}],plugins:r})}var r=e(\"../../core/component\").registerComponent,n=e(\"../../../vendor/rStats\");e(\"../../../vendor/rStats.extras\"),e(\"../../lib/rStatsAframe\");var a=\"a-hidden\",o=window.threeStats,s=window.aframeStats;t.exports.Component=r(\"stats\",{schema:{\"default\":!0},init:function(){var e=this.el;this.stats=i(e),this.statsEl=document.querySelector(\".rs-base\"),this.hideBound=this.hide.bind(this),this.showBound=this.show.bind(this),e.addEventListener(\"enter-vr\",this.hideBound),e.addEventListener(\"exit-vr\",this.showBound)},update:function(){return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener(\"enter-vr\",this.hideBound),this.el.removeEventListener(\"exit-vr\",this.showBound),this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var e=this.stats;e(\"rAF\").tick(),e(\"FPS\").frame(),e().update()},hide:function(){this.statsEl.classList.add(a)},show:function(){this.statsEl.classList.remove(a)}})},{\"../../../vendor/rStats\":124,\"../../../vendor/rStats.extras\":123,\"../../core/component\":57,\"../../lib/rStatsAframe\":100}],43:[function(e,t){function i(e){var t,i,r=window.hasNativeWebVRImplementation&&l();return i=document.createElement(\"div\"),i.classList.add(o),t=document.createElement(\"button\"),t.classList.add(s),h||r||t.classList.add(\"fullscreen\"),i.appendChild(t),t.addEventListener(\"click\",e),i}function r(e){var t=document.createElement(\"div\");t.className=u,t.classList.add(c);var i=document.createElement(\"button\");return i.innerHTML=\"Exit VR\",i.addEventListener(\"click\",e),t.appendChild(i),t}var n=e(\"../../core/component\").registerComponent,a=e(\"../../utils/\"),o=\"a-enter-vr\",s=\"a-enter-vr-button\",c=\"a-hidden\",u=\"a-orientation-modal\",l=a.checkHeadsetConnected,h=a.isMobile();t.exports.Component=n(\"vr-mode-ui\",{dependencies:[\"canvas\"],schema:{enabled:{\"default\":!0}},init:function(){var e=this,t=this.el;\"false\"!==a.getUrlParameter(\"ui\")&&(this.enterVR=t.enterVR.bind(t),this.exitVR=t.exitVR.bind(t),this.insideLoader=!1,this.enterVREl=null,this.orientationModalEl=null,t.addEventListener(\"enter-vr\",this.updateEnterVRInterface.bind(this)),t.addEventListener(\"exit-vr\",this.updateEnterVRInterface.bind(this)),window.addEventListener(\"message\",function(t){\"loaderReady\"===t.data.type&&(e.insideLoader=!0,e.remove())}),window.addEventListener(\"orientationchange\",this.toggleOrientationModalIfNeeded.bind(this)))},update:function(){var e=this.el;return!this.data.enabled||this.insideLoader||\"false\"===a.getUrlParameter(\"ui\")?this.remove():(this.enterVREl||this.orientationModalEl||(this.enterVREl=i(this.enterVR),e.appendChild(this.enterVREl),this.orientationModalEl=r(this.exitVR),e.appendChild(this.orientationModalEl),this.updateEnterVRInterface()),void 0)},remove:function(){[this.enterVREl,this.orientationModalEl].forEach(function(e){e&&e.parentNode.removeChild(e)})},updateEnterVRInterface:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var e=this.el;this.enterVREl&&(e.is(\"vr-mode\")?this.enterVREl.classList.add(c):this.enterVREl.classList.remove(c))},toggleOrientationModalIfNeeded:function(){var e=this.el,t=this.orientationModalEl;t&&e.isMobile&&(!a.isLandscape()&&e.is(\"vr-mode\")?t.classList.remove(c):t.classList.add(c))}})},{\"../../core/component\":57,\"../../utils/\":117}],44:[function(e,t){var i=e(\"../utils/debug\"),r=e(\"../core/component\").registerComponent,n=e(\"../lib/three\"),a=i(\"components:sound:warn\");t.exports.Component=r(\"sound\",{schema:{src:{type:\"src\"},on:{\"default\":\"\"},autoplay:{\"default\":!1},loop:{\"default\":!1},volume:{\"default\":1}},multiple:!0,init:function(){this.listener=null,this.audioLoader=new n.AudioLoader,this.sound=null,this.playSound=this.playSound.bind(this)},update:function(e){var t=this.data,i=this.sound,r=t.src!==e.src;if(r){if(!t.src)return a(\"Audio source was not specified with `src`\"),void 0;i=this.setupSound()}i.autoplay=t.autoplay,i.setLoop(t.loop),i.setVolume(t.volume),t.on!==e.on&&this.updateEventListener(e.on),r&&this.audioLoader.load(t.src,function(e){i.setBuffer(e),n.Cache.remove(t.src)})},updateEventListener:function(e){var t=this.el;e&&t.removeEventListener(e,this.playSound),t.addEventListener(this.data.on,this.playSound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSound)},remove:function(){this.removeEventListener(),this.el.removeObject3D(this.attrName);try{this.sound.disconnect()}catch(e){a(\"Audio source not properly disconnected\")}},play:function(){this.sound&&(this.sound.source.buffer&&this.data.autoplay&&this.sound.play(),this.updateEventListener())},pause:function(){this.sound&&(this.sound.source.buffer&&this.sound.isPlaying&&this.sound.pause(),this.removeEventListener())},setupSound:function(){var e=this.el,t=e.sceneEl,i=this.sound;i&&(this.stopSound(),e.removeObject3D(\"sound\"));var r=this.listener=t.audioListener||new n.AudioListener;return t.audioListener=r,t.camera&&t.camera.add(r),t.addEventListener(\"camera-set-active\",function(e){e.detail.cameraEl.getObject3D(\"camera\").add(r)}),i=this.sound=new n.PositionalAudio(r),e.setObject3D(this.attrName,i),i.source.onended=function(){i.onEnded(),e.emit(\"sound-ended\")},i},playSound:function(){this.sound.source.buffer&&this.sound.play()},stopSound:function(){this.sound.source.buffer&&this.sound.stop()}})},{\"../core/component\":57,\"../lib/three\":101,\"../utils/debug\":115}],45:[function(e,t){var i=e(\"../core/component\").registerComponent,r=e(\"../lib/three\");t.exports.Component=i(\"tracked-controls\",{schema:{controller:{\"default\":0},id:{\"default\":\"OpenVR Gamepad\"}},init:function(){this.buttonStates={},this.axisState=[]},update:function(){function e(e){return e.id===i.id}var t=this.system.controllers,i=this.data;t=t.filter(e),this.controller=t[i.controller]},tick:function(e,t){var i=this.el.getObject3D(\"mesh\");i&&(i.update&&i.update(t/1e3),this.updatePose(),this.updateButtons())},updatePose:function(){var e=new r.Euler,t=new r.Vector3,i=new r.Quaternion,n=new r.Object3D,a=new r.Matrix4;return e.order=\"YXZ\",function(){var o,s,c,u,l=this.el,h=this.system.vrDisplay;this.update(),o=this.controller,o&&(s=o.pose,c=s.orientation||[0,0,0,1],u=s.position||[0,0,0],i.fromArray(c),n.quaternion.fromArray(c),n.position.fromArray(u),n.updateMatrix(),h&&h.stageParameters&&(a.fromArray(h.stageParameters.sittingToStandingTransform),n.applyMatrix(a)),e.setFromRotationMatrix(n.matrix),t.setFromMatrixPosition(n.matrix),l.setAttribute(\"rotation\",{x:r.Math.radToDeg(e.x),y:r.Math.radToDeg(e.y),z:r.Math.radToDeg(e.z)}),l.setAttribute(\"position\",{x:t.x,y:t.y,z:t.z}))}}(),updateButtons:function(){var e,t,i=this.controller;if(this.controller){for(e=0;e<i.buttons.length;++e)t=i.buttons[e],this.handleButton(e,t);this.handleAxes(i.axes)}},handleAxes:function(e){var t,i=this.axisState,r=!1;for(t=0;t<e.length;++t)if(i[t]!==e[t]){r=!0;break}r&&(i=e.slice(),this.el.emit(\"axismove\",{axis:i}))},handleButton:function(e,t){var i=!1;i=i||this.handlePress(e,t),i=i||this.handleTouch(e,t),i=i||this.handleValue(e,t),i&&this.el.emit(\"buttonchanged\",{id:e,state:t})},handlePress:function(e,t){var i,r=this.buttonStates,n=r[e]=r[e]||{};t.pressed!==n.pressed&&(i=t.pressed?\"down\":\"up\",this.el.emit(\"button\"+i,{id:e}),n.pressed=t.pressed)},handleTouch:function(e,t){var i,r=this.buttonStates,n=r[e]=r[e]||{};return t.touched===n.touched?!1:(i=t.touched?\"start\":\"end\",n.touched=t.touched,this.el.emit(\"touch\"+i,{id:e,state:n}),!0)},handleValue:function(e,t){var i=this.buttonStates,r=i[e]=i[e]||{};return t.value===r.value?!1:(r.value=t.value,!0)}})},{\"../core/component\":57,\"../lib/three\":101}],46:[function(e,t){var i=e(\"../core/component\").registerComponent;t.exports.Component=i(\"visible\",{schema:{\"default\":!0},update:function(){this.el.object3D.visible=this.data}})},{\"../core/component\":57}],47:[function(e,t){var i=e(\"../core/component\").registerComponent,r=\"https://cdn.aframe.io/controllers/vive/vr_controller_vive.obj\",n=\"https://cdn.aframe.io/controllers/vive/vr_controller_vive.mtl\";t.exports.Component=i(\"vive-controls\",{dependencies:[\"tracked-controls\"],schema:{hand:{\"default\":\"left\"},buttonColor:{\"default\":\"#FAFAFA\"},buttonHighlightColor:{\"default\":\"#22D1EE\"},model:{\"default\":!0}},mapping:{axis0:\"trackpad\",axis1:\"trackpad\",button0:\"trackpad\",button1:\"trigger\",button2:\"grip\",button3:\"menu\",button4:\"system\"},init:function(){var e=this;this.animationActive=\"pointing\",this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){e.onButtonEvent(t.detail.id,\"down\")\n},this.onButtonUp=function(t){e.onButtonEvent(t.detail.id,\"up\")},this.onModelLoaded=this.onModelLoaded.bind(this)},play:function(){var e=this.el;e.addEventListener(\"buttonchanged\",this.onButtonChanged),e.addEventListener(\"buttondown\",this.onButtonDown),e.addEventListener(\"buttonup\",this.onButtonUp),e.addEventListener(\"model-loaded\",this.onModelLoaded)},pause:function(){var e=this.el;e.removeEventListener(\"buttonchanged\",this.onButtonChanged),e.removeEventListener(\"buttondown\",this.onButtonDown),e.removeEventListener(\"buttonup\",this.onButtonUp),e.removeEventListener(\"model-loaded\",this.onModelLoaded)},update:function(){var e=this.el,t=this.data,i=\"url(\"+r+\")\",a=\"url(\"+n+\")\",o=\"right\"===t.hand?0:1;e.setAttribute(\"tracked-controls\",\"controller\",o),t.model&&e.setAttribute(\"obj-model\",{obj:i,mtl:a})},onButtonChanged:function(e){var t,i=this.mapping[\"button\"+e.detail.id],r=this.buttonMeshes;\"trigger\"===i&&r&&(t=e.detail.state.value,r.trigger.rotation.x=-t*(Math.PI/12))},onModelLoaded:function(e){var t,i=e.detail.model;this.data.model&&(t=this.buttonMeshes={},t.grip={left:i.getObjectByName(\"leftgrip\"),right:i.getObjectByName(\"rightgrip\")},t.menu=i.getObjectByName(\"menubutton\"),t.system=i.getObjectByName(\"systembutton\"),t.trackpad=i.getObjectByName(\"touchpad\"),t.trigger=i.getObjectByName(\"trigger\"),i.position.set(0,-.015,.04))},onButtonEvent:function(e,t){var i=this.mapping[\"button\"+e];this.el.emit(i+t),this.data.model&&this.updateModel(i,t)},updateModel:function(e,t){var i=\"up\"===t?this.data.buttonColor:this.data.buttonHighlightColor,r=this.buttonMeshes;return r?\"grip\"===e?(r.grip.left.material.color.set(i),r.grip.right.material.color.set(i),void 0):(r[e].material.color.set(i),void 0):void 0}})},{\"../core/component\":57}],48:[function(e,t){var i=e(\"../core/component\").registerComponent,r=e(\"../utils/\").shouldCaptureKeyEvent,n=e(\"../lib/three\"),a=.2;t.exports.Component=i(\"wasd-controls\",{schema:{easing:{\"default\":20},acceleration:{\"default\":65},enabled:{\"default\":!0},fly:{\"default\":!1},wsAxis:{\"default\":\"z\",oneOf:[\"x\",\"y\",\"z\"]},adAxis:{\"default\":\"x\",oneOf:[\"x\",\"y\",\"z\"]},wsInverted:{\"default\":!1},wsEnabled:{\"default\":!0},adInverted:{\"default\":!1},adEnabled:{\"default\":!0}},init:function(){this.velocity=new n.Vector3,this.keys={},this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.attachVisibilityEventListeners()},update:function(e){var t,i=this.data,r=i.acceleration,n=i.easing,o=this.velocity,s=this.prevTime=this.prevTime||Date.now(),c=window.performance.now(),u=(c-s)/1e3,l=this.keys,h=i.adAxis,d=i.wsAxis,p=i.adInverted?-1:1,f=i.wsInverted?-1:1,m=this.el;if(this.prevTime=c,e||u>a)return o[h]=0,o[d]=0,void 0;o[h]-=o[h]*n*u,o[d]-=o[d]*n*u;var g=m.getComputedAttribute(\"position\");i.enabled&&(i.adEnabled&&(l[65]&&(o[h]-=p*r*u),l[68]&&(o[h]+=p*r*u)),i.wsEnabled&&(l[87]&&(o[d]-=f*r*u),l[83]&&(o[d]+=f*r*u))),t=this.getMovementVector(u),m.object3D.translateX(t.x),m.object3D.translateY(t.y),m.object3D.translateZ(t.z),m.setAttribute(\"position\",{x:g.x+t.x,y:g.y+t.y,z:g.z+t.z})},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},tick:function(){this.update()},remove:function(){this.pause(),this.removeVisibilityEventListeners()},attachVisibilityEventListeners:function(){window.addEventListener(\"blur\",this.onBlur),window.addEventListener(\"focus\",this.onFocus),document.addEventListener(\"visibilitychange\",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener(\"blur\",this.onBlur),window.removeEventListener(\"focus\",this.onFocus),document.removeEventListener(\"visibilitychange\",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener(\"keydown\",this.onKeyDown),window.addEventListener(\"keyup\",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener(\"keydown\",this.onKeyDown),window.removeEventListener(\"keyup\",this.onKeyUp)},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(e){r(e)&&(this.keys[e.keyCode]=!0)},onKeyUp:function(e){r(e)&&(this.keys[e.keyCode]=!1)},getMovementVector:function(){var e=new n.Vector3(0,0,0),t=new n.Euler(0,0,0,\"YXZ\");return function(i){var r=this.velocity,a=this.el.getComputedAttribute(\"rotation\");return e.copy(r),e.multiplyScalar(i),a?(this.data.fly||(a.x=0),t.set(n.Math.degToRad(a.x),n.Math.degToRad(a.y),0),e.applyEuler(t),e):e}}()})},{\"../core/component\":57,\"../lib/three\":101,\"../utils/\":117}],49:[function(e,t){var i=e(\"tween.js\"),r={alternate:\"alternate\",alternateReverse:\"alternate-reverse\",normal:\"normal\",reverse:\"reverse\"},n={linear:i.Easing.Linear.None,ease:i.Easing.Cubic.InOut,\"ease-in\":i.Easing.Cubic.In,\"ease-out\":i.Easing.Cubic.Out,\"ease-in-out\":i.Easing.Cubic.InOut,\"ease-cubic\":i.Easing.Cubic.In,\"ease-in-cubic\":i.Easing.Cubic.In,\"ease-out-cubic\":i.Easing.Cubic.Out,\"ease-in-out-cubic\":i.Easing.Cubic.InOut,\"ease-quad\":i.Easing.Quadratic.InOut,\"ease-in-quad\":i.Easing.Quadratic.In,\"ease-out-quad\":i.Easing.Quadratic.Out,\"ease-in-out-quad\":i.Easing.Quadratic.InOut,\"ease-quart\":i.Easing.Quartic.InOut,\"ease-in-quart\":i.Easing.Quartic.In,\"ease-out-quart\":i.Easing.Quartic.Out,\"ease-in-out-quart\":i.Easing.Quartic.InOut,\"ease-quint\":i.Easing.Quintic.InOut,\"ease-in-quint\":i.Easing.Quintic.In,\"ease-out-quint\":i.Easing.Quintic.Out,\"ease-in-out-quint\":i.Easing.Quintic.InOut,\"ease-sine\":i.Easing.Sinusoidal.InOut,\"ease-in-sine\":i.Easing.Sinusoidal.In,\"ease-out-sine\":i.Easing.Sinusoidal.Out,\"ease-in-out-sine\":i.Easing.Sinusoidal.InOut,\"ease-expo\":i.Easing.Exponential.InOut,\"ease-in-expo\":i.Easing.Exponential.In,\"ease-out-expo\":i.Easing.Exponential.Out,\"ease-in-out-expo\":i.Easing.Exponential.InOut,\"ease-circ\":i.Easing.Circular.InOut,\"ease-in-circ\":i.Easing.Circular.In,\"ease-out-circ\":i.Easing.Circular.Out,\"ease-in-out-circ\":i.Easing.Circular.InOut,\"ease-elastic\":i.Easing.Elastic.InOut,\"ease-in-elastic\":i.Easing.Elastic.In,\"ease-out-elastic\":i.Easing.Elastic.Out,\"ease-in-out-elastic\":i.Easing.Elastic.InOut,\"ease-back\":i.Easing.Back.InOut,\"ease-in-back\":i.Easing.Back.In,\"ease-out-back\":i.Easing.Back.Out,\"ease-in-out-back\":i.Easing.Back.InOut,\"ease-bounce\":i.Easing.Bounce.InOut,\"ease-in-bounce\":i.Easing.Bounce.In,\"ease-out-bounce\":i.Easing.Bounce.Out,\"ease-in-out-bounce\":i.Easing.Bounce.InOut},a={backwards:\"backwards\",both:\"both\",forwards:\"forwards\",none:\"none\"},o={indefinite:\"indefinite\"},s={attribute:\"rotation\",begin:\"\",end:\"\",delay:0,dur:1e3,easing:\"ease\",direction:r.normal,fill:a.forwards,from:void 0,repeat:0,to:void 0};t.exports.defaults=s,t.exports.directions=r,t.exports.easingFunctions=n,t.exports.fills=a,t.exports.repeats=o},{\"tween.js\":18}],50:[function(e,t){function i(e){return g.extend({},e)}function r(e,t,i,r,o){function s(){var t=b[0],i=b[1],r=e.components[t],n=r&&r.schema;return n&&n[i]&&\"color\"===n[i].type}function u(){x=b[0],A=b[1],M=e.components[x],M||(e.setAttribute(x,\"\"),M=e.components[x]),y=M.schema,T[t]=void 0===i?v(e,t):i,T[t]=d(T[t],y[A]),L[t]=d(r,y[A]),w=function(i){t in i&&e.setAttribute(x,A,i[t])}}function l(){T=i?h.parse(i):o,L=h.parse(r),w=function(i){e.setAttribute(t,i)}}function p(){T[t]=void 0===i?!1:n(i),T[t]=a(T[t]),L[t]=a(n(r)),w=function(i){e.setAttribute(t,!!i[t])}}function f(){T=new m.Color(i),L=new m.Color(r),w=function(i){b.length>1&&e.setAttribute(b[0],b[1],c(i)),e.setAttribute(t,c(i))}}function g(){T[t]=void 0===i?parseFloat(e.getAttribute(t)):parseFloat(i),L[t]=parseFloat(r),w=function(i){e.setAttribute(t,i[t])}}var y,M,A,x,w,b=t.split(\".\"),T={},L={};return 2===b.length?s()?f():u():r&&E(r)?l():-1!==[\"true\",\"false\"].indexOf(r)?p():isNaN(r)?f():g(),{from:T,partialSetAttribute:w,to:L}}function n(e){return\"true\"===e?!0:!1}function a(e){return e?1:0}function o(e){var t=e.toString(16);return 1===t.length?\"0\"+t:t}function s(e){return Math.floor(255*Math.min(Math.abs(e),1))}function c(e){return\"#\"+[\"r\",\"g\",\"b\"].map(function(t){return o(s(e[t]))}).join(\"\")}var u=e(\"./a-node\"),l=e(\"../constants/animation\"),h=e(\"../utils/\").coordinates,d=e(\"./schema\").parseProperty,p=e(\"./a-register-element\").registerElement,f=e(\"tween.js\"),m=e(\"../lib/three\"),g=e(\"../utils/\"),v=g.entity.getComponentProperty,y=l.defaults,M=l.directions,A=l.easingFunctions,x=l.fills,w=l.repeats,E=h.isCoordinate;t.exports.AAnimation=p(\"a-animation\",{prototype:Object.create(u.prototype,{createdCallback:{value:function(){this.bindMethods(),this.isRunning=!1,this.partialSetAttribute=function(){},this.tween=null}},attachedCallback:{value:function(){function e(){return i.isPlaying?i.hasLoaded?(t.applyMixin(),t.update(),t.load(),void 0):(i.addEventListener(\"loaded\",e),void 0):(i.addEventListener(\"play\",e),void 0)}var t=this,i=this.el=this.parentNode;e()}},attributeChangedCallback:{value:function(){this.hasLoaded&&this.isRunning&&(this.stop(),this.applyMixin(),this.update())}},detachedCallback:{value:function(){this.isRunning&&this.stop()}},getTween:{value:function(){var e,t,n,a,o=this,s=o.data,c=o.el,u=s.attribute,l=parseInt(s.delay,10),h=v(c,u),d=o.getDirection(s.direction),p=A[s.easing],m=s.fill,g=s.repeat===w.indefinite?1/0:0,y=!1;return e=r(c,u,s.from||o.initialValue,s.to,h),t=e.from,n=e.to,o.partialSetAttribute=e.partialSetAttribute,void 0===o.count&&(o.count=1/0===g?0:parseInt(s.repeat,10)),isNaN(l)&&(l=0),o.initialValue=o.initialValue||i(h),1/0===g&&m===x.forwards&&-1!==[M.alternate,M.alternateReverse].indexOf(s.direction)&&(y=!0),d===M.reverse&&(a=n,n=i(t),t=i(a)),-1!==[x.backwards,x.both].indexOf(m)&&o.partialSetAttribute(t),new f.Tween(i(t)).to(n,s.dur).delay(l).easing(p).repeat(g).yoyo(y).onUpdate(function(){o.partialSetAttribute(this)}).onComplete(o.onCompleted.bind(o))}},update:{value:function(){var e=this.data;\"infinite\"===e.repeat&&console.warn(\"Using 'infinite' as 'repeat' value is invalid.  Use 'indefinite' instead.\"),\"\"===e.begin||isNaN(e.begin)||(console.warn(\"Using 'begin' to specify a delay is deprecated. Use 'delay' instead.\"),e.delay=e.begin,e.begin=\"\");var t=e.begin,i=e.end;this.evt&&this.removeEventListeners(this.evt),this.evt={begin:t,end:i},this.addEventListeners(this.evt),\"\"===t&&(this.stop(),this.start())},writable:window.debug},onCompleted:{value:function(){var e=this.data;return this.isRunning=!1,-1!==[x.backwards,x.none].indexOf(e.fill)&&this.partialSetAttribute(this.initialValue),0===this.count?(this.count=void 0,this.emit(\"animationend\"),void 0):(this.isRunning=!1,this.count--,this.start(),void 0)}},start:{value:function(){!this.isRunning&&this.el.isPlaying&&(this.tween=this.getTween(),this.isRunning=!0,this.tween.start(),this.emit(\"animationstart\"))},writable:!0},stop:{value:function(){var e=this.tween;e&&(e.stop(),this.isRunning=!1,-1!==[x.backwards,x.none].indexOf(this.data.fill)&&this.partialSetAttribute(this.initialValue),this.emit(\"animationstop\"))},writable:!0},getDirection:{value:function(e){return e===M.alternate?(this.prevDirection=this.prevDirection===M.normal?M.reverse:M.normal,this.prevDirection):e===M.alternateReverse?(this.prevDirection=this.prevDirection===M.reverse?M.normal:M.reverse,this.prevDirection):e}},bindMethods:{value:function(){this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.onStateAdded=this.onStateAdded.bind(this),this.onStateRemoved=this.onStateRemoved.bind(this)}},addEventListeners:{value:function(e){var t=this.el,i=this;g.splitString(e.begin).forEach(function(e){t.addEventListener(e,i.start)}),g.splitString(e.end).forEach(function(e){t.addEventListener(e,i.stop)}),\"\"===e.begin&&t.addEventListener(\"play\",this.start),t.addEventListener(\"pause\",this.stop),t.addEventListener(\"stateadded\",this.onStateAdded),t.addEventListener(\"stateremoved\",this.onStateRemoved)}},removeEventListeners:{value:function(e){var t=this.el,i=this.start,r=this.stop;g.splitString(e.begin).forEach(function(e){t.removeEventListener(e,i)}),g.splitString(e.end).forEach(function(e){t.removeEventListener(e,r)}),t.removeEventListener(\"stateadded\",this.onStateAdded),t.removeEventListener(\"stateremoved\",this.onStateRemoved)}},onStateAdded:{value:function(e){e.detail.state===this.data.begin&&this.start()},writable:!0},onStateRemoved:{value:function(e){e.detail.state===this.data.begin&&this.stop()},writable:!0},applyMixin:{value:function(){var e,t,i,r={};i=document.querySelector(\"#\"+this.getAttribute(\"mixin\")),t=i?g.getElData(i,y):{},e=g.getElData(this,y),g.extend(r,y,t,e),this.data=r}}})}),t.exports.getAnimationValues=r},{\"../constants/animation\":49,\"../lib/three\":101,\"../utils/\":117,\"./a-node\":55,\"./a-register-element\":56,\"./schema\":64,\"tween.js\":18}],51:[function(e,t){function i(e){return e.hasAttribute(\"autoplay\")||\"auto\"===e.getAttribute(\"preload\")?new Promise(function(t,i){function r(){for(var i=0,r=0;r<e.buffered.length;r++)i+=e.buffered.end(r)-e.buffered.start(r);i>=e.duration&&t()}return 4===e.readyState?t():e.error?i():(e.addEventListener(\"loadeddata\",r,!1),e.addEventListener(\"progress\",r,!1),e.addEventListener(\"error\",i,!1),void 0)}):void 0}var r=e(\"./a-node\"),n=e(\"../utils/debug\"),a=e(\"./a-register-element\").registerElement,o=e(\"../lib/three\"),s=new o.XHRLoader,c=n(\"core:a-assets:warn\");t.exports=a(\"a-assets\",{prototype:Object.create(r.prototype,{createdCallback:{value:function(){this.isAssets=!0}},attachedCallback:{value:function(){var e=this,t=[],r=this.querySelectorAll(\"audio\"),n=this.querySelectorAll(\"img\"),a=parseInt(this.getAttribute(\"timeout\"),10)||3e3,o=this.querySelectorAll(\"video\");if(!this.parentNode.isScene)throw new Error(\"<a-assets> must be a child of a <a-scene>.\");for(var s=0;s<n.length;s++)t.push(new Promise(function(e,t){var i=n[s];i.onload=e,i.onerror=t}));for(s=0;s<r.length;s++)t.push(i(r[s]));for(s=0;s<o.length;s++)t.push(i(o[s]));Promise.all(t).then(this.load.bind(this)),setTimeout(function(){e.hasLoaded||(c(\"Asset loading timed out in \",a,\"ms\"),e.emit(\"timeout\"),e.load())},a)}},load:{value:function(){r.prototype.load.call(this,null,function(e){return e.isAssetItem&&e.hasAttribute(\"src\")})}}})}),a(\"a-asset-item\",{prototype:Object.create(r.prototype,{createdCallback:{value:function(){this.data=null,this.isAssetItem=!0}},attachedCallback:{value:function(){var e=this,t=this.getAttribute(\"src\");s.load(t,function(t){e.data=t,r.prototype.load.call(e)})}}})})},{\"../lib/three\":101,\"../utils/debug\":115,\"./a-node\":55,\"./a-register-element\":56}],52:[function(e,t){var i=e(\"../utils/debug\"),r=e(\"./a-register-element\").registerElement,n=i(\"core:cubemap:warn\");t.exports=r(\"a-cubemap\",{prototype:Object.create(HTMLElement.prototype,{attachedCallback:{value:function(){this.srcs=this.validate()},writable:window.debug},validate:{value:function(){var e,t=this.querySelectorAll(\"[src]\"),i=[];if(6===t.length){for(e=0;e<t.length;e++)i.push(t[e].getAttribute(\"src\"));return i}n(\"<a-cubemap> did not contain exactly six elements each with a `src` attribute.\")},writable:window.debug}})})},{\"../utils/debug\":115,\"./a-register-element\":56}],53:[function(e,t){function i(e,t){return void 0!==e.defaultComponents[t]?!0:e.components[t]&&e.components[t].attrValue?!0:n(t,e.mixinEls)}function r(e){var t=[];return e.mixinEls.forEach(function(e){function i(e){t.push(e)}Object.keys(e.componentAttrCache).forEach(i)}),t}function n(e,t){var i,r=!1;for(i=0;i<t.length&&!(r=t[i].hasAttribute(e));++i);return r}function a(e){return e.isEntity}var o,s=e(\"./a-node\"),c=e(\"./component\").components,u=e(\"./a-register-element\"),l=e(\"../lib/three\"),h=e(\"../utils/\"),d=u.isNode,p=h.debug(\"core:a-entity:debug\"),f=u.registerElement,m=\"__\",g=Object.create(s.prototype,{defaultComponents:{value:{position:\"\",rotation:\"\",scale:\"\",visible:\"\"}},createdCallback:{value:function(){this.components={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new l.Group,this.object3D.el=this,this.object3DMap={},this.states=[]}},attributeChangedCallback:{value:function(e,t,i){var r=this.components[e];return r&&r.justInitialized&&\"\"===i?(delete r.justInitialized,void 0):((r||null!==i)&&this.setEntityAttribute(e,t,i),void 0)}},attachedCallback:{value:function(){this.addToParent(),this.isScene||this.load()}},detachedCallback:{value:function(){this.parentEl&&!this.isScene&&(Object.keys(this.components).forEach(this.removeComponent.bind(this)),this.parentEl.remove(this))}},applyMixin:{value:function(e){return e?(this.updateComponent(e,this.getAttribute(e)),void 0):(this.updateComponents(),void 0)}},mapStateMixins:{value:function(e,t){var i,r=this.getAttribute(\"mixin\");r&&(i=r.split(\" \"),i.forEach(function(i){var r=i+\"-\"+e;t(r)}),this.updateComponents())}},updateStateMixins:{value:function(e,t){var i=this;t=t||\"\";var r=e.split(\" \"),n=t?t.split(\" \"):[],a=n.filter(function(e){return r.indexOf(e)<0});a.forEach(function(e){var t=Array.prototype.forEach,r=document.querySelectorAll(\"[id^=\"+e+\"-]\"),n=[];t.call(r,function(e){n.push(e.id)}),n.forEach(i.unregisterMixin.bind(i))}),this.states.forEach(function(e){r.forEach(function(t){var r=t+\"-\"+e;i.registerMixin(r)})})}},getObject3D:{value:function(e){return this.object3DMap[e]}},setObject3D:{value:function(e,t){var i=this,r=this.object3DMap[e];r&&this.object3D.remove(r),t instanceof l.Object3D&&(t.el=i,this.object3D.add(t),t.children.length&&t.traverse(function(e){e.el=i})),this.object3DMap[e]=t}},removeObject3D:{value:function(e){this.setObject3D(e,null)}},getOrCreateObject3D:{value:function(e,t){var i=this.getObject3D(e);return!i&&t&&(i=new t,this.setObject3D(e,i)),i}},add:{value:function(e){if(!e.object3D)throw new Error(\"Trying to add an element that doesn't have an `object3D`\");this.emit(\"child-attached\",{el:e}),this.object3D.add(e.object3D)}},addToParent:{value:function(){function e(){t.attachedToParent=!0,i.add&&i.add(t)}var t=this,i=this.parentEl=this.parentNode,r=this.attachedToParent;return i&&!r?d(i)?(e(),void 0):(i.addEventListener(\"nodeready\",e),void 0):void 0}},load:{value:function(){function e(){i.updateComponents()}function t(){i.updateComponents(),i.parentEl.isPlaying&&i.play()}var i=this;if(!this.hasLoaded)return this.addToParent(),this.isScene?(s.prototype.load.call(this,e),void 0):(s.prototype.load.call(this,t,a),void 0)},writable:window.debug},remove:{value:function(e){this.object3D.remove(e.object3D)}},getChildEntities:{value:function(){for(var e=this.children,t=[],i=0;i<e.length;i++){var r=e[i];r instanceof o&&t.push(r)}return t}},initComponent:{value:function(e,t,r){var n,a=e.split(m),o=a[1],s=a[0],u=i(this,e)||void 0!==t;if(c[s]&&(u||r)&&!(e in this.components)){if(this.initComponentDependencies(s),o&&!c[s].multiple)throw new Error(\"Trying to initialize multiple components of type `\"+s+\"`. There can only be one component of this type per entity.\");n=this.components[e]=new c[s].Component(this,t,o),this.isPlaying&&n.play(),this.hasAttribute(e)||(n.justInitialized=!0,HTMLElement.prototype.setAttribute.call(this,e,\"\")),p(\"Component initialized: %s\",e)}},writable:window.debug},initComponentDependencies:{value:function(e){var t,i=this,r=c[e];r&&(t=c[e].dependencies,t&&t.forEach(function(e){i.initComponent(e,void 0,!0)}))}},removeComponent:{value:function(e){var t=this.components[e],i=e in this.defaultComponents,r=n(e,this.mixinEls);i||r||(t.pause(),t.remove(),delete this.components[e],this.emit(\"componentremoved\",{name:e}))}},updateComponents:{value:function(){function e(e){var t=e.split(m)[0];c[t]&&(n[e]=!0)}function t(e){var t=a.getAttribute(e);delete n[e],a.updateComponent(e,t)}var i,n={},a=this;if(this.hasLoaded){var o=this.attributes;for(i=0;i<o.length;++i)e(o[i].name);r(this).forEach(e),Object.keys(this.defaultComponents).forEach(t),Object.keys(n).forEach(t)}}},updateComponent:{value:function(e,t){var i=this.components[e],r=e in this.defaultComponents;return i?null!==t||r?(i.updateProperties(t),void 0):(this.removeComponent(e),void 0):(this.initComponent(e,t,!1),void 0)}},updateComponentProperty:{value:function(e,t,i){var r=this.components[e],n=r&&r.attrValue,a=n?h.extend({},n):{};a[t]=i,this.updateComponent(e,a)}},removeAttribute:{value:function(e){var t=this.components[e];t&&(this.setEntityAttribute(e,void 0,null),this.components[e])||HTMLElement.prototype.removeAttribute.call(this,e)}},play:{value:function(){var e=this.components,t=Object.keys(e);!this.isPlaying&&this.hasLoaded&&(this.isPlaying=!0,t.forEach(function(t){e[t].play()}),this.getChildEntities().forEach(function(e){e.play()}),this.emit(\"play\"))},writable:!0},pause:{value:function(){var e=this.components,t=Object.keys(e);this.isPlaying&&(this.isPlaying=!1,t.forEach(function(t){e[t].pause()}),this.getChildEntities().forEach(function(e){e.pause()}),this.emit(\"pause\"))},writable:!0},setEntityAttribute:{value:function(e,t,i){return c[e]||this.components[e]?(this.updateComponent(e,i),void 0):\"mixin\"===e?(this.mixinUpdate(i,t),void 0):void 0}},mixinUpdate:{value:function(e,t){t=t||this.getAttribute(\"mixin\"),this.updateStateMixins(e,t),this.updateComponents()}},setAttribute:{value:function(e,t,i){var r=this.sceneEl&&this.sceneEl.getAttribute(\"debug\"),n=e.split(m)[0];return c[n]?(\"string\"==typeof t&&void 0!==i?this.updateComponentProperty(e,t,i):this.updateComponent(e,t),r&&this.components[e].flushToDOM(),void 0):(s.prototype.setAttribute.call(this,e,t),\"mixin\"===e&&this.mixinUpdate(t),void 0)},writable:window.debug},flushToDOM:{value:function(e){function t(e){n[e].flushToDOM()}var i,r,n=this.components,a=this.children;if(Object.keys(n).forEach(t),e)for(r=0;r<a.length;++r)i=a[r],i.flushToDOM&&i.flushToDOM(e)}},getAttribute:{value:function(e){var t=this.components[e];return t?t.attrValue:HTMLElement.prototype.getAttribute.call(this,e)},writable:window.debug},getComputedAttribute:{value:function(e){var t=this.components[e];return t?t.getData():HTMLElement.prototype.getAttribute.call(this,e)}},addState:{value:function(e){this.is(e)||(this.states.push(e),this.mapStateMixins(e,this.registerMixin.bind(this)),this.emit(\"stateadded\",{state:e}))}},removeState:{value:function(e){var t=this.states.indexOf(e);-1!==t&&(this.states.splice(t,1),this.mapStateMixins(e,this.unregisterMixin.bind(this)),this.emit(\"stateremoved\",{state:e}))}},is:{value:function(e){return-1!==this.states.indexOf(e)}}});o=f(\"a-entity\",{prototype:g}),t.exports=o},{\"../lib/three\":101,\"../utils/\":117,\"./a-node\":55,\"./a-register-element\":56,\"./component\":57}],54:[function(e,t){var i=e(\"./a-node\"),r=e(\"./a-register-element\").registerElement,n=e(\"./component\").components;t.exports=r(\"a-mixin\",{prototype:Object.create(i.prototype,{createdCallback:{value:function(){this.componentAttrCache={}}},attributeChangedCallback:{value:function(e,t,i){this.cacheAttribute(e,i)}},attachedCallback:{value:function(){this.cacheAttributes(),this.load()},writable:window.debug},setAttribute:{value:function(e,t){this.cacheAttribute(e,t),HTMLElement.prototype.setAttribute.call(this,e,t)},writable:window.debug},cacheAttribute:{value:function(e,t){var i=n[e];i&&(t=void 0===t?HTMLElement.prototype.getAttribute.call(this,e):t,this.componentAttrCache[e]=i.parseAttrValueForCache(t))}},getAttribute:{value:function(e){return this.componentAttrCache[e]||HTMLElement.prototype.getAttribute.call(this,e)},writable:window.debug},cacheAttributes:{value:function(){var e,t,i=this.attributes;for(t=0;t<i.length;++t)e=i[t].name,this.cacheAttribute(e)}}})})},{\"./a-node\":55,\"./a-register-element\":56,\"./component\":57}],55:[function(e,t){var i=e(\"./a-register-element\").registerElement,r=e(\"../utils/\");t.exports=i(\"a-node\",{prototype:Object.create(HTMLElement.prototype,{createdCallback:{value:function(){this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[],this.mixinObservers={}},writable:window.debug},attachedCallback:{value:function(){var e=this.getAttribute(\"mixin\");this.sceneEl=this.isScene?this:this.closestScene(),this.emit(\"nodeready\",{},!1),e&&this.updateMixins(e)},writable:window.debug},attributeChangedCallback:{value:function(e,t,i){\"mixin\"===e&&this.updateMixins(i,t)}},closestScene:{value:function(){for(var e=this;e&&!e.isScene;)e=e.parentElement;return e}},closest:{value:function(e){for(var t=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,i=this;i&&!t.call(i,e);)i=i.parentElement;return i}},detachedCallback:{value:function(){}},load:{value:function(e,t){var i,r,n=this;this.hasLoaded||(t=t||function(e){return e.isNode},i=this.getChildren(),r=i.filter(t).map(function(e){return new Promise(function(t){return e.hasLoaded?t():(e.addEventListener(\"loaded\",t),void 0)})}),Promise.all(r).then(function(){n.hasLoaded=!0,e&&e(),n.emit(\"loaded\",{},!1)}))},writable:!0},getChildren:{value:function(){return Array.prototype.slice.call(this.children,0)}},updateMixins:{value:function(e,t){var i=e.split(\" \"),r=t?t.split(\" \"):[],n=r.filter(function(e){return i.indexOf(e)<0});this.mixinEls=[],n.forEach(this.unregisterMixin.bind(this)),i.forEach(this.registerMixin.bind(this))}},registerMixin:{value:function(e){if(this.sceneEl){var t=this.sceneEl.querySelector(\"a-mixin#\"+e);t&&(this.attachMixinListener(t),this.mixinEls.push(t))}}},setAttribute:{value:function(e,t){\"mixin\"===e&&this.updateMixins(t),HTMLElement.prototype.setAttribute.call(this,e,t)}},unregisterMixin:{value:function(e){var t,i,r=this.mixinEls;for(i=0;i<r.length;++i)if(t=r[i],e===t.id){r.splice(i,1);break}this.removeMixinListener(e)}},removeMixinListener:{value:function(e){var t=this.mixinObservers[e];t&&(t.disconnect(),this.mixinObservers[e]=null)}},attachMixinListener:{value:function(e){var t=this,i=e.id,r=this.mixinObservers[i];if(e&&!r){var n=new MutationObserver(function(e){var i=e[0].attributeName;t.applyMixin(i)}),a={attributes:!0};n.observe(e,a),this.mixinObservers[i]=n}}},applyMixin:{value:function(){}},emit:{value:function(e,t,i){var n=this;t=t||{},void 0===i&&(i=!0);var a={bubbles:!!i,detail:t};return e.split(\" \").map(function(e){return r.fireEvent(n,e,a)})}},emitter:{value:function(e,t,i){var r=this;return function(){r.emit(e,t,i)}}}})})},{\"../utils/\":117,\"./a-register-element\":56}],56:[function(e,t){function i(e){l[e.toLowerCase()]=!0}function r(e){var t={},i=[\"attachedCallback\",\"attributeChangedCallback\",\"createdCallback\"];return a(t,i,e,c.prototype),s(e,t),t}function n(e){var t={},i=[\"attachedCallback\",\"attributeChangedCallback\",\"createdCallback\"],r=[\"attachedCallback\",\"attributeChangedCallback\",\"createdCallback\",\"detachedCallback\"];return a(t,i,e,c.prototype),a(t,r,e,u.prototype),s(e,t),t}function a(e,t,i,r){t.forEach(function(t){o(e,t,i,r)})}function o(e,t,i,r){var n=i[t],a=r[t];n&&a&&n!==a&&(e[t]={value:function(){return a.apply(this,arguments),n.apply(this,arguments)},writable:window.debug})}function s(e,t){var i=Object.getOwnPropertyNames(e);i.forEach(function(i){var r;t[i]||(r=Object.getOwnPropertyDescriptor(e,i),t[i]={value:e[i],writable:r.writable})})}e(\"document-register-element\");var c,u,l=t.exports.knownTags={};t.exports.isNode=function(e){return e.tagName.toLowerCase()in l||e.isNode},t.exports.registerElement=function(e,t){var a=Object.getPrototypeOf(t.prototype),o=t,s=c&&a===c.prototype,l=u&&a===u.prototype;return(s||l)&&i(e),s&&(o=r(t.prototype),o={prototype:Object.create(a,o)}),l&&(o=n(t.prototype),o={prototype:Object.create(a,o)}),document.registerElement(e,o)},t.exports.wrapMethods=a,c=e(\"./a-node\"),u=e(\"./a-entity\")},{\"./a-entity\":53,\"./a-node\":55,\"document-register-element\":5}],57:[function(e,t){function i(e,t,i,n,a){function o(e){var i=e.getAttribute(t);i&&(s=r(s,i,u))}var s,c=void 0!==n&&null!==n,u=p(i),d=e.mixinEls;return u?s=i.default:(s={},Object.keys(i).forEach(function(e){s[e]=i[e].default})),d.forEach(o),c?u?h(n,i):(s=r(s,n,u),l(s,i,void 0,t,a)):u?h(s,i):l(s,i,void 0,t,a)}function r(e,t,i){return i?t:c.extend(e,t)}function n(e){return function(){var t=this.el.sceneEl;this.isPlaying&&(e.call(this),this.isPlaying=!1,this.tick&&t.removeBehavior(this))}}function a(e){return function(){var t=this.el.sceneEl,i=this.el.isPlaying&&!this.isPlaying;this.initialized&&i&&(e.call(this),this.isPlaying=!0,this.tick&&t.addBehavior(this))}}var o=e(\"./schema\"),s=e(\"./system\"),c=e(\"../utils/\"),u=t.exports.components={},l=o.parseProperties,h=o.parseProperty,d=o.process,p=o.isSingleProperty,f=o.stringifyProperties,m=o.stringifyProperty,g=c.styleParser,v=t.exports.Component=function(e,t,i){this.el=e,this.id=i,this.attrName=this.name+(i?\"__\"+i:\"\"),this.updateCachedAttrValue(t)};v.prototype={schema:{},init:function(){},update:function(){},updateSchema:void 0,tick:void 0,play:function(){},pause:function(){},remove:function(){},parse:function(e,t){var i=this.schema;return p(i)?h(e,i):l(g.parse(e),i,!0,this.name,t)},stringify:function(e){var t=this.schema;return\"string\"==typeof e?e:p(t)?m(e,t):(e=f(e,t),g.stringify(e))},getData:function(){var e=this.data;return\"object\"!=typeof e?e:c.extend({},e)},updateCachedAttrValue:function(e){var t=p(this.schema),i=this.parseAttrValueForCache(e);this.attrValue=r({},i,t)},parseAttrValueForCache:function(e){var t;return\"string\"!=typeof e?e:(p(this.schema)?(t=this.schema.parse(e),\"string\"==typeof t&&(t=e)):t=g.parse(e),t)},flushToDOM:function(){var e=this.attrValue;e&&HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(e))},updateProperties:function(e){var t=this.el,n=p(this.schema),a=r({},this.data,n);this.updateCachedAttrValue(e),this.updateSchema&&this.updateSchema(i(t,this.name,this.schema,this.attrValue,!0)),this.data=i(t,this.name,this.schema,this.attrValue),(n||!c.deepEqual(a,this.data))&&(this.initialized?this.update(a):(this.init(),this.initialized=!0,this.update(a),t.isPlaying&&this.play()),t.emit(\"componentchanged\",{id:this.id,name:this.name,newData:this.getData(),oldData:a}))},extendSchema:function(e){var t=c.extend({},u[this.name].schema);c.extend(t,e),this.schema=d(t),this.el.emit(\"schemachanged\",{component:this.name})}},t.exports.registerComponent=function(e,t){var i,r={};if(-1!==e.indexOf(\"__\"))throw new Error(\"The component name `\"+e+\"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type\");if(Object.keys(t).forEach(function(e){r[e]={value:t[e],writable:!0}}),u[e])throw new Error(\"The component `\"+e+\"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.\");return i=function(e,t,i){v.call(this,e,t,i),e.hasLoaded&&this.updateProperties(this.attrValue)},i.prototype=Object.create(v.prototype,r),i.prototype.name=e,i.prototype.constructor=i,i.prototype.system=s&&s.systems[e],i.prototype.play=a(i.prototype.play),i.prototype.pause=n(i.prototype.pause),u[e]={Component:i,dependencies:i.prototype.dependencies,multiple:i.prototype.multiple,parse:i.prototype.parse,parseAttrValueForCache:i.prototype.parseAttrValueForCache,schema:c.extend(d(i.prototype.schema)),stringify:i.prototype.stringify,type:i.prototype.type},i},t.exports.buildData=i},{\"../utils/\":117,\"./schema\":64,\"./system\":66}],58:[function(e,t){var i=e(\"./schema\"),r=i.process,n=t.exports.geometries={},a=t.exports.geometryNames=[],o=e(\"../lib/three\"),s=t.exports.Geometry=function(){};s.prototype={schema:{},init:function(){return this.geometry=new o.Geometry,this.geometry},update:function(){}},t.exports.registerGeometry=function(e,t){var i,o={};if(Object.keys(t).forEach(function(e){o[e]={value:t[e],writable:!0}}),n[e])throw new Error(\"The geometry `\"+e+\"` has been already registered\");return i=function(){s.call(this)},i.prototype=Object.create(s.prototype,o),i.prototype.name=e,i.prototype.constructor=i,n[e]={Geometry:i,schema:r(i.prototype.schema)},a.push(e),i}},{\"../lib/three\":101,\"./schema\":64}],59:[function(e,t){function i(e,t,i,r){return\"type\"in M?(y(\"Property type \"+e+\" is already registered.\"),void 0):(M[e]={\"default\":t,parse:i||a,stringify:r||o},void 0)}function r(e){function t(e){return e.trim()}return Array.isArray(e)?e:e&&\"string\"==typeof e?e.split(\",\").map(t):[]}function n(e){return e.join(\", \")}function a(e){return e}function o(e){return null===e?\"null\":e.toString()}function s(e){return\"false\"!==e&&e!==!1\n}function c(e){return parseInt(e,10)}function u(e){return parseFloat(e,10)}function l(e){return e?\"string\"!=typeof e?e:document.querySelector(e):null}function h(e){return e?\"string\"!=typeof e?e:Array.prototype.slice.call(document.querySelectorAll(e),0):null}function d(e){return e.getAttribute?\"#\"+e.getAttribute(\"id\"):o(e)}function p(e){return e instanceof Array?e.map(function(e){return\"#\"+e.getAttribute(\"id\")}).join(\", \"):o(e)}function f(e){var t=e.match(/\\url\\((.+)\\)/);if(t)return t[1];var i=l(e);return i?i.getAttribute(\"src\"):\"\"}function m(e){return g.parse(e,this.default)}var g=e(\"../utils/coordinates\"),v=e(\"debug\"),y=v(\"core:propertyTypes:warn\"),M=t.exports.propertyTypes={};i(\"array\",[],r,n),i(\"boolean\",!1,s),i(\"color\",\"#FFF\",a,o),i(\"int\",0,c),i(\"number\",0,u),i(\"selector\",\"\",l,d),i(\"selectorAll\",\"\",h,p),i(\"src\",\"\",f),i(\"string\",\"\",a,o),i(\"time\",0,c),i(\"vec2\",{x:0,y:0},m,g.stringify),i(\"vec3\",{x:0,y:0,z:0},m,g.stringify),i(\"vec4\",{x:0,y:0,z:0,w:0},m,g.stringify),t.exports.registerPropertyType=i},{\"../utils/coordinates\":114,debug:2}],60:[function(e,t){function i(e,t){return t?{height:e.parentElement.offsetHeight,width:e.parentElement.offsetWidth}:{height:window.innerHeight,width:window.innerWidth}}function r(e){var t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen;t.apply(e)}var n=e(\"./metaTags\").inject,a=e(\"./wakelock\"),o=e(\"../a-register-element\"),s=e(\"../system\").systems,c=e(\"../../lib/three\"),u=e(\"tween.js\"),l=e(\"../../utils/\"),h=e(\"../a-entity\"),d=e(\"../a-node\"),p=e(\"./postMessage\"),f=l.checkHeadsetConnected,m=o.registerElement,g=l.isIOS(),v=l.isMobile();t.exports=m(\"a-scene\",{prototype:Object.create(h.prototype,{defaultComponents:{value:{canvas:\"\",\"keyboard-shortcuts\":\"\",\"vr-mode-ui\":\"\"}},createdCallback:{value:function(){this.isMobile=v,this.isIOS=g,this.isScene=!0,this.object3D=new c.Scene,this.systems={},this.time=0,this.init()}},init:{value:function(){this.behaviors=[],this.hasLoaded=!1,this.isPlaying=!1,this.originalHTML=this.innerHTML,this.addEventListener(\"render-target-loaded\",function(){this.setupRenderer(),this.resize()}),this.addFullScreenStyles(),p(this)},writable:!0},addFullScreenStyles:{value:function(){var e=document.documentElement;e.classList.add(\"a-html\"),document.body.classList.add(\"a-body\"),this.classList.add(\"fullscreen\")}},removeFullScreenStyles:{value:function(){var e=document.documentElement;e.classList.remove(\"a-html\"),document.body.classList.remove(\"a-body\"),this.classList.remove(\"fullscreen\")}},attachedCallback:{value:function(){var e=this.resize.bind(this);n(this),a(this),this.initSystems(),window.addEventListener(\"load\",e),window.addEventListener(\"resize\",e),this.play()},writable:window.debug},initSystems:{value:function(){Object.keys(s).forEach(this.initSystem.bind(this))}},initSystem:{value:function(e){var t;this.systems[e]||(t=this.systems[e]=new s[e](this),t.init())}},detachedCallback:{value:function(){window.cancelAnimationFrame(this.animationFrameID),this.animationFrameID=null}},addBehavior:{value:function(e){var t=this.behaviors;-1===t.indexOf(e)&&t.push(e)}},enterVR:{value:function(e){function t(){n.addState(\"vr-mode\"),n.emit(\"enter-vr\",e),n.isMobile&&window.screen.orientation&&window.screen.orientation.lock(\"landscape\"),n.addFullScreenStyles(),n.isMobile||f()||r(n.canvas),n.resize()}function i(e){throw e&&e.message?new Error(\"Failed to enter VR mode (`requestPresent`): \"+e.message):new Error(\"Failed to enter VR mode (`requestPresent`).\")}var n=this;if(!this.is(\"vr-mode\"))return f()||this.isMobile?this.effect.requestPresent().then(t,i):(t(),void 0)}},exitVR:{value:function(){function e(){var e=i.getAttribute(\"embedded\");i.removeState(\"vr-mode\"),i.isMobile&&window.screen.orientation&&window.screen.orientation.unlock(),e&&i.removeFullScreenStyles(),i.resize(),i.emit(\"exit-vr\",{target:i})}function t(e){throw e&&e.message?new Error(\"Failed to exit VR mode (`exitPresent`): \"+e.message):new Error(\"Failed to exit VR mode (`exitPresent`).\")}var i=this;return this.is(\"vr-mode\")?f()||this.isMobile?this.effect.exitPresent().then(e,t):(e(),void 0):Promise.resolve()}},getAttribute:{value:function(e){var t=this.systems[e];return t?t.data:h.prototype.getAttribute.call(this,e)}},getComputedAttribute:{value:function(e){var t=this.systems[e];return t?t.data:h.prototype.getComputedAttribute.call(this,e)}},setAttribute:{value:function(e,t,i){var r=this.systems[e];return r?(d.prototype.setAttribute.call(this,e,t),void 0):(h.prototype.setAttribute.call(this,e,t,i),void 0)}},removeBehavior:{value:function(e){var t=this.behaviors,i=t.indexOf(e);-1!==i&&t.splice(i,1)}},resize:{value:function(){var e,t=this.camera,r=this.canvas,n=this.getAttribute(\"embedded\")&&!this.is(\"vr-mode\");!t||!r||this.is(\"vr-mode\")&&v||(e=i(r,n),t.aspect=e.width/e.height,t.updateProjectionMatrix(),this.renderer.setSize(e.width,e.height))},writable:window.debug},setupRenderer:{value:function(){var e=this.canvas,t=\"true\"===this.getAttribute(\"antialias\"),i=this.renderer=new c.WebGLRenderer({canvas:e,antialias:t||window.hasNativeWebVRImplementation,alpha:!0});i.setPixelRatio(window.devicePixelRatio),i.sortObjects=!1,this.effect=new c.VREffect(i)},writable:window.debug},play:{value:function(){var e=this;return this.renderStarted?(h.prototype.play.call(this),void 0):(this.addEventListener(\"loaded\",function(){this.renderStarted||(h.prototype.play.call(this),this.resize(),this.renderer&&(window.performance&&window.performance.mark(\"render-started\"),this.render(0),this.renderStarted=!0,this.emit(\"renderstart\")))}),setTimeout(function(){h.prototype.load.call(e)}),void 0)}},reload:{value:function(e){function t(){i.isPlaying&&h.prototype.play.call(i)}var i=this;e&&this.pause(),this.innerHTML=this.originalHTML,this.init(),d.prototype.load.call(this,t)}},tick:{value:function(e,t){var i=this.systems;u.update(e),this.behaviors.forEach(function(i){i.el.isPlaying&&i.tick(e,t)}),Object.keys(i).forEach(function(r){i[r].tick&&i[r].tick(e,t)})}},render:{value:function(e){var t=this.camera,i=e-this.time;this.isPlaying&&this.tick(e,i),this.effect.render(this.object3D,t),this.time=e,this.animationFrameID=window.requestAnimationFrame(this.render.bind(this))},writable:window.debug}})})},{\"../../lib/three\":101,\"../../utils/\":117,\"../a-entity\":53,\"../a-node\":55,\"../a-register-element\":56,\"../system\":66,\"./metaTags\":61,\"./postMessage\":62,\"./wakelock\":63,\"tween.js\":18}],61:[function(e,t){function i(e){return{tagName:\"meta\",attributes:e,exists:function(){return document.querySelector('meta[name=\"'+e.name+'\"]')}}}function r(e){return{tagName:\"link\",attributes:e,exists:function(){return document.querySelector('link[rel=\"'+e.rel+'\"]')}}}function n(e){if(e&&e.tagName){var t=document.createElement(e.tagName);return a(t,e.attributes)}}var a=e(\"../../utils\").extend,o=t.exports.MOBILE_HEAD_TAGS=[i({name:\"viewport\",content:\"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui\"}),i({name:\"mobile-web-app-capable\",content:\"yes\"}),i({name:\"theme-color\",content:\"black\"})],s=[i({name:\"apple-mobile-web-app-capable\",content:\"yes\"}),i({name:\"apple-mobile-web-app-status-bar-style\",content:\"black\"}),r({rel:\"apple-touch-icon\",href:\"https://aframe.io/images/aframe-logo-152.png\"})];t.exports.inject=function(e){function t(e){e&&!e.exists()&&(i=n(e),i&&(a?a.parentNode.insertBefore(i,a):r.appendChild(i),c.push(i)))}var i,r=document.head,a=r.querySelector(\"script\"),c=[];return o.forEach(t),e.isIOS&&s.forEach(t),c}},{\"../../utils\":117}],62:[function(e,t){function i(e){var t=this;if(e.data)switch(e.data.type){case\"vr\":switch(e.data.data){case\"enter\":t.enterVR();break;case\"exit\":t.exitVR()}}}var r=e(\"../../utils/\").isIframed;t.exports=function(e){r()&&window.addEventListener(\"message\",i.bind(e))}},{\"../../utils/\":117}],63:[function(e,t){var i=e(\"../../../vendor/wakelock/wakelock\");t.exports=function(e){if(e.isMobile){var t=e.wakelock=new i;e.addEventListener(\"enter-vr\",function(){t.request()}),e.addEventListener(\"exit-vr\",function(){t.release()})}}},{\"../../../vendor/wakelock/wakelock\":126}],64:[function(e,t){function i(e){return\"type\"in e?\"string\"==typeof e.type:\"default\"in e}function r(e){var t,i=e.default,r=e.type;return e.type?\"bool\"===e.type?r=\"boolean\":\"float\"===e.type&&(r=\"number\"):r=void 0!==i&&-1!==[\"boolean\",\"number\"].indexOf(typeof i)?typeof i:Array.isArray(i)?\"array\":\"string\",t=s[r],t||c(\"Unknown property type: \"+r),e.parse=e.parse||t.parse,e.stringify=e.stringify||t.stringify,e.type=r,\"default\"in e||(e.default=t.default),e}function n(e,t){return e=void 0===e||null===e?t.default:e,t.parse(e)}function a(e,t){return\"object\"!=typeof e?e:t?t.stringify(e):JSON.stringify(e)}var o=e(\"../utils/debug\"),s=e(\"./propertyTypes\").propertyTypes,c=o(\"core:schema:warn\");t.exports.isSingleProperty=i,t.exports.process=function(e){return i(e)?r(e):(Object.keys(e).forEach(function(t){e[t]=r(e[t])}),e)},t.exports.processPropertyDefinition=r,t.exports.parseProperties=function(e,t,i,r,a){var o=Object.keys(i?e:t);return null===e||\"object\"!=typeof e?e:(Object.keys(e).forEach(function(e){t[e]||a||c(\"Unknown property `\"+e+\"` for component/system `\"+r+\"`.\")}),o.forEach(function(i){var r=t[i],a=e[i];t[i]&&(e[i]=n(a,r))}),e)},t.exports.parseProperty=n,t.exports.stringifyProperties=function(e,t){var i={};return Object.keys(e).forEach(function(r){var n=t[r],o=e[r],s=o;\"object\"==typeof s&&(s=a(o,n),n||c(\"Unknown component property: \"+r)),i[r]=s}),i},t.exports.stringifyProperty=a},{\"../utils/debug\":115,\"./propertyTypes\":59}],65:[function(e,t){var i=e(\"./schema\"),r=i.process,n=t.exports.shaders={},a=t.exports.shaderNames=[],o=e(\"../lib/three\"),s={number:\"f\",time:\"f\",vec4:\"v4\",vec3:\"v3\",vec2:\"v2\",color:\"v3\"},c=t.exports.Shader=function(){};c.prototype={schema:{},vertexShader:\"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}\",fragmentShader:\"void main() {gl_FragColor = vec4(1.0,0.0,1.0,1.0);}\",init:function(e){return this.attributes=this.initVariables(e,\"attribute\"),this.uniforms=this.initVariables(e,\"uniform\"),this.material=new o.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initVariables:function(e,t){function i(i){if(a[i].is===t){var o=s[a[i].type],c=a[i].parse(e[i]||a[i].default);n[i]={type:o,value:r.parseValue(a[i].type,c)}}}var r=this,n={},a=this.schema,o=Object.keys(a);return o.forEach(i),n},update:function(e){this.updateVariables(e,\"attribute\"),this.updateVariables(e,\"uniform\")},updateVariables:function(e,t){function i(i){o[i]&&o[i].is===t&&n[i].value!==e[i]&&(n[i].value=r.parseValue(o[i].type,e[i]),n[i].needsUpdate=!0)}var r=this,n=\"uniform\"===t?this.uniforms:this.attributes,a=Object.keys(e),o=this.schema;a.forEach(i)},parseValue:function(e,t){var i;switch(e){case\"vec2\":return new o.Vector2(t.x,t.y);case\"vec3\":return new o.Vector3(t.x,t.y,t.z);case\"vec4\":return new o.Vector4(t.x,t.y,t.z,t.w);case\"color\":return i=new o.Color(t),new o.Vector3(i.r,i.g,i.b);default:return t}}},t.exports.registerShader=function(e,t){var i,o={};if(Object.keys(t).forEach(function(e){o[e]={value:t[e],writable:!0}}),n[e])throw new Error(\"The shader \"+e+\" has been already registered\");return i=function(){c.call(this)},i.prototype=Object.create(c.prototype,o),i.prototype.name=e,i.prototype.constructor=i,n[e]={Shader:i,schema:r(i.prototype.schema)},a.push(e),i}},{\"../lib/three\":101,\"./schema\":64}],66:[function(e,t){var i=e(\"./component\"),r=e(\"./schema\"),n=e(\"../utils/\"),a=r.parseProperties,o=r.parseProperty,s=r.process,c=r.isSingleProperty,u=n.styleParser,l=t.exports.systems={},h=t.exports.System=function(e){var t,r=i&&i.components[this.name],n=this.schema;return this.sceneEl=e,r&&(r.Component.prototype.system=this),Object.keys(n).length?(t=HTMLElement.prototype.getAttribute.call(e,this.name),c(n)?(this.data=o(t,n),void 0):(this.data=a(u.parse(t)||{},n,!1,this.name),void 0)):void 0};h.prototype={schema:{},init:function(){},tick:void 0,play:function(){},pause:function(){}},t.exports.registerSystem=function(e,t){var i,r,a={},o=n.findAllScenes(document);if(Object.keys(t).forEach(function(e){a[e]={value:t[e],writable:!0}}),l[e])throw new Error(\"The system `\"+e+\"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.\");for(r=function(e){h.call(this,e)},r.prototype=Object.create(h.prototype,a),r.prototype.name=e,r.prototype.constructor=r,r.prototype.schema=n.extend(s(r.prototype.schema)),l[e]=r,i=0;i<o.length;i++)o[i].initSystem(e)}},{\"../utils/\":117,\"./component\":57,\"./schema\":64}],67:[function(e){e(\"./pivot\")},{\"./pivot\":68}],68:[function(e){var t=e(\"../../core/component\").registerComponent,i=e(\"../../lib/three\"),r=new i.Vector3,n=new i.Vector3;t(\"pivot\",{dependencies:[\"position\"],schema:{type:\"vec3\"},init:function(){var e=this.data,t=this.el,a=t.object3D.parent,o=t.object3D,s=new i.Group;r.copy(o.position),n.copy(o.rotation),a.remove(o),s.add(o),a.add(s),t.object3D=s,o.position.set(-1*e.x,-1*e.y,-1*e.z),s.position.set(e.x+r.x,e.y+r.y,e.z+r.z),s.rotation.copy(o.rotation),o.rotation.set(0,0,0)}})},{\"../../core/component\":57,\"../../lib/three\":101}],69:[function(e,t){var i=e(\"../../core/a-node\"),r=e(\"../../core/a-register-element\").registerElement,n=e(\"../../utils/\"),a=n.entity.setComponentProperty;t.exports=r(\"a-event\",{prototype:Object.create(i.prototype,{createdCallback:{value:function(){this.el=null,this.isAEvent=!0,this.name=\"\",this.targetEls=[]}},attachedCallback:{value:function(){var e=this.getAttribute(\"target\");this.el=this.parentNode,this.name=this.getAttribute(\"name\")||this.getAttribute(\"type\"),console.log(\"<a-event> has been DEPRECATED. Use https://github.com/ngokevin/aframe-event-set-component instead.\"),this.targetEls=e?this.el.sceneEl.querySelectorAll(e):[this.el],this.deprecated&&console.warn(\"<\"+this.tagName.toLowerCase()+'> has been DEPRECATED. Use <a-event name=\"'+this.name+'\"> instead.'),this.hasAttribute(\"type\")&&console.log(\"<a-event type> has been DEPRECATED. Use <a-event name> instead.\"),this.listener=this.attachEventListener(),this.load()}},detachedCallback:{value:function(){var e=this.listener;e&&this.removeEventListener(this.name,e)}},attachEventListener:{value:function(){var e=this.attributes,t=this.el,i=this.name,r=this.targetEls;return t.addEventListener(i,function(){for(var t,i,n,o,s=0;s<r.length;s++)for(var c=0;c<e.length;c++)t=e[c],i=t.name,n=t.value,o=r[s],\"target\"!==i&&a(o,i,n)})}}})})},{\"../../core/a-node\":55,\"../../core/a-register-element\":56,\"../../utils/\":117}],70:[function(e,t){t.exports=function(){return{defaultComponents:{material:{}},mappings:{color:\"material.color\",metalness:\"material.metalness\",opacity:\"material.opacity\",repeat:\"material.repeat\",roughness:\"material.roughness\",shader:\"material.shader\",side:\"material.side\",src:\"material.src\",transparent:\"material.transparent\"},transforms:{src:function(e){return\"#\"===e[0]?e:\"url(\"+e+\")\"}}}}},{}],71:[function(e){e(\"./primitives/a-camera\"),e(\"./primitives/a-collada-model\"),e(\"./primitives/a-cursor\"),e(\"./primitives/a-curvedimage\"),e(\"./primitives/a-image\"),e(\"./primitives/a-light\"),e(\"./primitives/a-obj-model\"),e(\"./primitives/a-sky\"),e(\"./primitives/a-sound\"),e(\"./primitives/a-video\"),e(\"./primitives/a-videosphere\"),e(\"./primitives/meshPrimitives\")},{\"./primitives/a-camera\":73,\"./primitives/a-collada-model\":74,\"./primitives/a-cursor\":75,\"./primitives/a-curvedimage\":76,\"./primitives/a-image\":77,\"./primitives/a-light\":78,\"./primitives/a-obj-model\":79,\"./primitives/a-sky\":80,\"./primitives/a-sound\":81,\"./primitives/a-video\":82,\"./primitives/a-videosphere\":83,\"./primitives/meshPrimitives\":84}],72:[function(e,t){var i=e(\"../../core/a-entity\"),r=e(\"../../core/component\").components,n=e(\"../../core/a-register-element\").registerElement,a=e(\"../../utils/\"),o=a.debug,s=a.entity.setComponentProperty,c=o(\"extras:primitives:debug\"),u=t.exports.primitives={};t.exports.registerPrimitive=function(e,t){e=e.toLowerCase(),c(\"Registering <%s>\",e),t.defaultAttributes&&console.warn(\"The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.\");var a=n(e,{prototype:Object.create(i.prototype,{defaultComponentsFromPrimitive:{value:t.defaultComponents||t.defaultAttributes||{}},deprecated:{value:t.deprecated||null},deprecatedMappings:{value:t.deprecatedMappings||{}},mappings:{value:t.mappings||{}},transforms:{value:t.transforms||{}},createdCallback:{value:function(){this.componentData={},t.deprecated&&console.warn(t.deprecated)}},attachedCallback:{value:function(){var e=this,t=this.attributes;this.applyDefaultComponents(),Object.keys(t).forEach(function(i){var r=t[i];e.syncAttributeToComponent(r.name,r.value)})}},attributeChangedCallback:{value:function(e,t,i){this.syncAttributeToComponent(e,i)}},applyDefaultComponents:{value:function(){var e=this,t=this.defaultComponentsFromPrimitive;Object.keys(t).forEach(function(i){var n=t[i];if(n instanceof Object){var a=r[i],o=e.getAttribute(i)||{},s=a.parse(o);return Object.keys(n).forEach(function(e){s[e]||(s[e]=n[e])}),e.setAttribute(i,s),void 0}e.setAttribute(i,n)})}},syncAttributeToComponent:{value:function(e,t){var i=this.mappings[e];e in this.deprecatedMappings&&console.warn(this.deprecatedMappings[e]),e&&i&&(t=this.getTransformedValue(e,t),s(this,i,t))}},getTransformedValue:{value:function(e,t){return this.transforms&&this.transforms[e]?this.transforms[e].bind(this)(t):t}}})});return u[e]=a,a}},{\"../../core/a-entity\":53,\"../../core/a-register-element\":56,\"../../core/component\":57,\"../../utils/\":117}],73:[function(e){var t=e(\"../primitives\").registerPrimitive;t(\"a-camera\",{defaultComponents:{camera:{},\"look-controls\":{},\"wasd-controls\":{}},mappings:{active:\"camera.active\",far:\"camera.far\",fov:\"camera.fov\",\"look-controls-enabled\":\"look-controls.enabled\",near:\"camera.near\",\"wasd-controls-enabled\":\"wasd-controls.enabled\",\"user-height\":\"camera.userHeight\",zoom:\"camera.zoom\"},deprecatedMappings:{\"cursor-color\":\"a-camera[cursor-color] has been removed. Use a-cursor[color] instead.\",\"cursor-maxdistance\":\"a-camera[cursor-maxdistance] has been removed. Use a-cursor[max-distance] instead.\",\"cursor-offset\":\"a-camera[cursor-offset] has been removed. Use a-cursor[position] instead.\",\"cursor-opacity\":\"a-camera[cursor-offset] has been removed. Use a-cursor[opacity] instead.\",\"cursor-scale\":\"a-camera[cursor-scale] has been removed. Use a-cursor[scale] instead.\",\"cursor-visible\":\"a-camera[cursor-visible] has been removed. Use a-cursor[visible] instead.\"}})},{\"../primitives\":72}],74:[function(e){var t=e(\"../getMeshMixin\"),i=e(\"../primitives\").registerPrimitive,r=e(\"../../../utils/\");i(\"a-collada-model\",r.extendDeep({},t(),{mappings:{src:\"collada-model\"}}))},{\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],75:[function(e){var t=e(\"../getMeshMixin\"),i=e(\"../primitives\").registerPrimitive,r=e(\"../../../utils/\");i(\"a-cursor\",r.extendDeep({},t(),{defaultComponents:{cursor:{},geometry:{primitive:\"ring\",radiusOuter:.016,radiusInner:.01,segmentsTheta:64},material:{color:\"#000\",shader:\"flat\",opacity:.8},position:{x:0,y:0,z:-1},raycaster:{far:1e3}},mappings:{far:\"raycaster.far\",fuse:\"cursor.fuse\",interval:\"raycaster.interval\",objects:\"raycaster.objects\",\"fuse-timeout\":\"cursor.fuseTimeout\"}}))},{\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],76:[function(e){var t=e(\"../getMeshMixin\"),i=e(\"../primitives\").registerPrimitive,r=e(\"../../../utils/\");i(\"a-curvedimage\",r.extendDeep({},t(),{defaultComponents:{geometry:{height:1,primitive:\"cylinder\",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:\"#FFF\",shader:\"flat\",side:\"double\",transparent:!0,repeat:\"-1 1\"}},mappings:{height:\"geometry.height\",\"open-ended\":\"geometry.openEnded\",radius:\"geometry.radius\",segments:\"geometry.segmentsRadial\",start:\"geometry.thetaStart\",\"theta-length\":\"geometry.thetaLength\",\"theta-start\":\"geometry.thetaStart\",width:\"geometry.thetaLength\"}}))},{\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],77:[function(e){var t=e(\"../getMeshMixin\"),i=e(\"../primitives\").registerPrimitive,r=e(\"../../../utils/\");i(\"a-image\",r.extendDeep({},t(),{defaultComponents:{geometry:{primitive:\"plane\"},material:{color:\"#FFF\",shader:\"flat\",side:\"double\",transparent:!0}},mappings:{height:\"geometry.height\",width:\"geometry.width\"}}))},{\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],78:[function(e){var t=e(\"../primitives\").registerPrimitive;t(\"a-light\",{defaultComponents:{light:{}},mappings:{angle:\"light.angle\",color:\"light.color\",\"ground-color\":\"light.groundColor\",decay:\"light.decay\",distance:\"light.distance\",intensity:\"light.intensity\",penumbra:\"light.penumbra\",type:\"light.type\"}})},{\"../primitives\":72}],79:[function(e){var t=e(\"../getMeshMixin\")(),i=e(\"../primitives\").registerPrimitive,r=e(\"../../../utils/\");i(\"a-obj-model\",r.extendDeep({},t,{mappings:{src:\"obj-model.obj\",mtl:\"obj-model.mtl\"},transforms:{mtl:t.transforms.src}}))},{\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],80:[function(e){var t=e(\"../getMeshMixin\"),i=e(\"../primitives\").registerPrimitive,r=e(\"../../../utils/\");i(\"a-sky\",r.extendDeep({},t(),{defaultComponents:{geometry:{primitive:\"sphere\",radius:5e3,segmentsWidth:64,segmentsHeight:20},material:{color:\"#FFF\",shader:\"flat\"},scale:\"-1 1 1\"},mappings:{radius:\"geometry.radius\",\"segments-width\":\"geometry.segmentsWidth\",\"segments-height\":\"geometry.segmentsHeight\"}}))},{\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],81:[function(e){var t=e(\"../primitives\").registerPrimitive;t(\"a-sound\",{defaultComponents:{sound:{}},mappings:{src:\"sound.src\",on:\"sound.on\",autoplay:\"sound.autoplay\",loop:\"sound.loop\",volume:\"sound.volume\"}})},{\"../primitives\":72}],82:[function(e){var t=e(\"../getMeshMixin\"),i=e(\"../primitives\").registerPrimitive,r=e(\"../../../utils/\");i(\"a-video\",r.extendDeep({},t(),{defaultComponents:{geometry:{primitive:\"plane\"},material:{color:\"#FFF\",shader:\"flat\",side:\"double\",transparent:!0}},mappings:{height:\"geometry.height\",width:\"geometry.width\"}}))},{\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],83:[function(e){var t=e(\"../getMeshMixin\"),i=e(\"../primitives\").registerPrimitive,r=e(\"../../../utils/\");i(\"a-videosphere\",r.extendDeep({},t(),{defaultComponents:{geometry:{primitive:\"sphere\",radius:5e3,segmentsWidth:64,segmentsHeight:20},material:{color:\"#FFF\",shader:\"flat\"},scale:\"-1 1 1\"},mappings:{radius:\"geometry.radius\",\"segments-height\":\"geometry.segmentsHeight\",\"segments-width\":\"geometry.segmentsWidth\"}}))},{\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],84:[function(e,t){function i(e){return e.replace(/([a-z])([A-Z])/g,\"$1-$2\").toLowerCase()}var r=e(\"../getMeshMixin\"),n=e(\"../../../core/geometry\").geometries,a=e(\"../../../core/geometry\").geometryNames,o=e(\"../primitives\").registerPrimitive,s=e(\"../../../utils/\"),c=t.exports={};a.forEach(function(e){var t=n[e],a=i(e),u={};Object.keys(t.schema).forEach(function(e){u[i(e)]=\"geometry.\"+e});var l=\"a-\"+a,h=o(l,s.extendDeep({},r(),{defaultComponents:{geometry:{primitive:e}},mappings:u}));c[l]=h})},{\"../../../core/geometry\":58,\"../../../utils/\":117,\"../getMeshMixin\":70,\"../primitives\":72}],85:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\");t(\"box\",{schema:{depth:{\"default\":1,min:0},height:{\"default\":1,min:0},width:{\"default\":1,min:0},segmentsHeight:{\"default\":1,min:1,max:20,type:\"int\"},segmentsWidth:{\"default\":1,min:1,max:20,type:\"int\"},segmentsDepth:{\"default\":1,min:1,max:20,type:\"int\"}},init:function(e){this.geometry=new i.BoxGeometry(e.width,e.height,e.depth)}})},{\"../core/geometry\":58,\"../lib/three\":101}],86:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\"),r=i.Math.degToRad;t(\"circle\",{schema:{radius:{\"default\":1,min:0},segments:{\"default\":32,min:3,type:\"int\"},thetaLength:{\"default\":360,min:0},thetaStart:{\"default\":0}},init:function(e){this.geometry=new i.CircleGeometry(e.radius,e.segments,r(e.thetaStart),r(e.thetaLength))}})},{\"../core/geometry\":58,\"../lib/three\":101}],87:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\"),r=i.Math.degToRad;t(\"cone\",{schema:{height:{\"default\":1,min:0},openEnded:{\"default\":!1},radiusBottom:{\"default\":1,min:0},radiusTop:{\"default\":.8,min:0},segmentsHeight:{\"default\":18,min:1,type:\"int\"},segmentsRadial:{\"default\":36,min:3,type:\"int\"},thetaLength:{\"default\":360,min:0},thetaStart:{\"default\":0}},init:function(e){this.geometry=new i.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.segmentsRadial,e.segmentsHeight,e.openEnded,r(e.thetaStart),r(e.thetaLength))}})},{\"../core/geometry\":58,\"../lib/three\":101}],88:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\"),r=i.Math.degToRad;t(\"cylinder\",{schema:{height:{\"default\":1,min:0},openEnded:{\"default\":!1},radius:{\"default\":1,min:0},segmentsHeight:{\"default\":18,min:1,type:\"int\"},segmentsRadial:{\"default\":36,min:3,type:\"int\"},thetaLength:{\"default\":360,min:0},thetaStart:{\"default\":0}},init:function(e){this.geometry=new i.CylinderGeometry(e.radius,e.radius,e.height,e.segmentsRadial,e.segmentsHeight,e.openEnded,r(e.thetaStart),r(e.thetaLength))}})},{\"../core/geometry\":58,\"../lib/three\":101}],89:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\");t(\"dodecahedron\",{schema:{detail:{\"default\":0,min:0,max:5,type:\"int\"},radius:{\"default\":1,min:0}},init:function(e){this.geometry=new i.DodecahedronGeometry(e.radius,e.detail)}})},{\"../core/geometry\":58,\"../lib/three\":101}],90:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\");t(\"icosahedron\",{schema:{detail:{\"default\":0,min:0,max:5,type:\"int\"},radius:{\"default\":1,min:0}},init:function(e){this.geometry=new i.IcosahedronGeometry(e.radius,e.detail)}})},{\"../core/geometry\":58,\"../lib/three\":101}],91:[function(e){e(\"./box.js\"),e(\"./circle.js\"),e(\"./cone.js\"),e(\"./cylinder.js\"),e(\"./dodecahedron.js\"),e(\"./icosahedron.js\"),e(\"./octahedron.js\"),e(\"./plane.js\"),e(\"./ring.js\"),e(\"./sphere.js\"),e(\"./tetrahedron.js\"),e(\"./torus.js\"),e(\"./torusKnot.js\")},{\"./box.js\":85,\"./circle.js\":86,\"./cone.js\":87,\"./cylinder.js\":88,\"./dodecahedron.js\":89,\"./icosahedron.js\":90,\"./octahedron.js\":92,\"./plane.js\":93,\"./ring.js\":94,\"./sphere.js\":95,\"./tetrahedron.js\":96,\"./torus.js\":97,\"./torusKnot.js\":98}],92:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\");t(\"octahedron\",{schema:{detail:{\"default\":0,min:0,max:5,type:\"int\"},radius:{\"default\":1,min:0}},init:function(e){this.geometry=new i.OctahedronGeometry(e.radius,e.detail)}})},{\"../core/geometry\":58,\"../lib/three\":101}],93:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\");t(\"plane\",{schema:{height:{\"default\":1,min:0},width:{\"default\":1,min:0},segmentsHeight:{\"default\":1,min:1,max:20,type:\"int\"},segmentsWidth:{\"default\":1,min:1,max:20,type:\"int\"}},init:function(e){this.geometry=new i.PlaneGeometry(e.width,e.height)}})},{\"../core/geometry\":58,\"../lib/three\":101}],94:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\"),r=i.Math.degToRad;t(\"ring\",{schema:{radiusInner:{\"default\":.8,min:0},radiusOuter:{\"default\":1.2,min:0},segmentsPhi:{\"default\":10,min:1,type:\"int\"},segmentsTheta:{\"default\":32,min:3,type:\"int\"},thetaLength:{\"default\":360,min:0},thetaStart:{\"default\":0}},init:function(e){this.geometry=new i.RingGeometry(e.radiusInner,e.radiusOuter,e.segmentsTheta,e.segmentsPhi,r(e.thetaStart),r(e.thetaLength))}})},{\"../core/geometry\":58,\"../lib/three\":101}],95:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\"),r=i.Math.degToRad;t(\"sphere\",{schema:{radius:{\"default\":1,min:0},phiLength:{\"default\":360},phiStart:{\"default\":0,min:0},thetaLength:{\"default\":180,min:0},thetaStart:{\"default\":0},segmentsHeight:{\"default\":18,min:2,type:\"int\"},segmentsWidth:{\"default\":36,min:3,type:\"int\"}},init:function(e){this.geometry=new i.SphereGeometry(e.radius,e.segmentsWidth,e.segmentsHeight,r(e.phiStart),r(e.phiLength),r(e.thetaStart),r(e.thetaLength))}})},{\"../core/geometry\":58,\"../lib/three\":101}],96:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\");t(\"tetrahedron\",{schema:{detail:{\"default\":0,min:0,max:5,type:\"int\"},radius:{\"default\":1,min:0}},init:function(e){this.geometry=new i.TetrahedronGeometry(e.radius,e.detail)}})},{\"../core/geometry\":58,\"../lib/three\":101}],97:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\"),r=i.Math.degToRad;t(\"torus\",{schema:{arc:{\"default\":360},radius:{\"default\":1,min:0},radiusTubular:{\"default\":.2,min:0},segmentsRadial:{\"default\":36,min:2,type:\"int\"},segmentsTubular:{\"default\":32,min:3,type:\"int\"}},init:function(e){this.geometry=new i.TorusGeometry(e.radius,2*e.radiusTubular,e.segmentsRadial,e.segmentsTubular,r(e.arc))}})},{\"../core/geometry\":58,\"../lib/three\":101}],98:[function(e){var t=e(\"../core/geometry\").registerGeometry,i=e(\"../lib/three\");t(\"torusKnot\",{schema:{p:{\"default\":2,min:1,type:\"int\"},q:{\"default\":3,min:1,type:\"int\"},radius:{\"default\":1,min:0},radiusTubular:{\"default\":.2,min:0},segmentsRadial:{\"default\":36,min:3,type:\"int\"},segmentsTubular:{\"default\":100,min:3,type:\"int\"}},init:function(e){this.geometry=new i.TorusKnotGeometry(e.radius,2*e.radiusTubular,e.segmentsTubular,e.segmentsRadial,e.p,e.q)}})},{\"../core/geometry\":58,\"../lib/three\":101}],99:[function(e,t){window.Promise=window.Promise||e(\"promise-polyfill\"),window.hasNativeWebVRImplementation=!!navigator.getVRDisplays||!!navigator.getVRDevices,window.WebVRConfig=window.WebVRConfig||{CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,TOUCH_PANNER_DISABLED:!0,MOUSE_KEYBOARD_CONTROLS_DISABLED:!0},e(\"webvr-polyfill\"),e(\"present\"),e(\"./style/aframe.css\"),e(\"./style/rStats.css\");var i=e(\"./core/scene/a-scene\"),r=e(\"./core/component\").components,n=e(\"./core/component\").registerComponent,a=e(\"./core/geometry\").registerGeometry,o=e(\"./extras/primitives/primitives\").registerPrimitive,s=e(\"./core/shader\").registerShader,c=e(\"./core/system\").registerSystem,u=e(\"./core/shader\").shaders,l=e(\"./core/system\").systems,h=window.THREE=e(\"./lib/three\"),d=window.TWEEN=e(\"tween.js\"),p=e(\"../package\"),f=e(\"./utils/\");e(\"./components/index\"),e(\"./geometries/index\"),e(\"./shaders/index\"),e(\"./systems/index\");var m=e(\"./core/a-node\"),g=e(\"./core/a-entity\");e(\"./core/a-animation\"),e(\"./core/a-assets\"),e(\"./core/a-cubemap\"),e(\"./core/a-mixin\"),e(\"./extras/components/\"),e(\"./extras/declarative-events/\"),e(\"./extras/primitives/\"),console.log(\"A-Frame Version:\",p.version),console.log(\"three Version:\",p.dependencies.three),console.log(\"WebVR Polyfill Version:\",p.dependencies[\"webvr-polyfill\"]),t.exports=window.AFRAME={AEntity:g,ANode:m,AScene:i,components:r,geometries:e(\"./core/geometry\").geometries,registerComponent:n,registerElement:e(\"./core/a-register-element\").registerElement,registerGeometry:a,registerPrimitive:o,registerShader:s,registerSystem:c,primitives:{getMeshMixin:e(\"./extras/primitives/getMeshMixin\"),primitives:e(\"./extras/primitives/primitives\").primitives},schema:e(\"./core/schema\"),shaders:u,systems:l,THREE:h,TWEEN:d,utils:f,version:p.version}},{\"../package\":20,\"./components/index\":27,\"./core/a-animation\":50,\"./core/a-assets\":51,\"./core/a-cubemap\":52,\"./core/a-entity\":53,\"./core/a-mixin\":54,\"./core/a-node\":55,\"./core/a-register-element\":56,\"./core/component\":57,\"./core/geometry\":58,\"./core/scene/a-scene\":60,\"./core/schema\":64,\"./core/shader\":65,\"./core/system\":66,\"./extras/components/\":67,\"./extras/declarative-events/\":69,\"./extras/primitives/\":71,\"./extras/primitives/getMeshMixin\":70,\"./extras/primitives/primitives\":72,\"./geometries/index\":91,\"./lib/three\":101,\"./shaders/index\":103,\"./style/aframe.css\":105,\"./style/rStats.css\":106,\"./systems/index\":109,\"./utils/\":117,present:9,\"promise-polyfill\":11,\"tween.js\":18,\"webvr-polyfill\":19}],100:[function(e,t){window.aframeStats=function(e){function t(){a(\"te\").set(o.querySelectorAll(\"a-entity\").length),a(\"lt\").set(window.performance.getEntriesByName(\"render-started\")[0].startTime.toFixed(0))}function i(){}function r(){}function n(e){a=e\n}var a=null,o=e,s={te:{caption:\"Entities\"},lt:{caption:\"Load Time\"}},c=[{caption:\"A-Frame\",values:[\"te\",\"lt\"]}];return{update:t,start:i,end:r,attach:n,values:s,groups:c,fractions:[]}},\"object\"==typeof t&&(t.exports={aframeStats:window.aframeStats})},{}],101:[function(e,t){(function(i){var r=i.THREE=e(\"three\");r.TextureLoader&&(r.TextureLoader.prototype.crossOrigin=\"anonymous\"),r.ImageLoader&&(r.ImageLoader.prototype.crossOrigin=\"anonymous\"),r.Cache&&(r.Cache.enabled=!0),e(\"three/examples/js/loaders/OBJLoader\"),e(\"three/examples/js/loaders/MTLLoader\"),e(\"three/examples/js/BlendCharacter\"),e(\"three/examples/js/loaders/ColladaLoader\"),e(\"../../vendor/VRControls\"),e(\"../../vendor/VREffect\"),r.ColladaLoader.prototype.crossOrigin=\"anonymous\",r.MTLLoader.prototype.crossOrigin=\"anonymous\",r.OBJLoader.prototype.crossOrigin=\"anonymous\",t.exports=r}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../../vendor/VRControls\":121,\"../../vendor/VREffect\":122,three:17,\"three/examples/js/BlendCharacter\":13,\"three/examples/js/loaders/ColladaLoader\":14,\"three/examples/js/loaders/MTLLoader\":15,\"three/examples/js/loaders/OBJLoader\":16}],102:[function(e,t){function i(e){return{fog:e.fog,color:new n.Color(e.color)}}var r=e(\"../core/shader\").registerShader,n=e(\"../lib/three\"),a=e(\"../utils/\");t.exports.Component=r(\"flat\",{schema:{color:{type:\"color\"},fog:{\"default\":!0},height:{\"default\":256},repeat:{\"default\":\"\"},src:{\"default\":\"\"},width:{\"default\":512}},init:function(e){this.textureSrc=null,this.material=new n.MeshBasicMaterial(i(e)),a.material.updateMap(this,e)},update:function(e){this.updateMaterial(e),a.material.updateMap(this,e)},updateMaterial:function(e){var t=this.material;e=i(e),Object.keys(e).forEach(function(i){t[i]=e[i]})}})},{\"../core/shader\":65,\"../lib/three\":101,\"../utils/\":117}],103:[function(e){e(\"./flat\"),e(\"./standard\")},{\"./flat\":102,\"./standard\":104}],104:[function(e,t){function i(e){return{color:new n.Color(e.color),fog:e.fog,metalness:e.metalness,roughness:e.roughness}}var r=e(\"../core/shader\").registerShader,n=e(\"../lib/three\"),a=e(\"../utils/\"),o=new n.CubeTextureLoader,s={};t.exports.Component=r(\"standard\",{schema:{color:{type:\"color\"},envMap:{\"default\":\"\"},fog:{\"default\":!0},height:{\"default\":256},metalness:{\"default\":0,min:0,max:1},repeat:{\"default\":\"\"},roughness:{\"default\":.5,min:0,max:1},src:{\"default\":\"\"},width:{\"default\":512}},init:function(e){this.material=new n.MeshStandardMaterial(i(e)),a.material.updateMap(this,e),this.updateEnvMap(e)},update:function(e){this.updateMaterial(e),a.material.updateMap(this,e),this.updateEnvMap(e)},updateMaterial:function(e){var t=this.material;e=i(e),Object.keys(e).forEach(function(i){t[i]=e[i]})},updateEnvMap:function(e){var t=this,i=this.material,r=e.envMap;return!r||this.isLoadingEnvMap?(i.envMap=null,i.needsUpdate=!0,void 0):(this.isLoadingEnvMap=!0,s[r]?(s[r].then(function(e){t.isLoadingEnvMap=!1,i.envMap=e,i.needsUpdate=!0}),void 0):(s[r]=new Promise(function(e){a.srcLoader.validateCubemapSrc(r,function(r){o.load(r,function(r){t.isLoadingEnvMap=!1,i.envMap=r,e(r)})})}),void 0))}})},{\"../core/shader\":65,\"../lib/three\":101,\"../utils/\":117}],105:[function(e,t){var i=\".a-html{bottom:0;left:0;position:fixed;right:0;top:0}.a-body{height:100%;margin:0;overflow:hidden;padding:0;width:100%}:-webkit-full-screen{background-color:transparent}.a-hidden{display:none!important}.a-canvas{height:100%;left:0;position:absolute;top:0;width:100%}.a-canvas.a-grab-cursor:hover{cursor:grab;cursor:-moz-grabbing;cursor:-webkit-grab}.a-canvas.a-grab-cursor:active,.a-grabbing{cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.a-canvas.fullscreen{width:100%!important;height:100%!important;top:0!important;left:0!important;right:0!important;bottom:0!important;z-index:999999!important;position:fixed}a-scene{display:block;position:relative;height:100%;width:100%}a-assets,a-scene audio,a-scene img,a-scene video{display:none}.a-enter-vr-modal,.a-orientation-modal{font-family:Consolas,Andale Mono,Courier New,monospace}.a-enter-vr-modal a{border-bottom:1px solid #fff;padding:2px 0;text-decoration:none;transition:.1s color ease-in}.a-enter-vr-modal a:hover{background-color:#fff;color:#111;padding:2px 4px;position:relative;left:-4px}.a-enter-vr{font-family:sans-serif,monospace;font-size:13px;width:100%;font-weight:200;line-height:16px;height:10%;position:absolute;right:20px;bottom:20px}.a-enter-vr.embedded{right:5px;bottom:5px}.a-enter-vr-button,.a-enter-vr-modal,.a-enter-vr-modal a{color:#fff}.a-enter-vr-button{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20245.82%20141.73%22%3E%3Cdefs%3E%3Cstyle%3E.a%7Bfill%3A%23fff%3Bfill-rule%3Aevenodd%3B%7D%3C%2Fstyle%3E%3C%2Fdefs%3E%3Ctitle%3Emask%3C%2Ftitle%3E%3Cpath%20class%3D%22a%22%20d%3D%22M175.56%2C111.37c-22.52%2C0-40.77-18.84-40.77-42.07S153%2C27.24%2C175.56%2C27.24s40.77%2C18.84%2C40.77%2C42.07S198.08%2C111.37%2C175.56%2C111.37ZM26.84%2C69.31c0-23.23%2C18.25-42.07%2C40.77-42.07s40.77%2C18.84%2C40.77%2C42.07-18.26%2C42.07-40.77%2C42.07S26.84%2C92.54%2C26.84%2C69.31ZM27.27%2C0C11.54%2C0%2C0%2C12.34%2C0%2C28.58V110.9c0%2C16.24%2C11.54%2C30.83%2C27.27%2C30.83H99.57c2.17%2C0%2C4.19-1.83%2C5.4-3.7L116.47%2C118a8%2C8%2C0%2C0%2C1%2C12.52-.18l11.51%2C20.34c1.2%2C1.86%2C3.22%2C3.61%2C5.39%2C3.61h72.29c15.74%2C0%2C27.63-14.6%2C27.63-30.83V28.58C245.82%2C12.34%2C233.93%2C0%2C218.19%2C0H27.27Z%22%2F%3E%3C%2Fsvg%3E) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);border:0;bottom:0;cursor:pointer;min-width:50px;min-height:30px;padding-right:5%;padding-top:4%;position:absolute;right:0;transition:background-color .05s ease;-webkit-transition:background-color .05s ease;z-index:9999}.a-enter-vr-button.fullscreen{background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZpZXdCb3g9IjAgMCAxNiAxNiI+CjxwYXRoIGZpbGw9IiNmZmZmZmYiIGQ9Ik0xNiAwaC02LjVsMi41IDIuNS0zIDMgMS41IDEuNSAzLTMgMi41IDIuNXoiPjwvcGF0aD4KPHBhdGggZmlsbD0iI2ZmZmZmZiIgZD0iTTE2IDE2di02LjVsLTIuNSAyLjUtMy0zLTEuNSAxLjUgMyAzLTIuNSAyLjV6Ij48L3BhdGg+CjxwYXRoIGZpbGw9IiNmZmZmZmYiIGQ9Ik0wIDE2aDYuNWwtMi41LTIuNSAzLTMtMS41LTEuNS0zIDMtMi41LTIuNXoiPjwvcGF0aD4KPHBhdGggZmlsbD0iI2ZmZmZmZiIgZD0iTTAgMHY2LjVsMi41LTIuNSAzIDMgMS41LTEuNS0zLTMgMi41LTIuNXoiPjwvcGF0aD4KPC9zdmc+Cg==) 50% 50%/60% 60% no-repeat rgba(0,0,0,.35);min-width:45px;min-height:45px}.a-enter-vr-button:active,.a-enter-vr-button:hover{background-color:#666}[data-a-enter-vr-no-webvr] .a-enter-vr-button{border-color:#666;opacity:.65}[data-a-enter-vr-no-webvr] .a-enter-vr-button:active,[data-a-enter-vr-no-webvr] .a-enter-vr-button:hover{background-color:rgba(0,0,0,.35);cursor:not-allowed}.a-enter-vr-modal{background-color:#666;border-radius:0;display:none;min-height:32px;margin-right:70px;padding:9px;width:280px;right:2%;position:absolute}.a-enter-vr-modal:after{border-bottom:10px solid transparent;border-left:10px solid #666;border-top:10px solid transparent;display:inline-block;content:'';position:absolute;right:-5px;top:5px;width:0;height:0}.a-enter-vr-modal a,.a-enter-vr-modal p{display:inline}.a-enter-vr-modal p{margin:0}.a-enter-vr-modal p:after{content:' '}[data-a-enter-vr-no-headset].a-enter-vr:hover .a-enter-vr-modal,[data-a-enter-vr-no-webvr].a-enter-vr:hover .a-enter-vr-modal{display:block}.a-orientation-modal{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center/50% 50% no-repeat rgba(244,244,244,1);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-orientation-modal:after{color:#666;content:\\\"Insert phone into Cardboard holder.\\\";display:block;position:absolute;text-align:center;top:70%;transform:translateY(-70%);width:100%}.a-orientation-modal button{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;border:none;height:50px;text-indent:-9999px;width:50px}\";e(\"browserify-css\").createStyle(i,{href:\"src/style/aframe.css\"}),t.exports=i},{\"browserify-css\":1}],106:[function(e,t){var i=\".rs-base{background-color:#333;border-radius:0;font:10px monospace;left:5px;line-height:1em;opacity:.85;overflow:hidden;padding:10px;position:fixed;top:5px;width:300px;z-index:10000}.rs-base div.hidden{display:none}.rs-base h1{color:#fff;cursor:pointer;font-size:1.4em;font-weight:300;margin:0 0 5px;padding:0}.rs-group{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-direction:column-reverse;flex-direction:column-reverse;margin-bottom:5px}.rs-group:last-child{margin-bottom:0}.rs-counter-base{align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;height:10px;-webkit-justify-content:space-between;justify-content:space-between;margin:2px 0}.rs-counter-id{font-weight:300;-webkit-box-ordinal-group:0;-webkit-order:0;order:0;width:54px}.rs-counter-value{font-weight:300;-webkit-box-ordinal-group:1;-webkit-order:1;order:1;text-align:right;width:35px}.rs-canvas{-webkit-box-ordinal-group:2;-webkit-order:2;order:2}@media (min-width:480px){.rs-base{left:20px;top:20px}}\";e(\"browserify-css\").createStyle(i,{href:\"src/style/rStats.css\"}),t.exports=i},{\"browserify-css\":1}],107:[function(e,t){function i(e){var t,i=e.camera;i&&(t=e.querySelector(\"[\"+n+\"]\"),t&&e.removeChild(t))}var r=e(\"../core/system\").registerSystem,n=\"data-aframe-default-camera\",a=1.8;t.exports.System=r(\"camera\",{init:function(){this.activeCameraEl=null,this.setupDefaultCamera()},setupDefaultCamera:function(){function e(){var e=r.camera;return e?(r.emit(\"camera-ready\",{cameraEl:e.el}),void 0):(t=document.createElement(\"a-entity\"),t.setAttribute(\"position\",\"0 0 0\"),t.setAttribute(n,\"\"),t.setAttribute(\"camera\",{active:!0,userHeight:a}),t.setAttribute(\"wasd-controls\",\"\"),t.setAttribute(\"look-controls\",\"\"),r.appendChild(t),r.addEventListener(\"enter-vr\",i.removeDefaultOffset),r.addEventListener(\"exit-vr\",i.addDefaultOffset),r.emit(\"camera-ready\",{cameraEl:t}),void 0)}var t,i=this,r=this.sceneEl;setTimeout(e)},disableActiveCamera:function(){var e=this.sceneEl.querySelectorAll(\"[camera]\"),t=e[e.length-1];t.setAttribute(\"camera\",\"active\",!0)},setActiveCamera:function(e){var t,r,a=this.sceneEl.querySelectorAll(\"[camera]\"),o=this.sceneEl,s=e.getObject3D(\"camera\"),c=this.activeCameraEl;if(s&&e!==this.activeCameraEl){var u=o.querySelector(\"[\"+n+\"]\"),l=u&&u.querySelector(\"[camera]\");for(e!==l&&i(o),this.activeCameraEl=e,this.activeCameraEl.play(),o.camera=s,c&&c.setAttribute(\"camera\",\"active\",!1),r=0;r<a.length;r++)t=a[r],e!==t&&(t.setAttribute(\"camera\",\"active\",!1),t.pause());o.emit(\"camera-set-active\",{cameraEl:e})}}})},{\"../core/system\":66}],108:[function(e,t){function i(e){var t=e.primitive,i=o[t]&&o[t].Geometry,r=new i;if(!i)throw new Error(\"Unknown geometry `\"+t+\"`\");return r.init(e),a(r.geometry,e.buffer)}function r(e,t){e[t]--}function n(e,t){e[t]=void 0===e[t]?1:e[t]+1}function a(e,t){var i;return t?(i=(new c.BufferGeometry).fromGeometry(e),i.metadata={type:e.type,parameters:e.parameters||{}},e.dispose(),i):e}var o=e(\"../core/geometry\").geometries,s=e(\"../core/system\").registerSystem,c=e(\"../lib/three\");t.exports.System=s(\"geometry\",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(e){var t,r,a=this.cache;return e.skipCache?i(e):(r=this.hash(e),t=a[r],n(this.cacheCount,r),t?t:(t=i(e),a[r]=t,t))},unuseGeometry:function(e){var t,i,n=this.cache,a=this.cacheCount;e.skipCache||(i=this.hash(e),n[i]&&(r(a,i),a[i]>0||(t=n[i],t.dispose(),delete n[i],delete a[i])))},hash:function(e){return JSON.stringify(e)}})},{\"../core/geometry\":58,\"../core/system\":66,\"../lib/three\":101}],109:[function(e){e(\"./camera\"),e(\"./geometry\"),e(\"./light\"),e(\"./material\"),e(\"./tracked-controls\")},{\"./camera\":107,\"./geometry\":108,\"./light\":110,\"./material\":111,\"./tracked-controls\":112}],110:[function(e,t){var i=e(\"../core/system\").registerSystem,r=\"data-aframe-default-light\";t.exports.System=i(\"light\",{init:function(){this.defaultLightsEnabled=null,this.setupDefaultLights()},registerLight:function(e){var t,i=this.sceneEl;if(this.defaultLightsEnabled&&!e.hasAttribute(r)){t=document.querySelectorAll(\"[\"+r+\"]\");for(var n=0;n<t.length;n++)i.removeChild(t[n]);this.defaultLightsEnabled=!1}},setupDefaultLights:function(){var e=this.sceneEl,t=document.createElement(\"a-entity\"),i=document.createElement(\"a-entity\");t.setAttribute(\"light\",{color:\"#BBB\",type:\"ambient\"}),t.setAttribute(r,\"\"),e.appendChild(t),i.setAttribute(\"light\",{color:\"#FFF\",intensity:.6}),i.setAttribute(\"position\",{x:-.5,y:1,z:1}),i.setAttribute(r,\"\"),e.appendChild(i),this.defaultLightsEnabled=!0}})},{\"../core/system\":66}],111:[function(e,t){function i(e,t){var i,r,n,a=t.getAttribute(\"id\");if(a)return a;for(r=\"\",n=e||{},i=0;i<t.attributes.length;i++)n[t.attributes[i].name]=t.attributes[i].value;return Object.keys(n).sort().forEach(function(e){r+=e+\":\"+n[e]+\";\"}),r}function r(e,t){function i(i){function r(e){n(e,t),e.needsUpdate=!0,i(e)}var a=\"string\"!=typeof e;return a?(r(new c.Texture(e)),void 0):(d.load(e,r,function(){},function(e){h(\"`$s` could not be fetched (Error code: %s; Response: %s)\",e.status,e.statusText)}),void 0)}return new Promise(i)}function n(e,t){var i=t.repeat||\"1 1\",r=i.split(\" \");\"1 1\"!==i&&2===r.length&&(e.wrapS=c.RepeatWrapping,e.wrapT=c.RepeatWrapping,e.repeat.set(parseFloat(r[0]),parseFloat(r[1])))}function a(e,t,i){var r=document.createElement(\"video\");return r.width=t,r.height=i,r.setAttribute(\"webkit-playsinline\",\"\"),r.autoplay=!0,r.loop=!0,r.crossOrigin=\"anonymous\",r.addEventListener(\"error\",function(){p(\"`$s` is not a valid video\",e)},!0),r.src=e,r}function o(e){return e.autoplay=\"false\"!==e.getAttribute(\"autoplay\"),e.controls=\"false\"!==e.getAttribute(\"controls\"),\"false\"===e.getAttribute(\"loop\")&&e.removeAttribute(\"loop\"),\"false\"===e.getAttribute(\"preload\")&&(e.preload=\"none\"),e.crossOrigin=e.crossOrigin||\"anonymous\",e.setAttribute(\"webkit-playsinline\",\"\"),e}var s=e(\"../core/system\").registerSystem,c=e(\"../lib/three\"),u=e(\"../utils/\"),l=u.debug,h=l(\"components:texture:error\"),d=new c.TextureLoader,p=l(\"components:texture:warn\");t.exports.System=s(\"material\",{init:function(){this.materials={},this.textureCache={}},clearTextureCache:function(){this.textureCache={}},loadTexture:function(e,t,i){function r(e){o.loadImage(e,t,i)}function n(e){o.loadVideo(e,t,i)}function a(e){o.loadCanvas(e,t,i)}var o=this;u.srcLoader.validateSrc(e,r,n,a)},loadImage:function(e,t,i){var n=this.hash(t),a=i,o=this.textureCache;return o[n]?(o[n].then(a),void 0):(o[n]=r(e,t),o[n].then(a),void 0)},loadCanvas:function(e,t,i){e.readyState=2,e.HAVE_CURRENT_DATA=2,this.loadVideo(e,t,i)},loadVideo:function(e,t,i){function r(e){e.texture.needsUpdate=!0,i(e.texture,e.videoEl)}var s,u,l,h,d=this.textureCache;if(\"string\"!=typeof e){if(l=e,s=this.hashVideo(t,l),d[s])return d[s].then(r),void 0;o(l)}return l=l||a(e,t.width,t.height),s=this.hashVideo(t,l),d[s]?(d[s].then(r),void 0):(u=new c.VideoTexture(l),u.minFilter=c.LinearFilter,n(u,t),h={texture:u,videoEl:l},d[s]=Promise.resolve(h),r(h),void 0)},hash:function(e){return JSON.stringify(e)},hashVideo:function(e,t){return i(e,t)},registerMaterial:function(e){this.materials[e.uuid]=e},unregisterMaterial:function(e){delete this.materials[e.uuid]},updateMaterials:function(){var e=this.materials;Object.keys(e).forEach(function(t){e[t].needsUpdate=!0})}})},{\"../core/system\":66,\"../lib/three\":101,\"../utils/\":117}],112:[function(e,t){var i=e(\"../core/system\").registerSystem;t.exports.System=i(\"tracked-controls\",{init:function(){var e=this;this.controllers=[],navigator.getVRDisplays&&navigator.getVRDisplays().then(function(t){t.length>0&&(e.vrDisplay=t[0])})},tick:function(){var e,t,i=navigator.getGamepads&&navigator.getGamepads(),r=this.controllers=[];if(i)for(t=0;t<i.length;++t)e=i[t],e&&e.pose&&r.push(e)}})},{\"../core/system\":66}],113:[function(e,t){var i=e(\"../lib/three\"),r=new i.Object3D,n=new i.VRControls(r);t.exports=function(){var e;return n.update(),e=r.quaternion,0!==e._x||0!==e._y||0!==e._z?!0:void 0}},{\"../lib/three\":101}],114:[function(e,t){function i(e,t){var i,r={};return e&&\"object\"==typeof e?n(e):\"string\"!=typeof e||null===e?t:(i=e.trim().replace(/\\s+/g,\" \").split(\" \"),r.x=i[0]||t&&t.x,r.y=i[1]||t&&t.y,r.z=i[2]||t&&t.z,r.w=i[3]||t&&t.w,n(r))}function r(e){return\"object\"!=typeof e?e:[e.x,e.y,e.z,e.w].join(\" \").trim()}function n(e){return Object.keys(e).forEach(function(t){return void 0===e[t]?(delete e[t],void 0):(e[t]=parseFloat(e[t],10),void 0)}),e}var a=/\\s*(-?\\d*\\.{0,1}\\d+)\\s+(-?\\d*\\.{0,1}\\d+)\\s+(-?\\d*\\.{0,1}\\d+)\\s*/;t.exports.regex=a,t.exports.parse=i,t.exports.stringify=r,t.exports.isCoordinate=function(e){return a.test(e)},t.exports.toVector3=function(e){return new THREE.Vector3(e.x,e.y,e.z)}},{}],115:[function(e,t){(function(i){function r(e){var t=e.split(\":\");return t[t.length-1]}function n(e){var t=r(e),i=c.colors&&c.colors[t];return i||null}function a(){try{return window.localStorage}catch(e){}}var o=e(\"debug\"),s=e(\"object-assign\"),c={colors:{debug:\"gray\",error:\"red\",info:\"gray\",warn:\"orange\"}},u=function(e){var t=o(e);return t.color=n(e),t};s(u,o);var l=a();l&&(parseInt(l.logs,10)||\"true\"===l.logs)?u.enable(\"*\"):u.enable(\"*:error,*:info,*:warn\"),i.browser&&(window.logs=u),t.exports=u}).call(this,e(\"_process\"))},{_process:10,debug:2,\"object-assign\":8}],116:[function(e,t){t.exports.getComponentProperty=function(e,t,i){var r;return i=i||\".\",-1!==t.indexOf(i)?(r=t.split(i),e.getComputedAttribute(r[0])[r[1]]):e.getComputedAttribute(t)},t.exports.setComponentProperty=function(e,t,i,r){var n;return r=r||\".\",-1!==t.indexOf(r)?(n=t.split(r),e.setAttribute(n[0],n[1],i),void 0):(e.setAttribute(t,i),void 0)}},{}],117:[function(e,t){function i(e,t){var i,r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;if(0===r.length)return e===t;for(i=0;i<r.length;++i)if(e[r[i]]!==t[r[i]])return!1;return!0}var r=e(\"deep-assign\"),n=e(\"object-assign\");t.exports.coordinates=e(\"./coordinates\"),t.exports.checkHeadsetConnected=e(\"./checkHeadsetConnected\"),t.exports.debug=e(\"./debug\"),t.exports.entity=e(\"./entity\"),t.exports.material=e(\"./material\"),t.exports.styleParser=e(\"./styleParser\"),t.exports.fireEvent=function(e,t,i){i=i||{},i.detail=i.detail||{},i.detail.target=i.detail.target||e;var r=new CustomEvent(t,i);r.target=e,e.dispatchEvent(r)},t.exports.extend=n,t.exports.extendDeep=r,t.exports.deepEqual=i,t.exports.diff=function(e,t){var r={},n=Object.keys(e);return Object.keys(t).forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n.forEach(function(n){var a=e[n],o=t[n],s=a&&o&&a.constructor===Object&&o.constructor===Object;(s&&!i(a,o)||!s&&a!==o)&&(r[n]=o)}),r},t.exports.isMobile=function(){var e=!1;return function(t){(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(t.substr(0,4)))&&(e=!0),a()&&(e=!0),o()&&(e=!1)}(navigator.userAgent||navigator.vendor||window.opera),e};var a=t.exports.isIOS=function(){return/iPad|iPhone|iPod/.test(navigator.platform)},o=t.exports.isGearVR=function(){return/SamsungBrowser.+Mobile VR/i.test(navigator.userAgent)};t.exports.isLandscape=function(){return 90===window.orientation||-90===window.orientation},t.exports.shouldCaptureKeyEvent=function(e){return e.shiftKey||e.metaKey||e.altKey||e.ctrlKey?!1:document.activeElement===document.body},t.exports.splitString=function(e,t){\"undefined\"==typeof t&&(t=\" \");var i=new RegExp(t,\"g\");return e=(e||\"\").replace(i,t),e.split(t)},t.exports.getElData=function(e,t){function i(t){e.hasAttribute(t)&&(r[t]=e.getAttribute(t))}t=t||{};var r={};return Object.keys(t).forEach(i),r},t.exports.getUrlParameter=function(e){e=e.replace(/[\\[]/,\"\\\\[\").replace(/[\\]]/,\"\\\\]\");var t=new RegExp(\"[\\\\?&]\"+e+\"=([^&#]*)\"),i=t.exec(location.search);return null===i?\"\":decodeURIComponent(i[1].replace(/\\+/g,\" \"))},t.exports.isIframed=function(){return window.top!==window.self},t.exports.findAllScenes=function(e){for(var t=[],i=e.getElementsByTagName(\"*\"),r=0,n=i.length;n>r;r++)i[r].isScene&&t.push(i[r]);return t},t.exports.srcLoader=e(\"./src-loader\")},{\"./checkHeadsetConnected\":113,\"./coordinates\":114,\"./debug\":115,\"./entity\":116,\"./material\":118,\"./src-loader\":119,\"./styleParser\":120,\"deep-assign\":4,\"object-assign\":8}],118:[function(e,t){function i(e,t){t&&(e.emit(\"materialtextureloaded\",{src:t.image,texture:t}),\"VIDEO\"===t.image.tagName&&(t.image.addEventListener(\"loadeddata\",function(){e.emit(\"materialvideoloadeddata\",{src:t.image,texture:t})}),t.image.addEventListener(\"ended\",function(){e.emit(\"materialvideoended\",{src:t.image,texture:t})})))}t.exports.updateMap=function(e,t){function r(e){a.map=e,a.needsUpdate=!0,i(n,e)}var n=e.el,a=e.material,o=t.src;if(o){if(o===e.textureSrc)return;return e.textureSrc=o,n.sceneEl.systems.material.loadTexture(o,{src:o,repeat:t.repeat},r),void 0}a.map&&r(null)},t.exports.handleTextureEvents=i},{}],119:[function(e,t){function i(e,t,i,r){var s,u,l,h,d=n(e);return d?(a(d,function(e){return e?(t(d),void 0):(i(d),void 0)}),void 0):(s=o(e))?(u=s&&\"IMG\"===s.tagName,l=s&&\"VIDEO\"===s.tagName,h=s&&\"CANVAS\"===s.tagName,u?t(s):l?i(s):h?r(s):(c('\"%s\" does not point to a valid <img>, <video>, or <canvas> element',e),void 0)):void 0}function r(e,t){function r(e){l.push(e),6===l.length&&t(l)}var n,a,s,u=\"\",l=[];for(a=0;6>a;a++)u+=\"url((.+))s*,s*\";if(s=e.match(u))for(a=1;7>a;a++)i(s[a],r);else if(n=o(e))return\"A-CUBEMAP\"===n.tagName&&n.srcs?t(n.srcs):(c('Selector \"%s\" does not point to <a-cubemap>',e),void 0)}function n(e){var t=e.match(/\\url\\((.+)\\)/);if(t)return t[1]}function a(e,t){function i(){t(!0)}function r(){t(!1)}var n=new Image;n.addEventListener(\"load\",i),n.addEventListener(\"error\",r),n.src=e}function o(e){try{var t=document.querySelector(e);return t||c('No element was found matching the selector: \"%s\"',e),t}catch(i){return c('\"%s\" is not a valid selector',e),void 0}}var s=e(\"./debug\"),c=s(\"utils:src-loader:warn\");t.exports={parseUrl:n,validateSrc:i,validateCubemapSrc:r}},{\"./debug\":115}],120:[function(e,t){function i(e){function t(e){return e[1].toUpperCase()}return e.replace(/-([a-z])/g,t)}function r(e){var t=Object.keys(e),r={};return t.forEach(function(t){var n=i(t);r[n]=e[t]}),r}var n=e(\"style-attr\");t.exports.parse=function(e){var t;return\"string\"!=typeof e?e:(t=n.parse(e),t[\"\"]?e:r(t))},t.exports.stringify=function(e){return\"string\"==typeof e?e:n.stringify(e)},t.exports.toCamelCase=i,t.exports.transformKeysToCamelCase=r},{\"style-attr\":12}],121:[function(){THREE.VRControls=function(e,t){function i(e){for(var i=0;i<e.length;i++)if(\"VRDisplay\"in window&&e[i]instanceof VRDisplay||\"PositionSensorVRDevice\"in window&&e[i]instanceof PositionSensorVRDevice){r=e[i];break}r||t&&t(\"VR input not available.\")}var r,n=this,a=new THREE.Matrix4;navigator.getVRDisplays?navigator.getVRDisplays().then(i):navigator.getVRDevices&&navigator.getVRDevices().then(i),this.scale=1,this.standing=!1,this.userHeight=1.6,this.update=function(){if(r){if(r.getPose){var t=r.getPose();null!==t.orientation&&e.quaternion.fromArray(t.orientation),null!==t.position?e.position.fromArray(t.position):e.position.set(0,0,0)}else{var i=r.getState();null!==i.orientation&&e.quaternion.copy(i.orientation),null!==i.position?e.position.copy(i.position):e.position.set(0,0,0)}this.standing&&(r.stageParameters?(e.updateMatrix(),a.fromArray(r.stageParameters.sittingToStandingTransform),e.applyMatrix(a)):e.position.setY(e.position.y+this.userHeight)),e.position.multiplyScalar(n.scale)}},this.resetPose=function(){r&&(void 0!==r.resetPose?r.resetPose():void 0!==r.resetSensor?r.resetSensor():void 0!==r.zeroSensor&&r.zeroSensor())},this.resetSensor=function(){console.warn(\"THREE.VRControls: .resetSensor() is now .resetPose().\"),this.resetPose()},this.zeroSensor=function(){console.warn(\"THREE.VRControls: .zeroSensor() is now .resetPose().\"),this.resetPose()},this.dispose=function(){r=null}}},{}],122:[function(){THREE.VREffect=function(e,t){function i(e){c=e;for(var i=0;i<e.length;i++){if(\"VRDisplay\"in window&&e[i]instanceof VRDisplay){s=e[i],p=!0;break}if(\"HMDVRDevice\"in window&&e[i]instanceof HMDVRDevice){s=e[i],p=!1;break}}void 0===s&&t&&t(\"HMD not available\")}function r(){var t=g.isPresenting;if(g.isPresenting=void 0!==s&&(s.isPresenting||!p&&document[x]instanceof window.HTMLElement),g.isPresenting){var i,r,n=s.getEyeParameters(\"left\");if(p){if(i=n.renderWidth,r=n.renderHeight,s.getLayers){var a=s.getLayers();a.length&&(E=a[0].leftBounds||[0,0,.5,1],b=a[0].rightBounds||[.5,0,.5,1])}}else i=n.renderRect.width,r=n.renderRect.height;t||(y=e.getPixelRatio(),v=e.getSize(),e.setPixelRatio(1),e.setSize(2*i,r,!1))}else t&&(e.setPixelRatio(y),e.setSize(v.width,v.height))}function n(e){var t=2/(e.leftTan+e.rightTan),i=(e.leftTan-e.rightTan)*t*.5,r=2/(e.upTan+e.downTan),n=(e.upTan-e.downTan)*r*.5;return{scale:[t,r],offset:[i,n]}}function a(e,t,i,r){t=void 0===t?!0:t,i=void 0===i?.01:i,r=void 0===r?1e4:r;var a=t?-1:1,o=new THREE.Matrix4,s=o.elements,c=n(e);return s[0]=c.scale[0],s[1]=0,s[2]=c.offset[0]*a,s[3]=0,s[4]=0,s[5]=c.scale[1],s[6]=-c.offset[1]*a,s[7]=0,s[8]=0,s[9]=0,s[10]=r/(i-r)*-a,s[11]=r*i/(i-r),s[12]=0,s[13]=0,s[14]=a,s[15]=0,o.transpose(),o}function o(e,t,i,r){var n=Math.PI/180,o={upTan:Math.tan(e.upDegrees*n),downTan:Math.tan(e.downDegrees*n),leftTan:Math.tan(e.leftDegrees*n),rightTan:Math.tan(e.rightDegrees*n)};return a(o,t,i,r)}var s,c,u,l,h,d,p=!0,f=new THREE.Vector3,m=new THREE.Vector3;navigator.getVRDisplays?navigator.getVRDisplays().then(i):navigator.getVRDevices&&navigator.getVRDevices().then(i),this.isPresenting=!1,this.scale=1;var g=this,v=e.getSize(),y=e.getPixelRatio();this.getVRDisplay=function(){return s},this.getVRDisplays=function(){return c},this.setSize=function(t,i){if(v={width:t,height:i},g.isPresenting){var r=s.getEyeParameters(\"left\");e.setPixelRatio(1),p?e.setSize(2*r.renderWidth,r.renderHeight,!1):e.setSize(2*r.renderRect.width,r.renderRect.height,!1)}else e.setPixelRatio(y),e.setSize(t,i)};var M,A,x,w=e.domElement,E=[0,0,.5,1],b=[.5,0,.5,1];w.requestFullscreen?(M=\"requestFullscreen\",x=\"fullscreenElement\",A=\"exitFullscreen\",document.addEventListener(\"fullscreenchange\",r,!1)):w.mozRequestFullScreen?(M=\"mozRequestFullScreen\",x=\"mozFullScreenElement\",A=\"mozCancelFullScreen\",document.addEventListener(\"mozfullscreenchange\",r,!1)):(M=\"webkitRequestFullscreen\",x=\"webkitFullscreenElement\",A=\"webkitExitFullscreen\",document.addEventListener(\"webkitfullscreenchange\",r,!1)),window.addEventListener(\"vrdisplaypresentchange\",r,!1),this.setFullScreen=function(e){return new Promise(function(t,i){return void 0===s?(i(new Error(\"No VR hardware found.\")),void 0):g.isPresenting===e?(t(),void 0):(p?e?t(s.requestPresent([{source:w}])):t(s.exitPresent()):w[M]?(w[e?M:A]({vrDisplay:s}),t()):(console.error(\"No compatible requestFullscreen method found.\"),i(new Error(\"No compatible requestFullscreen method found.\"))),void 0)\n})},this.requestPresent=function(){return this.setFullScreen(!0)},this.exitPresent=function(){return this.setFullScreen(!1)},this.requestAnimationFrame=function(e){return p&&void 0!==s?s.requestAnimationFrame(e):window.requestAnimationFrame(e)},this.cancelAnimationFrame=function(e){p&&void 0!==s?s.cancelAnimationFrame(e):window.cancelAnimationFrame(e)},this.submitFrame=function(){p&&void 0!==s&&g.isPresenting&&s.submitFrame()},this.autoSubmitFrame=!0;var T=new THREE.PerspectiveCamera;T.layers.enable(1);var L=new THREE.PerspectiveCamera;L.layers.enable(2),this.render=function(t,i,r,n){if(s&&g.isPresenting){var a=t.autoUpdate;a&&(t.updateMatrixWorld(),t.autoUpdate=!1);var c=s.getEyeParameters(\"left\"),v=s.getEyeParameters(\"right\");p?(f.fromArray(c.offset),m.fromArray(v.offset),h=c.fieldOfView,d=v.fieldOfView):(f.copy(c.eyeTranslation),m.copy(v.eyeTranslation),h=c.recommendedFieldOfView,d=v.recommendedFieldOfView),Array.isArray(t)&&(console.warn(\"THREE.VREffect.render() no longer supports arrays. Use object.layers instead.\"),t=t[0]);var y=e.getSize();u={x:Math.round(y.width*E[0]),y:Math.round(y.height*E[1]),width:Math.round(y.width*E[2]),height:Math.round(y.height*E[3])},l={x:Math.round(y.width*b[0]),y:Math.round(y.height*b[1]),width:Math.round(y.width*b[2]),height:Math.round(y.height*b[3])},r?(e.setRenderTarget(r),r.scissorTest=!0):e.setScissorTest(!0),(e.autoClear||n)&&e.clear(),null===i.parent&&i.updateMatrixWorld(),T.projectionMatrix=o(h,!0,i.near,i.far),L.projectionMatrix=o(d,!0,i.near,i.far),i.matrixWorld.decompose(T.position,T.quaternion,T.scale),i.matrixWorld.decompose(L.position,L.quaternion,L.scale);var M=this.scale;return T.translateOnAxis(f,M),L.translateOnAxis(m,M),r?(r.viewport.set(u.x,u.y,u.width,u.height),r.scissor.set(u.x,u.y,u.width,u.height)):(e.setViewport(u.x,u.y,u.width,u.height),e.setScissor(u.x,u.y,u.width,u.height)),e.render(t,T,r,n),r?(r.viewport.set(l.x,l.y,l.width,l.height),r.scissor.set(l.x,l.y,l.width,l.height)):(e.setViewport(l.x,l.y,l.width,l.height),e.setScissor(l.x,l.y,l.width,l.height)),e.render(t,L,r,n),r?(r.viewport.set(0,0,y.width,y.height),r.scissor.set(0,0,y.width,y.height),r.scissorTest=!1,e.setRenderTarget(null)):e.setScissorTest(!1),a&&(t.autoUpdate=!0),g.autoSubmitFrame&&g.submitFrame(),void 0}e.render(t,i,r,n)}}},{}],123:[function(e,t){window.glStats=function(){function e(e,t){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function t(){a(\"allcalls\").set(o+s),a(\"drawElements\").set(s),a(\"drawArrays\").set(o),a(\"bindTexture\").set(d),a(\"useProgram\").set(c),a(\"glfaces\").set(u),a(\"glvertices\").set(l),a(\"glpoints\").set(h)}function i(){o=0,s=0,c=0,u=0,l=0,h=0,d=0}function r(){}function n(e){a=e}var a=null,o=0,s=0,c=0,u=0,l=0,h=0,d=0;WebGLRenderingContext.prototype.drawArrays=e(WebGLRenderingContext.prototype.drawArrays,function(){o++,arguments[0]==this.POINTS?h+=arguments[2]:l+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=e(WebGLRenderingContext.prototype.drawElements,function(){s++,u+=arguments[1]/3,l+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=e(WebGLRenderingContext.prototype.useProgram,function(){c++}),WebGLRenderingContext.prototype.bindTexture=e(WebGLRenderingContext.prototype.bindTexture,function(){d++});var p={allcalls:{over:3e3,caption:\"Calls (hook)\"},drawelements:{caption:\"drawElements (hook)\"},drawarrays:{caption:\"drawArrays (hook)\"}},f=[{caption:\"WebGL\",values:[\"allcalls\",\"drawelements\",\"drawarrays\",\"useprogram\",\"bindtexture\",\"glfaces\",\"glvertices\",\"glpoints\"]}],m=[{base:\"allcalls\",steps:[\"drawelements\",\"drawarrays\"]}];return{update:t,start:i,end:r,attach:n,values:p,groups:f,fractions:m}},window.threeStats=function(e){function t(){a(\"renderer.info.memory.geometries\").set(e.info.memory.geometries),a(\"renderer.info.programs\").set(e.info.programs.length),a(\"renderer.info.memory.textures\").set(e.info.memory.textures),a(\"renderer.info.render.calls\").set(e.info.render.calls),a(\"renderer.info.render.faces\").set(e.info.render.faces),a(\"renderer.info.render.points\").set(e.info.render.points),a(\"renderer.info.render.vertices\").set(e.info.render.vertices)}function i(){}function r(){}function n(e){a=e}var a=null,o={\"renderer.info.memory.geometries\":{caption:\"Geometries\"},\"renderer.info.memory.textures\":{caption:\"Textures\"},\"renderer.info.programs\":{caption:\"Programs\"},\"renderer.info.render.calls\":{caption:\"Calls\"},\"renderer.info.render.faces\":{caption:\"Faces\",over:1e3},\"renderer.info.render.points\":{caption:\"Points\"},\"renderer.info.render.vertices\":{caption:\"Vertices\"}},s=[{caption:\"Three.js - Memory\",values:[\"renderer.info.memory.geometries\",\"renderer.info.programs\",\"renderer.info.memory.textures\"]},{caption:\"Three.js - Render\",values:[\"renderer.info.render.calls\",\"renderer.info.render.faces\",\"renderer.info.render.points\",\"renderer.info.render.vertices\"]}],c=[];return{update:t,start:i,end:r,attach:n,values:o,groups:s,fractions:c}},window.BrowserStats=function(){function e(e){var t=100,i=Math.floor(Math.log(e)/h);return Math.round(e*t/Math.pow(1024,i))/t}function t(){o=e(performance.memory.usedJSHeapSize),s=e(performance.memory.totalJSHeapSize),a(\"memory\").set(o),a(\"total\").set(s)}function i(){o=0}function r(){}function n(e){a=e}var a=null,o=0,s=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),0===performance.memory.totalJSHeapSize&&console.warn(\"totalJSHeapSize === 0... performance.memory is only available in Chrome .\");var c={memory:{caption:\"Used Memory\",average:!0,avgMs:1e3,over:22},total:{caption:\"Total Memory\"}},u=[{caption:\"Browser\",values:[\"memory\",\"total\"]}],l=[{base:\"total\",steps:[\"memory\"]}],h=Math.log(1024);return{update:t,start:i,end:r,attach:n,values:c,groups:u,fractions:l}},\"object\"==typeof t&&(t.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats})},{}],124:[function(e,t){\"use strict\";!function(){if(\"undefined\"==typeof window.performance&&(window.performance={}),!window.performance.now){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}window.performance.mark||(window.performance.mark=function(){}),window.performance.measure||(window.performance.measure=function(){})}(),window.rStats=function(e){function t(e,t){for(var i=Object.keys(e),r=0,n=i.length;n>r;r++)t(i[r])}function i(e){var t=document.createElement(\"link\");t.href=e,t.rel=\"stylesheet\",t.type=\"text/css\",document.getElementsByTagName(\"head\")[0].appendChild(t)}function r(e,t,i){function r(){o.width=v,o.height=g,o.style.width=o.width+\"px\",o.style.height=o.height+\"px\",o.className=\"rs-canvas\",e.appendChild(o),s.fillStyle=\"#444444\",s.fillRect(0,0,o.width,o.height)}function n(e,t){u+=.1*(e-u),c*=.99,u>c&&(c=u),s.drawImage(o,1,0,o.width-1,o.height,0,0,o.width-1,o.height),t?s.drawImage(p,o.width-1,o.height-u*o.height/c-g):s.drawImage(h,o.width-1,o.height-u*o.height/c-g)}var a=i||{},o=document.createElement(\"canvas\"),s=o.getContext(\"2d\"),c=0,u=0,l=a.color?a.color:\"#666666\",h=document.createElement(\"canvas\"),d=h.getContext(\"2d\");h.width=1,h.height=2*g,d.fillStyle=\"#444444\",d.fillRect(0,0,1,2*g),d.fillStyle=l,d.fillRect(0,g,1,g),d.fillStyle=\"#ffffff\",d.globalAlpha=.5,d.fillRect(0,g,1,1),d.globalAlpha=1;var p=document.createElement(\"canvas\"),f=p.getContext(\"2d\");return p.width=1,p.height=2*g,f.fillStyle=\"#444444\",f.fillRect(0,0,1,2*g),f.fillStyle=\"#b70000\",f.fillRect(0,g,1,g),f.globalAlpha=.5,f.fillStyle=\"#ffffff\",f.fillRect(0,g,1,1),f.globalAlpha=1,r(),{draw:n}}function n(e,i){function r(){a.width=v,a.height=g*i,a.style.width=a.width+\"px\",a.style.height=a.height+\"px\",a.className=\"rs-canvas\",e.appendChild(a),o.fillStyle=\"#444444\",o.fillRect(0,0,a.width,a.height)}function n(e){o.drawImage(a,1,0,a.width-1,a.height,0,0,a.width-1,a.height);var i=0;t(e,function(t){var r=e[t]*a.height;o.fillStyle=l[t],o.fillRect(a.width-1,i,1,r),i+=r})}var a=document.createElement(\"canvas\"),o=a.getContext(\"2d\");return r(),{draw:n}}function a(e,t){function i(e){if(b&&b.average){v+=e,M++;var t=performance.now();t-y>=(b.avgMs||1e3)&&(g=v/M,v=0,y=t,M=0)}}function n(){h=performance.now(),u.userTimingAPI&&performance.mark(d+\"-start\"),L=!0}function a(){p=performance.now()-h,u.userTimingAPI&&(performance.mark(d+\"-end\"),L&&performance.measure(d,d+\"-start\",d+\"-end\")),i(p)}function o(){a(),n()}function s(){var e=b&&b.average?g:p;E.nodeValue=Math.round(100*e)/100;var t=b&&(b.below&&p<b.below||b.over&&p>b.over);T.draw(p,t),A.style.color=t?\"#b70000\":\"#ffffff\"}function c(){var e=performance.now(),t=e-h;f++,t>1e3&&(p=b&&b.interpolate===!1?f:1e3*f/t,f=0,h=e,i(p))}function l(e){p=e,i(p)}var h,d=e,p=0,f=0,g=0,v=0,y=performance.now(),M=0,A=document.createElement(\"div\"),x=document.createElement(\"span\"),w=document.createElement(\"div\"),E=document.createTextNode(\"\"),b=u?u.values[d.toLowerCase()]:null,T=new r(A,d,b),L=!1;return A.className=\"rs-counter-base\",x.className=\"rs-counter-id\",x.textContent=b&&b.caption?b.caption:d,w.className=\"rs-counter-value\",w.appendChild(E),A.appendChild(x),A.appendChild(w),t?t.div.appendChild(A):m.appendChild(A),h=performance.now(),{set:l,start:n,tick:o,end:a,frame:c,value:function(){return p},draw:s}}function o(e){var i=e.toLowerCase();if(void 0===i&&(i=\"default\"),y[i])return y[i];var r=null;u&&u.groups&&t(u.groups,function(e){var t=u.groups[parseInt(e,10)];r||-1===t.values.indexOf(i.toLowerCase())||(r=t)});var n=new a(i,r);return y[i]=n,n}function s(){if(u.plugins){u.values||(u.values={}),u.groups||(u.groups=[]),u.fractions||(u.fractions=[]);for(var e=0;e<u.plugins.length;e++)u.plugins[e].attach(o),t(u.plugins[e].values,function(t){u.values[t]=u.plugins[e].values[t]}),u.groups=u.groups.concat(u.plugins[e].groups),u.fractions=u.fractions.concat(u.plugins[e].fractions)}else u.plugins={};f=document.createElement(\"div\"),f.className=\"rs-base\",m=document.createElement(\"div\"),m.className=\"rs-container\",m.style.height=\"auto\",f.appendChild(m),document.body.appendChild(f),u&&(u.groups&&t(u.groups,function(e){var t=u.groups[parseInt(e,10)],i=document.createElement(\"div\");i.className=\"rs-group\",t.div=i;var r=document.createElement(\"h1\");r.textContent=t.caption,r.addEventListener(\"click\",function(e){this.classList.toggle(\"hidden\"),e.preventDefault()}.bind(i)),m.appendChild(r),m.appendChild(i)}),u.fractions&&t(u.fractions,function(e){var i=u.fractions[parseInt(e,10)],r=document.createElement(\"div\");r.className=\"rs-fraction\";var a=document.createElement(\"div\");a.className=\"rs-legend\";var o=0;t(u.fractions[e].steps,function(t){var i=document.createElement(\"p\");i.textContent=u.fractions[e].steps[t],i.style.color=l[o],a.appendChild(i),o++}),r.appendChild(a),r.style.height=o*g+\"px\",i.div=r;var s=new n(r,o);i.graph=s,m.appendChild(r)}))}function c(){t(u.plugins,function(e){u.plugins[e].update()}),t(y,function(e){y[e].draw()}),u&&u.fractions&&t(u.fractions,function(e){var i=u.fractions[parseInt(e,10)],r=[],n=y[i.base.toLowerCase()];n&&(n=n.value(),t(u.fractions[e].steps,function(t){var i=u.fractions[e].steps[parseInt(t,10)].toLowerCase(),a=y[i];a&&r.push(a.value()/n)})),i.graph.draw(r)})}var u=e||{},l=u.colours||[\"#850700\",\"#c74900\",\"#fcb300\",\"#284280\",\"#4c7c0c\"],h=\"https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300\",d=(u.CSSPath?u.CSSPath:\"\")+\"rStats.css\",p=u.css||[h,d];p.forEach(function(e){i(e)}),u.values||(u.values={});var f,m,g=10,v=200,y={};return s(),function(e){return e?o(e):{element:f,update:c}}},\"object\"==typeof t&&(t.exports=window.rStats)},{}],125:[function(e,t){var i={};i.base64=function(e,t){return\"data:\"+e+\";base64,\"+t},i.isMobile=function(){var e=!1;return function(t){(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},i.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},i.isIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},i.appendQueryParameter=function(e,t,i){var r=e.indexOf(\"?\")<0?\"?\":\"&\";return e+=r+t+\"=\"+i},i.getQueryParameter=function(e){e=e.replace(/[\\[]/,\"\\\\[\").replace(/[\\]]/,\"\\\\]\");var t=new RegExp(\"[\\\\?&]\"+e+\"=([^&#]*)\"),i=t.exec(location.search);return null===i?\"\":decodeURIComponent(i[1].replace(/\\+/g,\" \"))},i.isLandscapeMode=function(){return 90==window.orientation||-90==window.orientation},t.exports=i},{}],126:[function(e,t){function i(){var e=document.createElement(\"video\");e.addEventListener(\"ended\",function(){e.play()}),this.request=function(){e.paused&&(e.src=a.base64(\"video/webm\",\"GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw==\"),e.play())},this.release=function(){e.pause(),e.src=\"\"}}function r(){var e=null;this.request=function(){e||(e=setInterval(function(){window.location=window.location,setTimeout(window.stop,0)},3e4))},this.release=function(){e&&(clearInterval(e),e=null)}}function n(){var e=navigator.userAgent||navigator.vendor||window.opera;return e.match(/iPhone/i)||e.match(/iPod/i)?r:i}var a=e(\"./util.js\");t.exports=n()},{\"./util.js\":125}]},{},[99])(99)});\n!function(e){function t(e,t,i){return 4===arguments.length?r.apply(this,arguments):void n(e,{declarative:!0,deps:t,declare:i})}function r(e,t,r,i){n(e,{declarative:!1,deps:t,executingRequire:r,execute:i})}function n(e,t){t.name=e,e in v||(v[e]=t),t.normalizedDeps=t.deps}function i(e,t){if(t[e.groupIndex]=t[e.groupIndex]||[],-1==p.call(t[e.groupIndex],e)){t[e.groupIndex].push(e);for(var r=0,n=e.normalizedDeps.length;n>r;r++){var a=e.normalizedDeps[r],o=v[a];if(o&&!o.evaluated){var s=e.groupIndex+(o.declarative!=e.declarative);if(void 0===o.groupIndex||o.groupIndex<s){if(void 0!==o.groupIndex&&(t[o.groupIndex].splice(p.call(t[o.groupIndex],o),1),0==t[o.groupIndex].length))throw new TypeError(\"Mixed dependency cycle detected\");o.groupIndex=s}i(o,t)}}}}function a(e){var t=v[e];t.groupIndex=0;var r=[];i(t,r);for(var n=!!t.declarative==r.length%2,a=r.length-1;a>=0;a--){for(var o=r[a],u=0;u<o.length;u++){var c=o[u];n?s(c):f(c)}n=!n}}function o(e){return y[e]||(y[e]={name:e,dependencies:[],exports:{},importers:[]})}function s(t){if(!t.module){var r=t.module=o(t.name),n=t.module.exports,i=t.declare.call(e,function(e,t){if(r.locked=!0,\"object\"==typeof e)for(var i in e)n[i]=e[i];else n[e]=t;for(var a=0,o=r.importers.length;o>a;a++){var s=r.importers[a];if(!s.locked)for(var u=0;u<s.dependencies.length;++u)s.dependencies[u]===r&&s.setters[u](n)}return r.locked=!1,t},{id:t.name});r.setters=i.setters,r.execute=i.execute;for(var a=0,u=t.normalizedDeps.length;u>a;a++){var f,c=t.normalizedDeps[a],l=v[c],d=y[c];d?f=d.exports:l&&!l.declarative?f=l.esModule:l?(s(l),d=l.module,f=d.exports):f=h(c),d&&d.importers?(d.importers.push(r),r.dependencies.push(d)):r.dependencies.push(null),r.setters[a]&&r.setters[a](f)}}}function u(e){var t,r=v[e];if(r)r.declarative?d(e,[]):r.evaluated||f(r),t=r.module.exports;else if(t=h(e),!t)throw new Error(\"Unable to load dependency \"+e+\".\");return(!r||r.declarative)&&t&&t.__useDefault?t[\"default\"]:t}function f(t){if(!t.module){var r={},n=t.module={exports:r,id:t.name};if(!t.executingRequire)for(var i=0,a=t.normalizedDeps.length;a>i;i++){var o=t.normalizedDeps[i],s=v[o];s&&f(s)}t.evaluated=!0;var l=t.execute.call(e,function(e){for(var r=0,n=t.deps.length;n>r;r++)if(t.deps[r]==e)return u(t.normalizedDeps[r]);throw new TypeError(\"Module \"+e+\" not declared as a dependency.\")},r,n);l&&(n.exports=l),r=n.exports,r&&r.__esModule?t.esModule=r:t.esModule=c(r)}}function c(t){var r={};if((\"object\"==typeof t||\"function\"==typeof t)&&t!==e)if(m)for(var n in t)\"default\"!==n&&l(r,t,n);else{var i=t&&t.hasOwnProperty;for(var n in t)\"default\"===n||i&&!t.hasOwnProperty(n)||(r[n]=t[n])}return r[\"default\"]=t,w(r,\"__useDefault\",{value:!0}),r}function l(e,t,r){try{var n;(n=Object.getOwnPropertyDescriptor(t,r))&&w(e,r,n)}catch(n){return e[r]=t[r],!1}}function d(t,r){var n=v[t];if(n&&!n.evaluated&&n.declarative){r.push(t);for(var i=0,a=n.normalizedDeps.length;a>i;i++){var o=n.normalizedDeps[i];-1==p.call(r,o)&&(v[o]?d(o,r):h(o))}n.evaluated||(n.evaluated=!0,n.module.execute.call(e))}}function h(e){if(S[e])return S[e];if(\"@node/\"==e.substr(0,6))return S[e]=c(g(e.substr(6)));var t=v[e];if(!t)throw\"Module \"+e+\" not present.\";return a(e),d(e,[]),v[e]=void 0,t.declarative&&w(t.module.exports,\"__esModule\",{value:!0}),S[e]=t.declarative?t.module.exports:t.esModule}var v={},p=Array.prototype.indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(this[t]===e)return t;return-1},m=!0;try{Object.getOwnPropertyDescriptor({a:0},\"a\")}catch(e){m=!1}var w;!function(){try{Object.defineProperty({},\"a\",{})&&(w=Object.defineProperty)}catch(e){w=function(e,t,r){try{e[t]=r.value||r.get.call(e)}catch(e){}}}}();var y={},g=\"undefined\"!=typeof System&&System._nodeRequire||\"undefined\"!=typeof require&&require.resolve&&\"undefined\"!=typeof process&&require,S={\"@empty\":{}};return function(e,n,i,a){return function(o){o(function(o){for(var s={_nodeRequire:g,register:t,registerDynamic:r,get:h,set:function(e,t){S[e]=t},newModule:function(e){return e}},u=0;u<n.length;u++)(function(e,t){t&&t.__esModule?S[e]=t:S[e]=c(t)})(n[u],arguments[u]);a(s);var f=h(e[0]);if(e.length>1)for(var u=1;u<e.length;u++)h(e[u]);return i?f[\"default\"]:f})}}}(\"undefined\"!=typeof self?self:global)([\"1\"],[],false,function(e){var t=this.require,r=this.exports,n=this.module;!function(t){function r(e,t){e=e.replace(s,\"\");var r=e.match(c),n=(r[1].split(\",\")[t]||\"require\").replace(l,\"\"),i=d[n]||(d[n]=new RegExp(u+n+f,\"g\"));i.lastIndex=0;for(var a,o=[];a=i.exec(e);)o.push(a[2]||a[3]);return o}function n(e,t,r,i){if(\"object\"==typeof e&&!(e instanceof Array))return n.apply(null,Array.prototype.splice.call(arguments,1,arguments.length-1));if(\"string\"==typeof e&&\"function\"==typeof t&&(e=[e]),!(e instanceof Array)){if(\"string\"==typeof e){var o=a.get(e);return o.__useDefault?o[\"default\"]:o}throw new TypeError(\"Invalid require\")}for(var s=[],u=0;u<e.length;u++)s.push(a[\"import\"](e[u],i));Promise.all(s).then(function(e){t&&t.apply(null,e)},r)}function i(e,i,s){\"string\"!=typeof e&&(s=i,i=e,e=null),i instanceof Array||(s=i,i=[\"require\",\"exports\",\"module\"].splice(0,s.length)),\"function\"!=typeof s&&(s=function(e){return function(){return e}}(s)),void 0===i[i.length-1]&&i.pop();var u,f,c;-1!=(u=o.call(i,\"require\"))&&(i.splice(u,1),e||(i=i.concat(r(s.toString(),u)))),-1!=(f=o.call(i,\"exports\"))&&i.splice(f,1),-1!=(c=o.call(i,\"module\"))&&i.splice(c,1);var l={name:e,deps:i,execute:function(e,r,o){for(var l=[],d=0;d<i.length;d++)l.push(e(i[d]));o.uri=o.id,o.config=function(){},-1!=c&&l.splice(c,0,o),-1!=f&&l.splice(f,0,r),-1!=u&&l.splice(u,0,function(t,r,i){return\"string\"==typeof t&&\"function\"!=typeof r?e(t):n.call(a,t,r,i,o.id)});var h=s.apply(-1==f?t:r,l);return\"undefined\"==typeof h&&o&&(h=o.exports),\"undefined\"!=typeof h?h:void 0}};if(e)h.anonDefine||h.isBundle?h.anonDefine&&h.anonDefine.name&&(h.anonDefine=null):h.anonDefine=l,h.isBundle=!0,a.registerDynamic(l.name,l.deps,!1,l.execute);else{if(h.anonDefine&&!h.anonDefine.name)throw new Error(\"Multiple anonymous defines in module \"+e);h.anonDefine=l}}var a=e,o=Array.prototype.indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(this[t]===e)return t;return-1},s=/(\\/\\*([\\s\\S]*?)\\*\\/|([^:]|^)\\/\\/(.*)$)/gm,u=\"(?:^|[^$_a-zA-Z\\\\xA0-\\\\uFFFF.])\",f=\"\\\\s*\\\\(\\\\s*(\\\"([^\\\"]+)\\\"|'([^']+)')\\\\s*\\\\)\",c=/\\(([^\\)]*)\\)/,l=/^\\s+|\\s+$/g,d={};i.amd={};var h={isBundle:!1,anonDefine:null};a.amdDefine=i,a.amdRequire=n}(\"undefined\"!=typeof self?self:global);(function(){var t=e.amdDefine;t(\"2\",[\"exports\",\"3\"],function(e,t){\"use strict\";Number.isNaN=Number.isNaN||function(e){return e!==e};Number.isFinite=Number.isFinite||function(e){return typeof e===\"number\"&&isFinite(e)};if(!String.prototype.endsWith){String.prototype.endsWith=function(e,t){var r=this.toString();if(typeof t!==\"number\"||!isFinite(t)||Math.floor(t)!==t||t>r.length){t=r.length}t-=e.length;var n=r.indexOf(e,t);return n!==-1&&n===t}}if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){t=t||0;return this.substr(t,e.length)===e}}if(!Array.from){Array.from=function(){var e=Object.prototype.toString;var t=function t(r){return typeof r===\"function\"||e.call(r)===\"[object Function]\"};var r=function e(t){var r=Number(t);if(isNaN(r)){return 0}if(r===0||!isFinite(r)){return r}return(r>0?1:-1)*Math.floor(Math.abs(r))};var n=Math.pow(2,53)-1;var i=function e(t){var i=r(t);return Math.min(Math.max(i,0),n)};return function e(r){var n=this;var a=Object(r);if(r==null){throw new TypeError(\"Array.from requires an array-like object - not null or undefined\")}var o=arguments.length>1?arguments[1]:void undefined;var s;if(typeof o!==\"undefined\"){if(!t(o)){throw new TypeError(\"Array.from: when provided, the second argument must be a function\")}if(arguments.length>2){s=arguments[2]}}var u=i(a.length);var f=t(n)?Object(new n(u)):new Array(u);var c=0;var l;while(c<u){l=a[c];if(o){f[c]=typeof s===\"undefined\"?o(l,c):o.call(s,l,c)}else{f[c]=l}c+=1}f.length=u;return f}}()}if(!Array.prototype.find){Array.prototype.find=function(e){if(this===null){throw new TypeError(\"Array.prototype.find called on null or undefined\")}if(typeof e!==\"function\"){throw new TypeError(\"predicate must be a function\")}var t=Object(this);var r=t.length>>>0;var n=arguments[1];var i;for(var a=0;a<r;a++){i=t[a];if(e.call(n,i,a,t)){return i}}return undefined}}if(!Array.prototype.findIndex){Array.prototype.findIndex=function(e){if(this===null){throw new TypeError(\"Array.prototype.findIndex called on null or undefined\")}if(typeof e!==\"function\"){throw new TypeError(\"predicate must be a function\")}var t=Object(this);var r=t.length>>>0;var n=arguments[1];var i;for(var a=0;a<r;a++){i=t[a];if(e.call(n,i,a,t)){return a}}return-1}}if(!Array.prototype.includes){Array.prototype.includes=function(e){var t=Object(this);var r=parseInt(t.length)||0;if(r===0){return false}var n=parseInt(arguments[1])||0;var i;if(n>=0){i=n}else{i=r+n;if(i<0){i=0}}var a;while(i<r){a=t[i];if(e===a||e!==e&&a!==a){return true}i++}return false}}if(typeof Object.assign!==\"function\"){Object.assign=function(e){if(e===undefined||e===null){throw new TypeError(\"Cannot convert undefined or null to object\")}var t=Object(e);for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n!==undefined&&n!==null){for(var i in n){if(n.hasOwnProperty(i)){t[i]=n[i]}}}}return t}}(function(e){var t=undefined;var r=Object.defineProperty;var n=function e(t,r){return t===r||t!==t&&r!==r};if(typeof Map==\"undefined\"||typeof(new Map).values!==\"function\"||!(new Map).values().next){e.Map=i({delete:o,has:c,get:s,set:l,keys:v,values:p,entries:m,forEach:S,clear:h})}if(typeof Set==\"undefined\"||typeof(new Set).values!==\"function\"||!(new Set).values().next){e.Set=i({has:f,add:d,delete:o,clear:h,keys:p,values:p,entries:w,forEach:S})}function i(e,t){function n(e){if(!this||this.constructor!==n)return new n(e);this._keys=[];this._values=[];this._itp=[];this.objectOnly=t;if(e)a.call(this,e)}if(!t){r(e,\"size\",{get:g})}e.constructor=n;n.prototype=e;return n}function a(e){var t;if(this.add)e.forEach(this.add,this);else e.forEach(function(e){this.set(e[0],e[1])},this)}function o(e){if(this.has(e)){this._keys.splice(t,1);this._values.splice(t,1);this._itp.forEach(function(e){if(t<e[0])e[0]--})}return-1<t}function s(e){return this.has(e)?this._values[t]:undefined}function u(e,r){if(this.objectOnly&&r!==Object(r))throw new TypeError(\"Invalid value used as weak collection key\");if(r!=r||r===0)for(t=e.length;t--&&!n(e[t],r);){}else t=e.indexOf(r);return-1<t}function f(e){return u.call(this,this._values,e)}function c(e){return u.call(this,this._keys,e)}function l(e,r){this.has(e)?this._values[t]=r:this._values[this._keys.push(e)-1]=r;return this}function d(e){if(!this.has(e))this._values.push(e);return this}function h(){(this._keys||0).length=this._values.length=0}function v(){return y(this._itp,this._keys)}function p(){return y(this._itp,this._values)}function m(){return y(this._itp,this._keys,this._values)}function w(){return y(this._itp,this._values,this._values)}function y(e,t,r){var n=[0],i=false;e.push(n);return{next:function a(){var o,s=n[0];if(!i&&s<t.length){o=r?[t[s],r[s]]:t[s];n[0]++}else{i=true;e.splice(e.indexOf(n),1)}return{done:i,value:o}}}}function g(){return this._values.length}function S(e,t){var r=this.entries();for(;;){var n=r.next();if(n.done)break;e.call(t,n.value[1],n.value[0],this)}}})(t.PLATFORM.global);var r=Object.freeze({});var n=\"__metadata__\";var i=Function.prototype.bind;if(typeof t.PLATFORM.global.Reflect===\"undefined\"){t.PLATFORM.global.Reflect={}}if(typeof Reflect.getOwnMetadata!==\"function\"){Reflect.getOwnMetadata=function(e,t,i){return((t[n]||r)[i]||r)[e]}}if(typeof Reflect.defineMetadata!==\"function\"){Reflect.defineMetadata=function(e,t,r,i){var a=r.hasOwnProperty(n)?r[n]:r[n]={};var o=a[i]||(a[i]={});o[e]=t}}if(typeof Reflect.metadata!==\"function\"){Reflect.metadata=function(e,t){return function(r,n){Reflect.defineMetadata(e,t,r,n)}}}if(typeof Reflect.construct!==\"function\"){Reflect.construct=function(e,t){if(t){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}}var r=[null];r.push.apply(r,t);return new(i.apply(e,r))}}})})();(function(){var t=e.amdDefine;(function(e){var i=typeof r==\"object\"&&r&&!r.nodeType&&r;var a=typeof n==\"object\"&&n&&!n.nodeType&&n;var o=typeof global==\"object\"&&global;if(o.global===o||o.window===o||o.self===o){e=o}var s,u=2147483647,f=36,c=1,l=26,d=38,h=700,v=72,p=128,m=\"-\",w=/^xn--/,y=/[^\\x20-\\x7E]/,g=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,S={overflow:\"Overflow: input needs wider integers to process\",\"not-basic\":\"Illegal input >= 0x80 (not a basic code point)\",\"invalid-input\":\"Invalid input\"},b=f-c,T=Math.floor,_=String.fromCharCode,E;function M(e){throw new RangeError(S[e])}function P(e,t){var r=e.length;var n=[];while(r--){n[r]=t(e[r])}return n}function A(e,t){var r=e.split(\"@\");var n=\"\";if(r.length>1){n=r[0]+\"@\";e=r[1]}e=e.replace(g,\".\");var i=e.split(\".\");var a=P(i,t).join(\".\");return n+a}function C(e){var t=[],r=0,n=e.length,i,a;while(r<n){i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<n){a=e.charCodeAt(r++);if((a&64512)==56320){t.push(((i&1023)<<10)+(a&1023)+65536)}else{t.push(i);r--}}else{t.push(i)}}return t}function I(e){return P(e,function(e){var t=\"\";if(e>65535){e-=65536;t+=_(e>>>10&1023|55296);e=56320|e&1023}t+=_(e);return t}).join(\"\")}function x(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return f}function R(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function O(e,t,r){var n=0;e=r?T(e/h):e>>1;e+=T(e/t);for(;e>b*l>>1;n+=f){e=T(e/b)}return T(n+(b+1)*e/(e+d))}function D(e){var t=[],r=e.length,n,i=0,a=p,o=v,s,d,h,w,y,g,S,b,_;s=e.lastIndexOf(m);if(s<0){s=0}for(d=0;d<s;++d){if(e.charCodeAt(d)>=128){M(\"not-basic\")}t.push(e.charCodeAt(d))}for(h=s>0?s+1:0;h<r;){for(w=i,y=1,g=f;;g+=f){if(h>=r){M(\"invalid-input\")}S=x(e.charCodeAt(h++));if(S>=f||S>T((u-i)/y)){M(\"overflow\")}i+=S*y;b=g<=o?c:g>=o+l?l:g-o;if(S<b){break}_=f-b;if(y>T(u/_)){M(\"overflow\")}y*=_}n=t.length+1;o=O(i-w,n,w==0);if(T(i/n)>u-a){M(\"overflow\")}a+=T(i/n);i%=n;t.splice(i++,0,a)}return I(t)}function q(e){var t,r,n,i,a,o,s,d,h,w,y,g=[],S,b,E,P;e=C(e);S=e.length;t=p;r=0;a=v;for(o=0;o<S;++o){y=e[o];if(y<128){g.push(_(y))}}n=i=g.length;if(i){g.push(m)}while(n<S){for(s=u,o=0;o<S;++o){y=e[o];if(y>=t&&y<s){s=y}}b=n+1;if(s-t>T((u-r)/b)){M(\"overflow\")}r+=(s-t)*b;t=s;for(o=0;o<S;++o){y=e[o];if(y<t&&++r>u){M(\"overflow\")}if(y==t){for(d=r,h=f;;h+=f){w=h<=a?c:h>=a+l?l:h-a;if(d<w){break}P=d-w;E=f-w;g.push(_(R(w+P%E,0)));d=T(P/E)}g.push(_(R(d,0)));a=O(r,b,n==i);r=0;++n}}++r;++t}return g.join(\"\")}function N(e){return A(e,function(e){return w.test(e)?D(e.slice(4).toLowerCase()):e})}function G(e){return A(e,function(e){return y.test(e)?\"xn--\"+q(e):e})}s={version:\"1.3.2\",ucs2:{decode:C,encode:I},decode:D,encode:q,toASCII:G,toUnicode:N};if(typeof t==\"function\"&&typeof t.amd==\"object\"&&t.amd){t(\"4\",[],function(){return s})&&t(\"punycode\",[\"4\"],function(e){return e})}else if(i&&a){if(n.exports==i){a.exports=s}else{for(E in s){s.hasOwnProperty(E)&&(i[E]=s[E])}}}else{e.punycode=s}})(this)})();(function(){var t=e.amdDefine;(function(e,i){\"use strict\";if(typeof r===\"object\"){n.exports=i()}else if(typeof t===\"function\"&&t.amd){t(\"5\",[],i)}else{e.IPv6=i(e)}})(this,function(e){\"use strict\";var t=e&&e.IPv6;function r(e){var t=e.toLowerCase();var r=t.split(\":\");var n=r.length;var i=8;if(r[0]===\"\"&&r[1]===\"\"&&r[2]===\"\"){r.shift();r.shift()}else if(r[0]===\"\"&&r[1]===\"\"){r.shift()}else if(r[n-1]===\"\"&&r[n-2]===\"\"){r.pop()}n=r.length;if(r[n-1].indexOf(\".\")!==-1){i=7}var a;for(a=0;a<n;a++){if(r[a]===\"\"){break}}if(a<i){r.splice(a,1,\"0000\");while(r.length<i){r.splice(a,0,\"0000\")}}var o;for(var s=0;s<i;s++){o=r[s].split(\"\");for(var u=0;u<3;u++){if(o[0]===\"0\"&&o.length>1){o.splice(0,1)}else{break}}r[s]=o.join(\"\")}var f=-1;var c=0;var l=0;var d=-1;var h=false;for(s=0;s<i;s++){if(h){if(r[s]===\"0\"){l+=1}else{h=false;if(l>c){f=d;c=l}}}else{if(r[s]===\"0\"){h=true;d=s;l=1}}}if(l>c){f=d;c=l}if(c>1){r.splice(f,c,\"\")}n=r.length;var v=\"\";if(r[0]===\"\"){v=\":\"}for(s=0;s<n;s++){v+=r[s];if(s===n-1){break}v+=\":\"}if(r[n-1]===\"\"){v+=\":\"}return v}function n(){if(e.IPv6===this){e.IPv6=t}return this}return{best:r,noConflict:n}})})();(function(){var t=e.amdDefine;(function(e,i){\"use strict\";if(typeof r===\"object\"){n.exports=i()}else if(typeof t===\"function\"&&t.amd){t(\"6\",[],i)}else{e.SecondLevelDomains=i(e)}})(this,function(e){\"use strict\";var t=e&&e.SecondLevelDomains;var r={list:{ac:\" com gov mil net org \",ae:\" ac co gov mil name net org pro sch \",af:\" com edu gov net org \",al:\" com edu gov mil net org \",ao:\" co ed gv it og pb \",ar:\" com edu gob gov int mil net org tur \",at:\" ac co gv or \",au:\" asn com csiro edu gov id net org \",ba:\" co com edu gov mil net org rs unbi unmo unsa untz unze \",bb:\" biz co com edu gov info net org store tv \",bh:\" biz cc com edu gov info net org \",bn:\" com edu gov net org \",bo:\" com edu gob gov int mil net org tv \",br:\" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg \",bs:\" com edu gov net org \",bz:\" du et om ov rg \",ca:\" ab bc mb nb nf nl ns nt nu on pe qc sk yk \",ck:\" biz co edu gen gov info net org \",cn:\" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj \",co:\" com edu gov mil net nom org \",cr:\" ac c co ed fi go or sa \",cy:\" ac biz com ekloges gov ltd name net org parliament press pro tm \",do:\" art com edu gob gov mil net org sld web \",dz:\" art asso com edu gov net org pol \",ec:\" com edu fin gov info med mil net org pro \",eg:\" com edu eun gov mil name net org sci \",er:\" com edu gov ind mil net org rochest w \",es:\" com edu gob nom org \",et:\" biz com edu gov info name net org \",fj:\" ac biz com info mil name net org pro \",fk:\" ac co gov net nom org \",fr:\" asso com f gouv nom prd presse tm \",gg:\" co net org \",gh:\" com edu gov mil org \",gn:\" ac com gov net org \",gr:\" com edu gov mil net org \",gt:\" com edu gob ind mil net org \",gu:\" com edu gov net org \",hk:\" com edu gov idv net org \",hu:\" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video \",id:\" ac co go mil net or sch web \",il:\" ac co gov idf k12 muni net org \",in:\" ac co edu ernet firm gen gov i ind mil net nic org res \",iq:\" com edu gov i mil net org \",ir:\" ac co dnssec gov i id net org sch \",it:\" edu gov \",je:\" co net org \",jo:\" com edu gov mil name net org sch \",jp:\" ac ad co ed go gr lg ne or \",ke:\" ac co go info me mobi ne or sc \",kh:\" com edu gov mil net org per \",ki:\" biz com de edu gov info mob net org tel \",km:\" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire \",kn:\" edu gov net org \",kr:\" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan \",kw:\" com edu gov net org \",ky:\" com edu gov net org \",kz:\" com edu gov mil net org \",lb:\" com edu gov net org \",lk:\" assn com edu gov grp hotel int ltd net ngo org sch soc web \",lr:\" com edu gov net org \",lv:\" asn com conf edu gov id mil net org \",ly:\" com edu gov id med net org plc sch \",ma:\" ac co gov m net org press \",mc:\" asso tm \",me:\" ac co edu gov its net org priv \",mg:\" com edu gov mil nom org prd tm \",mk:\" com edu gov inf name net org pro \",ml:\" com edu gov net org presse \",mn:\" edu gov org \",mo:\" com edu gov net org \",mt:\" com edu gov net org \",mv:\" aero biz com coop edu gov info int mil museum name net org pro \",mw:\" ac co com coop edu gov int museum net org \",mx:\" com edu gob net org \",my:\" com edu gov mil name net org sch \",nf:\" arts com firm info net other per rec store web \",ng:\" biz com edu gov mil mobi name net org sch \",ni:\" ac co com edu gob mil net nom org \",np:\" com edu gov mil net org \",nr:\" biz com edu gov info net org \",om:\" ac biz co com edu gov med mil museum net org pro sch \",pe:\" com edu gob mil net nom org sld \",ph:\" com edu gov i mil net ngo org \",pk:\" biz com edu fam gob gok gon gop gos gov net org web \",pl:\" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora \",pr:\" ac biz com edu est gov info isla name net org pro prof \",ps:\" com edu gov net org plo sec \",pw:\" belau co ed go ne or \",ro:\" arts com firm info nom nt org rec store tm www \",rs:\" ac co edu gov in org \",sb:\" com edu gov net org \",sc:\" com edu gov net org \",sh:\" co com edu gov net nom org \",sl:\" com edu gov net org \",st:\" co com consulado edu embaixada gov mil net org principe saotome store \",sv:\" com edu gob org red \",sz:\" ac co org \",tr:\" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web \",tt:\" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel \",tw:\" club com ebiz edu game gov idv mil net org \",mu:\" ac co com gov net or org \",mz:\" ac co edu gov org \",na:\" co com \",nz:\" ac co cri geek gen govt health iwi maori mil net org parliament school \",pa:\" abo ac com edu gob ing med net nom org sld \",pt:\" com edu gov int net nome org publ \",py:\" com edu gov mil net org \",qa:\" com edu gov mil net org \",re:\" asso com nom \",ru:\" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk \",rw:\" ac co com edu gouv gov int mil net \",sa:\" com edu gov med net org pub sch \",sd:\" com edu gov info med net org tv \",se:\" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z \",sg:\" com edu gov idn net org per \",sn:\" art com edu gouv org perso univ \",sy:\" com edu gov mil net news org \",th:\" ac co go in mi net or \",tj:\" ac biz co com edu go gov info int mil name net nic org test web \",tn:\" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism \",tz:\" ac co go ne or \",ua:\" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt \",ug:\" ac co go ne or org sc \",uk:\" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc \",us:\" dni fed isa kids nsn \",uy:\" com edu gub mil net org \",ve:\" co com edu gob info mil net org web \",vi:\" co com k12 net org \",vn:\" ac biz com edu gov health info int name net org pro \",ye:\" co com gov ltd me net org plc \",yu:\" ac co edu gov org \",za:\" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web \",zm:\" ac co com edu gov net org sch \"},has:function(e){var t=e.lastIndexOf(\".\");if(t<=0||t>=e.length-1){return false}var n=e.lastIndexOf(\".\",t-1);if(n<=0||n>=t-1){return false}var i=r.list[e.slice(t+1)];if(!i){return false}return i.indexOf(\" \"+e.slice(n+1,t)+\" \")>=0},is:function(e){var t=e.lastIndexOf(\".\");if(t<=0||t>=e.length-1){return false}var n=e.lastIndexOf(\".\",t-1);if(n>=0){return false}var i=r.list[e.slice(t+1)];if(!i){return false}return i.indexOf(\" \"+e.slice(0,t)+\" \")>=0},get:function(e){var t=e.lastIndexOf(\".\");if(t<=0||t>=e.length-1){return null}var n=e.lastIndexOf(\".\",t-1);if(n<=0||n>=t-1){return null}var i=r.list[e.slice(t+1)];if(!i){return null}if(i.indexOf(\" \"+e.slice(n+1,t)+\" \")<0){return null}return e.slice(n+1)},noConflict:function(){if(e.SecondLevelDomains===this){e.SecondLevelDomains=t}return this}};return r})})();(function(){var i=e.amdDefine;(function(e,a){\"use strict\";if(typeof r===\"object\"){n.exports=a(t(\"./punycode\"),t(\"./IPv6\"),t(\"./SecondLevelDomains\"))}else if(typeof i===\"function\"&&i.amd){i(\"7\",[\"4\",\"5\",\"6\"],a)}else{e.URI=a(e.punycode,e.IPv6,e.SecondLevelDomains,e)}})(this,function(e,t,r,n){\"use strict\";var i=n&&n.URI;function a(e,t){var r=arguments.length>=1;var n=arguments.length>=2;if(!(this instanceof a)){if(r){if(n){return new a(e,t)}return new a(e)}return new a}if(e===undefined){if(r){throw new TypeError(\"undefined is not a valid argument for URI\")}if(typeof location!==\"undefined\"){e=location.href+\"\"}else{e=\"\"}}this.href(e);if(t!==undefined){return this.absoluteTo(t)}return this}a.version=\"1.18.1\";var o=a.prototype;var s=Object.prototype.hasOwnProperty;function u(e){return e.replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g,\"\\\\$1\")}function f(e){if(e===undefined){return\"Undefined\"}return String(Object.prototype.toString.call(e)).slice(8,-1)}function c(e){return f(e)===\"Array\"}function l(e,t){var r={};var n,i;if(f(t)===\"RegExp\"){r=null}else if(c(t)){for(n=0,i=t.length;n<i;n++){r[t[n]]=true}}else{r[t]=true}for(n=0,i=e.length;n<i;n++){var a=r&&r[e[n]]!==undefined||!r&&t.test(e[n]);if(a){e.splice(n,1);i--;n--}}return e}function d(e,t){var r,n;if(c(t)){for(r=0,n=t.length;r<n;r++){if(!d(e,t[r])){return false}}return true}var i=f(t);for(r=0,n=e.length;r<n;r++){if(i===\"RegExp\"){if(typeof e[r]===\"string\"&&e[r].match(t)){return true}}else if(e[r]===t){return true}}return false}function h(e,t){if(!c(e)||!c(t)){return false}if(e.length!==t.length){return false}e.sort();t.sort();for(var r=0,n=e.length;r<n;r++){if(e[r]!==t[r]){return false}}return true}function v(e){var t=/^\\/+|\\/+$/g;return e.replace(t,\"\")}a._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:a.duplicateQueryParameters,escapeQuerySpace:a.escapeQuerySpace}};a.duplicateQueryParameters=false;a.escapeQuerySpace=true;a.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;a.idn_expression=/[^a-z0-9\\.-]/i;a.punycode_expression=/(xn--)/i;a.ip4_expression=/^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/;a.ip6_expression=/^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/;a.find_uri_expression=/\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))/gi;a.findUri={start:/\\b(?:([a-z][a-z0-9.+-]*:\\/\\/)|www\\.)/gi,end:/[\\s\\r\\n]|$/,trim:/[`!()\\[\\]{};:'\".,<>?«»“”„‘’]+$/};a.defaultPorts={http:\"80\",https:\"443\",ftp:\"21\",gopher:\"70\",ws:\"80\",wss:\"443\"};a.invalid_hostname_characters=/[^a-zA-Z0-9\\.-]/;a.domAttributes={a:\"href\",blockquote:\"cite\",link:\"href\",base:\"href\",script:\"src\",form:\"action\",img:\"src\",area:\"href\",iframe:\"src\",embed:\"src\",source:\"src\",track:\"src\",input:\"src\",audio:\"src\",video:\"src\"};a.getDomAttribute=function(e){if(!e||!e.nodeName){return undefined}var t=e.nodeName.toLowerCase();if(t===\"input\"&&e.type!==\"image\"){return undefined}return a.domAttributes[t]};function p(e){return escape(e)}function m(e){return encodeURIComponent(e).replace(/[!'()*]/g,p).replace(/\\*/g,\"%2A\")}a.encode=m;a.decode=decodeURIComponent;a.iso8859=function(){a.encode=escape;a.decode=unescape};a.unicode=function(){a.encode=m;a.decode=decodeURIComponent};a.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{\"%24\":\"$\",\"%26\":\"&\",\"%2B\":\"+\",\"%2C\":\",\",\"%3B\":\";\",\"%3D\":\"=\",\"%3A\":\":\",\"%40\":\"@\"}},decode:{expression:/[\\/\\?#]/g,map:{\"/\":\"%2F\",\"?\":\"%3F\",\"#\":\"%23\"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{\"%3A\":\":\",\"%2F\":\"/\",\"%3F\":\"?\",\"%23\":\"#\",\"%5B\":\"[\",\"%5D\":\"]\",\"%40\":\"@\",\"%21\":\"!\",\"%24\":\"$\",\"%26\":\"&\",\"%27\":\"'\",\"%28\":\"(\",\"%29\":\")\",\"%2A\":\"*\",\"%2B\":\"+\",\"%2C\":\",\",\"%3B\":\";\",\"%3D\":\"=\"}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{\"%21\":\"!\",\"%24\":\"$\",\"%27\":\"'\",\"%28\":\"(\",\"%29\":\")\",\"%2A\":\"*\",\"%2B\":\"+\",\"%2C\":\",\",\"%3B\":\";\",\"%3D\":\"=\",\"%40\":\"@\"}},decode:{expression:/[\\/\\?#:]/g,map:{\"/\":\"%2F\",\"?\":\"%3F\",\"#\":\"%23\",\":\":\"%3A\"}}}};a.encodeQuery=function(e,t){var r=a.encode(e+\"\");if(t===undefined){t=a.escapeQuerySpace}return t?r.replace(/%20/g,\"+\"):r};a.decodeQuery=function(e,t){e+=\"\";if(t===undefined){t=a.escapeQuerySpace}try{return a.decode(t?e.replace(/\\+/g,\"%20\"):e)}catch(t){return e}};var w={encode:\"encode\",decode:\"decode\"};var y;var g=function(e,t){return function(r){try{return a[t](r+\"\").replace(a.characters[e][t].expression,function(r){return a.characters[e][t].map[r]})}catch(e){return r}}};for(y in w){a[y+\"PathSegment\"]=g(\"pathname\",w[y]);a[y+\"UrnPathSegment\"]=g(\"urnpath\",w[y])}var S=function(e,t,r){return function(n){var i;if(!r){i=a[t]}else{i=function(e){return a[t](a[r](e))}}var o=(n+\"\").split(e);for(var s=0,u=o.length;s<u;s++){o[s]=i(o[s])}return o.join(e)}};a.decodePath=S(\"/\",\"decodePathSegment\");a.decodeUrnPath=S(\":\",\"decodeUrnPathSegment\");a.recodePath=S(\"/\",\"encodePathSegment\",\"decode\");a.recodeUrnPath=S(\":\",\"encodeUrnPathSegment\",\"decode\");a.encodeReserved=g(\"reserved\",\"encode\");a.parse=function(e,t){var r;if(!t){t={}}r=e.indexOf(\"#\");if(r>-1){t.fragment=e.substring(r+1)||null;e=e.substring(0,r)}r=e.indexOf(\"?\");if(r>-1){t.query=e.substring(r+1)||null;e=e.substring(0,r)}if(e.substring(0,2)===\"//\"){t.protocol=null;e=e.substring(2);e=a.parseAuthority(e,t)}else{r=e.indexOf(\":\");if(r>-1){t.protocol=e.substring(0,r)||null;if(t.protocol&&!t.protocol.match(a.protocol_expression)){t.protocol=undefined}else if(e.substring(r+1,r+3)===\"//\"){e=e.substring(r+3);e=a.parseAuthority(e,t)}else{e=e.substring(r+1);t.urn=true}}}t.path=e;return t};a.parseHost=function(e,t){e=e.replace(/\\\\/g,\"/\");var r=e.indexOf(\"/\");var n;var i;if(r===-1){r=e.length}if(e.charAt(0)===\"[\"){n=e.indexOf(\"]\");t.hostname=e.substring(1,n)||null;t.port=e.substring(n+2,r)||null;if(t.port===\"/\"){t.port=null}}else{var a=e.indexOf(\":\");var o=e.indexOf(\"/\");var s=e.indexOf(\":\",a+1);if(s!==-1&&(o===-1||s<o)){t.hostname=e.substring(0,r)||null;t.port=null}else{i=e.substring(0,r).split(\":\");t.hostname=i[0]||null;t.port=i[1]||null}}if(t.hostname&&e.substring(r).charAt(0)!==\"/\"){r++;e=\"/\"+e}return e.substring(r)||\"/\"};a.parseAuthority=function(e,t){e=a.parseUserinfo(e,t);return a.parseHost(e,t)};a.parseUserinfo=function(e,t){var r=e.indexOf(\"/\");var n=e.lastIndexOf(\"@\",r>-1?r:e.length-1);var i;if(n>-1&&(r===-1||n<r)){i=e.substring(0,n).split(\":\");\nt.username=i[0]?a.decode(i[0]):null;i.shift();t.password=i[0]?a.decode(i.join(\":\")):null;e=e.substring(n+1)}else{t.username=null;t.password=null}return e};a.parseQuery=function(e,t){if(!e){return{}}e=e.replace(/&+/g,\"&\").replace(/^\\?*&*|&+$/g,\"\");if(!e){return{}}var r={};var n=e.split(\"&\");var i=n.length;var o,u,f;for(var c=0;c<i;c++){o=n[c].split(\"=\");u=a.decodeQuery(o.shift(),t);f=o.length?a.decodeQuery(o.join(\"=\"),t):null;if(s.call(r,u)){if(typeof r[u]===\"string\"||r[u]===null){r[u]=[r[u]]}r[u].push(f)}else{r[u]=f}}return r};a.build=function(e){var t=\"\";if(e.protocol){t+=e.protocol+\":\"}if(!e.urn&&(t||e.hostname)){t+=\"//\"}t+=a.buildAuthority(e)||\"\";if(typeof e.path===\"string\"){if(e.path.charAt(0)!==\"/\"&&typeof e.hostname===\"string\"){t+=\"/\"}t+=e.path}if(typeof e.query===\"string\"&&e.query){t+=\"?\"+e.query}if(typeof e.fragment===\"string\"&&e.fragment){t+=\"#\"+e.fragment}return t};a.buildHost=function(e){var t=\"\";if(!e.hostname){return\"\"}else if(a.ip6_expression.test(e.hostname)){t+=\"[\"+e.hostname+\"]\"}else{t+=e.hostname}if(e.port){t+=\":\"+e.port}return t};a.buildAuthority=function(e){return a.buildUserinfo(e)+a.buildHost(e)};a.buildUserinfo=function(e){var t=\"\";if(e.username){t+=a.encode(e.username)}if(e.password){t+=\":\"+a.encode(e.password)}if(t){t+=\"@\"}return t};a.buildQuery=function(e,t,r){var n=\"\";var i,o,u,f;for(o in e){if(s.call(e,o)&&o){if(c(e[o])){i={};for(u=0,f=e[o].length;u<f;u++){if(e[o][u]!==undefined&&i[e[o][u]+\"\"]===undefined){n+=\"&\"+a.buildQueryParameter(o,e[o][u],r);if(t!==true){i[e[o][u]+\"\"]=true}}}}else if(e[o]!==undefined){n+=\"&\"+a.buildQueryParameter(o,e[o],r)}}}return n.substring(1)};a.buildQueryParameter=function(e,t,r){return a.encodeQuery(e,r)+(t!==null?\"=\"+a.encodeQuery(t,r):\"\")};a.addQuery=function(e,t,r){if(typeof t===\"object\"){for(var n in t){if(s.call(t,n)){a.addQuery(e,n,t[n])}}}else if(typeof t===\"string\"){if(e[t]===undefined){e[t]=r;return}else if(typeof e[t]===\"string\"){e[t]=[e[t]]}if(!c(r)){r=[r]}e[t]=(e[t]||[]).concat(r)}else{throw new TypeError(\"URI.addQuery() accepts an object, string as the name parameter\")}};a.removeQuery=function(e,t,r){var n,i,o;if(c(t)){for(n=0,i=t.length;n<i;n++){e[t[n]]=undefined}}else if(f(t)===\"RegExp\"){for(o in e){if(t.test(o)){e[o]=undefined}}}else if(typeof t===\"object\"){for(o in t){if(s.call(t,o)){a.removeQuery(e,o,t[o])}}}else if(typeof t===\"string\"){if(r!==undefined){if(f(r)===\"RegExp\"){if(!c(e[t])&&r.test(e[t])){e[t]=undefined}else{e[t]=l(e[t],r)}}else if(e[t]===String(r)&&(!c(r)||r.length===1)){e[t]=undefined}else if(c(e[t])){e[t]=l(e[t],r)}}else{e[t]=undefined}}else{throw new TypeError(\"URI.removeQuery() accepts an object, string, RegExp as the first parameter\")}};a.hasQuery=function(e,t,r,n){switch(f(t)){case\"String\":break;case\"RegExp\":for(var i in e){if(s.call(e,i)){if(t.test(i)&&(r===undefined||a.hasQuery(e,i,r))){return true}}}return false;case\"Object\":for(var o in t){if(s.call(t,o)){if(!a.hasQuery(e,o,t[o])){return false}}}return true;default:throw new TypeError(\"URI.hasQuery() accepts a string, regular expression or object as the name parameter\")}switch(f(r)){case\"Undefined\":return t in e;case\"Boolean\":var u=Boolean(c(e[t])?e[t].length:e[t]);return r===u;case\"Function\":return!!r(e[t],t,e);case\"Array\":if(!c(e[t])){return false}var l=n?d:h;return l(e[t],r);case\"RegExp\":if(!c(e[t])){return Boolean(e[t]&&e[t].match(r))}if(!n){return false}return d(e[t],r);case\"Number\":r=String(r);case\"String\":if(!c(e[t])){return e[t]===r}if(!n){return false}return d(e[t],r);default:throw new TypeError(\"URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter\")}};a.joinPaths=function(){var e=[];var t=[];var r=0;for(var n=0;n<arguments.length;n++){var i=new a(arguments[n]);e.push(i);var o=i.segment();for(var s=0;s<o.length;s++){if(typeof o[s]===\"string\"){t.push(o[s])}if(o[s]){r++}}}if(!t.length||!r){return new a(\"\")}var u=new a(\"\").segment(t);if(e[0].path()===\"\"||e[0].path().slice(0,1)===\"/\"){u.path(\"/\"+u.path())}return u.normalize()};a.commonPath=function(e,t){var r=Math.min(e.length,t.length);var n;for(n=0;n<r;n++){if(e.charAt(n)!==t.charAt(n)){n--;break}}if(n<1){return e.charAt(0)===t.charAt(0)&&e.charAt(0)===\"/\"?\"/\":\"\"}if(e.charAt(n)!==\"/\"||t.charAt(n)!==\"/\"){n=e.substring(0,n).lastIndexOf(\"/\")}return e.substring(0,n+1)};a.withinString=function(e,t,r){r||(r={});var n=r.start||a.findUri.start;var i=r.end||a.findUri.end;var o=r.trim||a.findUri.trim;var s=/[a-z0-9-]=[\"']?$/i;n.lastIndex=0;while(true){var u=n.exec(e);if(!u){break}var f=u.index;if(r.ignoreHtml){var c=e.slice(Math.max(f-3,0),f);if(c&&s.test(c)){continue}}var l=f+e.slice(f).search(i);var d=e.slice(f,l).replace(o,\"\");if(r.ignore&&r.ignore.test(d)){continue}l=f+d.length;var h=t(d,f,l,e);e=e.slice(0,f)+h+e.slice(l);n.lastIndex=f+h.length}n.lastIndex=0;return e};a.ensureValidHostname=function(t){if(t.match(a.invalid_hostname_characters)){if(!e){throw new TypeError('Hostname \"'+t+'\" contains characters other than [A-Z0-9.-] and Punycode.js is not available')}if(e.toASCII(t).match(a.invalid_hostname_characters)){throw new TypeError('Hostname \"'+t+'\" contains characters other than [A-Z0-9.-]')}}};a.noConflict=function(e){if(e){var t={URI:this.noConflict()};if(n.URITemplate&&typeof n.URITemplate.noConflict===\"function\"){t.URITemplate=n.URITemplate.noConflict()}if(n.IPv6&&typeof n.IPv6.noConflict===\"function\"){t.IPv6=n.IPv6.noConflict()}if(n.SecondLevelDomains&&typeof n.SecondLevelDomains.noConflict===\"function\"){t.SecondLevelDomains=n.SecondLevelDomains.noConflict()}return t}else if(n.URI===this){n.URI=i}return this};o.build=function(e){if(e===true){this._deferred_build=true}else if(e===undefined||this._deferred_build){this._string=a.build(this._parts);this._deferred_build=false}return this};o.clone=function(){return new a(this)};o.valueOf=o.toString=function(){return this.build(false)._string};function b(e){return function(t,r){if(t===undefined){return this._parts[e]||\"\"}else{this._parts[e]=t||null;this.build(!r);return this}}}function T(e,t){return function(r,n){if(r===undefined){return this._parts[e]||\"\"}else{if(r!==null){r=r+\"\";if(r.charAt(0)===t){r=r.substring(1)}}this._parts[e]=r;this.build(!n);return this}}}o.protocol=b(\"protocol\");o.username=b(\"username\");o.password=b(\"password\");o.hostname=b(\"hostname\");o.port=b(\"port\");o.query=T(\"query\",\"?\");o.fragment=T(\"fragment\",\"#\");o.search=function(e,t){var r=this.query(e,t);return typeof r===\"string\"&&r.length?\"?\"+r:r};o.hash=function(e,t){var r=this.fragment(e,t);return typeof r===\"string\"&&r.length?\"#\"+r:r};o.pathname=function(e,t){if(e===undefined||e===true){var r=this._parts.path||(this._parts.hostname?\"/\":\"\");return e?(this._parts.urn?a.decodeUrnPath:a.decodePath)(r):r}else{if(this._parts.urn){this._parts.path=e?a.recodeUrnPath(e):\"\"}else{this._parts.path=e?a.recodePath(e):\"/\"}this.build(!t);return this}};o.path=o.pathname;o.href=function(e,t){var r;if(e===undefined){return this.toString()}this._string=\"\";this._parts=a._parts();var n=e instanceof a;var i=typeof e===\"object\"&&(e.hostname||e.path||e.pathname);if(e.nodeName){var o=a.getDomAttribute(e);e=e[o]||\"\";i=false}if(!n&&i&&e.pathname!==undefined){e=e.toString()}if(typeof e===\"string\"||e instanceof String){this._parts=a.parse(String(e),this._parts)}else if(n||i){var u=n?e._parts:e;for(r in u){if(s.call(this._parts,r)){this._parts[r]=u[r]}}}else{throw new TypeError(\"invalid input\")}this.build(!t);return this};o.is=function(e){var t=false;var n=false;var i=false;var o=false;var s=false;var u=false;var f=false;var c=!this._parts.urn;if(this._parts.hostname){c=false;n=a.ip4_expression.test(this._parts.hostname);i=a.ip6_expression.test(this._parts.hostname);t=n||i;o=!t;s=o&&r&&r.has(this._parts.hostname);u=o&&a.idn_expression.test(this._parts.hostname);f=o&&a.punycode_expression.test(this._parts.hostname)}switch(e.toLowerCase()){case\"relative\":return c;case\"absolute\":return!c;case\"domain\":case\"name\":return o;case\"sld\":return s;case\"ip\":return t;case\"ip4\":case\"ipv4\":case\"inet4\":return n;case\"ip6\":case\"ipv6\":case\"inet6\":return i;case\"idn\":return u;case\"url\":return!this._parts.urn;case\"urn\":return!!this._parts.urn;case\"punycode\":return f}return null};var _=o.protocol;var E=o.port;var M=o.hostname;o.protocol=function(e,t){if(e!==undefined){if(e){e=e.replace(/:(\\/\\/)?$/,\"\");if(!e.match(a.protocol_expression)){throw new TypeError('Protocol \"'+e+\"\\\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]\")}}}return _.call(this,e,t)};o.scheme=o.protocol;o.port=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e!==undefined){if(e===0){e=null}if(e){e+=\"\";if(e.charAt(0)===\":\"){e=e.substring(1)}if(e.match(/[^0-9]/)){throw new TypeError('Port \"'+e+'\" contains characters other than [0-9]')}}}return E.call(this,e,t)};o.hostname=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e!==undefined){var r={};var n=a.parseHost(e,r);if(n!==\"/\"){throw new TypeError('Hostname \"'+e+'\" contains characters other than [A-Z0-9.-]')}e=r.hostname}return M.call(this,e,t)};o.origin=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e===undefined){var r=this.protocol();var n=this.authority();if(!n){return\"\"}return(r?r+\"://\":\"\")+this.authority()}else{var i=a(e);this.protocol(i.protocol()).authority(i.authority()).build(!t);return this}};o.host=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e===undefined){return this._parts.hostname?a.buildHost(this._parts):\"\"}else{var r=a.parseHost(e,this._parts);if(r!==\"/\"){throw new TypeError('Hostname \"'+e+'\" contains characters other than [A-Z0-9.-]')}this.build(!t);return this}};o.authority=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e===undefined){return this._parts.hostname?a.buildAuthority(this._parts):\"\"}else{var r=a.parseAuthority(e,this._parts);if(r!==\"/\"){throw new TypeError('Hostname \"'+e+'\" contains characters other than [A-Z0-9.-]')}this.build(!t);return this}};o.userinfo=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e===undefined){var r=a.buildUserinfo(this._parts);return r?r.substring(0,r.length-1):r}else{if(e[e.length-1]!==\"@\"){e+=\"@\"}a.parseUserinfo(e,this._parts);this.build(!t);return this}};o.resource=function(e,t){var r;if(e===undefined){return this.path()+this.search()+this.hash()}r=a.parse(e);this._parts.path=r.path;this._parts.query=r.query;this._parts.fragment=r.fragment;this.build(!t);return this};o.subdomain=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e===undefined){if(!this._parts.hostname||this.is(\"IP\")){return\"\"}var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||\"\"}else{var n=this._parts.hostname.length-this.domain().length;var i=this._parts.hostname.substring(0,n);var o=new RegExp(\"^\"+u(i));if(e&&e.charAt(e.length-1)!==\".\"){e+=\".\"}if(e){a.ensureValidHostname(e)}this._parts.hostname=this._parts.hostname.replace(o,e);this.build(!t);return this}};o.domain=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(typeof e===\"boolean\"){t=e;e=undefined}if(e===undefined){if(!this._parts.hostname||this.is(\"IP\")){return\"\"}var r=this._parts.hostname.match(/\\./g);if(r&&r.length<2){return this._parts.hostname}var n=this._parts.hostname.length-this.tld(t).length-1;n=this._parts.hostname.lastIndexOf(\".\",n-1)+1;return this._parts.hostname.substring(n)||\"\"}else{if(!e){throw new TypeError(\"cannot set domain empty\")}a.ensureValidHostname(e);if(!this._parts.hostname||this.is(\"IP\")){this._parts.hostname=e}else{var i=new RegExp(u(this.domain())+\"$\");this._parts.hostname=this._parts.hostname.replace(i,e)}this.build(!t);return this}};o.tld=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(typeof e===\"boolean\"){t=e;e=undefined}if(e===undefined){if(!this._parts.hostname||this.is(\"IP\")){return\"\"}var n=this._parts.hostname.lastIndexOf(\".\");var i=this._parts.hostname.substring(n+1);if(t!==true&&r&&r.list[i.toLowerCase()]){return r.get(this._parts.hostname)||i}return i}else{var a;if(!e){throw new TypeError(\"cannot set TLD empty\")}else if(e.match(/[^a-zA-Z0-9-]/)){if(r&&r.is(e)){a=new RegExp(u(this.tld())+\"$\");this._parts.hostname=this._parts.hostname.replace(a,e)}else{throw new TypeError('TLD \"'+e+'\" contains characters other than [A-Z0-9]')}}else if(!this._parts.hostname||this.is(\"IP\")){throw new ReferenceError(\"cannot set TLD on non-domain host\")}else{a=new RegExp(u(this.tld())+\"$\");this._parts.hostname=this._parts.hostname.replace(a,e)}this.build(!t);return this}};o.directory=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e===undefined||e===true){if(!this._parts.path&&!this._parts.hostname){return\"\"}if(this._parts.path===\"/\"){return\"/\"}var r=this._parts.path.length-this.filename().length-1;var n=this._parts.path.substring(0,r)||(this._parts.hostname?\"/\":\"\");return e?a.decodePath(n):n}else{var i=this._parts.path.length-this.filename().length;var o=this._parts.path.substring(0,i);var s=new RegExp(\"^\"+u(o));if(!this.is(\"relative\")){if(!e){e=\"/\"}if(e.charAt(0)!==\"/\"){e=\"/\"+e}}if(e&&e.charAt(e.length-1)!==\"/\"){e+=\"/\"}e=a.recodePath(e);this._parts.path=this._parts.path.replace(s,e);this.build(!t);return this}};o.filename=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e===undefined||e===true){if(!this._parts.path||this._parts.path===\"/\"){return\"\"}var r=this._parts.path.lastIndexOf(\"/\");var n=this._parts.path.substring(r+1);return e?a.decodePathSegment(n):n}else{var i=false;if(e.charAt(0)===\"/\"){e=e.substring(1)}if(e.match(/\\.?\\//)){i=true}var o=new RegExp(u(this.filename())+\"$\");e=a.recodePath(e);this._parts.path=this._parts.path.replace(o,e);if(i){this.normalizePath(t)}else{this.build(!t)}return this}};o.suffix=function(e,t){if(this._parts.urn){return e===undefined?\"\":this}if(e===undefined||e===true){if(!this._parts.path||this._parts.path===\"/\"){return\"\"}var r=this.filename();var n=r.lastIndexOf(\".\");var i,o;if(n===-1){return\"\"}i=r.substring(n+1);o=/^[a-z0-9%]+$/i.test(i)?i:\"\";return e?a.decodePathSegment(o):o}else{if(e.charAt(0)===\".\"){e=e.substring(1)}var s=this.suffix();var f;if(!s){if(!e){return this}this._parts.path+=\".\"+a.recodePath(e)}else if(!e){f=new RegExp(u(\".\"+s)+\"$\")}else{f=new RegExp(u(s)+\"$\")}if(f){e=a.recodePath(e);this._parts.path=this._parts.path.replace(f,e)}this.build(!t);return this}};o.segment=function(e,t,r){var n=this._parts.urn?\":\":\"/\";var i=this.path();var a=i.substring(0,1)===\"/\";var o=i.split(n);if(e!==undefined&&typeof e!==\"number\"){r=t;t=e;e=undefined}if(e!==undefined&&typeof e!==\"number\"){throw new Error('Bad segment \"'+e+'\", must be 0-based integer')}if(a){o.shift()}if(e<0){e=Math.max(o.length+e,0)}if(t===undefined){return e===undefined?o:o[e]}else if(e===null||o[e]===undefined){if(c(t)){o=[];for(var s=0,u=t.length;s<u;s++){if(!t[s].length&&(!o.length||!o[o.length-1].length)){continue}if(o.length&&!o[o.length-1].length){o.pop()}o.push(v(t[s]))}}else if(t||typeof t===\"string\"){t=v(t);if(o[o.length-1]===\"\"){o[o.length-1]=t}else{o.push(t)}}}else{if(t){o[e]=v(t)}else{o.splice(e,1)}}if(a){o.unshift(\"\")}return this.path(o.join(n),r)};o.segmentCoded=function(e,t,r){var n,i,o;if(typeof e!==\"number\"){r=t;t=e;e=undefined}if(t===undefined){n=this.segment(e,t,r);if(!c(n)){n=n!==undefined?a.decode(n):undefined}else{for(i=0,o=n.length;i<o;i++){n[i]=a.decode(n[i])}}return n}if(!c(t)){t=typeof t===\"string\"||t instanceof String?a.encode(t):t}else{for(i=0,o=t.length;i<o;i++){t[i]=a.encode(t[i])}}return this.segment(e,t,r)};var P=o.query;o.query=function(e,t){if(e===true){return a.parseQuery(this._parts.query,this._parts.escapeQuerySpace)}else if(typeof e===\"function\"){var r=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);var n=e.call(this,r);this._parts.query=a.buildQuery(n||r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!t);return this}else if(e!==undefined&&typeof e!==\"string\"){this._parts.query=a.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!t);return this}else{return P.call(this,e,t)}};o.setQuery=function(e,t,r){var n=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof e===\"string\"||e instanceof String){n[e]=t!==undefined?t:null}else if(typeof e===\"object\"){for(var i in e){if(s.call(e,i)){n[i]=e[i]}}}else{throw new TypeError(\"URI.addQuery() accepts an object, string as the name parameter\")}this._parts.query=a.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof e!==\"string\"){r=t}this.build(!r);return this};o.addQuery=function(e,t,r){var n=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);a.addQuery(n,e,t===undefined?null:t);this._parts.query=a.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof e!==\"string\"){r=t}this.build(!r);return this};o.removeQuery=function(e,t,r){var n=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);a.removeQuery(n,e,t);this._parts.query=a.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof e!==\"string\"){r=t}this.build(!r);return this};o.hasQuery=function(e,t,r){var n=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.hasQuery(n,e,t,r)};o.setSearch=o.setQuery;o.addSearch=o.addQuery;o.removeSearch=o.removeQuery;o.hasSearch=o.hasQuery;o.normalize=function(){if(this._parts.urn){return this.normalizeProtocol(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build()}return this.normalizeProtocol(false).normalizeHostname(false).normalizePort(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build()};o.normalizeProtocol=function(e){if(typeof this._parts.protocol===\"string\"){this._parts.protocol=this._parts.protocol.toLowerCase();this.build(!e)}return this};o.normalizeHostname=function(r){if(this._parts.hostname){if(this.is(\"IDN\")&&e){this._parts.hostname=e.toASCII(this._parts.hostname)}else if(this.is(\"IPv6\")&&t){this._parts.hostname=t.best(this._parts.hostname)}this._parts.hostname=this._parts.hostname.toLowerCase();this.build(!r)}return this};o.normalizePort=function(e){if(typeof this._parts.protocol===\"string\"&&this._parts.port===a.defaultPorts[this._parts.protocol]){this._parts.port=null;this.build(!e)}return this};o.normalizePath=function(e){var t=this._parts.path;if(!t){return this}if(this._parts.urn){this._parts.path=a.recodeUrnPath(this._parts.path);this.build(!e);return this}if(this._parts.path===\"/\"){return this}t=a.recodePath(t);var r;var n=\"\";var i,o;if(t.charAt(0)!==\"/\"){r=true;t=\"/\"+t}if(t.slice(-3)===\"/..\"||t.slice(-2)===\"/.\"){t+=\"/\"}t=t.replace(/(\\/(\\.\\/)+)|(\\/\\.$)/g,\"/\").replace(/\\/{2,}/g,\"/\");if(r){n=t.substring(1).match(/^(\\.\\.\\/)+/)||\"\";if(n){n=n[0]}}while(true){i=t.search(/\\/\\.\\.(\\/|$)/);if(i===-1){break}else if(i===0){t=t.substring(3);continue}o=t.substring(0,i).lastIndexOf(\"/\");if(o===-1){o=i}t=t.substring(0,o)+t.substring(i+3)}if(r&&this.is(\"relative\")){t=n+t.substring(1)}this._parts.path=t;this.build(!e);return this};o.normalizePathname=o.normalizePath;o.normalizeQuery=function(e){if(typeof this._parts.query===\"string\"){if(!this._parts.query.length){this._parts.query=null}else{this.query(a.parseQuery(this._parts.query,this._parts.escapeQuerySpace))}this.build(!e)}return this};o.normalizeFragment=function(e){if(!this._parts.fragment){this._parts.fragment=null;this.build(!e)}return this};o.normalizeSearch=o.normalizeQuery;o.normalizeHash=o.normalizeFragment;o.iso8859=function(){var e=a.encode;var t=a.decode;a.encode=escape;a.decode=decodeURIComponent;try{this.normalize()}finally{a.encode=e;a.decode=t}return this};o.unicode=function(){var e=a.encode;var t=a.decode;a.encode=m;a.decode=unescape;try{this.normalize()}finally{a.encode=e;a.decode=t}return this};o.readable=function(){var t=this.clone();t.username(\"\").password(\"\").normalize();var r=\"\";if(t._parts.protocol){r+=t._parts.protocol+\"://\"}if(t._parts.hostname){if(t.is(\"punycode\")&&e){r+=e.toUnicode(t._parts.hostname);if(t._parts.port){r+=\":\"+t._parts.port}}else{r+=t.host()}}if(t._parts.hostname&&t._parts.path&&t._parts.path.charAt(0)!==\"/\"){r+=\"/\"}r+=t.path(true);if(t._parts.query){var n=\"\";for(var i=0,o=t._parts.query.split(\"&\"),s=o.length;i<s;i++){var u=(o[i]||\"\").split(\"=\");n+=\"&\"+a.decodeQuery(u[0],this._parts.escapeQuerySpace).replace(/&/g,\"%26\");if(u[1]!==undefined){n+=\"=\"+a.decodeQuery(u[1],this._parts.escapeQuerySpace).replace(/&/g,\"%26\")}}r+=\"?\"+n.substring(1)}r+=a.decodeQuery(t.hash(),true);return r};o.absoluteTo=function(e){var t=this.clone();var r=[\"protocol\",\"username\",\"password\",\"hostname\",\"port\"];var n,i,o;if(this._parts.urn){throw new Error(\"URNs do not have any generally defined hierarchical components\")}if(!(e instanceof a)){e=new a(e)}if(!t._parts.protocol){t._parts.protocol=e._parts.protocol}if(this._parts.hostname){return t}for(i=0;o=r[i];i++){t._parts[o]=e._parts[o]}if(!t._parts.path){t._parts.path=e._parts.path;if(!t._parts.query){t._parts.query=e._parts.query}}else if(t._parts.path.substring(-2)===\"..\"){t._parts.path+=\"/\"}if(t.path().charAt(0)!==\"/\"){n=e.directory();n=n?n:e.path().indexOf(\"/\")===0?\"/\":\"\";t._parts.path=(n?n+\"/\":\"\")+t._parts.path;t.normalizePath()}t.build();return t};o.relativeTo=function(e){var t=this.clone().normalize();var r,n,i,o,s;if(t._parts.urn){throw new Error(\"URNs do not have any generally defined hierarchical components\")}e=new a(e).normalize();r=t._parts;n=e._parts;o=t.path();s=e.path();if(o.charAt(0)!==\"/\"){throw new Error(\"URI is already relative\")}if(s.charAt(0)!==\"/\"){throw new Error(\"Cannot calculate a URI relative to another relative URI\")}if(r.protocol===n.protocol){r.protocol=null}if(r.username!==n.username||r.password!==n.password){return t.build()}if(r.protocol!==null||r.username!==null||r.password!==null){return t.build()}if(r.hostname===n.hostname&&r.port===n.port){r.hostname=null;r.port=null}else{return t.build()}if(o===s){r.path=\"\";return t.build()}i=a.commonPath(o,s);if(!i){return t.build()}var u=n.path.substring(i.length).replace(/[^\\/]*$/,\"\").replace(/.*?\\//g,\"../\");r.path=u+r.path.substring(i.length)||\"./\";return t.build()};o.equals=function(e){var t=this.clone();var r=new a(e);var n={};var i={};var o={};var u,f,l;t.normalize();r.normalize();if(t.toString()===r.toString()){return true}u=t.query();f=r.query();t.query(\"\");r.query(\"\");if(t.toString()!==r.toString()){return false}if(u.length!==f.length){return false}n=a.parseQuery(u,this._parts.escapeQuerySpace);i=a.parseQuery(f,this._parts.escapeQuerySpace);for(l in n){if(s.call(n,l)){if(!c(n[l])){if(n[l]!==i[l]){return false}}else if(!h(n[l],i[l])){return false}o[l]=true}}for(l in i){if(s.call(i,l)){if(!o[l]){return false}}}return true};o.duplicateQueryParameters=function(e){this._parts.duplicateQueryParameters=!!e;return this};o.escapeQuerySpace=function(e){this._parts.escapeQuerySpace=!!e;return this};return a})})();e.registerDynamic(\"8\",[],true,function(e,t,r){var n,i=this||self,a=i;(function(e,t){e(function(){\"use strict\";var e={};e.mobileDetectRules={phones:{iPhone:\"\\\\biPhone\\\\b|\\\\biPod\\\\b\",BlackBerry:\"BlackBerry|\\\\bBB10\\\\b|rim[0-9]+\",HTC:\"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\\\bEVO\\\\b|T-Mobile G1|Z520m\",Nexus:\"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6\",Dell:\"Dell.*Streak|Dell.*Aero|Dell.*Venue|DELL.*Venue Pro|Dell Flash|Dell Smoke|Dell Mini 3iX|XCD28|XCD35|\\\\b001DL\\\\b|\\\\b101DL\\\\b|\\\\bGS01\\\\b\",Motorola:\"Motorola|DROIDX|DROID BIONIC|\\\\bDroid\\\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\\\bMoto E\\\\b\",Samsung:\"Samsung|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350\",LG:\"\\\\bLG\\\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323)\",Sony:\"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533\",Asus:\"Asus.*Galaxy|PadFone.*Mobile\",Micromax:\"Micromax.*\\\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\\\b\",Palm:\"PalmSource|Palm\",Vertu:\"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature\",Pantech:\"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790\",Fly:\"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250\",Wiko:\"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM\",iMobile:\"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)\",SimValley:\"\\\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\\\b\",Wolfgang:\"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q\",Alcatel:\"Alcatel\",Nintendo:\"Nintendo 3DS\",Amoi:\"Amoi\",INQ:\"INQ\",GenericPhone:\"Tapatalk|PDA;|SAGEM|\\\\bmmp\\\\b|pocket|\\\\bpsp\\\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\\\bwap\\\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser\"},tablets:{iPad:\"iPad|iPad.*Mobile\",NexusTablet:\"Android.*Nexus[\\\\s]+(7|9|10)\",SamsungTablet:\"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561\",\nKindle:\"Kindle|Silk.*Accelerated|Android.*\\\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI)\\\\b\",SurfaceTablet:\"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)\",HPTablet:\"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10\",AsusTablet:\"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\\\bK00F\\\\b|\\\\bK00C\\\\b|\\\\bK00E\\\\b|\\\\bK00L\\\\b|TX201LA|ME176C|ME102A|\\\\bM80TA\\\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K017 |ME572C|ME103K|ME170C|ME171C|\\\\bME70C\\\\b|ME581C|ME581CL|ME8510C|ME181C\",BlackBerryTablet:\"PlayBook|RIM Tablet\",HTCtablet:\"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410\",MotorolaTablet:\"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617\",NookTablet:\"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2\",AcerTablet:\"Android.*; \\\\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\\\b|W3-810|\\\\bA3-A10\\\\b|\\\\bA3-A11\\\\b\",ToshibaTablet:\"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO\",LGTablet:\"\\\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\\\b\",FujitsuTablet:\"Android.*\\\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\\\b\",PrestigioTablet:\"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002\",LenovoTablet:\"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)\",DellTablet:\"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7\",YarvikTablet:\"Android.*\\\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\\\b\",MedionTablet:\"Android.*\\\\bOYO\\\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB\",ArnovaTablet:\"AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2\",IntensoTablet:\"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004\",IRUTablet:\"M702pro\",MegafonTablet:\"MegaFon V9|\\\\bZTE V9\\\\b|Android.*\\\\bMT7A\\\\b\",EbodaTablet:\"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)\",AllViewTablet:\"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)\",ArchosTablet:\"\\\\b(101G9|80G9|A101IT)\\\\b|Qilive 97R|Archos5|\\\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\\\b\",AinolTablet:\"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark\",SonyTablet:\"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP612|SOT31\",PhilipsTablet:\"\\\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\\\b\",CubeTablet:\"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT\",CobyTablet:\"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010\",MIDTablet:\"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10\",MSITablet:\"MSI \\\\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\\\b\",SMiTTablet:\"Android.*(\\\\bMID\\\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)\",RockChipTablet:\"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A\",FlyTablet:\"IQ310|Fly Vision\",bqTablet:\"Android.*(bq)?.*(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris E10)|Maxwell.*Lite|Maxwell.*Plus\",HuaweiTablet:\"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim\",NecTablet:\"\\\\bN-06D|\\\\bN-08D\",PantechTablet:\"Pantech.*P4100\",BronchoTablet:\"Broncho.*(N701|N708|N802|a710)\",VersusTablet:\"TOUCHPAD.*[78910]|\\\\bTOUCHTAB\\\\b\",ZyncTablet:\"z1000|Z99 2G|z99|z930|z999|z990|z909|Z919|z900\",PositivoTablet:\"TB07STA|TB10STA|TB07FTA|TB10FTA\",NabiTablet:\"Android.*\\\\bNabi\",KoboTablet:\"Kobo Touch|\\\\bK080\\\\b|\\\\bVox\\\\b Build|\\\\bArc\\\\b Build\",DanewTablet:\"DSlide.*\\\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\\\b\",TexetTablet:\"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE\",PlaystationTablet:\"Playstation.*(Portable|Vita)\",TrekstorTablet:\"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab\",PyleAudioTablet:\"\\\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\\\b\",AdvanTablet:\"Android.* \\\\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\\\b \",DanyTechTablet:\"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1\",GalapadTablet:\"Android.*\\\\bG1\\\\b\",MicromaxTablet:\"Funbook|Micromax.*\\\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\\\b\",KarbonnTablet:\"Android.*\\\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\\\b\",AllFineTablet:\"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide\",PROSCANTablet:\"\\\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\\\b\",YONESTablet:\"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026\",ChangJiaTablet:\"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503\",GUTablet:\"TX-A1301|TX-M9002|Q702|kf026\",PointOfViewTablet:\"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10\",OvermaxTablet:\"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)\",HCLTablet:\"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync\",DPSTablet:\"DPS Dream 9|DPS Dual 7\",VistureTablet:\"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10\",CrestaTablet:\"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989\",MediatekTablet:\"\\\\bMT8125|MT8389|MT8135|MT8377\\\\b\",ConcordeTablet:\"Concorde([ ]+)?Tab|ConCorde ReadMan\",GoCleverTablet:\"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042\",ModecomTablet:\"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003\",VoninoTablet:\"\\\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\\\bQ8\\\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\\\b\",ECSTablet:\"V07OT2|TM105A|S10OT1|TR10CS1\",StorexTablet:\"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab\",VodafoneTablet:\"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7\",EssentielBTablet:\"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2\",RossMoorTablet:\"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711\",iMobileTablet:\"i-mobile i-note\",TolinoTablet:\"tolino tab [0-9.]+|tolino shine\",AudioSonicTablet:\"\\\\bC-22Q|T7-QC|T-17B|T-17P\\\\b\",AMPETablet:\"Android.* A78 \",SkkTablet:\"Android.* (SKYPAD|PHOENIX|CYCLOPS)\",TecnoTablet:\"TECNO P9\",JXDTablet:\"Android.* \\\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\\\b\",iJoyTablet:\"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)\",FX2Tablet:\"FX2 PAD7|FX2 PAD10\",XoroTablet:\"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151\",ViewsonicTablet:\"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a\",OdysTablet:\"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\\\bXELIO\\\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10\",CaptivaTablet:\"CAPTIVA PAD\",IconbitTablet:\"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S\",TeclastTablet:\"T98 4G|\\\\bP80\\\\b|\\\\bX90HD\\\\b|X98 Air|X98 Air 3G|\\\\bX89\\\\b|P80 3G|\\\\bX80h\\\\b|P98 Air|\\\\bX89HD\\\\b|P98 3G|\\\\bP90HD\\\\b|P89 3G|X98 3G|\\\\bP70h\\\\b|P79HD 3G|G18d 3G|\\\\bP79HD\\\\b|\\\\bP89s\\\\b|\\\\bA88\\\\b|\\\\bP10HD\\\\b|\\\\bP19HD\\\\b|G18 3G|\\\\bP78HD\\\\b|\\\\bA78\\\\b|\\\\bP75\\\\b|G17s 3G|G17h 3G|\\\\bP85t\\\\b|\\\\bP90\\\\b|\\\\bP11\\\\b|\\\\bP98t\\\\b|\\\\bP98HD\\\\b|\\\\bG18d\\\\b|\\\\bP85s\\\\b|\\\\bP11HD\\\\b|\\\\bP88s\\\\b|\\\\bA80HD\\\\b|\\\\bA80se\\\\b|\\\\bA10h\\\\b|\\\\bP89\\\\b|\\\\bP78s\\\\b|\\\\bG18\\\\b|\\\\bP85\\\\b|\\\\bA70h\\\\b|\\\\bA70\\\\b|\\\\bG17\\\\b|\\\\bP18\\\\b|\\\\bA80s\\\\b|\\\\bA11s\\\\b|\\\\bP88HD\\\\b|\\\\bA80h\\\\b|\\\\bP76s\\\\b|\\\\bP76h\\\\b|\\\\bP98\\\\b|\\\\bA10HD\\\\b|\\\\bP78\\\\b|\\\\bP88\\\\b|\\\\bA11\\\\b|\\\\bA10t\\\\b|\\\\bP76a\\\\b|\\\\bP76t\\\\b|\\\\bP76e\\\\b|\\\\bP85HD\\\\b|\\\\bP85a\\\\b|\\\\bP86\\\\b|\\\\bP75HD\\\\b|\\\\bP76v\\\\b|\\\\bA12\\\\b|\\\\bP75a\\\\b|\\\\bA15\\\\b|\\\\bP76Ti\\\\b|\\\\bP81HD\\\\b|\\\\bA10\\\\b|\\\\bT760VE\\\\b|\\\\bT720HD\\\\b|\\\\bP76\\\\b|\\\\bP73\\\\b|\\\\bP71\\\\b|\\\\bP72\\\\b|\\\\bT720SE\\\\b|\\\\bC520Ti\\\\b|\\\\bT760\\\\b|\\\\bT720VE\\\\b|T720-3GE|T720-WiFi\",OndaTablet:\"\\\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\\\b[\\\\s]+\",JaytechTablet:\"TPC-PA762\",BlaupunktTablet:\"Endeavour 800NG|Endeavour 1010\",DigmaTablet:\"\\\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\\\b\",EvolioTablet:\"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\\\bEvotab\\\\b|\\\\bNeura\\\\b\",LavaTablet:\"QPAD E704|\\\\bIvoryS\\\\b|E-TAB IVORY|\\\\bE-TAB\\\\b\",AocTablet:\"MW0811|MW0812|MW0922|MTK8382\",MpmanTablet:\"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\\\bMPG7\\\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010\",CelkonTablet:\"CT695|CT888|CT[\\\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\\\bCT-1\\\\b\",WolderTablet:\"miTab \\\\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\\\b\",MiTablet:\"\\\\bMI PAD\\\\b|\\\\bHM NOTE 1W\\\\b\",NibiruTablet:\"Nibiru M1|Nibiru Jupiter One\",NexoTablet:\"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI\",LeaderTablet:\"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100\",UbislateTablet:\"UbiSlate[\\\\s]?7C\",PocketBookTablet:\"Pocketbook\",Hudl:\"Hudl HT7S3|Hudl 2\",TelstraTablet:\"T-Hub2\",GenericTablet:\"Android.*\\\\b97D\\\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\\\bA7EB\\\\b|CatNova8|A1_07|CT704|CT1002|\\\\bM721\\\\b|rk30sdk|\\\\bEVOTAB\\\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\\\bM6pro\\\\b|CT1020W|arc 10HD|\\\\bJolla\\\\b|\\\\bTP750\\\\b\"},oss:{AndroidOS:\"Android\",BlackBerryOS:\"blackberry|\\\\bBB10\\\\b|rim tablet os\",PalmOS:\"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino\",SymbianOS:\"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\\\bS60\\\\b\",WindowsMobileOS:\"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Window Mobile|Windows Phone [0-9.]+|WCE;\",WindowsPhoneOS:\"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;\",iOS:\"\\\\biPhone.*Mobile|\\\\biPod|\\\\biPad\",MeeGoOS:\"MeeGo\",MaemoOS:\"Maemo\",JavaOS:\"J2ME/|\\\\bMIDP\\\\b|\\\\bCLDC\\\\b\",webOS:\"webOS|hpwOS\",badaOS:\"\\\\bBada\\\\b\",BREWOS:\"BREW\"},uas:{Chrome:\"\\\\bCrMo\\\\b|CriOS|Android.*Chrome/[.0-9]* (Mobile)?\",Dolfin:\"\\\\bDolfin\\\\b\",Opera:\"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR/[0-9.]+|Coast/[0-9.]+\",Skyfire:\"Skyfire\",IE:\"IEMobile|MSIEMobile\",Firefox:\"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile\",Bolt:\"bolt\",TeaShark:\"teashark\",Blazer:\"Blazer\",Safari:\"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari\",Tizen:\"Tizen\",UCBrowser:\"UC.*Browser|UCWEB\",baiduboxapp:\"baiduboxapp\",baidubrowser:\"baidubrowser\",DiigoBrowser:\"DiigoBrowser\",Puffin:\"Puffin\",Mercury:\"\\\\bMercury\\\\b\",ObigoBrowser:\"Obigo\",NetFront:\"NF-Browser\",GenericBrowser:\"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger\"},props:{Mobile:\"Mobile/[VER]\",Build:\"Build/[VER]\",Version:\"Version/[VER]\",VendorID:\"VendorID/[VER]\",iPad:\"iPad.*CPU[a-z ]+[VER]\",iPhone:\"iPhone.*CPU[a-z ]+[VER]\",iPod:\"iPod.*CPU[a-z ]+[VER]\",Kindle:\"Kindle/[VER]\",Chrome:[\"Chrome/[VER]\",\"CriOS/[VER]\",\"CrMo/[VER]\"],Coast:[\"Coast/[VER]\"],Dolfin:\"Dolfin/[VER]\",Firefox:\"Firefox/[VER]\",Fennec:\"Fennec/[VER]\",IE:[\"IEMobile/[VER];\",\"IEMobile [VER]\",\"MSIE [VER];\",\"Trident/[0-9.]+;.*rv:[VER]\"],NetFront:\"NetFront/[VER]\",NokiaBrowser:\"NokiaBrowser/[VER]\",Opera:[\" OPR/[VER]\",\"Opera Mini/[VER]\",\"Version/[VER]\"],\"Opera Mini\":\"Opera Mini/[VER]\",\"Opera Mobi\":\"Version/[VER]\",\"UC Browser\":\"UC Browser[VER]\",MQQBrowser:\"MQQBrowser/[VER]\",MicroMessenger:\"MicroMessenger/[VER]\",baiduboxapp:\"baiduboxapp/[VER]\",baidubrowser:\"baidubrowser/[VER]\",Iron:\"Iron/[VER]\",Safari:[\"Version/[VER]\",\"Safari/[VER]\"],Skyfire:\"Skyfire/[VER]\",Tizen:\"Tizen/[VER]\",Webkit:\"webkit[ /][VER]\",Gecko:\"Gecko/[VER]\",Trident:\"Trident/[VER]\",Presto:\"Presto/[VER]\",iOS:\" \\\\bi?OS\\\\b [VER][ ;]{1}\",Android:\"Android [VER]\",BlackBerry:[\"BlackBerry[\\\\w]+/[VER]\",\"BlackBerry.*Version/[VER]\",\"Version/[VER]\"],BREW:\"BREW [VER]\",Java:\"Java/[VER]\",\"Windows Phone OS\":[\"Windows Phone OS [VER]\",\"Windows Phone [VER]\"],\"Windows Phone\":\"Windows Phone [VER]\",\"Windows CE\":\"Windows CE/[VER]\",\"Windows NT\":\"Windows NT [VER]\",Symbian:[\"SymbianOS/[VER]\",\"Symbian/[VER]\"],webOS:[\"webOS/[VER]\",\"hpwOS/[VER];\"]},utils:{Bot:\"Googlebot|facebookexternalhit|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom\",MobileBot:\"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker/M1A1-R2D2\",DesktopMode:\"WPDesktop\",TV:\"SonyDTV|HbbTV\",WebKit:\"(webkit)[ /]([\\\\w.]+)\",Console:\"\\\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|PLAYSTATION|Xbox)\\\\b\",Watch:\"SM-V700\"}};e.detectMobileBrowsers={fullPattern:/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,shortPattern:/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i,tabletPattern:/android|ipad|playbook|silk/i};var r=Object.prototype.hasOwnProperty,n;e.FALLBACK_PHONE=\"UnknownPhone\";e.FALLBACK_TABLET=\"UnknownTablet\";e.FALLBACK_MOBILE=\"UnknownMobile\";n=\"isArray\"in Array?Array.isArray:function(e){return Object.prototype.toString.call(e)===\"[object Array]\"};function i(e,t){return e!=null&&t!=null&&e.toLowerCase()===t.toLowerCase()}function a(e,t){var r,n,i=e.length;if(!i||!t){return false}r=t.toLowerCase();for(n=0;n<i;++n){if(r===e[n].toLowerCase()){return true}}return false}function o(e){for(var t in e){if(r.call(e,t)){e[t]=new RegExp(e[t],\"i\")}}}(function t(){var i,a,s,u,f,c,l=e.mobileDetectRules;for(i in l.props){if(r.call(l.props,i)){a=l.props[i];if(!n(a)){a=[a]}f=a.length;for(u=0;u<f;++u){s=a[u];c=s.indexOf(\"[VER]\");if(c>=0){s=s.substring(0,c)+\"([\\\\w._\\\\+]+)\"+s.substring(c+5)}a[u]=new RegExp(s,\"i\")}l.props[i]=a}}o(l.oss);o(l.phones);o(l.tablets);o(l.uas);o(l.utils);l.oss0={WindowsPhoneOS:l.oss.WindowsPhoneOS,WindowsMobileOS:l.oss.WindowsMobileOS}})();e.findMatch=function(e,t){for(var n in e){if(r.call(e,n)){if(e[n].test(t)){return n}}}return null};e.findMatches=function(e,t){var n=[];for(var i in e){if(r.call(e,i)){if(e[i].test(t)){n.push(i)}}}return n};e.getVersionStr=function(t,n){var i=e.mobileDetectRules.props,a,o,s,u;if(r.call(i,t)){a=i[t];s=a.length;for(o=0;o<s;++o){u=a[o].exec(n);if(u!==null){return u[1]}}}return null};e.getVersion=function(t,r){var n=e.getVersionStr(t,r);return n?e.prepareVersionNo(n):NaN};e.prepareVersionNo=function(e){var t;t=e.split(/[a-z._ \\/\\-]/i);if(t.length===1){e=t[0]}if(t.length>1){e=t[0]+\".\";t.shift();e+=t.join(\"\")}return Number(e)};e.isMobileFallback=function(t){return e.detectMobileBrowsers.fullPattern.test(t)||e.detectMobileBrowsers.shortPattern.test(t.substr(0,4))};e.isTabletFallback=function(t){return e.detectMobileBrowsers.tabletPattern.test(t)};e.prepareDetectionCache=function(r,n,i){if(r.mobile!==t){return}var a,o,u;o=e.findMatch(e.mobileDetectRules.tablets,n);if(o){r.mobile=r.tablet=o;r.phone=null;return}a=e.findMatch(e.mobileDetectRules.phones,n);if(a){r.mobile=r.phone=a;r.tablet=null;return}if(e.isMobileFallback(n)){u=s.isPhoneSized(i);if(u===t){r.mobile=e.FALLBACK_MOBILE;r.tablet=r.phone=null}else if(u){r.mobile=r.phone=e.FALLBACK_PHONE;r.tablet=null}else{r.mobile=r.tablet=e.FALLBACK_TABLET;r.phone=null}}else if(e.isTabletFallback(n)){r.mobile=r.tablet=e.FALLBACK_TABLET;r.phone=null}else{r.mobile=r.tablet=r.phone=null}};e.mobileGrade=function(e){var t=e.mobile()!==null;if(e.os(\"iOS\")&&e.version(\"iPad\")>=4.3||e.os(\"iOS\")&&e.version(\"iPhone\")>=3.1||e.os(\"iOS\")&&e.version(\"iPod\")>=3.1||e.version(\"Android\")>2.1&&e.is(\"Webkit\")||e.version(\"Windows Phone OS\")>=7||e.is(\"BlackBerry\")&&e.version(\"BlackBerry\")>=6||e.match(\"Playbook.*Tablet\")||e.version(\"webOS\")>=1.4&&e.match(\"Palm|Pre|Pixi\")||e.match(\"hp.*TouchPad\")||e.is(\"Firefox\")&&e.version(\"Firefox\")>=12||e.is(\"Chrome\")&&e.is(\"AndroidOS\")&&e.version(\"Android\")>=4||e.is(\"Skyfire\")&&e.version(\"Skyfire\")>=4.1&&e.is(\"AndroidOS\")&&e.version(\"Android\")>=2.3||e.is(\"Opera\")&&e.version(\"Opera Mobi\")>11&&e.is(\"AndroidOS\")||e.is(\"MeeGoOS\")||e.is(\"Tizen\")||e.is(\"Dolfin\")&&e.version(\"Bada\")>=2||(e.is(\"UC Browser\")||e.is(\"Dolfin\"))&&e.version(\"Android\")>=2.3||(e.match(\"Kindle Fire\")||e.is(\"Kindle\")&&e.version(\"Kindle\")>=3)||e.is(\"AndroidOS\")&&e.is(\"NookTablet\")||e.version(\"Chrome\")>=11&&!t||e.version(\"Safari\")>=5&&!t||e.version(\"Firefox\")>=4&&!t||e.version(\"MSIE\")>=7&&!t||e.version(\"Opera\")>=10&&!t){return\"A\"}if(e.os(\"iOS\")&&e.version(\"iPad\")<4.3||e.os(\"iOS\")&&e.version(\"iPhone\")<3.1||e.os(\"iOS\")&&e.version(\"iPod\")<3.1||e.is(\"Blackberry\")&&e.version(\"BlackBerry\")>=5&&e.version(\"BlackBerry\")<6||e.version(\"Opera Mini\")>=5&&e.version(\"Opera Mini\")<=6.5&&(e.version(\"Android\")>=2.3||e.is(\"iOS\"))||e.match(\"NokiaN8|NokiaC7|N97.*Series60|Symbian/3\")||e.version(\"Opera Mobi\")>=11&&e.is(\"SymbianOS\")){return\"B\"}if(e.version(\"BlackBerry\")<5||e.match(\"MSIEMobile|Windows CE.*Mobile\")||e.version(\"Windows Mobile\")<=5.2){return\"C\"}return\"C\"};e.detectOS=function(t){return e.findMatch(e.mobileDetectRules.oss0,t)||e.findMatch(e.mobileDetectRules.oss,t)};e.getDeviceSmallerSide=function(){return window.screen.width<window.screen.height?window.screen.width:window.screen.height};function s(e,t){this.ua=e||\"\";this._cache={};this.maxPhoneWidth=t||600}s.prototype={constructor:s,mobile:function(){e.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth);return this._cache.mobile},phone:function(){e.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth);return this._cache.phone},tablet:function(){e.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth);return this._cache.tablet},userAgent:function(){if(this._cache.userAgent===t){this._cache.userAgent=e.findMatch(e.mobileDetectRules.uas,this.ua)}return this._cache.userAgent},userAgents:function(){if(this._cache.userAgents===t){this._cache.userAgents=e.findMatches(e.mobileDetectRules.uas,this.ua)}return this._cache.userAgents},os:function(){if(this._cache.os===t){this._cache.os=e.detectOS(this.ua)}return this._cache.os},version:function(t){return e.getVersion(t,this.ua)},versionStr:function(t){return e.getVersionStr(t,this.ua)},is:function(t){return a(this.userAgents(),t)||i(t,this.os())||i(t,this.phone())||i(t,this.tablet())||a(e.findMatches(e.mobileDetectRules.utils,this.ua),t)},match:function(e){if(!(e instanceof RegExp)){e=new RegExp(e,\"i\")}return e.test(this.ua)},isPhoneSized:function(e){return s.isPhoneSized(e||this.maxPhoneWidth)},mobileGrade:function(){if(this._cache.grade===t){this._cache.grade=e.mobileGrade(this)}return this._cache.grade}};if(typeof window!==\"undefined\"&&window.screen){s.isPhoneSized=function(r){return r<0?t:e.getDeviceSmallerSide()<=r}}else{s.isPhoneSized=function(){}}s._impl=e;return s})})(function(e){if(typeof r!==\"undefined\"&&r.exports){return function(e){r.exports=e()}}else if(typeof n===\"function\"&&n.amd){return n}else if(typeof window!==\"undefined\"){return function(e){window.MobileDetect=e()}}else{throw new Error(\"unknown environment\")}}());return r.exports});e.register(\"9\",[\"c\",\"a\",\"b\",\"8\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var i,a,o,s;var u;return{setters:[function(e){i=e},function(e){a=e},function(e){o=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.locationUpdatesEnabled=true;this.orientationUpdatesEnabled=true;this.geolocationEntity=new a.Entity({id:\"ar.device.geolocation\",name:\"Device Geolocation\"});this.orientationEntity=new a.Entity({id:\"ar.device.orientation\",name:\"Device Orientation\"});this.entity=new a.Entity({id:\"ar.device\",name:\"Device\"});this.displayEntity=new a.Entity({id:\"ar.device.display\",name:\"Device Display\",position:new a.ConstantPositionProperty(a.Cartesian3.ZERO,this.entity),orientation:new a.ConstantProperty(a.Quaternion.IDENTITY)});this._scratchCartesian=new a.Cartesian3;this._scratchQuaternion1=new a.Quaternion;this._scratchQuaternion2=new a.Quaternion;this._x90Rot=a.Quaternion.fromAxisAngle(a.Cartesian3.UNIT_X,a.CesiumMath.PI_OVER_TWO);this._headingDrift=0;e.wellKnownReferenceFrames.add(this.geolocationEntity);e.wellKnownReferenceFrames.add(this.orientationEntity);e.wellKnownReferenceFrames.add(this.entity);e.wellKnownReferenceFrames.add(this.displayEntity);if(typeof navigator!==\"undefined\"){this._mobileDetect=new s.default(navigator.userAgent)}}e.prototype.onIdle=function(){if(typeof navigator===\"undefined\")return;if(a.defined(this._geolocationWatchId)){navigator.geolocation.clearWatch(this._geolocationWatchId);this._geolocationWatchId=undefined}if(a.defined(this._deviceorientationListener)){window.removeEventListener(\"deviceorientation\",this._deviceorientationListener);this._deviceorientationListener=undefined;this._alphaOffset=undefined}};e.prototype.onUpdate=function(){var e=this;if(typeof navigator!==\"undefined\"){var t=this.displayEntity.orientation;var r=a.Quaternion.fromAxisAngle(a.Cartesian3.UNIT_Z,(-window.orientation||0)*a.CesiumMath.RADIANS_PER_DEGREE,this._scratchQuaternion1);if(this._mobileDetect&&!this._mobileDetect.mobile()){r=a.Quaternion.multiply(this._x90Rot,r,r)}t.setValue(r);if(!a.defined(this._geolocationWatchId)&&this.locationUpdatesEnabled){this._geolocationWatchId=navigator.geolocation.watchPosition(function(t){if(e.geolocationEntity.position instanceof a.SampledPositionProperty===false){var r=new a.SampledPositionProperty(a.ReferenceFrame.FIXED);r.forwardExtrapolationType=a.ExtrapolationType.HOLD;r.backwardExtrapolationType=a.ExtrapolationType.HOLD;r.maxNumSamples=10;e.geolocationEntity.position=r}var n=a.JulianDate.fromDate(new Date(t.timestamp));var i=a.Cartesian3.fromDegrees(t.coords.longitude,t.coords.latitude,t.coords.altitude||0,undefined,e._scratchCartesian);e.geolocationEntity.position.addSample(n,i);if(e.geolocationEntity.orientation instanceof a.ConstantProperty===false){e.geolocationEntity.orientation=new a.ConstantProperty}var o=a.Transforms.headingPitchRollQuaternion(i,0,0,0,undefined,e._scratchQuaternion1);e.geolocationEntity.orientation.setValue(o)},function(e){console.error(e)},{enableHighAccuracy:true})}else if(a.defined(this._geolocationWatchId)&&!this.locationUpdatesEnabled){navigator.geolocation.clearWatch(this._geolocationWatchId);this._geolocationWatchId=undefined}if(!a.defined(this._deviceorientationListener)&&this.orientationUpdatesEnabled){this._deviceorientationListener=function(t){var r=t.alpha;if(!a.defined(r)){return}if(t.absolute){e._alphaOffset=0}var n=t[\"webkitCompassHeading\"];var i=+t[\"webkitCompassAccuracy\"];if((!a.defined(e._alphaOffset)||Math.abs(e._headingDrift)>5)&&a.defined(n)&&i>=0&&i<50&&n>=0){if(!a.defined(e._alphaOffset)){e._alphaOffset=-n}else{e._alphaOffset-=e._headingDrift}}var o=e._alphaOffset||-n||0;var s=a.CesiumMath.RADIANS_PER_DEGREE*(t.alpha+o);var u=a.CesiumMath.RADIANS_PER_DEGREE*t.beta;var f=a.CesiumMath.RADIANS_PER_DEGREE*t.gamma;var c=a.Quaternion.fromAxisAngle(a.Cartesian3.UNIT_Z,s,e._scratchQuaternion1);var l=a.Quaternion.fromAxisAngle(a.Cartesian3.UNIT_X,u,e._scratchQuaternion2);var d=a.Quaternion.multiply(c,l,e._scratchQuaternion1);var h=a.Quaternion.fromAxisAngle(a.Cartesian3.UNIT_Y,f,e._scratchQuaternion2);var v=a.Quaternion.multiply(d,h,d);if(e.orientationEntity.position instanceof a.ConstantPositionProperty==false){e.orientationEntity.position=new a.ConstantPositionProperty(a.Cartesian3.ZERO,e.geolocationEntity)}if(e.orientationEntity.orientation instanceof a.ConstantProperty==false){e.orientationEntity.orientation=new a.ConstantProperty}e.orientationEntity.orientation.setValue(v);if(e.entity.position instanceof a.ConstantPositionProperty==false){e.entity.position=new a.ConstantPositionProperty(a.Cartesian3.ZERO,e.orientationEntity)}if(e.entity.orientation instanceof a.ConstantProperty==false){e.entity.orientation=new a.ConstantProperty(a.Quaternion.IDENTITY)}};window.addEventListener(\"deviceorientation\",this._deviceorientationListener)}else if(a.defined(this._deviceorientationListener)&&!this.orientationUpdatesEnabled){window.removeEventListener(\"deviceorientation\",this._deviceorientationListener);this._deviceorientationListener=undefined}}};e.prototype.update=function(){var e=this;if(a.defined(this._idleTimeoutId))clearTimeout(this._idleTimeoutId);this._idleTimeoutId=setTimeout(function(){e.onIdle()},2e3);this.onUpdate()};e=n([i.inject(o.ContextService)],e);\nreturn e}();e(\"DeviceService\",u)}}});e.register(\"d\",[\"a\"],function(e,t){\"use strict\";var r=t&&t.id;var n;var i,a;function o(e){var t=Date.now();var r=Math.max(0,16-(t-a));var n=setTimeout(function(){e(t+r)},r);a=t+r;return n}return{setters:[function(e){n=e}],execute:function(){i=function(){function e(){this.frameNumbers=new WeakMap}e.prototype.requestFrame=function(e){var t=this;if(typeof requestAnimationFrame!==\"undefined\"&&typeof performance!==\"undefined\"){this.navigationStartDate=this.navigationStartDate||n.JulianDate.fromDate(new Date(performance.timing.navigationStart));requestAnimationFrame(function(r){var i=n.JulianDate.addSeconds(t.navigationStartDate,r/1e3,new n.JulianDate(0,0));e(i,t.getNextFrameNumber(e))})}else{o(function(r){var i=n.JulianDate.fromDate(new Date(r));e(i,t.getNextFrameNumber(e))})}};e.prototype.getNextFrameNumber=function(e){var t=this.frameNumbers.get(e)||0;this.frameNumbers.set(e,t+1);return t};return e}();e(\"TimerService\",i);a=0}}});e.register(\"e\",[\"c\",\"f\",\"10\",\"9\",\"d\",\"11\",\"12\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)};var i=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var a,o,s,u,f,c,l;var d;return{setters:[function(e){a=e},function(e){o=e},function(e){s=e},function(e){u=e},function(e){f=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(e){n(t,e);function t(t,r,n){e.call(this);this.sessionService=t;this.deviceService=r;this.timer=n;this.type=\"empty\"}t.prototype.load=function(e,t){var r=this;var n=this.sessionService.addManagedSessionPort(e.uri);var i=this.sessionService.createSessionPort();var a=true;i.on[\"ar.context.update\"]=function(){};i.connectEvent.addEventListener(function(){var e=function(t,n){if(a){r.deviceService.update();var o={time:t,index:n,eye:{pose:l.getSerializedEntityPose(r.deviceService.displayEntity,t)}};i.send(\"ar.reality.frameState\",o);r.timer.requestFrame(e)}};r.timer.requestFrame(e)});i.closeEvent.addEventListener(function(){a=false});t(n);var s=this.sessionService.createSynchronousMessageChannel();n.open(s.port1,this.sessionService.configuration);i.open(s.port2,{role:o.Role.REALITY_VIEW})};t=i([a.inject(s.SessionService,u.DeviceService,f.TimerService)],t);return t}(c.RealityLoader);e(\"EmptyRealityLoader\",d)}}});e.register(\"13\",[\"c\",\"14\",\"10\",\"12\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)};var i=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var a,o,s,u;var f,c,l,d,h,v,p,m,w;return{setters:[function(e){a=e},function(e){o=e},function(e){s=e},function(e){u=e}],execute:function(){(function(e){e[e[\"SUCCESS\"]=100]=\"SUCCESS\";e[e[\"INIT_ERROR\"]=-1]=\"INIT_ERROR\";e[e[\"INIT_DEVICE_NOT_SUPPORTED\"]=-2]=\"INIT_DEVICE_NOT_SUPPORTED\";e[e[\"INIT_NO_CAMERA_ACCESS\"]=-3]=\"INIT_NO_CAMERA_ACCESS\";e[e[\"INIT_LICENSE_ERROR_MISSING_KEY\"]=-4]=\"INIT_LICENSE_ERROR_MISSING_KEY\";e[e[\"INIT_LICENSE_ERROR_INVALID_KEY\"]=-5]=\"INIT_LICENSE_ERROR_INVALID_KEY\";e[e[\"INIT_LICENSE_ERROR_NO_NETWORK_PERMANENT\"]=-6]=\"INIT_LICENSE_ERROR_NO_NETWORK_PERMANENT\";e[e[\"INIT_LICENSE_ERROR_NO_NETWORK_TRANSIENT\"]=-7]=\"INIT_LICENSE_ERROR_NO_NETWORK_TRANSIENT\";e[e[\"INIT_LICENSE_ERROR_CANCELED_KEY\"]=-8]=\"INIT_LICENSE_ERROR_CANCELED_KEY\";e[e[\"INIT_LICENSE_ERROR_PRODUCT_TYPE_MISMATCH\"]=-9]=\"INIT_LICENSE_ERROR_PRODUCT_TYPE_MISMATCH\";e[e[\"INIT_EXTERNAL_DEVICE_NOT_DETECTED\"]=-10]=\"INIT_EXTERNAL_DEVICE_NOT_DETECTED\"})(f||(f={}));e(\"VuforiaInitResult\",f);(function(e){e[e[\"MaxSimultaneousImageTargets\"]=0]=\"MaxSimultaneousImageTargets\";e[e[\"MaxSimultaneousObjectTargets\"]=1]=\"MaxSimultaneousObjectTargets\";e[e[\"DelayedLoadingObjectDatasets\"]=2]=\"DelayedLoadingObjectDatasets\"})(c||(c={}));e(\"VuforiaHint\",c);l=function(){function e(){this.stateUpdateEvent=new u.Event}return e}();e(\"VuforiaServiceDelegateBase\",l);d=function(e){n(t,e);function t(){e.apply(this,arguments)}t.prototype.isAvailable=function(){return false};t.prototype.setHint=function(e,t){return true};t.prototype.decryptLicenseKey=function(e,t){return Promise.resolve(undefined)};t.prototype.init=function(e){return Promise.resolve(f.SUCCESS)};t.prototype.deinit=function(){};t.prototype.cameraDeviceInitAndStart=function(){return true};t.prototype.cameraDeviceSetFlashTorchMode=function(e){return true};t.prototype.objectTrackerInit=function(){return true};t.prototype.objectTrackerCreateDataSet=function(e){return\"\"};t.prototype.objectTrackerDestroyDataSet=function(e){return true};t.prototype.objectTrackerActivateDataSet=function(e){return true};t.prototype.objectTrackerDeactivateDataSet=function(e){return true};t.prototype.dataSetFetch=function(e){return Promise.resolve(undefined)};t.prototype.dataSetLoad=function(e){return Promise.resolve()};return t}(l);e(\"VuforiaServiceDelegate\",d);h=function(){function e(e,t,r){var n=this;this.sessionService=e;this.focusService=t;this.delegate=r;this._sessionSwitcherCommandQueue=new u.CommandQueue;this._sessionCommandQueue=new WeakMap;this._sessionInitOptions=new WeakMap;this._sessionInitPromise=new WeakMap;this._sessionIsInitialized=new WeakMap;this._sessionCreatedDataSets=new WeakMap;this._sessionActivatedDataSets=new WeakMap;if(e.isRealityManager){this._sessionSwitcherCommandQueue.errorEvent.addEventListener(function(e){n.sessionService.errorEvent.raiseEvent(e)});e.connectEvent.addEventListener(function(e){var t=new u.CommandQueue;t.errorEvent.addEventListener(function(t){n.sessionService.errorEvent.raiseEvent(t);e.sendError(t)});n._sessionCommandQueue.set(e,t);var i=new Set;n._sessionCreatedDataSets.set(e,i);var a=new Set;n._sessionActivatedDataSets.set(e,a);e.on[\"ar.vuforia.isAvailable\"]=function(){return Promise.resolve({available:r.isAvailable()})};e.on[\"ar.vuforia.init\"]=function(i){if(!r.isAvailable())throw new Error(\"Vuforia is not supported\");if(n._sessionIsInitialized.get(e))throw new Error(\"Vuforia has already been initialized\");if(!i.key&&!i.encryptedLicenseData)throw new Error(\"Expected `encryptedLicenseData` field. You can encrypt your Vuforia license key at http://docs.argonjs.io/start/vuforia-pgp-encryptor\");var a=i.key?Promise.resolve(i.key):r.decryptLicenseKey(i.encryptedLicenseData,e);return a.then(function(r){n._sessionInitOptions.set(e,{key:r});var i=t.push(function(){return n._init(e).then(function(){n._sessionIsInitialized.set(e,true)})},n._controllingSession===e);if(n.focusService.getSession()===e){n._setControllingSession(e)}n._sessionInitPromise.set(e,i);return i})};e.on[\"ar.vuforia.objectTrackerCreateDataSet\"]=function(a){var o=a.url;return t.push(function(){var e=r.objectTrackerCreateDataSet(o);if(e){i.add(e);return Promise.resolve({id:e})}throw new Error(\"Unable to create DataSet\")},n._controllingSession===e)};e.on[\"ar.vuforia.objectTrackerActivateDataSet\"]=function(i){var o=i.id;return t.push(function(){if(r.objectTrackerActivateDataSet(o)){a.add(o);e.send(\"ar.vuforia.objectTrackerActivateDataSetEvent\",{id:o});return}throw new Error(\"Unable to activate DataSet (\"+o+\")\")},n._controllingSession===e)};e.on[\"ar.vuforia.objectTrackerDeactivateDataSet\"]=function(i){var o=i.id;return t.push(function(){if(r.objectTrackerDeactivateDataSet(o)){a.delete(o);e.send(\"ar.vuforia.objectTrackerDeactivateDataSetEvent\",{id:o});return}throw new Error(\"Unable to deactivate DataSet (\"+o+\")\")},n._controllingSession===e)};e.on[\"ar.vuforia.dataSetFetch\"]=function(i){var a=i.id;return t.push(function(){return r.dataSetFetch(a)},n._controllingSession===e)};e.on[\"ar.vuforia.dataSetLoad\"]=function(i){var a=i.id;return t.push(function(){return r.dataSetLoad(a)},n._controllingSession===e)};e.closeEvent.addEventListener(function(){if(n._controllingSession===e){t.clear();t.push(function(){n._cleanupSession(e);setTimeout(function(){n._ensureActiveSession()},2e3)},true)}else{n._cleanupSession(e)}})});t.sessionFocusEvent.addEventListener(function(e){var t=e.current;if(t&&n._sessionInitOptions.get(t)){n._setControllingSession(t)}})}}e.prototype.isAvailable=function(){return this.sessionService.manager.request(\"ar.vuforia.isAvailable\").then(function(e){return e.available})};e.prototype.initWithUnencryptedKey=function(e,t){var r=this;if(!t)this.sessionService.ensureIsRealityManager();return this.sessionService.manager.request(\"ar.vuforia.init\",e).then(function(){return new v(r.sessionService.manager)})};e.prototype.init=function(e){var t=this;if(!e.encryptedLicenseData||typeof e.encryptedLicenseData!==\"string\")throw new Error(\"options.encryptedLicenseData is required.\");return this.sessionService.manager.request(\"ar.vuforia.init\",e).then(function(){return new v(t.sessionService.manager)})};e.prototype._ensureActiveSession=function(){console.log(\"VuforiaService: Ensuring an active session is in control.\");if(this._controllingSession&&this._controllingSession.isConnected)return;this._selectControllingSession()};e.prototype._selectControllingSession=function(){var e=this.focusService.getSession();if(e&&this._sessionInitOptions.get(e)){this._setControllingSession(e);return}for(var t=0,r=this.sessionService.managedSessions;t<r.length;t++){var n=r[t];if(this._sessionInitOptions.get(n)){this._setControllingSession(n);return}}if(this._sessionInitOptions.get(this.sessionService.manager))this._setControllingSession(this.sessionService.manager)};e.prototype._setControllingSession=function(e){var t=this;if(this._controllingSession===e)return;console.log(\"VuforiaService: Setting controlling session to \"+e.uri);this._sessionSwitcherCommandQueue.clear();this._sessionSwitcherCommandQueue.push(function(){return t._pauseSession().then(function(){return t._resumeSession(e)})},true)};e.prototype._resumeSession=function(e){if(this._controllingSession)throw new Error(\"Attempted to resume a session while a session is still in control\");if(e)console.log(\"VuforiaService: Resuming session \"+e.uri);var t=this._sessionInitOptions.get(e);if(!t){throw new Error(\"Attempted to resume a session without initialization options\")}this._controllingSession=e;var r=this._sessionCommandQueue.get(e);if(this._sessionIsInitialized.get(e)){return this._init(e).then(function(){r.execute()}).catch(function(t){e.sendError(t)})}else{r.execute();return this._sessionInitPromise.get(e)}};e.prototype._pauseSession=function(){var e=this;var t=this._controllingSession;if(!t)return Promise.resolve(undefined);console.log(\"VuforiaService: Pausing session \"+t.uri);var r=this._sessionCommandQueue.get(t);return r.push(function(){r.pause();e._controllingSession=undefined;return e._deinit(t)},true)};e.prototype._cleanupSession=function(e){var t=this;if(!this._sessionInitOptions.has(e))return;this._sessionInitOptions.delete(e);var r=this._sessionCreatedDataSets.get(e);console.log(\"VuforiaService: Deactivating datasets for session \"+e.uri);this._sessionActivatedDataSets.get(e).forEach(function(e){t.delegate.objectTrackerDeactivateDataSet(e)});this._sessionActivatedDataSets.delete(e);console.log(\"VuforiaService: Destroying objects for session \"+e.uri);r.forEach(function(e){t.delegate.objectTrackerDestroyDataSet(e)});this._sessionCreatedDataSets.delete(e)};e.prototype._init=function(e){var t=this;console.log(\"Attempting to initialize vuforia for \"+e.uri);var r=this._sessionInitOptions.get(e);return this.delegate.init(r).then(function(r){if(r!==f.SUCCESS){throw new Error(\"Vuforia init failed: \"+f[r])}if(!t.delegate.objectTrackerInit()){throw new Error(\"Vuforia init failed: Unable to initialize ObjectTracker\")}var n=true;t._sessionActivatedDataSets.get(e).forEach(function(r){n=n&&t.delegate.objectTrackerActivateDataSet(r);if(n){e.send(\"ar.vuforia.objectTrackerActivateDataSetEvent\",{id:r})}});if(!n){throw new Error(\"Vuforia init failed: Unable to restore active datasets\")}if(!t.delegate.cameraDeviceInitAndStart()){throw new Error(\"Vuforia init failed: Unable to complete initialization\")}console.log(\"Vuforia init success\")}).catch(function(r){console.log(\"Vuforia init fail: \"+r.message);t._sessionInitOptions.delete(e);t._sessionIsInitialized.set(e,false);t._deinit(e);t._ensureActiveSession();throw r})};e.prototype._deinit=function(e){var t=this;var r=this._sessionActivatedDataSets.get(e);if(r){r.forEach(function(r){t.delegate.objectTrackerDeactivateDataSet(r);e.send(\"ar.vuforia.objectTrackerDeactivateDataSetEvent\",{id:r})})}this.delegate.deinit()};e=i([a.inject(s.SessionService,o.FocusService,d)],e);return e}();e(\"VuforiaService\",h);v=function(){function e(e){this.objectTracker=new m(e)}return e}();e(\"VuforiaAPI\",v);p=function(){function e(){}return e}();e(\"VuforiaTracker\",p);m=function(e){n(t,e);function t(t){var r=this;e.call(this);this.manager=t;this._dataSetMap=new Map;this.dataSetActivateEvent=new u.Event;this.dataSetDeactivateEvent=new u.Event;t.on[\"ar.vuforia.objectTrackerActivateDataSetEvent\"]=function(e){var t=e.id;var n=r._dataSetMap.get(t);n._onActivate();r.dataSetActivateEvent.raiseEvent(n)};t.on[\"ar.vuforia.objectTrackerDeactivateDataSetEvent\"]=function(e){var t=e.id;var n=r._dataSetMap.get(t);n._onDeactivate();r.dataSetDeactivateEvent.raiseEvent(n)}}t.prototype.createDataSet=function(e){var t=this;if(e&&window.document){e=u.resolveURL(e)}return this.manager.request(\"ar.vuforia.objectTrackerCreateDataSet\",{url:e}).then(function(e){var r=new w(e.id,t.manager);t._dataSetMap.set(e.id,r);return r})};t.prototype.activateDataSet=function(e){return this.manager.request(\"ar.vuforia.objectTrackerActivateDataSet\",{id:e.id})};t.prototype.deactivateDataSet=function(e){return this.manager.request(\"ar.vuforia.objectTrackerDeactivateDataSet\",{id:e.id})};return t}(p);e(\"VuforiaObjectTracker\",m);w=function(){function e(e,t){this.id=e;this.manager=t;this._isActive=false}e.prototype._onActivate=function(){this._isActive=true};e.prototype._onDeactivate=function(){this._isActive=false};e.prototype.fetch=function(){return this.manager.request(\"ar.vuforia.dataSetFetch\",{id:this.id}).then(function(){})};e.prototype.load=function(){var e=this;return this.manager.request(\"ar.vuforia.dataSetLoad\",{id:this.id}).then(function(t){e._trackables=t;return t})};e.prototype.isActive=function(){return this._isActive};e.prototype.getTrackables=function(){return this._trackables};return e}();e(\"VuforiaDataSet\",w)}}});e.register(\"15\",[\"c\",\"f\",\"10\",\"11\",\"13\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)};var i=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var a,o,s,u,f;var c;return{setters:[function(e){a=e},function(e){o=e},function(e){s=e},function(e){u=e},function(e){f=e}],execute:function(){c=function(e){n(t,e);function t(t,r){e.call(this);this.sessionService=t;this.vuforiaDelegate=r;this.type=\"live-video\"}t.prototype.load=function(e,t){var r=this;var n=this.sessionService.addManagedSessionPort(e.uri);var i=this.sessionService.createSessionPort();i.on[\"ar.context.update\"]=function(){};i.connectEvent.addEventListener(function(){var e=r.vuforiaDelegate.stateUpdateEvent.addEventListener(function(e){i.send(\"ar.reality.frameState\",e)});r.vuforiaDelegate.videoEnabled=true;r.vuforiaDelegate.trackingEnabled=true;i.closeEvent.addEventListener(function(){e();r.vuforiaDelegate.videoEnabled=false;r.vuforiaDelegate.trackingEnabled=false})});t(n);var a=this.sessionService.createSynchronousMessageChannel();n.open(a.port1,this.sessionService.configuration);i.open(a.port2,{role:o.Role.REALITY_VIEW})};t=i([a.inject(s.SessionService,f.VuforiaServiceDelegate)],t);return t}(u.RealityLoader);e(\"LiveVideoRealityLoader\",c)}}});e.register(\"b\",[\"c\",\"a\",\"10\",\"11\",\"12\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var i,a,o,s,u;var f,c,l,d,h;function v(e){var t=e;return a.defined(t.id)?t.id:\"\"+t}return{setters:[function(e){i=e},function(e){a=e},function(e){o=e},function(e){s=e},function(e){u=e}],execute:function(){(function(e){e[e[\"KNOWN\"]=1]=\"KNOWN\";e[e[\"FOUND\"]=2]=\"FOUND\";e[e[\"LOST\"]=4]=\"LOST\"})(f||(f={}));e(\"PoseStatus\",f);c=new a.Cartesian3(0,0);l=new a.Quaternion(0,0);d=new a.Cartesian3(0,0);h=function(){function e(e,t){var r=this;this.sessionService=e;this.realityService=t;this.updateEvent=new u.Event;this.renderEvent=new u.Event;this.wellKnownReferenceFrames=new a.EntityCollection;this.subscribedEntities=new a.EntityCollection;this.entities=new a.CompositeEntityCollection;this.localOriginChangeEvent=new u.Event;this.user=new a.Entity({id:\"ar.user\",name:\"user\",position:new a.ConstantPositionProperty(undefined,a.ReferenceFrame.FIXED),orientation:new a.ConstantProperty(a.Quaternion.IDENTITY)});this.localOriginEastNorthUp=new a.Entity({id:\"ar.localENU\",name:\"localOriginENU\",position:new a.ConstantPositionProperty(undefined,a.ReferenceFrame.FIXED),orientation:new a.ConstantProperty(a.Quaternion.IDENTITY)});this.localOriginEastUpSouth=new a.Entity({id:\"ar.localEUS\",name:\"localOriginEUS\",position:new a.ConstantPositionProperty(a.Cartesian3.ZERO,this.localOriginEastNorthUp),orientation:new a.ConstantProperty(a.Quaternion.fromAxisAngle(a.Cartesian3.UNIT_X,Math.PI/2))});this.maxDeltaTime=1/3*1e3;this._frame={time:new a.JulianDate(0,0),systemTime:0,deltaTime:0};this._defaultReferenceFrame=this.localOriginEastNorthUp;this._entityPoseCache={};this._entityPoseMap=new Map;this._subscribedEntities=new WeakMap;this._updatingEntities=new Set;this._knownEntities=new Set;this.entities.addCollection(this.wellKnownReferenceFrames);this.entities.addCollection(this.subscribedEntities);this.subscribedEntities.add(this.user);if(this.sessionService.isRealityManager){this.realityService.frameEvent.addEventListener(function(e){r._update(e)});this.sessionService.connectEvent.addEventListener(function(e){r._subscribedEntities.set(e,new Set);e.on[\"ar.context.subscribe\"]=function(t){var n=t.id;var i=r._subscribedEntities.get(e);if(i)i.add(n)}})}else{this.sessionService.manager.on[\"ar.context.update\"]=function(e){r._update(e)}}}Object.defineProperty(e.prototype,\"frame\",{get:function(){if(!a.defined(this.serializedFrameState))throw new Error(\"A frame state has not yet been received\");return this._frame},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"serializedFrameState\",{get:function(){return this._serializedState},enumerable:true,configurable:true});e.prototype.getTime=function(){return this.frame.time};e.prototype.setDefaultReferenceFrame=function(e){this._defaultReferenceFrame=e};e.prototype.getDefaultReferenceFrame=function(){return this._defaultReferenceFrame};e.prototype.subscribeToEntityById=function(e){this.sessionService.manager.send(\"ar.context.subscribe\",{id:e});return this.subscribedEntities.getOrCreateEntity(e)};e.prototype.getEntityPose=function(e,t){if(t===void 0){t=this._defaultReferenceFrame}var r=this.getTime();var n=e.id+\"@\"+v(t);var i=this._entityPoseMap.get(n);if(!a.defined(i)){i={position:new a.Cartesian3,orientation:new a.Quaternion,time:a.JulianDate.clone(r),poseStatus:0};this._entityPoseMap.set(n,i)}else{a.JulianDate.clone(r,i.time)}var o=u.getEntityPositionInReferenceFrame(e,r,t,i.position);var s=u.getEntityOrientationInReferenceFrame(e,r,t,i.orientation);var c=o&&s;var l=0;var d=i.poseStatus;if(c){l|=f.KNOWN}if(c&&!(d&f.KNOWN)){l|=f.FOUND}else if(!c&&d&f.KNOWN){l|=f.LOST}i.poseStatus=l;return i};e.prototype.getCurrentEntityState=function(e,t){console.warn(\"getCurrentEntityState is deprecated. Use getEntityPose instead.\");return this.getEntityPose(e,t)};e.prototype._update=function(e){var t=this;if(this.sessionService.isRealityManager){delete e.entities[this.user.id];this._entityPoseCache={};for(var r=0,n=this.sessionService.managedSessions;r<n.length;r++){var i=n[r];this._sendUpdateForSession(e,i)}}e.entities[this.user.id]=e.view.pose;this._knownEntities.clear();for(var o in e.entities){this.updateEntityFromFrameState(o,e);this._updatingEntities.add(o);this._knownEntities.add(o)}this._updatingEntities.forEach(function(e){if(!t._knownEntities.has(e)){var r=t.subscribedEntities.getById(e);r.position=undefined;r.orientation=undefined;r=t.entities.getById(e);r.position=undefined;r.orientation=undefined;t._updatingEntities.delete(e)}});this._updateLocalOrigin(e);var s=this._frame;var u=typeof performance!==\"undefined\"?performance.now():Date.now();s.deltaTime=Math.max(u-s.systemTime,this.maxDeltaTime);s.systemTime=u;a.JulianDate.clone(e.time,s.time);this._serializedState=e;this.updateEvent.raiseEvent(s);this.renderEvent.raiseEvent(s)};e.prototype.updateEntityFromFrameState=function(e,t){var r=t.entities[e];if(!r){if(!this.wellKnownReferenceFrames.getById(e)){this.subscribedEntities.getOrCreateEntity(e)}return}var n;if(a.defined(r.r)){if(typeof r.r===\"number\"){n=r.r}else{n=this.entities.getById(r.r)}}else{n=a.ReferenceFrame.FIXED}if(!a.defined(n)){this.updateEntityFromFrameState(r.r,t);n=this.entities.getById(r.r)}var i=r.p===0?a.Cartesian3.ZERO:r.p;var o=r.o===0?a.Quaternion.IDENTITY:r.o;var s=this.subscribedEntities.getOrCreateEntity(e);var u=s.position;var f=s.orientation;if(!u||u.referenceFrame!==n){u=new a.ConstantPositionProperty(i,n);s.position=u}else if(u instanceof a.ConstantPositionProperty){u.setValue(i,n)}else if(u instanceof a.SampledPositionProperty){u.addSample(a.JulianDate.clone(t.time),i)}if(!f){f=new a.ConstantProperty(o);s.orientation=f}else if(f instanceof a.ConstantProperty){f.setValue(o)}else if(f instanceof a.SampledProperty){f.addSample(a.JulianDate.clone(t.time),o)}return s};e.prototype.publishEntityState=function(e,t){};e.prototype._updateLocalOrigin=function(e){var t=u.getRootReferenceFrame(this.user);var r=this.user.position&&this.user.position.getValueInReferenceFrame(e.time,t,c);var n=this.localOriginEastNorthUp.position&&this.localOriginEastNorthUp.position.referenceFrame;var i=this.localOriginEastNorthUp.position&&n&&this.localOriginEastNorthUp.position.getValueInReferenceFrame(e.time,n,d);if(r&&(!i||n!==t||a.Cartesian3.magnitudeSquared(a.Cartesian3.subtract(r,i,d))>25e6)){var o=this.localOriginEastNorthUp.position;var s=this.localOriginEastNorthUp.orientation;o.setValue(r,t);if(t===a.ReferenceFrame.FIXED){var f=a.Transforms.headingPitchRollQuaternion(r,0,0,0,undefined,l);s.setValue(f)}else{s.setValue(a.Quaternion.IDENTITY)}this.localOriginChangeEvent.raiseEvent(undefined)}};e.prototype._sendUpdateForSession=function(e,t){var r=this;var n={};for(var i in e.entities){n[i]=e.entities[i]}var o=this._subscribedEntities.get(t);o.forEach(function(t){r._addEntityAndAncestorsToPoseMap(n,t,e.time)});var s={reality:e.reality,index:e.index,time:e.time,view:e.view,entities:n,sendTime:a.JulianDate.now()};t.send(\"ar.context.update\",s)};e.prototype._addEntityAndAncestorsToPoseMap=function(e,t,r){if(!a.defined(this._entityPoseCache[t])){var n=this.subscribedEntities.getById(t);if(!n)return;this._entityPoseCache[t]=u.getSerializedEntityPose(n,r);if(n.position&&n.position.referenceFrame instanceof a.Entity){var i=v(n.position.referenceFrame);this._addEntityAndAncestorsToPoseMap(e,i,r)}}e[t]=this._entityPoseCache[t]};e=n([i.inject(o.SessionService,s.RealityService)],e);return e}();e(\"ContextService\",h)}}});e.register(\"14\",[\"c\",\"10\",\"12\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var i,a,o;var s;return{setters:[function(e){i=e},function(e){a=e},function(e){o=e}],execute:function(){s=function(){function e(e){var t=this;this.sessionService=e;this.focusEvent=new o.Event;this.blurEvent=new o.Event;this._hasFocus=false;this._sessionFocusEvent=new o.Event;e.manager.on[\"ar.focus.state\"]=function(e){t._setFocus(e.state)};if(e.isRealityManager){e.manager.connectEvent.addEventListener(function(){setTimeout(function(){if(!t._session)t.setSession(t.sessionService.manager)})})}}Object.defineProperty(e.prototype,\"hasFocus\",{get:function(){return this._hasFocus},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"sessionFocusEvent\",{get:function(){this.sessionService.ensureIsRealityManager();return this._sessionFocusEvent},enumerable:true,configurable:true});e.prototype.getSession=function(){this.sessionService.ensureIsRealityManager();return this._session};e.prototype.setSession=function(e){this.sessionService.ensureIsRealityManager();if(e&&!e.isConnected)throw new Error(\"Only a connected session can be granted focus\");var t=this._session;if(t!==e){if(t)t.send(\"ar.focus.state\",{state:false});if(e)e.send(\"ar.focus.state\",{state:true});this._session=e;this.sessionFocusEvent.raiseEvent({previous:t,current:e})}};e.prototype.whenSessionHasFocus=function(e){var t=this;this.sessionService.ensureIsRealityManager();return new Promise(function(r){var n=t.sessionFocusEvent.addEventListener(function(t){var i=t.current;if(i===e){n();r()}})})};e.prototype._setFocus=function(e){if(this._hasFocus!==e){this._hasFocus=e;if(e){this.focusEvent.raiseEvent(undefined)}else{this.blurEvent.raiseEvent(undefined)}}};e=n([i.inject(a.SessionService)],e);return e}();e(\"FocusService\",s)}}});(function(){var t=e.amdDefine;t(\"16\",[\"exports\",\"3\"],function(e,t){\"use strict\";e.__esModule=true;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r){if(Object.prototype.hasOwnProperty.call(r,n)){e[n]=r[n]}}}return e};e.decorators=u;e.deprecated=f;e.mixin=c;e.protocol=m;function n(e,t){if(!(e instanceof t)){throw new TypeError(\"Cannot call a class as a function\")}}var i={resource:\"aurelia:resource\",paramTypes:\"design:paramtypes\",properties:\"design:properties\",get:function e(t,r,n){if(!r){return undefined}var a=i.getOwn(t,r,n);return a===undefined?i.get(t,Object.getPrototypeOf(r),n):a},getOwn:function e(t,r,n){if(!r){return undefined}return Reflect.getOwnMetadata(t,r,n)},define:function e(t,r,n,i){Reflect.defineMetadata(t,r,n,i)},getOrCreateOwn:function e(t,r,n,a){var o=i.getOwn(t,n,a);if(o===undefined){o=new r;Reflect.defineMetadata(t,o,n,a)}return o}};e.metadata=i;var a=new Map;var o=Object.freeze({moduleId:undefined,moduleMember:undefined});var s=function(){function e(t,r){n(this,e);this.moduleId=t;this.moduleMember=r}e.get=function r(n){var i=a.get(n);if(i===undefined){t.PLATFORM.eachModule(function(t,r){for(var o in r){var s=r[o];if(s===n){a.set(n,i=new e(t,o));return true}}if(r===n){a.set(n,i=new e(t,\"default\"));return true}})}return i||o};e.set=function e(t,r){a.set(t,r)};return e}();e.Origin=s;function u(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++){t[r]=arguments[r]}var n=function e(r,n,i){var a=t.length;if(n){i=i||{value:r[n],writable:true,configurable:true,enumerable:true};while(a--){i=t[a](r,n,i)||i}Object.defineProperty(r,n,i)}else{while(a--){r=t[a](r)||r}}return r};n.on=n;return n}function f(e,t,n){function i(n,i,a){var o=n.constructor.name+\"#\"+i;var s=t?{}:e||{};var u=\"DEPRECATION - \"+o;if(typeof a.value!==\"function\"){throw new SyntaxError(\"Only methods can be marked as deprecated.\")}if(s.message){u+=\" - \"+s.message}return r({},a,{value:function e(){if(s.error){throw new Error(u)}else{console.warn(u)}return a.value.apply(this,arguments)}})}return t?i(e,t,n):i}function c(e){var t=Object.keys(e);function r(r){var n=function r(n){var i=typeof n===\"function\"?n.prototype:n;for(var a=t,o=Array.isArray(a),s=0,a=o?a:a[Symbol.iterator]();;){var u;if(o){if(s>=a.length)break;u=a[s++]}else{s=a.next();if(s.done)break;u=s.value}var f=u;Object.defineProperty(i,f,{value:e[f],writable:true})}};return r?n(r):n}return r}function l(){return true}function d(){}function h(e){if(e===undefined){e={}}else if(typeof e===\"function\"){e={validate:e}}if(!e.validate){e.validate=l}if(!e.compose){e.compose=d}return e}function v(e){return function(t){var r=e(t);return r===true}}function p(e,t){return function(r){var n=t(r);if(n!==true){throw new Error(n||e+\" was not correctly implemented.\")}}}function m(e,t){t=h(t);var r=function r(n){var i=typeof n===\"function\"?n.prototype:n;t.compose(i);r.assert(i);Object.defineProperty(i,\"protocol:\"+e,{enumerable:false,configurable:false,writable:false,value:true})};r.validate=v(t.validate);r.assert=p(e,t.validate);return r}m.create=function(e,t){t=h(t);var r=\"protocol:\"+e;var n=function r(n){var i=m(e,t);return n?i(n):i};n.decorates=function(e){return e[r]===true};n.validate=v(t.validate);n.assert=p(e,t.validate);return n}})})();(function(){var t=e.amdDefine;t(\"3\",[\"exports\"],function(e){\"use strict\";e.__esModule=true;e.AggregateError=t;e.initializePAL=a;function t(e,t,r){if(t){if(t.innerError&&r){return t}if(t.stack){e+=\"\\n------------------------------------------------\\ninner error: \"+t.stack}}var n=new Error(e);if(t){n.innerError=t}return n}var r={};e.FEATURE=r;var n={noop:function e(){},eachModule:function e(){}};e.PLATFORM=n;n.global=function(){if(typeof self!==\"undefined\"){return self}if(typeof global!==\"undefined\"){return global}return new Function(\"return this\")()}();var i={};e.DOM=i;function a(e){if(typeof Object.getPropertyDescriptor!==\"function\"){Object.getPropertyDescriptor=function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);var n=Object.getPrototypeOf(e);while(typeof r===\"undefined\"&&n!==null){r=Object.getOwnPropertyDescriptor(n,t);n=Object.getPrototypeOf(n)}return r}}e(n,r,i)}})})();(function(){var t=e.amdDefine;t(\"c\",[\"exports\",\"16\",\"3\"],function(e,t,r){\"use strict\";e.__esModule=true;var n;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if(\"value\"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();e.invoker=d;e.factory=h;e.registration=p;e.transient=m;e.singleton=w;e.autoinject=A;e.inject=C;function a(e,t){if(!(e instanceof t)){throw new TypeError(\"Cannot call a class as a function\")}}var o=t.protocol.create(\"aurelia:resolver\",function(e){if(!(typeof e.get===\"function\")){return\"Resolvers must implement: get(container: Container, key: any): any\"}return true});e.resolver=o;var s=function(){function e(e){a(this,t);this._key=e}e.prototype.get=function e(t){var r=this;return function(){return t.get(r._key)}};e.of=function t(r){return new e(r)};var t=e;e=o()(e)||e;return e}();e.Lazy=s;var u=function(){function e(e){a(this,t);this._key=e}e.prototype.get=function e(t){return t.getAll(this._key)};e.of=function t(r){return new e(r)};var t=e;e=o()(e)||e;return e}();e.All=u;var f=function(){function e(e){var r=arguments.length<=1||arguments[1]===undefined?false:arguments[1];\na(this,t);this._key=e;this._checkParent=r}e.prototype.get=function e(t){if(t.hasResolver(this._key,this._checkParent)){return t.get(this._key)}return null};e.of=function t(r){var n=arguments.length<=1||arguments[1]===undefined?false:arguments[1];return new e(r,n)};var t=e;e=o()(e)||e;return e}();e.Optional=f;var c=function(){function e(e){a(this,t);this._key=e}e.prototype.get=function e(t){return t.parent?t.parent.get(this._key):null};e.of=function t(r){return new e(r)};var t=e;e=o()(e)||e;return e}();e.Parent=c;var l=function(){function e(e,r){a(this,t);this.strategy=e;this.state=r}e.prototype.get=function e(t,r){switch(this.strategy){case 0:return this.state;case 1:var n=t.invoke(this.state);this.state=n;this.strategy=0;return n;case 2:return t.invoke(this.state);case 3:return this.state(t,r,this);case 4:return this.state[0].get(t,r);case 5:return t.get(this.state);default:throw new Error(\"Invalid strategy: \"+this.strategy)}};var t=e;e=o()(e)||e;return e}();e.StrategyResolver=l;function d(e){return function(r){t.metadata.define(t.metadata.invoker,e,r)}}function h(e){var r=function e(r){t.metadata.define(t.metadata.invoker,v.instance,r)};return e?r(e):r}var v=function(){function e(){a(this,e)}e.prototype.invoke=function e(t,r,n){var i=n.length;var a=new Array(i);while(i--){a[i]=t.get(n[i])}return r.apply(undefined,a)};e.prototype.invokeWithDynamicDependencies=function e(t,r,n,i){var a=n.length;var o=new Array(a);while(a--){o[a]=t.get(n[a])}if(i!==undefined){o=o.concat(i)}return r.apply(undefined,o)};i(e,null,[{key:\"instance\",value:new e,enumerable:true}]);return e}();e.FactoryInvoker=v;function p(e){return function(r){t.metadata.define(t.metadata.registration,e,r)}}function m(e){return p(new y(e))}function w(e){var t=arguments.length<=1||arguments[1]===undefined?false:arguments[1];return p(new g(e,t))}var y=function(){function e(t){a(this,e);this._key=t}e.prototype.registerResolver=function e(t,r,n){var i=new l(2,n);t.registerResolver(this._key||r,i);return i};return e}();e.TransientRegistration=y;var g=function(){function e(t){var r=arguments.length<=1||arguments[1]===undefined?false:arguments[1];a(this,e);if(typeof t===\"boolean\"){this._registerInChild=t}else{this._key=t;this._registerInChild=r}}e.prototype.registerResolver=function e(t,r,n){var i=new l(1,n);if(this._registerInChild){t.registerResolver(this._key||r,i)}else{t.root.registerResolver(this._key||r,i)}return i};return e}();e.SingletonRegistration=g;var S=\"key/value cannot be null or undefined. Are you trying to inject/register something that doesn't exist with DI?\";var b=Object.freeze([]);e._emptyParameters=b;t.metadata.registration=\"aurelia:registration\";t.metadata.invoker=\"aurelia:invoker\";var T=o.decorates;var _=function(){function e(t,r,n){a(this,e);this.fn=t;this.invoker=r;this.dependencies=n}e.prototype.invoke=function e(t,r){return r!==undefined?this.invoker.invokeWithDynamicDependencies(t,this.fn,this.dependencies,r):this.invoker.invoke(t,this.fn,this.dependencies)};return e}();e.InvocationHandler=_;function E(e,t,r,n){var i=r.length;var a=new Array(i);while(i--){a[i]=e.get(r[i])}if(n!==undefined){a=a.concat(n)}return Reflect.construct(t,a)}var M=(n={},n[0]={invoke:function e(t,r){return new r},invokeWithDynamicDependencies:E},n[1]={invoke:function e(t,r,n){return new r(t.get(n[0]))},invokeWithDynamicDependencies:E},n[2]={invoke:function e(t,r,n){return new r(t.get(n[0]),t.get(n[1]))},invokeWithDynamicDependencies:E},n[3]={invoke:function e(t,r,n){return new r(t.get(n[0]),t.get(n[1]),t.get(n[2]))},invokeWithDynamicDependencies:E},n[4]={invoke:function e(t,r,n){return new r(t.get(n[0]),t.get(n[1]),t.get(n[2]),t.get(n[3]))},invokeWithDynamicDependencies:E},n[5]={invoke:function e(t,r,n){return new r(t.get(n[0]),t.get(n[1]),t.get(n[2]),t.get(n[3]),t.get(n[4]))},invokeWithDynamicDependencies:E},n.fallback={invoke:E,invokeWithDynamicDependencies:E},n);var P=function(){function e(t){a(this,e);if(t===undefined){t={}}this._configuration=t;this._onHandlerCreated=t.onHandlerCreated;this._handlers=t.handlers||(t.handlers=new Map);this._resolvers=new Map;this.root=this;this.parent=null}e.prototype.makeGlobal=function t(){e.instance=this;return this};e.prototype.setHandlerCreatedCallback=function e(t){this._onHandlerCreated=t;this._configuration.onHandlerCreated=t};e.prototype.registerInstance=function e(t,r){this.registerResolver(t,new l(0,r===undefined?t:r))};e.prototype.registerSingleton=function e(t,r){this.registerResolver(t,new l(1,r===undefined?t:r))};e.prototype.registerTransient=function e(t,r){this.registerResolver(t,new l(2,r===undefined?t:r))};e.prototype.registerHandler=function e(t,r){this.registerResolver(t,new l(3,r))};e.prototype.registerAlias=function e(t,r){this.registerResolver(r,new l(5,t))};e.prototype.registerResolver=function e(t,r){if(t===null||t===undefined){throw new Error(S)}var n=this._resolvers;var i=n.get(t);if(i===undefined){n.set(t,r)}else if(i.strategy===4){i.state.push(r)}else{n.set(t,new l(4,[i,r]))}};e.prototype.autoRegister=function e(r,n){var i=undefined;if(typeof r===\"function\"){var a=t.metadata.get(t.metadata.registration,r);if(a===undefined){i=new l(1,r);this.registerResolver(n===undefined?r:n,i)}else{i=a.registerResolver(this,n===undefined?r:n,r)}}else{i=new l(0,r);this.registerResolver(n===undefined?r:n,i)}return i};e.prototype.autoRegisterAll=function e(t){var r=t.length;while(r--){this.autoRegister(t[r])}};e.prototype.unregister=function e(t){this._resolvers[\"delete\"](t)};e.prototype.hasResolver=function e(t){var r=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(t===null||t===undefined){throw new Error(S)}return this._resolvers.has(t)||r&&this.parent!==null&&this.parent.hasResolver(t,r)};e.prototype.get=function t(r){if(r===null||r===undefined){throw new Error(S)}if(r===e){return this}if(T(r)){return r.get(this,r)}var n=this._resolvers.get(r);if(n===undefined){if(this.parent===null){return this.autoRegister(r).get(this,r)}return this.parent._get(r)}return n.get(this,r)};e.prototype._get=function e(t){var r=this._resolvers.get(t);if(r===undefined){if(this.parent===null){return this.autoRegister(t).get(this,t)}return this.parent._get(t)}return r.get(this,t)};e.prototype.getAll=function e(t){if(t===null||t===undefined){throw new Error(S)}var r=this._resolvers.get(t);if(r===undefined){if(this.parent===null){return b}return this.parent.getAll(t)}if(r.strategy===4){var n=r.state;var i=n.length;var a=new Array(i);while(i--){a[i]=n[i].get(this,t)}return a}return[r.get(this,t)]};e.prototype.createChild=function t(){var r=new e(this._configuration);r.root=this.root;r.parent=this;return r};e.prototype.invoke=function e(t,n){try{var i=this._handlers.get(t);if(i===undefined){i=this._createInvocationHandler(t);this._handlers.set(t,i)}return i.invoke(this,n)}catch(e){throw new r.AggregateError(\"Error invoking \"+t.name+\". Check the inner error for details.\",e,true)}};e.prototype._createInvocationHandler=function e(r){var n=undefined;if(typeof r.inject===\"function\"){n=r.inject()}else if(r.inject===undefined){n=t.metadata.getOwn(t.metadata.paramTypes,r)||b}else{n=r.inject}var i=t.metadata.getOwn(t.metadata.invoker,r)||M[n.length]||M.fallback;var a=new _(r,i,n);return this._onHandlerCreated!==undefined?this._onHandlerCreated(a):a};return e}();e.Container=P;function A(e){var r=function e(r){r.inject=t.metadata.getOwn(t.metadata.paramTypes,r)||b};return e?r(e):r}function C(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++){t[r]=arguments[r]}return function(e,r,n){if(n){var i=n.value;i.inject=t}else{e.inject=t}}}})})();e.register(\"f\",[],function(e,t){\"use strict\";var r=t&&t.id;var n,i,a;return{setters:[],execute:function(){(function(e){e[e[\"REALITY_AUGMENTOR\"]=\"RealityAugmentor\"]=\"REALITY_AUGMENTOR\";e[e[\"REALITY_VIEW\"]=\"RealityView\"]=\"REALITY_VIEW\";e[e[\"REALITY_MANAGER\"]=\"RealityManager\"]=\"REALITY_MANAGER\";e[e[\"APPLICATION\"]=\"Application\"]=\"APPLICATION\";e[e[\"MANAGER\"]=\"Manager\"]=\"MANAGER\"})(n||(n={}));e(\"Role\",n);(function(e){e[e[\"SINGULAR\"]=\"Singular\"]=\"SINGULAR\";e[e[\"LEFTEYE\"]=\"LeftEye\"]=\"LEFTEYE\";e[e[\"RIGHTEYE\"]=\"RightEye\"]=\"RIGHTEYE\";e[e[\"OTHER\"]=\"Other\"]=\"OTHER\"})(i||(i={}));e(\"SubviewType\",i);a=function(){function e(){}e.getType=function(e){var t=e.uri;var r=t.split(\":\");if(r[0]===\"reality\"){return r[1]}return\"hosted\"};e.EMPTY={uri:\"reality:empty\",title:\"Reality\",providedReferenceFrames:[\"FIXED\"]};return e}();e(\"RealityView\",a)}}});e.register(\"10\",[\"a\",\"c\",\"f\",\"12\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)};var i=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var a,o,s,u;var f,c,l,d,h,v,p,m;return{setters:[function(e){a=e},function(e){o=e},function(e){s=e},function(e){u=e}],execute:function(){f=function(){function e(t){var r=this;this.uri=t;this._connectEvent=new u.Event;this.closeEvent=new u.Event;this.errorEvent=new u.Event;this.on={};this._isOpened=false;this._isConnected=false;this._isClosed=false;this.on[e.OPEN]=function(e){if(!e)throw new Error(\"Session did not provide a configuration\");if(r._isConnected)throw new Error(\"Session has already connected!\");r.info=e;r._isConnected=true;r._connectEvent.raiseEvent(undefined)};this.on[e.CLOSE]=function(){r._isClosed=true;r._isConnected=false;if(r.messagePort&&r.messagePort.close)r.messagePort.close();r.closeEvent.raiseEvent(undefined)};this.on[e.ERROR]=function(e){var t=new Error(\"Session Error: \"+e.message);if(e.stack)t[\"stack\"]=e.stack;r.errorEvent.raiseEvent(t)};this.errorEvent.addEventListener(function(e){if(r.errorEvent.numberOfListeners===1)console.error(e)})}Object.defineProperty(e.prototype,\"connectEvent\",{get:function(){if(this._isConnected)throw new Error(\"The connectEvent only fires once and the session is already connected.\");return this._connectEvent},enumerable:true,configurable:true});e.prototype.supportsProtocol=function(e,t){if(!this._isConnected)throw new Error(\"Session has not yet connected\");var r=this.info.protocols;if(!r)return false;var n=false;var i=new Set;r.forEach(function(t){if(t.indexOf(e)!==-1){var r=+t.split(\"@v\")[1]||0;i.add(r)}});if(t){if(Array.isArray(t)){t.forEach(function(e){if(i.has(e)){n=true}})}else{if(i.has(t)){n=true}}}else if(!t){n=true}return n};e.prototype.open=function(t,r){var n=this;if(this._isClosed)return;if(this._isOpened)throw new Error(\"Session can only be opened once\");if(!r)throw new Error(\"Session options must be provided\");this.messagePort=t;this._isOpened=true;this.messagePort.onmessage=function(e){if(n._isClosed)return;var t=e.data[0];var r=e.data[1];var i=e.data[2]||{};var a=e.data[3];var o=n.on[r];if(o&&!a){try{var s=o(i,e);if(s)console.warn(\"Handler for \"+r+\" returned an unexpected response\")}catch(e){n.sendError(e);n.errorEvent.raiseEvent(e)}}else if(o){var s=new Promise(function(t){return t(o(i,e))});Promise.resolve(s).then(function(e){if(n._isClosed)return;n.send(r+\":resolve:\"+t,e)}).catch(function(e){if(n._isClosed)return;var i;if(typeof e===\"string\")i=e;else if(typeof e.message===\"string\")i=e.message;n.send(r+\":reject:\"+t,{reason:i})})}else{var u=\"Unable to handle message \"+r;if(a){n.send(r+\":reject:\"+t,{reason:u})}else{n.sendError({message:u})}n.errorEvent.raiseEvent(new Error(\"No handlers are available for topic \"+r))}};this.send(e.OPEN,r)};e.prototype.send=function(e,t){if(!this._isOpened)throw new Error(\"Session must be open to send messages\");if(this._isClosed)return false;var r=a.createGuid();this.messagePort.postMessage([r,e,t]);return true};e.prototype.sendError=function(t){var r=t;if(r instanceof Error){r={message:r.message,stack:r[\"stack\"]}}return this.send(e.ERROR,r)};e.prototype.request=function(e,t){var r=this;if(!this._isOpened||this._isClosed)throw new Error(\"Session must be open to make requests\");var n=a.createGuid();var i=e+\":resolve:\"+n;var o=e+\":reject:\"+n;var s=new Promise(function(t,n){r.on[i]=function(e){delete r.on[i];delete r.on[o];t(e)};r.on[o]=function(t){delete r.on[i];delete r.on[o];console.warn(\"Request '\"+e+\"' rejected with reason:\\n\"+t.reason);n(new Error(t.reason))}});this.messagePort.postMessage([n,e,t||{},true]);return s};e.prototype.close=function(){if(this._isClosed)return;if(this._isOpened){this.send(e.CLOSE)}this._isClosed=true;this._isConnected=false;if(this.messagePort&&this.messagePort.close)this.messagePort.close();this.closeEvent.raiseEvent(undefined)};Object.defineProperty(e.prototype,\"isConnected\",{get:function(){return this._isConnected},enumerable:true,configurable:true});e.OPEN=\"ar.session.open\";e.CLOSE=\"ar.session.close\";e.ERROR=\"ar.session.error\";return e}();e(\"SessionPort\",f);c=function(){function e(){}e.prototype.create=function(e){return new f(e)};return e}();e(\"SessionPortFactory\",c);l=function(){function e(){}return e}();e(\"ConnectService\",l);d=function(){function e(e,t,r,n){var i=this;this.configuration=e;this.connectService=t;this.sessionPortFactory=r;this.messageChannelFactory=n;this.manager=this.createSessionPort(\"argon:manager\");this.errorEvent=new u.Event;this._connectEvent=new u.Event;this._managedSessions=[];this.errorEvent.addEventListener(function(e){if(i.errorEvent.numberOfListeners===1)console.error(e)});this.manager.errorEvent.addEventListener(function(e){i.errorEvent.raiseEvent(e)});Object.freeze(this)}Object.defineProperty(e.prototype,\"connectEvent\",{get:function(){return this._connectEvent},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"managedSessions\",{get:function(){this.ensureIsRealityManager();return this._managedSessions},enumerable:true,configurable:true});e.prototype.connect=function(){if(this.connectService&&this.connectService.connect){this.connectService.connect(this)}else{console.warn(\"Argon: Unable to connect to a manager session; a connect service is not available\")}};e.prototype.addManagedSessionPort=function(e){var t=this;this.ensureIsRealityManager();var r=this.sessionPortFactory.create(e);r.errorEvent.addEventListener(function(e){t.errorEvent.raiseEvent(e)});r.connectEvent.addEventListener(function(){t.managedSessions.push(r);t.connectEvent.raiseEvent(r)});r.closeEvent.addEventListener(function(){var e=t.managedSessions.indexOf(r);if(e>-1)t.managedSessions.splice(e,1)});return r};e.prototype.createSessionPort=function(e){return this.sessionPortFactory.create(e)};e.prototype.createMessageChannel=function(){return this.messageChannelFactory.create()};e.prototype.createSynchronousMessageChannel=function(){return this.messageChannelFactory.createSynchronous()};Object.defineProperty(e.prototype,\"isRealityManager\",{get:function(){return this.configuration.role===s.Role.REALITY_MANAGER||this.configuration.role===s.Role.MANAGER},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"isRealityAugmenter\",{get:function(){return this.configuration.role===s.Role.REALITY_AUGMENTOR||this.configuration.role===s.Role.APPLICATION},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"isRealityView\",{get:function(){return this.configuration.role===s.Role.REALITY_VIEW},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"isManager\",{get:function(){console.warn(\"Deprecated. Use isRealityManager()\");return this.isManager},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"isApplication\",{get:function(){console.warn(\"Deprecated. Use isRealityAugmenter()\");return this.isRealityAugmenter},enumerable:true,configurable:true});e.prototype.ensureIsRealityManager=function(){if(!this.isRealityManager)throw new Error(\"An reality-manager only API was accessed from a non reality-manager.\")};e.prototype.ensureIsRealityView=function(){if(!this.isRealityView)throw new Error(\"An reality-view only API was accessed from a non reality-view.\")};e.prototype.ensureNotRealityView=function(){if(this.isRealityView)throw new Error(\"An non-permitted API was accessed from a reality-view.\")};e=i([o.inject(\"config\",l,c,u.MessageChannelFactory)],e);return e}();e(\"SessionService\",d);h=function(e){n(t,e);function t(){e.apply(this,arguments)}t.prototype.connect=function(e){var t=e.createSynchronousMessageChannel();var r=t.port1;t.port2.onmessage=function(e){t.port2.postMessage(e.data)};e.manager.connectEvent.addEventListener(function(){e.connectEvent.raiseEvent(e.manager)});e.manager.open(r,e.configuration)};return t}(l);e(\"LoopbackConnectService\",h);v=function(e){n(t,e);function t(){e.apply(this,arguments)}t.isAvailable=function(){return typeof window!==\"undefined\"&&typeof window.parent!==\"undefined\"};t.prototype.connect=function(e){var t=e.createMessageChannel();window.parent.postMessage({type:\"ARGON_SESSION\"},\"*\",[t.port1]);e.manager.open(t.port2,e.configuration)};return t}(l);e(\"DOMConnectService\",v);p=function(e){n(t,e);function t(){e.apply(this,arguments)}t.isAvailable=function(){return typeof window!==\"undefined\"&&!!window[\"__ARGON_DEBUG_PORT__\"]};t.prototype.connect=function(e){var t=e.manager,r=e.configuration;t.open(window[\"__ARGON_DEBUG_PORT__\"],r)};return t}(l);e(\"DebugConnectService\",p);m=function(e){n(t,e);function t(){e.apply(this,arguments)}t.isAvailable=function(){return typeof window!==\"undefined\"&&window[\"webkit\"]&&window[\"webkit\"].messageHandlers};t.prototype.connect=function(e){var t=e.createSynchronousMessageChannel();t.port2.onmessage=function(e){webkit.messageHandlers.argon.postMessage(JSON.stringify(e.data))};window[\"__ARGON_PORT__\"]=t.port2;e.manager.open(t.port1,e.configuration);window.addEventListener(\"beforeunload\",function(){e.manager.close()})};return t}(l);e(\"WKWebViewConnectService\",m)}}});e.register(\"11\",[\"c\",\"a\",\"f\",\"14\",\"10\",\"12\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var i,a,o,s,u,f;var c,l,d;return{setters:[function(e){i=e},function(e){a=e},function(e){o=e},function(e){s=e},function(e){u=e},function(e){f=e}],execute:function(){c=function(){function e(){}return e}();e(\"RealityLoader\",c);(function(e){e[e[\"OTHER\"]=0]=\"OTHER\";e[e[\"START\"]=1]=\"START\";e[e[\"CHANGE\"]=2]=\"CHANGE\";e[e[\"END\"]=3]=\"END\"})(l||(l={}));e(\"RealityZoomState\",l);d=function(){function e(e,t){var r=this;this.sessionService=e;this.focusService=t;this.realities=new Array;this.connectEvent=new f.Event;this._changeEvent=new f.Event;this._frameEvent=new f.Event;this.desiredRealityMap=new WeakMap;this.desiredRealityMapInverse=new WeakMap;this.sessionDesiredRealityChangeEvent=new f.Event;this._loaders=[];this._defaultFov=Math.PI/2;this._scratchFrustum=new a.PerspectiveFrustum;this._scratchArray=new Array;this._loadID=-1;if(e.isRealityManager){e.manager.connectEvent.addEventListener(function(){setTimeout(function(){if(r._loadID===-1)r._setNextReality(r.onSelectReality())})})}e.connectEvent.addEventListener(function(e){if(e.info.role!==o.Role.REALITY_VIEW){e.on[\"ar.reality.desired\"]=function(t){var n=t.reality;var i=r.desiredRealityMap.get(e);console.log(\"Session set desired reality: \"+JSON.stringify(n));if(n){if(n[\"type\"]){var a=n[\"type\"];n.uri=n.uri||\"reality:\"+a;if(a===\"hosted\")n.uri=n[\"url\"];if(!n.title&&n[\"name\"])n.title=n[\"name\"]}if(r.isSupported(n)){r.desiredRealityMap.set(e,n);r.desiredRealityMapInverse.set(n,e)}else{e.sendError({message:'Reality of type \"'+n.uri+'\" is not available on this platform'});return}}else{r.desiredRealityMap.delete(e)}r._setNextReality(r.onSelectReality());r.sessionDesiredRealityChangeEvent.raiseEvent({session:e,previous:i,current:n})}}});e.manager.on[\"ar.reality.connect\"]=function(e){var t=e.id;var n=r.sessionService.createSessionPort();var i=r.sessionService.createSynchronousMessageChannel();var a=\"ar.reality.message.route.\"+t;var o=\"ar.reality.message.send.\"+t;var s=\"ar.reality.close.\"+t;i.port1.onmessage=function(e){r.sessionService.manager.send(a,e.data)};r.sessionService.manager.on[o]=function(e){i.port1.postMessage(e)};r.sessionService.manager.on[s]=function(){n.close()};n.connectEvent.addEventListener(function(){r.connectEvent.raiseEvent(n)});r.sessionService.manager.closeEvent.addEventListener(function(){n.close();delete r.sessionService.manager.on[o];delete r.sessionService.manager.on[s]});n.open(i.port2,r.sessionService.configuration)};e.manager.on[\"ar.reality.zoom\"]=function(e){r.zoom(e)}}Object.defineProperty(e.prototype,\"changeEvent\",{get:function(){this.sessionService.ensureIsRealityManager();return this._changeEvent},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"frameEvent\",{get:function(){this.sessionService.ensureIsRealityManager();return this._frameEvent},enumerable:true,configurable:true});e.prototype.setDefault=function(e){this._default=e};e.prototype.registerLoader=function(e){this.sessionService.ensureIsRealityManager();this._loaders.push(e)};e.prototype.getCurrent=function(){this.sessionService.ensureIsRealityManager();return this._current};e.prototype.isSupported=function(e){this.sessionService.ensureIsRealityManager();return!!this._getLoader(e)};e.prototype.publishFrame=function(e){this.sessionService.ensureIsRealityView();if(this.sessionService.manager.isConnected){this.sessionService.manager.send(\"ar.reality.frameState\",e)}};e.prototype.setDesired=function(e){this.sessionService.ensureNotRealityView();this._desired=e;if(this.sessionService.isRealityManager){this._setNextReality(e,true)}else{this.sessionService.manager.send(\"ar.reality.desired\",{reality:e})}};e.prototype.getDesired=function(){return this._desired};e.prototype.setOptionalReferenceFrames=function(e){};e.prototype.setRequiredReferenceFrames=function(e){};e.prototype.setDesiredFov=function(e){this._desiredFov=e;this.zoom({fov:e||this._defaultFov,zoom:1,state:l.OTHER})};e.prototype.getDesiredFov=function(){return this._desiredFov};e.prototype.setDefaultFov=function(e){if(a.defined(this._desiredFov)){var t=this._desiredFov/this._defaultFov;this.setDesiredFov(e*t)}this._defaultFov=e};e.prototype.getDefaultFov=function(){return this._defaultFov};e.prototype.getMaximumViewport=function(){if(typeof document!==\"undefined\"&&document.documentElement){return{x:0,y:0,width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}throw new Error(\"Not implemeneted for the current platform\")};e.prototype.onSelectReality=function(){this.sessionService.ensureIsRealityManager();var e=this.desiredRealityMap.get(this.sessionService.manager);if(!e){var t=this.focusService.getSession();if(t&&t.isConnected){e=this.desiredRealityMap.get(t)}}if(!e){for(var r=0,n=this.sessionService.managedSessions;r<n.length;r++){var i=n[r];if(!i.isConnected)continue;var a=this.desiredRealityMap.get(i);if(a&&this.isSupported(a)){e=a;break}}}return e};e.prototype.onGenerateViewFromEyeParameters=function(e){var t=e.fov||this._desiredFov||this._defaultFov;var r=e.viewport||this.getMaximumViewport();var n=e.aspect||r.width/r.height;this._scratchFrustum.fov=t;this._scratchFrustum.aspectRatio=n;this._scratchFrustum.near=.01;this._scratchFrustum.far=1e7;return{viewport:r,pose:e.pose,subviews:[{type:o.SubviewType.SINGULAR,frustum:{fov:t,aspectRatio:n},projectionMatrix:a.Matrix4.toArray(this._scratchFrustum.projectionMatrix,this._scratchArray)}]}};e.prototype.zoom=function(e){e.naturalFov=e.naturalFov||this._defaultFov;if(this._realitySession&&this._realitySession.info[\"reality.handlesZoom\"]){this._realitySession.send(\"ar.reality.zoom\",e)}else{var t=this._desiredFov=this.onZoom(e);if(this.sessionService.isRealityView){this.sessionService.manager.send(\"ar.reality.desiredFov\",{fov:t})}}};e.prototype.onZoom=function(e){var t=2*Math.atan(Math.tan(e.fov*.5)/e.zoom);t=Math.max(10*a.CesiumMath.RADIANS_PER_DEGREE,Math.min(t,160*a.CesiumMath.RADIANS_PER_DEGREE));if(e.state===l.END&&Math.abs(t-e.naturalFov)<.05){t=e.naturalFov}return t};e.prototype._setNextReality=function(e,t){var r=this;if(t===void 0){t=false}if(this._current&&e&&this._current===e&&!t)return;if(this._current&&!e&&this._realitySession)return;if(!this._current&&!a.defined(e)){e=this._default}if(a.defined(e)){if(!this.isSupported(e)){this.sessionService.errorEvent.raiseEvent(new Error('Reality of type \"'+e.uri+'\" is not available on this platform'));return}var n=++this._loadID;this._executeRealityLoader(e,function(t){if(t.isConnected)throw new Error(\"Expected an unconnected session\");if(n!==r._loadID){t.close();return}var i=r._realitySession;r._realitySession=t;r._setCurrent(e);t.on[\"ar.reality.frameState\"]=function(e){var t=e;if(!a.defined(e.view)){if(!a.defined(e.eye))throw new Error(\"Unable to construct view configuration: missing eye parameters\");t.view=r.onGenerateViewFromEyeParameters(e.eye);t.eye=undefined;t.entities=e.entities||{}}t.reality=r.getCurrent();r.frameEvent.raiseEvent(t)};t.on[\"ar.reality.desiredFov\"]=function(e){r._desiredFov=e.fov};t.closeEvent.addEventListener(function(){console.log(\"Reality session closed: \"+JSON.stringify(e));if(r._loadID===n){r._realitySession=undefined;r._current=undefined;r._setNextReality(r.onSelectReality())}});t.connectEvent.addEventListener(function(){if(t.info.role!==o.Role.REALITY_VIEW){t.sendError({message:\"Expected a reality session\"});t.close();throw new Error('The application \"'+t.uri+'\" does not support being loaded as a reality')}if(i){i.close()}if(t.info[\"reality.supportsControlPort\"]){var n=r.desiredRealityMapInverse.get(e)||r.sessionService.manager;var s=a.createGuid();var u=\"ar.reality.message.route.\"+s;var f=\"ar.reality.message.send.\"+s;var c=\"ar.reality.close.\"+s;t.on[u]=function(e){n.send(f,e)};n.on[u]=function(e){t.send(f,e)};t.send(\"ar.reality.connect\",{id:s});n.send(\"ar.reality.connect\",{id:s});t.closeEvent.addEventListener(function(){n.send(c)});n.closeEvent.addEventListener(function(){t.send(c);t.close()})}})})}};e.prototype._getLoader=function(e){var t;for(var r=0,n=this._loaders;r<n.length;r++){var i=n[r];if(i.type===o.RealityView.getType(e)){t=i;break}}return t};e.prototype._setCurrent=function(e){if(this._current===undefined||this._current!==e){var t=this._current;this._current=e;this.changeEvent.raiseEvent({previous:t,current:e});console.log(\"Reality changed to: \"+JSON.stringify(e))}};e.prototype._executeRealityLoader=function(e,t){this.sessionService.ensureIsRealityManager();var r=this._getLoader(e);if(!r)throw new Error(\"Unable to setup unsupported reality type: \"+e.uri);r.load(e,t)};e=n([i.inject(u.SessionService,s.FocusService)],e);return e}();e(\"RealityService\",d)}}});e.register(\"17\",[\"c\",\"a\",\"10\",\"b\",\"12\",\"14\",\"11\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var i,a,o,s,u,f,c;var l,d,h,v;return{setters:[function(e){i=e},function(e){a=e},function(e){o=e},function(e){s=e},function(e){u=e},function(e){f=e},function(e){c=e}],execute:function(){if(typeof document!==\"undefined\"&&document.createElement){var t=document.querySelector(\"meta[name=viewport]\");if(!t)t=document.createElement(\"meta\");t.name=\"viewport\";t.content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\";document.head.appendChild(t);var r=document.querySelector(\"meta[name=argon]\");if(!r)r=document.createElement(\"meta\");r.name=\"argon\";document.head.appendChild(r);d=new Promise(function(e){var t=function(){var t=document.querySelector(\"#argon\");if(!t)t=document.createElement(\"div\");t.id=\"argon\";t.classList.add(\"argon-view\");document.body.appendChild(t);l=t;e(t)};if(document.readyState==\"loading\"){document.addEventListener(\"DOMContentLoaded\",t)}else{t()}});var p=document.createElement(\"style\");p.type=\"text/css\";document.head.insertBefore(p,document.head.firstChild);var m=p.sheet;m.insertRule(\"\\n        #argon {\\n            position: fixed;\\n            left: 0px;\\n            bottom: 0px;\\n            width: 100%;\\n            height: 100%;\\n            margin: 0;\\n            border: 0;\\n            padding: 0;\\n        }\\n    \",0);m.insertRule(\"\\n        .argon-view > * {\\n            position: absolute;\\n            pointer-events: none;\\n        }\\n    \",1)}h=function(){function e(e,t,r,n){var i=this;this.sessionService=t;this.focusService=r;this.contextService=n;this.viewportChangeEvent=new u.Event;this.acquireEvent=new u.Event;this.releaseEvent=new u.Event;this.desiredViewportMap=new WeakMap;this._subviews=[];this._subviewEntities=[];this._frustums=[];if(typeof document!==\"undefined\"&&document.createElement){var a=this.element=document.createElement(\"div\");a.style.width=\"100%\";a.style.height=\"100%\";a.classList.add(\"argon-view\");this.containingElementPromise=new Promise(function(t){if(e&&e instanceof HTMLElement){e.insertBefore(a,e.firstChild);t(e)}else{l=document.querySelector(\"#argon\");if(l){l.insertBefore(a,l.firstChild);t(l)}else{d.then(function(e){e.insertBefore(a,e.firstChild);t(e)})}i.focusService.focusEvent.addEventListener(function(){d.then(function(e){e.classList.remove(\"argon-no-focus\");e.classList.add(\"argon-focus\")})});i.focusService.blurEvent.addEventListener(function(){d.then(function(e){e.classList.remove(\"argon-focus\");e.classList.add(\"argon-no-focus\")})})}})}if(this.sessionService.isRealityManager){this.sessionService.connectEvent.addEventListener(function(e){e.on[\"ar.viewport.desired\"]=function(t){i.desiredViewportMap.set(e,t)}})}this.contextService.renderEvent.addEventListener(function(){var e=i.contextService.serializedFrameState;var t=i._subviewEntities;t.length=0;e.view.subviews.forEach(function(r,n){var a=\"ar.view_\"+n;e.entities[a]=r.pose||e.view.pose;i.contextService.updateEntityFromFrameState(a,e);delete e.entities[a];t[n]=i.contextService.entities.getById(a)});i._update()})}e.prototype.getSubviews=function(e){var t=this;this._update();var r=this._subviews;r.length=this._current.subviews.length;this._current.subviews.forEach(function(n,i){var o=t._subviewEntities[i];var s=r[i]=r[i]||{};s.index=i;s.type=n.type;s.pose=t.contextService.getEntityPose(o,e);s.viewport=n.viewport||t._current.viewport;s.frustum=t._frustums[i];if(!s.frustum){s.frustum=t._frustums[i]=new a.PerspectiveFrustum;s.frustum.near=.01;s.frustum.far=1e7}s.frustum.fov=n.frustum.fov;s.frustum.aspectRatio=n.frustum.aspectRatio||s.viewport.width/s.viewport.height;s.frustum.xOffset=n.frustum.xOffset||0;s.frustum.yOffset=n.frustum.yOffset||0;s.projectionMatrix=n.projectionMatrix||s.frustum.infiniteProjectionMatrix});return r};e.prototype.getViewport=function(){return this._current.viewport};e.prototype.setDesiredViewport=function(e){this.sessionService.manager.send(\"ar.view.desiredViewport\",e)};e.prototype.requestOwnership=function(){};e.prototype.releaseOwnership=function(){};e.prototype.isOwner=function(){};e.prototype._update=function(){var e=this;var t=this.contextService.serializedFrameState;if(!t)throw new Error(\"Expected state to be defined\");var r=t.view;var n=JSON.stringify(r.viewport);var i=this._current&&this._current.viewport;this._current=r;if(!this._currentViewportJSON||this._currentViewportJSON!==n){this._currentViewportJSON=n;if(this.element){requestAnimationFrame(function(){var t=r.viewport;e.element.style.left=t.x+\"px\";e.element.style.bottom=t.y+\"px\";e.element.style.width=t.width+\"px\";e.element.style.height=t.height+\"px\"})}this.viewportChangeEvent.raiseEvent({previous:i})}};e=n([i.inject(\"containerElement\",o.SessionService,f.FocusService,s.ContextService)],e);\nreturn e}();e(\"ViewService\",h);v=function(){function e(e,t,r,n){var i=this;this.viewService=e;this.realityService=t;this.contextService=r;this.sessionService=n;if(this.sessionService.isRealityManager){this.viewService.containingElementPromise.then(function(e){e.style.pointerEvents=\"auto\";var t=-1;if(typeof PointerEvent!==\"undefined\"){var r=new Array;var n=-1;var a=1;var o=function(e){for(var t=0;t<r.length;t++){if(r[t].pointerId==e.pointerId){r.splice(t,1);break}}};var s=function(e){r.push(e)};var u=function(e){for(var o=0;o<r.length;o++){if(e.pointerId==r[o].pointerId){r[o]=e;break}}var s=i.contextService.serializedFrameState;if(!s)return;if(r.length==2){var u=Math.abs(r[0].clientX-r[1].clientX);var f=Math.abs(r[0].clientY-r[1].clientY);var l=u*u+f*f;if(n==-1){n=l;t=s.view.subviews[0].frustum.fov;a=1;i.realityService.zoom({zoom:a,fov:t,state:c.RealityZoomState.START})}else{a=l/n;i.realityService.zoom({zoom:a,fov:t,state:c.RealityZoomState.CHANGE})}}else{i.realityService.zoom({zoom:a,fov:t,state:c.RealityZoomState.END});n=-1}};var f=function(e){o(e);if(r.length<2)n=-1};e.onpointerdown=s;e.onpointermove=u;e.onpointerup=f;e.onpointercancel=f;e.onpointerout=f;e.onpointerleave=f}else{e.addEventListener(\"gesturestart\",function(e){var r=i.contextService.serializedFrameState;if(r&&r.view.subviews[0]){t=r.view.subviews[0].frustum.fov;i.realityService.zoom({zoom:e.scale,fov:t,state:c.RealityZoomState.START})}});e.addEventListener(\"gesturechange\",function(e){i.realityService.zoom({zoom:e.scale,fov:t,state:c.RealityZoomState.CHANGE})});e.addEventListener(\"gestureend\",function(e){i.realityService.zoom({zoom:e.scale,fov:t,state:c.RealityZoomState.END})})}})}}e=n([i.inject(h,c.RealityService,s.ContextService,o.SessionService)],e);return e}();e(\"PinchZoomService\",v)}}});e.register(\"18\",[\"c\",\"10\",\"11\",\"17\"],function(e,t){\"use strict\";var r=t&&t.id;var n=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)};var i=this&&this.__decorate||function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect===\"object\"&&typeof Reflect.decorate===\"function\")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};var a,o,s,u;var f;return{setters:[function(e){a=e},function(e){o=e},function(e){s=e},function(e){u=e}],execute:function(){f=function(e){n(t,e);function t(t,r){var n=this;e.call(this);this.sessionService=t;this.viewService=r;this.type=\"hosted\";this.iframeElement=document.createElement(\"iframe\");this.iframeElement.style.border=\"0\";this.iframeElement.width=\"100%\";this.iframeElement.height=\"100%\";r.containingElementPromise.then(function(e){e.insertBefore(n.iframeElement,e.firstChild)})}t.prototype.load=function(e,t){var r=this;this.viewService.containingElementPromise.then(function(n){var i=function(n){if(n.data.type!==\"ARGON_SESSION\")return;var a=n.ports&&n.ports[0];if(!a)throw new Error(\"Received an ARGON_SESSION message without a MessagePort object\");var o=0;var s;while(o<window.frames.length&&!s){if(window.frames[o]==n.source)s=document.getElementsByTagName(\"iframe\")[o]}if(s!==r.iframeElement)return;window.removeEventListener(\"message\",i);var u=r.sessionService.addManagedSessionPort(e.uri);t(u);u.open(a,r.sessionService.configuration)};window.addEventListener(\"message\",i);r.iframeElement.src=\"\";r.iframeElement.src=e.uri;r.iframeElement.style.pointerEvents=\"auto\"})};t=i([a.inject(o.SessionService,u.ViewService)],t);return t}(s.RealityLoader);e(\"HostedRealityLoader\",f)}}});(function(){var t=e.amdDefine;t(\"19\",[\"1a\",\"1b\",\"1c\",\"1d\"],function(e,t,r,n){\"use strict\";function i(e,t){this._callback=undefined;this._isConstant=undefined;this._definitionChanged=new n;this.setCallback(e,t)}t(i.prototype,{isConstant:{get:function(){return this._isConstant}},definitionChanged:{get:function(){return this._definitionChanged}}});i.prototype.getValue=function(e,t){return this._callback(e,t)};i.prototype.setCallback=function(t,n){if(!e(t)){throw new r(\"callback is required.\")}if(!e(n)){throw new r(\"isConstant is required.\")}var i=this._callback!==t||this._isConstant!==n;this._callback=t;this._isConstant=n;if(i){this._definitionChanged.raiseEvent(this)}};i.prototype.equals=function(e){return this===e||e instanceof i&&this._callback===e._callback&&this._isConstant===e._isConstant};return i})})();(function(){var t=e.amdDefine;t(\"1e\",[\"1f\"],function(e){\"use strict\";var t={UNBOUNDED:0,CLAMPED:1,LOOP_STOP:2};return e(t)})})();(function(){var t=e.amdDefine;t(\"20\",[\"1a\"],function(e){\"use strict\";var t;if(typeof performance!==\"undefined\"&&e(performance.now)){t=function(){return performance.now()}}else{t=function(){return Date.now()}}return t})})();(function(){var t=e.amdDefine;t(\"21\",[\"1e\",\"22\",\"23\",\"1a\",\"1c\",\"1d\",\"20\",\"24\"],function(e,t,r,n,i,a,o,s){\"use strict\";function u(u){u=r(u,r.EMPTY_OBJECT);var f=u.startTime;var c=!n(f);var l=u.stopTime;var d=!n(l);var h=u.currentTime;var v=!n(h);if(c&&d&&v){h=s.now();f=s.clone(h);l=s.addDays(h,1,new s)}else if(c&&d){f=s.clone(h);l=s.addDays(h,1,new s)}else if(c&&v){f=s.addDays(l,-1,new s);h=s.clone(f)}else if(v&&d){h=s.clone(f);l=s.addDays(f,1,new s)}else if(v){h=s.clone(f)}else if(d){l=s.addDays(h,1,new s)}else if(c){f=s.clone(h)}if(s.greaterThan(f,l)){throw new i(\"startTime must come before stopTime.\")}this.startTime=f;this.stopTime=l;this.currentTime=h;this.multiplier=r(u.multiplier,1);this.clockStep=r(u.clockStep,t.SYSTEM_CLOCK_MULTIPLIER);this.clockRange=r(u.clockRange,e.UNBOUNDED);this.canAnimate=r(u.canAnimate,true);this.shouldAnimate=r(u.shouldAnimate,true);this.onTick=new a;this._lastSystemTime=o()}u.prototype.tick=function(){var r=o();var n=s.clone(this.currentTime);var i=this.startTime;var a=this.stopTime;var u=this.multiplier;if(this.canAnimate&&this.shouldAnimate){if(this.clockStep===t.SYSTEM_CLOCK){n=s.now(n)}else{if(this.clockStep===t.TICK_DEPENDENT){n=s.addSeconds(n,u,n)}else{var f=r-this._lastSystemTime;n=s.addSeconds(n,u*(f/1e3),n)}if(this.clockRange===e.CLAMPED){if(s.lessThan(n,i)){n=s.clone(i,n)}else if(s.greaterThan(n,a)){n=s.clone(a,n)}}else if(this.clockRange===e.LOOP_STOP){if(s.lessThan(n,i)){n=s.clone(i,n)}while(s.greaterThan(n,a)){n=s.addSeconds(i,s.secondsDifference(n,a),n)}}}}this.currentTime=n;this._lastSystemTime=r;this.onTick.raiseEvent(this);return n};return u})})();(function(){var t=e.amdDefine;t(\"22\",[\"1f\"],function(e){\"use strict\";var t={TICK_DEPENDENT:0,SYSTEM_CLOCK_MULTIPLIER:1,SYSTEM_CLOCK:2};return e(t)})})();(function(){var t=e.amdDefine;t(\"25\",[\"26\",\"1a\",\"1b\",\"1c\",\"27\",\"28\",\"29\"],function(e,t,r,n,i,a,o){\"use strict\";var s={id:undefined};var u=new Array(2);function f(e){var t=e.propertyNames;var r=t.length;for(var n=0;n<r;n++){e[t[n]]=undefined}}function c(e,t,r,n){u[0]=r;u[1]=n.id;t[JSON.stringify(u)]=n.definitionChanged.addEventListener(h.prototype._onDefinitionChanged,e)}function l(e,t,r,n){u[0]=r;u[1]=n.id;var i=JSON.stringify(u);t[i]();t[i]=undefined}function d(e){e._shouldRecomposite=true;if(e._suspendCount!==0){return}var r=e._collections;var n=r.length;var i=e._collectionsCopy;var u=i.length;var d;var v;var p;var m;var w;var y=e._composite;var g=new o(e);var S=e._eventHash;var b;for(d=0;d<u;d++){w=i[d];w.collectionChanged.removeEventListener(h.prototype._onCollectionChanged,e);p=w.values;b=w.id;for(m=p.length-1;m>-1;m--){v=p[m];l(e,S,b,v)}}for(d=n-1;d>=0;d--){w=r[d];w.collectionChanged.addEventListener(h.prototype._onCollectionChanged,e);p=w.values;b=w.id;for(m=p.length-1;m>-1;m--){v=p[m];c(e,S,b,v);var T=g.getById(v.id);if(!t(T)){T=y.getById(v.id);if(!t(T)){s.id=v.id;T=new a(s)}else{f(T)}g.add(T)}T.merge(v)}}e._collectionsCopy=r.slice(0);y.suspendEvents();y.removeAll();var _=g.values;for(d=0;d<_.length;d++){y.add(_[d])}y.resumeEvents()}function h(r,n){this._owner=n;this._composite=new o(this);this._suspendCount=0;this._collections=t(r)?r.slice():[];this._collectionsCopy=[];this._id=e();this._eventHash={};d(this);this._shouldRecomposite=false}r(h.prototype,{collectionChanged:{get:function(){return this._composite._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._composite.values}},owner:{get:function(){return this._owner}}});h.prototype.addCollection=function(e,r){var i=t(r);if(!t(e)){throw new n(\"collection is required.\")}if(i){if(r<0){throw new n(\"index must be greater than or equal to zero.\")}else if(r>this._collections.length){throw new n(\"index must be less than or equal to the number of collections.\")}}if(!i){r=this._collections.length;this._collections.push(e)}else{this._collections.splice(r,0,e)}d(this)};h.prototype.removeCollection=function(e){var t=this._collections.indexOf(e);if(t!==-1){this._collections.splice(t,1);d(this);return true}return false};h.prototype.removeAllCollections=function(){this._collections.length=0;d(this)};h.prototype.containsCollection=function(e){return this._collections.indexOf(e)!==-1};h.prototype.contains=function(e){return this._composite.contains(e)};h.prototype.indexOfCollection=function(e){return this._collections.indexOf(e)};h.prototype.getCollection=function(e){if(!t(e)){throw new n(\"index is required.\",\"index\")}return this._collections[e]};h.prototype.getCollectionsLength=function(){return this._collections.length};function v(e,r){if(!t(r)){throw new n(\"collection is required.\")}var i=e.indexOf(r);if(i===-1){throw new n(\"collection is not in this composite.\")}return i}function p(e,t,r){var n=e._collections;t=i.clamp(t,0,n.length-1);r=i.clamp(r,0,n.length-1);if(t===r){return}var a=n[t];n[t]=n[r];n[r]=a;d(e)}h.prototype.raiseCollection=function(e){var t=v(this._collections,e);p(this,t,t+1)};h.prototype.lowerCollection=function(e){var t=v(this._collections,e);p(this,t,t-1)};h.prototype.raiseCollectionToTop=function(e){var t=v(this._collections,e);if(t===this._collections.length-1){return}this._collections.splice(t,1);this._collections.push(e);d(this)};h.prototype.lowerCollectionToBottom=function(e){var t=v(this._collections,e);if(t===0){return}this._collections.splice(t,1);this._collections.splice(0,0,e);d(this)};h.prototype.suspendEvents=function(){this._suspendCount++;this._composite.suspendEvents()};h.prototype.resumeEvents=function(){if(this._suspendCount===0){throw new n(\"resumeEvents can not be called before suspendEvents.\")}this._suspendCount--;if(this._shouldRecomposite&&this._suspendCount===0){d(this);this._shouldRecomposite=false}this._composite.resumeEvents()};h.prototype.computeAvailability=function(){return this._composite.computeAvailability()};h.prototype.getById=function(e){return this._composite.getById(e)};h.prototype._onCollectionChanged=function(e,r,n){var i=this._collectionsCopy;var o=i.length;var u=this._composite;u.suspendEvents();var d;var h;var v;var p;var m=n.length;var w=this._eventHash;var y=e.id;for(d=0;d<m;d++){var g=n[d];l(this,w,y,g);var S=g.id;for(h=o-1;h>=0;h--){v=i[h].getById(S);if(t(v)){if(!t(p)){p=u.getById(S);f(p)}p.merge(v)}}if(!t(p)){u.removeById(S)}p=undefined}var b=r.length;for(d=0;d<b;d++){var T=r[d];c(this,w,y,T);var _=T.id;for(h=o-1;h>=0;h--){v=i[h].getById(_);if(t(v)){if(!t(p)){p=u.getById(_);if(!t(p)){s.id=_;p=new a(s);u.add(p)}else{f(p)}}p.merge(v)}}p=undefined}u.resumeEvents()};h.prototype._onDefinitionChanged=function(e,r,n,i){var a=this._collections;var o=this._composite;var s=a.length;var u=e.id;var f=o.getById(u);var c=f[r];var l=!t(c);var d=true;for(var h=s-1;h>=0;h--){var v=a[h].getById(e.id);if(t(v)){var p=v[r];if(t(p)){if(d){d=false;if(t(p.merge)&&t(p.clone)){c=p.clone(c)}else{c=p;break}}c.merge(p)}}}if(l&&f.propertyNames.indexOf(r)===-1){f.addProperty(r)}f[r]=c};return h})})();(function(){var t=e.amdDefine;t(\"2a\",[\"1a\",\"1b\",\"1c\"],function(e,t,r){\"use strict\";function n(){this._array=[];this._hash={}}t(n.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}});n.prototype.contains=function(t){if(typeof t!==\"string\"&&typeof t!==\"number\"){throw new r(\"key is required to be a string or number.\")}return e(this._hash[t])};n.prototype.set=function(e,t){if(typeof e!==\"string\"&&typeof e!==\"number\"){throw new r(\"key is required to be a string or number.\")}var n=this._hash[e];if(t!==n){this.remove(e);this._hash[e]=t;this._array.push(t)}};n.prototype.get=function(e){if(typeof e!==\"string\"&&typeof e!==\"number\"){throw new r(\"key is required to be a string or number.\")}return this._hash[e]};n.prototype.remove=function(t){if(e(t)&&typeof t!==\"string\"&&typeof t!==\"number\"){throw new r(\"key is required to be a string or number.\")}var n=this._hash[t];var i=e(n);if(i){var a=this._array;a.splice(a.indexOf(n),1);delete this._hash[t]}return i};n.prototype.removeAll=function(){var e=this._array;if(e.length>0){this._hash={};e.length=0}};return n})})();(function(){var t=e.amdDefine;t(\"26\",[],function(){\"use strict\";function e(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=Math.random()*16|0;var r=e===\"x\"?t:t&3|8;return r.toString(16)})}return e})})();(function(){var t=e.amdDefine;t(\"2b\",[\"2c\",\"23\",\"1a\",\"1b\",\"1c\",\"1d\",\"2d\",\"2e\"],function(e,t,r,n,i,a,o,s){\"use strict\";function u(r,n){this._definitionChanged=new a;this._value=e.clone(r);this._referenceFrame=t(n,o.FIXED)}n(u.prototype,{isConstant:{get:function(){return!r(this._value)||this._referenceFrame===o.FIXED}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}});u.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,o.FIXED,t)};u.prototype.setValue=function(t,n){var i=false;if(!e.equals(this._value,t)){i=true;this._value=e.clone(t)}if(r(n)&&this._referenceFrame!==n){i=true;this._referenceFrame=n}if(i){this._definitionChanged.raiseEvent(this)}};u.prototype.getValueInReferenceFrame=function(e,t,n){if(!r(e)){throw new i(\"time is required.\")}if(!r(t)){throw new i(\"referenceFrame is required.\")}return s.convertToReferenceFrame(e,this._value,this._referenceFrame,t,n)};u.prototype.equals=function(t){return this===t||t instanceof u&&e.equals(this._value,t._value)&&this._referenceFrame===t._referenceFrame};return u})})();(function(){var t=e.amdDefine;t(\"2f\",[\"23\",\"1a\",\"1b\",\"1c\",\"1d\"],function(e,t,r,n,i){\"use strict\";function a(e){this._value=undefined;this._hasClone=false;this._hasEquals=false;this._definitionChanged=new i;this.setValue(e)}r(a.prototype,{isConstant:{value:true},definitionChanged:{get:function(){return this._definitionChanged}}});a.prototype.getValue=function(e,t){return this._hasClone?this._value.clone(t):this._value};a.prototype.setValue=function(e){var r=this._value;if(r!==e){var n=t(e);var i=n&&typeof e.clone===\"function\";var a=n&&typeof e.equals===\"function\";this._hasClone=i;this._hasEquals=a;var o=!a||!e.equals(r);if(o){this._value=!i?e:e.clone();this._definitionChanged.raiseEvent(this)}}};a.prototype.equals=function(e){return this===e||e instanceof a&&(!this._hasEquals&&this._value===e._value||this._hasEquals&&this._value.equals(e._value))};return a})})();(function(){var t=e.amdDefine;t(\"30\",[\"23\",\"1a\",\"2f\"],function(e,t,r){\"use strict\";function n(e,r,n,i,a){return{configurable:i,get:function(){return this[r]},set:function(i){var o=this[r];var s=this[n];if(t(s)){s();this[n]=undefined}var u=t(i);if(u&&!t(i.getValue)&&t(a)){i=a(i)}if(o!==i){this[r]=i;this._definitionChanged.raiseEvent(this,e,i,o)}if(t(i)&&t(i.definitionChanged)){this[n]=i.definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this,e,i,i)},this)}}}}function i(e){return new r(e)}function a(t,r,a){return n(t,\"_\"+t.toString(),\"_\"+t.toString()+\"Subscription\",e(r,false),e(a,i))}return a})})();(function(){var t=e.amdDefine;t(\"31\",[\"30\"],function(e){\"use strict\";function t(e){return e}function r(r,n){return e(r,n,t)}return r})})();(function(){var t=e.amdDefine;t(\"28\",[\"2c\",\"26\",\"23\",\"1a\",\"1b\",\"1c\",\"1d\",\"32\",\"33\",\"34\",\"35\",\"@empty\",\"@empty\",\"2b\",\"@empty\",\"30\",\"31\",\"@empty\",\"@empty\",\"@empty\",\"@empty\",\"@empty\",\"@empty\",\"@empty\",\"@empty\",\"@empty\",\"@empty\",\"36\",\"@empty\",\"@empty\"],function(e,t,r,n,i,a,o,s,u,f,c,l,d,h,v,p,m,w,y,g,S,b,T,_,E,M,P,A,C,I){\"use strict\";function x(e){return new h(e)}function R(e){return p(e,undefined,x)}function O(e,t){return p(e,undefined,function(e){if(e instanceof t){return e}return new t(e)})}function D(e){e=r(e,r.EMPTY_OBJECT);var i=e.id;if(!n(i)){i=t()}this._availability=undefined;this._id=i;this._definitionChanged=new o;this._name=e.name;this._show=r(e.show,true);this._parent=undefined;this._propertyNames=[\"billboard\",\"box\",\"corridor\",\"cylinder\",\"description\",\"ellipse\",\"ellipsoid\",\"label\",\"model\",\"orientation\",\"path\",\"point\",\"polygon\",\"polyline\",\"polylineVolume\",\"position\",\"rectangle\",\"viewFrom\",\"wall\"];this._billboard=undefined;this._billboardSubscription=undefined;this._box=undefined;this._boxSubscription=undefined;this._corridor=undefined;this._corridorSubscription=undefined;this._cylinder=undefined;this._cylinderSubscription=undefined;this._description=undefined;this._descriptionSubscription=undefined;this._ellipse=undefined;this._ellipseSubscription=undefined;this._ellipsoid=undefined;this._ellipsoidSubscription=undefined;this._label=undefined;this._labelSubscription=undefined;this._model=undefined;this._modelSubscription=undefined;this._orientation=undefined;this._orientationSubscription=undefined;this._path=undefined;this._pathSubscription=undefined;this._point=undefined;this._pointSubscription=undefined;this._polygon=undefined;this._polygonSubscription=undefined;this._polyline=undefined;this._polylineSubscription=undefined;this._polylineVolume=undefined;this._polylineVolumeSubscription=undefined;this._position=undefined;this._positionSubscription=undefined;this._rectangle=undefined;this._rectangleSubscription=undefined;this._viewFrom=undefined;this._viewFromSubscription=undefined;this._wall=undefined;this._wallSubscription=undefined;this._children=[];this.entityCollection=undefined;this.parent=e.parent;this.merge(e)}function q(e,t,r){var n=t.length;for(var i=0;i<n;i++){var a=t[i];var o=a._show;var s=!r&&o;var u=r&&o;if(s!==u){q(a,a._children,r)}}e._definitionChanged.raiseEvent(e,\"isShowing\",r,!r)}i(D.prototype,{availability:m(\"availability\"),id:{get:function(){return this._id}},definitionChanged:{get:function(){return this._definitionChanged}},name:m(\"name\"),show:{get:function(){return this._show},set:function(e){if(!n(e)){throw new a(\"value is required.\")}if(e===this._show){return}var t=this.isShowing;this._show=e;var r=this.isShowing;if(t!==r){q(this,this._children,r)}this._definitionChanged.raiseEvent(this,\"show\",e,!e)}},isShowing:{get:function(){return this._show&&(!n(this.entityCollection)||this.entityCollection.show)&&(!n(this._parent)||this._parent.isShowing)}},parent:{get:function(){return this._parent},set:function(e){var t=this._parent;if(t===e){return}var r=this.isShowing;if(n(t)){var i=t._children.indexOf(this);t._children.splice(i,1)}this._parent=e;if(n(e)){e._children.push(this)}var a=this.isShowing;if(r!==a){q(this,this._children,a)}this._definitionChanged.raiseEvent(this,\"parent\",e,t)}},propertyNames:{get:function(){return this._propertyNames}},billboard:O(\"billboard\",l),box:O(\"box\",d),corridor:O(\"corridor\",v),cylinder:O(\"cylinder\",w),description:p(\"description\"),ellipse:O(\"ellipse\",y),ellipsoid:O(\"ellipsoid\",g),label:O(\"label\",S),model:O(\"model\",b),orientation:p(\"orientation\"),path:O(\"path\",T),point:O(\"point\",_),polygon:O(\"polygon\",E),polyline:O(\"polyline\",M),polylineVolume:O(\"polylineVolume\",P),position:R(\"position\"),rectangle:O(\"rectangle\",C),viewFrom:p(\"viewFrom\"),wall:O(\"wall\",I)});D.prototype.isAvailable=function(e){if(!n(e)){throw new a(\"time is required.\")}var t=this._availability;return!n(t)||t.contains(e)};D.prototype.addProperty=function(e){var t=this._propertyNames;if(!n(e)){throw new a(\"propertyName is required.\")}if(t.indexOf(e)!==-1){throw new a(e+\" is already a registered property.\")}if(e in this){throw new a(e+\" is a reserved property name.\")}t.push(e);Object.defineProperty(this,e,m(e,true))};D.prototype.removeProperty=function(e){var t=this._propertyNames;var r=t.indexOf(e);if(!n(e)){throw new a(\"propertyName is required.\")}if(r===-1){throw new a(e+\" is not a registered property.\")}this._propertyNames.splice(r,1);delete this[e]};D.prototype.merge=function(e){if(!n(e)){throw new a(\"source is required.\")}this.name=r(this.name,e.name);this.availability=r(e.availability,this.availability);var t=this._propertyNames;var i=n(e._propertyNames)?e._propertyNames:Object.keys(e);var o=i.length;for(var s=0;s<o;s++){var u=i[s];if(u===\"parent\"){continue}var f=this[u];var c=e[u];if(!n(f)&&t.indexOf(u)===-1){this.addProperty(u)}if(n(c)){if(n(f)){if(n(f.merge)){f.merge(c)}}else if(n(c.merge)&&n(c.clone)){this[u]=c.clone()}else{this[u]=c}}}};var N=new s;var G=new e;var L=new f;D.prototype._getModelMatrix=function(e,t){var r=A.getValueOrUndefined(this._position,e,G);if(!n(r)){return undefined}var i=A.getValueOrUndefined(this._orientation,e,L);if(!n(i)){t=c.eastNorthUpToFixedFrame(r,undefined,t)}else{t=u.fromRotationTranslation(s.fromQuaternion(i,N),r,t)}return t};return D})})();(function(){var t=e.amdDefine;t(\"29\",[\"2a\",\"26\",\"1a\",\"1b\",\"1c\",\"1d\",\"37\",\"24\",\"38\",\"39\",\"28\"],function(e,t,r,n,i,a,o,s,u,f,c){\"use strict\";var l={id:undefined};function d(e){if(e._firing){e._refire=true;return}if(e._suspendCount===0){var t=e._addedEntities;var r=e._removedEntities;var n=e._changedEntities;if(n.length!==0||t.length!==0||r.length!==0){e._firing=true;do{e._refire=false;var i=t.values.slice(0);var a=r.values.slice(0);var o=n.values.slice(0);t.removeAll();r.removeAll();n.removeAll();e._collectionChanged.raiseEvent(e,i,a,o)}while(e._refire);e._firing=false}}}function h(r){this._owner=r;this._entities=new e;this._addedEntities=new e;this._removedEntities=new e;this._changedEntities=new e;this._suspendCount=0;this._collectionChanged=new a;this._id=t();this._show=true;this._firing=false;this._refire=false}h.prototype.suspendEvents=function(){this._suspendCount++};h.prototype.resumeEvents=function(){if(this._suspendCount===0){throw new i(\"resumeEvents can not be called before suspendEvents.\")}this._suspendCount--;d(this)};h.collectionChangedEventCallback=undefined;n(h.prototype,{collectionChanged:{get:function(){return this._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._entities.values}},show:{get:function(){return this._show},set:function(e){if(!r(e)){throw new i(\"value is required.\")}if(e===this._show){return}this.suspendEvents();var t;var n=[];var a=this._entities.values;var o=a.length;for(t=0;t<o;t++){n.push(a[t].isShowing)}this._show=e;for(t=0;t<o;t++){var s=n[t];var u=a[t];if(s!==u.isShowing){u.definitionChanged.raiseEvent(u,\"isShowing\",u.isShowing,s)}}this.resumeEvents()}},owner:{get:function(){return this._owner}}});h.prototype.computeAvailability=function(){var e=o.MAXIMUM_VALUE;var t=o.MINIMUM_VALUE;var n=this._entities.values;for(var i=0,a=n.length;i<a;i++){var u=n[i];var c=u.availability;if(r(c)){var l=c.start;var d=c.stop;if(s.lessThan(l,e)&&!l.equals(o.MINIMUM_VALUE)){e=l}if(s.greaterThan(d,t)&&!d.equals(o.MAXIMUM_VALUE)){t=d}}}if(o.MAXIMUM_VALUE.equals(e)){e=o.MINIMUM_VALUE}if(o.MINIMUM_VALUE.equals(t)){t=o.MAXIMUM_VALUE}return new f({start:e,stop:t})};h.prototype.add=function(e){if(!r(e)){throw new i(\"entity is required.\")}if(!(e instanceof c)){e=new c(e)}var t=e.id;var n=this._entities;if(n.contains(t)){throw new u(\"An entity with id \"+t+\" already exists in this collection.\")}e.entityCollection=this;n.set(t,e);if(!this._removedEntities.remove(t)){this._addedEntities.set(t,e)}e.definitionChanged.addEventListener(h.prototype._onEntityDefinitionChanged,this);d(this);return e};h.prototype.remove=function(e){if(!r(e)){return false}return this.removeById(e.id)};h.prototype.contains=function(e){if(!r(e)){throw new i(\"entity is required\")}return this._entities.get(e.id)===e};h.prototype.removeById=function(e){if(!r(e)){return false}var t=this._entities;var n=t.get(e);if(!this._entities.remove(e)){return false}if(!this._addedEntities.remove(e)){this._removedEntities.set(e,n);this._changedEntities.remove(e)}this._entities.remove(e);n.definitionChanged.removeEventListener(h.prototype._onEntityDefinitionChanged,this);d(this);return true};h.prototype.removeAll=function(){var e=this._entities;var t=e.length;var n=e.values;var i=this._addedEntities;var a=this._removedEntities;for(var o=0;o<t;o++){var s=n[o];var u=s.id;var f=i.get(u);if(!r(f)){s.definitionChanged.removeEventListener(h.prototype._onEntityDefinitionChanged,this);a.set(u,s)}}e.removeAll();i.removeAll();this._changedEntities.removeAll();d(this)};h.prototype.getById=function(e){if(!r(e)){throw new i(\"id is required.\")}return this._entities.get(e)};h.prototype.getOrCreateEntity=function(e){if(!r(e)){throw new i(\"id is required.\")}var t=this._entities.get(e);if(!r(t)){l.id=e;t=new c(l);this.add(t)}return t};h.prototype._onEntityDefinitionChanged=function(e){var t=e.id;if(!this._addedEntities.contains(t)){this._changedEntities.set(t,e)}d(this)};return h})})();(function(){var t=e.amdDefine;t(\"3a\",[\"2c\",\"3b\",\"23\",\"1a\",\"1b\",\"1c\",\"3c\"],function(e,t,r,n,i,a,o){\"use strict\";function s(e){this._ellipsoid=r(e,o.WGS84);this._semimajorAxis=this._ellipsoid.maximumRadius;this._oneOverSemimajorAxis=1/this._semimajorAxis}i(s.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});s.prototype.project=function(t,r){var i=this._semimajorAxis;var a=t.longitude*i;var o=t.latitude*i;var s=t.height;if(!n(r)){return new e(a,o,s)}r.x=a;r.y=o;r.z=s;return r};s.prototype.unproject=function(e,r){if(!n(e)){throw new a(\"cartesian is required\")}var i=this._oneOverSemimajorAxis;var o=e.x*i;var s=e.y*i;var u=e.z;if(!n(r)){return new t(o,s,u)}r.longitude=o;r.latitude=s;r.height=u;return r};return s})})();(function(){var t=e.amdDefine;t(\"3d\",[\"23\",\"1a\",\"1c\",\"27\"],function(e,t,r,n){\"use strict\";var i=n.factorial;function a(e,t,r,n,i,o){var s=0;var u;var f;var c;if(n>0){for(f=0;f<i;f++){u=false;for(c=0;c<o.length&&!u;c++){if(f===o[c]){u=true}}if(!u){o.push(f);s+=a(e,t,r,n-1,i,o);o.splice(o.length-1,1)}}return s}s=1;for(f=0;f<i;f++){u=false;for(c=0;c<o.length&&!u;c++){if(f===o[c]){u=true}}if(!u){s*=e-r[t[f]]}}return s}var o={type:\"Hermite\"};o.getRequiredDataPoints=function(n,i){i=e(i,0);if(!t(n)){throw new r(\"degree is required.\")}if(n<0){throw new r(\"degree must be 0 or greater.\")}if(i<0){throw new r(\"inputOrder must be 0 or greater.\")}return Math.max(Math.floor((n+1)/(i+1)),2)};o.interpolateOrderZero=function(e,r,n,o,s){if(!t(s)){s=new Array(o)}var u;var f;var c;var l;var d;var h;var v=r.length;var p=new Array(o);for(u=0;u<o;u++){s[u]=0;var m=new Array(v);p[u]=m;for(f=0;f<v;f++){m[f]=[]}}var w=v,y=new Array(w);for(u=0;u<w;u++){y[u]=u}var g=v-1;for(l=0;l<o;l++){for(f=0;f<w;f++){h=y[f]*o+l;p[l][0].push(n[h])}for(u=1;u<w;u++){var S=false;for(f=0;f<w-u;f++){var b=r[y[f]];var T=r[y[f+u]];var _;if(T-b<=0){h=y[f]*o+o*u+l;_=n[h];p[l][u].push(_/i(u))}else{_=p[l][u-1][f+1]-p[l][u-1][f];p[l][u].push(_/(T-b))}S=S||_!==0}if(!S){g=u-1}}}for(c=0,d=0;c<=d;c++){for(u=c;u<=g;u++){var E=a(e,y,r,c,u,[]);for(l=0;l<o;l++){var M=p[l][u][0];s[l+c*o]+=M*E}}}return s};var s=[];o.interpolate=function(e,r,n,i,o,f,c){var l=i*(f+1);if(!t(c)){c=new Array(l)}for(var d=0;d<l;d++){c[d]=0}var h=r.length;var v=new Array(h*(o+1));for(var p=0;p<h;p++){for(var m=0;m<o+1;m++){v[p*(o+1)+m]=p}}var w=v.length;var y=s;var g=u(y,v,r,n,i,o);var S=[];var b=w*(w+1)/2;var T=Math.min(g,f);for(var _=0;_<=T;_++){for(p=_;p<=g;p++){S.length=0;var E=a(e,v,r,_,p,S);var M=Math.floor(p*(1-p)/2)+w*p;for(var P=0;P<i;P++){var A=Math.floor(P*b);var C=y[A+M];c[P+_*i]+=C*E}}}return c};function u(e,t,r,i,a,o){var s;var u;var f=-1;var c=t.length;var l=c*(c+1)/2;for(var d=0;d<a;d++){var h=Math.floor(d*l);for(s=0;s<c;s++){u=t[s]*a*(o+1)+d;e[h+s]=i[u]}for(var v=1;v<c;v++){var p=0;var m=Math.floor(v*(1-v)/2)+c*v;var w=false;for(s=0;s<c-v;s++){var y=r[t[s]];var g=r[t[s+v]];var S;var b;if(g-y<=0){u=t[s]*a*(o+1)+a*v+d;S=i[u];b=S/n.factorial(v);e[h+m+p]=b;p++}else{var T=Math.floor((v-1)*(2-v)/2)+c*(v-1);S=e[h+T+s+1]-e[h+T+s];b=S/(g-y);e[h+m+p]=b;p++}w=w||S!==0}if(w){f=Math.max(f,v)}}}return f}return o})})();(function(){var t=e.amdDefine;t(\"3e\",[\"1a\",\"1b\",\"1c\",\"32\",\"34\",\"2d\",\"35\"],function(e,t,r,n,i,a,o){\"use strict\";var s=function(){r.throwInstantiationError()};t(s.prototype,{isConstant:{get:r.throwInstantiationError},definitionChanged:{get:r.throwInstantiationError}});s.prototype.getValue=r.throwInstantiationError;s.prototype.equals=r.throwInstantiationError;function u(e,t){return e&&e.id?e.id===(t&&t.id):e===t}function f(t){var r=[];while(e(t)){r.unshift(t);t=t.position&&t.position.referenceFrame}return r}function c(e,t){if(!u(e[0],t[0])){return-1}var r=Math.min(e.length,t.length);for(var n=0;n<=r;n++){if(!u(e[n],t[n])){return n-1}}return-1}var l=new n;var d=new i;function h(t){var r=o.computeIcrfToFixedMatrix(t,l);if(!e(r)){r=o.computeTemeToPseudoFixedMatrix(t,l)}return i.fromRotationMatrix(r,d)}var v=new i;s.convertToReferenceFrame=function(t,r,n,o,s){if(!e(r)){return r}if(!e(s)){s=new i}if(n===o){return i.clone(r,s)}if(!e(n)||!e(o)){return undefined}var u=f(n);var l=f(o);var d=c(u,l);var p=u[d];var m=function(r,n){if(!e(r)){return r}var a=n.orientation;if(!e(a)){return undefined}var o=a.getValue(t,v);if(!e(o)){return undefined}return i.multiply(o,r,r)};var w=function(r,n){if(!e(r)){return r}var a=n.orientation;if(!e(a)){return undefined}var o=a.getValue(t,v);if(!e(o)){return undefined}i.conjugate(o,o);return i.multiply(o,r,r)};if(e(p)){u=u.slice(d+1);l=l.slice(d+1);var y=u.reduceRight(m,i.clone(r,s));if(!e(y)){return undefined}return l.reduce(w,y)}var g=u.shift();var S=l.shift();var b,T;if(g===a.INERTIAL&&S===a.FIXED){T=u.reduceRight(m,i.clone(r,s));if(!e(T)){return undefined}b=i.multiply(h(t),T,s);return l.reduce(w,b)}if(g===a.FIXED&&S===a.INERTIAL){b=u.reduceRight(m,i.clone(r,s));if(!e(b)){return undefined}var _=i.conjugate(h(t),v);T=i.multiply(_,b,s);return l.reduce(w,T)}return undefined};return s})})();(function(){var t=e.amdDefine;t(\"3f\",[\"1a\",\"1b\",\"1c\",\"40\"],function(e,t,r,n){\"use strict\";function i(){this._offCenterFrustum=new n;this.fov=undefined;this._fov=undefined;this._fovy=undefined;this._sseDenominator=undefined;this.aspectRatio=undefined;this._aspectRatio=undefined;this.near=1;this._near=this.near;this.far=5e8;this._far=this.far;this.xOffset=0;this._xOffset=this.xOffset;this.yOffset=0;this._yOffset=this.yOffset}function a(t){if(!e(t.fov)||!e(t.aspectRatio)||!e(t.near)||!e(t.far)){throw new r(\"fov, aspectRatio, near, or far parameters are not set.\")}var n=t._offCenterFrustum;if(t.fov!==t._fov||t.aspectRatio!==t._aspectRatio||t.near!==t._near||t.far!==t._far||t.xOffset!==t._xOffset||t.yOffset!==t._yOffset){if(t.fov<0||t.fov>=Math.PI){throw new r(\"fov must be in the range [0, PI).\")}if(t.aspectRatio<0){throw new r(\"aspectRatio must be positive.\")}if(t.near<0||t.near>t.far){throw new r(\"near must be greater than zero and less than far.\")}t._aspectRatio=t.aspectRatio;t._fov=t.fov;t._fovy=t.aspectRatio<=1?t.fov:Math.atan(Math.tan(t.fov*.5)/t.aspectRatio)*2;t._near=t.near;t._far=t.far;t._sseDenominator=2*Math.tan(.5*t._fovy);t._xOffset=t.xOffset;t._yOffset=t.yOffset;n.top=t.near*Math.tan(.5*t._fovy);n.bottom=-n.top;n.right=t.aspectRatio*n.top;n.left=-n.right;n.near=t.near;n.far=t.far;n.right+=t.xOffset;n.left+=t.xOffset;n.top+=t.yOffset;n.bottom+=t.yOffset}}t(i.prototype,{projectionMatrix:{get:function(){a(this);return this._offCenterFrustum.projectionMatrix}},infiniteProjectionMatrix:{get:function(){a(this);return this._offCenterFrustum.infiniteProjectionMatrix}},fovy:{get:function(){a(this);return this._fovy}},sseDenominator:{get:function(){a(this);return this._sseDenominator}}});i.prototype.computeCullingVolume=function(e,t,r){a(this);return this._offCenterFrustum.computeCullingVolume(e,t,r)};i.prototype.getPixelDimensions=function(e,t,r,n){a(this);return this._offCenterFrustum.getPixelDimensions(e,t,r,n);\n};i.prototype.clone=function(t){if(!e(t)){t=new i}t.aspectRatio=this.aspectRatio;t.fov=this.fov;t.near=this.near;t.far=this.far;t._aspectRatio=undefined;t._fov=undefined;t._near=undefined;t._far=undefined;this._offCenterFrustum.clone(t._offCenterFrustum);return t};i.prototype.equals=function(t){if(!e(t)){return false}a(this);a(t);return this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum)};return i})})();(function(){var t=e.amdDefine;t(\"41\",[\"1f\"],function(e){\"use strict\";var t={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};return e(t)})})();(function(){var t=e.amdDefine;t(\"42\",[\"2c\",\"43\",\"23\",\"1a\",\"1c\",\"41\",\"44\"],function(e,t,r,n,i,a,o){\"use strict\";function s(e){this.planes=r(e,[])}var u=[new e,new e,new e];e.clone(e.UNIT_X,u[0]);e.clone(e.UNIT_Y,u[1]);e.clone(e.UNIT_Z,u[2]);var f=new e;var c=new e;var l=new o(new e,0);s.fromBoundingSphere=function(r,a){if(!n(r)){throw new i(\"boundingSphere is required.\")}if(!n(a)){a=new s}var o=u.length;var l=a.planes;l.length=2*o;var d=r.center;var h=r.radius;var v=0;for(var p=0;p<o;++p){var m=u[p];var w=l[v];var y=l[v+1];if(!n(w)){w=l[v]=new t}if(!n(y)){y=l[v+1]=new t}e.multiplyByScalar(m,-h,f);e.add(d,f,f);w.x=m.x;w.y=m.y;w.z=m.z;w.w=-e.dot(m,f);e.multiplyByScalar(m,h,f);e.add(d,f,f);y.x=-m.x;y.y=-m.y;y.z=-m.z;y.w=-e.dot(e.negate(m,c),f);v+=2}return a};s.prototype.computeVisibility=function(e){if(!n(e)){throw new i(\"boundingVolume is required.\")}var t=this.planes;var r=false;for(var s=0,u=t.length;s<u;++s){var f=e.intersectPlane(o.fromCartesian4(t[s],l));if(f===a.OUTSIDE){return a.OUTSIDE}else if(f===a.INTERSECTING){r=true}}return r?a.INTERSECTING:a.INSIDE};s.prototype.computeVisibilityWithPlaneMask=function(e,t){if(!n(e)){throw new i(\"boundingVolume is required.\")}if(!n(t)){throw new i(\"parentPlaneMask is required.\")}if(t===s.MASK_OUTSIDE||t===s.MASK_INSIDE){return t}var r=s.MASK_INSIDE;var u=this.planes;for(var f=0,c=u.length;f<c;++f){var d=f<31?1<<f:0;if(f<31&&(t&d)===0){continue}var h=e.intersectPlane(o.fromCartesian4(u[f],l));if(h===a.OUTSIDE){return s.MASK_OUTSIDE}else if(h===a.INTERSECTING){r|=d}}return r};s.MASK_OUTSIDE=4294967295;s.MASK_INSIDE=0;s.MASK_INDETERMINATE=2147483647;return s})})();(function(){var t=e.amdDefine;t(\"40\",[\"45\",\"2c\",\"43\",\"23\",\"1a\",\"1b\",\"1c\",\"33\",\"42\"],function(e,t,r,n,i,a,o,s,u){\"use strict\";function f(){this.left=undefined;this._left=undefined;this.right=undefined;this._right=undefined;this.top=undefined;this._top=undefined;this.bottom=undefined;this._bottom=undefined;this.near=1;this._near=this.near;this.far=5e8;this._far=this.far;this._cullingVolume=new u;this._perspectiveMatrix=new s;this._infinitePerspective=new s}function c(e){if(!i(e.right)||!i(e.left)||!i(e.top)||!i(e.bottom)||!i(e.near)||!i(e.far)){throw new o(\"right, left, top, bottom, near, or far parameters are not set.\")}var t=e.top;var r=e.bottom;var n=e.right;var a=e.left;var u=e.near;var f=e.far;if(t!==e._top||r!==e._bottom||a!==e._left||n!==e._right||u!==e._near||f!==e._far){if(e.near<=0||e.near>e.far){throw new o(\"near must be greater than zero and less than far.\")}e._left=a;e._right=n;e._top=t;e._bottom=r;e._near=u;e._far=f;e._perspectiveMatrix=s.computePerspectiveOffCenter(a,n,r,t,u,f,e._perspectiveMatrix);e._infinitePerspective=s.computeInfinitePerspectiveOffCenter(a,n,r,t,u,e._infinitePerspective)}}a(f.prototype,{projectionMatrix:{get:function(){c(this);return this._perspectiveMatrix}},infiniteProjectionMatrix:{get:function(){c(this);return this._infinitePerspective}}});var l=new t;var d=new t;var h=new t;var v=new t;f.prototype.computeCullingVolume=function(e,n,a){if(!i(e)){throw new o(\"position is required.\")}if(!i(n)){throw new o(\"direction is required.\")}if(!i(a)){throw new o(\"up is required.\")}var s=this._cullingVolume.planes;var u=this.top;var f=this.bottom;var c=this.right;var p=this.left;var m=this.near;var w=this.far;var y=t.cross(n,a,l);var g=d;t.multiplyByScalar(n,m,g);t.add(e,g,g);var S=h;t.multiplyByScalar(n,w,S);t.add(e,S,S);var b=v;t.multiplyByScalar(y,p,b);t.add(g,b,b);t.subtract(b,e,b);t.normalize(b,b);t.cross(b,a,b);var T=s[0];if(!i(T)){T=s[0]=new r}T.x=b.x;T.y=b.y;T.z=b.z;T.w=-t.dot(b,e);t.multiplyByScalar(y,c,b);t.add(g,b,b);t.subtract(b,e,b);t.normalize(b,b);t.cross(a,b,b);T=s[1];if(!i(T)){T=s[1]=new r}T.x=b.x;T.y=b.y;T.z=b.z;T.w=-t.dot(b,e);t.multiplyByScalar(a,f,b);t.add(g,b,b);t.subtract(b,e,b);t.normalize(b,b);t.cross(y,b,b);T=s[2];if(!i(T)){T=s[2]=new r}T.x=b.x;T.y=b.y;T.z=b.z;T.w=-t.dot(b,e);t.multiplyByScalar(a,u,b);t.add(g,b,b);t.subtract(b,e,b);t.normalize(b,b);t.cross(b,y,b);T=s[3];if(!i(T)){T=s[3]=new r}T.x=b.x;T.y=b.y;T.z=b.z;T.w=-t.dot(b,e);T=s[4];if(!i(T)){T=s[4]=new r}T.x=n.x;T.y=n.y;T.z=n.z;T.w=-t.dot(n,g);t.negate(n,b);T=s[5];if(!i(T)){T=s[5]=new r}T.x=b.x;T.y=b.y;T.z=b.z;T.w=-t.dot(b,S);return this._cullingVolume};f.prototype.getPixelDimensions=function(e,t,r,n){c(this);if(!i(e)||!i(t)){throw new o(\"Both drawingBufferWidth and drawingBufferHeight are required.\")}if(e<=0){throw new o(\"drawingBufferWidth must be greater than zero.\")}if(t<=0){throw new o(\"drawingBufferHeight must be greater than zero.\")}if(!i(r)){throw new o(\"distance is required.\")}if(!i(n)){throw new o(\"A result object is required.\")}var a=1/this.near;var s=this.top*a;var u=2*r*s/t;s=this.right*a;var f=2*r*s/e;n.x=f;n.y=u;return n};f.prototype.clone=function(e){if(!i(e)){e=new f}e.right=this.right;e.left=this.left;e.top=this.top;e.bottom=this.bottom;e.near=this.near;e.far=this.far;e._left=undefined;e._right=undefined;e._top=undefined;e._bottom=undefined;e._near=undefined;e._far=undefined;return e};f.prototype.equals=function(e){return i(e)&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far};return f})})();(function(){var t=e.amdDefine;t(\"46\",[\"1a\",\"1b\",\"1c\",\"1d\",\"36\"],function(e,t,r,n,i){\"use strict\";function a(t){var r=t._targetEntity;if(t._resolveEntity){r=t._targetCollection.getById(t._targetId);if(e(r)){t._targetEntity=r;t._resolveEntity=false}}return r}var o=function(t,i){if(!e(t)){throw new r(\"targetCollection is required.\")}if(!e(i)||i===\"\"){throw new r(\"targetId is required.\")}this._targetCollection=t;this._targetId=i;this._targetEntity=undefined;this._definitionChanged=new n;this._resolveEntity=true;t.collectionChanged.addEventListener(o.prototype._onCollectionChanged,this)};t(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},id:{get:function(){return this._targetId}},position:{get:function(){var t=a(this);return e(t)?t.position:undefined}},orientation:{get:function(){var t=a(this);return e(t)?t.orientation:undefined}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},resolvedEntity:{get:function(){return a(this)}}});o.prototype._onCollectionChanged=function(t,r,n){var i=this._targetEntity;if(e(i)){if(n.indexOf(i)!==-1){this._resolveEntity=true}else if(this._resolveEntity){a(this);if(!this._resolveEntity){this._definitionChanged.raiseEvent(this)}}}};return o})})();(function(){var t=e.amdDefine;t(\"47\",[\"1a\",\"1b\",\"1c\",\"1d\",\"38\",\"36\"],function(e,t,r,n,i,a){\"use strict\";function o(t){var r=true;if(t._resolveEntity){var n=t._targetCollection.getById(t._targetId);if(e(n)){n.definitionChanged.addEventListener(u.prototype._onTargetEntityDefinitionChanged,t);t._targetEntity=n;t._resolveEntity=false}else{n=t._targetEntity;r=false}if(!e(n)){throw new i('target entity \"'+t._targetId+'\" could not be resolved.')}}return r}function s(t){var r=t._targetProperty;if(t._resolveProperty){var n=o(t);var a=t._targetPropertyNames;r=t._targetEntity;var s=a.length;for(var u=0;u<s&&e(r);u++){r=r[a[u]]}if(e(r)){t._targetProperty=r;t._resolveProperty=!n}else if(!e(t._targetProperty)){throw new i('targetProperty \"'+t._targetId+\".\"+a.join(\".\")+'\" could not be resolved.')}}return r}function u(t,i,a){if(!e(t)){throw new r(\"targetCollection is required.\")}if(!e(i)||i===\"\"){throw new r(\"targetId is required.\")}if(!e(a)||a.length===0){throw new r(\"targetPropertyNames is required.\")}for(var o=0;o<a.length;o++){var s=a[o];if(!e(s)||s===\"\"){throw new r(\"reference contains invalid properties.\")}}this._targetCollection=t;this._targetId=i;this._targetPropertyNames=a;this._targetProperty=undefined;this._targetEntity=undefined;this._definitionChanged=new n;this._resolveEntity=true;this._resolveProperty=true;t.collectionChanged.addEventListener(u.prototype._onCollectionChanged,this)}t(u.prototype,{isConstant:{get:function(){return a.isConstant(s(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return s(this).referenceFrame}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return s(this)}}});u.fromString=function(t,n){if(!e(t)){throw new r(\"targetCollection is required.\")}if(!e(n)){throw new r(\"referenceString is required.\")}var i;var a=[];var o=true;var s=false;var f=\"\";for(var c=0;c<n.length;++c){var l=n.charAt(c);if(s){f+=l;s=false}else if(l===\"\\\\\"){s=true}else if(o&&l===\"#\"){i=f;o=false;f=\"\"}else if(!o&&l===\".\"){a.push(f);f=\"\"}else{f+=l}}a.push(f);return new u(t,i,a)};u.prototype.getValue=function(e,t){return s(this).getValue(e,t)};u.prototype.getValueInReferenceFrame=function(e,t,r){return s(this).getValueInReferenceFrame(e,t,r)};u.prototype.getType=function(e){return s(this).getType(e)};u.prototype.equals=function(e){if(this===e){return true}var t=this._targetPropertyNames;var r=e._targetPropertyNames;if(this._targetCollection!==e._targetCollection||this._targetId!==e._targetId||t.length!==r.length){return false}var n=this._targetPropertyNames.length;for(var i=0;i<n;i++){if(t[i]!==r[i]){return false}}return true};u.prototype._onTargetEntityDefinitionChanged=function(e,t,r,n){if(this._targetPropertyNames[0]===t){this._resolveProperty=true;this._definitionChanged.raiseEvent(this)}};u.prototype._onCollectionChanged=function(t,r,n){var i=this._targetEntity;if(e(i)){if(n.indexOf(i)!==-1){i.definitionChanged.removeEventListener(u.prototype._onTargetEntityDefinitionChanged,this);this._resolveEntity=true;this._resolveProperty=true}else if(this._resolveEntity){s(this);if(!this._resolveEntity){this._definitionChanged.raiseEvent(this)}}}};return u})})();(function(){var t=e.amdDefine;t(\"2d\",[\"1f\"],function(e){\"use strict\";var t={FIXED:0,INERTIAL:1};return e(t)})})();(function(){var t=e.amdDefine;t(\"2e\",[\"2c\",\"1a\",\"1b\",\"1c\",\"32\",\"33\",\"34\",\"2d\",\"35\"],function(e,t,r,n,i,a,o,s,u){\"use strict\";function f(){n.throwInstantiationError()}r(f.prototype,{isConstant:{get:n.throwInstantiationError},definitionChanged:{get:n.throwInstantiationError},referenceFrame:{get:n.throwInstantiationError}});f.prototype.getValue=n.throwInstantiationError;f.prototype.getValueInReferenceFrame=n.throwInstantiationError;f.prototype.equals=n.throwInstantiationError;function c(e,t){return e&&e.id?e.id===(t&&t.id):e===t}function l(e){var r=[];while(t(e)){r.unshift(e);e=e.position&&e.position.referenceFrame}return r}function d(e,t){if(!c(e[0],t[0])){return-1}var r=Math.min(e.length,t.length);for(var n=0;n<=r;n++){if(!c(e[n],t[n])){return n-1}}return-1}var h=new i;function v(e){var r=u.computeIcrfToFixedMatrix(e,h);if(!t(r)){r=u.computeTemeToPseudoFixedMatrix(e,h)}return r}var p=new i;var m=new e;var w=new o;f.convertToReferenceFrame=function(r,n,a,u,f){if(!t(n)){return n}if(!t(f)){f=new e}if(a===u){return e.clone(n,f)}if(!t(a)||!t(u)){return undefined}var c=l(a);var h=l(u);var y=d(c,h);var g=c[y];var S=function(n,a){if(!t(n)){return n}var o=a.position;if(!t(o)){return undefined}var s=o.referenceFrame;var u=o.getValueInReferenceFrame(r,s,m);if(!t(u)){return undefined}var f=a.orientation;if(t(f)){var c=f.getValue(r,w);if(!t(c)){return undefined}i.fromQuaternion(c,p);i.multiplyByVector(p,n,n);return e.add(u,n,n)}return e.add(u,n,n)};var b=function(n,a){if(!t(n)){return n}var s=a.position;if(!t(s)){return undefined}var u=s.referenceFrame;var f=s.getValueInReferenceFrame(r,u,m);if(!t(f)){return undefined}n=e.subtract(n,f,n);var c=a.orientation;if(t(c)){var l=c.getValue(r,w);if(!t(l)){return undefined}o.conjugate(l,l);i.fromQuaternion(l,p);i.multiplyByVector(p,n,n)}return n};if(t(g)){c=c.slice(y+1);h=h.slice(y+1);var T=c.reduceRight(S,e.clone(n,f));if(!t(T)){return undefined}return h.reduce(b,T)}var _=c.shift();var E=h.shift();var M,P;if(_===s.INERTIAL&&E===s.FIXED){P=c.reduceRight(S,e.clone(n,f));if(!t(P)){return undefined}M=i.multiplyByVector(v(r),P,f);return h.reduce(b,M)}if(_===s.FIXED&&E===s.INERTIAL){M=c.reduceRight(S,e.clone(n,f));if(!t(M)){return undefined}var A=i.transpose(v(r),p);P=i.multiplyByVector(A,M,f);return h.reduce(b,P)}return undefined};return f})})();(function(){var t=e.amdDefine;t(\"39\",[\"23\",\"1a\",\"1b\",\"1c\",\"1f\",\"24\"],function(e,t,r,n,i,a){\"use strict\";function o(r){r=e(r,e.EMPTY_OBJECT);this.start=t(r.start)?a.clone(r.start):new a;this.stop=t(r.stop)?a.clone(r.stop):new a;this.data=r.data;this.isStartIncluded=e(r.isStartIncluded,true);this.isStopIncluded=e(r.isStopIncluded,true)}r(o.prototype,{isEmpty:{get:function(){var e=a.compare(this.stop,this.start);return e<0||e===0&&(!this.isStartIncluded||!this.isStopIncluded)}}});var s={start:undefined,stop:undefined,isStartIncluded:undefined,isStopIncluded:undefined,data:undefined};o.fromIso8601=function(r,i){if(!t(r)){throw new n(\"options is required.\")}if(!t(r.iso8601)){throw new n(\"options.iso8601 is required.\")}var u=r.iso8601.split(\"/\");var f=a.fromIso8601(u[0]);var c=a.fromIso8601(u[1]);var l=e(r.isStartIncluded,true);var d=e(r.isStopIncluded,true);var h=r.data;if(!t(i)){s.start=f;s.stop=c;s.isStartIncluded=l;s.isStopIncluded=d;s.data=h;return new o(s)}i.start=f;i.stop=c;i.isStartIncluded=l;i.isStopIncluded=d;i.data=h;return i};o.toIso8601=function(e,r){if(!t(e)){throw new n(\"timeInterval is required.\")}return a.toIso8601(e.start,r)+\"/\"+a.toIso8601(e.stop,r)};o.clone=function(e,r){if(!t(e)){return undefined}if(!t(r)){return new o(e)}r.start=e.start;r.stop=e.stop;r.isStartIncluded=e.isStartIncluded;r.isStopIncluded=e.isStopIncluded;r.data=e.data;return r};o.equals=function(e,r,n){return e===r||t(e)&&t(r)&&(e.isEmpty&&r.isEmpty||e.isStartIncluded===r.isStartIncluded&&e.isStopIncluded===r.isStopIncluded&&a.equals(e.start,r.start)&&a.equals(e.stop,r.stop)&&(e.data===r.data||t(n)&&n(e.data,r.data)))};o.equalsEpsilon=function(e,r,i,o){if(typeof i!==\"number\"){throw new n(\"epsilon is required and must be a number.\")}return e===r||t(e)&&t(r)&&(e.isEmpty&&r.isEmpty||e.isStartIncluded===r.isStartIncluded&&e.isStopIncluded===r.isStopIncluded&&a.equalsEpsilon(e.start,r.start,i)&&a.equalsEpsilon(e.stop,r.stop,i)&&(e.data===r.data||t(o)&&o(e.data,r.data)))};o.intersect=function(e,r,i,s){if(!t(e)){throw new n(\"left is required.\")}if(!t(i)){throw new n(\"result is required.\")}if(!t(r)){return o.clone(o.EMPTY,i)}var u=e.start;var f=e.stop;var c=r.start;var l=r.stop;var d=a.greaterThanOrEquals(c,u)&&a.greaterThanOrEquals(f,c);var h=!d&&a.lessThanOrEquals(c,u)&&a.lessThanOrEquals(u,l);if(!d&&!h){return o.clone(o.EMPTY,i)}var v=e.isStartIncluded;var p=e.isStopIncluded;var m=r.isStartIncluded;var w=r.isStopIncluded;var y=a.lessThan(f,l);i.start=d?c:u;i.isStartIncluded=v&&m||!a.equals(c,u)&&(d&&m||h&&v);i.stop=y?f:l;i.isStopIncluded=y?p:p&&w||!a.equals(l,f)&&w;i.data=t(s)?s(e.data,r.data):e.data;return i};o.contains=function(e,r){if(!t(e)){throw new n(\"timeInterval is required.\")}if(!t(r)){throw new n(\"julianDate is required.\")}if(e.isEmpty){return false}var i=a.compare(e.start,r);if(i===0){return e.isStartIncluded}var o=a.compare(r,e.stop);if(o===0){return e.isStopIncluded}return i<0&&o<0};o.prototype.clone=function(e){return o.clone(this,e)};o.prototype.equals=function(e,t){return o.equals(this,e,t)};o.prototype.equalsEpsilon=function(e,t,r){return o.equalsEpsilon(this,e,t,r)};o.prototype.toString=function(){return o.toIso8601(this)};o.EMPTY=i(new o({start:new a,stop:new a,isStartIncluded:false,isStopIncluded:false}));return o})})();(function(){var t=e.amdDefine;t(\"37\",[\"1f\",\"24\",\"39\"],function(e,t,r){\"use strict\";var n=e(t.fromIso8601(\"0000-01-01T00:00:00Z\"));var i=e(t.fromIso8601(\"9999-12-31T24:00:00Z\"));var a=e(new r({start:n,stop:i}));var o={MINIMUM_VALUE:n,MAXIMUM_VALUE:i,MAXIMUM_INTERVAL:a};return o})})();(function(){var t=e.amdDefine;t(\"36\",[\"23\",\"1a\",\"1b\",\"1c\",\"37\"],function(e,t,r,n,i){\"use strict\";function a(){n.throwInstantiationError()}r(a.prototype,{isConstant:{get:n.throwInstantiationError},definitionChanged:{get:n.throwInstantiationError}});a.prototype.getValue=n.throwInstantiationError;a.prototype.equals=n.throwInstantiationError;a.equals=function(e,r){return e===r||t(e)&&e.equals(r)};a.arrayEquals=function(e,r){if(e===r){return true}if(!t(e)||!t(r)||e.length!==r.length){return false}var n=e.length;for(var i=0;i<n;i++){if(!a.equals(e[i],r[i])){return false}}return true};a.isConstant=function(e){return!t(e)||e.isConstant};a.getValueOrUndefined=function(e,r,n){return t(e)?e.getValue(r,n):undefined};a.getValueOrDefault=function(r,n,i,a){return t(r)?e(r.getValue(n,a),i):i};a.getValueOrClonedDefault=function(e,r,n,i){var a;if(t(e)){a=e.getValue(r,i)}if(!t(a)){a=n.clone(a)}return a};return a})})();(function(){var t=e.amdDefine;t(\"48\",[\"2c\",\"23\",\"1a\",\"1b\",\"1c\",\"1d\",\"2d\",\"2e\",\"36\",\"49\"],function(e,t,r,n,i,a,o,s,u,f){\"use strict\";function c(r,n){n=t(n,0);var i;if(n>0){i=new Array(n);for(var s=0;s<n;s++){i[s]=e}}this._numberOfDerivatives=n;this._property=new f(e,i);this._definitionChanged=new a;this._referenceFrame=t(r,o.FIXED);this._property._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)}n(c.prototype,{isConstant:{get:function(){return this._property.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}},interpolationDegree:{get:function(){return this._property.interpolationDegree}},interpolationAlgorithm:{get:function(){return this._property.interpolationAlgorithm}},numberOfDerivatives:{get:function(){return this._numberOfDerivatives}},forwardExtrapolationType:{get:function(){return this._property.forwardExtrapolationType},set:function(e){this._property.forwardExtrapolationType=e}},forwardExtrapolationDuration:{get:function(){return this._property.forwardExtrapolationDuration},set:function(e){this._property.forwardExtrapolationDuration=e}},backwardExtrapolationType:{get:function(){return this._property.backwardExtrapolationType},set:function(e){this._property.backwardExtrapolationType=e}},backwardExtrapolationDuration:{get:function(){return this._property.backwardExtrapolationDuration},set:function(e){this._property.backwardExtrapolationDuration=e}}});c.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,o.FIXED,t)};c.prototype.getValueInReferenceFrame=function(e,t,n){if(!r(e)){throw new i(\"time is required.\")}if(!r(t)){throw new i(\"referenceFrame is required.\")}n=this._property.getValue(e,n);if(r(n)){return s.convertToReferenceFrame(e,n,this._referenceFrame,t,n)}return undefined};c.prototype.setInterpolationOptions=function(e){this._property.setInterpolationOptions(e)};c.prototype.addSample=function(e,t,n){var a=this._numberOfDerivatives;if(a>0&&(!r(n)||n.length!==a)){throw new i(\"derivatives length must be equal to the number of derivatives.\")}this._property.addSample(e,t,n)};c.prototype.addSamples=function(e,t,r){this._property.addSamples(e,t,r)};c.prototype.addSamplesPackedArray=function(e,t){this._property.addSamplesPackedArray(e,t)};c.prototype.equals=function(e){return this===e||e instanceof c&&u.equals(this._property,e._property)&&this._referenceFrame===e._referenceFrame};return c})})();(function(){var t=e.amdDefine;t(\"1d\",[\"1a\",\"1b\",\"1c\"],function(e,t,r){\"use strict\";function n(){this._listeners=[];this._scopes=[];this._toRemove=[];this._insideRaiseEvent=false}t(n.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}});n.prototype.addEventListener=function(e,t){if(typeof e!==\"function\"){throw new r(\"listener is required and must be a function.\")}this._listeners.push(e);this._scopes.push(t);var n=this;return function(){n.removeEventListener(e,t)}};n.prototype.removeEventListener=function(e,t){if(typeof e!==\"function\"){throw new r(\"listener is required and must be a function.\")}var n=this._listeners;var i=this._scopes;var a=-1;for(var o=0;o<n.length;o++){if(n[o]===e&&i[o]===t){a=o;break}}if(a!==-1){if(this._insideRaiseEvent){this._toRemove.push(a);n[a]=undefined;i[a]=undefined}else{n.splice(a,1);i.splice(a,1)}return true}return false};n.prototype.raiseEvent=function(){this._insideRaiseEvent=true;var t;var r=this._listeners;var n=this._scopes;var i=r.length;for(t=0;t<i;t++){var a=r[t];if(e(a)){r[t].apply(n[t],arguments)}}var o=this._toRemove;i=o.length;for(t=0;t<i;t++){var s=o[t];r.splice(s,1);n.splice(s,1)}o.length=0;this._insideRaiseEvent=false};return n})})();(function(){var t=e.amdDefine;t(\"4a\",[\"1f\"],function(e){\"use strict\";var t={NONE:0,HOLD:1,EXTRAPOLATE:2};return e(t)})})();(function(){var t=e.amdDefine;t(\"4b\",[\"1a\",\"1c\"],function(e,t){\"use strict\";var r={type:\"Linear\"};r.getRequiredDataPoints=function(e){return 2};r.interpolateOrderZero=function(r,n,i,a,o){if(n.length!==2){throw new t(\"The xTable provided to the linear interpolator must have exactly two elements.\")}else if(a<=0){throw new t(\"There must be at least 1 dependent variable for each independent variable.\")}if(!e(o)){o=new Array(a)}var s;var u;var f;var c=n[0];var l=n[1];if(c===l){throw new t(\"Divide by zero error: xTable[0] and xTable[1] are equal\")}for(s=0;s<a;s++){u=i[s];f=i[s+a];o[s]=((f-u)*r+l*u-c*f)/(l-c)}return o};return r})})();(function(){var t=e.amdDefine;t(\"49\",[\"4c\",\"23\",\"1a\",\"1b\",\"1c\",\"1d\",\"4a\",\"24\",\"4b\"],function(e,t,r,n,i,a,o,s,u){\"use strict\";var f={packedLength:1,pack:function(e,r,n){n=t(n,0);r[n]=e},unpack:function(e,r,n){r=t(r,0);return e[r]}};function c(e,t,r){var n;var i=e.length;var a=r.length;var o=i+a;e.length=o;if(i!==t){var s=i-1;for(n=o-1;n>=t;n--){e[n]=e[s--]}}for(n=0;n<a;n++){e[t++]=r[n]}}function l(e,t){if(e instanceof s){return e}if(typeof e===\"string\"){return s.fromIso8601(e)}return s.addSeconds(t,e,new s)}var d=[];var h=[];function v(t,n,i,a,o){var u=0;var f;var v;var p;var m;var w;var y;while(u<a.length){w=l(a[u],t);p=e(n,w,s.compare);var g=0;var S=0;if(p<0){p=~p;m=p*o;v=undefined;y=n[p];while(u<a.length){w=l(a[u],t);if(r(v)&&s.compare(v,w)>=0||r(y)&&s.compare(w,y)>=0){break}d[g++]=w;u=u+1;for(f=0;f<o;f++){h[S++]=a[u];u=u+1}v=w}if(g>0){h.length=S;c(i,m,h);d.length=g;c(n,p,d)}}else{for(f=0;f<o;f++){u++;i[p*o+f]=a[u]}u++}}}function p(e,n){if(!r(e)){throw new i(\"type is required.\")}var s=e;if(s===Number){s=f}var c=s.packedLength;var l=t(s.packedInterpolationLength,c);var d=0;var h;if(r(n)){var v=n.length;h=new Array(v);for(var p=0;p<v;p++){var m=n[p];if(m===Number){m=f}var w=m.packedLength;c+=w;l+=t(m.packedInterpolationLength,w);h[p]=m}d=v}this._type=e;this._innerType=s;this._interpolationDegree=1;this._interpolationAlgorithm=u;this._numberOfPoints=0;this._times=[];this._values=[];this._xTable=[];this._yTable=[];this._packedLength=c;this._packedInterpolationLength=l;this._updateTableLength=true;this._interpolationResult=new Array(l);this._definitionChanged=new a;this._derivativeTypes=n;this._innerDerivativeTypes=h;this._inputOrder=d;this._forwardExtrapolationType=o.NONE;this._forwardExtrapolationDuration=0;this._backwardExtrapolationType=o.NONE;this._backwardExtrapolationDuration=0}n(p.prototype,{isConstant:{get:function(){return this._values.length===0}},definitionChanged:{get:function(){return this._definitionChanged}},type:{get:function(){return this._type}},derivativeTypes:{get:function(){return this._derivativeTypes}},interpolationDegree:{get:function(){return this._interpolationDegree}},interpolationAlgorithm:{get:function(){return this._interpolationAlgorithm}},forwardExtrapolationType:{get:function(){return this._forwardExtrapolationType},set:function(e){if(this._forwardExtrapolationType!==e){this._forwardExtrapolationType=e;this._definitionChanged.raiseEvent(this)}}},forwardExtrapolationDuration:{get:function(){return this._forwardExtrapolationDuration},set:function(e){if(this._forwardExtrapolationDuration!==e){this._forwardExtrapolationDuration=e;this._definitionChanged.raiseEvent(this)}}},backwardExtrapolationType:{get:function(){return this._backwardExtrapolationType},set:function(e){if(this._backwardExtrapolationType!==e){this._backwardExtrapolationType=e;this._definitionChanged.raiseEvent(this)}}},backwardExtrapolationDuration:{get:function(){return this._backwardExtrapolationDuration},set:function(e){if(this._backwardExtrapolationDuration!==e){this._backwardExtrapolationDuration=e;this._definitionChanged.raiseEvent(this)}}}});p.prototype.getValue=function(t,n){if(!r(t)){throw new i(\"time is required.\")}var a=this._times;var u=a.length;if(u===0){return undefined}var f;var c=this._innerType;var l=this._values;var d=e(a,t,s.compare);if(d<0){d=~d;if(d===0){var h=a[d];f=this._backwardExtrapolationDuration;if(this._backwardExtrapolationType===o.NONE||f!==0&&s.secondsDifference(h,t)>f){return undefined}if(this._backwardExtrapolationType===o.HOLD){return c.unpack(l,0,n)}}if(d>=u){d=u-1;var v=a[d];f=this._forwardExtrapolationDuration;if(this._forwardExtrapolationType===o.NONE||f!==0&&s.secondsDifference(t,v)>f){return undefined}if(this._forwardExtrapolationType===o.HOLD){d=u-1;return c.unpack(l,d*c.packedLength,n)}}var p=this._xTable;var m=this._yTable;var w=this._interpolationAlgorithm;var y=this._packedInterpolationLength;var g=this._inputOrder;if(this._updateTableLength){this._updateTableLength=false;var S=Math.min(w.getRequiredDataPoints(this._interpolationDegree,g),u);if(S!==this._numberOfPoints){this._numberOfPoints=S;p.length=S;m.length=S*y}}var b=this._numberOfPoints-1;if(b<1){return undefined}var T=0;var _=u-1;var E=_-T+1;if(E>=b+1){var M=d-(b/2|0)-1;if(M<T){M=T}var P=M+b;if(P>_){P=_;M=P-b;if(M<T){M=T}}T=M;_=P}var A=_-T+1;for(var C=0;C<A;++C){p[C]=s.secondsDifference(a[T+C],a[_])}if(!r(c.convertPackedArrayForInterpolation)){var I=0;var x=this._packedLength;var R=T*x;var O=(_+1)*x;while(R<O){m[I]=l[R];R++;I++}}else{c.convertPackedArrayForInterpolation(l,T,_,m)}var D=s.secondsDifference(t,a[_]);var q;if(g===0||!r(w.interpolate)){q=w.interpolateOrderZero(D,p,m,y,this._interpolationResult)}else{var N=Math.floor(y/(g+1));q=w.interpolate(D,p,m,N,g,g,this._interpolationResult)}if(!r(c.unpackInterpolationResult)){return c.unpack(q,0,n)}return c.unpackInterpolationResult(q,l,T,_,n)}return c.unpack(l,d*this._packedLength,n)};p.prototype.setInterpolationOptions=function(e){if(!r(e)){throw new i(\"options is required.\")}var t=false;var n=e.interpolationAlgorithm;var a=e.interpolationDegree;if(this._interpolationAlgorithm!==n){this._interpolationAlgorithm=n;t=true}if(this._interpolationDegree!==a){this._interpolationDegree=a;t=true}if(t){this._updateTableLength=true;this._definitionChanged.raiseEvent(this)}};p.prototype.addSample=function(e,t,n){var a=this._innerDerivativeTypes;var o=r(a);if(!r(e)){throw new i(\"time is required.\")}if(!r(t)){throw new i(\"value is required.\")}if(o&&!r(n)){throw new i(\"derivatives is required.\")}var s=this._innerType;var u=[];u.push(e);s.pack(t,u,u.length);if(o){var f=a.length;for(var c=0;c<f;c++){a[c].pack(n[c],u,u.length)}}v(undefined,this._times,this._values,u,this._packedLength);this._updateTableLength=true;this._definitionChanged.raiseEvent(this)};p.prototype.addSamples=function(e,t,n){var a=this._innerDerivativeTypes;var o=r(a);if(!r(e)){throw new i(\"times is required.\")}if(!r(t)){throw new i(\"values is required.\")}if(e.length!==t.length){throw new i(\"times and values must be the same length.\")}if(o&&(!r(n)||n.length!==e.length)){throw new i(\"times and derivativeValues must be the same length.\")}var s=this._innerType;var u=e.length;var f=[];for(var c=0;c<u;c++){f.push(e[c]);s.pack(t[c],f,f.length);if(o){var l=n[c];var d=a.length;for(var h=0;h<d;h++){a[h].pack(l[h],f,f.length)}}}v(undefined,this._times,this._values,f,this._packedLength);this._updateTableLength=true;this._definitionChanged.raiseEvent(this)};p.prototype.addSamplesPackedArray=function(e,t){if(!r(e)){throw new i(\"packedSamples is required.\")}v(t,this._times,this._values,e,this._packedLength);this._updateTableLength=true;this._definitionChanged.raiseEvent(this)};p.prototype.equals=function(e){if(this===e){return true}if(!r(e)){return false}if(this._type!==e._type||this._interpolationDegree!==e._interpolationDegree||this._interpolationAlgorithm!==e._interpolationAlgorithm){return false}var t=this._derivativeTypes;var n=r(t);var i=e._derivativeTypes;var a=r(i);if(n!==a){return false}var o;var u;if(n){u=t.length;if(u!==i.length){return false}for(o=0;o<u;o++){if(t[o]!==i[o]){return false}}}var f=this._times;var c=e._times;u=f.length;if(u!==c.length){return false}for(o=0;o<u;o++){if(!s.equals(f[o],c[o])){return false}}var l=this._values;var d=e._values;for(o=0;o<u;o++){if(l[o]!==d[o]){return false}}return true};p._mergeNewSamples=v;return p})})();(function(){var t=e.amdDefine;t(\"45\",[\"23\",\"1a\",\"1c\",\"1f\",\"27\"],function(e,t,r,n,i){\"use strict\";function a(t,r){this.x=e(t,0);this.y=e(r,0)}a.fromElements=function(e,r,n){if(!t(n)){return new a(e,r)}n.x=e;n.y=r;return n};a.clone=function(e,r){if(!t(e)){return undefined}if(!t(r)){return new a(e.x,e.y)}r.x=e.x;r.y=e.y;return r};a.fromCartesian3=a.clone;a.fromCartesian4=a.clone;a.packedLength=2;a.pack=function(n,i,a){if(!t(n)){throw new r(\"value is required\")}if(!t(i)){throw new r(\"array is required\")}a=e(a,0);i[a++]=n.x;i[a]=n.y};a.unpack=function(n,i,o){if(!t(n)){throw new r(\"array is required\")}i=e(i,0);if(!t(o)){o=new a}o.x=n[i++];o.y=n[i];return o};a.packArray=function(e,n){if(!t(e)){throw new r(\"array is required\")}var i=e.length;if(!t(n)){n=new Array(i*2)}else{n.length=i*2}for(var o=0;o<i;++o){a.pack(e[o],n,o*2)}return n};a.unpackArray=function(e,n){if(!t(e)){throw new r(\"array is required\")}var i=e.length;if(!t(n)){n=new Array(i/2)}else{n.length=i/2}for(var o=0;o<i;o+=2){var s=o/2;n[s]=a.unpack(e,o,n[s])}return n};a.fromArray=a.unpack;a.maximumComponent=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return Math.max(e.x,e.y)};a.minimumComponent=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return Math.min(e.x,e.y)};a.minimumByComponent=function(e,n,i){if(!t(e)){throw new r(\"first is required.\")}if(!t(n)){throw new r(\"second is required.\")}if(!t(i)){throw new r(\"result is required.\")}i.x=Math.min(e.x,n.x);i.y=Math.min(e.y,n.y);return i};a.maximumByComponent=function(e,n,i){if(!t(e)){throw new r(\"first is required.\")}if(!t(n)){throw new r(\"second is required.\")}if(!t(i)){throw new r(\"result is required.\")}i.x=Math.max(e.x,n.x);i.y=Math.max(e.y,n.y);return i};a.magnitudeSquared=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return e.x*e.x+e.y*e.y};a.magnitude=function(e){return Math.sqrt(a.magnitudeSquared(e))};var o=new a;a.distance=function(e,n){if(!t(e)||!t(n)){throw new r(\"left and right are required.\")}a.subtract(e,n,o);return a.magnitude(o)};a.distanceSquared=function(e,n){if(!t(e)||!t(n)){throw new r(\"left and right are required.\")}a.subtract(e,n,o);return a.magnitudeSquared(o)};a.normalize=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}var i=a.magnitude(e);n.x=e.x/i;n.y=e.y/i;return n};a.dot=function(e,n){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}return e.x*n.x+e.y*n.y};a.multiplyComponents=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x*n.x;i.y=e.y*n.y;return i};a.add=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\");\n}i.x=e.x+n.x;i.y=e.y+n.y;return i};a.subtract=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x-n.x;i.y=e.y-n.y;return i};a.multiplyByScalar=function(e,n,i){if(!t(e)){throw new r(\"cartesian is required\")}if(typeof n!==\"number\"){throw new r(\"scalar is required and must be a number.\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x*n;i.y=e.y*n;return i};a.divideByScalar=function(e,n,i){if(!t(e)){throw new r(\"cartesian is required\")}if(typeof n!==\"number\"){throw new r(\"scalar is required and must be a number.\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x/n;i.y=e.y/n;return i};a.negate=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}n.x=-e.x;n.y=-e.y;return n};a.abs=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}n.x=Math.abs(e.x);n.y=Math.abs(e.y);return n};var s=new a;a.lerp=function(e,n,i,o){if(!t(e)){throw new r(\"start is required.\")}if(!t(n)){throw new r(\"end is required.\")}if(typeof i!==\"number\"){throw new r(\"t is required and must be a number.\")}if(!t(o)){throw new r(\"result is required.\")}a.multiplyByScalar(n,i,s);o=a.multiplyByScalar(e,1-i,o);return a.add(s,o,o)};var u=new a;var f=new a;a.angleBetween=function(e,n){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}a.normalize(e,u);a.normalize(n,f);return i.acosClamped(a.dot(u,f))};var c=new a;a.mostOrthogonalAxis=function(e,n){if(!t(e)){throw new r(\"cartesian is required.\")}if(!t(n)){throw new r(\"result is required.\")}var i=a.normalize(e,c);a.abs(i,i);if(i.x<=i.y){n=a.clone(a.UNIT_X,n)}else{n=a.clone(a.UNIT_Y,n)}return n};a.equals=function(e,r){return e===r||t(e)&&t(r)&&e.x===r.x&&e.y===r.y};a.equalsArray=function(e,t,r){return e.x===t[r]&&e.y===t[r+1]};a.equalsEpsilon=function(e,r,n,a){return e===r||t(e)&&t(r)&&i.equalsEpsilon(e.x,r.x,n,a)&&i.equalsEpsilon(e.y,r.y,n,a)};a.ZERO=n(new a(0,0));a.UNIT_X=n(new a(1,0));a.UNIT_Y=n(new a(0,1));a.prototype.clone=function(e){return a.clone(this,e)};a.prototype.equals=function(e){return a.equals(this,e)};a.prototype.equalsEpsilon=function(e,t,r){return a.equalsEpsilon(this,e,t,r)};a.prototype.toString=function(){return\"(\"+this.x+\", \"+this.y+\")\"};return a})})();(function(){var t=e.amdDefine;t(\"4d\",[\"4e\",\"4c\",\"23\",\"1a\",\"4f\",\"1f\",\"24\",\"50\",\"51\",\"38\",\"52\",\"53\"],function(e,t,r,n,i,a,o,s,u,f,c,l){\"use strict\";function d(t){t=r(t,r.EMPTY_OBJECT);this._dates=undefined;this._samples=undefined;this._dateColumn=-1;this._xPoleWanderRadiansColumn=-1;this._yPoleWanderRadiansColumn=-1;this._ut1MinusUtcSecondsColumn=-1;this._xCelestialPoleOffsetRadiansColumn=-1;this._yCelestialPoleOffsetRadiansColumn=-1;this._taiMinusUtcSecondsColumn=-1;this._columnCount=0;this._lastIndex=-1;this._downloadPromise=undefined;this._dataError=undefined;this._addNewLeapSeconds=r(t.addNewLeapSeconds,true);if(n(t.data)){v(this,t.data)}else if(n(t.url)){var i=this;this._downloadPromise=e(u(t.url),function(e){v(i,e)},function(){i._dataError=\"An error occurred while retrieving the EOP data from the URL \"+t.url+\".\"})}else{v(this,{columnNames:[\"dateIso8601\",\"modifiedJulianDateUtc\",\"xPoleWanderRadians\",\"yPoleWanderRadians\",\"ut1MinusUtcSeconds\",\"lengthOfDayCorrectionSeconds\",\"xCelestialPoleOffsetRadians\",\"yCelestialPoleOffsetRadians\",\"taiMinusUtcSeconds\"],samples:[]})}}d.NONE=a({getPromiseToLoad:function(){return e()},compute:function(e,t){if(!n(t)){t=new i(0,0,0,0,0)}else{t.xPoleWander=0;t.yPoleWander=0;t.xPoleOffset=0;t.yPoleOffset=0;t.ut1MinusUtc=0}return t}});d.prototype.getPromiseToLoad=function(){return e(this._downloadPromise)};d.prototype.compute=function(e,r){if(!n(this._samples)){if(n(this._dataError)){throw new f(this._dataError)}return undefined}if(!n(r)){r=new i(0,0,0,0,0)}if(this._samples.length===0){r.xPoleWander=0;r.yPoleWander=0;r.xPoleOffset=0;r.yPoleOffset=0;r.ut1MinusUtc=0;return r}var a=this._dates;var s=this._lastIndex;var u=0;var c=0;if(n(s)){var l=a[s];var d=a[s+1];var h=o.lessThanOrEquals(l,e);var v=!n(d);var p=v||o.greaterThanOrEquals(d,e);if(h&&p){u=s;if(!v&&d.equals(e)){++u}c=u+1;w(this,a,this._samples,e,u,c,r);return r}}var m=t(a,e,o.compare,this._dateColumn);if(m>=0){if(m<a.length-1&&a[m+1].equals(e)){++m}u=m;c=m}else{c=~m;u=c-1;if(u<0){u=0}}this._lastIndex=u;w(this,a,this._samples,e,u,c,r);return r};function h(e,t){return o.compare(e.julianDate,t)}function v(e,r){if(!n(r.columnNames)){e._dataError=\"Error in loaded EOP data: The columnNames property is required.\";return}if(!n(r.samples)){e._dataError=\"Error in loaded EOP data: The samples property is required.\";return}var i=r.columnNames.indexOf(\"modifiedJulianDateUtc\");var a=r.columnNames.indexOf(\"xPoleWanderRadians\");var u=r.columnNames.indexOf(\"yPoleWanderRadians\");var f=r.columnNames.indexOf(\"ut1MinusUtcSeconds\");var d=r.columnNames.indexOf(\"xCelestialPoleOffsetRadians\");var v=r.columnNames.indexOf(\"yCelestialPoleOffsetRadians\");var p=r.columnNames.indexOf(\"taiMinusUtcSeconds\");if(i<0||a<0||u<0||f<0||d<0||v<0||p<0){e._dataError=\"Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns\";return}var m=e._samples=r.samples;var w=e._dates=[];e._dateColumn=i;e._xPoleWanderRadiansColumn=a;e._yPoleWanderRadiansColumn=u;e._ut1MinusUtcSecondsColumn=f;e._xCelestialPoleOffsetRadiansColumn=d;e._yCelestialPoleOffsetRadiansColumn=v;e._taiMinusUtcSecondsColumn=p;e._columnCount=r.columnNames.length;e._lastIndex=undefined;var y;var g=e._addNewLeapSeconds;for(var S=0,b=m.length;S<b;S+=e._columnCount){var T=m[S+i];var _=m[S+p];var E=T+c.MODIFIED_JULIAN_DATE_DIFFERENCE;var M=new o(E,_,l.TAI);w.push(M);if(g){if(_!==y&&n(y)){var P=o.leapSeconds;var A=t(P,M,h);if(A<0){var C=new s(M,_);P.splice(~A,0,C)}}y=_}}}function p(e,t,r,n,i){var a=r*n;i.xPoleWander=t[a+e._xPoleWanderRadiansColumn];i.yPoleWander=t[a+e._yPoleWanderRadiansColumn];i.xPoleOffset=t[a+e._xCelestialPoleOffsetRadiansColumn];i.yPoleOffset=t[a+e._yCelestialPoleOffsetRadiansColumn];i.ut1MinusUtc=t[a+e._ut1MinusUtcSecondsColumn]}function m(e,t,r){return t+e*(r-t)}function w(e,t,r,n,i,a,s){var u=e._columnCount;if(a>t.length-1){s.xPoleWander=0;s.yPoleWander=0;s.xPoleOffset=0;s.yPoleOffset=0;s.ut1MinusUtc=0;return s}var f=t[i];var c=t[a];if(f.equals(c)||n.equals(f)){p(e,r,i,u,s);return s}else if(n.equals(c)){p(e,r,a,u,s);return s}var l=o.secondsDifference(n,f)/o.secondsDifference(c,f);var d=i*u;var h=a*u;var v=r[d+e._ut1MinusUtcSecondsColumn];var w=r[h+e._ut1MinusUtcSecondsColumn];var y=w-v;if(y>.5||y<-.5){var g=r[d+e._taiMinusUtcSecondsColumn];var S=r[h+e._taiMinusUtcSecondsColumn];if(g!==S){if(c.equals(n)){v=w}else{w-=S-g}}}s.xPoleWander=m(l,r[d+e._xPoleWanderRadiansColumn],r[h+e._xPoleWanderRadiansColumn]);s.yPoleWander=m(l,r[d+e._yPoleWanderRadiansColumn],r[h+e._yPoleWanderRadiansColumn]);s.xPoleOffset=m(l,r[d+e._xCelestialPoleOffsetRadiansColumn],r[h+e._xCelestialPoleOffsetRadiansColumn]);s.yPoleOffset=m(l,r[d+e._yCelestialPoleOffsetRadiansColumn],r[h+e._yCelestialPoleOffsetRadiansColumn]);s.ut1MinusUtc=m(l,v,w);return s}return d})})();(function(){var t=e.amdDefine;t(\"4f\",[],function(){\"use strict\";function e(e,t,r,n,i){this.xPoleWander=e;this.yPoleWander=t;this.xPoleOffset=r;this.yPoleOffset=n;this.ut1MinusUtc=i}return e})})();(function(){var t=e.amdDefine;t(\"54\",[\"55\",\"23\",\"1a\",\"1c\"],function(e,t,r,n){\"use strict\";function i(i,a){if(!r(i)){throw new n(\"relative uri is required.\")}a=t(a,document.location.href);var o=new e(a);var s=new e(i);return s.resolve(o).toString()}return i})})();(function(){var t=e.amdDefine;t(\"55\",[],function(){function e(r){if(r instanceof e){this.scheme=r.scheme;this.authority=r.authority;this.path=r.path;this.query=r.query;this.fragment=r.fragment}else if(r){var n=t.exec(r);this.scheme=n[1];this.authority=n[2];this.path=n[3];this.query=n[4];this.fragment=n[5]}}e.prototype.scheme=null;e.prototype.authority=null;e.prototype.path=\"\";e.prototype.query=null;e.prototype.fragment=null;var t=new RegExp(\"^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\\\?([^#]*))?(?:#(.*))?$\");e.prototype.getScheme=function(){return this.scheme};e.prototype.getAuthority=function(){return this.authority};e.prototype.getPath=function(){return this.path};e.prototype.getQuery=function(){return this.query};e.prototype.getFragment=function(){return this.fragment};e.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment};e.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query};e.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment};e.prototype.normalize=function(){this.removeDotSegments();if(this.scheme)this.scheme=this.scheme.toLowerCase();if(this.authority)this.authority=this.authority.replace(i,o).replace(r,a);if(this.path)this.path=this.path.replace(r,a);if(this.query)this.query=this.query.replace(r,a);if(this.fragment)this.fragment=this.fragment.replace(r,a)};var r=/%[0-9a-z]{2}/gi;var n=/[a-zA-Z0-9\\-\\._~]/;var i=/(.*@)?([^@:]*)(:.*)?/;function a(e){var t=unescape(e);return n.test(t)?t:e.toUpperCase()}function o(e,t,r,n){return(t||\"\")+r.toLowerCase()+(n||\"\")}e.prototype.resolve=function(t){var r=new e;if(this.scheme){r.scheme=this.scheme;r.authority=this.authority;r.path=this.path;r.query=this.query}else{r.scheme=t.scheme;if(this.authority){r.authority=this.authority;r.path=this.path;r.query=this.query}else{r.authority=t.authority;if(this.path==\"\"){r.path=t.path;r.query=this.query||t.query}else{if(this.path.charAt(0)==\"/\"){r.path=this.path;r.removeDotSegments()}else{if(t.authority&&t.path==\"\"){r.path=\"/\"+this.path}else{r.path=t.path.substring(0,t.path.lastIndexOf(\"/\")+1)+this.path}r.removeDotSegments()}r.query=this.query}}}r.fragment=this.fragment;return r};e.prototype.removeDotSegments=function(){var e=this.path.split(\"/\"),t=[],r,n=e[0]==\"\";if(n)e.shift();var i=e[0]==\"\"?e.shift():null;while(e.length){r=e.shift();if(r==\"..\"){t.pop()}else if(r!=\".\"){t.push(r)}}if(r==\".\"||r==\"..\")t.push(\"\");if(n)t.unshift(\"\");this.path=t.join(\"/\")};e.prototype.toString=function(){var e=\"\";if(this.scheme)e+=this.scheme+\":\";if(this.authority)e+=\"//\"+this.authority;e+=this.path;if(this.query)e+=\"?\"+this.query;if(this.fragment)e+=\"#\"+this.fragment;return e};return e})})();(function(){var t=e.amdDefine;t(\"56\",[\"55\",\"23\",\"1a\",\"1c\"],function(e,t,r,n){\"use strict\";function i(i,a,o){if(!r(i)){throw new n(\"first is required\")}if(!r(a)){throw new n(\"second is required\")}o=t(o,true);if(!(i instanceof e)){i=new e(i)}if(!(a instanceof e)){a=new e(a)}if(r(a.authority)&&!r(a.scheme)){if(typeof document!==\"undefined\"&&r(document.location)&&r(document.location.href)){a.scheme=new e(document.location.href).scheme}else{a.scheme=i.scheme}}var s=i;if(a.isAbsolute()){s=a}var u=\"\";if(r(s.scheme)){u+=s.scheme+\":\"}if(r(s.authority)){u+=\"//\"+s.authority;if(s.path!==\"\"&&s.path!==\"/\"){u=u.replace(/\\/?$/,\"/\");s.path=s.path.replace(/^\\/?/g,\"\")}}if(s===i){if(o){u+=i.path.replace(/\\/?$/,\"/\")+a.path.replace(/^\\/?/g,\"\")}else{u+=i.path+a.path}}else{u+=a.path}var f=r(i.query);var c=r(a.query);if(f&&c){u+=\"?\"+i.query+\"&\"+a.query}else if(f&&!c){u+=\"?\"+i.query}else if(!f&&c){u+=\"?\"+a.query}var l=r(a.fragment);if(r(i.fragment)&&!l){u+=\"#\"+i.fragment}else if(l){u+=\"#\"+a.fragment}return u}return i})})();(function(){var t=e.amdDefine;t(\"57\",[\"55\",\"1a\",\"1c\",\"54\",\"56\",\"require\"],function(e,t,r,n,i,a){\"use strict\";var o=/((?:.*\\/)|^)cesium[\\w-]*\\.js(?:\\W|$)/i;function s(){var e=document.getElementsByTagName(\"script\");for(var t=0,r=e.length;t<r;++t){var n=e[t].getAttribute(\"src\");var i=o.exec(n);if(i!==null){return i[1]}}return undefined}var u;function f(){if(t(u)){return u}var i;if(typeof CESIUM_BASE_URL!==\"undefined\"){i=CESIUM_BASE_URL}else{i=s()}if(!t(i)){throw new r(\"Unable to determine Cesium base URL automatically, try defining a global variable called CESIUM_BASE_URL.\")}u=new e(n(i));return u}function c(e){return a.toUrl(\"../\"+e)}function l(e){return i(f(),e)}var d;var h;function v(e){if(!t(d)){if(t(a.toUrl)){d=c}else{d=l}}if(!t(h)){h=document.createElement(\"a\")}var r=d(e);h.href=r;h.href=h.href;return h.href}v._cesiumScriptRegex=o;v.setBaseUrl=function(t){u=new e(t).resolve(new e(document.location.href))};return v})})();(function(){var t=e.amdDefine;t(\"58\",[\"23\"],function(e){\"use strict\";function t(r,n){if(r===null||typeof r!==\"object\"){return r}n=e(n,false);var i=new r.constructor;for(var a in r){if(r.hasOwnProperty(a)){var o=r[a];if(n){o=t(o,n)}i[a]=o}}return i}return t})})();(function(){var t=e.amdDefine;(function(e){\"use strict\";e(\"4e\",[],function(){var e,t,r;n.defer=f;n.resolve=i;n.reject=a;n.join=v;n.all=h;n.map=p;n.reduce=m;n.any=d;n.some=l;n.chain=w;n.isPromise=c;function n(e,t,r,n){return i(e).then(t,r,n)}function i(e){var t,r;if(e instanceof o){t=e}else{if(c(e)){r=f();e.then(function(e){r.resolve(e)},function(e){r.reject(e)},function(e){r.progress(e)});t=r.promise}else{t=s(e)}}return t}function a(e){return n(e,u)}function o(e){this.then=e}o.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(r,e)},yield:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return h(t,function(t){return e.apply(r,t)})})}};function s(e){var t=new o(function(t){try{return i(t?t(e):e)}catch(e){return u(e)}});return t}function u(e){var t=new o(function(t,r){try{return r?i(r(e)):u(e)}catch(e){return u(e)}});return t}function f(){var e,t,n,a,s,c,l;t=new o(d);e={then:d,resolve:h,reject:v,progress:p,promise:t,resolver:{resolve:h,reject:v,progress:p}};n=[];a=[];s=function(e,t,r){var i,o;i=f();o=typeof r===\"function\"?function(e){try{i.progress(r(e))}catch(e){i.progress(e)}}:function(e){i.progress(e)};n.push(function(r){r.then(e,t).then(i.resolve,i.reject,o)});a.push(o);return i.promise};c=function(e){y(a,e);return e};l=function(e){e=i(e);s=e.then;l=i;c=S;y(n,e);a=n=r;return e};return e;function d(e,t,r){return s(e,t,r)}function h(e){return l(e)}function v(e){return l(u(e))}function p(e){return c(e)}}function c(e){return e&&typeof e.then===\"function\"}function l(e,t,r,i,a){g(2,arguments);return n(e,function(e){var o,s,u,c,l,d,h,v,p,m;p=e.length>>>0;o=Math.max(0,Math.min(t,p));u=[];s=p-o+1;c=[];l=f();if(!o){l.resolve(u)}else{v=l.progress;h=function(e){c.push(e);if(!--s){d=h=S;l.reject(c)}};d=function(e){u.push(e);if(!--o){d=h=S;l.resolve(u)}};for(m=0;m<p;++m){if(m in e){n(e[m],y,w,v)}}}return l.then(r,i,a);function w(e){h(e)}function y(e){d(e)}})}function d(e,t,r,n){function i(e){return t?t(e[0]):e[0]}return l(e,1,i,r,n)}function h(e,t,r,n){g(1,arguments);return p(e,b).then(t,r,n)}function v(){return p(arguments,b)}function p(e,t){return n(e,function(e){var r,i,a,o,s,u;a=i=e.length>>>0;r=[];u=f();if(!a){u.resolve(r)}else{o=function e(i,o){n(i,t).then(function(e){r[o]=e;if(!--a){u.resolve(r)}},u.reject)};for(s=0;s<i;s++){if(s in e){o(e[s],s)}else{--a}}}return u.promise})}function m(r,i){var a=t.call(arguments,1);return n(r,function(t){var r;r=t.length;a[0]=function(e,t,a){return n(e,function(e){return n(t,function(t){return i(e,t,a,r)})})};return e.apply(t,a)})}function w(e,t,r){var i=arguments.length>2;return n(e,function(e){e=i?r:e;t.resolve(e);return e},function(e){t.reject(e);return u(e)},t.progress)}function y(e,t){var r,n=0;while(r=e[n++]){r(t)}}function g(e,t){var r,n=t.length;while(n>e){r=t[--n];if(r!=null&&typeof r!=\"function\"){throw new Error(\"arg \"+n+\" must be a function\")}}}function S(){}t=[].slice;e=[].reduce||function(e){var t,r,n,i,a;a=0;t=Object(this);i=t.length>>>0;r=arguments;if(r.length<=1){for(;;){if(a in t){n=t[a++];break}if(++a>=i){throw new TypeError}}}else{n=r[1]}for(;a<i;++a){if(a in t){n=e(n,t[a],a,t)}}return n};function b(e){return e}return n})})(typeof t==\"function\"&&t.amd?t:function(e){typeof r===\"object\"?n.exports=e():this.when=e()})})();(function(){var t=e.amdDefine;t(\"59\",[],function(){\"use strict\";function e(e){var t={};if(!e){return t}var r=e.split(\"\\r\\n\");for(var n=0;n<r.length;++n){var i=r[n];var a=i.indexOf(\": \");if(a>0){var o=i.substring(0,a);var s=i.substring(a+2);t[o]=s}}return t}return e})})();(function(){var t=e.amdDefine;t(\"5a\",[\"1a\",\"59\"],function(e,t){\"use strict\";function r(e,r,n){this.statusCode=e;this.response=r;this.responseHeaders=n;if(typeof this.responseHeaders===\"string\"){this.responseHeaders=t(this.responseHeaders)}}r.prototype.toString=function(){var t=\"Request has failed.\";if(e(this.statusCode)){t+=\" Status Code: \"+this.statusCode}return t};return r})})();(function(){var t=e.amdDefine;t(\"5b\",[\"4e\",\"23\",\"1a\",\"1c\",\"5a\",\"38\"],function(e,t,r,n,i,a){\"use strict\";function o(i){i=t(i,t.EMPTY_OBJECT);if(!r(i.url)){throw new n(\"options.url is required.\")}var a=i.responseType;var s=t(i.method,\"GET\");var u=i.data;var f=i.headers;var c=i.overrideMimeType;return e(i.url,function(t){var r=e.defer();o.load(t,a,s,u,f,r,c);return r.promise})}var s=/^data:(.*?)(;base64)?,(.*)$/;function u(e,t){var r=decodeURIComponent(t);if(e){return atob(r)}return r}function f(e,t){var r=u(e,t);var n=new ArrayBuffer(r.length);var i=new Uint8Array(n);for(var a=0;a<r.length;a++){i[a]=r.charCodeAt(a)}return n}function c(e,r){r=t(r,\"\");var i=e[1];var a=!!e[2];var o=e[3];switch(r){case\"\":case\"text\":return u(a,o);case\"arraybuffer\":return f(a,o);case\"blob\":var s=f(a,o);return new Blob([s],{type:i});case\"document\":var c=new DOMParser;return c.parseFromString(u(a,o),i);case\"json\":return JSON.parse(u(a,o));default:throw new n(\"Unhandled responseType: \"+r)}}o.load=function(e,t,n,o,u,f,l){var d=s.exec(e);if(d!==null){f.resolve(c(d,t));return}var h=new XMLHttpRequest;if(r(l)&&r(h.overrideMimeType)){h.overrideMimeType(l)}h.open(n,e,true);if(r(u)){for(var v in u){if(u.hasOwnProperty(v)){h.setRequestHeader(v,u[v])}}}if(r(t)){h.responseType=t}h.onload=function(){if(h.status>=200&&h.status<300){if(r(h.response)){f.resolve(h.response)}else{if(r(h.responseXML)&&h.responseXML.hasChildNodes()){f.resolve(h.responseXML)}else if(r(h.responseText)){f.resolve(h.responseText)}else{f.reject(new a(\"unknown XMLHttpRequest response type.\"))}}}else{f.reject(new i(h.status,h.response,h.getAllResponseHeaders()))}};h.onerror=function(e){f.reject(new i)};h.send(o)};o.defaultLoad=o.load;return o})})();(function(){var t=e.amdDefine;t(\"5c\",[\"5b\"],function(e){\"use strict\";function t(t,r){return e({url:t,headers:r})}return t})})();(function(){var t=e.amdDefine;t(\"51\",[\"58\",\"1a\",\"1c\",\"5c\"],function(e,t,r,n){\"use strict\";var i={Accept:\"application/json,*/*;q=0.01\"};function a(a,o){if(!t(a)){throw new r(\"url is required.\")}if(!t(o)){o=i}else if(!t(o.Accept)){o=e(o);o.Accept=i.Accept}return n(a,o).then(function(e){return JSON.parse(e)})}return a})})();(function(){var t=e.amdDefine;t(\"5d\",[\"4e\",\"57\",\"23\",\"1a\",\"5e\",\"24\",\"51\",\"53\"],function(e,t,r,n,i,a,o,s){\"use strict\";function u(e){e=r(e,r.EMPTY_OBJECT);this._xysFileUrlTemplate=e.xysFileUrlTemplate;this._interpolationOrder=r(e.interpolationOrder,9);this._sampleZeroJulianEphemerisDate=r(e.sampleZeroJulianEphemerisDate,2442396.5);this._sampleZeroDateTT=new a(this._sampleZeroJulianEphemerisDate,0,s.TAI);this._stepSizeDays=r(e.stepSizeDays,1);this._samplesPerXysFile=r(e.samplesPerXysFile,1e3);this._totalSamples=r(e.totalSamples,27426);this._samples=new Array(this._totalSamples*3);this._chunkDownloadsInProgress=[];var t=this._interpolationOrder;var n=this._denominators=new Array(t+1);var i=this._xTable=new Array(t+1);var o=Math.pow(this._stepSizeDays,t);for(var u=0;u<=t;++u){n[u]=o;i[u]=u*this._stepSizeDays;for(var f=0;f<=t;++f){if(f!==u){n[u]*=u-f}}n[u]=1/n[u]}this._work=new Array(t+1);this._coef=new Array(t+1)}var f=new a(0,0,s.TAI);function c(e,t,r){var n=f;n.dayNumber=t;n.secondsOfDay=r;return a.daysDifference(n,e._sampleZeroDateTT)}u.prototype.preload=function(t,r,n,i){var a=c(this,t,r);var o=c(this,n,i);var s=a/this._stepSizeDays-this._interpolationOrder/2|0;if(s<0){s=0}var u=o/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;if(u>=this._totalSamples){u=this._totalSamples-1}var f=s/this._samplesPerXysFile|0;var d=u/this._samplesPerXysFile|0;var h=[];for(var v=f;v<=d;++v){h.push(l(this,v))}return e.all(h)};u.prototype.computeXysRadians=function(e,t,r){var a=c(this,e,t);if(a<0){return undefined}var o=a/this._stepSizeDays|0;if(o>=this._totalSamples){return undefined}var s=this._interpolationOrder;var u=o-(s/2|0);if(u<0){u=0}var f=u+s;if(f>=this._totalSamples){f=this._totalSamples-1;u=f-s;if(u<0){u=0}}var d=false;var h=this._samples;if(!n(h[u*3])){l(this,u/this._samplesPerXysFile|0);d=true}if(!n(h[f*3])){l(this,f/this._samplesPerXysFile|0);d=true}if(d){return undefined}if(!n(r)){r=new i(0,0,0)}else{r.x=0;r.y=0;r.s=0}var v=a-u*this._stepSizeDays;var p=this._work;var m=this._denominators;var w=this._coef;var y=this._xTable;var g,S;for(g=0;g<=s;++g){p[g]=v-y[g]}for(g=0;g<=s;++g){w[g]=1;for(S=0;S<=s;++S){if(S!==g){w[g]*=p[S]}}w[g]*=m[g];var b=(u+g)*3;r.x+=w[g]*h[b++];r.y+=w[g]*h[b++];r.s+=w[g]*h[b]}return r};function l(r,i){if(r._chunkDownloadsInProgress[i]){return r._chunkDownloadsInProgress[i]}var a=e.defer();r._chunkDownloadsInProgress[i]=a;var s;var u=r._xysFileUrlTemplate;if(n(u)){s=u.replace(\"{0}\",i)}else{s=t(\"Assets/IAU2006_XYS/IAU2006_XYS_\"+i+\".json\")}e(o(s),function(e){r._chunkDownloadsInProgress[i]=false;var t=r._samples;var n=e.samples;var o=i*r._samplesPerXysFile*3;for(var s=0,u=n.length;s<u;++s){t[o+s]=n[s]}a.resolve()});return a.promise}return u})})();(function(){var t=e.amdDefine;t(\"5e\",[],function(){\"use strict\";function e(e,t,r){this.x=e;this.y=t;this.s=r}return e})})();(function(){var t=e.amdDefine;t(\"5f\",[\"1a\",\"1b\"],function(e,t){\"use strict\";var r;var n={requestFullscreen:undefined,exitFullscreen:undefined,fullscreenEnabled:undefined,fullscreenElement:undefined,fullscreenchange:undefined,fullscreenerror:undefined};var i={};t(i,{element:{get:function(){if(!i.supportsFullscreen()){return undefined}return document[n.fullscreenElement]}},changeEventName:{get:function(){if(!i.supportsFullscreen()){return undefined}return n.fullscreenchange}},errorEventName:{get:function(){if(!i.supportsFullscreen()){return undefined}return n.fullscreenerror}},enabled:{get:function(){if(!i.supportsFullscreen()){return undefined}return document[n.fullscreenEnabled]}},fullscreen:{get:function(){if(!i.supportsFullscreen()){return undefined}return i.element!==null}}});i.supportsFullscreen=function(){if(e(r)){return r}r=false;var t=document.body;if(typeof t.requestFullscreen===\"function\"){n.requestFullscreen=\"requestFullscreen\";n.exitFullscreen=\"exitFullscreen\";n.fullscreenEnabled=\"fullscreenEnabled\";n.fullscreenElement=\"fullscreenElement\";n.fullscreenchange=\"fullscreenchange\";n.fullscreenerror=\"fullscreenerror\";r=true;return r}var i=[\"webkit\",\"moz\",\"o\",\"ms\",\"khtml\"];var a;for(var o=0,s=i.length;o<s;++o){var u=i[o];a=u+\"RequestFullscreen\";if(typeof t[a]===\"function\"){n.requestFullscreen=a;r=true}else{a=u+\"RequestFullScreen\";if(typeof t[a]===\"function\"){n.requestFullscreen=a;r=true}}a=u+\"ExitFullscreen\";if(typeof document[a]===\"function\"){n.exitFullscreen=a}else{a=u+\"CancelFullScreen\";if(typeof document[a]===\"function\"){n.exitFullscreen=a}}a=u+\"FullscreenEnabled\";if(document[a]!==undefined){n.fullscreenEnabled=a}else{a=u+\"FullScreenEnabled\";if(document[a]!==undefined){n.fullscreenEnabled=a}}a=u+\"FullscreenElement\";if(document[a]!==undefined){n.fullscreenElement=a}else{a=u+\"FullScreenElement\";if(document[a]!==undefined){n.fullscreenElement=a}}a=u+\"fullscreenchange\";if(document[\"on\"+a]!==undefined){if(u===\"ms\"){a=\"MSFullscreenChange\"}n.fullscreenchange=a}a=u+\"fullscreenerror\";if(document[\"on\"+a]!==undefined){if(u===\"ms\"){a=\"MSFullscreenError\"}n.fullscreenerror=a}}return r};i.requestFullscreen=function(e,t){if(!i.supportsFullscreen()){return}e[n.requestFullscreen]({vrDisplay:t})};i.exitFullscreen=function(){if(!i.supportsFullscreen()){return}document[n.exitFullscreen]()};return i})})();(function(){var t=e.amdDefine;t(\"60\",[\"23\",\"1a\",\"5f\"],function(e,t,r){\"use strict\";var n;if(typeof navigator!==\"undefined\"){n=navigator}else{n={}}function i(e){var t=e.split(\".\");for(var r=0,n=t.length;r<n;++r){t[r]=parseInt(t[r],10)}return t}var a;var o;function s(){if(!t(a)){a=false;var e=/ Chrome\\/([\\.0-9]+)/.exec(n.userAgent);if(e!==null){a=true;o=i(e[1])}}return a}function u(){return s()&&o}var f;var c;function l(){if(!t(f)){f=false;if(!s()&&/ Safari\\/[\\.0-9]+/.test(n.userAgent)){var e=/ Version\\/([\\.0-9]+)/.exec(n.userAgent);if(e!==null){f=true;c=i(e[1])}}}return f}function d(){return l()&&c}var h;var v;function p(){if(!t(h)){h=false;var e=/ AppleWebKit\\/([\\.0-9]+)(\\+?)/.exec(n.userAgent);if(e!==null){h=true;v=i(e[1]);v.isNightly=!!e[2]}}return h}function m(){return p()&&v}var w;var y;function g(){if(!t(w)){w=false;var e;if(n.appName===\"Microsoft Internet Explorer\"){e=/MSIE ([0-9]{1,}[\\.0-9]{0,})/.exec(n.userAgent);if(e!==null){w=true;y=i(e[1])}}else if(n.appName===\"Netscape\"){e=/Trident\\/.*rv:([0-9]{1,}[\\.0-9]{0,})/.exec(n.userAgent);if(e!==null){w=true;y=i(e[1])}}}return w}function S(){return g()&&y}var b;var T;function _(){if(!t(b)){b=false;var e=/Firefox\\/([\\.0-9]+)/.exec(n.userAgent);if(e!==null){b=true;T=i(e[1])}}return b}var E;function M(){if(!t(E)){E=/Windows/i.test(n.appVersion)}return E}function P(){return _()&&T}var A;function C(){if(!t(A)){A=typeof PointerEvent!==\"undefined\"&&(!t(n.pointerEnabled)||n.pointerEnabled)}return A}var I;var x;function R(){if(!t(x)){var e=document.createElement(\"canvas\");e.setAttribute(\"style\",\"image-rendering: -moz-crisp-edges;\"+\"image-rendering: pixelated;\");var r=e.style.imageRendering;x=t(r)&&r!==\"\";if(x){I=r}}return x}function O(){return R()?I:undefined}var D={isChrome:s,chromeVersion:u,isSafari:l,safariVersion:d,isWebkit:p,webkitVersion:m,isInternetExplorer:g,internetExplorerVersion:S,isFirefox:_,firefoxVersion:P,isWindows:M,hardwareConcurrency:e(n.hardwareConcurrency,3),supportsPointerEvents:C,supportsImageRenderingPixelated:R,imageRenderingValue:O};D.supportsFullscreen=function(){return r.supportsFullscreen()};D.supportsTypedArrays=function(){return typeof ArrayBuffer!==\"undefined\"};D.supportsWebWorkers=function(){return typeof Worker!==\"undefined\"};return D})})();(function(){var t=e.amdDefine;t(\"34\",[\"2c\",\"23\",\"1a\",\"1c\",\"60\",\"1f\",\"27\",\"32\"],function(e,t,r,n,i,a,o,s){\"use strict\";function u(e,r,n,i){this.x=t(e,0);this.y=t(r,0);this.z=t(n,0);this.w=t(i,0)}var f=new e;u.fromAxisAngle=function(t,i,a){if(!r(t)){throw new n(\"axis is required.\")}if(typeof i!==\"number\"){throw new n(\"angle is required and must be a number.\")}var o=i/2;var s=Math.sin(o);f=e.normalize(t,f);var c=f.x*s;var l=f.y*s;var d=f.z*s;var h=Math.cos(o);if(!r(a)){return new u(c,l,d,h)}a.x=c;a.y=l;a.z=d;a.w=h;return a};var c=[1,2,0];var l=new Array(3);u.fromRotationMatrix=function(e,t){if(!r(e)){throw new n(\"matrix is required.\")}var i;var a;var o;var f;var d;var h=e[s.COLUMN0ROW0];var v=e[s.COLUMN1ROW1];var p=e[s.COLUMN2ROW2];var m=h+v+p;if(m>0){i=Math.sqrt(m+1);d=.5*i;i=.5/i;a=(e[s.COLUMN1ROW2]-e[s.COLUMN2ROW1])*i;o=(e[s.COLUMN2ROW0]-e[s.COLUMN0ROW2])*i;f=(e[s.COLUMN0ROW1]-e[s.COLUMN1ROW0])*i}else{var w=c;var y=0;if(v>h){y=1}if(p>h&&p>v){y=2}var g=w[y];var S=w[g];i=Math.sqrt(e[s.getElementIndex(y,y)]-e[s.getElementIndex(g,g)]-e[s.getElementIndex(S,S)]+1);var b=l;b[y]=.5*i;i=.5/i;d=(e[s.getElementIndex(S,g)]-e[s.getElementIndex(g,S)])*i;b[g]=(e[s.getElementIndex(g,y)]+e[s.getElementIndex(y,g)])*i;b[S]=(e[s.getElementIndex(S,y)]+e[s.getElementIndex(y,S)])*i;a=-b[0];o=-b[1];f=-b[2]}if(!r(t)){return new u(a,o,f,d)}t.x=a;t.y=o;t.z=f;t.w=d;return t};var d=new u;u.fromHeadingPitchRoll=function(t,i,a,o){if(!r(t)){throw new n(\"heading is required.\")}if(!r(i)){throw new n(\"pitch is required.\")}if(!r(a)){throw new n(\"roll is required.\")}var s=u.fromAxisAngle(e.UNIT_X,a,d);var f=u.fromAxisAngle(e.UNIT_Y,-i,o);o=u.multiply(f,s,f);var c=u.fromAxisAngle(e.UNIT_Z,-t,d);return u.multiply(c,o,o)};var h=new e;var v=new e;var p=new u;var m=new u;var w=new u;u.packedLength=4;u.pack=function(e,i,a){if(!r(e)){throw new n(\"value is required\")}if(!r(i)){throw new n(\"array is required\")}a=t(a,0);i[a++]=e.x;i[a++]=e.y;i[a++]=e.z;i[a]=e.w};u.unpack=function(e,i,a){if(!r(e)){throw new n(\"array is required\")}i=t(i,0);if(!r(a)){a=new u}a.x=e[i];a.y=e[i+1];a.z=e[i+2];a.w=e[i+3];return a};u.packedInterpolationLength=3;u.convertPackedArrayForInterpolation=function(e,t,r,n){u.unpack(e,r*4,w);u.conjugate(w,w);for(var i=0,a=r-t+1;i<a;i++){var o=i*3;u.unpack(e,(t+i)*4,p);u.multiply(p,w,p);if(p.w<0){u.negate(p,p)}u.computeAxis(p,h);var s=u.computeAngle(p);n[o]=h.x*s;n[o+1]=h.y*s;n[o+2]=h.z*s}};u.unpackInterpolationResult=function(t,n,i,a,o){if(!r(o)){o=new u}e.fromArray(t,0,v);var s=e.magnitude(v);u.unpack(n,a*4,m);if(s===0){u.clone(u.IDENTITY,p)}else{u.fromAxisAngle(v,s,p)}return u.multiply(p,m,o)};u.clone=function(e,t){if(!r(e)){return undefined}if(!r(t)){return new u(e.x,e.y,e.z,e.w)}t.x=e.x;t.y=e.y;t.z=e.z;t.w=e.w;return t};u.conjugate=function(e,t){if(!r(e)){throw new n(\"quaternion is required\")}if(!r(t)){throw new n(\"result is required\")}t.x=-e.x;t.y=-e.y;t.z=-e.z;t.w=e.w;return t};u.magnitudeSquared=function(e){if(!r(e)){throw new n(\"quaternion is required\")}return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w};u.magnitude=function(e){return Math.sqrt(u.magnitudeSquared(e))};u.normalize=function(e,t){if(!r(t)){throw new n(\"result is required\")}var i=1/u.magnitude(e);var a=e.x*i;var o=e.y*i;var s=e.z*i;var f=e.w*i;t.x=a;t.y=o;t.z=s;t.w=f;return t};u.inverse=function(e,t){if(!r(t)){throw new n(\"result is required\")}var i=u.magnitudeSquared(e);t=u.conjugate(e,t);return u.multiplyByScalar(t,1/i,t)};u.add=function(e,t,i){if(!r(e)){throw new n(\"left is required\")}if(!r(t)){throw new n(\"right is required\")}if(!r(i)){throw new n(\"result is required\")}i.x=e.x+t.x;i.y=e.y+t.y;i.z=e.z+t.z;i.w=e.w+t.w;return i};u.subtract=function(e,t,i){if(!r(e)){throw new n(\"left is required\")}if(!r(t)){throw new n(\"right is required\")}if(!r(i)){throw new n(\"result is required\")}i.x=e.x-t.x;i.y=e.y-t.y;i.z=e.z-t.z;i.w=e.w-t.w;return i};u.negate=function(e,t){if(!r(e)){throw new n(\"quaternion is required\")}if(!r(t)){throw new n(\"result is required\")}t.x=-e.x;t.y=-e.y;t.z=-e.z;t.w=-e.w;return t};u.dot=function(e,t){if(!r(e)){throw new n(\"left is required\")}if(!r(t)){throw new n(\"right is required\")}return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w};u.multiply=function(e,t,i){if(!r(e)){throw new n(\"left is required\")}if(!r(t)){throw new n(\"right is required\")}if(!r(i)){throw new n(\"result is required\")}var a=e.x;var o=e.y;var s=e.z;var u=e.w;var f=t.x;var c=t.y;var l=t.z;var d=t.w;var h=u*f+a*d+o*l-s*c;var v=u*c-a*l+o*d+s*f;var p=u*l+a*c-o*f+s*d;var m=u*d-a*f-o*c-s*l;i.x=h;i.y=v;i.z=p;i.w=m;return i};u.multiplyByScalar=function(e,t,i){if(!r(e)){throw new n(\"quaternion is required\")}if(typeof t!==\"number\"){throw new n(\"scalar is required and must be a number.\")}if(!r(i)){throw new n(\"result is required\")}i.x=e.x*t;i.y=e.y*t;i.z=e.z*t;i.w=e.w*t;return i};u.divideByScalar=function(e,t,i){if(!r(e)){throw new n(\"quaternion is required\")}if(typeof t!==\"number\"){throw new n(\"scalar is required and must be a number.\")}if(!r(i)){throw new n(\"result is required\")}i.x=e.x/t;i.y=e.y/t;i.z=e.z/t;i.w=e.w/t;return i};u.computeAxis=function(e,t){if(!r(e)){throw new n(\"quaternion is required\")}if(!r(t)){throw new n(\"result is required\")}var i=e.w;if(Math.abs(i-1)<o.EPSILON6){t.x=t.y=t.z=0;return t}var a=1/Math.sqrt(1-i*i);t.x=e.x*a;t.y=e.y*a;t.z=e.z*a;return t};u.computeAngle=function(e){if(!r(e)){throw new n(\"quaternion is required\")}if(Math.abs(e.w-1)<o.EPSILON6){return 0}return 2*Math.acos(e.w)};var y=new u;u.lerp=function(e,t,i,a){if(!r(e)){throw new n(\"start is required.\")}if(!r(t)){throw new n(\"end is required.\")}if(typeof i!==\"number\"){throw new n(\"t is required and must be a number.\")}if(!r(a)){throw new n(\"result is required\")}y=u.multiplyByScalar(t,i,y);a=u.multiplyByScalar(e,1-i,a);return u.add(y,a,a)};var g=new u;\nvar S=new u;var b=new u;u.slerp=function(e,t,i,a){if(!r(e)){throw new n(\"start is required.\")}if(!r(t)){throw new n(\"end is required.\")}if(typeof i!==\"number\"){throw new n(\"t is required and must be a number.\")}if(!r(a)){throw new n(\"result is required\")}var s=u.dot(e,t);var f=t;if(s<0){s=-s;f=g=u.negate(t,g)}if(1-s<o.EPSILON6){return u.lerp(e,f,i,a)}var c=Math.acos(s);S=u.multiplyByScalar(e,Math.sin((1-i)*c),S);b=u.multiplyByScalar(f,Math.sin(i*c),b);a=u.add(S,b,a);return u.multiplyByScalar(a,1/Math.sin(c),a)};u.log=function(t,i){if(!r(t)){throw new n(\"quaternion is required.\")}if(!r(i)){throw new n(\"result is required\")}var a=o.acosClamped(t.w);var s=0;if(a!==0){s=a/Math.sin(a)}return e.multiplyByScalar(t,s,i)};u.exp=function(t,i){if(!r(t)){throw new n(\"cartesian is required.\")}if(!r(i)){throw new n(\"result is required\")}var a=e.magnitude(t);var o=0;if(a!==0){o=Math.sin(a)/a}i.x=t.x*o;i.y=t.y*o;i.z=t.z*o;i.w=Math.cos(a);return i};var T=new e;var _=new e;var E=new u;var M=new u;u.computeInnerQuadrangle=function(t,i,a,o){if(!r(t)||!r(i)||!r(a)){throw new n(\"q0, q1, and q2 are required.\")}if(!r(o)){throw new n(\"result is required\")}var s=u.conjugate(i,E);u.multiply(s,a,M);var f=u.log(M,T);u.multiply(s,t,M);var c=u.log(M,_);e.add(f,c,f);e.multiplyByScalar(f,.25,f);e.negate(f,f);u.exp(f,E);return u.multiply(i,E,o)};u.squad=function(e,t,i,a,o,s){if(!r(e)||!r(t)||!r(i)||!r(a)){throw new n(\"q0, q1, s0, and s1 are required.\")}if(typeof o!==\"number\"){throw new n(\"t is required and must be a number.\")}if(!r(s)){throw new n(\"result is required\")}var f=u.slerp(e,t,o,E);var c=u.slerp(i,a,o,M);return u.slerp(f,c,2*o*(1-o),s)};var P=new u;var A=1.9011074535173003;var C=i.supportsTypedArrays()?new Float32Array(8):[];var I=i.supportsTypedArrays()?new Float32Array(8):[];var x=i.supportsTypedArrays()?new Float32Array(8):[];var R=i.supportsTypedArrays()?new Float32Array(8):[];for(var O=0;O<7;++O){var D=O+1;var q=2*D+1;C[O]=1/(D*q);I[O]=D/q}C[7]=A/(8*17);I[7]=A*8/17;u.fastSlerp=function(e,t,i,a){if(!r(e)){throw new n(\"start is required.\")}if(!r(t)){throw new n(\"end is required.\")}if(typeof i!==\"number\"){throw new n(\"t is required and must be a number.\")}if(!r(a)){throw new n(\"result is required\")}var o=u.dot(e,t);var s;if(o>=0){s=1}else{s=-1;o=-o}var f=o-1;var c=1-i;var l=i*i;var d=c*c;for(var h=7;h>=0;--h){x[h]=(C[h]*l-I[h])*f;R[h]=(C[h]*d-I[h])*f}var v=s*i*(1+x[0]*(1+x[1]*(1+x[2]*(1+x[3]*(1+x[4]*(1+x[5]*(1+x[6]*(1+x[7]))))))));var p=c*(1+R[0]*(1+R[1]*(1+R[2]*(1+R[3]*(1+R[4]*(1+R[5]*(1+R[6]*(1+R[7]))))))));var m=u.multiplyByScalar(e,p,P);u.multiplyByScalar(t,v,a);return u.add(m,a,a)};u.fastSquad=function(e,t,i,a,o,s){if(!r(e)||!r(t)||!r(i)||!r(a)){throw new n(\"q0, q1, s0, and s1 are required.\")}if(typeof o!==\"number\"){throw new n(\"t is required and must be a number.\")}if(!r(s)){throw new n(\"result is required\")}var f=u.fastSlerp(e,t,o,E);var c=u.fastSlerp(i,a,o,M);return u.fastSlerp(f,c,2*o*(1-o),s)};u.equals=function(e,t){return e===t||r(e)&&r(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w};u.equalsEpsilon=function(e,t,i){if(typeof i!==\"number\"){throw new n(\"epsilon is required and must be a number.\")}return e===t||r(e)&&r(t)&&Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i&&Math.abs(e.z-t.z)<=i&&Math.abs(e.w-t.w)<=i};u.ZERO=a(new u(0,0,0,0));u.IDENTITY=a(new u(0,0,0,1));u.prototype.clone=function(e){return u.clone(this,e)};u.prototype.equals=function(e){return u.equals(this,e)};u.prototype.equalsEpsilon=function(e,t){return u.equalsEpsilon(this,e,t)};u.prototype.toString=function(){return\"(\"+this.x+\", \"+this.y+\", \"+this.z+\", \"+this.w+\")\"};return u})})();(function(){var t=e.amdDefine;t(\"35\",[\"4e\",\"45\",\"2c\",\"43\",\"3b\",\"23\",\"1a\",\"1c\",\"4d\",\"4f\",\"3c\",\"5d\",\"5e\",\"24\",\"27\",\"32\",\"33\",\"34\",\"52\"],function(e,t,r,n,i,a,o,s,u,f,c,l,d,h,v,p,m,w,y){\"use strict\";var g={};var S=new r;var b=new r;var T=new r;g.eastNorthUpToFixedFrame=function(e,t,n){if(!o(e)){throw new s(\"origin is required.\")}if(v.equalsEpsilon(e.x,0,v.EPSILON14)&&v.equalsEpsilon(e.y,0,v.EPSILON14)){var i=v.sign(e.z);if(!o(n)){return new m(0,-i,0,e.x,1,0,0,e.y,0,0,i,e.z,0,0,0,1)}n[0]=0;n[1]=1;n[2]=0;n[3]=0;n[4]=-i;n[5]=0;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=i;n[11]=0;n[12]=e.x;n[13]=e.y;n[14]=e.z;n[15]=1;return n}var u=S;var f=b;var l=T;t=a(t,c.WGS84);t.geodeticSurfaceNormal(e,u);f.x=-e.y;f.y=e.x;f.z=0;r.normalize(f,f);r.cross(u,f,l);if(!o(n)){return new m(f.x,l.x,u.x,e.x,f.y,l.y,u.y,e.y,f.z,l.z,u.z,e.z,0,0,0,1)}n[0]=f.x;n[1]=f.y;n[2]=f.z;n[3]=0;n[4]=l.x;n[5]=l.y;n[6]=l.z;n[7]=0;n[8]=u.x;n[9]=u.y;n[10]=u.z;n[11]=0;n[12]=e.x;n[13]=e.y;n[14]=e.z;n[15]=1;return n};var _=new r;var E=new r;var M=new r;g.northEastDownToFixedFrame=function(e,t,n){if(!o(e)){throw new s(\"origin is required.\")}if(v.equalsEpsilon(e.x,0,v.EPSILON14)&&v.equalsEpsilon(e.y,0,v.EPSILON14)){var i=v.sign(e.z);if(!o(n)){return new m(-i,0,0,e.x,0,1,0,e.y,0,0,-i,e.z,0,0,0,1)}n[0]=-i;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=1;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=-i;n[11]=0;n[12]=e.x;n[13]=e.y;n[14]=e.z;n[15]=1;return n}var u=_;var f=E;var l=M;t=a(t,c.WGS84);t.geodeticSurfaceNormal(e,u);f.x=-e.y;f.y=e.x;f.z=0;r.normalize(f,f);r.cross(u,f,l);if(!o(n)){return new m(l.x,f.x,-u.x,e.x,l.y,f.y,-u.y,e.y,l.z,f.z,-u.z,e.z,0,0,0,1)}n[0]=l.x;n[1]=l.y;n[2]=l.z;n[3]=0;n[4]=f.x;n[5]=f.y;n[6]=f.z;n[7]=0;n[8]=-u.x;n[9]=-u.y;n[10]=-u.z;n[11]=0;n[12]=e.x;n[13]=e.y;n[14]=e.z;n[15]=1;return n};g.northUpEastToFixedFrame=function(e,t,n){if(!o(e)){throw new s(\"origin is required.\")}if(v.equalsEpsilon(e.x,0,v.EPSILON14)&&v.equalsEpsilon(e.y,0,v.EPSILON14)){var i=v.sign(e.z);if(!o(n)){return new m(-i,0,0,e.x,0,0,1,e.y,0,i,0,e.z,0,0,0,1)}n[0]=-i;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=0;n[6]=i;n[7]=0;n[8]=0;n[9]=1;n[10]=0;n[11]=0;n[12]=e.x;n[13]=e.y;n[14]=e.z;n[15]=1;return n}var u=S;var f=b;var l=T;t=a(t,c.WGS84);t.geodeticSurfaceNormal(e,u);f.x=-e.y;f.y=e.x;f.z=0;r.normalize(f,f);r.cross(u,f,l);if(!o(n)){return new m(l.x,u.x,f.x,e.x,l.y,u.y,f.y,e.y,l.z,u.z,f.z,e.z,0,0,0,1)}n[0]=l.x;n[1]=l.y;n[2]=l.z;n[3]=0;n[4]=u.x;n[5]=u.y;n[6]=u.z;n[7]=0;n[8]=f.x;n[9]=f.y;n[10]=f.z;n[11]=0;n[12]=e.x;n[13]=e.y;n[14]=e.z;n[15]=1;return n};var P=new w;var A=new r(1,1,1);var C=new m;g.headingPitchRollToFixedFrame=function(e,t,n,i,a,o){var s=w.fromHeadingPitchRoll(t,n,i,P);var u=m.fromTranslationQuaternionRotationScale(r.ZERO,s,A,C);o=g.eastNorthUpToFixedFrame(e,a,o);return m.multiply(o,u,o)};var I=new m;var x=new p;g.headingPitchRollQuaternion=function(e,t,r,n,i,a){var o=g.headingPitchRollToFixedFrame(e,t,r,n,i,I);var s=m.getRotation(o,x);return w.fromRotationMatrix(s,a)};var R=6*3600+41*60+50.54841;var O=8640184.812866;var D=.093104;var q=-62e-7;var N=1.1772758384668e-19;var G=72921158553e-15;var L=v.TWO_PI/86400;var B=new h;g.computeTemeToPseudoFixedMatrix=function(e,t){if(!o(e)){throw new s(\"date is required.\")}B=h.addSeconds(e,-h.computeTaiMinusUtc(e),B);var r=B.dayNumber;var n=B.secondsOfDay;var i;var a=r-2451545;if(n>=43200){i=(a+.5)/y.DAYS_PER_JULIAN_CENTURY}else{i=(a-.5)/y.DAYS_PER_JULIAN_CENTURY}var u=R+i*(O+i*(D+i*q));var f=u*L%v.TWO_PI;var c=G+N*(r-2451545.5);var l=(n+y.SECONDS_PER_DAY*.5)%y.SECONDS_PER_DAY;var d=f+c*l;var m=Math.cos(d);var w=Math.sin(d);if(!o(t)){return new p(m,w,0,-w,m,0,0,0,1)}t[0]=m;t[1]=-w;t[2]=0;t[3]=w;t[4]=m;t[5]=0;t[6]=0;t[7]=0;t[8]=1;return t};g.iau2006XysData=new l;g.earthOrientationParameters=u.NONE;var H=32.184;var k=2451545;g.preloadIcrfFixed=function(t){var r=t.start.dayNumber;var n=t.start.secondsOfDay+H;var i=t.stop.dayNumber;var a=t.stop.secondsOfDay+H;var o=g.iau2006XysData.preload(r,n,i,a);var s=g.earthOrientationParameters.getPromiseToLoad();return e.all([o,s])};g.computeIcrfToFixedMatrix=function(e,t){if(!o(e)){throw new s(\"date is required.\")}if(!o(t)){t=new p}var r=g.computeFixedToIcrfMatrix(e,t);if(!o(r)){return undefined}return p.transpose(r,t)};var z=new d(0,0,0);var F=new f(0,0,0,0,0,0);var U=new p;var V=new p;g.computeFixedToIcrfMatrix=function(e,t){if(!o(e)){throw new s(\"date is required.\")}if(!o(t)){t=new p}var r=g.earthOrientationParameters.compute(e,F);if(!o(r)){return undefined}var n=e.dayNumber;var i=e.secondsOfDay+H;var a=g.iau2006XysData.computeXysRadians(n,i,z);if(!o(a)){return undefined}var u=a.x+r.xPoleOffset;var f=a.y+r.yPoleOffset;var c=1/(1+Math.sqrt(1-u*u-f*f));var l=U;l[0]=1-c*u*u;l[3]=-c*u*f;l[6]=u;l[1]=-c*u*f;l[4]=1-c*f*f;l[7]=f;l[2]=-u;l[5]=-f;l[8]=1-c*(u*u+f*f);var d=p.fromRotationZ(-a.s,V);var m=p.multiply(l,d,U);var w=e.dayNumber;var S=e.secondsOfDay-h.computeTaiMinusUtc(e)+r.ut1MinusUtc;var b=w-2451545;var T=S/y.SECONDS_PER_DAY;var _=.779057273264+T+.00273781191135448*(b+T);_=_%1*v.TWO_PI;var E=p.fromRotationZ(_,V);var M=p.multiply(m,E,U);var P=Math.cos(r.xPoleWander);var A=Math.cos(r.yPoleWander);var C=Math.sin(r.xPoleWander);var I=Math.sin(r.yPoleWander);var x=n-k+i/y.SECONDS_PER_DAY;x/=36525;var R=-47e-6*x*v.RADIANS_PER_DEGREE/3600;var O=Math.cos(R);var D=Math.sin(R);var q=V;q[0]=P*O;q[1]=P*D;q[2]=C;q[3]=-A*D+I*C*O;q[4]=A*O+I*C*D;q[5]=-I*P;q[6]=-I*D-A*C*O;q[7]=I*O-A*C*D;q[8]=A*P;return p.multiply(M,q,t)};var j=new n;g.pointToWindowCoordinates=function(e,t,r,n){n=g.pointToGLWindowCoordinates(e,t,r,n);n.y=2*t[5]-n.y;return n};g.pointToGLWindowCoordinates=function(e,r,i,a){if(!o(e)){throw new s(\"modelViewProjectionMatrix is required.\")}if(!o(r)){throw new s(\"viewportTransformation is required.\")}if(!o(i)){throw new s(\"point is required.\")}if(!o(a)){a=new t}var u=j;m.multiplyByVector(e,n.fromElements(i.x,i.y,i.z,1,u),u);n.multiplyByScalar(u,1/u.w,u);m.multiplyByVector(r,u,u);return t.fromCartesian4(u,a)};var W=new r;var X=new r;var Q=new r;g.rotationMatrixFromPositionVelocity=function(e,t,n,i){if(!o(e)){throw new s(\"position is required.\")}if(!o(t)){throw new s(\"velocity is required.\")}var u=a(n,c.WGS84).geodeticSurfaceNormal(e,W);var f=r.cross(t,u,X);if(r.equalsEpsilon(f,r.ZERO,v.EPSILON6)){f=r.clone(r.UNIT_X,f)}var l=r.cross(f,t,Q);r.cross(t,l,f);r.negate(f,f);if(!o(i)){i=new p}i[0]=t.x;i[1]=t.y;i[2]=t.z;i[3]=f.x;i[4]=f.y;i[5]=f.z;i[6]=l.x;i[7]=l.y;i[8]=l.z;return i};var K=new i;var Y=new r;var Z=new r;var J=new n;var $=new n;var ee=new n;var te=new n;var re=new n;var ne=new m;var ie=new m;g.basisTo2D=function(e,t,i){if(!o(e)){throw new s(\"projection is required.\")}if(!o(t)){throw new s(\"matrix is required.\")}if(!o(i)){throw new s(\"result is required.\")}var a=e.ellipsoid;var u=m.getColumn(t,3,J);var f=a.cartesianToCartographic(u,K);var c=g.eastNorthUpToFixedFrame(u,a,ne);var l=m.inverseTransformation(c,ie);var d=e.project(f,Y);var h=$;h.x=d.z;h.y=d.x;h.z=d.y;h.w=1;var v=m.getColumn(t,0,Z);var p=r.magnitude(v);var w=m.multiplyByVector(l,v,ee);n.fromElements(w.z,w.x,w.y,0,w);var y=m.getColumn(t,1,Z);var S=r.magnitude(y);var b=m.multiplyByVector(l,y,te);n.fromElements(b.z,b.x,b.y,0,b);var T=m.getColumn(t,2,Z);var _=r.magnitude(T);var E=re;r.cross(w,b,E);r.normalize(E,E);r.cross(b,E,w);r.normalize(w,w);r.cross(E,w,b);r.normalize(b,b);r.multiplyByScalar(w,p,w);r.multiplyByScalar(b,S,b);r.multiplyByScalar(E,_,E);m.setColumn(i,0,w,i);m.setColumn(i,1,b,i);m.setColumn(i,2,E,i);m.setColumn(i,3,h,i);return i};return g})})();(function(){var t=e.amdDefine;t(\"61\",[],function(){function e(){var e=/%%|%(\\d+\\$)?([-+\\'#0 ]*)(\\*\\d+\\$|\\*|\\d+)?(\\.(\\*\\d+\\$|\\*|\\d+))?([scboxXuideEfFgG])/g;var t=arguments,r=0,n=t[r++];var i=function(e,t,r,n){if(!r){r=\" \"}var i=e.length>=t?\"\":Array(1+t-e.length>>>0).join(r);return n?e+i:i+e};var a=function(e,t,r,n,a,o){var s=n-e.length;if(s>0){if(r||!a){e=i(e,n,o,r)}else{e=e.slice(0,t.length)+i(\"\",s,\"0\",true)+e.slice(t.length)}}return e};var o=function(e,t,r,n,o,s,u){var f=e>>>0;r=r&&f&&{2:\"0b\",8:\"0\",16:\"0x\"}[t]||\"\";e=r+i(f.toString(t),s||0,\"0\",false);return a(e,r,n,o,u)};var s=function(e,t,r,n,i,o){if(n!=null){e=e.slice(0,n)}return a(e,\"\",t,r,i,o)};var u=function(e,n,u,f,c,l,d){var h;var v;var p;var m;var w;if(e==\"%%\"){return\"%\"}var y=false,g=\"\",S=false,b=false,T=\" \";var _=u.length;for(var E=0;u&&E<_;E++){switch(u.charAt(E)){case\" \":g=\" \";break;case\"+\":g=\"+\";break;case\"-\":y=true;break;case\"'\":T=u.charAt(E+1);break;case\"0\":S=true;break;case\"#\":b=true;break}}if(!f){f=0}else if(f==\"*\"){f=+t[r++]}else if(f.charAt(0)==\"*\"){f=+t[f.slice(1,-1)]}else{f=+f}if(f<0){f=-f;y=true}if(!isFinite(f)){throw new Error(\"sprintf: (minimum-)width must be finite\")}if(!l){l=\"fFeE\".indexOf(d)>-1?6:d==\"d\"?0:undefined}else if(l==\"*\"){l=+t[r++]}else if(l.charAt(0)==\"*\"){l=+t[l.slice(1,-1)]}else{l=+l}w=n?t[n.slice(0,-1)]:t[r++];switch(d){case\"s\":return s(String(w),y,f,l,S,T);case\"c\":return s(String.fromCharCode(+w),y,f,l,S);case\"b\":return o(w,2,b,y,f,l,S);case\"o\":return o(w,8,b,y,f,l,S);case\"x\":return o(w,16,b,y,f,l,S);case\"X\":return o(w,16,b,y,f,l,S).toUpperCase();case\"u\":return o(w,10,b,y,f,l,S);case\"i\":case\"d\":h=+w||0;h=Math.round(h-h%1);v=h<0?\"-\":g;w=v+i(String(Math.abs(h)),l,\"0\",false);return a(w,v,y,f,S);case\"e\":case\"E\":case\"f\":case\"F\":case\"g\":case\"G\":h=+w;v=h<0?\"-\":g;p=[\"toExponential\",\"toFixed\",\"toPrecision\"][\"efg\".indexOf(d.toLowerCase())];m=[\"toString\",\"toUpperCase\"][\"eEfFgG\".indexOf(d)%2];w=v+Math.abs(h)[p](l);return a(w,v,y,f,S)[m]();default:return e}};return n.replace(e,u)}return e})})();(function(){var t=e.amdDefine;t(\"4c\",[\"1a\",\"1c\"],function(e,t){\"use strict\";function r(r,n,i){if(!e(r)){throw new t(\"array is required.\")}if(!e(n)){throw new t(\"itemToFind is required.\")}if(!e(i)){throw new t(\"comparator is required.\")}var a=0;var o=r.length-1;var s;var u;while(a<=o){s=~~((a+o)/2);u=i(r[s],n);if(u<0){a=s+1;continue}if(u>0){o=s-1;continue}return s}return~(o+1)}return r})})();(function(){var t=e.amdDefine;t(\"62\",[],function(){\"use strict\";function e(e,t,r,n,i,a,o,s){this.year=e;this.month=t;this.day=r;this.hour=n;this.minute=i;this.second=a;this.millisecond=o;this.isLeapSecond=s}return e})})();(function(){var t=e.amdDefine;t(\"63\",[\"1c\"],function(e){\"use strict\";function t(t){if(t===null||isNaN(t)){throw new e(\"year is required and must be a number.\")}return t%4===0&&t%100!==0||t%400===0}return t})})();(function(){var t=e.amdDefine;t(\"50\",[],function(){\"use strict\";function e(e,t){this.julianDate=e;this.offset=t}return e})})();(function(){var t=e.amdDefine;t(\"24\",[\"61\",\"4c\",\"23\",\"1a\",\"1c\",\"62\",\"63\",\"50\",\"52\",\"53\"],function(e,t,r,n,i,a,o,s,u,f){\"use strict\";var c=new a;var l=[31,28,31,30,31,30,31,31,30,31,30,31];var d=29;function h(e,t){return I.compare(e.julianDate,t.julianDate)}var v=new s;function p(e){v.julianDate=e;var r=I.leapSeconds;var n=t(r,v,h);if(n<0){n=~n}if(n>=r.length){n=r.length-1}var i=r[n].offset;if(n>0){var a=I.secondsDifference(r[n].julianDate,e);if(a>i){n--;i=r[n].offset}}I.addSeconds(e,i,e)}function m(e,r){v.julianDate=e;var n=I.leapSeconds;var i=t(n,v,h);if(i<0){i=~i}if(i===0){return I.addSeconds(e,-n[0].offset,r)}if(i>=n.length){return I.addSeconds(e,-n[i-1].offset,r)}var a=I.secondsDifference(n[i].julianDate,e);if(a===0){return I.addSeconds(e,-n[i].offset,r)}if(a<=1){return undefined}return I.addSeconds(e,-n[--i].offset,r)}function w(e,t,r){var n=t/u.SECONDS_PER_DAY|0;e+=n;t-=u.SECONDS_PER_DAY*n;if(t<0){e--;t+=u.SECONDS_PER_DAY}r.dayNumber=e;r.secondsOfDay=t;return r}function y(e,t,r,n,i,a,o){var s=(t-14)/12|0;var f=e+4800+s;var c=(1461*f/4|0)+(367*(t-2-12*s)/12|0)-(3*((f+100)/100|0)/4|0)+r-32075;n=n-12;if(n<0){n+=24}var l=a+(n*u.SECONDS_PER_HOUR+i*u.SECONDS_PER_MINUTE+o*u.SECONDS_PER_MILLISECOND);if(l>=43200){c-=1}return[c,l]}var g=/^(\\d{4})$/;var S=/^(\\d{4})-(\\d{2})$/;var b=/^(\\d{4})-?(\\d{3})$/;var T=/^(\\d{4})-?W(\\d{2})-?(\\d{1})?$/;var _=/^(\\d{4})-?(\\d{2})-?(\\d{2})$/;var E=/([Z+\\-])?(\\d{2})?:?(\\d{2})?$/;var M=/^(\\d{2})(\\.\\d+)?/.source+E.source;var P=/^(\\d{2}):?(\\d{2})(\\.\\d+)?/.source+E.source;var A=/^(\\d{2}):?(\\d{2}):?(\\d{2})(\\.\\d+)?/.source+E.source;var C=\"Invalid ISO 8601 date.\";function I(e,t,n){this.dayNumber=undefined;this.secondsOfDay=undefined;e=r(e,0);t=r(t,0);n=r(n,f.UTC);var i=e|0;t=t+(e-i)*u.SECONDS_PER_DAY;w(i,t,this);if(n===f.UTC){p(this)}}I.fromDate=function(e,t){if(!(e instanceof Date)||isNaN(e.getTime())){throw new i(\"date must be a valid JavaScript Date.\")}var r=y(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());if(!n(t)){return new I(r[0],r[1],f.UTC)}w(r[0],r[1],t);p(t);return t};I.fromIso8601=function(e,t){if(typeof e!==\"string\"){throw new i(C)}e=e.replace(\",\",\".\");var r=e.split(\"T\");var a;var s=1;var u=1;var c=0;var h=0;var v=0;var m=0;var E=r[0];var x=r[1];var R;var O;if(!n(E)){throw new i(C)}var D;r=E.match(_);if(r!==null){D=E.split(\"-\").length-1;if(D>0&&D!==2){throw new i(C)}a=+r[1];s=+r[2];u=+r[3]}else{r=E.match(S);if(r!==null){a=+r[1];s=+r[2]}else{r=E.match(g);if(r!==null){a=+r[1]}else{var q;r=E.match(b);if(r!==null){a=+r[1];q=+r[2];O=o(a);if(q<1||O&&q>366||!O&&q>365){throw new i(C)}}else{r=E.match(T);if(r!==null){a=+r[1];var N=+r[2];var G=+r[3]||0;D=E.split(\"-\").length-1;if(D>0&&(!n(r[3])&&D!==1||n(r[3])&&D!==2)){throw new i(C)}var L=new Date(Date.UTC(a,0,4));q=N*7+G-L.getUTCDay()-3}else{throw new i(C)}}R=new Date(Date.UTC(a,0,1));R.setUTCDate(q);s=R.getUTCMonth()+1;u=R.getUTCDate()}}}O=o(a);if(s<1||s>12||u<1||(s!==2||!O)&&u>l[s-1]||O&&s===2&&u>d){throw new i(C)}var B;if(n(x)){r=x.match(A);if(r!==null){D=x.split(\":\").length-1;if(D>0&&D!==2&&D!==3){throw new i(C)}c=+r[1];h=+r[2];v=+r[3];m=+(r[4]||0)*1e3;B=5}else{r=x.match(P);if(r!==null){D=x.split(\":\").length-1;if(D>2){throw new i(C)}c=+r[1];h=+r[2];v=+(r[3]||0)*60;B=4}else{r=x.match(M);if(r!==null){c=+r[1];h=+(r[2]||0)*60;B=3}else{throw new i(C)}}}if(h>=60||v>=61||c>24||c===24&&(h>0||v>0||m>0)){throw new i(C)}var H=r[B];var k=+r[B+1];var z=+(r[B+2]||0);switch(H){case\"+\":c=c-k;h=h-z;break;case\"-\":c=c+k;h=h+z;break;case\"Z\":break;default:h=h+new Date(Date.UTC(a,s-1,u,c,h)).getTimezoneOffset();break}}else{h=h+new Date(a,s-1,u).getTimezoneOffset()}var F=v===60;if(F){v--}while(h>=60){h-=60;c++}while(c>=24){c-=24;u++}R=O&&s===2?d:l[s-1];while(u>R){u-=R;s++;if(s>12){s-=12;a++}R=O&&s===2?d:l[s-1]}while(h<0){h+=60;c--}while(c<0){c+=24;u--}while(u<1){s--;if(s<1){s+=12;a--}R=O&&s===2?d:l[s-1];u+=R}var U=y(a,s,u,c,h,v,m);if(!n(t)){t=new I(U[0],U[1],f.UTC)}else{w(U[0],U[1],t);p(t)}if(F){I.addSeconds(t,1,t)}return t};I.now=function(e){return I.fromDate(new Date,e)};var x=new I(0,0,f.TAI);I.toGregorianDate=function(e,t){if(!n(e)){throw new i(\"julianDate is required.\")}var r=false;var o=m(e,x);if(!n(o)){I.addSeconds(e,-1,x);o=m(x,x);r=true}var s=o.dayNumber;var f=o.secondsOfDay;if(f>=43200){s+=1}var c=s+68569|0;var l=4*c/146097|0;c=c-((146097*l+3)/4|0)|0;var d=4e3*(c+1)/1461001|0;c=c-(1461*d/4|0)+31|0;var h=80*c/2447|0;var v=c-(2447*h/80|0)|0;c=h/11|0;var p=h+2-12*c|0;var w=100*(l-49)+d+c|0;var y=f/u.SECONDS_PER_HOUR|0;var g=f-y*u.SECONDS_PER_HOUR;var S=g/u.SECONDS_PER_MINUTE|0;g=g-S*u.SECONDS_PER_MINUTE;var b=g|0;var T=(g-b)/u.SECONDS_PER_MILLISECOND;y+=12;if(y>23){y-=24}if(r){b+=1}if(!n(t)){return new a(w,p,v,y,S,b,T,r)}t.year=w;t.month=p;t.day=v;t.hour=y;t.minute=S;t.second=b;t.millisecond=T;t.isLeapSecond=r;return t};I.toDate=function(e){if(!n(e)){throw new i(\"julianDate is required.\")}var t=I.toGregorianDate(e,c);var r=t.second;if(t.isLeapSecond){r-=1}return new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,r,t.millisecond))};I.toIso8601=function(t,r){if(!n(t)){throw new i(\"julianDate is required.\")}var a=I.toGregorianDate(t,a);var o;if(!n(r)&&a.millisecond!==0){o=(a.millisecond*.01).toString().replace(\".\",\"\");return e(\"%04d-%02d-%02dT%02d:%02d:%02d.%sZ\",a.year,a.month,a.day,a.hour,a.minute,a.second,o)}if(!n(r)||r===0){return e(\"%04d-%02d-%02dT%02d:%02d:%02dZ\",a.year,a.month,a.day,a.hour,a.minute,a.second)}o=(a.millisecond*.01).toFixed(r).replace(\".\",\"\").slice(0,r);return e(\"%04d-%02d-%02dT%02d:%02d:%02d.%sZ\",a.year,a.month,a.day,a.hour,a.minute,a.second,o)};I.clone=function(e,t){if(!n(e)){return undefined}if(!n(t)){return new I(e.dayNumber,e.secondsOfDay,f.TAI)}t.dayNumber=e.dayNumber;t.secondsOfDay=e.secondsOfDay;return t};I.compare=function(e,t){if(!n(e)){throw new i(\"left is required.\")}if(!n(t)){throw new i(\"right is required.\")}var r=e.dayNumber-t.dayNumber;if(r!==0){return r}return e.secondsOfDay-t.secondsOfDay};I.equals=function(e,t){return e===t||n(e)&&n(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay};I.equalsEpsilon=function(e,t,r){if(!n(r)){throw new i(\"epsilon is required.\")}return e===t||n(e)&&n(t)&&Math.abs(I.secondsDifference(e,t))<=r};I.totalDays=function(e){if(!n(e)){throw new i(\"julianDate is required.\")}return e.dayNumber+e.secondsOfDay/u.SECONDS_PER_DAY};I.secondsDifference=function(e,t){if(!n(e)){throw new i(\"left is required.\")}if(!n(t)){throw new i(\"right is required.\")}var r=(e.dayNumber-t.dayNumber)*u.SECONDS_PER_DAY;return r+(e.secondsOfDay-t.secondsOfDay)};I.daysDifference=function(e,t){if(!n(e)){throw new i(\"left is required.\")}if(!n(t)){throw new i(\"right is required.\")}var r=e.dayNumber-t.dayNumber;var a=(e.secondsOfDay-t.secondsOfDay)/u.SECONDS_PER_DAY;return r+a};I.computeTaiMinusUtc=function(e){v.julianDate=e;var r=I.leapSeconds;var n=t(r,v,h);if(n<0){n=~n;--n;if(n<0){n=0}}return r[n].offset};I.addSeconds=function(e,t,r){if(!n(e)){throw new i(\"julianDate is required.\")}if(!n(t)){throw new i(\"seconds is required.\")}if(!n(r)){throw new i(\"result is required.\")}return w(e.dayNumber,e.secondsOfDay+t,r)};I.addMinutes=function(e,t,r){if(!n(e)){throw new i(\"julianDate is required.\")}if(!n(t)){throw new i(\"minutes is required.\")}if(!n(r)){throw new i(\"result is required.\")}var a=e.secondsOfDay+t*u.SECONDS_PER_MINUTE;return w(e.dayNumber,a,r)};I.addHours=function(e,t,r){if(!n(e)){throw new i(\"julianDate is required.\")}if(!n(t)){throw new i(\"hours is required.\")}if(!n(r)){throw new i(\"result is required.\")}var a=e.secondsOfDay+t*u.SECONDS_PER_HOUR;return w(e.dayNumber,a,r)};I.addDays=function(e,t,r){if(!n(e)){throw new i(\"julianDate is required.\")}if(!n(t)){throw new i(\"days is required.\")}if(!n(r)){throw new i(\"result is required.\")}var a=e.dayNumber+t;return w(a,e.secondsOfDay,r)};I.lessThan=function(e,t){return I.compare(e,t)<0};I.lessThanOrEquals=function(e,t){return I.compare(e,t)<=0};I.greaterThan=function(e,t){return I.compare(e,t)>0};I.greaterThanOrEquals=function(e,t){return I.compare(e,t)>=0};I.prototype.clone=function(e){return I.clone(this,e)};I.prototype.equals=function(e){return I.equals(this,e)};I.prototype.equalsEpsilon=function(e,t){return I.equalsEpsilon(this,e,t)};I.prototype.toString=function(){return I.toIso8601(this)};I.leapSeconds=[new s(new I(2441317,43210,f.TAI),10),new s(new I(2441499,43211,f.TAI),11),new s(new I(2441683,43212,f.TAI),12),new s(new I(2442048,43213,f.TAI),13),new s(new I(2442413,43214,f.TAI),14),new s(new I(2442778,43215,f.TAI),15),new s(new I(2443144,43216,f.TAI),16),new s(new I(2443509,43217,f.TAI),17),new s(new I(2443874,43218,f.TAI),18),new s(new I(2444239,43219,f.TAI),19),new s(new I(2444786,43220,f.TAI),20),new s(new I(2445151,43221,f.TAI),21),new s(new I(2445516,43222,f.TAI),22),new s(new I(2446247,43223,f.TAI),23),new s(new I(2447161,43224,f.TAI),24),new s(new I(2447892,43225,f.TAI),25),new s(new I(2448257,43226,f.TAI),26),new s(new I(2448804,43227,f.TAI),27),new s(new I(2449169,43228,f.TAI),28),new s(new I(2449534,43229,f.TAI),29),new s(new I(2450083,43230,f.TAI),30),new s(new I(2450630,43231,f.TAI),31),new s(new I(2451179,43232,f.TAI),32),new s(new I(2453736,43233,f.TAI),33),new s(new I(2454832,43234,f.TAI),34),new s(new I(2456109,43235,f.TAI),35),new s(new I(2457204,43236,f.TAI),36)];return I})})();(function(){var t=e.amdDefine;t(\"52\",[\"1f\"],function(e){\"use strict\";var t={SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5};return e(t)})})();(function(){var t=e.amdDefine;t(\"53\",[\"1f\"],function(e){\"use strict\";var t={UTC:0,TAI:1};return e(t)})})();(function(){var t=e.amdDefine;t(\"64\",[\"2c\",\"1a\",\"1c\",\"24\",\"27\",\"32\",\"52\",\"53\"],function(e,t,r,n,i,a,o,s){\"use strict\";var u={};function f(e){var t=6.239996+.0172019696544*e;return.001657*Math.sin(t+.01671*Math.sin(t))}var c=32.184;var l=2451545;function d(e,t){t=n.addSeconds(e,c,t);var r=n.totalDays(t)-l;t=n.addSeconds(t,f(r),t);return t}var h=new n(2451545,0,s.TAI);var v=398600435e6;var p=v*(1+.012300034)*328900.56;var m=1e3;var w=i.RADIANS_PER_DEGREE;var y=i.RADIANS_PER_ARCSECOND;var g=14959787e4;var S=new a;function b(n,o,s,u,f,c,l,d){if(s<0){s=-s;f+=i.PI}if(s<0||s>i.PI){throw new r(\"The inclination is out of range. Inclination must be greater than or equal to zero and less than or equal to Pi radians.\")}var h=n*(1-o);var v=u-f;var p=f;var m=_(c-u,o);var w=T(o,0);if(w===\"Hyperbolic\"&&Math.abs(i.negativePiToPi(m))>=Math.acos(-1/o)){throw new r(\"The true anomaly of the hyperbolic orbit lies outside of the bounds of the hyperbola.\")}C(v,s,p,S);var y=h*(1+o);var g=Math.cos(m);var b=Math.sin(m);var E=1+o*g;if(E<=i.Epsilon10){throw new r(\"elements cannot be converted to cartesian\")}var M=y/E;if(!t(d)){d=new e(M*g,M*b,0)}else{d.x=M*g;d.y=M*b;d.z=0}return a.multiplyByVector(S,d,d)}function T(e,t){if(e<0){throw new r(\"eccentricity cannot be negative.\")}else if(e<=t){return\"Circular\"}else if(e<1-t){return\"Elliptical\"}else if(e<=1+t){return\"Parabolic\"}else{return\"Hyperbolic\"}}function _(e,t){if(t<0||t>=1){throw new r(\"eccentricity out of range.\")}var n=P(e,t);return A(n,t)}var E=50;var M=i.EPSILON8;function P(e,t){if(t<0||t>=1){throw new r(\"eccentricity out of range.\")}var n=Math.floor(e/i.TWO_PI);e-=n*i.TWO_PI;var a=e+t*Math.sin(e)/(1-Math.sin(e+t)+Math.sin(e));var o=Number.MAX_VALUE;var s;for(s=0;s<E&&Math.abs(o-a)>M;++s){o=a;var u=o-t*Math.sin(o)-e;var f=1-t*Math.cos(o);a=o-u/f}if(s>=E){throw new r(\"Kepler equation did not converge\")}o=a+n*i.TWO_PI;return o}function A(e,t){if(t<0||t>=1){throw new r(\"eccentricity out of range.\")}var n=Math.floor(e/i.TWO_PI);e-=n*i.TWO_PI;var a=Math.cos(e)-t;var o=Math.sin(e)*Math.sqrt(1-t*t);var s=Math.atan2(o,a);s=i.zeroToTwoPi(s);if(e<0){s-=i.TWO_PI}s+=n*i.TWO_PI;return s}function C(e,n,o,s){if(n<0||n>i.PI){throw new r(\"inclination out of range\")}var u=Math.cos(e);var f=Math.sin(e);var c=Math.cos(n);var l=Math.sin(n);var d=Math.cos(o);var h=Math.sin(o);if(!t(s)){s=new a(d*u-h*f*c,-d*f-h*u*c,h*l,h*u+d*f*c,-h*f+d*u*c,-d*l,f*l,u*l,c)}else{s[0]=d*u-h*f*c;s[1]=h*u+d*f*c;s[2]=f*l;s[3]=-d*f-h*u*c;s[4]=-h*f+d*u*c;s[5]=u*l;s[6]=h*l;s[7]=-d*l;s[8]=c}return s}var I=1.0000010178*g;var x=100.46645683*w;var R=1295977422.83429*y;var O=16002;var D=21863;var q=32004;var N=10931;var G=14529;var L=16368;var B=15318;var H=32794;var k=64*1e-7*g;var z=-152*1e-7*g;var F=62*1e-7*g;var U=-8*1e-7*g;var V=32*1e-7*g;var j=-41*1e-7*g;var W=19*1e-7*g;var X=-11*1e-7*g;var Q=-150*1e-7*g;var K=-46*1e-7*g;var Y=68*1e-7*g;var Z=54*1e-7*g;var J=14*1e-7*g;var $=24*1e-7*g;var ee=-28*1e-7*g;var te=22*1e-7*g;var re=10;var ne=16002;var ie=21863;var ae=10931;var oe=1473;var se=32004;var ue=4387;var fe=73;var ce=-325*1e-7;var le=-322*1e-7;var de=-79*1e-7;var he=232*1e-7;var ve=-52*1e-7;var pe=97*1e-7;var me=55*1e-7;var we=-41*1e-7;var ye=-105*1e-7;var ge=-137*1e-7;var Se=258*1e-7;var be=35*1e-7;var Te=-116*1e-7;var _e=-88*1e-7;var Ee=-112*1e-7;var Me=-80*1e-7;var Pe=new n(0,0,s.TAI);function Ae(e,t){d(e,Pe);var r=Pe.dayNumber-h.dayNumber+(Pe.secondsOfDay-h.secondsOfDay)/o.SECONDS_PER_DAY;var n=r/(o.DAYS_PER_JULIAN_CENTURY*10);var i=.3595362*n;var a=I+k*Math.cos(O*i)+Q*Math.sin(O*i)+z*Math.cos(D*i)+K*Math.sin(D*i)+F*Math.cos(q*i)+Y*Math.sin(q*i)+U*Math.cos(N*i)+Z*Math.sin(N*i)+V*Math.cos(G*i)+J*Math.sin(G*i)+j*Math.cos(L*i)+$*Math.sin(L*i)+W*Math.cos(B*i)+ee*Math.sin(B*i)+X*Math.cos(H*i)+te*Math.sin(H*i);var s=x+R*n+ce*Math.cos(re*i)+ye*Math.sin(re*i)+le*Math.cos(ne*i)+ge*Math.sin(ne*i)+de*Math.cos(ie*i)+Se*Math.sin(ie*i)+he*Math.cos(ae*i)+be*Math.sin(ae*i)+ve*Math.cos(oe*i)+Te*Math.sin(oe*i)+pe*Math.cos(se*i)+_e*Math.sin(se*i)+me*Math.cos(ue*i)+Ee*Math.sin(ue*i)+we*Math.cos(fe*i)+Me*Math.sin(fe*i);var u=.0167086342-.0004203654*n;var f=102.93734808*w+11612.3529*y*n;var c=469.97289*y*n;var l=174.87317577*w-8679.27034*y*n;return b(a,u,c,f,l,s,p,t)}function Ce(e,t){d(e,Pe);var r=Pe.dayNumber-h.dayNumber+(Pe.secondsOfDay-h.secondsOfDay)/o.SECONDS_PER_DAY;var n=r/o.DAYS_PER_JULIAN_CENTURY;var i=n*n;var a=i*n;var s=a*n;var u=383397.7725+.004*n;var f=.055545526-1.6e-8*n;var c=5.15668983*w;var l=-8e-5*n+.02966*i-42e-6*a-1.3e-7*s;var p=83.35324312*w;var g=14643420.2669*n-38.2702*i-.045047*a+21301e-8*s;var S=125.04455501*w;var T=-6967919.3631*n+6.3602*i+.007625*a-3586e-8*s;var _=218.31664563*w;var E=1732559343.4847*n-6.391*i+.006588*a-3169e-8*s;var M=297.85019547*w+y*(1602961601.209*n-6.3706*i+.006593*a-3169e-8*s);var P=93.27209062*w+y*(1739527262.8478*n-12.7512*i-.001037*a+417e-8*s);var A=134.96340251*w+y*(1717915923.2178*n+31.8792*i+.051635*a-2447e-7*s);var C=357.52910918*w+y*(129596581.0481*n-.5532*i+136e-6*a-1149e-8*s);var I=310.17137918*w-y*(6967051.436*n+6.2068*i+.007618*a-3219e-8*s);var x=2*M;var R=4*M;var O=6*M;var D=2*A;var q=3*A;var N=4*A;var G=2*P;u+=3400.4*Math.cos(x)-635.6*Math.cos(x-A)-235.6*Math.cos(A)+218.1*Math.cos(x-C)+181*Math.cos(x+A);f+=.014216*Math.cos(x-A)+.008551*Math.cos(x-D)-.001383*Math.cos(A)+.001356*Math.cos(x+A)-.001147*Math.cos(R-q)-914e-6*Math.cos(R-D)+869e-6*Math.cos(x-C-A)-627e-6*Math.cos(x)-394e-6*Math.cos(R-N)+282e-6*Math.cos(x-C-D)-279e-6*Math.cos(M-A)-236e-6*Math.cos(D)+231e-6*Math.cos(R)+229e-6*Math.cos(O-N)-201e-6*Math.cos(D-G);l+=486.26*Math.cos(x-G)-40.13*Math.cos(x)+37.51*Math.cos(G)+25.73*Math.cos(D-G)+19.97*Math.cos(x-C-G);g+=-55609*Math.sin(x-A)-34711*Math.sin(x-D)-9792*Math.sin(A)+9385*Math.sin(R-q)+7505*Math.sin(R-D)+5318*Math.sin(x+A)+3484*Math.sin(R-N)-3417*Math.sin(x-C-A)-2530*Math.sin(O-N)-2376*Math.sin(x)-2075*Math.sin(x-q)-1883*Math.sin(D)-1736*Math.sin(O-5*A)+1626*Math.sin(C)-1370*Math.sin(O-q);T+=-5392*Math.sin(x-G)-540*Math.sin(C)-441*Math.sin(x)+423*Math.sin(G)-288*Math.sin(D-G);E+=-3332.9*Math.sin(x)+1197.4*Math.sin(x-A)-662.5*Math.sin(C)+396.3*Math.sin(A)-218*Math.sin(x-C);var L=2*I;var B=3*I;l+=46.997*Math.cos(I)*n-.614*Math.cos(x-G+I)*n+.614*Math.cos(x-G-I)*n-.0297*Math.cos(L)*i-.0335*Math.cos(I)*i+.0012*Math.cos(x-G+L)*i-16e-5*Math.cos(I)*a+4e-5*Math.cos(B)*a+4e-5*Math.cos(L)*a;var H=2.116*Math.sin(I)*n-.111*Math.sin(x-G-I)*n-.0015*Math.sin(I)*i;g+=H;E+=H;T+=-520.77*Math.sin(I)*n+13.66*Math.sin(x-G+I)*n+1.12*Math.sin(x-I)*n-1.06*Math.sin(G-I)*n+.66*Math.sin(L)*i+.371*Math.sin(I)*i-.035*Math.sin(x-G+L)*i-.015*Math.sin(x-G+I)*i+.0014*Math.sin(I)*a-.0011*Math.sin(B)*a-9e-4*Math.sin(L)*a;u*=m;var k=c+l*y;var z=p+g*y;var F=_+E*y;var U=S+T*y;return b(u,f,k,z,U,F,v,t)}var Ie=.012300034;var xe=Ie/(Ie+1)*-1;function Re(t,r){r=Ce(t,r);return e.multiplyByScalar(r,xe,r)}var Oe=new a(1.0000000000000002,5.619723173785822e-16,4.690511510146299e-19,-5.154129427414611e-16,.9174820620691819,-.39777715593191376,-2.23970096136568e-16,.39777715593191376,.9174820620691819);var De=new e;u.computeSunPositionInEarthInertialFrame=function(r,i){if(!t(r)){r=n.now()}if(!t(i)){i=new e}De=Ae(r,De);i=e.negate(De,i);Re(r,De);e.subtract(i,De,i);a.multiplyByVector(Oe,i,i);return i};u.computeMoonPositionInEarthInertialFrame=function(e,r){if(!t(e)){e=n.now()}r=Ce(e,r);a.multiplyByVector(Oe,r,r);return r};return u})})();(function(){var t=e.amdDefine;t(\"3c\",[\"2c\",\"3b\",\"23\",\"1a\",\"1b\",\"1c\",\"1f\",\"27\",\"65\"],function(e,t,r,n,i,a,o,s,u){\"use strict\";function f(t,n,i,o){n=r(n,0);i=r(i,0);o=r(o,0);if(n<0||i<0||o<0){throw new a(\"All radii components must be greater than or equal to zero.\")}t._radii=new e(n,i,o);t._radiiSquared=new e(n*n,i*i,o*o);t._radiiToTheFourth=new e(n*n*n*n,i*i*i*i,o*o*o*o);t._oneOverRadii=new e(n===0?0:1/n,i===0?0:1/i,o===0?0:1/o);t._oneOverRadiiSquared=new e(n===0?0:1/(n*n),i===0?0:1/(i*i),o===0?0:1/(o*o));t._minimumRadius=Math.min(n,i,o);t._maximumRadius=Math.max(n,i,o);t._centerToleranceSquared=s.EPSILON1}function c(e,t,r){this._radii=undefined;this._radiiSquared=undefined;this._radiiToTheFourth=undefined;this._oneOverRadii=undefined;this._oneOverRadiiSquared=undefined;this._minimumRadius=undefined;this._maximumRadius=undefined;this._centerToleranceSquared=undefined;f(this,e,t,r);\n}i(c.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}});c.clone=function(t,r){if(!n(t)){return undefined}var i=t._radii;if(!n(r)){return new c(i.x,i.y,i.z)}e.clone(i,r._radii);e.clone(t._radiiSquared,r._radiiSquared);e.clone(t._radiiToTheFourth,r._radiiToTheFourth);e.clone(t._oneOverRadii,r._oneOverRadii);e.clone(t._oneOverRadiiSquared,r._oneOverRadiiSquared);r._minimumRadius=t._minimumRadius;r._maximumRadius=t._maximumRadius;r._centerToleranceSquared=t._centerToleranceSquared;return r};c.fromCartesian3=function(e,t){if(!n(t)){t=new c}if(!n(e)){return t}f(t,e.x,e.y,e.z);return t};c.WGS84=o(new c(6378137,6378137,6356752.314245179));c.UNIT_SPHERE=o(new c(1,1,1));c.MOON=o(new c(s.LUNAR_RADIUS,s.LUNAR_RADIUS,s.LUNAR_RADIUS));c.prototype.clone=function(e){return c.clone(this,e)};c.packedLength=e.packedLength;c.pack=function(t,i,o){if(!n(t)){throw new a(\"value is required\")}if(!n(i)){throw new a(\"array is required\")}o=r(o,0);e.pack(t._radii,i,o)};c.unpack=function(t,i,o){if(!n(t)){throw new a(\"array is required\")}i=r(i,0);var s=e.unpack(t,i);return c.fromCartesian3(s,o)};c.prototype.geocentricSurfaceNormal=e.normalize;c.prototype.geodeticSurfaceNormalCartographic=function(t,r){if(!n(t)){throw new a(\"cartographic is required.\")}var i=t.longitude;var o=t.latitude;var s=Math.cos(o);var u=s*Math.cos(i);var f=s*Math.sin(i);var c=Math.sin(o);if(!n(r)){r=new e}r.x=u;r.y=f;r.z=c;return e.normalize(r,r)};c.prototype.geodeticSurfaceNormal=function(t,r){if(!n(r)){r=new e}r=e.multiplyComponents(t,this._oneOverRadiiSquared,r);return e.normalize(r,r)};var l=new e;var d=new e;c.prototype.cartographicToCartesian=function(t,r){var i=l;var a=d;this.geodeticSurfaceNormalCartographic(t,i);e.multiplyComponents(this._radiiSquared,i,a);var o=Math.sqrt(e.dot(i,a));e.divideByScalar(a,o,a);e.multiplyByScalar(i,t.height,i);if(!n(r)){r=new e}return e.add(a,i,r)};c.prototype.cartographicArrayToCartesianArray=function(e,t){if(!n(e)){throw new a(\"cartographics is required.\")}var r=e.length;if(!n(t)){t=new Array(r)}else{t.length=r}for(var i=0;i<r;i++){t[i]=this.cartographicToCartesian(e[i],t[i])}return t};var h=new e;var v=new e;var p=new e;c.prototype.cartesianToCartographic=function(r,i){var a=this.scaleToGeodeticSurface(r,v);if(!n(a)){return undefined}var o=this.geodeticSurfaceNormal(a,h);var u=e.subtract(r,a,p);var f=Math.atan2(o.y,o.x);var c=Math.asin(o.z);var l=s.sign(e.dot(u,r))*e.magnitude(u);if(!n(i)){return new t(f,c,l)}i.longitude=f;i.latitude=c;i.height=l;return i};c.prototype.cartesianArrayToCartographicArray=function(e,t){if(!n(e)){throw new a(\"cartesians is required.\")}var r=e.length;if(!n(t)){t=new Array(r)}else{t.length=r}for(var i=0;i<r;++i){t[i]=this.cartesianToCartographic(e[i],t[i])}return t};c.prototype.scaleToGeodeticSurface=function(e,t){return u(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)};c.prototype.scaleToGeocentricSurface=function(t,r){if(!n(t)){throw new a(\"cartesian is required.\")}if(!n(r)){r=new e}var i=t.x;var o=t.y;var s=t.z;var u=this._oneOverRadiiSquared;var f=1/Math.sqrt(i*i*u.x+o*o*u.y+s*s*u.z);return e.multiplyByScalar(t,f,r)};c.prototype.transformPositionToScaledSpace=function(t,r){if(!n(r)){r=new e}return e.multiplyComponents(t,this._oneOverRadii,r)};c.prototype.transformPositionFromScaledSpace=function(t,r){if(!n(r)){r=new e}return e.multiplyComponents(t,this._radii,r)};c.prototype.equals=function(t){return this===t||n(t)&&e.equals(this._radii,t._radii)};c.prototype.toString=function(){return this._radii.toString()};return c})})();(function(){var t=e.amdDefine;t(\"66\",[\"2c\",\"3b\",\"23\",\"1a\",\"1b\",\"1c\",\"3c\",\"27\"],function(e,t,r,n,i,a,o,s){\"use strict\";function u(e){var t=e._uSquared;var r=e._ellipsoid.maximumRadius;var n=e._ellipsoid.minimumRadius;var i=(r-n)/r;var a=Math.cos(e._startHeading);var o=Math.sin(e._startHeading);var s=(1-i)*Math.tan(e._start.latitude);var u=1/Math.sqrt(1+s*s);var f=u*s;var c=Math.atan2(s,a);var l=u*o;var d=l*l;var h=1-d;var v=Math.sqrt(h);var p=t/4;var m=p*p;var w=m*p;var y=m*m;var g=1+p-3*m/4+5*w/4-175*y/64;var S=1-p+15*m/8-35*w/8;var b=1-3*p+35*m/4;var T=1-5*p;var _=g*c-S*Math.sin(2*c)*p/2-b*Math.sin(4*c)*m/16-T*Math.sin(6*c)*w/48-Math.sin(8*c)*5*y/512;var E=e._constants;E.a=r;E.b=n;E.f=i;E.cosineHeading=a;E.sineHeading=o;E.tanU=s;E.cosineU=u;E.sineU=f;E.sigma=c;E.sineAlpha=l;E.sineSquaredAlpha=d;E.cosineSquaredAlpha=h;E.cosineAlpha=v;E.u2Over4=p;E.u4Over16=m;E.u6Over64=w;E.u8Over256=y;E.a0=g;E.a1=S;E.a2=b;E.a3=T;E.distanceRatio=_}function f(e,t){return e*t*(4+e*(4-3*t))/16}function c(e,t,r,n,i,a,o){var s=f(e,r);return(1-s)*e*t*(n+s*i*(o+s*a*(2*o*o-1)))}function l(e,t,r,n,i,a,o){var u=(t-r)/t;var f=a-n;var l=Math.atan((1-u)*Math.tan(i));var d=Math.atan((1-u)*Math.tan(o));var h=Math.cos(l);var v=Math.sin(l);var p=Math.cos(d);var m=Math.sin(d);var w=h*p;var y=h*m;var g=v*m;var S=v*p;var b=f;var T=s.TWO_PI;var _=Math.cos(b);var E=Math.sin(b);var M;var P;var A;var C;var I;do{_=Math.cos(b);E=Math.sin(b);var x=y-S*_;A=Math.sqrt(p*p*E*E+x*x);P=g+w*_;M=Math.atan2(A,P);var R;if(A===0){R=0;C=1}else{R=w*E/A;C=1-R*R}T=b;I=P-2*g/C;if(isNaN(I)){I=0}b=f+c(u,R,C,M,A,P,I)}while(Math.abs(b-T)>s.EPSILON12);var O=C*(t*t-r*r)/(r*r);var D=1+O*(4096+O*(O*(320-175*O)-768))/16384;var q=O*(256+O*(O*(74-47*O)-128))/1024;var N=I*I;var G=q*A*(I+q*(P*(2*N-1)-q*I*(4*A*A-3)*(4*N-3)/6)/4);var L=r*D*(M-G);var B=Math.atan2(p*E,y-S*_);var H=Math.atan2(h*E,y*_-S);e._distance=L;e._startHeading=B;e._endHeading=H;e._uSquared=O}function d(r,n,i,o){var s=e.normalize(o.cartographicToCartesian(n,v),h);var f=e.normalize(o.cartographicToCartesian(i,v),v);if(Math.abs(Math.abs(e.angleBetween(s,f))-Math.PI)<.0125){throw new a(\"geodesic position is not unique\")}l(r,o.maximumRadius,o.minimumRadius,n.longitude,n.latitude,i.longitude,i.latitude);r._start=t.clone(n,r._start);r._end=t.clone(i,r._end);r._start.height=0;r._end.height=0;u(r)}var h=new e;var v=new e;function p(e,i,a){var s=r(a,o.WGS84);this._ellipsoid=s;this._start=new t;this._end=new t;this._constants={};this._startHeading=undefined;this._endHeading=undefined;this._distance=undefined;this._uSquared=undefined;if(n(e)&&n(i)){d(this,e,i,s)}}i(p.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){if(!n(this._distance)){throw new a(\"set end positions before getting surfaceDistance\")}return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){if(!n(this._distance)){throw new a(\"set end positions before getting startHeading\")}return this._startHeading}},endHeading:{get:function(){if(!n(this._distance)){throw new a(\"set end positions before getting endHeading\")}return this._endHeading}}});p.prototype.setEndPoints=function(e,t){if(!n(e)){throw new a(\"start cartographic position is required\")}if(!n(t)){throw new a(\"end cartgraphic position is required\")}d(this,e,t,this._ellipsoid)};p.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)};p.prototype.interpolateUsingSurfaceDistance=function(e,r){if(!n(this._distance)){throw new a(\"start and end must be set before calling funciton interpolateUsingSurfaceDistance\")}var i=this._constants;var o=i.distanceRatio+e/i.b;var s=Math.cos(2*o);var u=Math.cos(4*o);var f=Math.cos(6*o);var l=Math.sin(2*o);var d=Math.sin(4*o);var h=Math.sin(6*o);var v=Math.sin(8*o);var p=o*o;var m=o*p;var w=i.u8Over256;var y=i.u2Over4;var g=i.u6Over64;var S=i.u4Over16;var b=2*m*w*s/3+o*(1-y+7*S/4-15*g/4+579*w/64-(S-15*g/4+187*w/16)*s-(5*g/4-115*w/16)*u-29*w*f/16)+(y/2-S+71*g/32-85*w/16)*l+(5*S/16-5*g/4+383*w/96)*d-p*((g-11*w/2)*l+5*w*d/2)+(29*g/96-29*w/16)*h+539*w*v/1536;var T=Math.asin(Math.sin(b)*i.cosineAlpha);var _=Math.atan(i.a/i.b*Math.tan(T));b=b-i.sigma;var E=Math.cos(2*i.sigma+b);var M=Math.sin(b);var P=Math.cos(b);var A=i.cosineU*P;var C=i.sineU*M;var I=Math.atan2(M*i.sineHeading,A-C*i.cosineHeading);var x=I-c(i.f,i.sineAlpha,i.cosineSquaredAlpha,b,M,P,E);if(n(r)){r.longitude=this._start.longitude+x;r.latitude=_;r.height=0;return r}return new t(this._start.longitude+x,_,0)};return p})})();(function(){var t=e.amdDefine;t(\"65\",[\"2c\",\"1a\",\"1c\",\"27\"],function(e,t,r,n){\"use strict\";var i=new e;var a=new e;function o(o,s,u,f,c){if(!t(o)){throw new r(\"cartesian is required.\")}if(!t(s)){throw new r(\"oneOverRadii is required.\")}if(!t(u)){throw new r(\"oneOverRadiiSquared is required.\")}if(!t(f)){throw new r(\"centerToleranceSquared is required.\")}var l=o.x;var d=o.y;var h=o.z;var v=s.x;var p=s.y;var m=s.z;var w=l*l*v*v;var y=d*d*p*p;var g=h*h*m*m;var S=w+y+g;var b=Math.sqrt(1/S);var T=e.multiplyByScalar(o,b,i);if(S<f){return!isFinite(b)?undefined:e.clone(T,c)}var _=u.x;var E=u.y;var M=u.z;var P=a;P.x=T.x*_*2;P.y=T.y*E*2;P.z=T.z*M*2;var A=(1-b)*e.magnitude(o)/(.5*e.magnitude(P));var C=0;var I;var x;var R;var O;var D;var q;var N;var G;var L;var B;var H;do{A-=C;R=1/(1+A*_);O=1/(1+A*E);D=1/(1+A*M);q=R*R;N=O*O;G=D*D;L=q*R;B=N*O;H=G*D;I=w*q+y*N+g*G-1;x=w*L*_+y*B*E+g*H*M;var k=-2*x;C=I/k}while(Math.abs(I)>n.EPSILON12);if(!t(c)){return new e(l*R,d*O,h*D)}c.x=l*R;c.y=d*O;c.z=h*D;return c}return o})})();(function(){var t=e.amdDefine;t(\"3b\",[\"2c\",\"23\",\"1a\",\"1c\",\"1f\",\"27\",\"65\"],function(e,t,r,n,i,a,o){\"use strict\";function s(e,r,n){this.longitude=t(e,0);this.latitude=t(r,0);this.height=t(n,0)}s.fromRadians=function(e,i,a,o){if(!r(e)){throw new n(\"longitude is required.\")}if(!r(i)){throw new n(\"latitude is required.\")}a=t(a,0);if(!r(o)){return new s(e,i,a)}o.longitude=e;o.latitude=i;o.height=a;return o};s.fromDegrees=function(e,t,i,o){if(!r(e)){throw new n(\"longitude is required.\")}if(!r(t)){throw new n(\"latitude is required.\")}e=a.toRadians(e);t=a.toRadians(t);return s.fromRadians(e,t,i,o)};var u=new e;var f=new e;var c=new e;var l=new e(1/6378137,1/6378137,1/6356752.314245179);var d=new e(1/(6378137*6378137),1/(6378137*6378137),1/(6356752.314245179*6356752.314245179));var h=a.EPSILON1;s.fromCartesian=function(t,n,i){var v=r(n)?n.oneOverRadii:l;var p=r(n)?n.oneOverRadiiSquared:d;var m=r(n)?n._centerToleranceSquared:h;var w=o(t,v,p,m,f);if(!r(w)){return undefined}var y=e.multiplyComponents(t,p,u);y=e.normalize(y,y);var g=e.subtract(t,w,c);var S=Math.atan2(y.y,y.x);var b=Math.asin(y.z);var T=a.sign(e.dot(g,t))*e.magnitude(g);if(!r(i)){return new s(S,b,T)}i.longitude=S;i.latitude=b;i.height=T;return i};s.clone=function(e,t){if(!r(e)){return undefined}if(!r(t)){return new s(e.longitude,e.latitude,e.height)}t.longitude=e.longitude;t.latitude=e.latitude;t.height=e.height;return t};s.equals=function(e,t){return e===t||r(e)&&r(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height};s.equalsEpsilon=function(e,t,i){if(typeof i!==\"number\"){throw new n(\"epsilon is required and must be a number.\")}return e===t||r(e)&&r(t)&&Math.abs(e.longitude-t.longitude)<=i&&Math.abs(e.latitude-t.latitude)<=i&&Math.abs(e.height-t.height)<=i};s.ZERO=i(new s(0,0,0));s.prototype.clone=function(e){return s.clone(this,e)};s.prototype.equals=function(e){return s.equals(this,e)};s.prototype.equalsEpsilon=function(e,t){return s.equalsEpsilon(this,e,t)};s.prototype.toString=function(){return\"(\"+this.longitude+\", \"+this.latitude+\", \"+this.height+\")\"};return s})})();(function(){var t=e.amdDefine;t(\"67\",[\"1c\",\"68\"],function(e,t){\"use strict\";var r={};r.computeDiscriminant=function(t,r,n,i){if(typeof t!==\"number\"){throw new e(\"a is a required number.\")}if(typeof r!==\"number\"){throw new e(\"b is a required number.\")}if(typeof n!==\"number\"){throw new e(\"c is a required number.\")}if(typeof i!==\"number\"){throw new e(\"d is a required number.\")}var a=t*t;var o=r*r;var s=n*n;var u=i*i;var f=18*t*r*n*i+o*s-27*a*u-4*(t*s*n+o*r*i);return f};function n(e,t,r,n){var i=e;var a=t/3;var o=r/3;var s=n;var u=i*o;var f=a*s;var c=a*a;var l=o*o;var d=i*o-c;var h=i*s-a*o;var v=a*s-l;var p=4*d*v-h*h;var m;var w;if(p<0){var y;var g;var S;if(c*f>=u*l){y=i;g=d;S=-2*a*d+i*h}else{y=s;g=v;S=-s*h+2*o*v}var b=S<0?-1:1;var T=-b*Math.abs(y)*Math.sqrt(-p);w=-S+T;var _=w/2;var E=_<0?-Math.pow(-_,1/3):Math.pow(_,1/3);var M=w===T?-E:-g/E;m=g<=0?E+M:-S/(E*E+M*M+g);if(c*f>=u*l){return[(m-a)/i]}return[-s/(m+o)]}var P=d;var A=-2*a*d+i*h;var C=v;var I=-s*h+2*o*v;var x=Math.sqrt(p);var R=Math.sqrt(3)/2;var O=Math.abs(Math.atan2(i*x,-A)/3);m=2*Math.sqrt(-P);var D=Math.cos(O);w=m*D;var q=m*(-D/2-R*Math.sin(O));var N=w+q>2*a?w-a:q-a;var G=i;var L=N/G;O=Math.abs(Math.atan2(s*x,-I)/3);m=2*Math.sqrt(-C);D=Math.cos(O);w=m*D;q=m*(-D/2-R*Math.sin(O));var B=-s;var H=w+q<2*o?w+o:q+o;var k=B/H;var z=G*H;var F=-N*H-G*B;var U=N*B;var V=(o*F-a*U)/(-a*F+o*z);if(L<=V){if(L<=k){if(V<=k){return[L,V,k]}return[L,k,V]}return[k,L,V]}if(L<=k){return[V,L,k]}if(V<=k){return[V,k,L]}return[k,V,L]}r.computeRealRoots=function(r,i,a,o){if(typeof r!==\"number\"){throw new e(\"a is a required number.\")}if(typeof i!==\"number\"){throw new e(\"b is a required number.\")}if(typeof a!==\"number\"){throw new e(\"c is a required number.\")}if(typeof o!==\"number\"){throw new e(\"d is a required number.\")}var s;var u;if(r===0){return t.computeRealRoots(i,a,o)}else if(i===0){if(a===0){if(o===0){return[0,0,0]}u=-o/r;var f=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3);return[f,f,f]}else if(o===0){s=t.computeRealRoots(r,0,a);if(s.Length===0){return[0]}return[s[0],0,s[1]]}return n(r,0,a,o)}else if(a===0){if(o===0){u=-i/r;if(u<0){return[u,0,0]}return[0,0,u]}return n(r,i,0,o)}else if(o===0){s=t.computeRealRoots(r,i,a);if(s.length===0){return[0]}else if(s[1]<=0){return[s[0],s[1],0]}else if(s[0]>=0){return[0,s[0],s[1]]}return[s[0],0,s[1]]}return n(r,i,a,o)};return r})})();(function(){var t=e.amdDefine;t(\"68\",[\"1c\",\"27\"],function(e,t){\"use strict\";var r={};r.computeDiscriminant=function(t,r,n){if(typeof t!==\"number\"){throw new e(\"a is a required number.\")}if(typeof r!==\"number\"){throw new e(\"b is a required number.\")}if(typeof n!==\"number\"){throw new e(\"c is a required number.\")}var i=r*r-4*t*n;return i};function n(e,r,n){var i=e+r;if(t.sign(e)!==t.sign(r)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(r)))<n){return 0}return i}r.computeRealRoots=function(r,i,a){if(typeof r!==\"number\"){throw new e(\"a is a required number.\")}if(typeof i!==\"number\"){throw new e(\"b is a required number.\")}if(typeof a!==\"number\"){throw new e(\"c is a required number.\")}var o;if(r===0){if(i===0){return[]}return[-a/i]}else if(i===0){if(a===0){return[0,0]}var s=Math.abs(a);var u=Math.abs(r);if(s<u&&s/u<t.EPSILON14){return[0,0]}else if(s>u&&u/s<t.EPSILON14){return[]}o=-a/r;if(o<0){return[]}var f=Math.sqrt(o);return[-f,f]}else if(a===0){o=-i/r;if(o<0){return[o,0]}return[0,o]}var c=i*i;var l=4*r*a;var d=n(c,-l,t.EPSILON14);if(d<0){return[]}var h=-.5*n(i,t.sign(i)*Math.sqrt(d),t.EPSILON14);if(i>0){return[h/r,a/h]}return[a/h,h/r]};return r})})();(function(){var t=e.amdDefine;t(\"69\",[\"67\",\"1c\",\"27\",\"68\"],function(e,t,r,n){\"use strict\";var i={};i.computeDiscriminant=function(e,r,n,i,a){if(typeof e!==\"number\"){throw new t(\"a is a required number.\")}if(typeof r!==\"number\"){throw new t(\"b is a required number.\")}if(typeof n!==\"number\"){throw new t(\"c is a required number.\")}if(typeof i!==\"number\"){throw new t(\"d is a required number.\")}if(typeof a!==\"number\"){throw new t(\"e is a required number.\")}var o=e*e;var s=o*e;var u=r*r;var f=u*r;var c=n*n;var l=c*n;var d=i*i;var h=d*i;var v=a*a;var p=v*a;var m=u*c*d-4*f*h-4*e*l*d+18*e*r*n*h-27*o*d*d+256*s*p+a*(18*f*n*i-4*u*l+16*e*c*c-80*e*r*c*i-6*e*u*d+144*o*n*d)+v*(144*e*u*n-27*u*u-128*o*c-192*o*r*i);return m};function a(t,i,a,o){var s=t*t;var u=i-3*s/8;var f=a-i*t/2+s*t/8;var c=o-a*t/4+i*s/16-3*s*s/256;var l=e.computeRealRoots(1,2*u,u*u-4*c,-f*f);if(l.length>0){var d=-t/4;var h=l[l.length-1];if(Math.abs(h)<r.EPSILON14){var v=n.computeRealRoots(1,u,c);if(v.length===2){var p=v[0];var m=v[1];var w;if(p>=0&&m>=0){var y=Math.sqrt(p);var g=Math.sqrt(m);return[d-g,d-y,d+y,d+g]}else if(p>=0&&m<0){w=Math.sqrt(p);return[d-w,d+w]}else if(p<0&&m>=0){w=Math.sqrt(m);return[d-w,d+w]}}return[]}else if(h>0){var S=Math.sqrt(h);var b=(u+h-f/S)/2;var T=(u+h+f/S)/2;var _=n.computeRealRoots(1,S,b);var E=n.computeRealRoots(1,-S,T);if(_.length!==0){_[0]+=d;_[1]+=d;if(E.length!==0){E[0]+=d;E[1]+=d;if(_[1]<=E[0]){return[_[0],_[1],E[0],E[1]]}else if(E[1]<=_[0]){return[E[0],E[1],_[0],_[1]]}else if(_[0]>=E[0]&&_[1]<=E[1]){return[E[0],_[0],_[1],E[1]]}else if(E[0]>=_[0]&&E[1]<=_[1]){return[_[0],E[0],E[1],_[1]]}else if(_[0]>E[0]&&_[0]<E[1]){return[E[0],_[0],E[1],_[1]]}return[_[0],E[0],_[1],E[1]]}return _}if(E.length!==0){E[0]+=d;E[1]+=d;return E}return[]}}return[]}function o(t,i,a,o){var s=a*a;var u=i*i;var f=t*t;var c=-2*i;var l=a*t+u-4*o;var d=f*o-a*i*t+s;var h=e.computeRealRoots(1,c,l,d);if(h.length>0){var v=h[0];var p=i-v;var m=p*p;var w=t/2;var y=p/2;var g=m-4*o;var S=m+4*Math.abs(o);var b=f-4*v;var T=f+4*Math.abs(v);var _;var E;if(v<0||g*T<b*S){var M=Math.sqrt(b);_=M/2;E=M===0?0:(t*y-a)/M}else{var P=Math.sqrt(g);_=P===0?0:(t*y-a)/P;E=P/2}var A;var C;if(w===0&&_===0){A=0;C=0}else if(r.sign(w)===r.sign(_)){A=w+_;C=v/A}else{C=w-_;A=v/C}var I;var x;if(y===0&&E===0){I=0;x=0}else if(r.sign(y)===r.sign(E)){I=y+E;x=o/I}else{x=y-E;I=o/x}var R=n.computeRealRoots(1,A,I);var O=n.computeRealRoots(1,C,x);if(R.length!==0){if(O.length!==0){if(R[1]<=O[0]){return[R[0],R[1],O[0],O[1]]}else if(O[1]<=R[0]){return[O[0],O[1],R[0],R[1]]}else if(R[0]>=O[0]&&R[1]<=O[1]){return[O[0],R[0],R[1],O[1]]}else if(O[0]>=R[0]&&O[1]<=R[1]){return[R[0],O[0],O[1],R[1]]}else if(R[0]>O[0]&&R[0]<O[1]){return[O[0],R[0],O[1],R[1]]}else{return[R[0],O[0],R[1],O[1]]}}return R}if(O.length!==0){return O}}return[]}i.computeRealRoots=function(n,i,s,u,f){if(typeof n!==\"number\"){throw new t(\"a is a required number.\")}if(typeof i!==\"number\"){throw new t(\"b is a required number.\")}if(typeof s!==\"number\"){throw new t(\"c is a required number.\")}if(typeof u!==\"number\"){throw new t(\"d is a required number.\")}if(typeof f!==\"number\"){throw new t(\"e is a required number.\")}if(Math.abs(n)<r.EPSILON15){return e.computeRealRoots(i,s,u,f)}var c=i/n;var l=s/n;var d=u/n;var h=f/n;var v=c<0?1:0;v+=l<0?v+1:v;v+=d<0?v+1:v;v+=h<0?v+1:v;switch(v){case 0:return a(c,l,d,h);case 1:return o(c,l,d,h);case 2:return o(c,l,d,h);case 3:return a(c,l,d,h);case 4:return a(c,l,d,h);case 5:return o(c,l,d,h);case 6:return a(c,l,d,h);case 7:return a(c,l,d,h);case 8:return o(c,l,d,h);case 9:return a(c,l,d,h);case 10:return a(c,l,d,h);case 11:return o(c,l,d,h);case 12:return a(c,l,d,h);case 13:return a(c,l,d,h);case 14:return a(c,l,d,h);case 15:return a(c,l,d,h);default:return undefined}};return i})})();(function(){var t=e.amdDefine;t(\"6a\",[\"2c\",\"23\",\"1a\",\"1c\"],function(e,t,r,n){\"use strict\";function i(r,n){n=e.clone(t(n,e.ZERO));if(!e.equals(n,e.ZERO)){e.normalize(n,n)}this.origin=e.clone(t(r,e.ZERO));this.direction=n}i.getPoint=function(t,i,a){if(!r(t)){throw new n(\"ray is requred\")}if(typeof i!==\"number\"){throw new n(\"t is a required number\")}if(!r(a)){a=new e}a=e.multiplyByScalar(t.direction,i,a);return e.add(t.origin,a,a)};return i})})();(function(){var t=e.amdDefine;t(\"6b\",[\"2c\",\"3b\",\"23\",\"1a\",\"1c\",\"27\",\"32\",\"68\",\"69\",\"6a\"],function(e,t,r,n,i,a,o,s,u,f){\"use strict\";var c={};c.rayPlane=function(t,r,o){if(!n(t)){throw new i(\"ray is required.\")}if(!n(r)){throw new i(\"plane is required.\")}if(!n(o)){o=new e}var s=t.origin;var u=t.direction;var f=r.normal;var c=e.dot(f,u);if(Math.abs(c)<a.EPSILON15){return undefined}var l=(-r.distance-e.dot(f,s))/c;if(l<0){return undefined}o=e.multiplyByScalar(u,l,o);return e.add(s,o,o)};var l=new e;var d=new e;var h=new e;var v=new e;var p=new e;function m(t,o,s,u,f){if(!n(t)){throw new i(\"ray is required.\")}if(!n(o)){throw new i(\"p0 is required.\")}if(!n(s)){throw new i(\"p1 is required.\")}if(!n(u)){throw new i(\"p2 is required.\")}f=r(f,false);var c=t.origin;var m=t.direction;var w=e.subtract(s,o,l);var y=e.subtract(u,o,d);var g=e.cross(m,y,h);var S=e.dot(w,g);var b;var T;var _;var E;var M;if(f){if(S<a.EPSILON6){return undefined}b=e.subtract(c,o,v);_=e.dot(b,g);if(_<0||_>S){return undefined}T=e.cross(b,w,p);E=e.dot(m,T);if(E<0||_+E>S){return undefined}M=e.dot(y,T)/S}else{if(Math.abs(S)<a.EPSILON6){return undefined}var P=1/S;b=e.subtract(c,o,v);_=e.dot(b,g)*P;if(_<0||_>1){return undefined}T=e.cross(b,w,p);E=e.dot(m,T)*P;if(E<0||_+E>1){return undefined}M=e.dot(y,T)*P}return M}c.rayTriangle=function(t,r,i,a,o,s){var u=m(t,r,i,a,o);if(!n(u)||u<0){return undefined}if(!n(s)){s=new e}e.multiplyByScalar(t.direction,u,s);return e.add(t.origin,s,s)};var w=new f;c.lineSegmentTriangle=function(t,r,a,o,s,u,f){if(!n(t)){throw new i(\"v0 is required.\")}if(!n(r)){throw new i(\"v1 is required.\")}var c=w;e.clone(t,c.origin);e.subtract(r,t,c.direction);e.normalize(c.direction,c.direction);var l=m(c,a,o,s,u);if(!n(l)||l<0||l>e.distance(t,r)){return undefined}if(!n(f)){f=new e}e.multiplyByScalar(c.direction,l,f);return e.add(c.origin,f,f)};function y(e,t,r,n){var i=t*t-4*e*r;if(i<0){return undefined}else if(i>0){var a=1/(2*e);var o=Math.sqrt(i);var s=(-t+o)*a;var u=(-t-o)*a;if(s<u){n.root0=s;n.root1=u}else{n.root0=u;n.root1=s}return n}var f=-t/(2*e);if(f===0){return undefined}n.root0=n.root1=f;return n}var g={root0:0,root1:0};function S(t,r,i){if(!n(i)){i={}}var a=t.origin;var o=t.direction;var s=r.center;var u=r.radius*r.radius;var f=e.subtract(a,s,h);var c=e.dot(o,o);var l=2*e.dot(o,f);var d=e.magnitudeSquared(f)-u;var v=y(c,l,d,g);if(!n(v)){return undefined}i.start=v.root0;i.stop=v.root1;return i}c.raySphere=function(e,t,r){if(!n(e)){throw new i(\"ray is required.\")}if(!n(t)){throw new i(\"sphere is required.\")}r=S(e,t,r);if(!n(r)||r.stop<0){return undefined}r.start=Math.max(r.start,0);return r};var b=new f;c.lineSegmentSphere=function(t,r,a,o){if(!n(t)){throw new i(\"p0 is required.\")}if(!n(r)){throw new i(\"p1 is required.\")}if(!n(a)){throw new i(\"sphere is required.\")}var s=b;e.clone(t,s.origin);var u=e.subtract(r,t,s.direction);var f=e.magnitude(u);e.normalize(u,u);o=S(s,a,o);if(!n(o)||o.stop<0||o.start>f){return undefined}o.start=Math.max(o.start,0);o.stop=Math.min(o.stop,f);return o};var T=new e;var _=new e;c.rayEllipsoid=function(t,r){if(!n(t)){throw new i(\"ray is required.\")}if(!n(r)){throw new i(\"ellipsoid is required.\")}var a=r.oneOverRadii;var o=e.multiplyComponents(a,t.origin,T);var s=e.multiplyComponents(a,t.direction,_);var u=e.magnitudeSquared(o);var f=e.dot(o,s);var c,l,d,h,v;if(u>1){if(f>=0){return undefined}var p=f*f;c=u-1;l=e.magnitudeSquared(s);d=l*c;if(p<d){return undefined}else if(p>d){h=f*f-d;v=-f+Math.sqrt(h);var m=v/l;var w=c/v;if(m<w){return{start:m,stop:w}}return{start:w,stop:m}}else{var y=Math.sqrt(c/l);return{start:y,stop:y}}}else if(u<1){c=u-1;l=e.magnitudeSquared(s);d=l*c;h=f*f-d;v=-f+Math.sqrt(h);return{start:0,stop:v/l}}else{if(f<0){l=e.magnitudeSquared(s);return{start:0,stop:-f/l}}return undefined}};function E(e,t,r){var n=e+t;if(a.sign(e)!==a.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<r){return 0}return n}function M(t,r,n,i,f){var c=i*i;var l=f*f;var d=(t[o.COLUMN1ROW1]-t[o.COLUMN2ROW2])*l;var h=f*(i*E(t[o.COLUMN1ROW0],t[o.COLUMN0ROW1],a.EPSILON15)+r.y);var v=t[o.COLUMN0ROW0]*c+t[o.COLUMN2ROW2]*l+i*r.x+n;var p=l*E(t[o.COLUMN2ROW1],t[o.COLUMN1ROW2],a.EPSILON15);var m=f*(i*E(t[o.COLUMN2ROW0],t[o.COLUMN0ROW2])+r.z);var w;var y=[];if(m===0&&p===0){w=s.computeRealRoots(d,h,v);if(w.length===0){return y}var g=w[0];var S=Math.sqrt(Math.max(1-g*g,0));y.push(new e(i,f*g,f*-S));y.push(new e(i,f*g,f*S));if(w.length===2){var b=w[1];var T=Math.sqrt(Math.max(1-b*b,0));y.push(new e(i,f*b,f*-T));y.push(new e(i,f*b,f*T))}return y}var _=m*m;var M=p*p;var P=d*d;var A=m*p;var C=P+M;var I=2*(h*d+A);var x=2*v*d+h*h-M+_;var R=2*(v*h-A);var O=v*v-_;if(C===0&&I===0&&x===0&&R===0){return y}w=u.computeRealRoots(C,I,x,R,O);var D=w.length;if(D===0){return y}for(var q=0;q<D;++q){var N=w[q];var G=N*N;var L=Math.max(1-G,0);var B=Math.sqrt(L);var H;if(a.sign(d)===a.sign(v)){H=E(d*G+v,h*N,a.EPSILON12)}else if(a.sign(v)===a.sign(h*N)){H=E(d*G,h*N+v,a.EPSILON12)}else{H=E(d*G+h*N,v,a.EPSILON12)}var k=E(p*N,m,a.EPSILON15);var z=H*k;if(z<0){y.push(new e(i,f*N,f*B))}else if(z>0){y.push(new e(i,f*N,f*-B))}else if(B!==0){y.push(new e(i,f*N,f*-B));y.push(new e(i,f*N,f*B));++q}else{y.push(new e(i,f*N,f*B))}}return y}var P=new e;var A=new e;var C=new e;var I=new e;var x=new e;var R=new o;var O=new o;var D=new o;var q=new o;var N=new o;var G=new o;var L=new o;var B=new e;var H=new e;var k=new t;c.grazingAltitudeLocation=function(t,r){if(!n(t)){throw new i(\"ray is required.\")}if(!n(r)){throw new i(\"ellipsoid is required.\")}var s=t.origin;var u=t.direction;var f=r.geodeticSurfaceNormal(s,P);if(e.dot(u,f)>=0){return s}var c=n(this.rayEllipsoid(t,r));var l=r.transformPositionToScaledSpace(u,P);var d=e.normalize(l,l);var h=e.mostOrthogonalAxis(l,I);var v=e.normalize(e.cross(h,d,A),A);var p=e.normalize(e.cross(d,v,C),C);var m=R;m[0]=d.x;m[1]=d.y;m[2]=d.z;m[3]=v.x;m[4]=v.y;m[5]=v.z;m[6]=p.x;m[7]=p.y;m[8]=p.z;var w=o.transpose(m,O);var y=o.fromScale(r.radii,D);var g=o.fromScale(r.oneOverRadii,q);var S=N;S[0]=0;S[1]=-u.z;S[2]=u.y;S[3]=u.z;S[4]=0;S[5]=-u.x;S[6]=-u.y;S[7]=u.x;S[8]=0;var b=o.multiply(o.multiply(w,g,G),S,G);var T=o.multiply(o.multiply(b,y,L),m,L);var _=o.multiplyByVector(b,s,x);var E=M(T,e.negate(_,P),0,0,1);var z;var F;var U=E.length;if(U>0){var V=e.clone(e.ZERO,H);var j=Number.NEGATIVE_INFINITY;for(var W=0;W<U;++W){z=o.multiplyByVector(y,o.multiplyByVector(m,E[W],B),B);var X=e.normalize(e.subtract(z,s,I),I);var Q=e.dot(X,u);if(Q>j){j=Q;V=e.clone(z,V)}}var K=r.cartesianToCartographic(V,k);j=a.clamp(j,0,1);F=e.magnitude(e.subtract(V,s,I))*Math.sqrt(1-j*j);F=c?-F:F;K.height=F;return r.cartographicToCartesian(K,new e)}return undefined};var z=new e;c.lineSegmentPlane=function(t,r,o,s){if(!n(t)){throw new i(\"endPoint0 is required.\")}if(!n(r)){throw new i(\"endPoint1 is required.\")}if(!n(o)){throw new i(\"plane is required.\")}if(!n(s)){s=new e}var u=e.subtract(r,t,z);var f=o.normal;var c=e.dot(f,u);if(Math.abs(c)<a.EPSILON6){return undefined}var l=e.dot(f,t);var d=-(o.distance+l)/c;if(d<0||d>1){return undefined}e.multiplyByScalar(u,d,s);e.add(t,s,s);return s};c.trianglePlaneIntersection=function(t,r,a,o){if(!n(t)||!n(r)||!n(a)||!n(o)){throw new i(\"p0, p1, p2, and plane are required.\")}var s=o.normal;var u=o.distance;var f=e.dot(s,t)+u<0;var l=e.dot(s,r)+u<0;var d=e.dot(s,a)+u<0;var h=0;h+=f?1:0;h+=l?1:0;h+=d?1:0;var v,p;if(h===1||h===2){v=new e;p=new e}if(h===1){if(f){c.lineSegmentPlane(t,r,o,v);c.lineSegmentPlane(t,a,o,p);return{positions:[t,r,a,v,p],indices:[0,3,4,1,2,4,1,4,3]}}else if(l){c.lineSegmentPlane(r,a,o,v);c.lineSegmentPlane(r,t,o,p);return{positions:[t,r,a,v,p],indices:[1,3,4,2,0,4,2,4,3]}}else if(d){c.lineSegmentPlane(a,t,o,v);c.lineSegmentPlane(a,r,o,p);return{positions:[t,r,a,v,p],indices:[2,3,4,0,1,4,0,4,3]}}}else if(h===2){if(!f){c.lineSegmentPlane(r,t,o,v);c.lineSegmentPlane(a,t,o,p);return{positions:[t,r,a,v,p],indices:[1,2,4,1,4,3,0,3,4]}}else if(!l){c.lineSegmentPlane(a,r,o,v);c.lineSegmentPlane(t,r,o,p);return{positions:[t,r,a,v,p],indices:[2,0,4,2,4,3,1,3,4]}}else if(!d){c.lineSegmentPlane(t,a,o,v);c.lineSegmentPlane(r,a,o,p);return{positions:[t,r,a,v,p],indices:[0,1,4,0,4,3,2,3,4]}}}return undefined};return c})})();(function(){var t=e.amdDefine;t(\"6c\",[\"1a\"],function(e){\"use strict\";var t=Array.isArray;if(!e(t)){t=function(e){return Object.prototype.toString.call(e)===\"[object Array]\"}}return t})})();(function(){var t=e.amdDefine;t(\"43\",[\"23\",\"1a\",\"1c\",\"1f\",\"27\"],function(e,t,r,n,i){\"use strict\";function a(t,r,n,i){this.x=e(t,0);this.y=e(r,0);this.z=e(n,0);this.w=e(i,0)}a.fromElements=function(e,r,n,i,o){if(!t(o)){return new a(e,r,n,i)}o.x=e;o.y=r;o.z=n;o.w=i;return o};a.fromColor=function(e,n){if(!t(e)){throw new r(\"color is required\")}if(!t(n)){return new a(e.red,e.green,e.blue,e.alpha)}n.x=e.red;n.y=e.green;n.z=e.blue;n.w=e.alpha;return n};a.clone=function(e,r){if(!t(e)){return undefined}if(!t(r)){return new a(e.x,e.y,e.z,e.w)}r.x=e.x;r.y=e.y;r.z=e.z;r.w=e.w;return r};a.packedLength=4;a.pack=function(n,i,a){if(!t(n)){throw new r(\"value is required\")}if(!t(i)){throw new r(\"array is required\")}a=e(a,0);i[a++]=n.x;i[a++]=n.y;i[a++]=n.z;i[a]=n.w};a.unpack=function(n,i,o){if(!t(n)){throw new r(\"array is required\")}i=e(i,0);if(!t(o)){o=new a}o.x=n[i++];o.y=n[i++];o.z=n[i++];o.w=n[i];return o};a.packArray=function(e,n){if(!t(e)){throw new r(\"array is required\")}var i=e.length;if(!t(n)){n=new Array(i*4)}else{n.length=i*4}for(var o=0;o<i;++o){a.pack(e[o],n,o*4)}return n};a.unpackArray=function(e,n){if(!t(e)){throw new r(\"array is required\")}var i=e.length;if(!t(n)){n=new Array(i/4)}else{n.length=i/4}for(var o=0;o<i;o+=4){var s=o/4;n[s]=a.unpack(e,o,n[s])}return n};a.fromArray=a.unpack;a.maximumComponent=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return Math.max(e.x,e.y,e.z,e.w)};a.minimumComponent=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return Math.min(e.x,e.y,e.z,e.w)};a.minimumByComponent=function(e,n,i){if(!t(e)){throw new r(\"first is required.\")}if(!t(n)){throw new r(\"second is required.\")}if(!t(i)){throw new r(\"result is required.\")}i.x=Math.min(e.x,n.x);i.y=Math.min(e.y,n.y);i.z=Math.min(e.z,n.z);i.w=Math.min(e.w,n.w);return i};a.maximumByComponent=function(e,n,i){if(!t(e)){throw new r(\"first is required.\")}if(!t(n)){throw new r(\"second is required.\")}if(!t(i)){throw new r(\"result is required.\")}i.x=Math.max(e.x,n.x);i.y=Math.max(e.y,n.y);i.z=Math.max(e.z,n.z);i.w=Math.max(e.w,n.w);return i};a.magnitudeSquared=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w};a.magnitude=function(e){return Math.sqrt(a.magnitudeSquared(e))};var o=new a;a.distance=function(e,n){if(!t(e)||!t(n)){throw new r(\"left and right are required.\")}a.subtract(e,n,o);return a.magnitude(o)};a.distanceSquared=function(e,n){if(!t(e)||!t(n)){throw new r(\"left and right are required.\")}a.subtract(e,n,o);return a.magnitudeSquared(o)};a.normalize=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}var i=a.magnitude(e);n.x=e.x/i;n.y=e.y/i;n.z=e.z/i;n.w=e.w/i;return n};a.dot=function(e,n){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}return e.x*n.x+e.y*n.y+e.z*n.z+e.w*n.w};a.multiplyComponents=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x*n.x;i.y=e.y*n.y;i.z=e.z*n.z;i.w=e.w*n.w;return i};a.add=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x+n.x;i.y=e.y+n.y;i.z=e.z+n.z;i.w=e.w+n.w;return i};a.subtract=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x-n.x;i.y=e.y-n.y;i.z=e.z-n.z;i.w=e.w-n.w;return i};a.multiplyByScalar=function(e,n,i){if(!t(e)){throw new r(\"cartesian is required\")}if(typeof n!==\"number\"){throw new r(\"scalar is required and must be a number.\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x*n;i.y=e.y*n;i.z=e.z*n;i.w=e.w*n;return i};a.divideByScalar=function(e,n,i){if(!t(e)){throw new r(\"cartesian is required\")}if(typeof n!==\"number\"){throw new r(\"scalar is required and must be a number.\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x/n;i.y=e.y/n;i.z=e.z/n;i.w=e.w/n;return i};a.negate=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}n.x=-e.x;n.y=-e.y;n.z=-e.z;n.w=-e.w;return n};a.abs=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}n.x=Math.abs(e.x);n.y=Math.abs(e.y);n.z=Math.abs(e.z);n.w=Math.abs(e.w);return n;\n};var s=new a;a.lerp=function(e,n,i,o){if(!t(e)){throw new r(\"start is required.\")}if(!t(n)){throw new r(\"end is required.\")}if(typeof i!==\"number\"){throw new r(\"t is required and must be a number.\")}if(!t(o)){throw new r(\"result is required.\")}a.multiplyByScalar(n,i,s);o=a.multiplyByScalar(e,1-i,o);return a.add(s,o,o)};var u=new a;a.mostOrthogonalAxis=function(e,n){if(!t(e)){throw new r(\"cartesian is required.\")}if(!t(n)){throw new r(\"result is required.\")}var i=a.normalize(e,u);a.abs(i,i);if(i.x<=i.y){if(i.x<=i.z){if(i.x<=i.w){n=a.clone(a.UNIT_X,n)}else{n=a.clone(a.UNIT_W,n)}}else if(i.z<=i.w){n=a.clone(a.UNIT_Z,n)}else{n=a.clone(a.UNIT_W,n)}}else if(i.y<=i.z){if(i.y<=i.w){n=a.clone(a.UNIT_Y,n)}else{n=a.clone(a.UNIT_W,n)}}else if(i.z<=i.w){n=a.clone(a.UNIT_Z,n)}else{n=a.clone(a.UNIT_W,n)}return n};a.equals=function(e,r){return e===r||t(e)&&t(r)&&e.x===r.x&&e.y===r.y&&e.z===r.z&&e.w===r.w};a.equalsArray=function(e,t,r){return e.x===t[r]&&e.y===t[r+1]&&e.z===t[r+2]&&e.w===t[r+3]};a.equalsEpsilon=function(e,r,n,a){return e===r||t(e)&&t(r)&&i.equalsEpsilon(e.x,r.x,n,a)&&i.equalsEpsilon(e.y,r.y,n,a)&&i.equalsEpsilon(e.z,r.z,n,a)&&i.equalsEpsilon(e.w,r.w,n,a)};a.ZERO=n(new a(0,0,0,0));a.UNIT_X=n(new a(1,0,0,0));a.UNIT_Y=n(new a(0,1,0,0));a.UNIT_Z=n(new a(0,0,1,0));a.UNIT_W=n(new a(0,0,0,1));a.prototype.clone=function(e){return a.clone(this,e)};a.prototype.equals=function(e){return a.equals(this,e)};a.prototype.equalsEpsilon=function(e,t,r){return a.equalsEpsilon(this,e,t,r)};a.prototype.toString=function(){return\"(\"+this.x+\", \"+this.y+\", \"+this.z+\", \"+this.w+\")\"};return a})})();(function(){var t=e.amdDefine;t(\"1b\",[\"1a\"],function(e){\"use strict\";var t=function(){try{return\"x\"in Object.defineProperty({},\"x\",{})}catch(e){return false}}();var r=Object.defineProperties;if(!t||!e(r)){r=function(e){return e}}return r})})();(function(){var t=e.amdDefine;t(\"32\",[\"2c\",\"23\",\"1a\",\"1b\",\"1c\",\"1f\",\"27\"],function(e,t,r,n,i,a,o){\"use strict\";function s(e,r,n,i,a,o,s,u,f){this[0]=t(e,0);this[1]=t(i,0);this[2]=t(s,0);this[3]=t(r,0);this[4]=t(a,0);this[5]=t(u,0);this[6]=t(n,0);this[7]=t(o,0);this[8]=t(f,0)}s.packedLength=9;s.pack=function(e,n,a){if(!r(e)){throw new i(\"value is required\")}if(!r(n)){throw new i(\"array is required\")}a=t(a,0);n[a++]=e[0];n[a++]=e[1];n[a++]=e[2];n[a++]=e[3];n[a++]=e[4];n[a++]=e[5];n[a++]=e[6];n[a++]=e[7];n[a++]=e[8]};s.unpack=function(e,n,a){if(!r(e)){throw new i(\"array is required\")}n=t(n,0);if(!r(a)){a=new s}a[0]=e[n++];a[1]=e[n++];a[2]=e[n++];a[3]=e[n++];a[4]=e[n++];a[5]=e[n++];a[6]=e[n++];a[7]=e[n++];a[8]=e[n++];return a};s.clone=function(e,t){if(!r(e)){return undefined}if(!r(t)){return new s(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t};s.fromArray=function(e,n,a){if(!r(e)){throw new i(\"array is required\")}n=t(n,0);if(!r(a)){a=new s}a[0]=e[n];a[1]=e[n+1];a[2]=e[n+2];a[3]=e[n+3];a[4]=e[n+4];a[5]=e[n+5];a[6]=e[n+6];a[7]=e[n+7];a[8]=e[n+8];return a};s.fromColumnMajorArray=function(e,t){if(!r(e)){throw new i(\"values parameter is required\")}return s.clone(e,t)};s.fromRowMajorArray=function(e,t){if(!r(e)){throw new i(\"values is required.\")}if(!r(t)){return new s(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}t[0]=e[0];t[1]=e[3];t[2]=e[6];t[3]=e[1];t[4]=e[4];t[5]=e[7];t[6]=e[2];t[7]=e[5];t[8]=e[8];return t};s.fromQuaternion=function(e,t){if(!r(e)){throw new i(\"quaternion is required\")}var n=e.x*e.x;var a=e.x*e.y;var o=e.x*e.z;var u=e.x*e.w;var f=e.y*e.y;var c=e.y*e.z;var l=e.y*e.w;var d=e.z*e.z;var h=e.z*e.w;var v=e.w*e.w;var p=n-f-d+v;var m=2*(a-h);var w=2*(o+l);var y=2*(a+h);var g=-n+f-d+v;var S=2*(c-u);var b=2*(o-l);var T=2*(c+u);var _=-n-f+d+v;if(!r(t)){return new s(p,m,w,y,g,S,b,T,_)}t[0]=p;t[1]=y;t[2]=b;t[3]=m;t[4]=g;t[5]=T;t[6]=w;t[7]=S;t[8]=_;return t};s.fromScale=function(e,t){if(!r(e)){throw new i(\"scale is required.\")}if(!r(t)){return new s(e.x,0,0,0,e.y,0,0,0,e.z)}t[0]=e.x;t[1]=0;t[2]=0;t[3]=0;t[4]=e.y;t[5]=0;t[6]=0;t[7]=0;t[8]=e.z;return t};s.fromUniformScale=function(e,t){if(typeof e!==\"number\"){throw new i(\"scale is required.\")}if(!r(t)){return new s(e,0,0,0,e,0,0,0,e)}t[0]=e;t[1]=0;t[2]=0;t[3]=0;t[4]=e;t[5]=0;t[6]=0;t[7]=0;t[8]=e;return t};s.fromCrossProduct=function(e,t){if(!r(e)){throw new i(\"vector is required.\")}if(!r(t)){return new s(0,-e.z,e.y,e.z,0,-e.x,-e.y,e.x,0)}t[0]=0;t[1]=e.z;t[2]=-e.y;t[3]=-e.z;t[4]=0;t[5]=e.x;t[6]=e.y;t[7]=-e.x;t[8]=0;return t};s.fromRotationX=function(e,t){if(!r(e)){throw new i(\"angle is required.\")}var n=Math.cos(e);var a=Math.sin(e);if(!r(t)){return new s(1,0,0,0,n,-a,0,a,n)}t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=n;t[5]=a;t[6]=0;t[7]=-a;t[8]=n;return t};s.fromRotationY=function(e,t){if(!r(e)){throw new i(\"angle is required.\")}var n=Math.cos(e);var a=Math.sin(e);if(!r(t)){return new s(n,0,a,0,1,0,-a,0,n)}t[0]=n;t[1]=0;t[2]=-a;t[3]=0;t[4]=1;t[5]=0;t[6]=a;t[7]=0;t[8]=n;return t};s.fromRotationZ=function(e,t){if(!r(e)){throw new i(\"angle is required.\")}var n=Math.cos(e);var a=Math.sin(e);if(!r(t)){return new s(n,-a,0,a,n,0,0,0,1)}t[0]=n;t[1]=a;t[2]=0;t[3]=-a;t[4]=n;t[5]=0;t[6]=0;t[7]=0;t[8]=1;return t};s.toArray=function(e,t){if(!r(e)){throw new i(\"matrix is required\")}if(!r(t)){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t};s.getElementIndex=function(e,t){if(typeof t!==\"number\"||t<0||t>2){throw new i(\"row must be 0, 1, or 2.\")}if(typeof e!==\"number\"||e<0||e>2){throw new i(\"column must be 0, 1, or 2.\")}return e*3+t};s.getColumn=function(e,t,n){if(!r(e)){throw new i(\"matrix is required.\")}if(typeof t!==\"number\"||t<0||t>2){throw new i(\"index must be 0, 1, or 2.\")}if(!r(n)){throw new i(\"result is required\")}var a=t*3;var o=e[a];var s=e[a+1];var u=e[a+2];n.x=o;n.y=s;n.z=u;return n};s.setColumn=function(e,t,n,a){if(!r(e)){throw new i(\"matrix is required\")}if(!r(n)){throw new i(\"cartesian is required\")}if(typeof t!==\"number\"||t<0||t>2){throw new i(\"index must be 0, 1, or 2.\")}if(!r(a)){throw new i(\"result is required\")}a=s.clone(e,a);var o=t*3;a[o]=n.x;a[o+1]=n.y;a[o+2]=n.z;return a};s.getRow=function(e,t,n){if(!r(e)){throw new i(\"matrix is required.\")}if(typeof t!==\"number\"||t<0||t>2){throw new i(\"index must be 0, 1, or 2.\")}if(!r(n)){throw new i(\"result is required\")}var a=e[t];var o=e[t+3];var s=e[t+6];n.x=a;n.y=o;n.z=s;return n};s.setRow=function(e,t,n,a){if(!r(e)){throw new i(\"matrix is required\")}if(!r(n)){throw new i(\"cartesian is required\")}if(typeof t!==\"number\"||t<0||t>2){throw new i(\"index must be 0, 1, or 2.\")}if(!r(a)){throw new i(\"result is required\")}a=s.clone(e,a);a[t]=n.x;a[t+3]=n.y;a[t+6]=n.z;return a};var u=new e;s.getScale=function(t,n){if(!r(t)){throw new i(\"matrix is required.\")}if(!r(n)){throw new i(\"result is required\")}n.x=e.magnitude(e.fromElements(t[0],t[1],t[2],u));n.y=e.magnitude(e.fromElements(t[3],t[4],t[5],u));n.z=e.magnitude(e.fromElements(t[6],t[7],t[8],u));return n};var f=new e;s.getMaximumScale=function(t){s.getScale(t,f);return e.maximumComponent(f)};s.multiply=function(e,t,n){if(!r(e)){throw new i(\"left is required\")}if(!r(t)){throw new i(\"right is required\")}if(!r(n)){throw new i(\"result is required\")}var a=e[0]*t[0]+e[3]*t[1]+e[6]*t[2];var o=e[1]*t[0]+e[4]*t[1]+e[7]*t[2];var s=e[2]*t[0]+e[5]*t[1]+e[8]*t[2];var u=e[0]*t[3]+e[3]*t[4]+e[6]*t[5];var f=e[1]*t[3]+e[4]*t[4]+e[7]*t[5];var c=e[2]*t[3]+e[5]*t[4]+e[8]*t[5];var l=e[0]*t[6]+e[3]*t[7]+e[6]*t[8];var d=e[1]*t[6]+e[4]*t[7]+e[7]*t[8];var h=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];n[0]=a;n[1]=o;n[2]=s;n[3]=u;n[4]=f;n[5]=c;n[6]=l;n[7]=d;n[8]=h;return n};s.add=function(e,t,n){if(!r(e)){throw new i(\"left is required\")}if(!r(t)){throw new i(\"right is required\")}if(!r(n)){throw new i(\"result is required\")}n[0]=e[0]+t[0];n[1]=e[1]+t[1];n[2]=e[2]+t[2];n[3]=e[3]+t[3];n[4]=e[4]+t[4];n[5]=e[5]+t[5];n[6]=e[6]+t[6];n[7]=e[7]+t[7];n[8]=e[8]+t[8];return n};s.subtract=function(e,t,n){if(!r(e)){throw new i(\"left is required\")}if(!r(t)){throw new i(\"right is required\")}if(!r(n)){throw new i(\"result is required\")}n[0]=e[0]-t[0];n[1]=e[1]-t[1];n[2]=e[2]-t[2];n[3]=e[3]-t[3];n[4]=e[4]-t[4];n[5]=e[5]-t[5];n[6]=e[6]-t[6];n[7]=e[7]-t[7];n[8]=e[8]-t[8];return n};s.multiplyByVector=function(e,t,n){if(!r(e)){throw new i(\"matrix is required\")}if(!r(t)){throw new i(\"cartesian is required\")}if(!r(n)){throw new i(\"result is required\")}var a=t.x;var o=t.y;var s=t.z;var u=e[0]*a+e[3]*o+e[6]*s;var f=e[1]*a+e[4]*o+e[7]*s;var c=e[2]*a+e[5]*o+e[8]*s;n.x=u;n.y=f;n.z=c;return n};s.multiplyByScalar=function(e,t,n){if(!r(e)){throw new i(\"matrix is required\")}if(typeof t!==\"number\"){throw new i(\"scalar must be a number\")}if(!r(n)){throw new i(\"result is required\")}n[0]=e[0]*t;n[1]=e[1]*t;n[2]=e[2]*t;n[3]=e[3]*t;n[4]=e[4]*t;n[5]=e[5]*t;n[6]=e[6]*t;n[7]=e[7]*t;n[8]=e[8]*t;return n};s.multiplyByScale=function(e,t,n){if(!r(e)){throw new i(\"matrix is required\")}if(!r(t)){throw new i(\"scale is required\")}if(!r(n)){throw new i(\"result is required\")}n[0]=e[0]*t.x;n[1]=e[1]*t.x;n[2]=e[2]*t.x;n[3]=e[3]*t.y;n[4]=e[4]*t.y;n[5]=e[5]*t.y;n[6]=e[6]*t.z;n[7]=e[7]*t.z;n[8]=e[8]*t.z;return n};s.negate=function(e,t){if(!r(e)){throw new i(\"matrix is required\")}if(!r(t)){throw new i(\"result is required\")}t[0]=-e[0];t[1]=-e[1];t[2]=-e[2];t[3]=-e[3];t[4]=-e[4];t[5]=-e[5];t[6]=-e[6];t[7]=-e[7];t[8]=-e[8];return t};s.transpose=function(e,t){if(!r(e)){throw new i(\"matrix is required\")}if(!r(t)){throw new i(\"result is required\")}var n=e[0];var a=e[3];var o=e[6];var s=e[1];var u=e[4];var f=e[7];var c=e[2];var l=e[5];var d=e[8];t[0]=n;t[1]=a;t[2]=o;t[3]=s;t[4]=u;t[5]=f;t[6]=c;t[7]=l;t[8]=d;return t};function c(e){var t=0;for(var r=0;r<9;++r){var n=e[r];t+=n*n}return Math.sqrt(t)}var l=[1,0,0];var d=[2,2,1];function h(e){var t=0;for(var r=0;r<3;++r){var n=e[s.getElementIndex(d[r],l[r])];t+=2*n*n}return Math.sqrt(t)}function v(e,t){var r=o.EPSILON15;var n=0;var i=1;for(var a=0;a<3;++a){var u=Math.abs(e[s.getElementIndex(d[a],l[a])]);if(u>n){i=a;n=u}}var f=1;var c=0;var h=l[i];var v=d[i];if(Math.abs(e[s.getElementIndex(v,h)])>r){var p=e[s.getElementIndex(v,v)];var m=e[s.getElementIndex(h,h)];var w=e[s.getElementIndex(v,h)];var y=(p-m)/2/w;var g;if(y<0){g=-1/(-y+Math.sqrt(1+y*y))}else{g=1/(y+Math.sqrt(1+y*y))}f=1/Math.sqrt(1+g*g);c=g*f}t=s.clone(s.IDENTITY,t);t[s.getElementIndex(h,h)]=t[s.getElementIndex(v,v)]=f;t[s.getElementIndex(v,h)]=c;t[s.getElementIndex(h,v)]=-c;return t}var p=new s;var m=new s;s.computeEigenDecomposition=function(e,t){if(!r(e)){throw new i(\"matrix is required.\")}var n=o.EPSILON20;var a=10;var u=0;var f=0;if(!r(t)){t={}}var l=t.unitary=s.clone(s.IDENTITY,t.unitary);var d=t.diagonal=s.clone(e,t.diagonal);var w=n*c(d);while(f<a&&h(d)>w){v(d,p);s.transpose(p,m);s.multiply(d,p,d);s.multiply(m,d,d);s.multiply(l,p,l);if(++u>2){++f;u=0}}return t};s.abs=function(e,t){if(!r(e)){throw new i(\"matrix is required\")}if(!r(t)){throw new i(\"result is required\")}t[0]=Math.abs(e[0]);t[1]=Math.abs(e[1]);t[2]=Math.abs(e[2]);t[3]=Math.abs(e[3]);t[4]=Math.abs(e[4]);t[5]=Math.abs(e[5]);t[6]=Math.abs(e[6]);t[7]=Math.abs(e[7]);t[8]=Math.abs(e[8]);return t};s.determinant=function(e){if(!r(e)){throw new i(\"matrix is required\")}var t=e[0];var n=e[3];var a=e[6];var o=e[1];var s=e[4];var u=e[7];var f=e[2];var c=e[5];var l=e[8];return t*(s*l-c*u)+o*(c*a-n*l)+f*(n*u-s*a)};s.inverse=function(e,t){if(!r(e)){throw new i(\"matrix is required\")}if(!r(t)){throw new i(\"result is required\")}var n=e[0];var a=e[1];var u=e[2];var f=e[3];var c=e[4];var l=e[5];var d=e[6];var h=e[7];var v=e[8];var p=s.determinant(e);if(Math.abs(p)<=o.EPSILON15){throw new i(\"matrix is not invertible\")}t[0]=c*v-h*l;t[1]=h*u-a*v;t[2]=a*l-c*u;t[3]=d*l-f*v;t[4]=n*v-d*u;t[5]=f*u-n*l;t[6]=f*h-d*c;t[7]=d*a-n*h;t[8]=n*c-f*a;var m=1/p;return s.multiplyByScalar(t,m,t)};s.equals=function(e,t){return e===t||r(e)&&r(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]};s.equalsEpsilon=function(e,t,n){if(typeof n!==\"number\"){throw new i(\"epsilon must be a number\")}return e===t||r(e)&&r(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n};s.IDENTITY=a(new s(1,0,0,0,1,0,0,0,1));s.ZERO=a(new s(0,0,0,0,0,0,0,0,0));s.COLUMN0ROW0=0;s.COLUMN0ROW1=1;s.COLUMN0ROW2=2;s.COLUMN1ROW0=3;s.COLUMN1ROW1=4;s.COLUMN1ROW2=5;s.COLUMN2ROW0=6;s.COLUMN2ROW1=7;s.COLUMN2ROW2=8;n(s.prototype,{length:{get:function(){return s.packedLength}}});s.prototype.clone=function(e){return s.clone(this,e)};s.prototype.equals=function(e){return s.equals(this,e)};s.equalsArray=function(e,t,r){return e[0]===t[r]&&e[1]===t[r+1]&&e[2]===t[r+2]&&e[3]===t[r+3]&&e[4]===t[r+4]&&e[5]===t[r+5]&&e[6]===t[r+6]&&e[7]===t[r+7]&&e[8]===t[r+8]};s.prototype.equalsEpsilon=function(e,t){return s.equalsEpsilon(this,e,t)};s.prototype.toString=function(){return\"(\"+this[0]+\", \"+this[3]+\", \"+this[6]+\")\\n\"+\"(\"+this[1]+\", \"+this[4]+\", \"+this[7]+\")\\n\"+\"(\"+this[2]+\", \"+this[5]+\", \"+this[8]+\")\"};return s})})();(function(){var t=e.amdDefine;t(\"38\",[\"1a\"],function(e){\"use strict\";function t(e){this.name=\"RuntimeError\";this.message=e;var t;try{throw new Error}catch(e){t=e.stack}this.stack=t}if(e(Object.create)){t.prototype=Object.create(Error.prototype);t.prototype.constructor=t}t.prototype.toString=function(){var t=this.name+\": \"+this.message;if(e(this.stack)){t+=\"\\n\"+this.stack.toString()}return t};return t})})();(function(){var t=e.amdDefine;t(\"33\",[\"2c\",\"43\",\"23\",\"1a\",\"1b\",\"1c\",\"1f\",\"27\",\"32\",\"38\"],function(e,t,r,n,i,a,o,s,u,f){\"use strict\";function c(e,t,n,i,a,o,s,u,f,c,l,d,h,v,p,m){this[0]=r(e,0);this[1]=r(a,0);this[2]=r(f,0);this[3]=r(h,0);this[4]=r(t,0);this[5]=r(o,0);this[6]=r(c,0);this[7]=r(v,0);this[8]=r(n,0);this[9]=r(s,0);this[10]=r(l,0);this[11]=r(p,0);this[12]=r(i,0);this[13]=r(u,0);this[14]=r(d,0);this[15]=r(m,0)}c.packedLength=16;c.pack=function(e,t,i){if(!n(e)){throw new a(\"value is required\")}if(!n(t)){throw new a(\"array is required\")}i=r(i,0);t[i++]=e[0];t[i++]=e[1];t[i++]=e[2];t[i++]=e[3];t[i++]=e[4];t[i++]=e[5];t[i++]=e[6];t[i++]=e[7];t[i++]=e[8];t[i++]=e[9];t[i++]=e[10];t[i++]=e[11];t[i++]=e[12];t[i++]=e[13];t[i++]=e[14];t[i]=e[15]};c.unpack=function(e,t,i){if(!n(e)){throw new a(\"array is required\")}t=r(t,0);if(!n(i)){i=new c}i[0]=e[t++];i[1]=e[t++];i[2]=e[t++];i[3]=e[t++];i[4]=e[t++];i[5]=e[t++];i[6]=e[t++];i[7]=e[t++];i[8]=e[t++];i[9]=e[t++];i[10]=e[t++];i[11]=e[t++];i[12]=e[t++];i[13]=e[t++];i[14]=e[t++];i[15]=e[t];return i};c.clone=function(e,t){if(!n(e)){return undefined}if(!n(t)){return new c(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t};c.fromArray=c.unpack;c.fromColumnMajorArray=function(e,t){if(!n(e)){throw new a(\"values is required\")}return c.clone(e,t)};c.fromRowMajorArray=function(e,t){if(!n(e)){throw new a(\"values is required.\")}if(!n(t)){return new c(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}t[0]=e[0];t[1]=e[4];t[2]=e[8];t[3]=e[12];t[4]=e[1];t[5]=e[5];t[6]=e[9];t[7]=e[13];t[8]=e[2];t[9]=e[6];t[10]=e[10];t[11]=e[14];t[12]=e[3];t[13]=e[7];t[14]=e[11];t[15]=e[15];return t};c.fromRotationTranslation=function(t,i,o){if(!n(t)){throw new a(\"rotation is required.\")}i=r(i,e.ZERO);if(!n(o)){return new c(t[0],t[3],t[6],i.x,t[1],t[4],t[7],i.y,t[2],t[5],t[8],i.z,0,0,0,1)}o[0]=t[0];o[1]=t[1];o[2]=t[2];o[3]=0;o[4]=t[3];o[5]=t[4];o[6]=t[5];o[7]=0;o[8]=t[6];o[9]=t[7];o[10]=t[8];o[11]=0;o[12]=i.x;o[13]=i.y;o[14]=i.z;o[15]=1;return o};c.fromTranslationQuaternionRotationScale=function(e,t,r,i){if(!n(e)){throw new a(\"translation is required.\")}if(!n(t)){throw new a(\"rotation is required.\")}if(!n(r)){throw new a(\"scale is required.\")}if(!n(i)){i=new c}var o=r.x;var s=r.y;var u=r.z;var f=t.x*t.x;var l=t.x*t.y;var d=t.x*t.z;var h=t.x*t.w;var v=t.y*t.y;var p=t.y*t.z;var m=t.y*t.w;var w=t.z*t.z;var y=t.z*t.w;var g=t.w*t.w;var S=f-v-w+g;var b=2*(l-y);var T=2*(d+m);var _=2*(l+y);var E=-f+v-w+g;var M=2*(p-h);var P=2*(d-m);var A=2*(p+h);var C=-f-v+w+g;i[0]=S*o;i[1]=_*o;i[2]=P*o;i[3]=0;i[4]=b*s;i[5]=E*s;i[6]=A*s;i[7]=0;i[8]=T*u;i[9]=M*u;i[10]=C*u;i[11]=0;i[12]=e.x;i[13]=e.y;i[14]=e.z;i[15]=1;return i};c.fromTranslationRotationScale=function(e,t){if(!n(e)){throw new a(\"translationRotationScale is required.\")}return c.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t)};c.fromTranslation=function(e,t){if(!n(e)){throw new a(\"translation is required.\")}return c.fromRotationTranslation(u.IDENTITY,e,t)};c.fromScale=function(e,t){if(!n(e)){throw new a(\"scale is required.\")}if(!n(t)){return new c(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)}t[0]=e.x;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=e.y;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=e.z;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t};c.fromUniformScale=function(e,t){if(typeof e!==\"number\"){throw new a(\"scale is required.\")}if(!n(t)){return new c(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1)}t[0]=e;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=e;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=e;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t};var l=new e;var d=new e;var h=new e;c.fromCamera=function(t,r){if(!n(t)){throw new a(\"camera is required.\")}var i=t.position;var o=t.direction;var s=t.up;if(!n(i)){throw new a(\"camera.position is required.\")}if(!n(o)){throw new a(\"camera.direction is required.\")}if(!n(s)){throw new a(\"camera.up is required.\")}e.normalize(o,l);e.normalize(e.cross(l,s,d),d);e.normalize(e.cross(d,l,h),h);var u=d.x;var f=d.y;var v=d.z;var p=l.x;var m=l.y;var w=l.z;var y=h.x;var g=h.y;var S=h.z;var b=i.x;var T=i.y;var _=i.z;var E=u*-b+f*-T+v*-_;var M=y*-b+g*-T+S*-_;var P=p*b+m*T+w*_;if(!n(r)){return new c(u,f,v,E,y,g,S,M,-p,-m,-w,P,0,0,0,1)}r[0]=u;r[1]=y;r[2]=-p;r[3]=0;r[4]=f;r[5]=g;r[6]=-m;r[7]=0;r[8]=v;r[9]=S;r[10]=-w;r[11]=0;r[12]=E;r[13]=M;r[14]=P;r[15]=1;return r};c.computePerspectiveFieldOfView=function(e,t,r,i,o){if(e<=0||e>Math.PI){throw new a(\"fovY must be in [0, PI).\")}if(t<=0){throw new a(\"aspectRatio must be greater than zero.\")}if(r<=0){throw new a(\"near must be greater than zero.\")}if(i<=0){throw new a(\"far must be greater than zero.\")}if(!n(o)){throw new a(\"result is required\")}var s=Math.tan(e*.5);var u=1/s;var f=u/t;var c=(i+r)/(r-i);var l=2*i*r/(r-i);o[0]=f;o[1]=0;o[2]=0;o[3]=0;o[4]=0;o[5]=u;o[6]=0;o[7]=0;o[8]=0;o[9]=0;o[10]=c;o[11]=-1;o[12]=0;o[13]=0;o[14]=l;o[15]=0;return o};c.computeOrthographicOffCenter=function(e,t,r,i,o,s,u){if(!n(e)){throw new a(\"left is required.\")}if(!n(t)){throw new a(\"right is required.\")}if(!n(r)){throw new a(\"bottom is required.\")}if(!n(i)){throw new a(\"top is required.\")}if(!n(o)){throw new a(\"near is required.\")}if(!n(s)){throw new a(\"far is required.\")}if(!n(u)){throw new a(\"result is required\")}var f=1/(t-e);var c=1/(i-r);var l=1/(s-o);var d=-(t+e)*f;var h=-(i+r)*c;var v=-(s+o)*l;f*=2;c*=2;l*=-2;u[0]=f;u[1]=0;u[2]=0;u[3]=0;u[4]=0;u[5]=c;u[6]=0;u[7]=0;u[8]=0;u[9]=0;u[10]=l;u[11]=0;u[12]=d;u[13]=h;u[14]=v;u[15]=1;return u};c.computePerspectiveOffCenter=function(e,t,r,i,o,s,u){if(!n(e)){throw new a(\"left is required.\")}if(!n(t)){throw new a(\"right is required.\")}if(!n(r)){throw new a(\"bottom is required.\")}if(!n(i)){throw new a(\"top is required.\")}if(!n(o)){throw new a(\"near is required.\")}if(!n(s)){throw new a(\"far is required.\")}if(!n(u)){throw new a(\"result is required\")}var f=2*o/(t-e);var c=2*o/(i-r);var l=(t+e)/(t-e);var d=(i+r)/(i-r);var h=-(s+o)/(s-o);var v=-1;var p=-2*s*o/(s-o);u[0]=f;u[1]=0;u[2]=0;u[3]=0;u[4]=0;u[5]=c;u[6]=0;u[7]=0;u[8]=l;u[9]=d;u[10]=h;u[11]=v;u[12]=0;u[13]=0;u[14]=p;u[15]=0;return u};c.computeInfinitePerspectiveOffCenter=function(e,t,r,i,o,s){if(!n(e)){throw new a(\"left is required.\")}if(!n(t)){throw new a(\"right is required.\")}if(!n(r)){throw new a(\"bottom is required.\")}if(!n(i)){throw new a(\"top is required.\")}if(!n(o)){throw new a(\"near is required.\")}if(!n(s)){throw new a(\"result is required\")}var u=2*o/(t-e);var f=2*o/(i-r);var c=(t+e)/(t-e);var l=(i+r)/(i-r);var d=-1;var h=-1;var v=-2*o;s[0]=u;s[1]=0;s[2]=0;s[3]=0;s[4]=0;s[5]=f;s[6]=0;s[7]=0;s[8]=c;s[9]=l;s[10]=d;s[11]=h;s[12]=0;s[13]=0;s[14]=v;s[15]=0;return s};c.computeViewportTransformation=function(e,t,i,o){if(!n(o)){throw new a(\"result is required\")}e=r(e,r.EMPTY_OBJECT);var s=r(e.x,0);var u=r(e.y,0);var f=r(e.width,0);var c=r(e.height,0);t=r(t,0);i=r(i,1);var l=f*.5;var d=c*.5;var h=(i-t)*.5;var v=l;var p=d;var m=h;var w=s+l;var y=u+d;var g=t+h;var S=1;o[0]=v;o[1]=0;o[2]=0;o[3]=0;o[4]=0;o[5]=p;o[6]=0;o[7]=0;o[8]=0;o[9]=0;o[10]=m;o[11]=0;o[12]=w;o[13]=y;o[14]=g;o[15]=S;return o};c.computeView=function(t,r,i,o,s){if(!n(t)){throw new a(\"position is required\")}if(!n(r)){throw new a(\"direction is required\")}if(!n(i)){throw new a(\"up is required\")}if(!n(o)){throw new a(\"right is required\")}if(!n(s)){throw new a(\"result is required\")}s[0]=o.x;s[1]=i.x;s[2]=-r.x;s[3]=0;s[4]=o.y;s[5]=i.y;s[6]=-r.y;s[7]=0;s[8]=o.z;s[9]=i.z;s[10]=-r.z;s[11]=0;s[12]=-e.dot(o,t);s[13]=-e.dot(i,t);s[14]=e.dot(r,t);s[15]=1;return s};c.toArray=function(e,t){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t};c.getElementIndex=function(e,t){if(typeof t!==\"number\"||t<0||t>3){throw new a(\"row must be 0, 1, 2, or 3.\")}if(typeof e!==\"number\"||e<0||e>3){throw new a(\"column must be 0, 1, 2, or 3.\")}return e*4+t};c.getColumn=function(e,t,r){if(!n(e)){throw new a(\"matrix is required.\")}if(typeof t!==\"number\"||t<0||t>3){throw new a(\"index must be 0, 1, 2, or 3.\")}if(!n(r)){throw new a(\"result is required\")}var i=t*4;var o=e[i];var s=e[i+1];var u=e[i+2];var f=e[i+3];r.x=o;r.y=s;r.z=u;r.w=f;return r};c.setColumn=function(e,t,r,i){if(!n(e)){throw new a(\"matrix is required\")}if(!n(r)){throw new a(\"cartesian is required\")}if(typeof t!==\"number\"||t<0||t>3){throw new a(\"index must be 0, 1, 2, or 3.\")}if(!n(i)){throw new a(\"result is required\")}i=c.clone(e,i);var o=t*4;i[o]=r.x;i[o+1]=r.y;i[o+2]=r.z;i[o+3]=r.w;return i};c.setTranslation=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"translation is required\")}if(!n(r)){throw new a(\"result is required\")}r[0]=e[0];r[1]=e[1];r[2]=e[2];r[3]=e[3];r[4]=e[4];r[5]=e[5];r[6]=e[6];r[7]=e[7];r[8]=e[8];r[9]=e[9];r[10]=e[10];r[11]=e[11];r[12]=t.x;r[13]=t.y;r[14]=t.z;r[15]=e[15];return r};c.getRow=function(e,t,r){if(!n(e)){throw new a(\"matrix is required.\")}if(typeof t!==\"number\"||t<0||t>3){throw new a(\"index must be 0, 1, 2, or 3.\")}if(!n(r)){throw new a(\"result is required\")}var i=e[t];var o=e[t+4];var s=e[t+8];var u=e[t+12];r.x=i;r.y=o;r.z=s;r.w=u;return r};c.setRow=function(e,t,r,i){if(!n(e)){throw new a(\"matrix is required\")}if(!n(r)){throw new a(\"cartesian is required\")}if(typeof t!==\"number\"||t<0||t>3){throw new a(\"index must be 0, 1, 2, or 3.\")}if(!n(i)){throw new a(\"result is required\")}i=c.clone(e,i);i[t]=r.x;i[t+4]=r.y;i[t+8]=r.z;i[t+12]=r.w;return i};var v=new e;c.getScale=function(t,r){if(!n(t)){throw new a(\"matrix is required.\")}if(!n(r)){throw new a(\"result is required\")}r.x=e.magnitude(e.fromElements(t[0],t[1],t[2],v));r.y=e.magnitude(e.fromElements(t[4],t[5],t[6],v));r.z=e.magnitude(e.fromElements(t[8],t[9],t[10],v));return r};var p=new e;c.getMaximumScale=function(t){c.getScale(t,p);return e.maximumComponent(p)};c.multiply=function(e,t,r){if(!n(e)){throw new a(\"left is required\")}if(!n(t)){throw new a(\"right is required\")}if(!n(r)){throw new a(\"result is required\")}var i=e[0];var o=e[1];var s=e[2];var u=e[3];var f=e[4];var c=e[5];var l=e[6];var d=e[7];var h=e[8];var v=e[9];var p=e[10];var m=e[11];var w=e[12];var y=e[13];var g=e[14];var S=e[15];var b=t[0];var T=t[1];var _=t[2];var E=t[3];var M=t[4];var P=t[5];var A=t[6];var C=t[7];var I=t[8];var x=t[9];var R=t[10];var O=t[11];var D=t[12];var q=t[13];var N=t[14];var G=t[15];var L=i*b+f*T+h*_+w*E;var B=o*b+c*T+v*_+y*E;var H=s*b+l*T+p*_+g*E;var k=u*b+d*T+m*_+S*E;var z=i*M+f*P+h*A+w*C;var F=o*M+c*P+v*A+y*C;var U=s*M+l*P+p*A+g*C;var V=u*M+d*P+m*A+S*C;var j=i*I+f*x+h*R+w*O;var W=o*I+c*x+v*R+y*O;var X=s*I+l*x+p*R+g*O;var Q=u*I+d*x+m*R+S*O;var K=i*D+f*q+h*N+w*G;var Y=o*D+c*q+v*N+y*G;var Z=s*D+l*q+p*N+g*G;var J=u*D+d*q+m*N+S*G;r[0]=L;r[1]=B;r[2]=H;r[3]=k;r[4]=z;r[5]=F;r[6]=U;r[7]=V;r[8]=j;r[9]=W;r[10]=X;r[11]=Q;r[12]=K;r[13]=Y;r[14]=Z;r[15]=J;return r};c.add=function(e,t,r){if(!n(e)){throw new a(\"left is required\")}if(!n(t)){throw new a(\"right is required\")}if(!n(r)){throw new a(\"result is required\")}r[0]=e[0]+t[0];r[1]=e[1]+t[1];r[2]=e[2]+t[2];r[3]=e[3]+t[3];r[4]=e[4]+t[4];r[5]=e[5]+t[5];r[6]=e[6]+t[6];r[7]=e[7]+t[7];r[8]=e[8]+t[8];r[9]=e[9]+t[9];r[10]=e[10]+t[10];r[11]=e[11]+t[11];r[12]=e[12]+t[12];r[13]=e[13]+t[13];r[14]=e[14]+t[14];r[15]=e[15]+t[15];return r};c.subtract=function(e,t,r){if(!n(e)){throw new a(\"left is required\")}if(!n(t)){throw new a(\"right is required\")}if(!n(r)){throw new a(\"result is required\")}r[0]=e[0]-t[0];r[1]=e[1]-t[1];r[2]=e[2]-t[2];r[3]=e[3]-t[3];r[4]=e[4]-t[4];r[5]=e[5]-t[5];r[6]=e[6]-t[6];r[7]=e[7]-t[7];r[8]=e[8]-t[8];r[9]=e[9]-t[9];r[10]=e[10]-t[10];r[11]=e[11]-t[11];r[12]=e[12]-t[12];r[13]=e[13]-t[13];r[14]=e[14]-t[14];r[15]=e[15]-t[15];return r};c.multiplyTransformation=function(e,t,r){if(!n(e)){throw new a(\"left is required\")}if(!n(t)){throw new a(\"right is required\")}if(!n(r)){throw new a(\"result is required\")}var i=e[0];var o=e[1];var s=e[2];var u=e[4];var f=e[5];var c=e[6];var l=e[8];var d=e[9];var h=e[10];var v=e[12];var p=e[13];var m=e[14];var w=t[0];var y=t[1];var g=t[2];var S=t[4];var b=t[5];var T=t[6];var _=t[8];var E=t[9];var M=t[10];var P=t[12];var A=t[13];var C=t[14];var I=i*w+u*y+l*g;var x=o*w+f*y+d*g;var R=s*w+c*y+h*g;var O=i*S+u*b+l*T;var D=o*S+f*b+d*T;var q=s*S+c*b+h*T;var N=i*_+u*E+l*M;var G=o*_+f*E+d*M;var L=s*_+c*E+h*M;var B=i*P+u*A+l*C+v;var H=o*P+f*A+d*C+p;var k=s*P+c*A+h*C+m;r[0]=I;r[1]=x;r[2]=R;r[3]=0;r[4]=O;r[5]=D;r[6]=q;r[7]=0;r[8]=N;r[9]=G;r[10]=L;r[11]=0;r[12]=B;r[13]=H;r[14]=k;r[15]=1;return r};c.multiplyByMatrix3=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"rotation is required\")}if(!n(r)){throw new a(\"result is required\")}var i=e[0];var o=e[1];var s=e[2];var u=e[4];var f=e[5];var c=e[6];var l=e[8];var d=e[9];var h=e[10];var v=t[0];var p=t[1];var m=t[2];var w=t[3];var y=t[4];var g=t[5];var S=t[6];var b=t[7];var T=t[8];var _=i*v+u*p+l*m;var E=o*v+f*p+d*m;var M=s*v+c*p+h*m;var P=i*w+u*y+l*g;var A=o*w+f*y+d*g;var C=s*w+c*y+h*g;var I=i*S+u*b+l*T;var x=o*S+f*b+d*T;var R=s*S+c*b+h*T;r[0]=_;r[1]=E;r[2]=M;r[3]=0;r[4]=P;r[5]=A;r[6]=C;r[7]=0;r[8]=I;r[9]=x;r[10]=R;r[11]=0;r[12]=e[12];r[13]=e[13];r[14]=e[14];r[15]=e[15];return r};c.multiplyByTranslation=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"translation is required\")}if(!n(r)){throw new a(\"result is required\")}var i=t.x;var o=t.y;var s=t.z;var u=i*e[0]+o*e[4]+s*e[8]+e[12];var f=i*e[1]+o*e[5]+s*e[9]+e[13];var c=i*e[2]+o*e[6]+s*e[10]+e[14];r[0]=e[0];r[1]=e[1];r[2]=e[2];r[3]=e[3];r[4]=e[4];r[5]=e[5];r[6]=e[6];r[7]=e[7];r[8]=e[8];r[9]=e[9];r[10]=e[10];r[11]=e[11];r[12]=u;r[13]=f;r[14]=c;r[15]=e[15];return r};var m=new e;c.multiplyByUniformScale=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(typeof t!==\"number\"){throw new a(\"scale is required\")}if(!n(r)){throw new a(\"result is required\")}m.x=t;m.y=t;m.z=t;return c.multiplyByScale(e,m,r)};c.multiplyByScale=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"scale is required\")}if(!n(r)){throw new a(\"result is required\")}var i=t.x;var o=t.y;var s=t.z;if(i===1&&o===1&&s===1){return c.clone(e,r)}r[0]=i*e[0];r[1]=i*e[1];r[2]=i*e[2];r[3]=0;r[4]=o*e[4];r[5]=o*e[5];r[6]=o*e[6];r[7]=0;r[8]=s*e[8];r[9]=s*e[9];r[10]=s*e[10];r[11]=0;r[12]=e[12];r[13]=e[13];r[14]=e[14];r[15]=1;return r};c.multiplyByVector=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"cartesian is required\")}if(!n(r)){throw new a(\"result is required\")}var i=t.x;var o=t.y;var s=t.z;var u=t.w;var f=e[0]*i+e[4]*o+e[8]*s+e[12]*u;var c=e[1]*i+e[5]*o+e[9]*s+e[13]*u;var l=e[2]*i+e[6]*o+e[10]*s+e[14]*u;var d=e[3]*i+e[7]*o+e[11]*s+e[15]*u;r.x=f;r.y=c;r.z=l;r.w=d;return r};c.multiplyByPointAsVector=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"cartesian is required\")}if(!n(r)){throw new a(\"result is required\")}var i=t.x;var o=t.y;var s=t.z;var u=e[0]*i+e[4]*o+e[8]*s;var f=e[1]*i+e[5]*o+e[9]*s;var c=e[2]*i+e[6]*o+e[10]*s;r.x=u;r.y=f;r.z=c;return r};c.multiplyByPoint=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"cartesian is required\")}if(!n(r)){throw new a(\"result is required\")}var i=t.x;var o=t.y;var s=t.z;var u=e[0]*i+e[4]*o+e[8]*s+e[12];var f=e[1]*i+e[5]*o+e[9]*s+e[13];var c=e[2]*i+e[6]*o+e[10]*s+e[14];r.x=u;r.y=f;r.z=c;return r};c.multiplyByScalar=function(e,t,r){if(!n(e)){throw new a(\"matrix is required\")}if(typeof t!==\"number\"){throw new a(\"scalar must be a number\")}if(!n(r)){throw new a(\"result is required\")}r[0]=e[0]*t;r[1]=e[1]*t;r[2]=e[2]*t;r[3]=e[3]*t;r[4]=e[4]*t;r[5]=e[5]*t;r[6]=e[6]*t;r[7]=e[7]*t;r[8]=e[8]*t;r[9]=e[9]*t;r[10]=e[10]*t;r[11]=e[11]*t;r[12]=e[12]*t;r[13]=e[13]*t;r[14]=e[14]*t;r[15]=e[15]*t;return r};c.negate=function(e,t){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"result is required\")}t[0]=-e[0];t[1]=-e[1];t[2]=-e[2];t[3]=-e[3];t[4]=-e[4];t[5]=-e[5];t[6]=-e[6];t[7]=-e[7];t[8]=-e[8];t[9]=-e[9];t[10]=-e[10];t[11]=-e[11];t[12]=-e[12];t[13]=-e[13];t[14]=-e[14];t[15]=-e[15];return t};c.transpose=function(e,t){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"result is required\")}var r=e[1];var i=e[2];var o=e[3];var s=e[6];var u=e[7];var f=e[11];t[0]=e[0];t[1]=e[4];t[2]=e[8];t[3]=e[12];t[4]=r;t[5]=e[5];t[6]=e[9];t[7]=e[13];t[8]=i;t[9]=s;t[10]=e[10];t[11]=e[14];t[12]=o;t[13]=u;t[14]=f;t[15]=e[15];return t};c.abs=function(e,t){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"result is required\")}t[0]=Math.abs(e[0]);t[1]=Math.abs(e[1]);t[2]=Math.abs(e[2]);t[3]=Math.abs(e[3]);t[4]=Math.abs(e[4]);t[5]=Math.abs(e[5]);t[6]=Math.abs(e[6]);t[7]=Math.abs(e[7]);t[8]=Math.abs(e[8]);t[9]=Math.abs(e[9]);t[10]=Math.abs(e[10]);t[11]=Math.abs(e[11]);t[12]=Math.abs(e[12]);t[13]=Math.abs(e[13]);t[14]=Math.abs(e[14]);t[15]=Math.abs(e[15]);return t};c.equals=function(e,t){return e===t||n(e)&&n(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]};c.equalsEpsilon=function(e,t,r){if(typeof r!==\"number\"){throw new a(\"epsilon must be a number\")}return e===t||n(e)&&n(t)&&Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r&&Math.abs(e[4]-t[4])<=r&&Math.abs(e[5]-t[5])<=r&&Math.abs(e[6]-t[6])<=r&&Math.abs(e[7]-t[7])<=r&&Math.abs(e[8]-t[8])<=r&&Math.abs(e[9]-t[9])<=r&&Math.abs(e[10]-t[10])<=r&&Math.abs(e[11]-t[11])<=r&&Math.abs(e[12]-t[12])<=r&&Math.abs(e[13]-t[13])<=r&&Math.abs(e[14]-t[14])<=r&&Math.abs(e[15]-t[15])<=r};c.getTranslation=function(e,t){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"result is required\")}t.x=e[12];t.y=e[13];t.z=e[14];return t};c.getRotation=function(e,t){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"result is required\")}t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[4];t[4]=e[5];t[5]=e[6];t[6]=e[8];t[7]=e[9];t[8]=e[10];return t};var w=new u;var y=new u;var g=new t;var S=new t(0,0,0,1);c.inverse=function(e,r){if(!n(e)){throw new a(\"matrix is required\")}if(!n(r)){throw new a(\"result is required\")}if(u.equalsEpsilon(c.getRotation(e,w),y,s.EPSILON7)&&t.equals(c.getRow(e,3,g),S)){\nr[0]=0;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=0;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[10]=0;r[11]=0;r[12]=-e[12];r[13]=-e[13];r[14]=-e[14];r[15]=1;return r}var i=e[0];var o=e[4];var l=e[8];var d=e[12];var h=e[1];var v=e[5];var p=e[9];var m=e[13];var b=e[2];var T=e[6];var _=e[10];var E=e[14];var M=e[3];var P=e[7];var A=e[11];var C=e[15];var I=_*C;var x=E*A;var R=T*C;var O=E*P;var D=T*A;var q=_*P;var N=b*C;var G=E*M;var L=b*A;var B=_*M;var H=b*P;var k=T*M;var z=I*v+O*p+D*m-(x*v+R*p+q*m);var F=x*h+N*p+B*m-(I*h+G*p+L*m);var U=R*h+G*v+H*m-(O*h+N*v+k*m);var V=q*h+L*v+k*p-(D*h+B*v+H*p);var j=x*o+R*l+q*d-(I*o+O*l+D*d);var W=I*i+G*l+L*d-(x*i+N*l+B*d);var X=O*i+N*o+k*d-(R*i+G*o+H*d);var Q=D*i+B*o+H*l-(q*i+L*o+k*l);I=l*m;x=d*p;R=o*m;O=d*v;D=o*p;q=l*v;N=i*m;G=d*h;L=i*p;B=l*h;H=i*v;k=o*h;var K=I*P+O*A+D*C-(x*P+R*A+q*C);var Y=x*M+N*A+B*C-(I*M+G*A+L*C);var Z=R*M+G*P+H*C-(O*M+N*P+k*C);var J=q*M+L*P+k*A-(D*M+B*P+H*A);var $=R*_+q*E+x*T-(D*E+I*T+O*_);var ee=L*E+I*b+G*_-(N*_+B*E+x*b);var te=N*T+k*E+O*b-(H*E+R*b+G*T);var re=H*_+D*b+B*T-(L*T+k*_+q*b);var ne=i*z+o*F+l*U+d*V;if(Math.abs(ne)<s.EPSILON20){throw new f(\"matrix is not invertible because its determinate is zero.\")}ne=1/ne;r[0]=z*ne;r[1]=F*ne;r[2]=U*ne;r[3]=V*ne;r[4]=j*ne;r[5]=W*ne;r[6]=X*ne;r[7]=Q*ne;r[8]=K*ne;r[9]=Y*ne;r[10]=Z*ne;r[11]=J*ne;r[12]=$*ne;r[13]=ee*ne;r[14]=te*ne;r[15]=re*ne;return r};c.inverseTransformation=function(e,t){if(!n(e)){throw new a(\"matrix is required\")}if(!n(t)){throw new a(\"result is required\")}var r=e[0];var i=e[1];var o=e[2];var s=e[4];var u=e[5];var f=e[6];var c=e[8];var l=e[9];var d=e[10];var h=e[12];var v=e[13];var p=e[14];var m=-r*h-i*v-o*p;var w=-s*h-u*v-f*p;var y=-c*h-l*v-d*p;t[0]=r;t[1]=s;t[2]=c;t[3]=0;t[4]=i;t[5]=u;t[6]=l;t[7]=0;t[8]=o;t[9]=f;t[10]=d;t[11]=0;t[12]=m;t[13]=w;t[14]=y;t[15]=1;return t};c.IDENTITY=o(new c(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1));c.ZERO=o(new c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0));c.COLUMN0ROW0=0;c.COLUMN0ROW1=1;c.COLUMN0ROW2=2;c.COLUMN0ROW3=3;c.COLUMN1ROW0=4;c.COLUMN1ROW1=5;c.COLUMN1ROW2=6;c.COLUMN1ROW3=7;c.COLUMN2ROW0=8;c.COLUMN2ROW1=9;c.COLUMN2ROW2=10;c.COLUMN2ROW3=11;c.COLUMN3ROW0=12;c.COLUMN3ROW1=13;c.COLUMN3ROW2=14;c.COLUMN3ROW3=15;i(c.prototype,{length:{get:function(){return c.packedLength}}});c.prototype.clone=function(e){return c.clone(this,e)};c.prototype.equals=function(e){return c.equals(this,e)};c.equalsArray=function(e,t,r){return e[0]===t[r]&&e[1]===t[r+1]&&e[2]===t[r+2]&&e[3]===t[r+3]&&e[4]===t[r+4]&&e[5]===t[r+5]&&e[6]===t[r+6]&&e[7]===t[r+7]&&e[8]===t[r+8]&&e[9]===t[r+9]&&e[10]===t[r+10]&&e[11]===t[r+11]&&e[12]===t[r+12]&&e[13]===t[r+13]&&e[14]===t[r+14]&&e[15]===t[r+15]};c.prototype.equalsEpsilon=function(e,t){return c.equalsEpsilon(this,e,t)};c.prototype.toString=function(){return\"(\"+this[0]+\", \"+this[4]+\", \"+this[8]+\", \"+this[12]+\")\\n\"+\"(\"+this[1]+\", \"+this[5]+\", \"+this[9]+\", \"+this[13]+\")\\n\"+\"(\"+this[2]+\", \"+this[6]+\", \"+this[10]+\", \"+this[14]+\")\\n\"+\"(\"+this[3]+\", \"+this[7]+\", \"+this[11]+\", \"+this[15]+\")\"};return c})})();(function(){var t=e.amdDefine;t(\"6d\",[],function(){var e=function(e){if(e==undefined){e=(new Date).getTime()}this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=new Array(this.N);this.mti=this.N+1;this.init_genrand(e)};e.prototype.init_genrand=function(e){this.mt[0]=e>>>0;for(this.mti=1;this.mti<this.N;this.mti++){var e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti;this.mt[this.mti]>>>=0}};e.prototype.genrand_int32=function(){var e;var t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;if(this.mti==this.N+1)this.init_genrand(5489);for(r=0;r<this.N-this.M;r++){e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK;this.mt[r]=this.mt[r+this.M]^e>>>1^t[e&1]}for(;r<this.N-1;r++){e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK;this.mt[r]=this.mt[r+(this.M-this.N)]^e>>>1^t[e&1]}e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK;this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1];this.mti=0}e=this.mt[this.mti++];e^=e>>>11;e^=e<<7&2636928640;e^=e<<15&4022730752;e^=e>>>18;return e>>>0};e.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};return e})})();(function(){var t=e.amdDefine;t(\"23\",[\"1f\"],function(e){\"use strict\";function t(e,t){if(e!==undefined){return e}return t}t.EMPTY_OBJECT=e({});return t})})();(function(){var t=e.amdDefine;t(\"27\",[\"6d\",\"23\",\"1a\",\"1c\"],function(e,t,r,n){\"use strict\";var i={};i.EPSILON1=.1;i.EPSILON2=.01;i.EPSILON3=.001;i.EPSILON4=1e-4;i.EPSILON5=1e-5;i.EPSILON6=1e-6;i.EPSILON7=1e-7;i.EPSILON8=1e-8;i.EPSILON9=1e-9;i.EPSILON10=1e-10;i.EPSILON11=1e-11;i.EPSILON12=1e-12;i.EPSILON13=1e-13;i.EPSILON14=1e-14;i.EPSILON15=1e-15;i.EPSILON16=1e-16;i.EPSILON17=1e-17;i.EPSILON18=1e-18;i.EPSILON19=1e-19;i.EPSILON20=1e-20;i.GRAVITATIONALPARAMETER=3986004418e5;i.SOLAR_RADIUS=6955e5;i.LUNAR_RADIUS=1737400;i.SIXTY_FOUR_KILOBYTES=64*1024;i.sign=function(e){if(e>0){return 1}if(e<0){return-1}return 0};i.signNotZero=function(e){return e<0?-1:1};i.toSNorm=function(e){return Math.round((i.clamp(e,-1,1)*.5+.5)*255)};i.fromSNorm=function(e){return i.clamp(e,0,255)/255*2-1};i.sinh=function(e){var t=Math.pow(Math.E,e);var r=Math.pow(Math.E,-1*e);return(t-r)*.5};i.cosh=function(e){var t=Math.pow(Math.E,e);var r=Math.pow(Math.E,-1*e);return(t+r)*.5};i.lerp=function(e,t,r){return(1-r)*e+r*t};i.PI=Math.PI;i.ONE_OVER_PI=1/Math.PI;i.PI_OVER_TWO=Math.PI*.5;i.PI_OVER_THREE=Math.PI/3;i.PI_OVER_FOUR=Math.PI/4;i.PI_OVER_SIX=Math.PI/6;i.THREE_PI_OVER_TWO=3*Math.PI*.5;i.TWO_PI=2*Math.PI;i.ONE_OVER_TWO_PI=1/(2*Math.PI);i.RADIANS_PER_DEGREE=Math.PI/180;i.DEGREES_PER_RADIAN=180/Math.PI;i.RADIANS_PER_ARCSECOND=i.RADIANS_PER_DEGREE/3600;i.toRadians=function(e){if(!r(e)){throw new n(\"degrees is required.\")}return e*i.RADIANS_PER_DEGREE};i.toDegrees=function(e){if(!r(e)){throw new n(\"radians is required.\")}return e*i.DEGREES_PER_RADIAN};i.convertLongitudeRange=function(e){if(!r(e)){throw new n(\"angle is required.\")}var t=i.TWO_PI;var a=e-Math.floor(e/t)*t;if(a<-Math.PI){return a+t}if(a>=Math.PI){return a-t}return a};i.negativePiToPi=function(e){if(!r(e)){throw new n(\"x is required.\")}return i.zeroToTwoPi(e+i.PI)-i.PI};i.zeroToTwoPi=function(e){if(!r(e)){throw new n(\"x is required.\")}var t=i.mod(e,i.TWO_PI);if(Math.abs(t)<i.EPSILON14&&Math.abs(e)>i.EPSILON14){return i.TWO_PI}return t};i.mod=function(e,t){if(!r(e)){throw new n(\"m is required.\")}if(!r(t)){throw new n(\"n is required.\")}return(e%t+t)%t};i.equalsEpsilon=function(e,i,a,o){if(!r(e)){throw new n(\"left is required.\")}if(!r(i)){throw new n(\"right is required.\")}if(!r(a)){throw new n(\"relativeEpsilon is required.\")}o=t(o,a);var s=Math.abs(e-i);return s<=o||s<=a*Math.max(Math.abs(e),Math.abs(i))};var a=[1];i.factorial=function(e){if(typeof e!==\"number\"||e<0){throw new n(\"A number greater than or equal to 0 is required.\")}var t=a.length;if(e>=t){var r=a[t-1];for(var i=t;i<=e;i++){a.push(r*i)}}return a[e]};i.incrementWrap=function(e,i,a){a=t(a,0);if(!r(e)){throw new n(\"n is required.\")}if(i<=a){throw new n(\"maximumValue must be greater than minimumValue.\")}++e;if(e>i){e=a}return e};i.isPowerOfTwo=function(e){if(typeof e!==\"number\"||e<0){throw new n(\"A number greater than or equal to 0 is required.\")}return e!==0&&(e&e-1)===0};i.nextPowerOfTwo=function(e){if(typeof e!==\"number\"||e<0){throw new n(\"A number greater than or equal to 0 is required.\")}--e;e|=e>>1;e|=e>>2;e|=e>>4;e|=e>>8;e|=e>>16;++e;return e};i.clamp=function(e,t,i){if(!r(e)){throw new n(\"value is required\")}if(!r(t)){throw new n(\"min is required.\")}if(!r(i)){throw new n(\"max is required.\")}return e<t?t:e>i?i:e};var o=new e;i.setRandomNumberSeed=function(t){if(!r(t)){throw new n(\"seed is required.\")}o=new e(t)};i.nextRandomNumber=function(){return o.random()};i.acosClamped=function(e){if(!r(e)){throw new n(\"value is required.\")}return Math.acos(i.clamp(e,-1,1))};i.asinClamped=function(e){if(!r(e)){throw new n(\"value is required.\")}return Math.asin(i.clamp(e,-1,1))};i.chordLength=function(e,t){if(!r(e)){throw new n(\"angle is required.\")}if(!r(t)){throw new n(\"radius is required.\")}return 2*t*Math.sin(e*.5)};i.logBase=function(e,t){if(!r(e)){throw new n(\"number is required.\")}if(!r(t)){throw new n(\"base is required.\")}return Math.log(e)/Math.log(t)};i.fog=function(e,t){var r=e*t;return 1-Math.exp(-(r*r))};return i})})();(function(){var t=e.amdDefine;t(\"2c\",[\"23\",\"1a\",\"1c\",\"1f\",\"27\"],function(e,t,r,n,i){\"use strict\";function a(t,r,n){this.x=e(t,0);this.y=e(r,0);this.z=e(n,0)}a.fromSpherical=function(n,i){if(!t(n)){throw new r(\"spherical is required\")}if(!t(i)){i=new a}var o=n.clock;var s=n.cone;var u=e(n.magnitude,1);var f=u*Math.sin(s);i.x=f*Math.cos(o);i.y=f*Math.sin(o);i.z=u*Math.cos(s);return i};a.fromElements=function(e,r,n,i){if(!t(i)){return new a(e,r,n)}i.x=e;i.y=r;i.z=n;return i};a.clone=function(e,r){if(!t(e)){return undefined}if(!t(r)){return new a(e.x,e.y,e.z)}r.x=e.x;r.y=e.y;r.z=e.z;return r};a.fromCartesian4=a.clone;a.packedLength=3;a.pack=function(n,i,a){if(!t(n)){throw new r(\"value is required\")}if(!t(i)){throw new r(\"array is required\")}a=e(a,0);i[a++]=n.x;i[a++]=n.y;i[a]=n.z};a.unpack=function(n,i,o){if(!t(n)){throw new r(\"array is required\")}i=e(i,0);if(!t(o)){o=new a}o.x=n[i++];o.y=n[i++];o.z=n[i];return o};a.packArray=function(e,n){if(!t(e)){throw new r(\"array is required\")}var i=e.length;if(!t(n)){n=new Array(i*3)}else{n.length=i*3}for(var o=0;o<i;++o){a.pack(e[o],n,o*3)}return n};a.unpackArray=function(e,n){if(!t(e)){throw new r(\"array is required\")}var i=e.length;if(!t(n)){n=new Array(i/3)}else{n.length=i/3}for(var o=0;o<i;o+=3){var s=o/3;n[s]=a.unpack(e,o,n[s])}return n};a.fromArray=a.unpack;a.maximumComponent=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return Math.max(e.x,e.y,e.z)};a.minimumComponent=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return Math.min(e.x,e.y,e.z)};a.minimumByComponent=function(e,n,i){if(!t(e)){throw new r(\"first is required.\")}if(!t(n)){throw new r(\"second is required.\")}if(!t(i)){throw new r(\"result is required.\")}i.x=Math.min(e.x,n.x);i.y=Math.min(e.y,n.y);i.z=Math.min(e.z,n.z);return i};a.maximumByComponent=function(e,n,i){if(!t(e)){throw new r(\"first is required.\")}if(!t(n)){throw new r(\"second is required.\")}if(!t(i)){throw new r(\"result is required.\")}i.x=Math.max(e.x,n.x);i.y=Math.max(e.y,n.y);i.z=Math.max(e.z,n.z);return i};a.magnitudeSquared=function(e){if(!t(e)){throw new r(\"cartesian is required\")}return e.x*e.x+e.y*e.y+e.z*e.z};a.magnitude=function(e){return Math.sqrt(a.magnitudeSquared(e))};var o=new a;a.distance=function(e,n){if(!t(e)||!t(n)){throw new r(\"left and right are required.\")}a.subtract(e,n,o);return a.magnitude(o)};a.distanceSquared=function(e,n){if(!t(e)||!t(n)){throw new r(\"left and right are required.\")}a.subtract(e,n,o);return a.magnitudeSquared(o)};a.normalize=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}var i=a.magnitude(e);n.x=e.x/i;n.y=e.y/i;n.z=e.z/i;return n};a.dot=function(e,n){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}return e.x*n.x+e.y*n.y+e.z*n.z};a.multiplyComponents=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x*n.x;i.y=e.y*n.y;i.z=e.z*n.z;return i};a.add=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x+n.x;i.y=e.y+n.y;i.z=e.z+n.z;return i};a.subtract=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x-n.x;i.y=e.y-n.y;i.z=e.z-n.z;return i};a.multiplyByScalar=function(e,n,i){if(!t(e)){throw new r(\"cartesian is required\")}if(typeof n!==\"number\"){throw new r(\"scalar is required and must be a number.\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x*n;i.y=e.y*n;i.z=e.z*n;return i};a.divideByScalar=function(e,n,i){if(!t(e)){throw new r(\"cartesian is required\")}if(typeof n!==\"number\"){throw new r(\"scalar is required and must be a number.\")}if(!t(i)){throw new r(\"result is required\")}i.x=e.x/n;i.y=e.y/n;i.z=e.z/n;return i};a.negate=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}n.x=-e.x;n.y=-e.y;n.z=-e.z;return n};a.abs=function(e,n){if(!t(e)){throw new r(\"cartesian is required\")}if(!t(n)){throw new r(\"result is required\")}n.x=Math.abs(e.x);n.y=Math.abs(e.y);n.z=Math.abs(e.z);return n};var s=new a;a.lerp=function(e,n,i,o){if(!t(e)){throw new r(\"start is required.\")}if(!t(n)){throw new r(\"end is required.\")}if(typeof i!==\"number\"){throw new r(\"t is required and must be a number.\")}if(!t(o)){throw new r(\"result is required.\")}a.multiplyByScalar(n,i,s);o=a.multiplyByScalar(e,1-i,o);return a.add(s,o,o)};var u=new a;var f=new a;a.angleBetween=function(e,n){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}a.normalize(e,u);a.normalize(n,f);var i=a.dot(u,f);var o=a.magnitude(a.cross(u,f,u));return Math.atan2(o,i)};var c=new a;a.mostOrthogonalAxis=function(e,n){if(!t(e)){throw new r(\"cartesian is required.\")}if(!t(n)){throw new r(\"result is required.\")}var i=a.normalize(e,c);a.abs(i,i);if(i.x<=i.y){if(i.x<=i.z){n=a.clone(a.UNIT_X,n)}else{n=a.clone(a.UNIT_Z,n)}}else{if(i.y<=i.z){n=a.clone(a.UNIT_Y,n)}else{n=a.clone(a.UNIT_Z,n)}}return n};a.equals=function(e,r){return e===r||t(e)&&t(r)&&e.x===r.x&&e.y===r.y&&e.z===r.z};a.equalsArray=function(e,t,r){return e.x===t[r]&&e.y===t[r+1]&&e.z===t[r+2]};a.equalsEpsilon=function(e,r,n,a){return e===r||t(e)&&t(r)&&i.equalsEpsilon(e.x,r.x,n,a)&&i.equalsEpsilon(e.y,r.y,n,a)&&i.equalsEpsilon(e.z,r.z,n,a)};a.cross=function(e,n,i){if(!t(e)){throw new r(\"left is required\")}if(!t(n)){throw new r(\"right is required\")}if(!t(i)){throw new r(\"result is required\")}var a=e.x;var o=e.y;var s=e.z;var u=n.x;var f=n.y;var c=n.z;var l=o*c-s*f;var d=s*u-a*c;var h=a*f-o*u;i.x=l;i.y=d;i.z=h;return i};a.fromDegrees=function(e,n,o,s,u){if(!t(e)){throw new r(\"longitude is required\")}if(!t(n)){throw new r(\"latitude is required\")}var f=i.toRadians(e);var c=i.toRadians(n);return a.fromRadians(f,c,o,s,u)};var l=new a;var d=new a;var h=new a(6378137*6378137,6378137*6378137,6356752.314245179*6356752.314245179);a.fromRadians=function(n,i,o,s,u){if(!t(n)){throw new r(\"longitude is required\")}if(!t(i)){throw new r(\"latitude is required\")}o=e(o,0);var f=t(s)?s.radiiSquared:h;var c=Math.cos(i);l.x=c*Math.cos(n);l.y=c*Math.sin(n);l.z=Math.sin(i);l=a.normalize(l,l);a.multiplyComponents(f,l,d);var v=Math.sqrt(a.dot(l,d));d=a.divideByScalar(d,v,d);l=a.multiplyByScalar(l,o,l);if(!t(u)){u=new a}return a.add(d,l,u)};a.fromDegreesArray=function(e,n,o){if(!t(e)){throw new r(\"positions is required.\")}var s=new Array(e.length);for(var u=0;u<e.length;u++){s[u]=i.toRadians(e[u])}return a.fromRadiansArray(s,n,o)};a.fromRadiansArray=function(e,n,i){if(!t(e)){throw new r(\"positions is required.\")}if(e.length<2){throw new r(\"positions length cannot be less than 2.\")}if(e.length%2!==0){throw new r(\"positions length must be a multiple of 2.\")}var o=e.length;if(!t(i)){i=new Array(o/2)}else{i.length=o/2}for(var s=0;s<o;s+=2){var u=e[s];var f=e[s+1];i[s/2]=a.fromRadians(u,f,0,n,i[s/2])}return i};a.fromDegreesArrayHeights=function(e,n,o){if(!t(e)){throw new r(\"positions is required.\")}if(e.length<3){throw new r(\"positions length cannot be less than 3.\")}if(e.length%3!==0){throw new r(\"positions length must be a multiple of 3.\")}var s=new Array(e.length);for(var u=0;u<e.length;u+=3){s[u]=i.toRadians(e[u]);s[u+1]=i.toRadians(e[u+1]);s[u+2]=e[u+2]}return a.fromRadiansArrayHeights(s,n,o)};a.fromRadiansArrayHeights=function(e,n,i){if(!t(e)){throw new r(\"positions is required.\")}if(e.length<3){throw new r(\"positions length cannot be less than 3.\")}if(e.length%3!==0){throw new r(\"positions length must be a multiple of 3.\")}var o=e.length;if(!t(i)){i=new Array(o/3)}else{i.length=o/3}for(var s=0;s<o;s+=3){var u=e[s];var f=e[s+1];var c=e[s+2];i[s/3]=a.fromRadians(u,f,c,n,i[s/3])}return i};a.ZERO=n(new a(0,0,0));a.UNIT_X=n(new a(1,0,0));a.UNIT_Y=n(new a(0,1,0));a.UNIT_Z=n(new a(0,0,1));a.prototype.clone=function(e){return a.clone(this,e)};a.prototype.equals=function(e){return a.equals(this,e)};a.prototype.equalsEpsilon=function(e,t,r){return a.equalsEpsilon(this,e,t,r)};a.prototype.toString=function(){return\"(\"+this.x+\", \"+this.y+\", \"+this.z+\")\"};return a})})();(function(){var t=e.amdDefine;t(\"1c\",[\"1a\"],function(e){\"use strict\";function t(e){this.name=\"DeveloperError\";this.message=e;var t;try{throw new Error}catch(e){t=e.stack}this.stack=t}if(e(Object.create)){t.prototype=Object.create(Error.prototype);t.prototype.constructor=t}t.prototype.toString=function(){var t=this.name+\": \"+this.message;if(e(this.stack)){t+=\"\\n\"+this.stack.toString()}return t};t.throwInstantiationError=function(){throw new t(\"This function defines an interface and should not be called directly.\")};return t})})();(function(){var t=e.amdDefine;t(\"1a\",[],function(){\"use strict\";function e(e){return e!==undefined&&e!==null}return e})})();(function(){var t=e.amdDefine;t(\"1f\",[\"1a\"],function(e){\"use strict\";var t=Object.freeze;if(!e(t)){t=function(e){return e}}return t})})();(function(){var t=e.amdDefine;t(\"44\",[\"2c\",\"1a\",\"1c\",\"1f\"],function(e,t,r,n){\"use strict\";function i(n,i){if(!t(n)){throw new r(\"normal is required.\")}if(!t(i)){throw new r(\"distance is required.\")}this.normal=e.clone(n);this.distance=i}i.fromPointNormal=function(n,a,o){if(!t(n)){throw new r(\"point is required.\")}if(!t(a)){throw new r(\"normal is required.\")}var s=-e.dot(a,n);if(!t(o)){return new i(a,s)}e.clone(a,o.normal);o.distance=s;return o};var a=new e;i.fromCartesian4=function(n,o){if(!t(n)){throw new r(\"coefficients is required.\")}var s=e.fromCartesian4(n,a);var u=n.w;if(!t(o)){return new i(s,u)}else{e.clone(s,o.normal);o.distance=u;return o}};i.getPointDistance=function(n,i){if(!t(n)){throw new r(\"plane is required.\")}if(!t(i)){throw new r(\"point is required.\")}return e.dot(n.normal,i)+n.distance};i.ORIGIN_XY_PLANE=n(new i(e.UNIT_Z,0));i.ORIGIN_YZ_PLANE=n(new i(e.UNIT_X,0));i.ORIGIN_ZX_PLANE=n(new i(e.UNIT_Y,0));return i})})();(function(){var t=e.amdDefine;t(\"6e\",[\"2c\",\"3b\",\"23\",\"1a\",\"1c\",\"3c\",\"66\",\"6b\",\"6c\",\"27\",\"33\",\"44\"],function(e,t,r,n,i,a,o,s,u,f,c,l){\"use strict\";var d={};d.numberOfPoints=function(t,r,n){var i=e.distance(t,r);return Math.ceil(i/n)};var h=new t;d.extractHeights=function(e,t){var r=e.length;var n=new Array(r);for(var i=0;i<r;i++){var a=e[i];n[i]=t.cartesianToCartographic(a,h).height}return n};var v=new c;var p=new e;var m=new e;var w=new l(e.ZERO,0);var y=new e;var g=new l(e.ZERO,0);var S=new e;var b=new e;var T=[];function _(e,t,r){var n=T;n.length=e;var i;if(t===r){for(i=0;i<e;i++){n[i]=t}return n}var a=r-t;var o=a/e;for(i=0;i<e;i++){var s=t+i*o;n[i]=s}return n}var E=new t;var M=new t;var P=new e;var A=new e;var C=new e;var I=new o;function x(t,r,n,i,a,o,s,u){var f=i.scaleToGeodeticSurface(t,A);var c=i.scaleToGeodeticSurface(r,C);var l=d.numberOfPoints(t,r,n);var h=i.cartesianToCartographic(f,E);var v=i.cartesianToCartographic(c,M);var p=_(l,a,o);I.setEndPoints(h,v);var m=I.surfaceDistance/l;var w=u;h.height=a;var y=i.cartographicToCartesian(h,P);e.pack(y,s,w);w+=3;for(var g=1;g<l;g++){var S=I.interpolateUsingSurfaceDistance(g*m,M);S.height=p[g];y=i.cartographicToCartesian(S,P);e.pack(y,s,w);w+=3}return w}d.wrapLongitude=function(t,i){var a=[];var o=[];if(n(t)&&t.length>0){i=r(i,c.IDENTITY);var u=c.inverseTransformation(i,v);var f=c.multiplyByPoint(u,e.ZERO,p);var d=c.multiplyByPointAsVector(u,e.UNIT_Y,m);var h=l.fromPointNormal(f,d,w);var T=c.multiplyByPointAsVector(u,e.UNIT_X,y);var _=l.fromPointNormal(f,T,g);var E=1;a.push(e.clone(t[0]));var M=a[0];var P=t.length;for(var A=1;A<P;++A){var C=t[A];if(l.getPointDistance(_,M)<0||l.getPointDistance(_,C)<0){var I=s.lineSegmentPlane(M,C,h,S);if(n(I)){var x=e.multiplyByScalar(d,5e-9,b);if(l.getPointDistance(h,M)<0){e.negate(x,x)}a.push(e.add(I,x,new e));o.push(E+1);e.negate(x,x);a.push(e.add(I,x,new e));E=1}}a.push(e.clone(t[A]));E++;M=C}o.push(E)}return{positions:a,lengths:o}};d.generateArc=function(t){if(!n(t)){t={}}var o=t.positions;if(!n(o)){throw new i(\"options.positions is required.\")}var s=o.length;var c=r(t.ellipsoid,a.WGS84);var l=r(t.height,0);if(s<1){return[]}else if(s===1){var h=c.scaleToGeodeticSurface(o[0],A);if(l!==0){var v=c.geodeticSurfaceNormal(h,P);e.multiplyByScalar(v,l,v);e.add(h,v,h)}return[h.x,h.y,h.z]}var p=t.minDistance;if(!n(p)){var m=r(t.granularity,f.RADIANS_PER_DEGREE);p=f.chordLength(m,c.maximumRadius)}var w=0;var y;for(y=0;y<s-1;y++){w+=d.numberOfPoints(o[y],o[y+1],p)}var g=(w+1)*3;var S=new Array(g);var b=0;var _=u(l);for(y=0;y<s-1;y++){var M=o[y];var C=o[y+1];var I=_?l[y]:l;var R=_?l[y+1]:l;b=x(M,C,p,c,I,R,S,b)}T.length=0;var O=o[s-1];var D=c.cartesianToCartographic(O,E);D.height=_?l[s-1]:l;var q=c.cartographicToCartesian(D,P);e.pack(q,S,g-3);return S};d.generateCartesianArc=function(t){var r=d.generateArc(t);var n=r.length/3;var i=new Array(n);for(var a=0;a<n;a++){i[a]=e.unpack(r,a*3)}return i};return d})})();e.register(\"6f\",[\"a\"],function(e,t){\"use strict\";var r=t&&t.id;var n;var i;function a(e,t){var r=e._times;var i=~n.binarySearch(r,t,n.JulianDate.compare);if(i>0){r.splice(0,i);e._values.splice(0,i*e._innerType.packedLength);e._updateTableLength=true;e._definitionChanged.raiseEvent(e)}}function o(e,t){if(t===undefined)return;var r=e._times.length-t;if(r>0){e._times.splice(0,r);e._values.splice(0,r*e._innerType.packedLength);e._updateTableLength=true}}return{setters:[function(e){n=e}],execute:function(){i=function(e,t){return function(){var r=e.apply(this,arguments);t.call(this,r);return r}};n.SampledProperty.prototype.removeSamplesBeforeDate=function(e){a(this,e)};n.SampledPositionProperty.prototype.removeSamplesBeforeDate=function(e){a(this._property,e)};n.SampledProperty.prototype.addSample=i(n.SampledProperty.prototype.addSample,function(){o(this,this.maxNumSamples)});n.SampledProperty.prototype.addSamples=i(n.SampledProperty.prototype.addSamples,function(){o(this,this.maxNumSamples)});n.SampledProperty.prototype.addSamplesPackedArray=i(n.SampledProperty.prototype.addSamplesPackedArray,function(){o(this,this.maxNumSamples)});n.SampledPositionProperty.prototype.addSample=i(n.SampledPositionProperty.prototype.addSample,function(){o(this._property,this.maxNumSamples)});n.SampledPositionProperty.prototype.addSamples=i(n.SampledPositionProperty.prototype.addSamples,function(){o(this._property,this.maxNumSamples)});n.SampledPositionProperty.prototype.addSamplesPackedArray=i(n.SampledPositionProperty.prototype.addSamplesPackedArray,function(){o(this._property,this.maxNumSamples)})}}});e.register(\"a\",[\"4c\",\"19\",\"45\",\"2c\",\"43\",\"21\",\"22\",\"25\",\"2b\",\"2f\",\"26\",\"23\",\"1a\",\"1c\",\"3c\",\"28\",\"29\",\"1d\",\"4a\",\"3a\",\"3d\",\"24\",\"27\",\"32\",\"33\",\"3e\",\"3f\",\"40\",\"2e\",\"36\",\"34\",\"46\",\"2d\",\"47\",\"48\",\"49\",\"35\",\"64\",\"6e\",\"6f\"],function(e,t){\"use strict\";var r=t&&t.id;return{setters:[function(t){e({binarySearch:t[\"default\"]})},function(t){e({CallbackProperty:t[\"default\"]})},function(t){e({Cartesian2:t[\"default\"]})},function(t){e({Cartesian3:t[\"default\"]})},function(t){e({Cartesian4:t[\"default\"]})},function(t){e({Clock:t[\"default\"]})},function(t){e({ClockStep:t[\"default\"]})},function(t){e({CompositeEntityCollection:t[\"default\"]})},function(t){e({ConstantPositionProperty:t[\"default\"]})},function(t){e({ConstantProperty:t[\"default\"]})},function(t){e({createGuid:t[\"default\"]})},function(t){e({defaultValue:t[\"default\"]})},function(t){e({defined:t[\"default\"]})},function(t){e({DeveloperError:t[\"default\"]})},function(t){e({Ellipsoid:t[\"default\"]})},function(t){e({Entity:t[\"default\"]})},function(t){e({EntityCollection:t[\"default\"]})},function(t){e({Event:t[\"default\"]})},function(t){e({ExtrapolationType:t[\"default\"]})},function(t){e({GeographicProjection:t[\"default\"]})},function(t){e({HermitePolynomialApproximation:t[\"default\"]})},function(t){e({JulianDate:t[\"default\"]})},function(t){e({CesiumMath:t[\"default\"]})},function(t){e({Matrix3:t[\"default\"]})},function(t){e({Matrix4:t[\"default\"]})},function(t){e({OrientationProperty:t[\"default\"]})},function(t){e({PerspectiveFrustum:t[\"default\"]})},function(t){e({PerspectiveOffCenterFrustum:t[\"default\"]})},function(t){e({PositionProperty:t[\"default\"]})},function(t){e({Property:t[\"default\"]})},function(t){e({Quaternion:t[\"default\"]})},function(t){e({ReferenceEntity:t[\"default\"]})},function(t){e({ReferenceFrame:t[\"default\"]})},function(t){e({ReferenceProperty:t[\"default\"]})},function(t){e({SampledPositionProperty:t[\"default\"]})},function(t){e({SampledProperty:t[\"default\"]})},function(t){e({Transforms:t[\"default\"]})},function(t){e({Simon1994PlanetaryPositions:t[\"default\"]})},function(t){e({PolylinePipeline:t[\"default\"]})},function(e){}],execute:function(){}}});e.register(\"12\",[\"1d\",\"a\"],function(e,t){\"use strict\";var r=t&&t.id;var n,i;var a,o,s,u,f,c,l,d,h,v,p;function m(e){var t=[];var r=e;while(i.defined(r)){t.unshift(r);var n=r.position;r=n&&n.referenceFrame}return t}e(\"getAncestorReferenceFrames\",m);function w(e){return m(e)[0]}e(\"getRootReferenceFrame\",w);function y(e,t,r,n){return e.position&&e.position.getValueInReferenceFrame(t,r,n)}e(\"getEntityPositionInReferenceFrame\",y);function g(e,t,r,n){var a=e.position&&e.position.referenceFrame;if(!i.defined(a))return undefined;var o=e.orientation&&e.orientation.getValue(t,n);if(!i.defined(o))return undefined;return i.OrientationProperty.convertToReferenceFrame(t,o,a,r,n)}e(\"getEntityOrientationInReferenceFrame\",g);function S(e,t,r){var n=r?r:w(e);var a=y(e,t,n,{});if(!a)return undefined;var o=g(e,t,n,{});if(!o)return undefined;return{p:i.Cartesian3.ZERO.equalsEpsilon(a,i.CesiumMath.EPSILON16)?0:a,o:i.Quaternion.IDENTITY.equalsEpsilon(o,i.CesiumMath.EPSILON16)?0:o,r:typeof n===\"number\"?n:n.id}}e(\"getSerializedEntityPose\",S);function b(e){if(!f)throw new Error(\"resolveURL requires DOM api\");if(e===undefined)throw new Error(\"Expected inURL\");f.href=\"\";f.href=e;return f.href}e(\"resolveURL\",b);function T(e){if(!f)throw new Error(\"parseURL requires DOM api\");if(e===undefined)throw new Error(\"Expected inURL\");f.href=\"\";f.href=e;return{href:f.href,protocol:f.protocol,hostname:f.hostname,port:f.port,pathname:f.pathname,search:f.search,hash:f.hash,host:f.host}}e(\"parseURL\",T);function _(e,t){var r=e[i.Matrix4.COLUMN0ROW0];var n=e[i.Matrix4.COLUMN1ROW1];var a=e[i.Matrix4.COLUMN2ROW0];var o=e[i.Matrix4.COLUMN2ROW1];var s=e[i.Matrix4.COLUMN2ROW2];var u=e[i.Matrix4.COLUMN3ROW2];var f=t.near=u/(s-1);t.far=u/(s+1);t.bottom=f*(o-1)/n;t.top=f*(o+1)/n;t.left=f*(a-1)/r;t.right=f*(a+1)/r;return t}e(\"decomposePerspectiveOffCenterProjectionMatrix\",_);function E(e,t){var r=_(e,h);var n=(r.left+r.right)/2;var i=(r.top+r.bottom)/2;var a=r.near;var o=r.far;var s=r.right-n;var u=r.top-i;var f=s/u;var c=2*Math.atan(u/a);var l;if(f<1){l=c}else{l=Math.atan(Math.tan(c*.5)*f)*2}t.near=a;t.far=o;t.fov=l;t.aspectRatio=f;t.xOffset=n;t.yOffset=i;return t}e(\"decomposePerspectiveProjectionMatrix\",E);function M(e,t,r){if(!e.position||!(e.position instanceof i.ConstantPositionProperty)||!e.orientation||!(e.orientation instanceof i.ConstantProperty)){return false}if(!y(e,t,r,v)){return false}if(!g(e,t,r,p)){return false}e.position.setValue(v,r);e.orientation.setValue(p);return true}e(\"convertEntityReferenceFrame\",M);return{setters:[function(e){n=e},function(e){i=e}],execute:function(){a=function(){function e(){this._event=new n.default}Object.defineProperty(e.prototype,\"numberOfListeners\",{get:function(){return this._event.numberOfListeners},enumerable:true,configurable:true});e.prototype.addEventListener=function(e){return this._event.addEventListener(e)};e.prototype.removeEventListener=function(e){return this._event.removeEventListener(e)};e.prototype.raiseEvent=function(e){this._event.raiseEvent(e)};return e}();e(\"Event\",a);o=function(){function e(){var e=this;this._queue=[];this._paused=true;this.errorEvent=new a;this.errorEvent.addEventListener(function(t){if(e.errorEvent.numberOfListeners===1)console.error(t)})}e.prototype.push=function(e,t){var r=this;var n=new Promise(function(t,n){r._queue.push({command:e,reject:n,execute:function(){var r=Promise.resolve().then(e);t(r);return r}})});if(t)this.execute();return n};e.prototype.execute=function(){var e=this;this._paused=false;Promise.resolve().then(function(){if(e._queue.length>0&&!e._currentCommandPending){e._executeNextCommand()}})};e.prototype.pause=function(){this._paused=true};e.prototype.clear=function(){this._queue.forEach(function(e){e.reject(\"Unable to execute.\")});this._queue=[]};e.prototype._executeNextCommand=function(){var e=this;this._currentCommand=undefined;this._currentCommandPending=undefined;if(this._paused)return;var t=this._queue.shift();if(!t)return;this._currentCommand=t.command;this._currentCommandPending=t.execute().then(this._executeNextCommand.bind(this)).catch(function(t){e.errorEvent.raiseEvent(t);e._executeNextCommand()})};return e}();e(\"CommandQueue\",o);e(\"getEntityPosition\",s=y);e(\"getEntityOrientation\",u=g);f=typeof document!==\"undefined\"?document.createElement(\"a\"):undefined;c=function(){function e(){var e=this;var t=true;var r;var n;var i;r=new Promise(function(r){e.port1={set onmessage(e){i=e;r()},get onmessage(){return i},postMessage:function(r){if(t){n.then(function(){if(e.port2.onmessage)e.port2.onmessage({data:r})})}},close:function(){t=false}}});var a;n=new Promise(function(n){e.port2={set onmessage(e){a=e;n()},get onmessage(){return a},postMessage:function(n){if(t){r.then(function(){if(e.port1.onmessage)e.port1.onmessage({data:n})})}},close:function(){t=false}}})}return e}();e(\"MessageChannelLike\",c);l=function(){function e(){var e=this;var t=[];var r=function(e){t.push(e)};e.port1={get onmessage(){return r},set onmessage(e){r=e;t.forEach(function(t){return e(t)});t=[]},postMessage:function(t){if(e.port2.onmessage)e.port2.onmessage({data:t})},close:function(){e.port1.onmessage=undefined;e.port2.onmessage=undefined}};var n=[];var i=function(e){n.push(e)};e.port2={get onmessage(){return i},set onmessage(e){i=e;n.forEach(function(t){return e(t)});n=[]},postMessage:function(t){if(e.port1.onmessage)e.port1.onmessage({data:t})},close:function(){e.port1.onmessage=undefined;e.port2.onmessage=undefined}}}return e}();e(\"SynchronousMessageChannel\",l);d=function(){function e(){}e.prototype.create=function(){if(typeof MessageChannel!==\"undefined\")return new MessageChannel;else return new c};e.prototype.createSynchronous=function(){return new l};return e}();e(\"MessageChannelFactory\",d);h=new i.PerspectiveOffCenterFrustum;v=new i.Cartesian3;p=new i.Quaternion}}});e.register(\"1\",[\"2\",\"c\",\"a\",\"7\",\"10\",\"f\",\"b\",\"9\",\"14\",\"11\",\"d\",\"17\",\"13\",\"e\",\"15\",\"18\",\"12\"],function(e,t){\"use strict\";var r=t&&t.id;var n,i,a,o,s,u,f,c,l,d,h,v,p,m,w;var y;function g(e){var t=e===void 0?{}:e,r=t.configuration,i=t.container,a=i===void 0?new n.Container:i;var o;if(typeof HTMLElement===\"undefined\"){o=s.Role.REALITY_MANAGER}else if(navigator.userAgent.indexOf(\"Argon\")>0||window.top!==window){o=s.Role.APPLICATION}else{o=s.Role.REALITY_MANAGER}var u=Object.assign(r||{},{role:o});a.registerInstance(\"containerElement\",null);return new y(u,a)}e(\"init\",g);function S(e){var t=e===void 0?{}:e,r=t.configuration,i=t.container,a=i===void 0?new n.Container:i;var o=Object.assign(r||{},{role:s.Role.REALITY_VIEW,\"reality.supportsControlPort\":true});a.registerInstance(\"containerElement\",null);return new y(o,a)}e(\"initReality\",S);function b(e){var t=e.containerElement,r=e.configuration,i=e.container,a=i===void 0?new n.Container:i;var o=Object.assign(r||{},{role:s.Role.REALITY_MANAGER});a.registerInstance(\"containerElement\",t);return new y(o,a)}e(\"initLocal\",b);var T={ArgonSystem:true,init:true,initReality:true,initLocal:true,DI:true,Cesium:true,URI:true,EmptyRealityLoader:true,LiveVideoRealityLoader:true,HostedRealityLoader:true\n};function _(t){var r={};for(var n in t){if(n!==\"default\"&&!T.hasOwnProperty(n))r[n]=t[n]}e(r)}return{setters:[function(e){},function(e){n=e},function(e){i=e},function(e){a=e},function(e){o=e;_(e)},function(e){s=e;_(e)},function(e){u=e;_(e)},function(e){f=e;_(e)},function(e){c=e;_(e)},function(e){l=e;_(e)},function(e){d=e;_(e)},function(e){h=e;_(e)},function(e){v=e;_(e)},function(e){p=e},function(e){m=e},function(e){w=e},function(e){_(e)}],execute:function(){e(\"DI\",n);e(\"Cesium\",i);e(\"URI\",a);e(\"EmptyRealityLoader\",p.EmptyRealityLoader);e(\"LiveVideoRealityLoader\",m.LiveVideoRealityLoader);e(\"HostedRealityLoader\",w.HostedRealityLoader);y=function(){function e(t,r){if(r===void 0){r=new n.Container}this.container=r;if(!e.instance)e.instance=this;r.registerInstance(\"config\",t);r.registerInstance(e,this);if(!r.hasResolver(\"containerElement\"))r.registerInstance(\"containerElement\",null);if(t.role===s.Role.REALITY_MANAGER){r.registerSingleton(o.ConnectService,o.LoopbackConnectService)}else if(o.WKWebViewConnectService.isAvailable()){r.registerSingleton(o.ConnectService,o.WKWebViewConnectService)}else if(o.DOMConnectService.isAvailable()){r.registerSingleton(o.ConnectService,o.DOMConnectService)}else if(o.DebugConnectService.isAvailable()){r.registerSingleton(o.ConnectService,o.DebugConnectService)}if(t.role===s.Role.REALITY_MANAGER){this.reality.registerLoader(r.get(p.EmptyRealityLoader));this.reality.registerLoader(r.get(m.LiveVideoRealityLoader));if(typeof document!==\"undefined\"){this.reality.registerLoader(r.get(w.HostedRealityLoader));r.get(h.PinchZoomService)}this.reality.setDefault(s.RealityView.EMPTY)}for(var i=0,a=Object.keys(e.prototype);i<a.length;i++){var u=a[i];this[u]}this.session.connect()}Object.defineProperty(e.prototype,\"context\",{get:function(){return this.container.get(u.ContextService)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"device\",{get:function(){return this.container.get(f.DeviceService)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"focus\",{get:function(){return this.container.get(c.FocusService)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"reality\",{get:function(){return this.container.get(l.RealityService)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"session\",{get:function(){return this.container.get(o.SessionService)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"timer\",{get:function(){return this.container.get(d.TimerService)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"view\",{get:function(){return this.container.get(h.ViewService)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"vuforia\",{get:function(){return this.container.get(v.VuforiaService)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"updateEvent\",{get:function(){return this.context.updateEvent},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"renderEvent\",{get:function(){return this.context.renderEvent},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"focusEvent\",{get:function(){return this.focus.focusEvent},enumerable:true,configurable:true});Object.defineProperty(e.prototype,\"blurEvent\",{get:function(){return this.focus.blurEvent},enumerable:true,configurable:true});return e}();e(\"ArgonSystem\",y)}}})})(function(e){if(typeof define==\"function\"&&define.amd)define([],e);else if(typeof module==\"object\"&&module.exports&&typeof require==\"function\")module.exports=e();else Argon=e()});\n(function () {\n\n// here we are using pure Cesium and THREE functions.\n// should consider adding in SunCalc (https://github.com/mourner/suncalc) support, to get\n// some more information about sun/moon,  such as time of day and phase of moon\n\nvar Cesium = Argon.Cesium;\nvar Cartesian3 = Cesium.Cartesian3;\nvar Simon1994PlanetaryPositions = Cesium.Simon1994PlanetaryPositions;\nvar JulianDate = Cesium.JulianDate;\nvar CesiumMath = Cesium.CesiumMath;\nvar Transforms = Cesium.Transforms;\nvar ReferenceFrame = Cesium.ReferenceFrame;\n\n// Add function to argon to get the Sun and Moon entities, and to update them\nArgon.GetSunMoon = function () {\n    var moonEntity = new Cesium.Entity({\n        name: \"moon\",\n        position: Cartesian3.ZERO,\n        orientation: Cesium.Quaternion.IDENTITY\n    });\n    var sunEntity = new Cesium.Entity({\n        name: \"sun\",\n        position: Cartesian3.ZERO,\n        orientation: Cesium.Quaternion.IDENTITY\n    });\n\n    return function () {\n        return { moon: moonEntity, sun: sunEntity}\n    };\n}();\n\nArgon.UpdateSunMoon = function() {\n    var icrfToFixed = new Cesium.Matrix3();\n    var entities = Argon.GetSunMoon();\n\n    return function (date, frame) {\n        if (!Cesium.defined(Transforms.computeIcrfToFixedMatrix(date, icrfToFixed))) {\n            Transforms.computeTemeToPseudoFixedMatrix(date, icrfToFixed);\n        }\n\n        var retVal = {\n            sun: new Cesium.Cartesian3(),\n            moon: new Cesium.Cartesian3()\n        }\n\n        var translation = Simon1994PlanetaryPositions.computeMoonPositionInEarthInertialFrame(date, retVal.moon);\n        Cesium.Matrix3.multiplyByVector(icrfToFixed, translation, translation);\n        entities.moon.position.setValue(translation, ReferenceFrame.FIXED);\n        if (frame != ReferenceFrame.FIXED) {\n            translation = entities.moon.position.getValueInReferenceFrame(date, frame);\n            if (translation) {\n                entities.moon.position.setValue(translation, frame);\n                translation.clone(retVal.moon);\n            } else {\n                retVal.moon.x = retVal.moon.z = 0;\n                retVal.moon.y = -1;\n            }\n        }\n\n        translation = Simon1994PlanetaryPositions.computeSunPositionInEarthInertialFrame(date, retVal.sun);\n        Cesium.Matrix3.multiplyByVector(icrfToFixed, translation, translation);\n        entities.sun.position.setValue(translation, ReferenceFrame.FIXED);\n        if (frame != ReferenceFrame.FIXED) {\n            translation = entities.sun.position.getValueInReferenceFrame(date, frame);\n            if (translation) {\n                entities.sun.position.setValue(translation, frame);\n                translation.clone(retVal.sun);\n            } else {\n                retVal.sun.x = retVal.sun.z = 0;\n                retVal.sun.y = 1;\n            }\n        }\n\n        return retVal;\n    }\n}();\n\nif (typeof(THREE) !== 'undefined') {\n\n    // if we're using THREE, let's create an object that we can use to retrieve \n    // directional lights associated with the  \n\n    THREE.SunMoonLights = function () {\n        // get the natural light entities, make them available\n        this.entities = Argon.GetSunMoon();\n\n        // make the moon a dimmer, bluish light.  Not really correct, but a start\n        var moonlight = new THREE.DirectionalLight(0x9999aa, 0.25);\n        var sunlight = new THREE.DirectionalLight(0xffffff, 1.0);\n        this.moon = moonlight;\n        this.sun = sunlight;\n        \n        // make the lights visible from outside\n        lights = new THREE.Object3D();\n        this.lights = lights;\n\n        var lastTime = null;\n        this.update = function(date, frame) {\n            if (!lastTime || JulianDate.secondsDifference(date,lastTime) > 1) {            \n                if (!lastTime) {\n                    lastTime = date.clone();\n                }\n                else {\n                    date.clone(lastTime)\n                }\n\n                var positions = Argon.UpdateSunMoon(date, frame);\n\n                var translation = positions.moon;\n                Cartesian3.normalize(translation, translation);\n                moonlight.position.set(translation.x, translation.y, translation.z);\n                if (translation.y > 0) {\n                    lights.remove(moonlight);\n                    lights.add(moonlight);\n                } else {\n                    lights.remove(moonlight);\n                }\n\n                translation = positions.sun;\n                Cartesian3.normalize(translation, translation);\n                sunlight.position.set(translation.x, translation.y, translation.z);\n                if (translation.y > 0) {\n                    lights.remove(sunlight);\n                    lights.add(sunlight);\n                } else {\n                    lights.remove(sunlight);\n                }\n            }\n        }\n    }\n}\n\n})();\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author blairmacintyre / http://blairmacintyre.me/\n */\n\n// based on CSS3DStereoRenderer in threejs.org github repo\n\nTHREE.CSS3DObject = function ( element ) {\n\tTHREE.Object3D.call( this );\n\n\tthis.elements = [];\n\tif (Array.isArray(element)) {\n\t\tfor (var i =0; i <element.length; i++) {\n\t\t\tthis.elements[i] = element[i];\n\t\t}\n\t} else {\n\t\tthis.elements[0] = element;\n\t\tthis.elements[1] = element.cloneNode( true );\n\t}\n\n\tthis.elements.forEach(function(el){\n\t\tel.style.position = 'absolute';\n\t});\n\n\tthis.addEventListener( 'removed', function ( event ) {\n\t\tfor (var i =0; i <this.elements.length; i++) {\n\t\t\tif ( this.elements[i].parentNode !== null ) {\n\t\t\t\tthis.elements[i].parentNode.removeChild( this.elements[i] );\n\t\t\t}\n\t\t}\n\t} );\n\n};\n\nTHREE.CSS3DObject.prototype = Object.create( THREE.Object3D.prototype );\nTHREE.CSS3DObject.prototype.constructor = THREE.CSS3DObject;\n\nTHREE.CSS3DSprite = function ( element ) {\n\tTHREE.CSS3DObject.call( this, element );\n};\n\nTHREE.CSS3DSprite.prototype = Object.create( THREE.CSS3DObject.prototype );\nTHREE.CSS3DSprite.prototype.constructor = THREE.CSS3DSprite;\n\n//\n\nTHREE.CSS3DArgonRenderer = function () {\n\n\tconsole.log( 'THREE.CSS3DArgonRenderer', THREE.REVISION );\n\n\tvar _cameras = [];\n\n\tvar _width, _height;\t\n\tvar _viewWidth = [];\n\tvar _viewHeight = [];\n\n\tvar tempMatrix = new THREE.Matrix4();\n    var tempMatrix2 = new THREE.Matrix4();\n\n\tvar cache = {\n\t\tcamera: { fov: [], style: [] },\n\t\tobjects: {}\n\t};\n\t\n\t//\n\n\tvar domElement = document.createElement( 'div' );\n\tthis.domElement = domElement;\n\tdomElement.style.pointerEvents = 'none';\n\n\t//\n\t\n\tvar domElements = [];\n\tthis.domElements = domElements;\n\t\n\tdomElements[0] = document.createElement( 'div' );\n\tdomElements[0].style.display = 'none'; // was 'inline-block';\n\tdomElements[0].style.overflow = 'hidden';\n\tdomElements[0].style.position = 'absolute';\n\n\tdomElements[0].style.WebkitTransformStyle = 'preserve-3d';\n\tdomElements[0].style.MozTransformStyle = 'preserve-3d';\n\tdomElements[0].style.oTransformStyle = 'preserve-3d';\n\tdomElements[0].style.transformStyle = 'preserve-3d';\n\n\tdomElement.appendChild( domElements[0] );\n\n\tvar cameraElements = [];\n\tcameraElements[0] = document.createElement( 'div' );\n\tcameraElements[0].style.WebkitTransformStyle = 'preserve-3d';\n\tcameraElements[0].style.MozTransformStyle = 'preserve-3d';\n\tcameraElements[0].style.oTransformStyle = 'preserve-3d';\n\tcameraElements[0].style.transformStyle = 'preserve-3d';\n\n\tdomElements[0].appendChild( cameraElements[0] );\n\n\t//\n\n\tdomElements[1] = document.createElement( 'div' );\n\tdomElements[1].style.display = 'none'; // was 'inline-block';\n\tdomElements[1].style.overflow = 'hidden';\n\tdomElements[1].style.position = 'absolute';\n\n\tdomElements[1].style.WebkitTransformStyle = 'preserve-3d';\n\tdomElements[1].style.MozTransformStyle = 'preserve-3d';\n\tdomElements[1].style.oTransformStyle = 'preserve-3d';\n\tdomElements[1].style.transformStyle = 'preserve-3d';\n\n\tdomElement.appendChild( domElements[1] );\n \n\tcameraElements[1] = document.createElement( 'div' );\n\tcameraElements[1].style.WebkitTransformStyle = 'preserve-3d';\n\tcameraElements[1].style.MozTransformStyle = 'preserve-3d';\n\tcameraElements[1].style.oTransformStyle = 'preserve-3d';\n\tcameraElements[1].style.transformStyle = 'preserve-3d';\n\n\tdomElements[1].appendChild( cameraElements[1] );\n\n\tthis.setClearColor = function () {\n\n\t};\n\n    this.setViewport = function ( x, y, width, height, side ) {\n\t\tdomElements[side].style.display = 'inline-block';\n\t\tdomElements[side].style.top = y + 'px';\n\t\tdomElements[side].style.left = x + 'px';\n\t\tdomElements[side].style.width = width + 'px';\n\t\tdomElements[side].style.height = height + 'px';\n\n\t\tcameraElements[side].style.width = width + 'px';\n\t\tcameraElements[side].style.height = height + 'px';\n\t\t\n\t\t_viewWidth[side] = width;\n\t\t_viewHeight[side] = height;\n\t}\n\t\t\n\tthis.showViewport = function (side) {\n\t\tdomElements[side].style.display = 'inline-block';\n\t}\n\t\n\tthis.hideViewport = function (side) {\n\t\tdomElements[side].style.display = 'none';\n\t}\n\n\tthis.setSize = function ( width, height ) {\n\t\t// size of overall DOM\n\t\tdomElement.style.width = width + 'px';\n\t\tdomElement.style.height = height + 'px';\n\n\t\t_width = width / 2;\n\t\t_height = height;\n\n\t\t/*\n\t\t * do not reset the subviews.  \n\t\t */ \t\t\n\n\t\t// hide them after setSize\n\t\tdomElements[0].style.display = 'none';\n\t\tdomElements[0].style.top = 0 + 'px';\n\t\tdomElements[0].style.left = 0 + 'px';\n\t\tdomElements[0].style.width = _width + 'px';\n\t\tdomElements[0].style.height = _height + 'px';\n\n\t\tcameraElements[0].style.width = _width + 'px';\n\t\tcameraElements[0].style.height = _height + 'px';\n\n\t\tdomElements[1].style.display = 'none';\n\t\tdomElements[1].style.top = 0 + 'px';\n\t\tdomElements[1].style.left = _width + 'px';\n\t\tdomElements[1].style.width = _width + 'px';\n\t\tdomElements[1].style.height = _height + 'px';\n\n\t\tcameraElements[1].style.width = _width + 'px';\n\t\tcameraElements[1].style.height = _height + 'px';\n\t\t/* */\n\t};\n\n\tvar epsilon = function ( value ) {\n\t\treturn toFixed(value, 6);\n\t\t//return toFixed(Math.abs( value ) < 0.00001 ? 0 : value, 6);\n\t};\n\n\t// make floating point output a little less ugly\n\tvar toFixed = function(value, precision) {\n    \tconst power = Math.pow(10, precision || 0);\n    \treturn String(Math.round(value * power) / power);\n\t}\n\n\tvar getCameraCSSMatrix = function ( m ) {\n\t\tvar matrix = tempMatrix2;\n\t\tmatrix.copy(m);\n \t\tmatrix.multiplyScalar(100);\n\t\t\n\t\t// we don't want the lower corner to be scaled, just the rest\n\t\tmatrix.elements[15] = m.elements[15];\n\n\t\tvar elements = matrix.elements;\n\n\t\treturn 'matrix3d(' +\n\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\tepsilon( - elements[ 1 ] ) + ',' +\n\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\tepsilon( elements[ 4 ] ) + ',' +\n\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\tepsilon( elements[ 6 ] ) + ',' +\n\t\t\tepsilon( elements[ 7 ] ) + ',' +\n\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\tepsilon( - elements[ 9 ] ) + ',' +\n\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\tepsilon( - elements[ 13 ] ) + ',' +\n\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\tepsilon( elements[ 15 ] ) +\n\t\t')';\n\n\t}; \n\n\tvar getObjectCSSMatrix = function ( m ) {\n\t\tvar matrix = tempMatrix2;\n\t\tmatrix.copy(m); \n \t\tmatrix.multiplyScalar(100); \n\n\t\t// we don't want the lower corner to be scaled, just the rest\n\t\tmatrix.elements[15] = m.elements[15];\n\n\t\tvar elements = matrix.elements;\n\n\t\treturn 'translate3d(-50%,-50%,0) matrix3d(' +\n\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\tepsilon( elements[ 1 ] ) + ',' +\n\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\tepsilon( - elements[ 4 ] ) + ',' +\n\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\tepsilon( - elements[ 6 ] ) + ',' +\n\t\t\tepsilon( - elements[ 7 ] ) + ',' +\n\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\tepsilon( elements[ 9 ] ) + ',' +\n\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\tepsilon( elements[ 13 ] ) + ',' +\n\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\tepsilon( elements[ 15 ] ) +\n\t\t')';\n\n\t};\n\n\tvar renderObject = function ( object, camera, cameraElement, side, visible ) {\n\t\tvisible = (visible && object.visible);\n\n\t\tif ( object instanceof THREE.CSS3DObject ) {\n\t\t\tvar element = object.elements[side];\n\t\t\t\n\t\t\tif (visible === false) {\n\t\t\t\telement.style.display = \"none\";\n\t\t\t} else {\n\t\t\t\telement.style.display = \"inline-block\";\t\t\t\t\n\t\t\t}\n\t\n\t\t\tvar style;\n\n\t\t\tif ( object instanceof THREE.CSS3DSprite ) {\n\n\t\t\t\t// http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n\t\t\t\tvar matrix = tempMatrix;\n\t\t\t\tmatrix.copy( camera.matrixWorldInverse );\n\t\t\t\tmatrix.transpose();\n\t\t\t\tmatrix.copyPosition( object.matrixWorld );\n\t\t\t\tmatrix.scale( object.scale );\n\n\t\t\t\tmatrix.elements[ 3 ] = 0;\n\t\t\t\tmatrix.elements[ 7 ] = 0;\n\t\t\t\tmatrix.elements[ 11 ] = 0;\n\t\t\t\tmatrix.elements[ 15 ] = 1;\n\n\t\t\t\tstyle = getObjectCSSMatrix( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tstyle = getObjectCSSMatrix( object.matrixWorld );\n\n\t\t\t}\n\n\n\t\t\telement.style.WebkitTransform = style;\n\t\t\telement.style.MozTransform = style;\n\t\t\telement.style.oTransform = style;\n\t\t\telement.style.transform = style;\n\n\t\t\tif ( element.parentNode !== cameraElement ) {\n\n\t\t\t\tcameraElement.appendChild( element );\n\t\t\t\n\t\t\t}\n\t\t}\n\n\t\t// we can't short circuit this, because we have to make sure we clear all the children of this \n\t\t// hidden node\n\t\t// if (!object.visible) { return; }\n\n\t\tfor ( var i = 0, l = object.children.length; i < l; i ++ ) {\n\n\t\t\trenderObject( object.children[ i ], camera, cameraElement, side, visible );\n\n\t\t}\n\n\t};\n\n\tthis.render = function ( scene, camera, side ) {\n\n\t\tscene.updateMatrixWorld();\n\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\tvar fov = toFixed(\n\t\t\t0.5 / Math.tan( THREE.Math.degToRad( camera.fov * 0.5 ) ) * _viewHeight[side],\n\t\t\t2);\n\t\tthis.fovStyle = fov;\n\n\t\tif (cache.camera.fov[side] !== fov ) {\n\t\t\tdomElements[side].style.WebkitPerspective = fov + \"px\";\n\t\t\tdomElements[side].style.MozPerspective = fov + \"px\";\n\t\t\tdomElements[side].style.oPerspective = fov + \"px\";\n\t\t\tdomElements[side].style.perspective = fov + \"px\";\n\n\t\t\tcache.camera.fov[side] = fov;\n\t\t}\n\n\t\tdomElements[side].style.display = 'inline-block'; \n\n\t\tcamera.matrixWorldInverse.getInverse( camera.matrixWorld );\n\n\t\tvar style = \"translate3d(0,0,\" + fov + \"px)\" + getCameraCSSMatrix( camera.matrixWorldInverse ) +\n\t\t\t\" translate3d(\" + toFixed(_viewWidth[side]/2,4) + \"px,\" + toFixed(_viewHeight[side]/2,4) + \"px, 0)\";\n\n\t\tif (cache.camera.style[side] !== style ) {\n\t\t\tcameraElements[side].style.WebkitTransform = style;\n\t\t\tcameraElements[side].style.MozTransform = style;\n\t\t\tcameraElements[side].style.oTransform = style;\n\t\t\tcameraElements[side].style.transform = style;\n\n\t\t\tcache.camera.style[side] = style;\n\t\t}\n\n        renderObject( scene, camera, cameraElements[side], side, scene.visible);\n\t};\n\t\n    // code to compute the FOV we need to render the CSS properly \n\t// from an arbitrary projection matrix, needed if the camera\n\t// projectionMatrix has been set directly instead of being\n\t// computed from it's parameters.\n    //\n\tvar oldProjection = new THREE.Matrix4();\n\tvar oldFOV = 0;\n    var eps = 0.0000001;  // something small\n\n    var epsilonEquals = function ( matrix ) {\n\t\tvar te = oldProjection.elements;\n\t\tvar me = matrix.elements;\n\n\t\tfor ( var i = 0; i < 16; i ++ ) {\n\t\t\tif ( Math.abs(te[ i ] - me[ i ]) > eps ) {\n                oldProjection.copy(matrix);\n                return false;\n            }\n\t\t}\n\t\treturn true;\n\t}\n    \n\tvar applyProjection = function (x, y, matrix ) {\n            var e = matrix.elements;\n\t\t\t// any depth will do, just use the middle of the canonical depth space\n\t\t\tvar z = 0.5; \n            \n            // for the perspective divide\n            var d = 1 / ( e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] ); \n            \n            // do the minimal math\n\t\t\tvar nx = ( e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z + e[ 12 ] ) * d;\n\t\t\tvar ny = ( e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z + e[ 13 ] ) * d;\n\t\t\tvar nz = ( e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] ) * d;\n\n\t\t\tvar len = Math.sqrt(nx * nx + ny * ny + nz * nz);\n\t\t\treturn [nx/len, ny/len, nz/len];\n\t}\n\n\tvar angleBetween = function(v1, v2) {\n        // v1 and v2 are normalized above\n\t\tvar dot = v1[0] * v2[0] + v1[1] * v2[1] + v1[2] * v2[2];\n\n\t\t// clamp, to handle numerical problems\n\t\tvar theta = Math.max( -1, Math.min( 1, dot ) );\n\t\treturn Math.acos( theta );\n\t}\n    \n    var projInv = new THREE.Matrix4();\n    this.updateCameraFOVFromProjection = function( camera ) {        \n        var projection = camera.projectionMatrix;\n\n        // if it's different from what it was, update FOV\n        if (!epsilonEquals(projection)) {\n            console.log(\"get FOV: projection={\" + projection[0] + \", \" + projection[1]+\", ...}\")\n\n            projInv.getInverse(camera.projectionMatrix);\n\n            var v1 = applyProjection(0,1,projInv);\n            console.log(\"get FOV: v1={\" + v1[0] + \", \" + v1[1]+\", \" + v1[2] +\"}\")\n            var v2 = applyProjection(0,-1,projInv);\n            console.log(\"get FOV: v2={\" + v2[0] + \", \" + v2[1]+\", \" + v2[2] +\"}\")\n\t\t    oldFOV = angleBetween(v1,v2) * 180 / Math.PI;\n            console.log(\"get FOV: \" + oldFOV);\n            \n            camera.fov = oldFOV;\n\t\t}\n\t};\n};\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author blairmacintyre / http://blairmacintyre.me/\n */\n\nTHREE.CSS3DArgonHUD = function () {\n\n\tconsole.log( 'THREE.CSS3DArgonHUD', THREE.REVISION );\n\n\tvar _viewWidth = [];\n\tvar _viewHeight = [];\n\n\tvar domElement = document.createElement( 'div' );\n\tthis.domElement = domElement;\n\tthis.domElement.style.pointerEvents = 'none';\n\n\tvar hudElements = [];\n\tthis.hudElements = hudElements;\n\thudElements[0] = document.createElement( 'div' );\n\thudElements[0].style.display = 'none'; // start hidden\n\thudElements[0].style.position = 'absolute';\n\thudElements[0].style.overflow = 'hidden';\n\tdomElement.appendChild( hudElements[0] );\n\n\thudElements[1] = document.createElement( 'div' );\n\thudElements[1].style.display = 'none'; // start hidden\n\thudElements[1].style.position = 'absolute';\n\thudElements[1].style.overflow = 'hidden';\n\tdomElement.appendChild( hudElements[1] );\n\n\tthis.appendChild = function (element, element2) {\n\t\tif (!element2) {\n\t\t\telement2 = element.cloneNode( true );\n\t\t}\n\t\tthis.hudElements[0].appendChild(element);\n\t\tthis.hudElements[1].appendChild(element2);\n\t}\n\n    this.setViewport = function ( x, y, width, height, side ) {\n\t\thudElements[side].style.display = 'inline-block';\n\t\thudElements[side].style.top = y + 'px';\n\t\thudElements[side].style.left = x + 'px';\n\t\thudElements[side].style.width = width + 'px';\n\t\thudElements[side].style.height = height + 'px';\n\n\t\t_viewWidth[side] = width;\n\t\t_viewHeight[side] = height;\n\t}\n\t\t\n\tthis.showViewport = function (side) {\n\t\thudElements[side].style.display = 'inline-block';\n\t}\n\t\n\tthis.hideViewport = function (side) {\n\t\thudElements[side].style.display = 'none';\n\t}\n\n\tthis.setSize = function ( width, height ) {\n\t\t// size of overall DOM\n\t\tdomElement.style.width = width + 'px';\n\t\tdomElement.style.height = height + 'px';\n\n\t\t/*\n\t\t * do not reset the subviews.  \n\t\t */ \t\t\n\t\t// default viewports for left and right eyes.\n\t\thudElements[0].style.display = 'none';\n\t\thudElements[1].style.display = 'none';\n\t};\n\n\tthis.render = function ( side ) {\n\t\thudElements[side].style.display = 'inline-block';\n\t};\n};\n!function(t){function e(o){if(r[o])return r[o].exports;var a=r[o]={exports:{},id:o,loaded:!1};return t[o].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var r={};return e.m=t,e.c=r,e.p=\"\",e(0)}([function(t,e){var r=AFRAME.utils.debug,o=AFRAME.utils.coordinates,a=r(\"components:look-at:warn\"),n=o.isCoordinate;delete AFRAME.components[\"look-at\"],AFRAME.registerComponent(\"look-at\",{schema:{src:{\"default\":\"\",parse:function(t){return n(t)||\"object\"==typeof t?o.parse(t):t},stringify:function(t){return\"object\"==typeof t?o.stringify(t):t}},checkSrcEveryFrame:{\"default\":!1},updateWorldTransform:{\"default\":!1}},init:function(){this.target3D=null,this.vector=new THREE.Vector3},update:function(){var t=this,e=t.data.src,r=t.el.object3D;return!e||\"object\"==typeof e&&!Object.keys(e).length?t.remove():\"object\"==typeof e?r.lookAt(new THREE.Vector3(e.x,e.y,e.z)):this.updateTarget(e)},updateTarget:function(t){var e=this;return targetEl=this.el.sceneEl.querySelector(t),targetEl?targetEl.hasLoaded?e.beginTracking(targetEl):targetEl.addEventListener(\"loaded\",function(){e.beginTracking(targetEl)}):void a('\"'+t+'\" does not point to a valid entity to look-at')},tick:function(t){var e,r=this,o=r.data.target,n=r.el.object3D;if(\"string\"==typeof r.data.target&&r.data.checkSrcEveryFrame){if(e=r.el.sceneEl.querySelector(o),!e)return a('\"'+o+'\" does not point to a valid entity to look-at'),void(this.target3D=null);if(!e.hasLoaded)return e.addEventListener(\"loaded\",function(){r.beginTracking(e)});r.beginTracking(e)}if(this.target3D)return this.vector.setFromMatrixPosition(this.target3D.matrixWorld),n.parent&&(this.data.updateWorldTransform&&n.parent.updateMatrixWorld(),n.parent.worldToLocal(this.vector)),n.lookAt(this.vector)},beginTracking:function(t){this.target3D=t.object3D}}),AFRAME.registerComponent(\"billboard\",{init:function(){this.vector=new THREE.Vector3},tick:function(t){var e=this,r=e.el.sceneEl.camera,o=e.el.object3D;if(r)return this.vector.setFromMatrixPosition(r.matrixWorld),o.parent&&(o.parent.updateMatrixWorld(),o.parent.worldToLocal(this.vector)),o.lookAt(this.vector)}})}]);\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\n\t__webpack_require__(1);\n\t__webpack_require__(6);\n\t__webpack_require__(7);\n\t__webpack_require__(8);\n\t__webpack_require__(9);\n\t__webpack_require__(10);\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar AEntity = AFRAME.AEntity;\n\tvar ANode = AFRAME.ANode;\n\n\tvar constants = __webpack_require__(2);\n\n\tvar AR_CAMERA_ATTR = \"data-aframe-argon-camera\";\n\n\tvar style = document.createElement(\"style\");\n\tstyle.type = 'text/css';\n\tdocument.head.insertBefore(style, document.head.firstChild);\n\tvar sheet = style.sheet;\n\tsheet.insertRule('ar-scene {\\n' + \n\t'  display: block;\\n' +\n\t'  position: relative;\\n' +\n\t'  height: 100%;\\n' +\n\t'  width: 100%;\\n' +\n\t'}\\n', 0);\n\tsheet.insertRule('\\n' +\n\t'ar-scene video,\\n' +\n\t'ar-scene img,\\n' +\n\t'ar-scene audio {\\n' +\n\t'  display: none;\\n' +\n\t'}\\n', 1);\n\n\t// want to know when the document is loaded \n\tdocument.DOMReady = function () {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (document.readyState === 'complete') {\n\t\t\t\tresolve(document);\n\t\t\t} else {\n\t\t\t\tdocument.addEventListener('DOMContentLoaded', function() {\n\t\t\t\t    resolve(document);\n\t\t\t    });\n\t\t\t}\n\t\t});\n\t};\n\n\tAFRAME.registerElement('ar-scene', {\n\t  prototype: Object.create(AEntity.prototype, {\n\t    \n\t    createdCallback: {\n\t      value: function () {\n\t        this.isMobile = AFRAME.utils.isMobile();\n\t        this.isIOS = AFRAME.utils.isIOS();\n\t        this.isScene = true;\n\t        this.isArgon = true;        \n\t        this.object3D = new THREE.Scene();\n\t        this.systems = {};\n\t        this.time = 0;\n\t        this.argonApp = null;\n\n\t        // finish initializing\n\t        this.init();\n\t      }\n\t    },\n\n\t    init: {\n\t      value: function () {\n\t        this.behaviors = [];\n\t        this.hasLoaded = false;\n\t        this.isPlaying = false;\n\t        this.originalHTML = this.innerHTML;\n\n\t        // let's initialize argon immediately, but wait till the document is\n\t        // loaded to set up the DOM parts\n\t        this.argonApp = Argon.init();\n\t        this.argonApp.context.setDefaultReferenceFrame(this.argonApp.context.localOriginEastUpSouth);\n\n\t        this.argonRender = this.argonRender.bind(this);\n\t        this.argonUpdate = this.argonUpdate.bind(this);\n\t        this.initializeArgon = this.initializeArgon.bind(this);\n\t        this.setupRenderer = this.setupRenderer.bind(this);\n\t     //   this.rAFRenderFunc = this.rAFRenderFunc.bind(this);\n\n\t        // var arCameraEl = this.arCameraEl = document.createElement('a-entity');\n\t        // arCameraEl.setAttribute(AR_CAMERA_ATTR, '');\n\t        // arCameraEl.setAttribute('camera', {'active': true});\n\t        // this.sceneEl.appendChild(arCameraEl);\n\n\t        // run this whenever the document is loaded, which might be now\n\t        document.DOMReady().then(this.initializeArgon);\n\t        //this.initializeArgon();\n\t      },\n\t      writable: true \n\t    },\n\n\t    /**\n\t     * Handler attached to elements to help scene know when to kick off.\n\t     * Scene waits for all entities to load.\n\t     */\n\t    attachedCallback: {\n\t      value: function () {        \n\t        this.setupSystems();\n\t        this.play();\n\t      },\n\t      writable: window.debug\n\t    },\n\n\t    addEventListeners: {\n\t        value: function () {\n\t            this.argonApp.renderEvent.addEventListener(this.argonRender);\n\t            this.argonApp.updateEvent.addEventListener(this.argonUpdate);\n\t        },\n\t        writable: true\n\t    },\n\n\t    removeEventListeners: {\n\t        value: function () {\n\t            this.argonApp.updateEvent.removeEventListener(this.argonUpdate);\n\t            this.argonApp.renderEvent.removeEventListener(this.argonRender);\n\t        },\n\t        writable: true\n\t    },\n\t    \n\t    play: {\n\t      value: function () {\n\t        var self = this;\n\n\t        if (this.renderStarted) {\n\t          AEntity.prototype.play.call(this);\n\t          return;\n\t        }\n\n\t        this.addEventListener('loaded', function () {\n\t          if (this.renderStarted) { return; }\n\n\n\t          // if there are any cameras aside from the AR-CAMERA loaded, \n\t          // make them inactive.\n\t          this.addEventListener('camera-set-active', function () {\n\t            var arCameraEl = null;\n\t            var cameraEls = this.querySelectorAll('[camera]');\n\t            for (i = 0; i < cameraEls.length; i++) {\n\t                cameraEl = cameraEls[i];\n\t                if (cameraEl.tagName === \"AR-CAMERA\") { \n\t                  arCameraEl = cameraEl;\n\t                  continue; \n\t                }\n\t                cameraEl.setAttribute('camera', 'active', false);\n\t                cameraEl.pause();\n\t            }\n\n\t            if (arCameraEl == null) {\n\t                var defaultCameraEl = document.createElement('ar-camera');\n\t                defaultCameraEl.setAttribute(AR_CAMERA_ATTR, '');\n\t                defaultCameraEl.setAttribute(constants.AFRAME_INJECTED, '');\n\t                self.appendChild(defaultCameraEl);\n\t            }\n\t          });\n\n\n\t          if (this.argonApp) {\n\t              self.addEventListeners();\n\t          } else {\n\t            this.addEventListener('argon-initialized', function() {\n\t              self.addEventListeners();\n\t            });\n\t          }\n\n\t          AEntity.prototype.play.call(this);\n\n\t          if (window.performance) {\n\t              window.performance.mark('render-started');\n\t          }\n\n\t          this.renderStarted = true;\n\t          this.emit('renderstart');\n\t        });\n\n\t        // setTimeout to wait for all nodes to attach and run their callbacks.\n\t        setTimeout(function () {\n\t          AEntity.prototype.load.call(self);\n\t        });\n\t      }\n\t    },\n\n\t    /**\n\t     * Shuts down scene on detach.\n\t     */\n\t    detachedCallback: {\n\t      value: function () {\n\t          if (this.animationFrameID) {\n\t            cancelAnimationFrame(this.animationFrameID);\n\t            this.animationFrameID = null;\n\t          }\n\t          removeEventListenern();\n\t      }\n\t    },\n\n\t    initializeArgon: {\n\t        value: function () {\n\t            this.setupRenderer();\n\n\t            this.emit('argon-initialized', {\n\t                target: this.argonApp\n\t            });            \n\t        },\n\t        writable: true\n\t    },\n\n\t    setupRenderer: {\n\t      value: function () {        \n\t        var antialias = this.getAttribute('antialias') === 'true';\n\n\t        if (THREE.CSS3DArgonRenderer) {\n\t          this.cssRenderer = new THREE.CSS3DArgonRenderer();\n\t        } else {\n\t          this.cssRenderer = null;\n\t        }\n\t        if (THREE.CSS3DArgonHUD) {\n\t          this.hud = new THREE.CSS3DArgonHUD();\n\t        } else {\n\t          this.hud = null;\n\t        }\n\t        this.renderer = new THREE.WebGLRenderer({\n\t            alpha: true,\n\t            antialias: antialias,\n\t            logarithmicDepthBuffer: true\n\t        });\n\t        this.renderer.setPixelRatio(window.devicePixelRatio);\n\n\t        this.argonApp.view.element.appendChild(this.renderer.domElement);\n\t        if (this.cssRenderer) {\n\t          this.argonApp.view.element.appendChild(this.cssRenderer.domElement);\n\t        }\n\t        if (this.hud) {\n\t          this.argonApp.view.element.appendChild(this.hud.domElement);\n\t        }\n\t      },\n\t      writable: true\n\t    },\n\n\n\t    /**\n\t     * Reload the scene to the original DOM content.\n\t     *\n\t     * @param {bool} doPause - Whether to reload the scene with all dynamic behavior paused.\n\t     */\n\t    reload: {\n\t      value: function (doPause) {\n\t        var self = this;\n\t        if (doPause) { this.pause(); }\n\t        this.innerHTML = this.originalHTML;\n\t        this.init();\n\t        ANode.prototype.load.call(this, play);\n\t        function play () {\n\t          if (!self.isPlaying) { return; }\n\t          AEntity.prototype.play.call(self);\n\t        }\n\t      }\n\t    },\n\n\t    /**\n\t     * Behavior-updater meant to be called from scene render.\n\t     * Abstracted to a different function to facilitate unit testing (`scene.tick()`) without\n\t     * needing to render.\n\t     */\n\t    argonUpdate: {\n\t        value: function (frame) {\n\t            var time = frame.systemTime;\n\t            var timeDelta = frame.deltaTime;\n\n\t            if (this.isPlaying) {\n\t                this.tick(time, timeDelta);\n\t            }\n\n\t            this.time = time;   \n\t        },\n\t        writable: true\n\t    },\n\n\t    tick: {\n\t      value: function (time, timeDelta) {\n\t        var systems = this.systems;\n\n\t        // Animations.\n\t        TWEEN.update(time);\n\n\t        // Components.\n\t        this.behaviors.forEach(function (component) {\n\t            if (!component.el.isPlaying) { return; }\n\t            component.tick(time, timeDelta);\n\t        });\n\t        // Systems.\n\t        Object.keys(systems).forEach(function (key) {\n\t            if (!systems[key].tick) { return; }\n\t            systems[key].tick(time, timeDelta);\n\t        });\n\t      }\n\t    },\n\n\t    /**\n\t     * The render loop.\n\t     *\n\t     * Updates animations.\n\t     * Updates behaviors.\n\t     * Renders with request animation frame.\n\t     */\n\t    argonRender: {\n\t       value: function (frame) {\n\t        if (!this.animationFrameID) {\n\t          var app = this.argonApp;\n\n\t          this.rAFviewport = app.view.getViewport();\n\t          this.rAFsubViews = app.view.getSubviews();\n\t          this.animationFrameID = requestAnimationFrame(this.rAFRenderFunc.bind(this));\n\t        }\n\t      },\n\t      writable: true \n\t    },\n\n\t    rAFviewport: {\n\t      value: null,\n\t      writable: true\n\t    },\n\t    rAFsubViews: {\n\t      value: null,\n\t      writable: true\n\t    },\n\n\t    rAFRenderFunc: {\n\t      value: function () {\n\t        var scene = this.object3D;\n\t        var renderer = this.renderer;\n\t        var cssRenderer = this.cssRenderer;\n\t        var hud = this.hud;\n\t        var camera = this.camera;\n\n\t        if (!this.renderer) {\n\t          // renderer hasn't been setup yet\n\t          this.animationFrameID = null;\n\t          return;\n\t        }\n\n\t        // the camera object is created from a camera property on an entity. This should be\n\t        // an ar-camera, which will have the entity position and orientation set to the pose\n\t        // of the user.  We want to make the camera pose \n\t        var camEntityPos = null;\n\t        var camEntityRot = null;\n\t        if (camera.parent) {\n\t            camEntityPos = camera.parent.position.clone().negate();\n\t            camEntityRot = camera.parent.quaternion.clone().inverse();\n\t        }\n\n\t        //var viewport = app.view.getViewport()\n\t        var viewport = this.rAFviewport;\n\t        renderer.setSize(viewport.width, viewport.height);\n\t        if (this.cssRenderer) {\n\t          cssRenderer.setSize(viewport.width, viewport.height);\n\t        }\n\t        if (this.hud) {\n\t          hud.setSize(viewport.width, viewport.height);\n\t        }\n\n\t        // leverage vr-mode.  Question: perhaps we shouldn't, perhaps we should use ar-mode?\n\t        // unclear right now how much of the components that use vr-mode are re-purposable\n\t        //var _a = app.view.getSubviews();\n\t        var _a = this.rAFsubViews;\n\t        if (this.is('vr-mode')) {\n\t          if (_a.length == 1) {\n\t            this.removeState('vr-mode');\n\t            this.emit('exit-vr', {target: this});\n\t          } \n\t        } else {\n\t          if (_a.length > 1) {\n\t            this.addState('vr-mode');\n\t            this.emit('enter-vr', {target: this});\n\t          }\n\t        }\n\n\t        // set the camera properties to the values of the 1st subview.\n\t        // While this is arbitrary, it's likely many of these will be the same\n\t        // across all subviews, and it's better than leaving them at the \n\t        // defaults, which are almost certainly incorrect\n\t        camera.near = _a[0].frustum.near;\n\t        camera.far = _a[0].frustum.far;\n\t        camera.aspect = _a[0].frustum.aspect;\n\t        \n\t        // there is 1 subview in monocular mode, 2 in stereo mode    \n\t        for (var _i = 0; _i < _a.length; _i++) {\n\t            var subview = _a[_i];\n\t            var frustum = subview.frustum;\n\t            \n\t            // set the position and orientation of the camera for \n\t            // this subview\n\t            camera.position.copy(subview.pose.position);\n\t            if (camEntityPos)  { camera.position.add(camEntityPos); }\n\t            camera.quaternion.copy(subview.pose.orientation);\n\t            if (camEntityRot)  { camera.quaternion.multiply(camEntityRot); }\n\n\t            // the underlying system provide a full projection matrix\n\t            // for the camera. \n\t            camera.projectionMatrix.fromArray(subview.projectionMatrix);\n\t            // set the viewport for this view\n\t            var _b = subview.viewport, x = _b.x, y = _b.y, width = _b.width, height = _b.height;\n\t            // set the CSS rendering up, by computing the FOV, and render this view\n\t            \n\t            if (this.cssRenderer) {\n\t              //cssRenderer.updateCameraFOVFromProjection(camera);\n\t              camera.fov = THREE.Math.radToDeg(frustum.fovy);\n\t              \n\t              cssRenderer.setViewport(x, y, width, height, subview.index);\n\t              cssRenderer.render(scene, camera, subview.index);\n\t            }\n\n\t            // set the webGL rendering parameters and render this view\n\t            renderer.setViewport(x, y, width, height);\n\t            renderer.setScissor(x, y, width, height);\n\t            renderer.setScissorTest(true);\n\t            renderer.render(scene, camera);\n\n\t            if (this.hud) {\n\t              // adjust the hud\n\t              hud.setViewport(x, y, width, height, subview.index);\n\t              hud.render(subview.index);\n\t            }\n\t        }\n\n\t        this.animationFrameID = null;\n\t      },\n\t      writable: true\n\t    },\n\n\n\t    /**\n\t     * Some mundane functions below here\n\t     */\n\t    setupSystems: {\n\t      value: function () {\n\t        var systemsKeys = Object.keys(AFRAME.systems);\n\t        systemsKeys.forEach(this.initSystem.bind(this));\n\t      }\n\t    },\n\n\t    initSystem: {\n\t      value: function (name) {\n\t        var system;\n\t        if (this.systems[name]) { return; }\n\t        system = this.systems[name] = new AFRAME.systems[name](this);\n\t        system.init();\n\t      }\n\t    },\n\n\t    /**\n\t     * @param {object} behavior - Generally a component. Must implement a .update() method to\n\t     *        be called on every tick.\n\t     */\n\t    addBehavior: {\n\t      value: function (behavior) {\n\t        var behaviors = this.behaviors;\n\t        if (behaviors.indexOf(behavior) !== -1) { return; }\n\t        behaviors.push(behavior);\n\t      }\n\t    },\n\n\t    /**\n\t     * Wraps Entity.getAttribute to take into account for systems.\n\t     * If system exists, then return system data rather than possible component data.\n\t     */\n\t    getAttribute: {\n\t      value: function (attr) {\n\t        var system = this.systems[attr];\n\t        if (system) { return system.data; }\n\t        return AEntity.prototype.getAttribute.call(this, attr);\n\t      }\n\t    },\n\n\t    /**\n\t     * Wraps Entity.getComputedAttribute to take into account for systems.\n\t     * If system exists, then return system data rather than possible component data.\n\t     */\n\t    getComputedAttribute: {\n\t      value: function (attr) {\n\t        var system = this.systems[attr];\n\t        if (system) { return system.data; }\n\t        return AEntity.prototype.getComputedAttribute.call(this, attr);\n\t      }\n\t    },\n\n\t    /**\n\t     * Wraps Entity.setAttribute to take into account for systems.\n\t     * If system exists, then skip component initialization checks and do a normal\n\t     * setAttribute.\n\t     */\n\t    setAttribute: {\n\t      value: function (attr, value, componentPropValue) {\n\t        var system = this.systems[attr];\n\t        if (system) {\n\t          ANode.prototype.setAttribute.call(this, attr, value);\n\t          return;\n\t        }\n\t        AEntity.prototype.setAttribute.call(this, attr, value, componentPropValue);\n\t      }\n\t    },\n\n\t    /**\n\t     * @param {object} behavior - Generally a component. Has registered itself to behaviors.\n\t     */\n\t    removeBehavior: {\n\t      value: function (behavior) {\n\t        var behaviors = this.behaviors;\n\t        var index = behaviors.indexOf(behavior);\n\t        if (index === -1) { return; }\n\t        behaviors.splice(index, 1);\n\t      }\n\t    }\n\t    \n\t  })\n\t});\n\n\tAFRAME.registerPrimitive('ar-camera', {\n\t  defaultComponents: {\n\t    camera: {active: true},\n\t    referenceframe: {parent: 'ar.user'}\n\t  }\n\t});\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = {\n\t  AFRAME_INJECTED: 'aframe-injected',\n\t  animation: __webpack_require__(3),\n\t  keyboardevent: __webpack_require__(5)\n\t};\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/**\n\t * Animation configuration options for TWEEN.js animations.\n\t * Used by `<a-animation>`.\n\t */\n\tvar TWEEN = __webpack_require__(4);\n\n\tvar DIRECTIONS = {\n\t  alternate: 'alternate',\n\t  alternateReverse: 'alternate-reverse',\n\t  normal: 'normal',\n\t  reverse: 'reverse'\n\t};\n\n\tvar EASING_FUNCTIONS = {\n\t  'linear': TWEEN.Easing.Linear.None,\n\n\t  'ease': TWEEN.Easing.Cubic.InOut,\n\t  'ease-in': TWEEN.Easing.Cubic.In,\n\t  'ease-out': TWEEN.Easing.Cubic.Out,\n\t  'ease-in-out': TWEEN.Easing.Cubic.InOut,\n\n\t  'ease-cubic': TWEEN.Easing.Cubic.In,\n\t  'ease-in-cubic': TWEEN.Easing.Cubic.In,\n\t  'ease-out-cubic': TWEEN.Easing.Cubic.Out,\n\t  'ease-in-out-cubic': TWEEN.Easing.Cubic.InOut,\n\n\t  'ease-quad': TWEEN.Easing.Quadratic.InOut,\n\t  'ease-in-quad': TWEEN.Easing.Quadratic.In,\n\t  'ease-out-quad': TWEEN.Easing.Quadratic.Out,\n\t  'ease-in-out-quad': TWEEN.Easing.Quadratic.InOut,\n\n\t  'ease-quart': TWEEN.Easing.Quartic.InOut,\n\t  'ease-in-quart': TWEEN.Easing.Quartic.In,\n\t  'ease-out-quart': TWEEN.Easing.Quartic.Out,\n\t  'ease-in-out-quart': TWEEN.Easing.Quartic.InOut,\n\n\t  'ease-quint': TWEEN.Easing.Quintic.InOut,\n\t  'ease-in-quint': TWEEN.Easing.Quintic.In,\n\t  'ease-out-quint': TWEEN.Easing.Quintic.Out,\n\t  'ease-in-out-quint': TWEEN.Easing.Quintic.InOut,\n\n\t  'ease-sine': TWEEN.Easing.Sinusoidal.InOut,\n\t  'ease-in-sine': TWEEN.Easing.Sinusoidal.In,\n\t  'ease-out-sine': TWEEN.Easing.Sinusoidal.Out,\n\t  'ease-in-out-sine': TWEEN.Easing.Sinusoidal.InOut,\n\n\t  'ease-expo': TWEEN.Easing.Exponential.InOut,\n\t  'ease-in-expo': TWEEN.Easing.Exponential.In,\n\t  'ease-out-expo': TWEEN.Easing.Exponential.Out,\n\t  'ease-in-out-expo': TWEEN.Easing.Exponential.InOut,\n\n\t  'ease-circ': TWEEN.Easing.Circular.InOut,\n\t  'ease-in-circ': TWEEN.Easing.Circular.In,\n\t  'ease-out-circ': TWEEN.Easing.Circular.Out,\n\t  'ease-in-out-circ': TWEEN.Easing.Circular.InOut,\n\n\t  'ease-elastic': TWEEN.Easing.Elastic.InOut,\n\t  'ease-in-elastic': TWEEN.Easing.Elastic.In,\n\t  'ease-out-elastic': TWEEN.Easing.Elastic.Out,\n\t  'ease-in-out-elastic': TWEEN.Easing.Elastic.InOut,\n\n\t  'ease-back': TWEEN.Easing.Back.InOut,\n\t  'ease-in-back': TWEEN.Easing.Back.In,\n\t  'ease-out-back': TWEEN.Easing.Back.Out,\n\t  'ease-in-out-back': TWEEN.Easing.Back.InOut,\n\n\t  'ease-bounce': TWEEN.Easing.Bounce.InOut,\n\t  'ease-in-bounce': TWEEN.Easing.Bounce.In,\n\t  'ease-out-bounce': TWEEN.Easing.Bounce.Out,\n\t  'ease-in-out-bounce': TWEEN.Easing.Bounce.InOut\n\t};\n\n\tvar FILLS = {\n\t  backwards: 'backwards',\n\t  both: 'both',\n\t  forwards: 'forwards',\n\t  none: 'none'\n\t};\n\n\tvar REPEATS = {\n\t  indefinite: 'indefinite'\n\t};\n\n\tvar DEFAULTS = {\n\t  attribute: 'rotation',\n\t  begin: '',\n\t  end: '',\n\t  delay: 0,\n\t  dur: 1000,\n\t  easing: 'ease',\n\t  direction: DIRECTIONS.normal,\n\t  fill: FILLS.forwards,\n\t  from: undefined,\n\t  repeat: 0,\n\t  to: undefined\n\t};\n\n\tmodule.exports.defaults = DEFAULTS;\n\tmodule.exports.directions = DIRECTIONS;\n\tmodule.exports.easingFunctions = EASING_FUNCTIONS;\n\tmodule.exports.fills = FILLS;\n\tmodule.exports.repeats = REPEATS;\n\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/**\n\t * Tween.js - Licensed under the MIT license\n\t * https://github.com/sole/tween.js\n\t * ----------------------------------------------\n\t *\n\t * See https://github.com/sole/tween.js/graphs/contributors for the full list of contributors.\n\t * Thank you all, you're awesome!\n\t */\n\n\t// performance.now polyfill\n\t( function ( root ) {\n\n\t\tif ( 'performance' in root === false ) {\n\t\t\troot.performance = {};\n\t\t}\n\n\t\t// IE 8\n\t\tDate.now = ( Date.now || function () {\n\t\t\treturn new Date().getTime();\n\t\t} );\n\n\t\tif ( 'now' in root.performance === false ) {\n\t\t\tvar offset = root.performance.timing && root.performance.timing.navigationStart ? performance.timing.navigationStart\n\t\t\t                                                                                : Date.now();\n\n\t\t\troot.performance.now = function () {\n\t\t\t\treturn Date.now() - offset;\n\t\t\t};\n\t\t}\n\n\t} )( this );\n\n\tvar TWEEN = TWEEN || ( function () {\n\n\t\tvar _tweens = [];\n\n\t\treturn {\n\n\t\t\tREVISION: '14',\n\n\t\t\tgetAll: function () {\n\n\t\t\t\treturn _tweens;\n\n\t\t\t},\n\n\t\t\tremoveAll: function () {\n\n\t\t\t\t_tweens = [];\n\n\t\t\t},\n\n\t\t\tadd: function ( tween ) {\n\n\t\t\t\t_tweens.push( tween );\n\n\t\t\t},\n\n\t\t\tremove: function ( tween ) {\n\n\t\t\t\tvar i = _tweens.indexOf( tween );\n\n\t\t\t\tif ( i !== -1 ) {\n\n\t\t\t\t\t_tweens.splice( i, 1 );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tupdate: function ( time ) {\n\n\t\t\t\tif ( _tweens.length === 0 ) return false;\n\n\t\t\t\tvar i = 0;\n\n\t\t\t\ttime = time !== undefined ? time : window.performance.now();\n\n\t\t\t\twhile ( i < _tweens.length ) {\n\n\t\t\t\t\tif ( _tweens[ i ].update( time ) ) {\n\n\t\t\t\t\t\ti++;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t_tweens.splice( i, 1 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\t\t};\n\n\t} )();\n\n\tTWEEN.Tween = function ( object ) {\n\n\t\tvar _object = object;\n\t\tvar _valuesStart = {};\n\t\tvar _valuesEnd = {};\n\t\tvar _valuesStartRepeat = {};\n\t\tvar _duration = 1000;\n\t\tvar _repeat = 0;\n\t\tvar _yoyo = false;\n\t\tvar _isPlaying = false;\n\t\tvar _reversed = false;\n\t\tvar _delayTime = 0;\n\t\tvar _startTime = null;\n\t\tvar _easingFunction = TWEEN.Easing.Linear.None;\n\t\tvar _interpolationFunction = TWEEN.Interpolation.Linear;\n\t\tvar _chainedTweens = [];\n\t\tvar _onStartCallback = null;\n\t\tvar _onStartCallbackFired = false;\n\t\tvar _onUpdateCallback = null;\n\t\tvar _onCompleteCallback = null;\n\t\tvar _onStopCallback = null;\n\n\t\t// Set all starting values present on the target object\n\t\tfor ( var field in object ) {\n\n\t\t\t_valuesStart[ field ] = parseFloat(object[field], 10);\n\n\t\t}\n\n\t\tthis.to = function ( properties, duration ) {\n\n\t\t\tif ( duration !== undefined ) {\n\n\t\t\t\t_duration = duration;\n\n\t\t\t}\n\n\t\t\t_valuesEnd = properties;\n\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.start = function ( time ) {\n\n\t\t\tTWEEN.add( this );\n\n\t\t\t_isPlaying = true;\n\n\t\t\t_onStartCallbackFired = false;\n\n\t\t\t_startTime = time !== undefined ? time : window.performance.now();\n\t\t\t_startTime += _delayTime;\n\n\t\t\tfor ( var property in _valuesEnd ) {\n\n\t\t\t\t// check if an Array was provided as property value\n\t\t\t\tif ( _valuesEnd[ property ] instanceof Array ) {\n\n\t\t\t\t\tif ( _valuesEnd[ property ].length === 0 ) {\n\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// create a local copy of the Array with the start value at the front\n\t\t\t\t\t_valuesEnd[ property ] = [ _object[ property ] ].concat( _valuesEnd[ property ] );\n\n\t\t\t\t}\n\n\t\t\t\t_valuesStart[ property ] = _object[ property ];\n\n\t\t\t\tif( ( _valuesStart[ property ] instanceof Array ) === false ) {\n\t\t\t\t\t_valuesStart[ property ] *= 1.0; // Ensures we're using numbers, not strings\n\t\t\t\t}\n\n\t\t\t\t_valuesStartRepeat[ property ] = _valuesStart[ property ] || 0;\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.stop = function () {\n\n\t\t\tif ( !_isPlaying ) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tTWEEN.remove( this );\n\t\t\t_isPlaying = false;\n\n\t\t\tif ( _onStopCallback !== null ) {\n\n\t\t\t\t_onStopCallback.call( _object );\n\n\t\t\t}\n\n\t\t\tthis.stopChainedTweens();\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.stopChainedTweens = function () {\n\n\t\t\tfor ( var i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++ ) {\n\n\t\t\t\t_chainedTweens[ i ].stop();\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.delay = function ( amount ) {\n\n\t\t\t_delayTime = amount;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.repeat = function ( times ) {\n\n\t\t\t_repeat = times;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.yoyo = function( yoyo ) {\n\n\t\t\t_yoyo = yoyo;\n\t\t\treturn this;\n\n\t\t};\n\n\n\t\tthis.easing = function ( easing ) {\n\n\t\t\t_easingFunction = easing;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.interpolation = function ( interpolation ) {\n\n\t\t\t_interpolationFunction = interpolation;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.chain = function () {\n\n\t\t\t_chainedTweens = arguments;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.onStart = function ( callback ) {\n\n\t\t\t_onStartCallback = callback;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.onUpdate = function ( callback ) {\n\n\t\t\t_onUpdateCallback = callback;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.onComplete = function ( callback ) {\n\n\t\t\t_onCompleteCallback = callback;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.onStop = function ( callback ) {\n\n\t\t\t_onStopCallback = callback;\n\t\t\treturn this;\n\n\t\t};\n\n\t\tthis.update = function ( time ) {\n\n\t\t\tvar property;\n\n\t\t\tif ( time < _startTime ) {\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\tif ( _onStartCallbackFired === false ) {\n\n\t\t\t\tif ( _onStartCallback !== null ) {\n\n\t\t\t\t\t_onStartCallback.call( _object );\n\n\t\t\t\t}\n\n\t\t\t\t_onStartCallbackFired = true;\n\n\t\t\t}\n\n\t\t\tvar elapsed = ( time - _startTime ) / _duration;\n\t\t\telapsed = elapsed > 1 ? 1 : elapsed;\n\n\t\t\tvar value = _easingFunction( elapsed );\n\n\t\t\tfor ( property in _valuesEnd ) {\n\n\t\t\t\tvar start = _valuesStart[ property ] || 0;\n\t\t\t\tvar end = _valuesEnd[ property ];\n\n\t\t\t\tif ( end instanceof Array ) {\n\n\t\t\t\t\t_object[ property ] = _interpolationFunction( end, value );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Parses relative end values with start as base (e.g.: +10, -3)\n\t\t\t\t\tif ( typeof(end) === \"string\" ) {\n\t\t\t\t\t\tend = start + parseFloat(end, 10);\n\t\t\t\t\t}\n\n\t\t\t\t\t// protect against non numeric properties.\n\t\t\t\t\tif ( typeof(end) === \"number\" ) {\n\t\t\t\t\t\t_object[ property ] = start + ( end - start ) * value;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( _onUpdateCallback !== null ) {\n\n\t\t\t\t_onUpdateCallback.call( _object, value );\n\n\t\t\t}\n\n\t\t\tif ( elapsed == 1 ) {\n\n\t\t\t\tif ( _repeat > 0 ) {\n\n\t\t\t\t\tif( isFinite( _repeat ) ) {\n\t\t\t\t\t\t_repeat--;\n\t\t\t\t\t}\n\n\t\t\t\t\t// reassign starting values, restart by making startTime = now\n\t\t\t\t\tfor( property in _valuesStartRepeat ) {\n\n\t\t\t\t\t\tif ( typeof( _valuesEnd[ property ] ) === \"string\" ) {\n\t\t\t\t\t\t\t_valuesStartRepeat[ property ] = _valuesStartRepeat[ property ] + parseFloat(_valuesEnd[ property ], 10);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (_yoyo) {\n\t\t\t\t\t\t\tvar tmp = _valuesStartRepeat[ property ];\n\t\t\t\t\t\t\t_valuesStartRepeat[ property ] = _valuesEnd[ property ];\n\t\t\t\t\t\t\t_valuesEnd[ property ] = tmp;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_valuesStart[ property ] = _valuesStartRepeat[ property ];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_yoyo) {\n\t\t\t\t\t\t_reversed = !_reversed;\n\t\t\t\t\t}\n\n\t\t\t\t\t_startTime = time + _delayTime;\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( _onCompleteCallback !== null ) {\n\n\t\t\t\t\t\t_onCompleteCallback.call( _object );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( var i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++ ) {\n\n\t\t\t\t\t\t_chainedTweens[ i ].start( time );\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn true;\n\n\t\t};\n\n\t};\n\n\n\tTWEEN.Easing = {\n\n\t\tLinear: {\n\n\t\t\tNone: function ( k ) {\n\n\t\t\t\treturn k;\n\n\t\t\t}\n\n\t\t},\n\n\t\tQuadratic: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\treturn k * k;\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\treturn k * ( 2 - k );\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * k * k;\n\t\t\t\treturn - 0.5 * ( --k * ( k - 2 ) - 1 );\n\n\t\t\t}\n\n\t\t},\n\n\t\tCubic: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\treturn k * k * k;\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\treturn --k * k * k + 1;\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * k * k * k;\n\t\t\t\treturn 0.5 * ( ( k -= 2 ) * k * k + 2 );\n\n\t\t\t}\n\n\t\t},\n\n\t\tQuartic: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\treturn k * k * k * k;\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\treturn 1 - ( --k * k * k * k );\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tif ( ( k *= 2 ) < 1) return 0.5 * k * k * k * k;\n\t\t\t\treturn - 0.5 * ( ( k -= 2 ) * k * k * k - 2 );\n\n\t\t\t}\n\n\t\t},\n\n\t\tQuintic: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\treturn k * k * k * k * k;\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\treturn --k * k * k * k * k + 1;\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * k * k * k * k * k;\n\t\t\t\treturn 0.5 * ( ( k -= 2 ) * k * k * k * k + 2 );\n\n\t\t\t}\n\n\t\t},\n\n\t\tSinusoidal: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\treturn 1 - Math.cos( k * Math.PI / 2 );\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\treturn Math.sin( k * Math.PI / 2 );\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\treturn 0.5 * ( 1 - Math.cos( Math.PI * k ) );\n\n\t\t\t}\n\n\t\t},\n\n\t\tExponential: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\treturn k === 0 ? 0 : Math.pow( 1024, k - 1 );\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\treturn k === 1 ? 1 : 1 - Math.pow( 2, - 10 * k );\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tif ( k === 0 ) return 0;\n\t\t\t\tif ( k === 1 ) return 1;\n\t\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * Math.pow( 1024, k - 1 );\n\t\t\t\treturn 0.5 * ( - Math.pow( 2, - 10 * ( k - 1 ) ) + 2 );\n\n\t\t\t}\n\n\t\t},\n\n\t\tCircular: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\treturn 1 - Math.sqrt( 1 - k * k );\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\treturn Math.sqrt( 1 - ( --k * k ) );\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tif ( ( k *= 2 ) < 1) return - 0.5 * ( Math.sqrt( 1 - k * k) - 1);\n\t\t\t\treturn 0.5 * ( Math.sqrt( 1 - ( k -= 2) * k) + 1);\n\n\t\t\t}\n\n\t\t},\n\n\t\tElastic: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\tvar s, a = 0.1, p = 0.4;\n\t\t\t\tif ( k === 0 ) return 0;\n\t\t\t\tif ( k === 1 ) return 1;\n\t\t\t\tif ( !a || a < 1 ) { a = 1; s = p / 4; }\n\t\t\t\telse s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );\n\t\t\t\treturn - ( a * Math.pow( 2, 10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) );\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\tvar s, a = 0.1, p = 0.4;\n\t\t\t\tif ( k === 0 ) return 0;\n\t\t\t\tif ( k === 1 ) return 1;\n\t\t\t\tif ( !a || a < 1 ) { a = 1; s = p / 4; }\n\t\t\t\telse s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );\n\t\t\t\treturn ( a * Math.pow( 2, - 10 * k) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) + 1 );\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tvar s, a = 0.1, p = 0.4;\n\t\t\t\tif ( k === 0 ) return 0;\n\t\t\t\tif ( k === 1 ) return 1;\n\t\t\t\tif ( !a || a < 1 ) { a = 1; s = p / 4; }\n\t\t\t\telse s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );\n\t\t\t\tif ( ( k *= 2 ) < 1 ) return - 0.5 * ( a * Math.pow( 2, 10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) );\n\t\t\t\treturn a * Math.pow( 2, -10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) * 0.5 + 1;\n\n\t\t\t}\n\n\t\t},\n\n\t\tBack: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\tvar s = 1.70158;\n\t\t\t\treturn k * k * ( ( s + 1 ) * k - s );\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\tvar s = 1.70158;\n\t\t\t\treturn --k * k * ( ( s + 1 ) * k + s ) + 1;\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tvar s = 1.70158 * 1.525;\n\t\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * ( k * k * ( ( s + 1 ) * k - s ) );\n\t\t\t\treturn 0.5 * ( ( k -= 2 ) * k * ( ( s + 1 ) * k + s ) + 2 );\n\n\t\t\t}\n\n\t\t},\n\n\t\tBounce: {\n\n\t\t\tIn: function ( k ) {\n\n\t\t\t\treturn 1 - TWEEN.Easing.Bounce.Out( 1 - k );\n\n\t\t\t},\n\n\t\t\tOut: function ( k ) {\n\n\t\t\t\tif ( k < ( 1 / 2.75 ) ) {\n\n\t\t\t\t\treturn 7.5625 * k * k;\n\n\t\t\t\t} else if ( k < ( 2 / 2.75 ) ) {\n\n\t\t\t\t\treturn 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\n\n\t\t\t\t} else if ( k < ( 2.5 / 2.75 ) ) {\n\n\t\t\t\t\treturn 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\n\n\t\t\t\t} else {\n\n\t\t\t\t\treturn 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tInOut: function ( k ) {\n\n\t\t\t\tif ( k < 0.5 ) return TWEEN.Easing.Bounce.In( k * 2 ) * 0.5;\n\t\t\t\treturn TWEEN.Easing.Bounce.Out( k * 2 - 1 ) * 0.5 + 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tTWEEN.Interpolation = {\n\n\t\tLinear: function ( v, k ) {\n\n\t\t\tvar m = v.length - 1, f = m * k, i = Math.floor( f ), fn = TWEEN.Interpolation.Utils.Linear;\n\n\t\t\tif ( k < 0 ) return fn( v[ 0 ], v[ 1 ], f );\n\t\t\tif ( k > 1 ) return fn( v[ m ], v[ m - 1 ], m - f );\n\n\t\t\treturn fn( v[ i ], v[ i + 1 > m ? m : i + 1 ], f - i );\n\n\t\t},\n\n\t\tBezier: function ( v, k ) {\n\n\t\t\tvar b = 0, n = v.length - 1, pw = Math.pow, bn = TWEEN.Interpolation.Utils.Bernstein, i;\n\n\t\t\tfor ( i = 0; i <= n; i++ ) {\n\t\t\t\tb += pw( 1 - k, n - i ) * pw( k, i ) * v[ i ] * bn( n, i );\n\t\t\t}\n\n\t\t\treturn b;\n\n\t\t},\n\n\t\tCatmullRom: function ( v, k ) {\n\n\t\t\tvar m = v.length - 1, f = m * k, i = Math.floor( f ), fn = TWEEN.Interpolation.Utils.CatmullRom;\n\n\t\t\tif ( v[ 0 ] === v[ m ] ) {\n\n\t\t\t\tif ( k < 0 ) i = Math.floor( f = m * ( 1 + k ) );\n\n\t\t\t\treturn fn( v[ ( i - 1 + m ) % m ], v[ i ], v[ ( i + 1 ) % m ], v[ ( i + 2 ) % m ], f - i );\n\n\t\t\t} else {\n\n\t\t\t\tif ( k < 0 ) return v[ 0 ] - ( fn( v[ 0 ], v[ 0 ], v[ 1 ], v[ 1 ], -f ) - v[ 0 ] );\n\t\t\t\tif ( k > 1 ) return v[ m ] - ( fn( v[ m ], v[ m ], v[ m - 1 ], v[ m - 1 ], f - m ) - v[ m ] );\n\n\t\t\t\treturn fn( v[ i ? i - 1 : 0 ], v[ i ], v[ m < i + 1 ? m : i + 1 ], v[ m < i + 2 ? m : i + 2 ], f - i );\n\n\t\t\t}\n\n\t\t},\n\n\t\tUtils: {\n\n\t\t\tLinear: function ( p0, p1, t ) {\n\n\t\t\t\treturn ( p1 - p0 ) * t + p0;\n\n\t\t\t},\n\n\t\t\tBernstein: function ( n , i ) {\n\n\t\t\t\tvar fc = TWEEN.Interpolation.Utils.Factorial;\n\t\t\t\treturn fc( n ) / fc( i ) / fc( n - i );\n\n\t\t\t},\n\n\t\t\tFactorial: ( function () {\n\n\t\t\t\tvar a = [ 1 ];\n\n\t\t\t\treturn function ( n ) {\n\n\t\t\t\t\tvar s = 1, i;\n\t\t\t\t\tif ( a[ n ] ) return a[ n ];\n\t\t\t\t\tfor ( i = n; i > 1; i-- ) s *= i;\n\t\t\t\t\treturn a[ n ] = s;\n\n\t\t\t\t};\n\n\t\t\t} )(),\n\n\t\t\tCatmullRom: function ( p0, p1, p2, p3, t ) {\n\n\t\t\t\tvar v0 = ( p2 - p0 ) * 0.5, v1 = ( p3 - p1 ) * 0.5, t2 = t * t, t3 = t * t2;\n\t\t\t\treturn ( 2 * p1 - 2 * p2 + v0 + v1 ) * t3 + ( - 3 * p1 + 3 * p2 - 2 * v0 - v1 ) * t2 + v0 * t + p1;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\t// UMD (Universal Module Definition)\n\t( function ( root ) {\n\n\t\tif ( true ) {\n\n\t\t\t// AMD\n\t\t\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\t\t\treturn TWEEN;\n\t\t\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\t\t} else if ( typeof exports === 'object' ) {\n\n\t\t\t// Node.js\n\t\t\tmodule.exports = TWEEN;\n\n\t\t} else {\n\n\t\t\t// Global variable\n\t\t\troot.TWEEN = TWEEN;\n\n\t\t}\n\n\t} )( this );\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\tmodule.exports = {\n\t  // Tiny KeyboardEvent.code polyfill.\n\t  KEYCODE_TO_CODE: {\n\t    '38': 'ArrowUp',\n\t    '37': 'ArrowLeft',\n\t    '40': 'ArrowDown',\n\t    '39': 'ArrowRight',\n\t    '87': 'KeyW',\n\t    '65': 'KeyA',\n\t    '83': 'KeyS',\n\t    '68': 'KeyD'\n\t  }\n\t};\n\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tvar zeroScale = 0.00001;\n\n\tAFRAME.registerComponent('fixedsize', {\n\t  schema: { \n\t    default: 1\n\t  },\n\n\t  init: function () {\n\t      this.scale = 1;\n\t      this.factor = 1;\n\t  },\n\n\t  update: function () {\n\t    var data = this.data;\n\t    this.scale = data === 0 ? zeroScale : data;\n\t    this.factor = 2 * (this.scale / screen.height);\n\t  },\n\n\t  tick: function (t) {\n\t    var object3D = this.el.object3D;\n\t    var camera = this.el.sceneEl.camera;\n\t    if (!camera) {return;}\n\n\t    var cameraPos = camera.getWorldPosition();\n\t    var thisPos = object3D.getWorldPosition();\n\t    var distance = thisPos.distanceTo(cameraPos);\n\n\t    // let's get the fov scale factor from the camera\n\t    fovScale = Math.tan(THREE.Math.degToRad(camera.fov) / 2) * 2;\n\n\t    // if distance < near clipping plane, just use scale.  Don't go any bigger\n\t    var factor = fovScale * (distance < camera.near ? this.factor : distance * this.factor);\n\t    object3D.scale.set(factor, factor, factor);\n\t  }\n\t});\n\n\tAFRAME.registerComponent('trackvisibility', {\n\t  schema: { \n\t    default: true\n\t  },\n\n\t  init: function () {\n\t    var self = this;\n\t    console.log(\"INIT TEST COMPONENT\");\n\t    this.el.sceneEl.addEventListener('referenceframe-statuschanged', function(evt) {\n\t        self.updateVisibility(evt);\n\t    });\n\t  },\n\n\t  updateVisibility: function (evt) {\n\t    console.log(\"visibility changed: \" + evt.detail.found)\n\t    if (this.data && evt.detail.target === this.el) {\n\t      this.el.object3D.visible = evt.detail.found;\n\t    }\n\t  },\n\n\t  update: function () {\n\t    console.log(\"updated TEST COMPONENT\")\n\t  }\n\t}); \n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\tvar Cesium = Argon.Cesium;\n\tvar Cartesian3 = Cesium.Cartesian3;\n\tvar ConstantPositionProperty = Cesium.ConstantPositionProperty;\n\tvar ReferenceFrame = Cesium.ReferenceFrame;\n\tvar ReferenceEntity = Cesium.ReferenceEntity;\n\tvar degToRad = THREE.Math.degToRad;\n\n\t/**\n\t * referenceframe component for A-Frame.\n\t * \n\t * Use an Argon reference frame as the coordinate system for the position and \n\t * orientation for this entity.  The position and orientation components are\n\t * expressed relative to this frame. \n\t * \n\t * By default, it uses both the position and orientation of the reference frame\n\t * to define a coordinate frame for this entity, but either may be ignored, in which \n\t * case the identity will be used. This is useful, for example, if you wish to have\n\t * this entity follow the position of a referenceframe but be oriented in the \n\t * coordinates of its parent (typically scene coordinates). \n\t * \n\t * Known frames include ar.user, ar.device, ar.localENU, ar.localEUS, \n\t * ar.device.orientation, ar.device.geolocation, ar.device.display\n\t */\n\tAFRAME.registerComponent('referenceframe', {\n\t \n\t    schema: { \n\t        lla: { type: 'vec3'},\n\t        parent: { default: \"FIXED\" },\n\t        userotation: { default: true},\n\t        useposition: { default: true}\n\t    },\n\n\t    /**\n\t     * Nothing to do\n\t     */\n\t    init: function () {\n\t        var el = this.el;                   // entity\n\t        var self = this;\n\n\t        this.update = this.update.bind(this);\n\n\t        // this component only works with an Argon Scene\n\t        if (!el.sceneEl.isArgon) {\n\t            throw new Error('referenceframe must be used on a child of a <ar-scene>.');\n\t        }\n\t\t   this.localRotationEuler = new THREE.Euler(0,0,0,'XYZ');\n\t       this.localPosition = { x: 0, y: 0, z: 0 };\n\t       this.localScale = { x: 1, y: 1, z: 1 };\n\t       this.knownFrame = false;\n\t        el.addEventListener('componentchanged', this.updateLocalTransform.bind(this));\n\t        el.sceneEl.addEventListener('argon-initialized', function() {\n\t              self.update(self.data);\n\t        });            \n\t    },\n\n\t    /** \n\t     * Update \n\t     */\n\t    update: function (oldData) {\n\t        var el = this.el;\n\t        var argonApp = this.el.sceneEl.argonApp;\n\t        var data = this.data;\n\n\t        var lp = el.getComputedAttribute('position');\n\t        if (lp) {\n\t            this.localPosition.x = lp.x;\n\t            this.localPosition.y = lp.y;\n\t            this.localPosition.z = lp.z;\n\t        } else {\n\t            this.localPosition.x = 0;\n\t            this.localPosition.y = 0;\n\t            this.localPosition.z = 0;\n\t        }\n\n\t        var lo = el.getComputedAttribute('rotation');\n\t        if (lo) {\n\t            this.localRotationEuler.x = degToRad(lo.x);\n\t            this.localRotationEuler.y = degToRad(lo.y);\n\t            this.localRotationEuler.z = degToRad(lo.z);\n\t        } else {\n\t            this.localRotationEuler.x = 0;\n\t            this.localRotationEuler.y = 0;\n\t            this.localRotationEuler.z = 0;\n\t        }\n\n\t        var ls = el.getComputedAttribute('scale');\n\t        if (ls) {\n\t            this.localScale.x = ls.x;\n\t            this.localScale.y = ls.y;\n\t            this.localScale.z = ls.z;\n\t        } else {\n\t            this.localScale.x = 1;\n\t            this.localScale.y = 1;\n\t            this.localScale.z = 1;\n\t        }\n\t        if (!argonApp) {\n\t            return;\n\t        }\n\n\t        var cesiumPosition = null;\n\t        if (this.attrValue.hasOwnProperty('lla'))  {\n\t            if (data.parent !== 'FIXED') {\n\t                console.warn(\"Using 'lla' with a 'parent' other than 'FIXED' is invalid. Ignoring parent value.\");\n\t                data.parent = 'FIXED';\n\t            }\n\t            cesiumPosition = Cartesian3.fromDegrees(data.lla.x, data.lla.y, data.lla.z);\n\t        } else {\n\t            cesiumPosition = Cartesian3.ZERO;\n\t        }\n\n\t        // parentEntity is either FIXED or another Entity or ReferenceEntity \n\t        var parentEntity = this.getParentEntity(data.parent);\n\n\t        // The first time here, we'll create a cesium Entity.  If the id has changed,\n\t        // we'll recreate a new entity with the new id.\n\t        // Otherwise, we just update the entity's position.\n\t        if (this.cesiumEntity == null || (el.id !== \"\" && el.id !== this.cesiumEntity.id)) {\n\t            var options = {\n\t                position: new ConstantPositionProperty(cesiumPosition, parentEntity),\n\t                orientation: Cesium.Quaternion.IDENTITY\n\t            }\n\t            if (el.id !== '') {\n\t                options.id = el.id;\n\t            }\n\t            this.cesiumEntity = new Cesium.Entity(options);\n\t        } else {\n\t            this.cesiumEntity.position.setValue(cesiumPosition, parentEntity);\n\t        }        \n\t    },\n\n\t    getParentEntity: function (parent) {\n\t        var el = this.el;\n\t        var self = this;\n\t        var argonApp = this.el.sceneEl.argonApp;\n\n\t        var parentEntity = null;\n\n\t        if (parent === 'FIXED') {\n\t            parentEntity = ReferenceFrame.FIXED;\n\t        } else {\n\t            var vuforia = el.sceneEl.systems[\"vuforia\"];\n\t            if (vuforia) {\n\t                var parts = parent.split(\".\");\n\t                if (parts.length === 3 && parts[0] === \"vuforia\") {\n\t                    // see if it's already a known target entity\n\t                    console.log(\"looking for target '\" + parent + \"'\");\n\t                    \n\t                    parentEntity = vuforia.getTargetEntity(parts[1], parts[2]);\n\n\t                    // if not known, subscribe to it\n\t                    if (parentEntity === null) {\n\t                        console.log(\"not found, subscribing to target '\" + parent + \"'\");\n\t                        parentEntity = vuforia.subscribeToTarget(parts[1], parts[2]);\n\t                    }\n\n\t                    // if still not known, try again when our dataset is loaded\n\t                    if (parentEntity === null) {\n\t                        console.log(\"not loaded, waiting for dataset for target '\" + parent + \"'\");\n\t                        var name = parts[1];\n\t                        el.sceneEl.addEventListener('argon-vuforia-dataset-loaded', function(evt) {\n\t                            console.log('dataset loaded.');\n\t                            console.log(\"dataset name '\" + evt.detail.target.name + \"', our name '\" + name + \"'\");\n\t                            if (evt.detail.target.name === name) {\n\t                                self.update(self.data);\n\t                            }\n\t                        });            \n\t                        console.log(\"finished setting up to wait for dataset for target '\" + parent + \"'\");\n\t                    }\n\t                }\n\t            }\n\n\t            // if it's a vuforia refernece frame, we might have found it above.  Otherwise, look for \n\t            // an entity with the parent ID\n\t            if (!parentEntity) {\n\t                parentEntity = argonApp.context.entities.getById(parent);\n\t            }\n\t            // If we didn't find the entity at all, create it\n\t            if (!parentEntity) {\n\t                parentEntity = new ReferenceEntity(argonApp.context.entities, parent);\n\t            }\n\t        }    \n\t        return parentEntity;\n\t    },\n\n\t    convertReferenceFrame: function (newParent) {\n\t        var el = this.el;                   // entity\n\n\t        // can't do anything without a cesium entity\n\t        if (!this.cesiumEntity)  { \n\t            console.warn(\"Tried to convertReferenceFrame on element '\" + el.id + \"' but no cesiumEntity initialized on that element\");\n\t            return; \n\t        }\n\n\t        // eventually we'll convert the current reference frame to a new one, keeping the pose the same\n\t        // but a bunch of changes are needed above to make this work\n\n\t    },\n\n\t  updateLocalTransform: function (evt) {\n\t      var data = evt.detail.newData;\n\t      if (evt.target != this.el) { return; }\n\n\t      if (evt.detail.name == 'rotation') {\n\t          this.localRotationEuler.x = degToRad(data.x);\n\t          this.localRotationEuler.y = degToRad(data.y);\n\t          this.localRotationEuler.z = degToRad(data.z);\n\t      } else if (evt.detail.name == 'position') {\n\t          this.localPosition.x = data.x;\n\t          this.localPosition.y = data.y;\n\t          this.localPosition.z = data.z;\n\t      } else if (evt.detail.name == 'scale') {\n\t          this.localScale.x = data.x;\n\t          this.localScale.y = data.y;\n\t          this.localScale.z = data.z;\n\t      }\n\t  },\n\n\t  /**\n\t   * update each time step.\n\t   */\n\t  tick: function () {\n\t      var m1 = new THREE.Matrix4();\n\n\t      return function(t) {\n\t        var data = this.data;               // parameters\n\t        var el = this.el;                   // entity\n\t        var object3D = el.object3D;\n\t        var matrix = object3D.matrix;\n\t        var argonApp = el.sceneEl.argonApp;\n\t        var isNestedEl = !el.parentEl.isScene;\n\n\t        if (!argonApp) { return };\n\n\t        if (this.cesiumEntity) { \n\t            var entityPos = argonApp.context.getEntityPose(this.cesiumEntity);\n\t            if (entityPos.poseStatus & Argon.PoseStatus.KNOWN) {\n\t                this.knownFrame = true;\n\t                if (data.userotation) {\n\t                    object3D.quaternion.copy(entityPos.orientation);\n\t                } else if (isNestedEl) {\n\t                    object3D.rotation.copy(this.localRotationEuler);\n\t                    object3D.rotation.order = 'YXZ';\n\t                }\n\t                if (data.useposition) {\n\t                    object3D.position.copy(entityPos.position);\n\t                } else if (isNestedEl) {\n\t                    object3D.position.copy(this.localPosition);                    \n\t                }\n\t                if (entityPos.poseStatus & Argon.PoseStatus.FOUND) {\n\t                    console.log(\"reference frame changed to FOUND\");            \n\t                    el.sceneEl.emit('referenceframe-statuschanged', {\n\t                        target: this.el,\n\t                        found: true\n\t                    });                            \n\t                }\n\n\t                // if this isn't a child of the scene, move it to world coordinates\n\t                if (!el.parentEl.isScene) {\n\t                    object3D.scale.set(1,1,1);\n\t                    el.parentEl.object3D.updateMatrixWorld();\n\t                    m1.getInverse(el.parentEl.object3D.matrixWorld);\n\t                    matrix.premultiply(m1);\n\t                    matrix.decompose(object3D.position, object3D.quaternion, object3D.scale );\n\t                } \n\t            } else {\n\t                this.knownFrame = false;\n\t                if (entityPos.poseStatus & Argon.PoseStatus.LOST) {\n\t                    console.log(\"reference frame changed to LOST\");            \n\t                    el.sceneEl.emit('referenceframe-statuschanged', {\n\t                        target: this.el,\n\t                        found: false\n\t                    });                            \n\t                }\n\t            }\n\t        }\n\t      };\n\t  }()\n\t});\n\n\tAFRAME.registerPrimitive('ar-geopose', {\n\t  defaultComponents: {\n\t    referenceframe: {}\n\t  },\n\n\t  mappings: {\n\t    lla: 'referenceframe.lla',\n\t\tuserotation: 'referenceframe.userotation',\n\t    useposition: 'referenceframe.useposition'\n\t  }\n\t});\n\n\tAFRAME.registerPrimitive('ar-frame', {\n\t  defaultComponents: {\n\t    referenceframe: {}\n\t  },\n\n\t  mappings: {\n\t    parent: 'referenceframe.parent',\n\t\tuserotation: 'referenceframe.userotation',\n\t    useposition: 'referenceframe.useposition'\n\t  }\n\t});\n\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\tAFRAME.registerComponent('css-object', {\n\t  schema: {\n\t    div: { default: '' },\n\t    div2: { default: ''}\n\t  },\n\n\t  init: function () {\n\t    this.div = null;\n\t    this.div2 = null;\n\t  },\n\n\t  update: function () {\n\t    var data = this.data;\n\t    if (data.div === \"\") { return; }\n\n\t    this.div = document.querySelector(data.div);\n\t    if (data.div2 !== \"\") {\n\t      this.div2 = document.querySelector(data.div2);\n\t    }\n\t    if (this.div) {\n\t        if (THREE.CSS3DObject) {\n\t          if (this.div2 === null) {\n\t            this.el.setObject3D('div', new THREE.CSS3DObject(this.div));\n\t          } else {\n\t            this.el.setObject3D('div', new THREE.CSS3DObject([this.div, this.div2]));\n\t          }\n\t        }\n\t    }\n\t  },\n\n\t  remove: function () {\n\t    if (!this.div) { return; }\n\n\t    if (THREE.CSS3DObject) {\n\t      this.el.removeObject3D('div');\n\t    }\n\t  }\n\t});\n\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tAFRAME.registerSystem('vuforia', {\n\t    init: function () {\n\t        this.key = \"\";\n\t        this.api = null;\n\t        this.datasetMap = {};\n\t        this.available = false;\n\n\t        this.sceneEl.addEventListener('argon-initialized', this.startVuforia.bind(this));\n\t    },\n\n\t    setKey: function (key) {\n\t        this.key = key;\n\n\t        if (this.sceneEl.argonApp) {\n\t            this.startVuforia();\n\t        }\n\t    },\n\n\t    startVuforia: function() {\n\t        var self = this;\n\t        var sceneEl = this.sceneEl;\n\t        var argonApp = sceneEl.argonApp;\n\n\t        // need argon\n\t        if (!argonApp) { return; }\n\n\t        // if there is no vuforia API, bye bye\n\t        if (!argonApp.vuforia) { return; }\n\n\t        // if already initialized, bye bye\n\t        if (this.api) { return; }\n\n\t        // can't initialize if we don't have the key yet\n\t        if (this.key === \"\") { return; }\n\n\t        // try to initialize\n\t        argonApp.vuforia.isAvailable().then(function(available) {\n\t            if (self.available) {\n\t                // this code has already run, through to telling argon to initialize vuforia!\n\t                return;\n\t            }\n\n\t            // vuforia not available on this platform\n\t            if (!available) {\n\t                self.available = false;\n\t                console.warn('vuforia not available on this platform.');\n\n\t                // in case an application wants to take action when vuforia isn't supported\n\t                sceneEl.emit('argon-vuforia-not-available', {\n\t                    target: sceneEl\n\t                });                            \n\t                return;\n\t            } \n\n\t            // vuforia is available!\n\t            self.available = true;\n\n\t            // try to initialize with our key\n\t            argonApp.vuforia.init({\n\t                //licenseKey: self.key\n\t                encryptedLicenseData: self.key\n\t            }).then(function(api) {\n\t                // worked! Save the API\n\t                self.api = api;\n\n\t                console.log(\"vuforia initialized!\")\n\n\t                // re-call createOrUpdateDataset to create datasets already requested\n\t                Object.keys(self.datasetMap).forEach(function(key,index) {\n\t                    var dataset = self.datasetMap[key];\n\t                    console.log(\"re-initializing dataset \" + key + \" as active=\" + dataset.active);\n\t                    self.createOrUpdateDataset(dataset.component, key, dataset.url, dataset.active)\n\t                });\n\n\t                // tell everyone the good news\n\t                sceneEl.emit('argon-vuforia-initialized', {\n\t                    target: sceneEl\n\t                });                            \n\t            }).catch(function(err) {\n\t                console.log(\"vuforia failed to initialize: \" + err.message);\n\n\t                sceneEl.emit('argon-vuforia-initialization-failed', {\n\t                    target: sceneEl,\n\t                    error: err\n\t                });                                            \n\t            });\n\t        });\n\t    },\n\n\t    // create an empty dataset\n\t    createEmptyDatasetObject: function () {\n\t        return {\n\t            component: null,\n\t            api: null, \n\t            url: null, \n\t            fetched: false,\n\t            loaded: false, \n\t            active: false, \n\t            targets: {},\n\t            trackables: null,\n\t            initInProgress: false\n\t        };\n\t    },\n\n\t    // create a new dataset or update one currently created.  \n\t    createOrUpdateDataset: function (component, name, url, active) {\n\t        var self = this;\n\t        var api = this.api;\n\t        var dataset = this.datasetMap[name];\n\n\t        // if dataset exists, and matches the previous element, it's because targets were registered before the \n\t        // dataset was set up, which is fine.  Otherwise, its a duplicate dataset name, which isn't allowed!\n\t        if (dataset) {\n\t          if (dataset.component) {\n\t            if (dataset.component != component) {\n\t                console.warn('vuforia.createOrUpdateDataset called multiple times for id=' + name + ', ignoring extra datasets');\n\t                return;\n\t            }   \n\t            if (dataset.url != url) {\n\t                console.warn(\"can't change the url for a vuforia dataset once it's created.  Ignoring new URL '\" + url + \"' for dataset '\" + name + \"'\")\n\t                return;\n\t            }\n\t          } else {\n\t            // first time this has been called, the dataset is there\n\t            // because of calls to set up targets, etc.\n\t            dataset.component = component;\n\t            dataset.url = url;\n\t          }\n\t        } else {\n\t            // set up the mapping if not there\n\t            dataset = this.datasetMap[name] = this.createEmptyDatasetObject();\n\t            dataset.component = component;\n\t            dataset.url = url;\n\t        }\n\n\t        dataset.active = active;\n\n\t        console.log(\"creating dataset \" + name + \" active=\" + active );\n\n\t        // if vuforia has not yet initialized, return.  \n\t        if (!api) {\n\t            return;\n\t        }\n\n\t        if (dataset.initInProgress) {\n\t            // just update the active flag, will get dealt with when fetch is done\n\t            dataset.active = active;\n\t            return;\n\t        }\n\n\t        // if the api is initialized, deal with the active state\n\t        if (dataset.api) {\n\t            dataset.active = active;\n\n\t            // if already fetched, update the active state\n\t            if (fetched) {\n\t                self.setDatasetActive(name, dataset.active);\n\t            }\n\t            return;\n\t        }\n\n\t        console.log(\"objectTracker.createDataSet \" + name );\n\n\t        dataset.initInProgress = true;\n\t        // should have both vuforia and argon initialized by now\n\t        api.objectTracker.createDataSet(url).then(function (data) {\n\t            console.log(\"created dataset \" + name );\n\n\t            dataset.initInProgress = false;\n\t            dataset.api = data; \n\t            data.fetch().then(function () {\n\n\t                console.log(\"fetched dataset \" + name );\n\n\t                dataset.fetched = true;\n\n\t                console.log(\"now, re-activate dataset \" + name + \" active=\" + dataset.active );\n\t                self.setDatasetActive(name, dataset.active);\n\t                dataset.component.datasetLoaded = true;\n\t                console.log(\"re-activated dataset \" + name + \" active=\" + dataset.active );\n\t                \n\t                // tell everyone the good news\n\t                self.sceneEl.emit('argon-vuforia-dataset-downloaded', {\n\t                    target: dataset.component\n\t                });                            \n\t            }).catch(function(err) {\n\t                console.log(\"couldn't download dataset: \" + err.message);\n\n\t                sceneEl.emit('argon-vuforia-dataset-download-failed', {\n\t                    target: sceneEl,\n\t                    error: err\n\t                });                                            \n\t            });\n\t        });\n\t    },\n\n\t    setDatasetActive: function (name, active) {\n\t        var self = this;\n\t        var api = this.api;\n\t        var dataset = this.datasetMap[name];\n\n\t        console.log(\"make dataset \" + name + \" active=\" +active );\n\n\t        if (!api) {\n\t            if (dataset) {\n\t                dataset.active = active;\n\t                return;\n\t            } else {\n\t                throw new Error('vuforia.setDatsetActive call before dataset initialized');\n\t            }\n\t        }\n\t        \n\t        if (!dataset) {\n\t            throw new Error('ar-vuforia-dataset \"' + name + '\" should have been created before being activated');\n\t        }\n\n\t        console.log(\"really making dataset \" + name + \" active=\" +active );\n\n\t        if (!dataset.loaded && active) {\n\t            console.log(\"loading dataset \" + name + \" active=\" +active );\n\t            dataset.api.load().then(function () {\n\t                console.log(\"loaded dataset \" + name + \" active=\" +active );\n\t                if (dataset.loaded) { return; }\n\n\t                dataset.loaded = true;\n\t                dataset.fetched = true;\n\t                dataset.trackables = dataset.api.getTrackables();\n\t                if (active) {\n\t                    dataset.active = true;\n\t                    api.objectTracker.activateDataSet(dataset.api);\n\t                }\n\n\t                // re-call subscribeToTarget to subscribe the targets already requested\n\t                Object.keys(dataset.targets).forEach(function(key,index) {\n\t                    console.log(\"re-subscribing to target \" + name + \".\" + key );\n\t                    self.subscribeToTarget(name, key, true);\n\t                });\n\n\t                // tell everyone the good news\n\t                self.sceneEl.emit('argon-vuforia-dataset-loaded', {\n\t                    target: dataset.component\n\t                });               \n\t                console.log(\"dataset \" + name + \" loaded, ready to go\");         \n\t            }).catch(function(err) {\n\t                console.log(\"couldn't load dataset: \" + err.message);\n\n\t                sceneEl.emit('argon-vuforia-dataset-load-failed', {\n\t                    target: sceneEl,\n\t                    error: err\n\t                });                                            \n\t            });\n\t        } else {\n\t            if (dataset.active != active) {\n\t                dataset.active = active;\n\t                if (active) {\n\t                    api.objectTracker.activateDataSet(dataset.api);\n\t                } else {\n\t                    api.objectTracker.deactivateDataSet(dataset.api);                \n\t                }\n\t            }\n\t        }        \n\t    },\n\n\t    subscribeToTarget: function (name, target, postLoad) {\n\t        var api = this.api;\n\t        var dataset = this.datasetMap[name];\n\n\t        // set up the mapping if not there\n\t        if (!dataset) {\n\t            dataset = this.datasetMap[name] = this.createEmptyDatasetObject();\n\t        }\n\t        \n\t        // either create a new target entry and set the count, or add the count to an existing one\n\t        targetItem = dataset.targets[target];\n\t        if (!targetItem) {\n\t            dataset.targets[target] = 1;\n\t        } else if (!postLoad) {\n\t            dataset.targets[target] += 1;\n\t        }\n\t        console.log(\"subscribe to \" + name + \".\" + target)\n\n\t        if (!api) { return null; }\n\t            \n\t        if (dataset.loaded) {\n\t            var tracker = dataset.trackables[target];\n\t            console.log(\"dataset loaded, subscribe to \" + name + \".\" + target)\n\t            if (tracker && tracker.id) {\n\t                console.log(\"subscribed to \" + name + \".\" + target + \" as \" + tracker.id)\n\t                return this.sceneEl.argonApp.context.subscribeToEntityById(tracker.id);\n\t            } else {\n\t                console.warn(\"can't subscribe to target '\" + target + \"' does not exist in dataset '\" + name + \"'\");\n\t                return null;\n\t            }\n\t        }\n\t        // not loaded yet\n\t        return null;\n\t    },\n\n\t    getTargetEntity: function (name, target) {\n\t        var api = this.api;\n\t        var dataset = this.datasetMap[name];\n\t        var tracker;\n\n\t        console.log(\"getTargetEntity \" + name + \".\" + target)\n\n\t        // set up the mapping if not there\n\t        if (!api || !dataset || !dataset.loaded) {\n\t            return null;\n\t        }\n\t        \n\t        tracker = dataset.trackables[target];\n\t        console.log(\"everything loaded, get \" + name + \".\" + target)\n\t        if (tracker && tracker.id) {\n\t            console.log(\"retrieved \" + name + \".\" + target + \" as \" + tracker.id)\n\t            return this.sceneEl.argonApp.context.entities.getById(tracker.id);\n\t        } else {\n\t            console.warn(\"can't get target '\" + target + \"', does not exist in dataset '\" + name + \"'\");\n\t        }\n\t        return null;\n\t    }\n\t});\n\n\t// the parameter to vuforia is a reference to a element.\n\t// If the element is an a-asset-item, the key should have been downloaded into its data property\n\t// Otherwise, assume the key is in the innerHTML (contents) of the element\n\tAFRAME.registerComponent('vuforiakey', {\n\t    schema: { \n\t        default: \" \"\n\t    },\n\n\t    /**\n\t     * Nothing to do\n\t     */\n\t    init: function () {\n\t        this.key = null;\n\t    },\n\n\t    /** \n\t     * Update:  first time in, we initialize vuforia\n\t     */\n\t    update: function (oldData) {\n\t        var el = this.el;\n\t        var sceneEl = this.el.sceneEl;\n\t        var system = sceneEl.systems[\"vuforia\"];\n\t            \n\t        if (!el.isArgon) {\n\t            console.warn('vuforia component can only be applied to <ar-scene>');\n\t            return;\n\t        }\n\n\t        var keyAsset = el.querySelector(this.data);\n\n\t        if (keyAsset) {\n\t            if (keyAsset.isAssetItem) {\n\t                this.key = keyAsset.data;\n\t                system.setKey(keyAsset.data);\n\t            } else {\n\t                this.key = keyAsset.innerHTML;\n\t                system.setKey(keyAsset.innerHTML);\n\t            }\n\t        } else {\n\t            console.warn('vuforia component cannot find asset \"' + this.data + '\"');\n\t            return;\n\t        }\n\t    }\n\t});\n\n\tAFRAME.registerComponent('vuforiadataset', {\n\t    multiple: true,\n\n\t    schema: {\n\t        src: {type: 'src'},\n\t        active: {default: true}\n\t    },\n\n\t    init: function () {\n\t        var el = this.el;\n\n\t        this.name = \"default_dataset\";\n\t        this.active = false;\n\t        this.datasetLoaded = false;\n\n\t        if (!el.isArgon) {\n\t            console.warn('vuforiadataset should be attached to an <ar-scene>.');\n\t        }\n\t    },\n\n\t    remove: function () {\n\t        if (this.active) {\n\t            var sceneEl = this.el.sceneEl;\n\t            var vuforia = sceneEl.systems[\"vuforia\"];\n\t            vuforia.setDatasetActive(this.name, false);\n\t        }\n\t        // remove dataset from system, when argon supports that\n\t    },\n\n\t    update: function (oldData) {\n\t        var sceneEl = this.el.sceneEl;\n\t        this.name = this.id ? this.id : \"default_dataset\";\n\n\t        var vuforia = sceneEl.systems[\"vuforia\"];\n\t        vuforia.createOrUpdateDataset(this, this.name, this.data.src, this.data.active);\n\t    }\n\t});\n\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tAFRAME.registerShader('shadow', {\n\t  schema: {\n\t  },\n\n\t  /**\n\t   * Initializes the shader.\n\t   * Adds a reference from the scene to this entity as the camera.\n\t   */\n\t  init: function (data) {\n\t    this.textureSrc = null;\n\t    this.material = new THREE.ShadowMaterial();\n\t    AFRAME.utils.material.updateMap(this, data);\n\t  },\n\n\t  update: function (data) {\n\t    AFRAME.utils.material.updateMap(this, data);\n\t  },\n\t});\n\n\n/***/ }\n/******/ ]);\n}else{document.documentElement.className=\"init-lacking\"}\n</script>\n<script src=\"https://use.fontawesome.com/46b4065509.js\"></script>\n<style id=\"style-normalize\" type=\"text/css\">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */\n\n/**\n * 1. Set default font family to sans-serif.\n * 2. Prevent iOS and IE text size adjust after device orientation change,\n *    without disabling user zoom.\n */\n\nhtml {\n  font-family: sans-serif; /* 1 */\n  -ms-text-size-adjust: 100%; /* 2 */\n  -webkit-text-size-adjust: 100%; /* 2 */\n}\n\n/**\n * Remove default margin.\n */\n\nbody {\n  margin: 0;\n}\n\n/* HTML5 display definitions\n   ========================================================================== */\n\n/**\n * Correct `block` display not defined for any HTML5 element in IE 8/9.\n * Correct `block` display not defined for `details` or `summary` in IE 10/11\n * and Firefox.\n * Correct `block` display not defined for `main` in IE 11.\n */\n\narticle,\naside,\ndetails,\nfigcaption,\nfigure,\nfooter,\nheader,\nhgroup,\nmain,\nmenu,\nnav,\nsection,\nsummary {\n  display: block;\n}\n\n/**\n * 1. Correct `inline-block` display not defined in IE 8/9.\n * 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.\n */\n\naudio,\ncanvas,\nprogress,\nvideo {\n  display: inline-block; /* 1 */\n  vertical-align: baseline; /* 2 */\n}\n\n/**\n * Prevent modern browsers from displaying `audio` without controls.\n * Remove excess height in iOS 5 devices.\n */\n\naudio:not([controls]) {\n  display: none;\n  height: 0;\n}\n\n/**\n * Address `[hidden]` styling not present in IE 8/9/10.\n * Hide the `template` element in IE 8/9/10/11, Safari, and Firefox < 22.\n */\n\n[hidden],\ntemplate {\n  display: none;\n}\n\n/* Links\n   ========================================================================== */\n\n/**\n * Remove the gray background color from active links in IE 10.\n */\n\na {\n  background-color: transparent;\n}\n\n/**\n * Improve readability of focused elements when they are also in an\n * active/hover state.\n */\n\na:active,\na:hover {\n  outline: 0;\n}\n\n/* Text-level semantics\n   ========================================================================== */\n\n/**\n * Address styling not present in IE 8/9/10/11, Safari, and Chrome.\n */\n\nabbr[title] {\n  border-bottom: 1px dotted;\n}\n\n/**\n * Address style set to `bolder` in Firefox 4+, Safari, and Chrome.\n */\n\nb,\nstrong {\n  font-weight: bold;\n}\n\n/**\n * Address styling not present in Safari and Chrome.\n */\n\ndfn {\n  font-style: italic;\n}\n\n/**\n * Address variable `h1` font-size and margin within `section` and `article`\n * contexts in Firefox 4+, Safari, and Chrome.\n */\n\nh1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n\n/**\n * Address styling not present in IE 8/9.\n */\n\nmark {\n  background: #ff0;\n  color: #000;\n}\n\n/**\n * Address inconsistent and variable font size in all browsers.\n */\n\nsmall {\n  font-size: 80%;\n}\n\n/**\n * Prevent `sub` and `sup` affecting `line-height` in all browsers.\n */\n\nsub,\nsup {\n  font-size: 75%;\n  line-height: 0;\n  position: relative;\n  vertical-align: baseline;\n}\n\nsup {\n  top: -0.5em;\n}\n\nsub {\n  bottom: -0.25em;\n}\n\n/* Embedded content\n   ========================================================================== */\n\n/**\n * Remove border when inside `a` element in IE 8/9/10.\n */\n\nimg {\n  border: 0;\n}\n\n/**\n * Correct overflow not hidden in IE 9/10/11.\n */\n\nsvg:not(:root) {\n  overflow: hidden;\n}\n\n/* Grouping content\n   ========================================================================== */\n\n/**\n * Address margin not present in IE 8/9 and Safari.\n */\n\nfigure {\n  margin: 1em 40px;\n}\n\n/**\n * Address differences between Firefox and other browsers.\n */\n\nhr {\n  box-sizing: content-box;\n  height: 0;\n}\n\n/**\n * Contain overflow in all browsers.\n */\n\npre {\n  overflow: auto;\n}\n\n/**\n * Address odd `em`-unit font size rendering in all browsers.\n */\n\ncode,\nkbd,\npre,\nsamp {\n  font-family: monospace, monospace;\n  font-size: 1em;\n}\n\n/* Forms\n   ========================================================================== */\n\n/**\n * Known limitation: by default, Chrome and Safari on OS X allow very limited\n * styling of `select`, unless a `border` property is set.\n */\n\n/**\n * 1. Correct color not being inherited.\n *    Known issue: affects color of disabled elements.\n * 2. Correct font properties not being inherited.\n * 3. Address margins set differently in Firefox 4+, Safari, and Chrome.\n */\n\nbutton,\ninput,\noptgroup,\nselect,\ntextarea {\n  color: inherit; /* 1 */\n  font: inherit; /* 2 */\n  margin: 0; /* 3 */\n}\n\n/**\n * Address `overflow` set to `hidden` in IE 8/9/10/11.\n */\n\nbutton {\n  overflow: visible;\n}\n\n/**\n * Address inconsistent `text-transform` inheritance for `button` and `select`.\n * All other form control elements do not inherit `text-transform` values.\n * Correct `button` style inheritance in Firefox, IE 8/9/10/11, and Opera.\n * Correct `select` style inheritance in Firefox.\n */\n\nbutton,\nselect {\n  text-transform: none;\n}\n\n/**\n * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`\n *    and `video` controls.\n * 2. Correct inability to style clickable `input` types in iOS.\n * 3. Improve usability and consistency of cursor style between image-type\n *    `input` and others.\n */\n\nbutton,\nhtml input[type=\"button\"], /* 1 */\ninput[type=\"reset\"],\ninput[type=\"submit\"] {\n  -webkit-appearance: button; /* 2 */\n  cursor: pointer; /* 3 */\n}\n\n/**\n * Re-set default cursor for disabled elements.\n */\n\nbutton[disabled],\nhtml input[disabled] {\n  cursor: default;\n}\n\n/**\n * Remove inner padding and border in Firefox 4+.\n */\n\nbutton::-moz-focus-inner,\ninput::-moz-focus-inner {\n  border: 0;\n  padding: 0;\n}\n\n/**\n * Address Firefox 4+ setting `line-height` on `input` using `!important` in\n * the UA stylesheet.\n */\n\ninput {\n  line-height: normal;\n}\n\n/**\n * It's recommended that you don't attempt to style these elements.\n * Firefox's implementation doesn't respect box-sizing, padding, or width.\n *\n * 1. Address box sizing set to `content-box` in IE 8/9/10.\n * 2. Remove excess padding in IE 8/9/10.\n */\n\ninput[type=\"checkbox\"],\ninput[type=\"radio\"] {\n  box-sizing: border-box; /* 1 */\n  padding: 0; /* 2 */\n}\n\n/**\n * Fix the cursor style for Chrome's increment/decrement buttons. For certain\n * `font-size` values of the `input`, it causes the cursor style of the\n * decrement button to change from `default` to `text`.\n */\n\ninput[type=\"number\"]::-webkit-inner-spin-button,\ninput[type=\"number\"]::-webkit-outer-spin-button {\n  height: auto;\n}\n\n/**\n * 1. Address `appearance` set to `searchfield` in Safari and Chrome.\n * 2. Address `box-sizing` set to `border-box` in Safari and Chrome.\n */\n\ninput[type=\"search\"] {\n  -webkit-appearance: textfield; /* 1 */\n  box-sizing: content-box; /* 2 */\n}\n\n/**\n * Remove inner padding and search cancel button in Safari and Chrome on OS X.\n * Safari (but not Chrome) clips the cancel button when the search input has\n * padding (and `textfield` appearance).\n */\n\ninput[type=\"search\"]::-webkit-search-cancel-button,\ninput[type=\"search\"]::-webkit-search-decoration {\n  -webkit-appearance: none;\n}\n\n/**\n * Define consistent border, margin, and padding.\n */\n\nfieldset {\n  border: 1px solid #c0c0c0;\n  margin: 0 2px;\n  padding: 0.35em 0.625em 0.75em;\n}\n\n/**\n * 1. Correct `color` not being inherited in IE 8/9/10/11.\n * 2. Remove padding so people aren't caught out if they zero out fieldsets.\n */\n\nlegend {\n  border: 0; /* 1 */\n  padding: 0; /* 2 */\n}\n\n/**\n * Remove default vertical scrollbar in IE 8/9/10/11.\n */\n\ntextarea {\n  overflow: auto;\n}\n\n/**\n * Don't inherit the `font-weight` (applied by a rule above).\n * NOTE: the default cannot safely be changed in Chrome and Safari on OS X.\n */\n\noptgroup {\n  font-weight: bold;\n}\n\n/* Tables\n   ========================================================================== */\n\n/**\n * Remove most spacing between table cells.\n */\n\ntable {\n  border-collapse: collapse;\n  border-spacing: 0;\n}\n\ntd,\nth {\n  padding: 0;\n}\n</style>\n<style id=\"style-init-screen\" type=\"text/css\">/***********************************************************************************************************************\n *\n * init-screen.css\n *\n * Copyright © 2014–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\n#init-screen { display: none; z-index: 100000; position: fixed; top: 0px; left: 0px; height: 100%; width: 100%; font-size: 28px; text-align: center; }\n#init-screen p { display: none; width: 75%; margin: 2em auto; font-weight: bold; font-style: italic; }\n#init-loading progress { height: 20px; } /* fixes a rendering bug in Chrome on certain platforms */\nhtml.init-no-js #init-screen, html.init-lacking #init-screen, html.init-loading #init-screen { display: block; }\nhtml.init-no-js #init-no-js { display: block; }\nhtml.init-lacking #init-lacking { display: block; }\nhtml.init-loading #init-loading { display: block; }\nhtml.init-loading #ui-bar, html.init-loading #passages { display: none; }\nhtml.init-no-js #init-no-js, noscript { color: red; font-weight: bold; }\n</style>\n<style id=\"style-fonts\" type=\"text/css\">/***********************************************************************************************************************\n *\n * fonts.css\n *\n * Copyright © 2014–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\n@font-face {\n\tfont-family: \"tme-fa-icons\";\n\tsrc: url('data:application/octet-stream;base64,d09GRgABAAAAACWoAA4AAAAAQhQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABRAAAAEQAAABWPihI/2NtYXAAAAGIAAAAOgAAAUrQXRm3Y3Z0IAAAAcQAAAAKAAAACgAAAABmcGdtAAAB0AAABZQAAAtwiJCQWWdhc3AAAAdkAAAACAAAAAgAAAAQZ2x5ZgAAB2wAABjCAAAq+uJ4WNtoZWFkAAAgMAAAADQAAAA2BZlJs2hoZWEAACBkAAAAIAAAACQIJwQZaG10eAAAIIQAAABuAAABOPTeAABsb2NhAAAg9AAAAJ4AAACeojKW6m1heHAAACGUAAAAIAAAACAA6gvwbmFtZQAAIbQAAAGPAAAC/eLsyKlwb3N0AAAjRAAAAfwAAAM0412SIHByZXAAACVAAAAAZQAAAHvdawOFeJxjYGRWYZzAwMrAwVTFtIeBgaEHQjM+YDBkZGJgYGJgZWbACgLSXFMYHF4wvPBhDvqfxRDFHMQwDSjMCJIDANLeC6V4nGNgYGBmgGAZBkYGEHAB8hjBfBYGDSDNBqQZGZgYGF74/P8PUvCCAURLMELVAwEjG8OIBwC4Ywb6AAAAAAAAAAAAAAAAAAB4nK1WaXMTRxCd1WHLNj6CDxI2gVnGcox2VpjLCBDG7EoW4BzylexCjl1Ldu6LT/wG/ZpekVSRb/y0vB4d2GAnVVQoSv2m9+1M9+ueXpPQksReWI+k3HwpprY2aWTnSUg3bFqO4kPZ2QspU0z+LoiCaLXUvu04JCISgap1hSWC2PfI0iTjQ48yWrYlvWpSbulJd9kaD+qt+vbT0FGO3QklNZuhQ+uRLanCqBJFMu2RkjYtw9VfSVrh5yvMfNUMJYLoJJLGm2EMj+Rn44xWGa3GdhxFkU2WG0WKRDM8iCKPslpin1wxQUD5oBlSXvk0onyEH5EVe5TTCnHJdprf9yU/6R3OvyTieouyJQf+QHZkB3unK/ki0toK46adbEehivB0fSfEI5uT6p/sUV7TaOB2RaYnzQiWyleQWPkJZfYPyWrhfMqXPBrVkoOcCFovc2Jf8g60HkdMiWsmyILujk6IoO6XnKHYY/q4+OO9XSwXIQTIOJb1jkq4EEYpYbOaJG0EOYiSskWV1HpHTJzyOi3iLWG/Tu3oS2e0Sag7MZ6th46tnKjkeDSp00ymTu2k5tGUBlFKOhM85tcBlB/RJK+2sZrEyqNpbDNjJJFQoIVzaSqIZSeWNAXRPJrRm7thmmvXokWaPFDPPXpPb26Fmzs9p+3AP2v8Z3UqpoO9MJ2eDshKfJp2uUnRun56hn8m8UPWAiqRLTbDlMVDtn4H5eVjS47CawNs957zK+h99kTIpIH4G/AeL9UpBUyFmFVQC9201rUsy9RqVotUZOq7IU0rX9ZpAk05Dn1jX8Y4/q+ZGUtMCd/vxOnZEZeeufYlyDSH3GZdj+Z1arFdgM5sz+k0y/Z9nebYfqDTPNvzOh1ha+t0lO2HOi2w/UinY2wvaEGT7jsEchGBXMAGEoGwdRAI20sIhK1CIGwXEQjbIgJhu4RA2H6MQNguIxC2l7Wsmn4qaRw7E8sARYgDoznuyGVuKldTyaUSrotGpzbkKXKrpKJ4Vv0rA/3ikTesgbVAukTW/IpJrnxUleOPrmh508S5Ao5Vf3tzXJ8TD2W/WPhT8L/amqqkV6x5ZHIVeSPQk+NE1yYVj67p8rmqR9f/i4oOa4F+A6UQC0VZlg2+mZDwUafTUA1c5RAzGzMP1/W6Zc3P4fybGCEL6H78NxQaC9yDTllJWe1gr9XXj2W5twflsCdYkmK+zOtb4YuMzEr7RWYpez7yecAVMCqVYasNXK3gzXsS85DpTfJMELcVZYOkjceZILGBYx4wb76TICRMXbWB2imcsIG8YMwp2O+EQ1RvlOVwe6F9Ho2Uf2tX7MgZFU0Q+G32Rtjrs1DyW6yBhCe/1NdAVSFNxbipgEsj5YZq8GFcrdtGMk6gr6jYDcuyig8fR9x3So5lIPlIEatHRz+tvUKd1Ln9yihu3zv9CIJBaWL+9r6Z4qCUd7WSZVZtA1O3GpVT15rDxasO3c2j7nvH2Sdy1jTddE/c9L6mVbeDg7lZEO3bHJSlTC6o68MOG6jLzaXQ6mVckt52DzAsMKDfoRUb/1f3cfg8V6oKo+NIvZ2oH6PPYgzyDzh/R/UF6OcxTLmGlOd7lxOfbtzD2TJdxV2sn+LfwKy15mbpGnBD0w2Yh6xaHbrKDXynBjo90tyO9BDwse4K8QBgE8Bi8InuWsbzKYDxfMYcH+Bz5jBoMofBFnMYbDNnDWCHOQx2mcNgjzkMvmDOOsCXzGEQModBxBwGT5gTADxlDoOvmMPga+Yw+IY59wG+ZQ6DmDkMEuYw2Nd0ayhzixd0F6htUBXowPQTFvewONRUGbK/44Vhf28Qs38wiKk/aro9pP7EC0P92SCm/mIQU3/VdGdI/Y0Xhvq7QUz9wyCmPtMvxnKZwV9GvkuFA8ouNp/z98T7B8IaQLYAAQAB//8AD3icrToNcBzVefe9/b3dvd29u909/dyd7ke6k86yLEunOyHJsrCxJWyJGmEcLMDYxBhHNsZQBzOAkjQmFDrGIq5gHEIcCILOAGZq3IQO04RkIGkgaUMKMbQznSlJW0wgJtOQHxRr1e+93TvJwq7JTD3y2/f//bzvfX/vAhAIzL3KPcYNBFIB8UR9EJYuAcuAqGNbOiwDSczkuorlaJ6WTeVSRwMIDveY8aN20GztjzMhW4P2H+kNUPM5NaVNQE0K3tWM77vv8rJqgnT33VJE4WWIfd/QbKHZjcXcZiFAqjCDgUJA/mZTWOIIwi0vAwNiUjkW9THIZs6DAbnj6ffGP/P+0y2vv+5SXGLKuXHJPJH92c+yT7x3883wnI9W/DxI4T9+bm7uOL+MUwNywAg0BJYFQgNKa2NDzFBEjqeM0SFXLHU4YKe7yjFoSmdEKWw5nemOUj5czMXCliilM7lyuFgqp3HaDf1j/fhH+s6cfm4MEpA8c0BSQBO5CUkD5fJi05kDjSUoNnETTUUSXtpPVm0aGHDdmV0nNkPiMUWeHZMVRSZPSlp0dqypCKVG8iT9IK5AEeamyZGAjecW5tm5SSBm8ojiSqBsYoXDTRtuymw13V8axjB+p2EPlsMGcRzTTRkGOLRpmk/AzSZ+A97ecx+QN8g9gUbc26F7N+GJiN5pLGMA8hUo7EQcHI455A0PwrS3I37N+bZhTE8bex1aeeIJ4+MTjTY6gcH+iIvgGWQRdh2TR9sS81kspCzytguLfBcyuBOLXuhwYnZnh8NFUs6plLPLScGpWBKwkYztwsop7Hie9r7rYK/9brWXTg9U+RiBX+GJiyc0rgIv7UNJe3vPjrFdyZOV/byNUkyW/0AuIi/h+h6U5a64SmW5ieGcya2AYimG+EUtnZN08ImgveV+KOYykiiJVMrbkI+dHUkC9+nyPUFdD94j639r1uTq7FiSNrR1hXS8uLbGapYUSbpaJvzmp5aODbU9iJNBU1gJa5LFTCqihNpDigmWWtc2GjUy7Y2m3hHk14qmPJXp2cTInZudO85dhzw2AuXAJQHl+Yt7l0RVjkO8u4q5JZARE2A5yNxStNgGWcQSj7izA1HucCgJOsRsb7xYWgn9XAwvRqaN4HAS4ENF3kXFFovJ/muW3zsYDK3jxaCQbOouOPXZPmBDNZG4krS0N2/9wakf7hHv+IcPX/jcaGWZAp9fvrFtv66UeSlXn4zYdZo5kLNwIJJRTbEu3jz62Zf37Xv5l7RAeugZfAQ7kJ5koA3PoJB1eP8MpHRVWqpygyITpiKz4DCoHMENlun+wrDA0bNZ9jmJZdZwhhx9UnewMKztg2yAlie9j6O7Lzrks7tYdRdOO4u/FJ9e5G93RyFTJ1f5G17IZDs7z25uEfuFBYwlvYpUUuTnKJO6umg5IymD88yGGxbycjN2JOkIVk6wUoEzm/0O5T/Owb92Jg8NyL/6qFrl30IZ5nSgMp3nch7DkvOMCaMeoQ1U4JZxQncenmAMmcAei/S7V9CvAccW8mczwtMCceSQ8nwhXWuKAeQPJbRCc9RnhoSyhvBL+WgxTzsk0Y567IFj+35wa4Xq7ykS5YIm7UIdq4iCfKcsiIoSvFFWONUnFovZoXHKhXE69R9hTOIEgZPcJ0VZRrx+i3j9hhtFPqQDnYjX8uaEpS2+F4twiVkOylSJAwfvBZO3XBnoTaEHtltSWAGKIEl3SJIQ1CRESIRnLFtJRc88GckEbQuOBTO5zBXziL0JIPKiyMtzggwiMc+czmbDEbDMbJaLhC3LPzPuFOKaD6zEM+tt15gNxTPLIg5dvglCfGmbmakYmqmKsEfRVOWWAXjqvEzVeamT6botq9321Vu2rIb7KOrufmZ24LWmoiI3yspJJ65e704JprBSFGH3pxXLhAQe9fBzbM1rq7YAm1dsctvZSiqu8G94rxwS/LQ7JYorRR0XXq/GmSh4dJADKAsSk70ajQ8gHdE0MhzVjOCbVDSvKINd1PhKVN+fgMTG2zYCvIaq+V2mmsNTP36IRLD6xO7ejWTDisfc7zCVD6tQW+/eMTW1Y3fSt20foe+hBZpQ3zfGfH3vyzmCZNvHFoJFVPrRjj7m6I26M3r7KHQxgD5c2H/4tQdIeJLJ+yQDvTsZOwv4jYfJQxVaxxmtKtNTTVaQnRmS6kkWvfBoNvCeIT55jt41PJZwpg3YYeJYGK+dppgK/sF+R/8ggZIOBlnyNoK/qpwokLZ6uCFRKCTKV8HeGaYksPg2Xj/3fyQZb6dhGWv2QLLQU4DW7lZwf77Hw+vb3AjzexKIVywkEXoGlB1JUqr4FW3A7BZlDzgzhZ5W0tyfI1da7mmn13JvsZOFxLuJIRsmLXJVskByA41iu/uvSds9bWOnPZQ4lSgANm+xqQ6gMPlGH2YR79rSDIXLXQBujHZSxkCpSIeynwCdNxEFJ2HVmSDaFPxQYoIN2BfCM8E6zTCu66VDSQ97KkPfIa8i7nGUITNAZagDhYFJjeg5rXh+bcBuYamT/JWmRVE8Iopeb/3ud1ZdSIs4TkQLcaogJ63Z5dGUxEfefz8qSKko+Qm2PB/ZgyEEMngmjkjovYB0GBog+n9COzD7MiQ73pfOA5S8NLseIst+QWbPC9y/J8dRv7QFliCNWcnzAYlI3fE8hdNVbBPY1WEeZxm8m5mKOdypQRG1qhiRgQBnZbr7N20qT1ipoPsLVYWEGq8hE3BoLPn2tV8PhWVe0WTB4nIN3WMD7cmIiDZEhaSSROulWMbk2+sX4LIs0Iq4NNdUfV3mDeqCbaEOligmbYSFCaU0VRVULrhTKoKlIMubNvV3ZyyOByWMilXkBpNjcIjihTjBrwzF/bmKF1iMJNsHxrobcnxElDVF0C3u69fevP5txIsEcUrVZyR96DPqiI/C+zGTp0uZGkXVP6PG1RncET7Ey/eKjnX885QeWw83krsCIVyvMp8TD9P3rEvMFUkFZxS6Rw25ytWQJ/52/tqLyQSDrc7Dpiq/H2XDgYsVBgjnK7BF95EwLKLNKLh0bg5x74VXPNwJO1fq7raB588j7pbhat78pDKjPE1td1Jl6Hhn8Q73LdISsCrrgwuijljQ28Tinnavx+Xu9ap6jYqn2QzNaly7RoVJ99MoBl/DvmtU1X0Lu3FCnO37XXKEW832Nai8BYnDKKvIF92W3F9dotK94ahCNyJPuW+5b2L1WrQ2X6fSc1TBejLg77uvsm8FX2b1ghWk6cbjuB1FUIVm9y0f6aMKfMbdhjshNGihFKgIgE7044ZvkbXz+zbh3chXN/f35Z6mOyF2b/m7H6V7HVV3XYOYtiDOig/J25bh+xPuAPMdxRPRc8V1YU8Z2mEv9OIO2O6DTg8Wtt2C3+lCcjBRmEaNVbDhi0nLnUK1ttvqdVpsexruQ93WGnf3T9s47N+te7nN5FeohRGeChUfIvZx5htAPYTNjQl/ea/tTlkW7LZ7nIK3dyNsGUwWpq0+a4k/ALvozB5nurkCqwthUdrq5mnzBD/tu5rpfPVYuC6L0VZwnMfd/YnGxgTc97jjFNjGFvRQ6iyrYPfZjyPVyQJM233YRF5YVb1xgLzjwVMX3NOwZ/K7wtJZx4W8pGRNNzf4ZOBeCKgPCxuKcUYmxQNycbjP5wGlEJGk8OZc369tR3gtaZ+X6CbmVkIONRVJcugpluk1TQL1Fqmfy1ELVi4hYy1zJhYNj4zu7RkfbuebN17fv+q2Fj4sDgtE7Hv2uk89uneIH7j9yNWjR1YMmUvJSzO6s9QcGWkbHt83PtzW0yWCMMLr4roNcMm+o88e3XdJ/0VDkWiFDxSv5YhXq8d3nVAryjjtoDXp7Ojn2gg6ijGHIUxDpQZ0Y2lQym2+5NZHN219to8XhsUw33Lb6p6dG9DVGN598/bmkXA0NoPeR2t4qO/h0U8d3bcKtmB5yeilos6PCCB29fgINjeNmEsdfaYmGhm6qB9RrPhEx7mrEbfGwCDauZXNJo09wLJ1oAhSe1NxWkUDKKJofMqeE+szt8S4K9JYmjbLXRRtylOU1vWN//mVy4/0DVGNqM9QJT7SvL287ot5MSZoGC/oyHTWO7p3vdd5s6RB439/5fKH6aIaEDh46AVkpMqWo1YdaWpe1690hzT4e79jxGuLvD+R0iUwuiJ+TLUM4+yrA8aAdsVAsX1JFgMsTkCF4ceBdtgLZ8oXaENnPpfPipLA6A57nn4+XI1hUbCoYmig1KP5pH44Kybnq4cUyatKivvTmXpeOC7y8J4il3yHncWVz+SDrc5zTqucPyYro3Af7XP30/I8ddJxsQAgXIFbz37QdsmqNhJl0K6145C0rkWzExAX8aM3sDpwYyA8oF83PNBXWu7xRPQMIT1E6syw7M4F2tFwOmyhVKQ7+uH/lz9DribLBF4jsuze94lYBc+7LzLOXMw4c+66u52EZz/QLEWxyA0XZFuA9+OVUfSTwyzWCw0o3a0Jx9BYTrKp2AZiEi9qGSs6OFhZkPboRDXesZKpbcd3UOjV8dMgNNQhr1pJh0Qy5petVIQ48Zq1KefMj7zIhluf3pQeBs5JfUuJMGcgHFRik16gP1mzHX2EmroaYhmVysETLOo54aSGU/gHzbEwdRvCMXuGhUczHj3HkZ42Rk9LYIDS07c8YRuqSBg91Pmnwo8VghFR2Y9oKTmxziSwi0HTN2I1cMvT3E7Fezk/Pae1UnYyUwqdRnqCNZPoXSJSk6hxGWmRBKqBSMqyTP97/wmaJcQCGpqbG5Iw6vhEtHpEVWihepULpFG3rqG0rOha2qTxJIC0YOSYFjrxEtP8nlSlIxvu7PLcRKmS76mk04Sq0HoTqJ04CcfcK+DDIU34mhCX/dByaAiDy58ibicVeRdNJrNyezI2G/ESlUKsZDxiOtLJk/ChXCc9Imp+1nO2xL6QZIkkWiizM7SHIF9q9K8ZpQDx8zOjgWaMzORvdrSGPJ2sEzRYZer9O2gmWD4zSTr6sSuH8Uc/IGjmyLIMOHUV0G48840967ixy2v6zIhcU+pr3bDj9u0bc1xfqUbO9sUuH3O/iqEbFPqaPbOBZuFTO57rx7mxvnDL7avRFLah/ei55LZCpKddjqz4OxhyH6YRLuzA0rcfY5yC8rQTcb08JdLYleZW8TZ0lGgSCyVfQoQtRDiPV6BqKLryzL7kqRmkuoGdE5UzlKWy39mJQlU1OChf1KrEHOYcsdMhvaO3j5JN+zZBXJZ2Kmq0WRSMDSFJGqmtC0q8eZesmfWxPxNNca3DC3KzYsg7MBBXhJ2yHmvy5sojNXVBmQvfhUdoxJ0NgiENWTzfqwd3SOjC927ceNvGjbfTUTNp13eIumhvAKEvJA/HTUW6Maj1CeJAUtBFrcOI1xugSWxubV1qqaRJ1gZvqiHLbKqwOo5TR9hELw7/iBsjL/t6WXl+SWN9VOO5RfnTtJcwreTFY35bWthGB+bMB+yOcGEDg4bztxbkUR0wh1h2kJWgV0awMR+Hjvn5mlrmu9BMCMpYsZynmQC8KR2xco4maZIg5jN5CU86ViJ/s27nzqlxgFc6167fuXP92s5XYOdDO8j4pYNYw16IjR8eH79U0ra3Y6V9uyat20l2P7AbsKpjJ81Tzs39nt9PXgqYeL9LNB+Yi9uMN1BEZ0knnvijDiZLEDg6dJ30NuA9oQEVh9U0uk/kgO8A+R94pvWy8YveWn0ZWbfmLepJXdqz5Z5B94qhu7d2k75r7l0Lx2gVtvTMr6FXgDY7p56d6qSNS+/e0ke6r//CQ1/YXiTdW++u+FK/529HfC3klvzNhK3Te4txIUFlkuQ8tIjguXrUG6WAPWgMsIcDF664d3v3DHXwhQ07YMul2I9QDvtQXz+bokoej3uUo5mt1Qi7f/m58pGoIAyavsnnFiUl8cbhKTpRmI+CKw9Y1oKc5GvZZJCT6kWJcCHNzzDS3KTQKEocr/6Fe1GoUf+1rq/QG/W/hs9goz8E649Xc5M6HxXjAnDV9OT9spBFuwOC26Prv2bzQ3RhCHfwaYpW8+LxqOzlYOZR7/Kf/RbmXMktCzAr3jWP/Kqt5KUqZDq4uTqyBbYGfL17HcuL19KcjykyePSoAP2bNgILH1qOXXFwA9l471P3bOIvOwRXL8j+k0OjB6cPjrLCfe2sXP/824QcsAMZlOmGWiMo0rwb4K1qo+mH/LkBVlXdA+cFXFFWvz0//AXvbZ6+ac3GoyzHHvXfzCqvNILfLi9qV7KBJ/03OPbql/A+XlcDa3g9C1/rnPPU/XzkR4E3q/4p6kHES6V3vVx1M7x3EG4RnpwfhuT9B8mTF4BG6w/vZp7SbtoL4oJBkCuYe2+LL3GT6CtdzGKjNas6FGaHETyqOIeljCSdy4azYTwkLxFIL08OHSKaM+7sonl9vERpGguhHaS5bUgz24xu3ETTPsVKqntkIZfpqR1MdBfQKd6hmiFHviU1QZ260MQ2FSOcbfDmVoyFeHkb9rq/db9KFWsP6uutqz6LgZW6R+JrIjp86Gp6jSXL+7RoUv38yjEracH0NiVpKdu2ISBl27QDRdTKAT9WHoc/IL/p7w4sptcdmtpFR6IcZRnNXDnaT909x7Ykjj6PwmlFdP9FMuWgQvb8nAiKpHB7iS4/r+pk678LRCWOGpq9QwfOlOGlbpDkEPwThngKL7puibAY5LvMl+ZQQ8Yx4mxF/wZjkGJ7a3NjKl5jyjiJ/hAhLzVVExN+9qMpZsAyWImhu/eF2NlfcmS6bxq6lNlO9CZvxpjon/G7R5k1SqVwuFwOv3HTTZn0TTelSQs2wtjpPkNH8D/RH++b3mkosx0KLkzSlfi92qSrzPKX2arMTe692ChjJ7T5I75t3I487EIe5jXKQ6pg6Q83qs/lEn3noSFynmb4aOrBF9sEoBuHhKFYcL11up41emofLCQGE60wVdeDClSvn5qqM41Go7t+iuWUHqzrNrOGWTsFst5TtwLXXPk0Syc9fSX2rsBFmzadY6C/Fge8d+e5uXHkfyiQRc6vwTu2Ylkhz95Fq2/8+YVv/CxSqb7xxyqhDjDBRxFBxcQnSYzeBfrYNqGJjej4TLDfWEywII42hqZ+/BB/6I2DkCn0WS9uv3PD4Z0DpG/3oemDe7u5NS/aMOWtol60t2qCusYTSi19uHn1iHiQOpz2i2v6xx/4xqE9PfyqHQ+N3Ln9RftsmoxADcYAyvMt9Y73lr7wdwTUmb8g/u53GOaw6pPizJC9MJrEj7noG9sG1CNhmWN2BcF2dpRzGBfz5XrojEWZRxuj6aCYY0tiLJOTMmK2uJJQjxj/8hjKEB1iGHCj4JTpxczQzEtehAevG+5pUO12twtCjfG4I979yJB4a7RlZbDdVGV1OMgDQPZQY+ERm1wqiVyYJwJHMrGaP+o9YKbUlE2ApL6YEiyylNT9ESff74qtvCgqNSZcBVOa+2Hr9q9E70rVikGTcxRJ4BSQa6ImzpQIEXk+OFbqhvQRQ4souDWotqAiL2Xqm+AZ/Yz0kXcCOnvfqg1779vzOXtqtvPMii9Ig5+dwj87Kf4bQ6EJfdRt4PyQZYFY0/NXERbE5vPzi+As2njhToFqfp7h6ufXYTFiZ6MCryyG/xQX5qIBFddLfr6b+SYsHc3P1ocikRD5rxCMuNslxeBKuiZjzQpUY6kFvwNgPtyioHRxkEr9fv+HE5AwHFc9q0neOXOa/kiAi9ByQX3et1fZb2+q7yCL914QN5y1GVt/DOVaR29JPCECXV9iGaI84A7sQ9W3Y4dLZe4vVR1Mxd3Hc7rq7lNVOKjqHM9xqmiceVWXNTgoiO6fswpN0R/EfnefyHtnMvcsdw1nzMOJiSzGpQ+SPmclxmVRqlVM0HG5wNFSQYAIRhjE3ZDTsobwJbifVegTxj7sx7mCRwvp5XSWh6/QYs/TwjyMahKsVCYZVaeECMTR56MplPyzCfrSPO/dL0m8RwvpQ1oS56aF7i/58Mpn0eOHaKxcTNGd84cLd4oCvXPu3B+4a8kPUA7rmSzJ7E3Zy7OzuJEm/Mt+7Eh/pyDPMx7xF7luuh/CY9hDe4WZYLqvW+YhFlJiWX1PO0aOB6L0t3AVOUK7V/XSqP8Dx/CavHCY8erwC3jhyKHZR2nu9wXvpz4vKN4dwOIA22sZ/S1RTbhyBxbvF/XeXzEQpfEUTa0hLTTE+RigN9vzQhBp0RzT5OUaKazwlhEU8u0fx8D9XmGdwVmmZmpavDGuichhJJUz1nn5pp9yj5H3GG7DgZtovmnn5YNFiiT/JyIZqw6Uvd+i0TRIFwumFw7SVEg/TYvQDM/8hE9O4uTWEVlECuyU2tLW1oKK3jIk+bItDxy6TZKw36mttdZgKDxo1fIRzrFMSbrt0J/Cl8KVh1OcozuqGUyO7RxLBk3UrA6XfmDTF97qwAErpOl655GnjnTqOidyIQsHO08G/hcLt/j/AAB4nGNgZGBgAOLaW41M8fw2Xxm4mV8ARRguss1QhNC5H/9//Z/FUsEcBORyMDCBRAFTFwxveJxjYGRgYA76n8UQxVLGwPD/FUsFA1AEBfgBAHyYBUh4nGN+wcDAvACCWfSBNIgviMBM1kA6koGBMRWVBqsDYqYmiF4wHQkxg+kUBMPVWEP0gTDYvBdoahZAzYxEY0ciuWUBFjkoZimDYLC8IKpehmsQccYvSGYgYZB7YBhFL5o8cxTQjDUI/wIArpclrwAAAAAAAAA6AIYA3AEKAUgBgAGgAfoCYgKqAwIDOgOGA9wEQAR4BLYFAgU8BZoFzAYMBlIGmga6BtgG+AcYB0QHcAecB8gIAAg2CG4IpgjyCUAJrAo0CtALOAueDAoMYA0ADVANjg3mDiQOjg7GDvgPOA+ED84QPBB2EN4RNhGgEfISchKoEsgS6BMGEz4TXhOSE8QT+BQsFGIUiBTWFX0AAAABAAAATgBuAAYAAAAAAAIAAAAQAHMAAAAiC3AAAAAAeJx1kctOGzEUhn9DoIKgLloJdcdZIRDK5CKhSqyoogJrhLJDwgyeSzpjRx4HlGfgLcoz8Dp9j+76Z2KhqFJmZM93Ph/bxx4AX/AHCqvnnG3FCgeMVryFT/gReZv+JnKHfBd5B108RN6l/xV5H2d4idzFV/zmCqqzx2iK98gK39RR5C18Vt8jb9P/jNwh30fewaGaR96lf428j4l6i9zFsfo7drOFL/MiyMn4VEaD4bk8LsRRlVZXouehcL6RS8mcDaaqXJK6OtSml+lemTrb3Jp8Xmm/rtZ5YnxTOivDZLCur401XgfztNytec5HIWSSeVfLVdxHZt5NTRqSIoTZRb+/vj/GcJhhAY8SOQoECE5oT/kdYYAhf4zgkRnCzFVWCQuNikZjzhlFO9IwvmTLGFlaw4yKnCBlX9PUdD2Oa/Zlay1n3dLmXKei9xuzNvkJ7XLvso2F9SaselP2Na1tZ+i2wqePszV4ZhUj2sBZy1P4tmrB1X/nEd7XcmxKk9In7a0F2gv0+W44/z/KQo7lAHicbZLnlpswEIW5Bgy4bLLpvfeE9N57z76DLARWEJKOEEucpw8CO/kTncOdT6PhnlHxRt4wJt7/x47nYQQfAUKMESFGggmmmGGOLezBXmxjH/bjAA7iEA7jCI7iGI7jBE7iFE7jDM7iHM7jAi7iEi7jCq7iGq7jBlLcxC3cxh3cxT3cxwM8xCM8xhM8xTM8xwu8xCu8xhu8xTu8xwd8xCd8xhd8xTd8xw/sBLUlZuIkZZW2q0hzahvDRqocUyIpE4EWTR1WXDZ1sGRCz5yklBsqWBZwmauZk01mTqxl0nIlUyLs9r/Zej35m4kFl2XKftlAKFomTlKlmfQ1l74lRdB9dbxQqqyIKbc2MPQZGqbFKsqVaYnJ4ky1Ms24iQXLrYPE8GLZ07jRfaIvcf5JX+NoMhQ5jLoqFwenBS8Gpw7WTh05py6MaOtT2ibEGNXWKW1Da0i9nPY6dNe7CEWy7pc+5EJpvfJVnvtUFUHFZBPWS2LYxKqiECztVpINypAuGS2nvQ6Gs+H0hsk0U3ZznDETguua1/MNpLvMWH/RFGEuuobCihScxqS2zPC6jH4rVaVcxn1UjQ1yJW1QK2MTJ6nrPOqp0d3Vk1WoSVOz7p0oHeWdTbpoh5i3sVWpezp23AGTWch+Mmonu0o0Vb+l6RqdabLmRnveH9ru7j54nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjIwaEFoDhR6JwMDAycyi5nBZaMKY0dgxAaHjoiNzCkuG9VAvF0cDQyMLA4dySERICWRQLCRgUdrB+P/1g0svRuZGFwAB9MiuAAAAA==') format('woff');\n}\n</style>\n<style id=\"style-core\" type=\"text/css\">/***********************************************************************************************************************\n *\n * core.css\n *\n * Copyright © 2014–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\n/*\n\tDefault structural styles.\n*/\nhtml {\n\t/*\n\t\tWe define the base font size and line height here as they affect the layout\n\t\tof the base page elements (i.e. `#ui-bar`, `#ui-dialog`, and `#story`).\n\t*/\n\tfont: 16px/1 Helmet, Freesans, sans-serif;\n}\n\n/* Story data styling. */\n#store-area, tw-storydata {\n\tdisplay: none !important;\n\tz-index: 0;\n}\n\n/* Story display area styling. */\n#story {\n\tz-index: 10;\n\t-webkit-transition: margin-left 200ms ease-in;\n\t-o-transition: margin-left 200ms ease-in;\n\ttransition: margin-left 200ms ease-in;\n}\n\n#story-ar {\n\t/* added for OLDFASHIONED */\n\t/* margin: 2.5em; */\n\tborder: 2.5em;\n\tposition: fixed;\n    box-sizing: border-box;\n\theight: 100%;\n}\n\n@media screen and (max-width: 1136px) {\n\t#story {\n\t\tmargin-right: 1.5em;\n\t}\n}\n#passages {\n\tmax-width: 54em;\n\tmargin: 0 auto;\n}\n\n#passages-ar {\n\t/* added for OLDFASHIONED */\n\tborder: 0 auto;\n    pointer-events: auto;\n\t/* overflow-y: auto; */ \n\theight: 100%;\n}\n\n/* Special no transition styling. */\n.no-transition {\n\t-webkit-transition: none !important;\n\t-o-transition: none !important;\n\ttransition: none !important;\n}\n\n/*\n\tDefault appearance styles.\n*/\n*:focus {\n\toutline: thin dotted;\n}\n\n/* added for OLDFASHIONED */\nhtml {\n\tbackground-color: transparent;\n}\n\nbody {\n\t/* changed color and background-color for OLDFASHIONED */\n\tcolor: #111;\n\tbackground-color: transparent;\n}\n\na {\n\tcursor: pointer;\n\tcolor: #68d;\n\ttext-decoration: none;\n\t-webkit-transition-duration: 200ms;\n\t     -o-transition-duration: 200ms;\n\t        transition-duration: 200ms;\n}\na:hover {\n\tcolor: #8af;\n\ttext-decoration: underline;\n}\na.link-broken {\n\tcolor: #c22;\n}\na.link-broken:hover {\n\tcolor: #e44;\n}\nspan.link-disabled {\n\tcolor: #aaa;\n}\narea {\n\tcursor: pointer;\n}\nbutton {\n\tcursor: pointer;\n\tcolor: #eee;\n\tbackground-color: #35a;\n\tborder: 1px solid #57c;\n\tline-height: normal;\n\tpadding: 0.4em;\n\t-webkit-transition-duration: 200ms;\n\t     -o-transition-duration: 200ms;\n\t        transition-duration: 200ms;\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n}\nbutton:hover {\n\tbackground-color: #57c;\n\tborder-color: #79e;\n}\nbutton:disabled {\n\tcursor: not-allowed;\n\tbackground-color: #444;\n\tborder: 1px solid #666;\n}\ninput, select, textarea {\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n\tpadding: 0.4em;\n}\nselect {\n\tpadding: 0.34em 0.4em;\n}\ninput[type=\"text\"] {\n\tmin-width: 18em;\n}\ntextarea {\n\tmin-width: 30em;\n}\ninput[type=\"checkbox\"], input[type=\"file\"], input[type=\"radio\"], select {\n\tcursor: pointer;\n}\ninput:focus, select:focus, textarea:focus,\ninput:hover, select:hover, textarea:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\nhr {\n\tdisplay: block;\n\theight: 1px;\n\tborder: none;\n\tborder-top: 1px solid #eee;\n\tmargin: 1em 0;\n\tpadding: 0;\n}\ntextarea {\n\tresize: vertical;\n}\naudio, canvas, progress, video {\n\tmax-width: 100%;\n}\n\n.error {\n\tpadding: 0.25em;\n\tbackground-color: #511;\n\tborder-left: 0.5em solid #c22;\n}\n.error[title] {\n\tcursor: help;\n}\n.highlight, .marked {\n\tcolor: yellow;\n\tfont-weight: bold;\n\tfont-style: italic;\n}\n.nobr {\n\twhite-space: nowrap;\n}\n\n[data-icon]:before,\n[data-icon-before]:before,\n[data-icon-after]:after,\n.error:before,\n#story a.link-external:after {\n\tfont-family: \"tme-fa-icons\";\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\ttext-transform: none;\n\tline-height: 1;\n\tspeak: none;\n}\n[data-icon]:before {\n\tcontent: attr(data-icon);\n}\n[data-icon-before]:before {\n\tcontent: attr(data-icon-before) \"\\00a0\";\n}\n[data-icon-after]:after {\n\tcontent: \"\\00a0\" attr(data-icon-after);\n}\n.error:before {\n\tcontent: \"\\00a0\\e80d\\00a0\\00a0\";\n}\n#story a.link-external:after {\n\tcontent: \"\\00a0\\e80e\";\n}\n\n/* Passage styling. */\n.passage {\n\tline-height: 1.75;\n\ttext-align: left;\n\t-webkit-transition: opacity 400ms ease-in;\n\t-o-transition: opacity 400ms ease-in;\n\ttransition: opacity 400ms ease-in;\n\n\t/* added for OLDFASHIONED */\n    pointer-events: auto;\n}\n.passage-in {\n\topacity: 0;\n}\n.passage ul, .passage ol {\n\tmargin-left: 0.5em;\n\tpadding-left: 1.5em;\n}\n.passage table {\n\tmargin: 1em 0;\n\tborder-collapse: collapse;\n\tfont-size: 100%;\n}\n.passage tr, .passage th, .passage td, .passage caption {\n\tpadding: 3px;\n}\n.passage .error {\n\twhite-space: nowrap;\n}\n\n/* Macro styling. */\n.macro-repeat-insert,\n.macro-timed-insert {\n\t-webkit-transition: opacity 400ms ease-in;\n\t-o-transition: opacity 400ms ease-in;\n\ttransition: opacity 400ms ease-in;\n}\n.macro-repeat-in,\n.macro-timed-in {\n\topacity: 0;\n}\n</style>\n<style id=\"style-ui-bar\" type=\"text/css\">/***********************************************************************************************************************\n *\n * ui-bar.css\n *\n * Copyright © 2015–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\n/*\n\tPatches to the core styles.\n*/\n#story {\n\tmargin-left: 20em;\n}\n#ui-bar.stowed ~ #story {\n\tmargin-left: 1.5em;\n}\n@media screen and (max-width: 1136px) {\n\t#story {\n\t\tmargin-left: 19em;\n\t}\n\t#ui-bar.stowed ~ #story {\n\t\tmargin-left: 1.5em;\n\t}\n}\n/*\n\tAt very narrow viewport widths, set `#story{margin-left}` equal to the value\n\tof `#ui-bar.stowed~#story{margin-left}`, so that `#ui-bar` will side over top\n\tof `#story` when unstowed, rather than shoving it over.\n*/\n@media screen and (max-width: 768px) {\n\t#story {\n\t\tmargin-left: 3.5em;\n\t}\n}\n\n\n/*\n\tDefault structural styles.\n*/\n#ui-bar {\n    pointer-events: auto;\n\tposition: fixed;\n\tz-index: 50;\n\ttop: 0;\n\tleft: 0;\n\twidth: 17.5em;\n\theight: 100%;\n\tmargin: 0;\n\tpadding: 0;\n\tcolor: #eee;\n\t-webkit-transition: left 200ms ease-in;\n\t-o-transition: left 200ms ease-in;\n\ttransition: left 200ms ease-in;\n}\n#ui-bar.stowed {\n\tleft: -17.75em;\n}\n#ui-bar-body {\n\theight: 90%; /* fallback for browsers without support for calc() */\n\theight: calc(100% - 2.5em);\n\tmargin: 2.5em 0;\n\tpadding: 0 1.5em;\n}\n#ui-bar.stowed #ui-bar-history,\n#ui-bar.stowed #ui-bar-body {\n\tvisibility: hidden;\n\t-webkit-transition: visibility 200ms step-end;\n\t-o-transition: visibility 200ms step-end;\n\ttransition: visibility 200ms step-end;\n}\n\n\n/*\n\tDefault appearance styles.\n*/\n#ui-bar {\n\tbackground-color: #222;\n\tborder-right: 1px solid #444;\n\ttext-align: center;\n}\n#ui-bar-tray {\n\tposition: absolute;\n\ttop: 0.2em;\n\tleft: 0;\n\tright: 0;\n}\n#ui-bar a {\n\ttext-decoration: none;\n}\n#ui-bar hr {\n\tborder-color: #444;\n}\n#ui-bar-toggle,\n#ui-bar-history [id|=\"history\"] {\n\tfont-size: 1.2em;\n\tline-height: inherit;\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n}\n#ui-bar-toggle {\n\tdisplay: block;\n\tbackground-color: #333;\n\tborder-color: #eee;\n\tcolor: #eee;\n\tposition: absolute;\n\ttop: 0;\n\tright: -2em;\n/*\tborder-right: none; */\n\tpadding: 0.3em 0.45em 0.25em;\n}\n#ui-bar.stowed #ui-bar-toggle {\n\tpadding: 0.3em 0.35em 0.25em 0.55em;\n}\n#ui-bar-toggle:hover {\n\tbackground-color: #eee;\n\tcolor: #333;\n\tborder-color: #333;\n}\n#ui-bar-history {\n\tmargin: 0 auto;\n}\n#ui-bar-history [id|=\"history\"] {\n\tpadding: 0.2em 0.45em 0.35em;\n}\n#ui-bar-history #history-jumpto {\n\tpadding: 0.2em 0.665em 0.35em;\n}\n#ui-bar-history [id|=\"history\"]:not(:first-child) {\n\tmargin-left: 1.2em;\n}\n#ui-bar-history [id|=\"history\"]:hover {\n\tbackground-color: #444;\n\tborder-color: #eee;\n}\n#ui-bar-history [id|=\"history\"]:disabled {\n\tcolor: #444;\n\tbackground-color: transparent;\n\tborder-color: #444;\n}\n#ui-bar-body {\n\tline-height: 1.5;\n\toverflow: auto;\n}\n#ui-bar-body > :not(:first-child) {\n\tmargin-top: 2em;\n}\n#story-title {\n\tmargin: 0;\n\tfont-size: 162.5%;\n}\n#story-author {\n\tmargin-top: 2em;\n\tfont-weight: bold;\n}\n#menu ul {\n\tmargin: 1em 0 0;\n\tpadding: 0;\n\tlist-style: none;\n\tborder: 1px solid #444;\n}\n#menu ul:empty {\n\tdisplay: none;\n}\n#menu li {\n\tmargin: 0;\n}\n#menu li:not(:first-child) {\n\tborder-top: 1px solid #444;\n}\n#menu li a {\n\tdisplay: block;\n\tpadding: 0.25em 0.75em;\n\tborder: 1px solid transparent;\n\tcolor: #eee;\n\ttext-transform: uppercase;\n}\n#menu li a:hover {\n\tbackground-color: #444;\n\tborder-color: #eee;\n}\n\n/* Stop text selection on certain UI elements. */\n#ui-bar-history [id|=\"history\"],\n#ui-bar-toggle,\n#menu a {\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n}\n\n\n/*\n\tDefault font icon styles.\n*/\n#ui-bar-toggle:before,\n#ui-bar-history [id|=\"history\"],\n#menu-item-saves a:before,\n#menu-item-settings a:before,\n#menu-item-restart a:before,\n#menu-item-share a:before {\n\tfont-family: \"tme-fa-icons\";\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\ttext-transform: none;\n\tline-height: 1;\n\tspeak: none;\n}\n#ui-bar-toggle:before {\n\tcontent: \"\\e81d\";\n}\n#ui-bar.stowed #ui-bar-toggle:before {\n\tcontent: \"\\e81e\";\n}\n#menu-item-saves a:before {\n\tcontent: \"\\e82b\\00a0\";\n}\n#menu-item-settings a:before {\n\tcontent: \"\\e82d\\00a0\";\n}\n#menu-item-restart a:before {\n\tcontent: \"\\e82c\\00a0\";\n}\n#menu-item-share a:before {\n\tcontent: \"\\e82f\\00a0\";\n}\n</style>\n<style id=\"style-ui-dialog\" type=\"text/css\">/***********************************************************************************************************************\n *\n * ui-dialog.css\n *\n * Copyright © 2015–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\n/*\n\tPatches to the core styles.\n*/\nhtml.ui-dialog-open body {\n\toverflow: hidden;\n}\n\n\n/*\n\tDefault structural styles.\n*/\n#ui-overlay.open {\n\tvisibility: visible;\n    pointer-events: auto;\n\t-webkit-transition: opacity 200ms ease-in;\n\t-o-transition: opacity 200ms ease-in;\n\ttransition: opacity 200ms ease-in;\n}\n#ui-overlay:not(.open) {\n\t-webkit-transition: visibility 200ms step-end, opacity 200ms ease-in;\n\t-o-transition: visibility 200ms step-end, opacity 200ms ease-in;\n\ttransition: visibility 200ms step-end, opacity 200ms ease-in;\n}\n#ui-overlay {\n    pointer-events: none;\n\tvisibility: hidden;\n\topacity: 0;\n\tz-index: 1000;\n\tposition: fixed;\n\ttop: 0px;\n\tleft: 0px;\n\theight: 100%;\n\twidth: 100%;\n}\n#ui-dialog.open {\n\tdisplay: block;\n    pointer-events: auto;\n\t-webkit-transition: opacity 200ms ease-in;\n\t-o-transition: opacity 200ms ease-in;\n\ttransition: opacity 200ms ease-in;\n}\n/*\n\tWe do not animate `#ui-dialog:not(.open)` for various reasons.  Chief among\n\tthem, however, is so that the dialog isn't in the middle of its animation\n\twhen other page updates happen.\n\n\te.g. The restoration of `overflow` on `body` would cause the still animating\n\t     dialog to jump around a little if a scrollbar were to pop in.\n\n\t     Any dialog action which performs a task which has its own animations\n\t     (e.g. passage display) or causes the page to reload in addition to\n\t     closing the dialog could cause display shenanigans.\n*/\n#ui-dialog {\n\tdisplay: none;\n    pointer-events: none;\n\topacity: 0;\n\tz-index: 1100;\n\tposition: fixed;\n\ttop: 50px;\n\tcolor: #eee;\n\tmargin: 0;\n\tpadding: 0;\n}\n#ui-dialog-titlebar {\n\tposition: relative;\n}\n#ui-dialog-close {\n\tdisplay: block;\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n\twhite-space: nowrap;\n}\n#ui-dialog-body {\n\toverflow: auto;\n\tmin-width: 280px;\n\theight: 90%; /* fallback for browsers without support for calc() */\n\theight: calc(100% - 2.1em - 34px); /* title(2.1em) - top/bottom borders(2px) - top/bottom gutters(32px) */\n}\n\n/* Settings dialog styling. */\n#ui-dialog-body.settings [id|=\"setting-body\"] {\n\tdisplay: table;\n\twidth: 100%;\n}\n#ui-dialog-body.settings [id|=\"setting-label\"] {\n\tdisplay: table-cell;\n\tpadding: 0.4em 2em 0.4em 0;\n}\n#ui-dialog-body.settings [id|=\"setting-label\"] + div {\n\tdisplay: table-cell;\n\tmin-width: 8em;\n\ttext-align: right;\n\tvertical-align: middle;\n\twhite-space: nowrap;\n}\n\n\n/*\n\tDefault appearance styles.\n*/\n#ui-overlay {\n\tbackground-color: #000;\n}\n#ui-overlay.open {\n\topacity: 0.8;\n}\n#ui-dialog {\n\tmax-width: 66em;\n}\n#ui-dialog.open {\n\topacity: 1;\n}\n#ui-dialog-titlebar {\n\tbackground-color: #444;\n\tmin-height: 24px;\n}\n#ui-dialog-title {\n\tmargin: 0;\n\tpadding: 0.2em 3.5em 0.2em 0.5em;\n\tfont-size: 1.5em;\n\ttext-align: center;\n\ttext-transform: uppercase;\n}\n#ui-dialog-close {\n\tcursor: pointer;\n\tfont-size: 120%;\n\tmargin: 0;\n\tpadding: 0;\n\twidth: 3.6em;\n\theight: 92%;\n\tbackground-color: transparent;\n\tborder: 1px solid transparent;\n\t-webkit-transition-duration: 200ms;\n\t     -o-transition-duration: 200ms;\n\t        transition-duration: 200ms;\n}\n#ui-dialog-close:hover {\n\tbackground-color: #b44;\n\tborder-color: #d66;\n}\n#ui-dialog-body {\n\tbackground-color: #111;\n\tborder: 1px solid #444;\n\ttext-align: left;\n\tline-height: 1.5;\n\tpadding: 1em;\n}\n#ui-dialog-body > *:first-child {\n\tmargin-top: 0;\n}\n#ui-dialog-body hr {\n\tbackground-color: #444;\n}\n\n/* Default dialog button bar styling. */\n#ui-dialog-body ul.buttons {\n\tmargin: 0;\n\tpadding: 0;\n\tlist-style: none;\n}\n#ui-dialog-body ul.buttons li {\n\tdisplay: inline-block;\n\tmargin: 0;\n\tpadding: 0.4em 0.4em 0 0;\n}\n#ui-dialog-body ul.buttons > li + li > button {\n\tmargin-left: 1em;\n}\n\n/* List-based dialog styling (primarily for the Rewind & Share dialogs). */\n#ui-dialog-body.list {\n\tpadding: 0;\n\tmin-width: 140px;\n}\n#ui-dialog-body.list ul {\n\tmargin: 0;\n\tpadding: 0;\n\tlist-style: none;\n\tborder: 1px solid transparent;\n}\n#ui-dialog-body.list li {\n\tmargin: 0;\n}\n#ui-dialog-body.list li:not(:first-child) {\n\tborder-top: 1px solid #444;\n}\n#ui-dialog-body.list li a {\n\tdisplay: block;\n\tpadding: 0.25em 0.75em;\n\tborder: 1px solid transparent;\n\tcolor: #eee;\n\ttext-decoration: none;\n}\n#ui-dialog-body.list li a:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\n\n/* Saves dialog styling. */\n#ui-dialog-body.saves {\n\tpadding: 0 0 1px; /* Webkit/Blink need 1px bottom padding or they'll trigger the scroll bar */\n}\n#ui-dialog-body.saves > *:not(:first-child) {\n\tborder-top: 1px solid #444;\n}\n#ui-dialog-body.saves table {\n\tborder-spacing: 0;\n\tmin-width: 340px;\n\twidth: 100%;\n}\n#ui-dialog-body.saves tr:not(:first-child) {\n\tborder-top: 1px solid #444;\n}\n#ui-dialog-body.saves td {\n\tpadding: 0.33em 0.33em;\n}\n#ui-dialog-body.saves td:first-child {\n\tmin-width: 1.5em;\n\ttext-align: center;\n}\n#ui-dialog-body.saves td:nth-child(3) {\n\tline-height: 1.2;\n}\n#ui-dialog-body.saves td:last-child {\n\ttext-align: right;\n}\n#ui-dialog-body.saves .empty {\n\tcolor: #999;\n}\n#ui-dialog-body.saves .datestamp {\n\tfont-size: 75%;\n}\n#ui-dialog-body.saves ul.buttons li {\n\tpadding: 0.4em;\n}\n#ui-dialog-body.saves ul.buttons li:last-child {\n\t/*\n\t\tUsing `position:absolute;right:0;` here can produce poor results,\n\t\tso we use `float:right` instead.\n\t*/\n\tfloat: right;\n}\n\n/* Settings dialog styling. */\n#ui-dialog-body.settings div[id|=\"header-body\"] {\n\tmargin: 1em 0;\n}\n#ui-dialog-body.settings div[id|=\"header-body\"]:first-child {\n\tmargin-top: 0;\n}\n#ui-dialog-body.settings div[id|=\"header-body\"]:not(:first-child) {\n\tborder-top: 1px solid #444;\n\tpadding-top: 1em;\n}\n#ui-dialog-body.settings div[id|=\"header-body\"] > * {\n\tmargin: 0;\n}\n#ui-dialog-body.settings h2[id|=\"header-heading\"] {\n\tfont-size: 1.375em;\n}\n#ui-dialog-body.settings p[id|=\"header-label\"] {\n\tfont-size: 87.5%;\n}\n#ui-dialog-body.settings div[id|=\"setting-body\"] + div[id|=\"setting-body\"] {\n\tmargin: 0.5em 0;\n}\n#ui-dialog-body.settings [id|=\"setting-control\"] {\n\twhite-space: nowrap;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"] {\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n\tpadding: 0.4em;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"]:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"].enabled {\n\tbackground-color: #282;\n\tborder-color: #4a4;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"].enabled:hover {\n\tbackground-color: #4a4;\n\tborder-color: #6c6;\n}\n\n/* Share dialog styling. */\n#ui-dialog-body.share {\n\tmin-width: 140px;\n}\n\n/* Stop text selection on certain UI elements. */\n#ui-dialog-close,\n#ui-dialog-body.list a,\n#ui-dialog-body.settings span[id|=\"setting-input\"] {\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n}\n\n\n/*\n\tDefault font icon styles.\n*/\n#ui-dialog-close,\n#ui-dialog-body.saves button[id=\"saves-export\"]:before,\n#ui-dialog-body.saves button[id=\"saves-import\"]:before,\n#ui-dialog-body.saves button[id=\"saves-clear\"]:before,\n#ui-dialog-body.settings button[id|=\"setting-control\"]:after,\n#ui-dialog-body.settings button[id|=\"setting-control\"].enabled:after {\n\tfont-family: \"tme-fa-icons\";\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\ttext-transform: none;\n\tline-height: 1;\n\tspeak: none;\n}\n#ui-dialog-body.saves button[id=\"saves-export\"]:before {\n\tcontent: \"\\e829\\00a0\";\n}\n#ui-dialog-body.saves button[id=\"saves-import\"]:before {\n\tcontent: \"\\e82a\\00a0\";\n}\n#ui-dialog-body.saves button[id=\"saves-clear\"]:before {\n\tcontent: \"\\e827\\00a0\";\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"]:after {\n\tcontent: \"\\00a0\\00a0\\e830\";\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"].enabled:after {\n\tcontent: \"\\00a0\\00a0\\e831\";\n}\n</style>\n<style id=\"style-debugview\" type=\"text/css\">/***********************************************************************************************************************\n *\n * debugview.css\n *\n * Copyright © 2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\n/*\n\tPatches to the UI bar styles.\n*/\n#ui-bar-body > #debug-view-toggle:first-child {\n\tmargin-top: 1em;\n}\n#ui-bar-body > #debug-view-toggle:first-child + * {\n\tmargin-top: 1em;\n}\n\n\n/*\n\tUI bar debug view toggle button styles.\n*/\n#debug-view-toggle {\n\ttext-transform: uppercase;\n}\n#debug-view-toggle:before,\n#debug-view-toggle:after {\n\tfont-family: \"tme-fa-icons\";\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\ttext-transform: none;\n\tline-height: 1;\n\tspeak: none;\n}\n#debug-view-toggle:before {\n\tcontent: \"\\e838\\00a0\";\n}\nhtml:not(.debug-view) #debug-view-toggle {\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n\tpadding: 0.4em;\n}\nhtml:not(.debug-view) #debug-view-toggle:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\nhtml:not(.debug-view) #debug-view-toggle:after {\n\tcontent: \"\\00a0\\00a0\\e830\";\n}\nhtml.debug-view #debug-view-toggle {\n\tbackground-color: #282;\n\tborder-color: #4a4;\n}\nhtml.debug-view #debug-view-toggle:hover {\n\tbackground-color: #4a4;\n\tborder-color: #6c6;\n}\nhtml.debug-view #debug-view-toggle:after {\n\tcontent: \"\\00a0\\00a0\\e831\";\n}\n\n\n/*\n\tDefault debug view styles.\n*/\nhtml.debug-view .debug {\n\tpadding: 0.25em;\n\tbackground-color: #234; /* #541, #151 */\n}\nhtml.debug-view .debug[title] {\n\tcursor: help;\n}\nhtml.debug-view .debug.block {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n}\nhtml.debug-view .debug.invalid {\n\ttext-decoration: line-through;\n}\nhtml.debug-view .debug.hidden,\nhtml.debug-view .debug.hidden .debug {\n\tbackground-color: #555;\n}\nhtml:not(.debug-view) .debug.hidden {\n\tdisplay: none;\n}\n\nhtml.debug-view .debug[data-name][data-type]:before,\nhtml.debug-view .debug[data-name][data-type].nonvoid:after {\n\tbackground-color: rgba(0,0,0,0.25);\n\tfont-family: monospace, monospace;\n\twhite-space: pre;\n}\nhtml.debug-view .debug[data-name][data-type]:before {\n\tcontent: attr(data-name);\n}\nhtml.debug-view .debug[data-name][data-type|=\"macro\"]:before {\n\tcontent: \"<<\" attr(data-name) \">>\";\n}\nhtml.debug-view .debug[data-name][data-type|=\"macro\"].nonvoid:after {\n\tcontent: \"<</\" attr(data-name) \">>\";\n}\nhtml.debug-view .debug[data-name][data-type|=\"html\"]:before {\n\tcontent: \"<\" attr(data-name) \">\";\n}\nhtml.debug-view .debug[data-name][data-type|=\"html\"].nonvoid:after {\n\tcontent: \"</\" attr(data-name) \">\";\n}\nhtml.debug-view .debug[data-name][data-type]:not(:empty):before {\n\tmargin-right: 0.25em;\n}\nhtml.debug-view .debug[data-name][data-type].nonvoid:not(:empty):after {\n\tmargin-left: 0.25em;\n}\nhtml.debug-view .debug[data-name][data-type|=\"special\"],\nhtml.debug-view .debug[data-name][data-type|=\"special\"]:before {\n\tdisplay: block;\n}\n</style>\n</head>\n<body>\n\t<div id=\"init-screen\">\n\t\t<p id=\"init-no-js\"><noscript>Apologies! JavaScript is required. Please enable it to continue.</noscript></p>\n\t\t<p id=\"init-lacking\">Apologies! You are using an <strong>outdated</strong> browser which lacks required capabilities. Please <a href=\"http://browsehappy.com/\">upgrade your browser</a> to improve your experience.</p>\n\t\t<p id=\"init-loading\">Initializing. Please wait&hellip;<br /><progress></progress></p>\n\t</div>\n\t<div id=\"hud\"></div>\n\t<ar-scene id=\"argon-aframe\">\n\t</ar-scene>\n\t<div id=\"store-area\" hidden>{{STORY_DATA}}</div>\n\t<script id=\"script-sugarcube\" type=\"text/javascript\">\n\t/*! OldFashioned JS\n\n\tOldFashioned is based on SugarCube.  It includes code from argon.js (argonjs.io) \n\tand AFrame (aframe.io), both of which have licenses on their respective sites.  \n\t\n\targon.js is licences under an Apache2.0 license, and AFrame is licensed under an\n\tMIT license.\n \t\t\n\tOldFashioned icon created by Oliviu Stoian, downloaded from the Noun Project\n\tat https://thenounproject.com/term/whiskey-glass/58605/\n\n\tSugarCube includes code from TiddlyWiki 1.2.39, which has the following license:\n\t--------------------------------------------------------------------------------\n\tTiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)\n\n\tPublished under a BSD open source license\n\n\tCopyright (c) Osmosoft Limited 2005\n\n\tRedistribution and use in source and binary forms, with or without modification,\n\tare permitted provided that the following conditions are met:\n\n\tRedistributions of source code must retain the above copyright notice, this list\n\tof conditions and the following disclaimer.\n\n\tRedistributions in binary form must reproduce the above copyright notice, this\n\tlist of conditions and the following disclaimer in the documentation and/or\n\tother materials provided with the distribution.\n\n\tNeither the name of the Osmosoft Limited nor the names of its contributors may\n\tbe used to endorse or promote products derived from this software without\n\tspecific prior written permission.\n\n\tTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n\tANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n\tWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n\tDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n\tANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n\t(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n\tLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n\tANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n\t(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n\tSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\t--------------------------------------------------------------------------------\n\t*/\n\tif(document.documentElement.classList.contains('init-loading')){window.TWINE1=false;\nwindow.DEBUG=true;\n(function (window, document, jQuery, undefined) {\n\"use strict\";\n\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n/***********************************************************************************************************************\n *\n * lib/alert.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\nvar Alert = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * Error Functions.\n  ******************************************************************************************************************/\n\n\tfunction _alertMesg(type, where, mesg, error) {\n\t\tvar isFatal = type === 'fatal';\n\t\tvar errMesg = 'Apologies! ' + (isFatal ? 'A fatal' : 'An') + ' error has occurred.';\n\n\t\tif (isFatal) {\n\t\t\terrMesg += ' Aborting.';\n\t\t} else {\n\t\t\terrMesg += ' You may be able to continue, but some parts may not work properly.';\n\t\t}\n\n\t\tif (where != null || mesg != null) {\n\t\t\t// lazy equality for null\n\t\t\terrMesg += '\\n\\nError';\n\n\t\t\tif (where != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\terrMesg += ' [' + where + ']';\n\t\t\t}\n\n\t\t\tif (mesg != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\terrMesg += ': ' + mesg.replace(/^(?:(?:uncaught\\s+(?:exception:\\s+)?)?error:\\s+)+/i, '') + '.';\n\t\t\t} else {\n\t\t\t\terrMesg += ': unknown error.';\n\t\t\t}\n\t\t}\n\n\t\tif (error && error.stack) {\n\t\t\terrMesg += '\\n\\nStack Trace:\\n' + error.stack;\n\t\t}\n\n\t\twindow.alert(errMesg); // eslint-disable-line no-alert\n\t}\n\n\tfunction alertError(where, mesg, error) {\n\t\t_alertMesg(null, where, mesg, error);\n\t}\n\n\tfunction alertFatal(where, mesg, error) {\n\t\t_alertMesg('fatal', where, mesg, error);\n\t}\n\n\t/*******************************************************************************************************************\n  * Error Event.\n  ******************************************************************************************************************/\n\t/*\n \tSetup a global error handler for uncaught exceptions.\n */\n\t(function (origOnError) {\n\t\twindow.onerror = function (mesg, url, lineNum, colNum, error) {\n\t\t\t// Uncaught exceptions during play may be recoverable/ignorable.\n\t\t\tif (document.readyState === 'complete') {\n\t\t\t\talertError(null, mesg, error);\n\t\t\t}\n\n\t\t\t// Uncaught exceptions during startup should be fatal.\n\t\t\telse {\n\t\t\t\t\talertFatal(null, mesg, error);\n\t\t\t\t\twindow.onerror = origOnError;\n\n\t\t\t\t\tif (typeof window.onerror === 'function') {\n\t\t\t\t\t\twindow.onerror.apply(this, arguments);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t};\n\t})(window.onerror);\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\terror: { value: alertError },\n\t\tfatal: { value: alertFatal }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * lib/extensions.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Wikifier */\n/* eslint-disable no-extend-native */\n\n/*\n\tReturns `document.activeElement` or `null`.\n*/\nfunction safeActiveElement() {\n\t'use strict';\n\n\t/*\n \tIE9 contains a bug where trying to access the active element of an iframe's\n \tparent document (i.e. `window.parent.document.activeElement`) will throw an\n \texception, so we must allow for an exception to be thrown.\n \t\tWe could simply return `undefined` here, but since the API's default behavior\n \tshould be to return `document.body` or `null` when there is no selection, we\n \tchoose to return `null` in all non-element cases (i.e. whether it returns\n \t`null` or throws an exception).  Just a bit of normalization.\n */\n\n\ttry {\n\t\treturn document.activeElement || null;\n\t} catch (e) {\n\t\treturn null;\n\t}\n}\n\n/*\n\tJavaScript Polyfills.\n\n\tn.b. Most of the ES5 & ES6 polyfills now come from the `es5-shim.js` and `es6-shim.js`\n\t     libraries, respectively.\n*/\n(function () {\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * JavaScript Polyfills.\n  ******************************************************************************************************************/\n\t/*\n \t[ES7/Proposed] Returns whether the given element was found within the array.\n */\n\n\tif (!Array.prototype.includes) {\n\t\tObject.defineProperty(Array.prototype, 'includes', {\n\t\t\tconfigurable: true,\n\t\t\twritable: true,\n\n\t\t\tvalue: function value() /* needle [, fromIndex] */{\n\t\t\t\tif (this == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tthrow new TypeError('Array.prototype.includes called on null or undefined');\n\t\t\t\t}\n\n\t\t\t\tif (arguments.length === 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar length = this.length >>> 0;\n\n\t\t\t\tif (length === 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar needle = arguments[0];\n\t\t\t\tvar i = Number(arguments[1]) || 0;\n\n\t\t\t\tif (i < 0) {\n\t\t\t\t\ti = Math.max(0, length + i);\n\t\t\t\t}\n\n\t\t\t\tfor (; /* empty */i < length; ++i) {\n\t\t\t\t\tvar current = this[i];\n\n\t\t\t\t\tif (needle === current || needle !== needle && current !== current // eslint-disable-line no-extra-parens\n\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n \t[ES7/Proposed] Returns a string with all whitespace removed from the start/left-side of the string.\n */\n\tif (!String.prototype.trimLeft) {\n\t\tObject.defineProperty(String.prototype, 'trimLeft', {\n\t\t\tconfigurable: true,\n\t\t\twritable: true,\n\n\t\t\tvalue: function value() {\n\t\t\t\tif (this == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tthrow new TypeError('String.prototype.trimLeft called on null or undefined');\n\t\t\t\t}\n\n\t\t\t\treturn this.replace(/^[\\s\\uFEFF\\u00A0]+/, ''); // include UTF BOM and NBSP\n\t\t\t}\n\t\t});\n\t}\n\tif (!String.prototype.trimStart) {\n\t\tObject.defineProperty(String.prototype, 'trimStart', {\n\t\t\tconfigurable: true,\n\t\t\twritable: true,\n\n\t\t\tvalue: function value() {\n\t\t\t\tif (this == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tthrow new TypeError('String.prototype.trimStart called on null or undefined');\n\t\t\t\t}\n\n\t\t\t\treturn this.trimLeft();\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n \t[ES7/Proposed] Returns a string with all whitespace removed from the end/right-side of the string.\n */\n\tif (!String.prototype.trimRight) {\n\t\tObject.defineProperty(String.prototype, 'trimRight', {\n\t\t\tconfigurable: true,\n\t\t\twritable: true,\n\n\t\t\tvalue: function value() {\n\t\t\t\tif (this == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tthrow new TypeError('String.prototype.trimRight called on null or undefined');\n\t\t\t\t}\n\n\t\t\t\treturn this.replace(/[\\s\\uFEFF\\u00A0]+$/, ''); // include UTF BOM and NBSP\n\t\t\t}\n\t\t});\n\t}\n\tif (!String.prototype.trimEnd) {\n\t\tObject.defineProperty(String.prototype, 'trimEnd', {\n\t\t\tconfigurable: true,\n\t\t\twritable: true,\n\n\t\t\tvalue: function value() {\n\t\t\t\tif (this == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tthrow new TypeError('String.prototype.trimEnd called on null or undefined');\n\t\t\t\t}\n\n\t\t\t\treturn this.trimRight();\n\t\t\t}\n\t\t});\n\t}\n})();\n\n/*\n\tJavaScript Extensions.\n*/\n(function () {\n\t'use strict';\n\n\tvar _nativeMathRandom = Math.random;\n\n\t/*******************************************************************************************************************\n  * Utility Functions.\n  ******************************************************************************************************************/\n\t/*\n \tReturns a pseudo-random whole number (integer) within the range of the given bounds.\n */\n\tfunction _random() /* variadic(min:inclusive, max:inclusive) */{\n\t\tif (arguments.length === 0) {\n\t\t\tthrow new Error('_random called with insufficient parameters');\n\t\t}\n\n\t\tvar min = void 0,\n\t\t    max = void 0;\n\n\t\tif (arguments.length === 1) {\n\t\t\tmin = 0;\n\t\t\tmax = arguments[0];\n\t\t} else {\n\t\t\tmin = arguments[0];\n\t\t\tmax = arguments[1];\n\t\t}\n\n\t\tif (min > max) {\n\t\t\tvar _ref = [max, min];\n\t\t\tmin = _ref[0];\n\t\t\tmax = _ref[1];\n\t\t}\n\n\t\treturn Math.floor(_nativeMathRandom() * (max - min + 1)) + min;\n\t}\n\n\t/*******************************************************************************************************************\n  * JavaScript Extensions, General.\n  ******************************************************************************************************************/\n\t/*\n \tReturns a random element from the given array, within the range of the lower and upper\n \tbounds, if they are specified.\n */\n\tObject.defineProperty(Array, 'random', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(array, lowerBound, upperBound) {\n\t\t\tvar lower = lowerBound,\n\t\t\t    upper = upperBound;\n\n\t\t\tif (arguments.length === 2) {\n\t\t\t\tupper = lower;\n\t\t\t\tlower = 0;\n\t\t\t}\n\n\t\t\tif (Array.isArray(array)) {\n\t\t\t\treturn array.random(lower, upper);\n\t\t\t} else if (array.hasOwnProperty('length')) {\n\t\t\t\treturn [].concat(_toConsumableArray(array)).random(lower, upper);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t});\n\n\t/*\n \tReturns whether the given element was found within the array.\n */\n\tObject.defineProperty(Array.prototype, 'contains', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* needle [, fromIndex] */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.contains called on null or undefined');\n\t\t\t}\n\n\t\t\treturn Array.prototype.indexOf.apply(this, arguments) !== -1;\n\t\t}\n\t});\n\n\t/*\n \tReturns whether all of the given elements were found within the array.\n */\n\tObject.defineProperty(Array.prototype, 'containsAll', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* needles */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.containsAll called on null or undefined');\n\t\t\t}\n\n\t\t\tif (arguments.length === 1) {\n\t\t\t\tif (Array.isArray(arguments[0])) {\n\t\t\t\t\treturn Array.prototype.containsAll.apply(this, arguments[0]);\n\t\t\t\t} else {\n\t\t\t\t\treturn Array.prototype.indexOf.apply(this, arguments) !== -1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (var i = 0, iend = arguments.length; i < iend; ++i) {\n\t\t\t\t\tif (!Array.prototype.some.call(this, function (v) {\n\t\t\t\t\t\treturn v === this.val;\n\t\t\t\t\t}, { val: arguments[i] })) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \tReturns whether any of the given elements were found within the array.\n */\n\tObject.defineProperty(Array.prototype, 'containsAny', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* needles */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.containsAny called on null or undefined');\n\t\t\t}\n\n\t\t\tif (arguments.length === 1) {\n\t\t\t\tif (Array.isArray(arguments[0])) {\n\t\t\t\t\treturn Array.prototype.containsAny.apply(this, arguments[0]);\n\t\t\t\t} else {\n\t\t\t\t\treturn Array.prototype.indexOf.apply(this, arguments) !== -1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (var i = 0, iend = arguments.length; i < iend; ++i) {\n\t\t\t\t\tif (Array.prototype.some.call(this, function (v) {\n\t\t\t\t\t\treturn v === this.val;\n\t\t\t\t\t}, { val: arguments[i] })) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \tReturns the number of times the given element was found within the array.\n */\n\tObject.defineProperty(Array.prototype, 'count', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* needle [, fromIndex ] */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.count called on null or undefined');\n\t\t\t}\n\n\t\t\tvar indexOf = Array.prototype.indexOf,\n\t\t\t    needle = arguments[0];\n\t\t\tvar pos = Number(arguments[1]) || 0,\n\t\t\t    count = 0;\n\n\t\t\twhile ((pos = indexOf.call(this, needle, pos)) !== -1) {\n\t\t\t\t++count;\n\t\t\t\t++pos;\n\t\t\t}\n\n\t\t\treturn count;\n\t\t}\n\t});\n\n\t/*\n \tRemoves and returns all of the given elements from the array.\n */\n\tObject.defineProperty(Array.prototype, 'delete', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* needles */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.delete called on null or undefined');\n\t\t\t}\n\n\t\t\tif (arguments.length === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tvar length = this.length >>> 0;\n\n\t\t\tif (length === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tvar indexOf = Array.prototype.indexOf,\n\t\t\t    push = Array.prototype.push,\n\t\t\t    splice = Array.prototype.splice,\n\t\t\t    needles = Array.prototype.concat.apply([], arguments),\n\t\t\t    result = [];\n\n\t\t\tfor (var i = 0, iend = needles.length; i < iend; ++i) {\n\t\t\t\tvar needle = needles[i];\n\t\t\t\tvar pos = 0;\n\n\t\t\t\twhile ((pos = indexOf.call(this, needle, pos)) !== -1) {\n\t\t\t\t\tpush.apply(result, splice.call(this, pos, 1));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t});\n\n\t/*\n \tRemoves and returns all of the elements at the given indices from the array.\n */\n\tObject.defineProperty(Array.prototype, 'deleteAt', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* indices */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.deleteAt called on null or undefined');\n\t\t\t}\n\n\t\t\tif (arguments.length === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tvar length = this.length >>> 0;\n\n\t\t\tif (length === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tvar splice = Array.prototype.splice,\n\t\t\t    cpyIndices = [].concat(_toConsumableArray(new Set(Array.prototype.concat.apply([], arguments)\n\t\t\t// Map negative indices to their positive counterparts,\n\t\t\t// so the Set can properly filter out duplicates.\n\t\t\t.map(function (x) {\n\t\t\t\treturn x < 0 ? Math.max(0, length + x) : x;\n\t\t\t})).values())),\n\t\t\t    delIndices = [].concat(_toConsumableArray(cpyIndices)).sort(function (a, b) {\n\t\t\t\treturn b - a;\n\t\t\t}),\n\t\t\t    result = [];\n\n\t\t\t// Copy the elements (in original indices order).\n\t\t\tfor (var i = 0, iend = cpyIndices.length; i < iend; ++i) {\n\t\t\t\tresult[i] = this[cpyIndices[i]];\n\t\t\t}\n\n\t\t\t// Delete the elements (in descending numeric order).\n\t\t\tfor (var _i = 0, _iend = delIndices.length; _i < _iend; ++_i) {\n\t\t\t\tsplice.call(this, delIndices[_i], 1);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t});\n\n\t/*\n \tReturns a new array consisting of the flattened source array (flat map reduce).\n */\n\tObject.defineProperty(Array.prototype, 'flatten', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() {\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.flatten called on null or undefined');\n\t\t\t}\n\n\t\t\treturn Array.prototype.reduce.call(this, function (prev, cur) {\n\t\t\t\treturn prev.concat(Array.isArray(cur) ? cur.flatten() : cur);\n\t\t\t}, []);\n\t\t}\n\t});\n\n\t/*\n \tRemoves and returns a random element from the array, within the range of the lower and\n \tupper bounds, if they are specified.\n */\n\tObject.defineProperty(Array.prototype, 'pluck', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(lowerBound, upperBound) {\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.pluck called on null or undefined');\n\t\t\t}\n\n\t\t\tvar length = this.length >>> 0;\n\n\t\t\tif (length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar lower = lowerBound,\n\t\t\t    upper = upperBound;\n\n\t\t\tif (arguments.length === 1) {\n\t\t\t\tupper = lower;\n\t\t\t\tlower = 0;\n\t\t\t}\n\n\t\t\tif (lower == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tlower = 0;\n\t\t\t} else if (lower < 0) {\n\t\t\t\tlower = length + lower;\n\n\t\t\t\tif (lower < 0) {\n\t\t\t\t\tlower = 0;\n\t\t\t\t}\n\t\t\t} else if (lower >= length) {\n\t\t\t\tlower = length - 1;\n\t\t\t}\n\n\t\t\tif (upper == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tupper = length - 1;\n\t\t\t} else if (upper < 0) {\n\t\t\t\tupper = length + upper;\n\n\t\t\t\tif (upper < 0) {\n\t\t\t\t\tupper = length - 1;\n\t\t\t\t}\n\t\t\t} else if (upper >= length) {\n\t\t\t\tupper = length - 1;\n\t\t\t}\n\n\t\t\treturn Array.prototype.splice.call(this, _random(lower, upper), 1)[0];\n\t\t}\n\t});\n\n\t/*\n \tReturns a random element from the array, within the range of the lower and upper bounds,\n \tif they are specified.\n */\n\tObject.defineProperty(Array.prototype, 'random', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(lowerBound, upperBound) {\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.random called on null or undefined');\n\t\t\t}\n\n\t\t\tvar length = this.length >>> 0;\n\n\t\t\tif (length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar lower = lowerBound,\n\t\t\t    upper = upperBound;\n\n\t\t\tif (arguments.length === 1) {\n\t\t\t\tupper = lower;\n\t\t\t\tlower = 0;\n\t\t\t}\n\n\t\t\tif (lower == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tlower = 0;\n\t\t\t} else if (lower < 0) {\n\t\t\t\tlower = length + lower;\n\n\t\t\t\tif (lower < 0) {\n\t\t\t\t\tlower = 0;\n\t\t\t\t}\n\t\t\t} else if (lower >= length) {\n\t\t\t\tlower = length - 1;\n\t\t\t}\n\n\t\t\tif (upper == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tupper = length - 1;\n\t\t\t} else if (upper < 0) {\n\t\t\t\tupper = length + upper;\n\n\t\t\t\tif (upper < 0) {\n\t\t\t\t\tupper = length - 1;\n\t\t\t\t}\n\t\t\t} else if (upper >= length) {\n\t\t\t\tupper = length - 1;\n\t\t\t}\n\n\t\t\treturn this[_random(lower, upper)];\n\t\t}\n\t});\n\n\t/*\n \tRandomly shuffles the array.\n */\n\tObject.defineProperty(Array.prototype, 'shuffle', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() {\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Array.prototype.shuffle called on null or undefined');\n\t\t\t}\n\n\t\t\tvar length = this.length >>> 0;\n\n\t\t\tif (length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (var i = length - 1; i > 0; --i) {\n\t\t\t\tvar j = Math.floor(_nativeMathRandom() * (i + 1)),\n\t\t\t\t    swap = this[i];\n\t\t\t\tthis[i] = this[j];\n\t\t\t\tthis[j] = swap;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t});\n\n\t/*\n \tReturns a bound function that supplies the given arguments to the base function, followed\n \tby the arguments are supplied to the bound function, whenever it is called.\n */\n\tObject.defineProperty(Function.prototype, 'partial', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* variadic */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Function.prototype.partial called on null or undefined');\n\t\t\t}\n\n\t\t\tvar slice = Array.prototype.slice,\n\t\t\t    fn = this,\n\t\t\t    bound = slice.call(arguments, 0);\n\n\t\t\treturn function () {\n\t\t\t\tvar applied = [];\n\t\t\t\tvar argc = 0;\n\n\t\t\t\tfor (var i = 0; i < bound.length; ++i) {\n\t\t\t\t\tapplied.push(bound[i] === undefined ? arguments[argc++] : bound[i]);\n\t\t\t\t}\n\n\t\t\t\treturn fn.apply(this, applied.concat(slice.call(arguments, argc)));\n\t\t\t};\n\t\t}\n\t});\n\n\t/*\n \tReturns the given numerical clamped to the specified bounds.\n */\n\tObject.defineProperty(Math, 'clamp', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(num, min, max) {\n\t\t\tvar n = Number(num);\n\t\t\treturn isNaN(n) ? NaN : n.clamp(min, max);\n\t\t}\n\t});\n\n\t/*\n \tReturns a decimal number eased from 0 to 1.\n \t\tn.b. The magnitude of the returned value decreases if num < 0.5 or increases if num > 0.5.\n */\n\tObject.defineProperty(Math, 'easeInOut', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(num) {\n\t\t\treturn 1 - (Math.cos(Number(num) * Math.PI) + 1) / 2;\n\t\t}\n\t});\n\n\t/*\n \tReturns the number clamped to the specified bounds.\n */\n\tObject.defineProperty(Number.prototype, 'clamp', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* min, max */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('Number.prototype.clamp called on null or undefined');\n\t\t\t}\n\n\t\t\tif (arguments.length !== 2) {\n\t\t\t\tthrow new Error('Number.prototype.clamp called with an incorrect number of parameters');\n\t\t\t}\n\n\t\t\tvar min = Number(arguments[0]),\n\t\t\t    max = Number(arguments[1]);\n\n\t\t\tif (min > max) {\n\t\t\t\tvar _ref2 = [max, min];\n\t\t\t\tmin = _ref2[0];\n\t\t\t\tmax = _ref2[1];\n\t\t\t}\n\n\t\t\treturn Math.min(Math.max(this, min), max);\n\t\t}\n\t});\n\n\t/*\n \tReturns a copy of the given string with all RegExp metacharacters escaped.\n */\n\tif (!RegExp.escape) {\n\t\t(function () {\n\t\t\tvar _regExpMetaCharsRe = /[\\\\^$*+?.()|[\\]{}]/g,\n\t\t\t    _hasRegExpMetaCharsRe = new RegExp(_regExpMetaCharsRe.source); // to drop the global flag\n\n\t\t\tObject.defineProperty(RegExp, 'escape', {\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true,\n\n\t\t\t\tvalue: function value(str) {\n\t\t\t\t\tvar s = String(str);\n\t\t\t\t\treturn s && _hasRegExpMetaCharsRe.test(s) ? s.replace(_regExpMetaCharsRe, '\\\\$&') : s;\n\t\t\t\t}\n\t\t\t});\n\t\t})();\n\t}\n\n\t/*\n \tReturns a formatted string, after replacing each format item in the given format string\n \twith the text equivalent of the corresponding argument's value.\n */\n\tObject.defineProperty(String, 'format', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(format) {\n\t\t\tfunction padString(str, align, pad) {\n\t\t\t\tif (!align) {\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\n\t\t\t\tvar plen = Math.abs(align) - str.length;\n\n\t\t\t\tif (plen < 1) {\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\n\t\t\t\tvar padding = Array(plen + 1).join(pad);\n\t\t\t\treturn align < 0 ? str + padding : padding + str;\n\t\t\t}\n\n\t\t\tif (arguments.length < 2) {\n\t\t\t\treturn arguments.length === 0 ? '' : format;\n\t\t\t}\n\n\t\t\tvar args = arguments.length === 2 && Array.isArray(arguments[1]) ? arguments[1].slice(0) : Array.prototype.slice.call(arguments, 1);\n\n\t\t\tif (args.length === 0) {\n\t\t\t\treturn format;\n\t\t\t}\n\n\t\t\treturn format.replace(/{(\\d+)(?:,([+-]?\\d+))?}/g, function (match, index, align) {\n\t\t\t\tvar retval = args[index];\n\n\t\t\t\tif (retval == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\twhile (typeof retval === 'function') {\n\t\t\t\t\tretval = retval();\n\t\t\t\t}\n\n\t\t\t\tswitch (typeof retval === 'undefined' ? 'undefined' : _typeof(retval)) {\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\t/* nothing */\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'object':\n\t\t\t\t\t\tretval = JSON.stringify(retval);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tretval = String(retval);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn padString(retval, !align ? 0 : parseInt(align, 10), ' ');\n\t\t\t});\n\t\t}\n\t});\n\n\t/*\n \tReturns whether the given string was found within the string.\n */\n\tObject.defineProperty(String.prototype, 'contains', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* needle [, fromIndex] */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('String.prototype.contains called on null or undefined');\n\t\t\t}\n\n\t\t\treturn String.prototype.indexOf.apply(this, arguments) !== -1;\n\t\t}\n\t});\n\n\t/*\n \tReturns the number of times the given substring was found within the string.\n */\n\tObject.defineProperty(String.prototype, 'count', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* needle [, fromIndex ] */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('String.prototype.count called on null or undefined');\n\t\t\t}\n\n\t\t\tvar needle = String(arguments[0] || '');\n\n\t\t\tif (needle === '') {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tvar indexOf = String.prototype.indexOf,\n\t\t\t    step = needle.length;\n\t\t\tvar pos = Number(arguments[1]) || 0,\n\t\t\t    count = 0;\n\n\t\t\twhile ((pos = indexOf.call(this, needle, pos)) !== -1) {\n\t\t\t\t++count;\n\t\t\t\tpos += step;\n\t\t\t}\n\t\t\treturn count;\n\t\t}\n\t});\n\n\t/*\n \tReturns a copy of the base string with `count` characters replaced with `replacement`, starting at `startAt`.\n */\n\tObject.defineProperty(String.prototype, 'splice', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(startAt, charCount, replacement) {\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('String.prototype.splice called on null or undefined');\n\t\t\t}\n\n\t\t\tvar length = this.length >>> 0;\n\n\t\t\tif (length === 0) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tvar start = +startAt || 0;\n\n\t\t\tif (!isFinite(start)) {\n\t\t\t\tstart = 0;\n\t\t\t} else if (start < 0) {\n\t\t\t\tstart += length;\n\n\t\t\t\tif (start < 0) {\n\t\t\t\t\tstart = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (start > length) {\n\t\t\t\tstart = length;\n\t\t\t}\n\n\t\t\tvar count = +charCount || 0;\n\n\t\t\tif (!isFinite(count) || count < 0) {\n\t\t\t\tcount = 0;\n\t\t\t}\n\n\t\t\tvar res = this.slice(0, start);\n\n\t\t\tif (typeof replacement !== 'undefined') {\n\t\t\t\tres += replacement;\n\t\t\t}\n\n\t\t\tif (start + count < length) {\n\t\t\t\tres += this.slice(start + count);\n\t\t\t}\n\n\t\t\treturn res;\n\t\t}\n\t});\n\n\t/*\n \tReturns an array of strings, split from the string, or an empty array if the string is empty.\n */\n\tObject.defineProperty(String.prototype, 'splitOrEmpty', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() /* [ separator [, limit ]] */{\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('String.prototype.splitOrEmpty called on null or undefined');\n\t\t\t}\n\n\t\t\t// Required as `this` could be a `String` object or come from a `call()` or `apply()`.\n\t\t\tif (String(this) === '') {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn String.prototype.split.apply(this, arguments);\n\t\t}\n\t});\n\n\t/*\n \t[DEPRECATED] Returns an array of link titles, parsed from the string.\n \t\tn.b. Unused in SugarCube, only included for compatibility.\n */\n\tObject.defineProperty(String.prototype, 'readBracketedList', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() {\n\t\t\tif (this == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('String.prototype.readBracketedList called on null or undefined');\n\t\t\t}\n\n\t\t\t// RegExp groups: Double-square-bracket quoted | Unquoted.\n\t\t\tvar re = new RegExp('(?:\\\\[\\\\[((?:\\\\s|\\\\S)*?)\\\\]\\\\])|([^\"\\'\\\\s]\\\\S*)', 'gm'),\n\t\t\t    names = [];\n\t\t\tvar match = void 0;\n\n\t\t\twhile ((match = re.exec(this)) !== null) {\n\t\t\t\tif (match[1]) {\n\t\t\t\t\t// double-square-bracket quoted\n\t\t\t\t\tnames.push(match[1]);\n\t\t\t\t} else if (match[2]) {\n\t\t\t\t\t// unquoted\n\t\t\t\t\tnames.push(match[2]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn names;\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * JavaScript Extensions, JSON.\n  ******************************************************************************************************************/\n\t/*\n \tDefine `toJSON()` methods on each prototype we wish to support.\n */\n\tObject.defineProperty(Date.prototype, 'toJSON', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() {\n\t\t\treturn ['(revive:date)', this.toISOString()];\n\t\t}\n\t});\n\tObject.defineProperty(Function.prototype, 'toJSON', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() {\n\t\t\t/*\n   \tThe enclosing parenthesis here are necessary to force the function expression code\n   \tstring, returned by `this.toString()`, to be evaluated as an expression during\n   \trevival.  Without them, the function expression, which is likely nameless, will be\n   \tevaluated as a function definition—which will throw a syntax error exception, since\n   \tfunction definitions must have a name.\n   */\n\t\t\treturn ['(revive:eval)', '(' + this.toString() + ')'];\n\t\t}\n\t});\n\tObject.defineProperty(Map.prototype, 'toJSON', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() {\n\t\t\treturn ['(revive:map)', [].concat(_toConsumableArray(this))];\n\t\t}\n\t});\n\tObject.defineProperty(RegExp.prototype, 'toJSON', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() {\n\t\t\treturn ['(revive:eval)', this.toString()];\n\t\t}\n\t});\n\tObject.defineProperty(Set.prototype, 'toJSON', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value() {\n\t\t\treturn ['(revive:set)', [].concat(_toConsumableArray(this))];\n\t\t}\n\t});\n\n\t/*\n \tUtility method to allow users to easily wrap their code in the revive wrapper.\n */\n\tObject.defineProperty(JSON, 'reviveWrapper', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(code) {\n\t\t\tif (typeof code !== 'string') {\n\t\t\t\tthrow new TypeError('JSON.reviveWrapper code parameter must be a string');\n\t\t\t}\n\n\t\t\treturn ['(revive:eval)', code];\n\t\t}\n\t});\n\n\t/*\n \tBackup the original `JSON.parse()` and replace it with a revive wrapper aware version.\n */\n\tObject.defineProperty(JSON, '_real_parse', {\n\t\tvalue: JSON.parse\n\t});\n\tObject.defineProperty(JSON, 'parse', {\n\t\tconfigurable: true,\n\t\twritable: true,\n\n\t\tvalue: function value(text, reviver) {\n\t\t\treturn JSON._real_parse(text, function (key, val) {\n\t\t\t\tvar value = val;\n\n\t\t\t\t/*\n    \tAttempt to revive wrapped values.\n    */\n\t\t\t\tif (Array.isArray(value) && value.length === 2) {\n\t\t\t\t\tswitch (value[0]) {\n\t\t\t\t\t\tcase '(revive:set)':\n\t\t\t\t\t\t\tvalue = new Set(value[1]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '(revive:map)':\n\t\t\t\t\t\t\tvalue = new Map(value[1]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '(revive:date)':\n\t\t\t\t\t\t\tvalue = new Date(value[1]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '(revive:eval)':\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tvalue = eval(value[1]); // eslint-disable-line no-eval\n\t\t\t\t\t\t\t} catch (e) {/* no-op; although, perhaps, it would be better to throw an error here */}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* legacy */\n\t\t\t\telse if (typeof value === 'string' && value.slice(0, 10) === '@@revive@@') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvalue = eval(value.slice(10)); // eslint-disable-line no-eval\n\t\t\t\t\t\t} catch (e) {/* no-op; although, perhaps, it would be better to throw an error here */}\n\t\t\t\t\t}\n\t\t\t\t/* /legacy */\n\n\t\t\t\t/*\n    \tCall the custom reviver, if specified.\n    */\n\t\t\t\tif (typeof reviver === 'function') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = reviver(key, value);\n\t\t\t\t\t} catch (e) {/* no-op; although, perhaps, it would be better to throw an error here */}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t});\n\t\t}\n\t});\n})();\n\n/***********************************************************************************************************************\n * jQuery Plugins.\n **********************************************************************************************************************/\n/*\n\t`ariaClick([options,] handler)` method plugin.\n\n\tMakes the target element(s) WAI-ARIA compatible clickables.\n\n\tn.b. Has a dependency in the `safeActiveElement()` function (see: top of file).\n*/\n(function () {\n\t'use strict';\n\n\t/*\n \tEvent handler & utility functions.\n \t\tn.b. Do not replace the anonymous functions herein with arrow functions.\n */\n\n\tfunction onKeypressFn(evt) {\n\t\t// 13 is Enter/Return, 32 is Space.\n\t\tif (evt.which === 13 || evt.which === 32) {\n\t\t\tevt.preventDefault();\n\n\t\t\t// To allow delegation, attempt to trigger the event on `document.activeElement`,\n\t\t\t// if possible, elsewise on `this`.\n\t\t\tjQuery(safeActiveElement() || this).trigger('click');\n\t\t}\n\t}\n\n\tfunction onClickFnWrapper(fn) {\n\t\treturn function () {\n\t\t\tvar $this = jQuery(this);\n\n\t\t\t// Toggle \"aria-pressed\" status, if the attribute exists.\n\t\t\tif ($this.is('[aria-pressed]')) {\n\t\t\t\t$this.attr('aria-pressed', $this.attr('aria-pressed') === 'true' ? 'false' : 'true');\n\t\t\t}\n\n\t\t\t// Call the true handler.\n\t\t\tfn.apply(this, arguments);\n\t\t};\n\t}\n\n\tfunction oneClickFnWrapper(fn) {\n\t\treturn onClickFnWrapper(function () {\n\t\t\t// Remove both event handlers (keypress & click) and the other components.\n\t\t\tjQuery(this).off('.aria-clickable').removeAttr('tabindex aria-controls aria-pressed').not('a,button').removeAttr('role').end().filter('button').prop('disabled', true);\n\n\t\t\t// Call the true handler.\n\t\t\tfn.apply(this, arguments);\n\t\t});\n\t}\n\n\t/*\n \tExtend jQuery's chainable methods with an `ariaClick()` method.\n */\n\tjQuery.fn.extend({\n\t\tariaClick: function ariaClick(options, handler) {\n\t\t\t// Bail out if there are no target element(s) or parameters.\n\t\t\tif (this.length === 0 || arguments.length === 0) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tvar opts = options,\n\t\t\t    fn = handler;\n\n\t\t\tif (fn == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tfn = opts;\n\t\t\t\topts = undefined;\n\t\t\t}\n\n\t\t\topts = jQuery.extend({\n\t\t\t\tnamespace: undefined,\n\t\t\t\tone: false,\n\t\t\t\tselector: undefined,\n\t\t\t\tdata: undefined,\n\t\t\t\tcontrols: undefined,\n\t\t\t\tpressed: undefined,\n\t\t\t\tlabel: undefined\n\t\t\t}, opts);\n\n\t\t\tif (typeof opts.namespace !== 'string') {\n\t\t\t\topts.namespace = '';\n\t\t\t} else if (opts.namespace[0] !== '.') {\n\t\t\t\topts.namespace = '.' + opts.namespace;\n\t\t\t}\n\n\t\t\tif (typeof opts.pressed === 'boolean') {\n\t\t\t\topts.pressed = opts.pressed ? 'true' : 'false';\n\t\t\t}\n\n\t\t\t// Set `type` to `button` to suppress \"submit\" semantics, for <button> elements.\n\t\t\tthis.filter('button').prop('type', 'button');\n\n\t\t\t// Set `role` to `button`, for non-<a>/-<button> elements.\n\t\t\tthis.not('a,button').attr('role', 'button');\n\n\t\t\t// Set `tabindex` to `0` to make them focusable (unnecessary on <button> elements, but it doesn't hurt).\n\t\t\tthis.attr('tabindex', 0);\n\n\t\t\t// Set `aria-controls`.\n\t\t\tif (opts.controls != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthis.attr('aria-controls', opts.controls);\n\t\t\t}\n\n\t\t\t// Set `aria-pressed`.\n\t\t\tif (opts.pressed != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthis.attr('aria-pressed', opts.pressed);\n\t\t\t}\n\n\t\t\t// Set `aria-label` and `title`.\n\t\t\tif (opts.label != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthis.attr({\n\t\t\t\t\t'aria-label': opts.label,\n\t\t\t\t\ttitle: opts.label\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Set the keypress handlers, for non-<button> elements.\n\t\t\t//   n.b. For the single-use case, the click handler will also remove this handler.\n\t\t\tthis.not('button').on('keypress.aria-clickable' + opts.namespace, opts.selector, onKeypressFn);\n\n\t\t\t// Set the click handlers.\n\t\t\t//   n.b. To ensure both handlers are properly removed, `one()` must not be used here.\n\t\t\tthis.on('click.aria-clickable' + opts.namespace, opts.selector, opts.data, opts.one ? oneClickFnWrapper(fn) : onClickFnWrapper(fn));\n\n\t\t\t// Return `this` for further chaining.\n\t\t\treturn this;\n\t\t}\n\t});\n})();\n\n/*\n\t`wiki(source)` method plugin.\n\n\tWikifies the source text and appends the result to the target element(s).\n*/\n(function () {\n\t'use strict';\n\n\t/*\n \tExtend jQuery's chainable methods with a `wiki()` method.\n */\n\n\tjQuery.fn.extend({\n\t\twiki: function wiki(source) {\n\t\t\t// Bail out if there are no target element(s) or parameters.\n\t\t\tif (this.length === 0 || arguments.length === 0) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// Wikify the source text into a fragment and append it to the target element(s).\n\t\t\tvar frag = document.createDocumentFragment();\n\t\t\tnew Wikifier(frag, source);\n\t\t\tthis.append(frag);\n\n\t\t\t// Return `this` for further chaining.\n\t\t\treturn this;\n\t\t}\n\t});\n})();\n\n/***********************************************************************************************************************\n *\n * lib/browser.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\nvar Browser = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\t/* eslint-disable max-len */\n\n\tvar ua = {\n\t\tuserAgent: navigator.userAgent.toLowerCase()\n\t};\n\n\tua.isGecko = navigator && navigator.product === 'Gecko' && !/webkit|trident/.test(ua.userAgent);\n\n\tua.isIE = /msie|trident/.test(ua.userAgent) && !ua.userAgent.includes('opera');\n\tua.ieVersion = function () {\n\t\tvar ver = /(?:msie\\s+|rv:)(\\d{1,2}\\.\\d)/.exec(ua.userAgent);\n\t\treturn ver ? +ver[1] : 0;\n\t}();\n\n\t// opera <= 12: \"opera/9.80 (windows nt 6.1; wow64) presto/2.12.388 version/12.16\"\n\t// opera >= 15: \"mozilla/5.0 (windows nt 6.1; wow64) applewebkit/537.36 (khtml, like gecko) chrome/28.0.1500.52 safari/537.36 opr/15.0.1147.130\"\n\tua.isOpera = ua.userAgent.includes('opera') || ua.userAgent.includes(' opr/');\n\tua.operaVersion = function () {\n\t\tvar re = new RegExp((/applewebkit|chrome/.test(ua.userAgent) ? 'opr' : 'version') + '\\\\/(\\\\d{1,2}\\\\.\\\\d+)'),\n\t\t    ver = re.exec(ua.userAgent);\n\t\treturn ver ? +ver[1] : 0;\n\t}();\n\n\tua.isMobile = Object.freeze({\n\t\tAndroid: /android/.test(ua.userAgent),\n\t\tBlackBerry: /blackberry/.test(ua.userAgent),\n\t\tiOS: /ip(?:hone|ad|od)/.test(ua.userAgent),\n\t\tWindows: /iemobile/.test(ua.userAgent),\n\n\t\tany: function any() {\n\t\t\tvar m = ua.isMobile;\n\t\t\treturn m.Android || m.BlackBerry || m.iOS || m.Windows;\n\t\t}\n\t});\n\n\t// Module Exports.\n\treturn Object.freeze(ua);\n\t/* eslint-enable max-len */\n}();\n\n/***********************************************************************************************************************\n *\n * lib/has.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Browser */\n\nvar Has = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tfunction webStorageIsOK(store) {\n\t\ttry {\n\t\t\tif (store != null && store.length >= 0) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tvar tkey = 'SugarCube.WebStorage.test',\n\t\t\t\t    tval = '1701 Guilty Scott';\n\n\t\t\t\tstore.setItem(tkey, tval);\n\n\t\t\t\tif (store.getItem(tkey) === tval) {\n\t\t\t\t\tstore.removeItem(tkey);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {/* no-op */}\n\n\t\treturn false;\n\t}\n\n\t// Module Exports.\n\treturn Object.freeze({\n\t\taudio: typeof document.createElement('audio').canPlayType === 'function',\n\n\t\t/*\n  \tIt's probably safe to assume the existence of `Blob` by the existence of `File`.\n  */\n\t\tfileAPI: 'File' in window && 'FileList' in window && 'FileReader' in window && !Browser.isMobile.any() && (!Browser.isOpera || Browser.operaVersion >= 15),\n\n\t\tgeolocation: 'geolocation' in navigator && typeof navigator.geolocation.getCurrentPosition === 'function' && typeof navigator.geolocation.watchPosition === 'function',\n\n\t\t/*\n  \tThe extended Web Storage testing (`webStorageIsOK()`) is required by implementation\n  \tbugs in various browsers.\n  \t\tCaveats by browser:\n  \t\tFirefox bug #748620 [https://bugzilla.mozilla.org/show_bug.cgi?id=748620].\n  \t\t\tThe iOS browser core will throw an exception on `setItem()` calls when in\n  \t\tprivate browsing mode.\n  */\n\t\tlocalStorage: 'localStorage' in window && webStorageIsOK(window.localStorage),\n\t\tsessionStorage: 'sessionStorage' in window && webStorageIsOK(window.sessionStorage)\n\t});\n}();\n\n/***********************************************************************************************************************\n *\n * lib/helpers.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Story, StyleWrapper, Wikifier, strings */\n\nvar _ref3 = function () {\n\t'use strict';\n\n\t/*\n \tAppends a new <style> element to the document's <head>.\n */\n\n\tvar _imageMarkupRe = /\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+/g,\n\t    _hasImageMarkupRe = new RegExp(_imageMarkupRe.source); // to drop the global flag\n\n\tfunction addStyle(rawCSS) {\n\t\tvar style = document.getElementById('style-story');\n\n\t\tif (style === null) {\n\t\t\tstyle = document.createElement('style');\n\t\t\tstyle.id = 'style-story';\n\t\t\tstyle.type = 'text/css';\n\t\t\tdocument.head.appendChild(style);\n\t\t}\n\n\t\tstyle = new StyleWrapper(style);\n\n\t\tvar css = rawCSS;\n\n\t\t// Check for wiki image transclusion.\n\t\tif (_hasImageMarkupRe.test(css)) {\n\t\t\tcss = css.replace(_imageMarkupRe, function (wikiImage) {\n\t\t\t\tvar markup = Wikifier.helpers.parseSquareBracketedMarkup({\n\t\t\t\t\tsource: wikiImage,\n\t\t\t\t\tmatchStart: 0\n\t\t\t\t});\n\n\t\t\t\tif (markup.hasOwnProperty('error') || markup.pos < wikiImage.length) {\n\t\t\t\t\treturn wikiImage;\n\t\t\t\t}\n\n\t\t\t\tvar source = markup.source;\n\n\t\t\t\t// Handle image passage transclusion.\n\t\t\t\tif (source.slice(0, 5) !== 'data:' && Story.has(source)) {\n\t\t\t\t\tvar passage = Story.get(source);\n\n\t\t\t\t\tif (passage.tags.includes('Twine.image')) {\n\t\t\t\t\t\tsource = passage.text;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/*\n    \tThe source may be URI- or Base64-encoded, so we cannot use encodeURIComponent()\n    \there.  Instead, we simply encode any double quotes, since the URI will be\n    \tdelimited by them.\n    */\n\t\t\t\treturn 'url(\"' + source.replace(/\"/g, '%22') + '\")';\n\t\t\t});\n\t\t}\n\n\t\tstyle.add(css);\n\t}\n\n\t/*\n \tReturns a deep copy of the passed object.\n \t\tn.b. 1. `clone()` does not clone functions, however, since function definitions are immutable,\n \t        the only issues are with expando properties and scope.  The former really should not\n \t        be done.  The latter is problematic either way (damned if you do, damned if you don't).\n \t     2. `clone()` does not maintain referential relationships (e.g. multiple references to the\n \t        same object will, post-cloning, refer to different equivalent objects; i.e. each\n \t        reference will get its own clone of the original object).\n */\n\tfunction clone(orig) {\n\t\t/*\n  \tImmediately return non-objects.\n  */\n\t\tif ((typeof orig === 'undefined' ? 'undefined' : _typeof(orig)) !== 'object' || orig == null) {\n\t\t\t// lazy equality for null\n\t\t\treturn orig;\n\t\t}\n\n\t\t/*\n  \tHonor native clone methods.\n  */\n\t\tif (typeof orig.clone === 'function') {\n\t\t\treturn orig.clone(true);\n\t\t} else if (orig.nodeType && typeof orig.cloneNode === 'function') {\n\t\t\treturn orig.cloneNode(true);\n\t\t}\n\n\t\t/*\n  \tCreate a copy of the original object.\n  \t\tn.b. 1. Each non-generic object that we wish to support must receive a special case below.\n  \t     2. Since we're using the `instanceof` operator to identify special cases, this may\n  \t        fail to properly identify such cases if the author engages in cross-<iframe>\n  \t        object manipulation.  The solution to this problem would be for the author to\n  \t        pass messages between the frames, rather than doing direct cross-frame object\n  \t        manipulation.  That is, in fact, what they should be doing in the first place.\n  \t     3. We cannot use `Object.prototype.toString.call(orig)` to solve #2 because the shims\n  \t        for `Map` and `Set` return `[object Object]` rather than `[object Map]` and\n  \t        `[object Set]`.\n  */\n\t\tvar copy = void 0;\n\n\t\tif (Array.isArray(orig)) {\n\t\t\t// considering #2, `orig instanceof Array` might be more appropriate\n\t\t\tcopy = [];\n\t\t} else if (orig instanceof Date) {\n\t\t\tcopy = new Date(orig.getTime());\n\t\t} else if (orig instanceof Map) {\n\t\t\tcopy = new Map();\n\t\t\torig.forEach(function (v, k) {\n\t\t\t\tcopy.set(k, clone(v));\n\t\t\t});\n\t\t} else if (orig instanceof RegExp) {\n\t\t\tcopy = new RegExp(orig);\n\t\t} else if (orig instanceof Set) {\n\t\t\tcopy = new Set();\n\t\t\torig.forEach(function (v) {\n\t\t\t\tcopy.add(clone(v));\n\t\t\t});\n\t\t} else {\n\t\t\t// unknown or generic object\n\t\t\t// Try to ensure that the returned object has the same prototype as the original.\n\t\t\tcopy = Object.create(Object.getPrototypeOf(orig));\n\t\t}\n\n\t\t/*\n  \tDuplicate the original object's own enumerable properties, which will include expando\n  \tproperties on non-generic objects.\n  \t\tn.b. This does not preserve ES5 property attributes.  Neither does the delta coding\n  \t\t or serialization code, however, so it's not really an issue at the moment.\n  */\n\t\tObject.keys(orig).forEach(function (name) {\n\t\t\treturn copy[name] = clone(orig[name]);\n\t\t});\n\n\t\treturn copy;\n\t}\n\n\t/*\n \tConverts <br> elements to <p> elements within the given node tree.\n */\n\tfunction convertBreaks(source) {\n\t\tvar output = document.createDocumentFragment();\n\t\tvar para = document.createElement('p'),\n\t\t    node = void 0;\n\n\t\twhile ((node = source.firstChild) !== null) {\n\t\t\tif (node.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\tvar tagName = node.nodeName.toUpperCase();\n\n\t\t\t\tswitch (tagName) {\n\t\t\t\t\tcase 'BR':\n\t\t\t\t\t\tif (node.nextSibling !== null && node.nextSibling.nodeType === Node.ELEMENT_NODE && node.nextSibling.nodeName.toUpperCase() === 'BR') {\n\t\t\t\t\t\t\tsource.removeChild(node.nextSibling);\n\t\t\t\t\t\t\tsource.removeChild(node);\n\t\t\t\t\t\t\toutput.appendChild(para);\n\t\t\t\t\t\t\tpara = document.createElement('p');\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t} else if (!para.hasChildNodes()) {\n\t\t\t\t\t\t\tsource.removeChild(node);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'ADDRESS':\n\t\t\t\t\tcase 'ARTICLE':\n\t\t\t\t\tcase 'ASIDE':\n\t\t\t\t\tcase 'BLOCKQUOTE':\n\t\t\t\t\tcase 'CENTER':\n\t\t\t\t\tcase 'DIV':\n\t\t\t\t\tcase 'DL':\n\t\t\t\t\tcase 'FIGURE':\n\t\t\t\t\tcase 'FOOTER':\n\t\t\t\t\tcase 'FORM':\n\t\t\t\t\tcase 'H1':\n\t\t\t\t\tcase 'H2':\n\t\t\t\t\tcase 'H3':\n\t\t\t\t\tcase 'H4':\n\t\t\t\t\tcase 'H5':\n\t\t\t\t\tcase 'H6':\n\t\t\t\t\tcase 'HEADER':\n\t\t\t\t\tcase 'HR':\n\t\t\t\t\tcase 'MAIN':\n\t\t\t\t\tcase 'NAV':\n\t\t\t\t\tcase 'OL':\n\t\t\t\t\tcase 'P':\n\t\t\t\t\tcase 'PRE':\n\t\t\t\t\tcase 'SECTION':\n\t\t\t\t\tcase 'TABLE':\n\t\t\t\t\tcase 'UL':\n\t\t\t\t\t\tif (para.hasChildNodes()) {\n\t\t\t\t\t\t\toutput.appendChild(para);\n\t\t\t\t\t\t\tpara = document.createElement('p');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toutput.appendChild(node);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpara.appendChild(node);\n\t\t}\n\n\t\tif (para.hasChildNodes()) {\n\t\t\toutput.appendChild(para);\n\t\t}\n\n\t\tsource.appendChild(output);\n\t}\n\n\t/*\n \tReturns the simple string representation of the passed value or, if there is none,\n \tthe passed default value.\n */\n\tfunction toStringOrDefault(val, defVal) {\n\t\tswitch (typeof val === 'undefined' ? 'undefined' : _typeof(val)) {\n\t\t\tcase 'number':\n\t\t\t\tif (isNaN(val)) {\n\t\t\t\t\treturn defVal;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'object':\n\t\t\t\tif (val === null) {\n\t\t\t\t\treturn defVal;\n\t\t\t\t} else if (Array.isArray(val) || val instanceof Set) {\n\t\t\t\t\treturn [].concat(_toConsumableArray(val)).map(function (v) {\n\t\t\t\t\t\treturn toStringOrDefault(v, defVal);\n\t\t\t\t\t}).join(', ');\n\t\t\t\t} else if (val instanceof Map) {\n\t\t\t\t\tvar _ret8 = function () {\n\t\t\t\t\t\t/* eslint-disable prefer-template */\n\t\t\t\t\t\tvar tSOD = toStringOrDefault;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tv: '( ' + [].concat(_toConsumableArray(val)).map(function (kv) {\n\t\t\t\t\t\t\t\treturn tSOD(kv[0], defVal) + ' ⇒ ' + tSOD(kv[1], defVal);\n\t\t\t\t\t\t\t}).join('; ') + ' )'\n\t\t\t\t\t\t};\n\t\t\t\t\t\t/* eslint-enable prefer-template */\n\t\t\t\t\t}();\n\n\t\t\t\t\tif ((typeof _ret8 === 'undefined' ? 'undefined' : _typeof(_ret8)) === \"object\") return _ret8.v;\n\t\t\t\t} else if (val instanceof Date) {\n\t\t\t\t\treturn val.toLocaleString();\n\t\t\t\t} else if (typeof val.toString === 'function') {\n\t\t\t\t\treturn val.toString();\n\t\t\t\t}\n\n\t\t\t\treturn Object.prototype.toString.call(val);\n\n\t\t\tcase 'function':\n\t\t\tcase 'undefined':\n\t\t\t\treturn defVal;\n\t\t}\n\n\t\treturn String(val);\n\t}\n\n\t/*\n \tWikifies a passage into a DOM element corresponding to the passed ID and returns the element.\n */\n\tfunction setPageElement(idOrElement, titles, defaultText) {\n\t\tvar el = (typeof idOrElement === 'undefined' ? 'undefined' : _typeof(idOrElement)) === 'object' ? idOrElement : document.getElementById(idOrElement);\n\n\t\tif (el == null) {\n\t\t\t// lazy equality for null\n\t\t\treturn null;\n\t\t}\n\n\t\tvar ids = Array.isArray(titles) ? titles : [titles];\n\n\t\tjQuery(el).empty();\n\n\t\tfor (var i = 0, iend = ids.length; i < iend; ++i) {\n\t\t\tif (Story.has(ids[i])) {\n\t\t\t\tnew Wikifier(el, Story.get(ids[i]).processText().trim());\n\t\t\t\treturn el;\n\t\t\t}\n\t\t}\n\n\t\tif (defaultText != null) {\n\t\t\t// lazy equality for null\n\t\t\tvar text = String(defaultText).trim();\n\n\t\t\tif (text !== '') {\n\t\t\t\tnew Wikifier(el, text);\n\t\t\t}\n\t\t}\n\n\t\treturn el;\n\t}\n\n\t/*\n \tAppends an error message to the passed DOM element.\n */\n\tfunction throwError(place, message, title) {\n\t\tjQuery(document.createElement('span')).addClass('error').attr('title', title).text(strings.errors.title + ': ' + (message || 'unknown error')).appendTo(place);\n\t\treturn false;\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\taddStyle: { value: addStyle },\n\t\tclone: { value: clone },\n\t\tconvertBreaks: { value: convertBreaks },\n\t\ttoStringOrDefault: { value: toStringOrDefault },\n\t\tsetPageElement: { value: setPageElement },\n\t\tthrowError: { value: throwError }\n\t}));\n}();\n\nvar addStyle = _ref3.addStyle;\nvar clone = _ref3.clone;\nvar convertBreaks = _ref3.convertBreaks;\nvar toStringOrDefault = _ref3.toStringOrDefault;\nvar setPageElement = _ref3.setPageElement;\nvar throwError = _ref3.throwError;\n\n/***********************************************************************************************************************\n *\n * lib/util.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Scripting, clone */\n\nvar Util = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * Type Functions.\n  ******************************************************************************************************************/\n\t/**\n \tReturns whether the passed value is a finite number or a numeric string which yields\n \ta finite number when parsed.\n **/\n\n\tfunction utilIsNumeric(obj) {\n\t\tvar num = void 0;\n\n\t\tswitch (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) {\n\t\t\tcase 'number':\n\t\t\t\tnum = obj;\n\t\t\t\tbreak;\n\n\t\t\tcase 'string':\n\t\t\t\tnum = Number(obj);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn !isNaN(num) && isFinite(num);\n\t}\n\n\t/**\n \tReturns whether the passed value is a boolean or one of the strings \"true\" or \"false\".\n **/\n\tfunction utilIsBoolean(obj) {\n\t\treturn typeof obj === 'boolean' || typeof obj === 'string' && (obj === 'true' || obj === 'false');\n\t}\n\n\t/*******************************************************************************************************************\n  * String Encoding Functions.\n  ******************************************************************************************************************/\n\t/**\n \tReturns a lowercased and hyphen encoded version of the passed string.\n **/\n\tfunction utilSlugify(str) {\n\t\treturn String(str).trim().replace(/[^\\w\\s\\u2013\\u2014-]+/g, '').replace(/[_\\s\\u2013\\u2014-]+/g, '-').toLocaleLowerCase();\n\t}\n\n\t/**\n \tReturns an entity encoded version of the passed string.\n **/\n\tvar _htmlCharsRe = /[&<>\"'`]/g,\n\t    _hasHtmlCharsRe = new RegExp(_htmlCharsRe.source),\n\t    // to drop the global flag\n\t_htmlCharsMap = Object.freeze({\n\t\t'&': '&amp;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'\"': '&quot;',\n\t\t\"'\": '&#39;',\n\t\t'`': '&#96;'\n\t});\n\n\tfunction utilEscape(str) {\n\t\tif (str == null) {\n\t\t\t// lazy equality for null\n\t\t\treturn '';\n\t\t}\n\n\t\tvar s = String(str);\n\t\treturn s && _hasHtmlCharsRe.test(s) ? s.replace(_htmlCharsRe, function (c) {\n\t\t\treturn _htmlCharsMap[c];\n\t\t}) : s;\n\t}\n\n\t/**\n \tReturns a decoded version of the passed entity encoded string.\n **/\n\tvar _escapedHtmlRe = /&(?:amp|lt|gt|quot|apos|#39|#x27|#96|#x60);/g,\n\t    _hasEscapedHtmlRe = new RegExp(_escapedHtmlRe.source),\n\t    // to drop the global flag\n\t_escapedHtmlMap = Object.freeze({\n\t\t'&amp;': '&',\n\t\t'&lt;': '<',\n\t\t'&gt;': '>',\n\t\t'&quot;': '\"',\n\t\t'&apos;': \"'\", // apostrophe from XML shenanigans\n\t\t'&#39;': \"'\", // apostrophe from decimal NCR\n\t\t'&#x27;': \"'\", // apostrophe from hexadecimal NCR (fuck you, Underscorejs)\n\t\t'&#96;': '`', // backtick from decimal NCR\n\t\t'&#x60;': '`' // backtick from hexadecimal NCR (fuck you, Underscorejs)\n\t});\n\n\tfunction utilUnescape(str) {\n\t\tif (str == null) {\n\t\t\t// lazy equality for null\n\t\t\treturn '';\n\t\t}\n\n\t\tvar s = String(str);\n\t\treturn s && _hasEscapedHtmlRe.test(s) ? s.replace(_escapedHtmlRe, function (c) {\n\t\t\treturn _escapedHtmlMap[c];\n\t\t}) : s;\n\t}\n\n\t/*******************************************************************************************************************\n  * Conversion Functions.\n  ******************************************************************************************************************/\n\t/**\n \tReturns the number of miliseconds represented by the passed CSS time string.\n **/\n\tfunction utilFromCssTime(cssTime) {\n\t\tvar re = /^([+-]?(?:\\d*\\.)?\\d+)([Mm]?[Ss])$/,\n\t\t    match = re.exec(String(cssTime));\n\n\t\tif (match === null) {\n\t\t\tthrow new SyntaxError('invalid time value syntax: \"' + cssTime + '\"');\n\t\t}\n\n\t\tvar msec = Number(match[1]);\n\n\t\tif (/^[Ss]$/.test(match[2])) {\n\t\t\tmsec *= 1000;\n\t\t}\n\n\t\tif (isNaN(msec) || !isFinite(msec)) {\n\t\t\tthrow new RangeError('invalid time value: \"' + cssTime + '\"');\n\t\t}\n\n\t\treturn msec;\n\t}\n\n\t/**\n \tReturns the CSS time string represented by the passed number of milliseconds.\n **/\n\tfunction utilToCssTime(msec) {\n\t\tif (typeof msec !== 'number' || isNaN(msec) || !isFinite(msec)) {\n\t\t\tvar what = void 0;\n\n\t\t\tswitch (typeof msec === 'undefined' ? 'undefined' : _typeof(msec)) {\n\t\t\t\tcase 'string':\n\t\t\t\t\twhat = '\"' + msec + '\"';\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'number':\n\t\t\t\t\twhat = String(msec);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\twhat = Object.prototype.toString.call(msec);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthrow new Error('invalid milliseconds: ' + what);\n\t\t}\n\n\t\treturn msec + 'ms';\n\t}\n\n\t/**\n \tReturns the DOM property name represented by the passed CSS property name.\n **/\n\tfunction utilFromCssProperty(cssName) {\n\t\tif (!cssName.includes('-')) {\n\t\t\tswitch (cssName) {\n\t\t\t\tcase 'bgcolor':\n\t\t\t\t\treturn 'backgroundColor';\n\t\t\t\tcase 'float':\n\t\t\t\t\treturn 'cssFloat';\n\t\t\t\tdefault:\n\t\t\t\t\treturn cssName;\n\t\t\t}\n\t\t}\n\n\t\treturn cssName.split('-').map(function (part, i) {\n\t\t\treturn i === 0 ? part : part.slice(0, 1).toUpperCase() + part.slice(1);\n\t\t}).join('');\n\t}\n\n\t/**\n \tReturns an object containing the component properties parsed from the passed URL.\n **/\n\tfunction utilParseUrl(url) {\n\t\tvar el = document.createElement('a'),\n\t\t    queryObj = Object.create(null);\n\n\t\t// Let the `<a>` element parse the URL.\n\t\tel.href = url;\n\n\t\t// Populate the `queryObj` object with the query string attributes.\n\t\tel.search.replace(/^\\?/, '').split(/(?:&(?:amp;)?|;)/).forEach(function (query) {\n\t\t\tvar _query$split = query.split('=');\n\n\t\t\tvar _query$split2 = _slicedToArray(_query$split, 2);\n\n\t\t\tvar key = _query$split2[0];\n\t\t\tvar value = _query$split2[1];\n\n\t\t\tqueryObj[key] = value;\n\t\t});\n\n\t\t/*\n  \tCaveats by browser:\n  \t\tEdge and Internet Explorer (≥8) do not support authentication information\n  \t\twithin a URL at all and will throw a security exception on *any* property\n  \t\taccess if its included.\n  \t\t\tInternet Explorer does not include the leading forward slash on `pathname`\n  \t\twhen required.\n  \t\t\tOpera (Presto) strips the authentication information from `href` and does\n  \t\tnot supply `username` or `password`.\n  \t\t\tSafari (circa. 5.1.x) does not supply `username` or `password` and peforms\n  \t\tURI decoding on `pathname`.\n  */\n\n\t\t// Patch for IE not including the leading slash on `pathname` when required.\n\t\tvar pathname = el.host && el.pathname[0] !== '/' ? '/' + el.pathname : el.pathname;\n\n\t\treturn {\n\t\t\t// The full URL that was originally parsed.\n\t\t\thref: el.href,\n\n\t\t\t// The request protocol, lowercased.\n\t\t\tprotocol: el.protocol,\n\n\t\t\t// // The full authentication information.\n\t\t\t// auth : el.username || el.password // eslint-disable-line no-nested-ternary\n\t\t\t// \t? `${el.username}:${el.password}`\n\t\t\t// \t: typeof el.username === 'string' ? '' : undefined,\n\t\t\t//\n\t\t\t// // The username portion of the auth info.\n\t\t\t// username : el.username,\n\t\t\t//\n\t\t\t// // The password portion of the auth info.\n\t\t\t// password : el.password,\n\n\t\t\t// The full host information, including port number, lowercased.\n\t\t\thost: el.host,\n\n\t\t\t// The hostname portion of the host info, lowercased.\n\t\t\thostname: el.hostname,\n\n\t\t\t// The port number portion of the host info.\n\t\t\tport: el.port,\n\n\t\t\t// The full path information, including query info.\n\t\t\tpath: '' + pathname + el.search,\n\n\t\t\t// The pathname portion of the path info.\n\t\t\tpathname: pathname,\n\n\t\t\t// The query string portion of the path info, including the leading question mark.\n\t\t\tquery: el.search,\n\t\t\tsearch: el.search,\n\n\t\t\t// The attributes portion of the query string, parsed into an object.\n\t\t\tqueries: queryObj,\n\t\t\tsearches: queryObj,\n\n\t\t\t// The fragment string, including the leading hash/pound sign.\n\t\t\thash: el.hash\n\t\t};\n\t}\n\n\t/*******************************************************************************************************************\n  * Diff Functions.\n  ******************************************************************************************************************/\n\t/*\n \tDiff operations enumeration.\n */\n\tvar DiffOp = Object.freeze({\n\t\tDelete: 0,\n\t\tSpliceArray: 1,\n\t\tCopy: 2,\n\t\tCopyDate: 3\n\t});\n\n\t/**\n \tReturns a patch object containing the differences between the orig and the dest objects.\n **/\n\tfunction utilDiff(orig, dest) /* diff object */{\n\t\tvar objToString = Object.prototype.toString,\n\t\t    origIsArray = Array.isArray(orig),\n\t\t    keys = [].concat(Object.keys(orig), Object.keys(dest)).sort().filter(function (v, i, a) {\n\t\t\treturn i === 0 || a[i - 1] !== v;\n\t\t}),\n\t\t    diff = {};\n\t\tvar aOpRef = void 0;\n\n\t\tfor (var i = 0, klen = keys.length; i < klen; ++i) {\n\t\t\tvar p = keys[i],\n\t\t\t    origP = orig[p],\n\t\t\t    destP = dest[p];\n\n\t\t\tif (orig.hasOwnProperty(p)) {\n\t\t\t\t// Key exists in both.\n\t\t\t\tif (dest.hasOwnProperty(p)) {\n\t\t\t\t\t// Values are exactly the same, so do nothing.\n\t\t\t\t\tif (origP === destP) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Values are of the same basic type.\n\t\t\t\t\tif ((typeof origP === 'undefined' ? 'undefined' : _typeof(origP)) === (typeof destP === 'undefined' ? 'undefined' : _typeof(destP))) {\n\t\t\t\t\t\t// Values are functions.\n\t\t\t\t\t\tif (typeof origP === 'function') {\n\t\t\t\t\t\t\t/* diff[p] = [DiffOp.Copy, destP]; */\n\t\t\t\t\t\t\tif (origP.toString() !== destP.toString()) {\n\t\t\t\t\t\t\t\tdiff[p] = [DiffOp.Copy, destP];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Values are scalars or null.\n\t\t\t\t\t\telse if ((typeof origP === 'undefined' ? 'undefined' : _typeof(origP)) !== 'object' || origP === null) {\n\t\t\t\t\t\t\t\tdiff[p] = [DiffOp.Copy, destP];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Values are objects.\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tvar origPType = objToString.call(origP),\n\t\t\t\t\t\t\t\t\t    destPType = objToString.call(destP);\n\n\t\t\t\t\t\t\t\t\t// Values are objects of the same prototype.\n\t\t\t\t\t\t\t\t\tif (origPType === destPType) {\n\t\t\t\t\t\t\t\t\t\t// Special case: `Date` object.\n\t\t\t\t\t\t\t\t\t\tif (origPType === '[object Date]') {\n\t\t\t\t\t\t\t\t\t\t\tif (+origP !== +destP) {\n\t\t\t\t\t\t\t\t\t\t\t\tdiff[p] = [DiffOp.CopyDate, +destP];\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t// Special case: `RegExp` object.\n\t\t\t\t\t\t\t\t\t\telse if (origPType === '[object RegExp]') {\n\t\t\t\t\t\t\t\t\t\t\t\tif (origP.toString() !== destP.toString()) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdiff[p] = [DiffOp.Copy, clone(destP)];\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tvar recurse = Util.diff(origP, destP);\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (recurse !== null) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdiff[p] = recurse;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// Values are objects of different prototypes.\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\tdiff[p] = [DiffOp.Copy, clone(destP)];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Values are of different types.\n\t\t\t\t\telse {\n\t\t\t\t\t\t\tdiff[p] = [DiffOp.Copy, (typeof destP === 'undefined' ? 'undefined' : _typeof(destP)) !== 'object' || destP === null ? destP : clone(destP)];\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Key only exists in orig.\n\t\t\t\telse {\n\t\t\t\t\t\tif (origIsArray && Util.isNumeric(p)) {\n\t\t\t\t\t\t\tvar np = +p;\n\n\t\t\t\t\t\t\tif (!aOpRef) {\n\t\t\t\t\t\t\t\taOpRef = '';\n\n\t\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\t\taOpRef += '~';\n\t\t\t\t\t\t\t\t} while (keys.some(function (v) {\n\t\t\t\t\t\t\t\t\treturn v === this.val;\n\t\t\t\t\t\t\t\t}, { val: aOpRef }));\n\n\t\t\t\t\t\t\t\tdiff[aOpRef] = [DiffOp.SpliceArray, np, np];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (np < diff[aOpRef][1]) {\n\t\t\t\t\t\t\t\tdiff[aOpRef][1] = np;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (np > diff[aOpRef][2]) {\n\t\t\t\t\t\t\t\tdiff[aOpRef][2] = np;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdiff[p] = DiffOp.Delete;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t\t// Key only exists in dest.\n\t\t\telse {\n\t\t\t\t\tdiff[p] = [DiffOp.Copy, (typeof destP === 'undefined' ? 'undefined' : _typeof(destP)) !== 'object' || destP === null ? destP : clone(destP)];\n\t\t\t\t}\n\t\t}\n\n\t\treturn Object.keys(diff).length > 0 ? diff : null;\n\t}\n\n\t/**\n \tReturns an object resulting from updating the orig object with the diff object.\n **/\n\tfunction utilPatch(orig, diff) /* patched object */{\n\t\tvar keys = Object.keys(diff || {}),\n\t\t    patched = clone(orig);\n\n\t\tfor (var i = 0, klen = keys.length; i < klen; ++i) {\n\t\t\tvar p = keys[i],\n\t\t\t    diffP = diff[p];\n\n\t\t\tif (diffP === DiffOp.Delete) {\n\t\t\t\tdelete patched[p];\n\t\t\t} else if (Array.isArray(diffP)) {\n\t\t\t\tswitch (diffP[0]) {\n\t\t\t\t\tcase DiffOp.SpliceArray:\n\t\t\t\t\t\tpatched.splice(diffP[1], 1 + (diffP[2] - diffP[1]));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase DiffOp.Copy:\n\t\t\t\t\t\tpatched[p] = clone(diffP[1]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase DiffOp.CopyDate:\n\t\t\t\t\t\tpatched[p] = new Date(diffP[1]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpatched[p] = Util.patch(patched[p], diffP);\n\t\t\t}\n\t\t}\n\n\t\treturn patched;\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\t/*\n  \tType Functions.\n  */\n\t\tisNumeric: { value: utilIsNumeric },\n\t\tisBoolean: { value: utilIsBoolean },\n\n\t\t/*\n  \tString Encoding Functions.\n  */\n\t\tslugify: { value: utilSlugify },\n\t\tescape: { value: utilEscape },\n\t\tunescape: { value: utilUnescape },\n\n\t\t/*\n  \tConversion Functions.\n  */\n\t\tfromCssTime: { value: utilFromCssTime },\n\t\ttoCssTime: { value: utilToCssTime },\n\t\tfromCssProperty: { value: utilFromCssProperty },\n\t\tparseUrl: { value: utilParseUrl },\n\n\t\t/*\n  \tDiff Functions.\n  */\n\t\tDiffOp: { value: DiffOp },\n\t\tdiff: { value: utilDiff },\n\t\tpatch: { value: utilPatch },\n\n\t\t/*\n  \tLegacy Aliases.\n  */\n\t\trandom: { value: Math.random },\n\t\tentityEncode: { value: utilEscape },\n\t\tentityDecode: { value: utilUnescape },\n\t\tevalExpression: { value: function value() {\n\t\t\t\treturn Scripting.evalJavaScript.apply(Scripting, arguments);\n\t\t\t} }, // See: `markup/scripting.js`.\n\t\tevalStatements: { value: function value() {\n\t\t\t\treturn Scripting.evalJavaScript.apply(Scripting, arguments);\n\t\t\t} } // See: `markup/scripting.js`.\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * lib/audiowrapper.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\nvar AudioWrapper = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar\n\t// Events supported by the `on()`, `one()`, and `off()` methods.\n\t_events = new Map([['end', 'ended'], ['fade', 'aw:fade'], ['pause', 'pause'], ['play', 'playing'], ['rate', 'ratechange'], ['seek', 'seeked'], ['stop', 'aw:stop'], ['volume', 'volumechange']]);\n\n\t/*******************************************************************************************************************\n  * AudioWrapper Class.\n  ******************************************************************************************************************/\n\n\tvar AudioWrapper = function () {\n\t\tfunction AudioWrapper(audio) {\n\t\t\t_classCallCheck(this, AudioWrapper);\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\taudio: {\n\t\t\t\t\tvalue: audio\n\t\t\t\t},\n\n\t\t\t\t_faderId: {\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: null\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Ensure that, at least, the metadata is loaded.\n\t\t\tif (this.audio.preload !== 'metadata' && this.audio.preload !== 'auto') {\n\t\t\t\tthis.audio.preload = 'metadata';\n\t\t\t}\n\t\t}\n\n\t\t/*\n  \tn.b. The various data constants (e.g. for comparison to `readyState` or `networkState`)\n  \t     are not defined by all browsers on the descendant elements `HTMLAudioElement` and\n  \t     `HTMLVideoElement` (notably, IE/Edge do not).  Therefore, the base media element,\n  \t     `HTMLMediaElement`, must be used to reference the constants.\n  */\n\n\t\t_createClass(AudioWrapper, [{\n\t\t\tkey: 'hasMetadata',\n\t\t\tvalue: function hasMetadata() {\n\t\t\t\treturn this.audio.readyState >= HTMLMediaElement.HAVE_METADATA;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'hasSomeData',\n\t\t\tvalue: function hasSomeData() {\n\t\t\t\treturn this.audio.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'hasData',\n\t\t\tvalue: function hasData() {\n\t\t\t\treturn this.audio.readyState === HTMLMediaElement.HAVE_ENOUGH_DATA;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'noSource',\n\t\t\tvalue: function noSource() {\n\t\t\t\treturn !(this.audio.src || this.audio.hasChildNodes()) || this.audio.networkState === HTMLMediaElement.NETWORK_NO_SOURCE;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'isLoading',\n\t\t\tvalue: function isLoading() {\n\t\t\t\treturn this.audio.networkState === HTMLMediaElement.NETWORK_LOADING;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'isPlaying',\n\t\t\tvalue: function isPlaying() {\n\t\t\t\treturn !(this.audio.ended || this.audio.paused || !this.hasSomeData());\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'isEnded',\n\t\t\tvalue: function isEnded() {\n\t\t\t\treturn this.audio.ended;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'isPaused',\n\t\t\tvalue: function isPaused() {\n\t\t\t\treturn this.audio.paused;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'isMuted',\n\t\t\tvalue: function isMuted() {\n\t\t\t\treturn this.audio.muted;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'isLooped',\n\t\t\tvalue: function isLooped() {\n\t\t\t\treturn this.audio.loop;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'load',\n\t\t\tvalue: function load() {\n\t\t\t\tif (this.audio.preload !== 'auto') {\n\t\t\t\t\tthis.audio.preload = 'auto';\n\t\t\t\t}\n\n\t\t\t\tthis.audio.load();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'play',\n\t\t\tvalue: function play() {\n\t\t\t\tif (!this.hasData() && !this.isLoading()) {\n\t\t\t\t\tthis.load();\n\t\t\t\t}\n\n\t\t\t\tthis.audio.play();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'pause',\n\t\t\tvalue: function pause() {\n\t\t\t\tthis.audio.pause();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'stop',\n\t\t\tvalue: function stop() {\n\t\t\t\tthis.audio.pause();\n\t\t\t\tthis.time = 0;\n\t\t\t\tjQuery(this.audio).triggerHandler('aw:stop');\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'mute',\n\t\t\tvalue: function mute() {\n\t\t\t\tthis.audio.muted = true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'unmute',\n\t\t\tvalue: function unmute() {\n\t\t\t\tthis.audio.muted = false;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'loop',\n\t\t\tvalue: function loop() {\n\t\t\t\tthis.audio.loop = true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'unloop',\n\t\t\tvalue: function unloop() {\n\t\t\t\tthis.audio.loop = false;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'fadeWithDuration',\n\t\t\tvalue: function fadeWithDuration(fadeDuration, toVol, fromVol) {\n\t\t\t\tvar _this2 = this;\n\n\t\t\t\tif (this._faderId !== null) {\n\t\t\t\t\tclearInterval(this._faderId);\n\t\t\t\t\tthis._faderId = null;\n\t\t\t\t}\n\n\t\t\t\tvar from = Math.clamp(fromVol == null ? this.volume : fromVol, 0, 1),\n\t\t\t\t    // lazy equality for null\n\t\t\t\tto = Math.clamp(toVol, 0, 1);\n\n\t\t\t\tif (from === to) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.volume = from;\n\n\t\t\t\t/*\n    \tWe listen for the `timeupdate` event here, rather than `playing`, because\n    \tvarious browsers (notably, mobile browsers) are poor at firing media events\n    \tin a timely fashion, so we use `timeupdate` to ensure that we don't start\n    \tthe fade until the track is actually progressing.\n    */\n\t\t\t\tjQuery(this.audio).off('timeupdate.AudioWrapper:fadeWithDuration').one('timeupdate.AudioWrapper:fadeWithDuration', function () {\n\t\t\t\t\tvar min = void 0,\n\t\t\t\t\t    max = void 0;\n\n\t\t\t\t\tif (from < to) {\n\t\t\t\t\t\t// Fade in.\n\t\t\t\t\t\tmin = from;\n\t\t\t\t\t\tmax = to;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Fade out.\n\t\t\t\t\t\tmin = to;\n\t\t\t\t\t\tmax = from;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar duration = Math.clamp(fadeDuration, 1, _this2.remaining),\n\t\t\t\t\t    interval = 25,\n\t\t\t\t\t    // in milliseconds\n\t\t\t\t\tdelta = (to - from) / (duration / (interval / 1000));\n\n\t\t\t\t\t_this2._faderId = setInterval(function () {\n\t\t\t\t\t\tif (!_this2.isPlaying()) {\n\t\t\t\t\t\t\tclearInterval(_this2._faderId);\n\t\t\t\t\t\t\t_this2._faderId = null;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this2.volume = Math.clamp(_this2.volume + delta, min, max);\n\n\t\t\t\t\t\tif (_this2.volume === 0) {\n\t\t\t\t\t\t\t_this2.pause();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (_this2.volume === to) {\n\t\t\t\t\t\t\tclearInterval(_this2._faderId);\n\t\t\t\t\t\t\t_this2._faderId = null;\n\t\t\t\t\t\t\tjQuery(_this2.audio).triggerHandler('aw:fade');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, interval);\n\t\t\t\t});\n\n\t\t\t\tthis.play();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'fade',\n\t\t\tvalue: function fade(toVol, fromVol) {\n\t\t\t\tthis.fadeWithDuration(5, toVol, fromVol);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'fadeIn',\n\t\t\tvalue: function fadeIn() {\n\t\t\t\tthis.fade(1);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'fadeOut',\n\t\t\tvalue: function fadeOut() {\n\t\t\t\tthis.fade(0);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'on',\n\t\t\tvalue: function on(eventName, listener) {\n\t\t\t\tif (!_events.has(eventName)) {\n\t\t\t\t\tthrow new Error('unknown event \"' + eventName + '\"; valid: ' + [].concat(_toConsumableArray(_events.keys())).join(', '));\n\t\t\t\t} else if (typeof listener !== 'function') {\n\t\t\t\t\tthrow new Error('listener parameter must be a function');\n\t\t\t\t}\n\n\t\t\t\treturn jQuery(this.audio).on(_events.get(eventName) + '.AudioWrapperEvents', listener);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'one',\n\t\t\tvalue: function one(eventName, listener) {\n\t\t\t\tif (!_events.has(eventName)) {\n\t\t\t\t\tthrow new Error('unknown event \"' + eventName + '\"; valid: ' + [].concat(_toConsumableArray(_events.keys())).join(', '));\n\t\t\t\t} else if (typeof listener !== 'function') {\n\t\t\t\t\tthrow new Error('listener parameter must be a function');\n\t\t\t\t}\n\n\t\t\t\treturn jQuery(this.audio).one(_events.get(eventName) + '.AudioWrapperEvents', listener);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'off',\n\t\t\tvalue: function off(eventName, listener) {\n\t\t\t\tif (eventName && !_events.has(eventName)) {\n\t\t\t\t\tthrow new Error('unknown event \"' + eventName + '\"; valid: ' + [].concat(_toConsumableArray(_events.keys())).join(', '));\n\t\t\t\t} else if (listener && typeof listener !== 'function') {\n\t\t\t\t\tthrow new Error('listener parameter must be a function');\n\t\t\t\t}\n\n\t\t\t\treturn jQuery(this.audio).off((eventName ? _events.get(eventName) : '') + '.AudioWrapperEvents', listener);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'clone',\n\t\t\tvalue: function clone() {\n\t\t\t\t// Do not use `jQuery.clone()` here, as we do not want event handlers carried over.\n\t\t\t\t// return new AudioWrapper(this.audio.cloneNode(true));\n\t\t\t\treturn new this.constructor(this.audio.cloneNode(true));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'duration',\n\t\t\tget: function get() {\n\t\t\t\t// n.b. May return a double, NaN, or Infinity.\n\t\t\t\treturn this.audio.duration;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'rate',\n\t\t\tget: function get() {\n\t\t\t\treturn this.audio.playbackRate;\n\t\t\t},\n\t\t\tset: function set(playRate) {\n\t\t\t\t// Clamp the playback rate to sane values.  Some browsers also do this to varying degrees.\n\t\t\t\tthis.audio.playbackRate = Math.clamp(playRate, 0.2, 5); // clamp to 5× slower & faster\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'remaining',\n\t\t\tget: function get() {\n\t\t\t\t// n.b. May return a double, NaN, or Infinity.\n\t\t\t\treturn this.audio.duration - this.audio.currentTime;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'time',\n\t\t\tget: function get() {\n\t\t\t\treturn this.audio.currentTime;\n\t\t\t},\n\t\t\tset: function set(time) {\n\t\t\t\tvar _this3 = this;\n\n\t\t\t\t/*\n    \tThis workaround is no longer strictly necessary in most browsers (as of 2016),\n    \thowever, it will still be required for some time to service legacy browsers.\n    \t\tIf we try to modify the audio clip's `.currentTime` property before its metadata\n    \thas been loaded, it will throw an `InvalidStateError` (since it doesn't know its\n    \tduration, allowing `.currentTime` to be set would be undefined behavior), so in\n    \tcase an exception is thrown we provide a fallback using the `loadedmetadata` event.\n    */\n\t\t\t\ttry {\n\t\t\t\t\tthis.audio.currentTime = time;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tjQuery(this.audio).off('loadedmetadata.AudioWrapper:time').one('loadedmetadata.AudioWrapper:time', function () {\n\t\t\t\t\t\treturn _this3.audio.currentTime = time;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'volume',\n\t\t\tget: function get() {\n\t\t\t\treturn this.audio.volume;\n\t\t\t},\n\t\t\tset: function set(vol) {\n\t\t\t\tthis.audio.volume = Math.clamp(vol, 0, 1); // clamp to 0 (silent) & 1 (full loudness)\n\t\t\t}\n\t\t}]);\n\n\t\treturn AudioWrapper;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\n\n\treturn AudioWrapper;\n}();\n\n/***********************************************************************************************************************\n *\n * lib/debugview.js\n *\n * Copyright © 2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global strings */\n\n/*\n\tTODO: Make this use jQuery throughout.\n*/\nvar DebugView = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * DebugView Class.\n  ******************************************************************************************************************/\n\n\tvar DebugView = function () {\n\t\tfunction DebugView(parent, type, name, title) {\n\t\t\t_classCallCheck(this, DebugView);\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tparent: {\n\t\t\t\t\tvalue: parent\n\t\t\t\t},\n\n\t\t\t\tview: {\n\t\t\t\t\tvalue: document.createElement('span')\n\t\t\t\t},\n\n\t\t\t\tbreak: {\n\t\t\t\t\tvalue: document.createElement('wbr')\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Setup the wrapper (`<span>`) element.\n\t\t\tjQuery(this.view).attr({\n\t\t\t\ttitle: title,\n\t\t\t\t'aria-label': title,\n\t\t\t\t'data-type': type != null ? type : '', // lazy equality for null\n\t\t\t\t'data-name': name != null ? name : '' // lazy equality for null\n\t\t\t}).addClass('debug');\n\n\t\t\t// Add the wrapper (`<span>`) and word break (`<wbr>`) elements to the `parent` element.\n\t\t\tthis.parent.appendChild(this.view);\n\t\t\tthis.parent.appendChild(this.break);\n\t\t}\n\n\t\t_createClass(DebugView, [{\n\t\t\tkey: 'append',\n\t\t\tvalue: function append(el) {\n\t\t\t\tjQuery(this.view).append(el);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'modes',\n\t\t\tvalue: function modes(options) {\n\t\t\t\tvar _this4 = this;\n\n\t\t\t\tif (options == null) {\n\t\t\t\t\tvar _ret2 = function () {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tvar current = {};\n\n\t\t\t\t\t\t_this4.view.className.splitOrEmpty(/\\s+/).forEach(function (name) {\n\t\t\t\t\t\t\tif (name !== 'debug') {\n\t\t\t\t\t\t\t\tcurrent[name] = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tv: current\n\t\t\t\t\t\t};\n\t\t\t\t\t}();\n\n\t\t\t\t\tif ((typeof _ret2 === 'undefined' ? 'undefined' : _typeof(_ret2)) === \"object\") return _ret2.v;\n\t\t\t\t} else if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) === 'object') {\n\t\t\t\t\tObject.keys(options).forEach(function (name) {\n\t\t\t\t\t\tthis[options[name] ? 'addClass' : 'removeClass'](name);\n\t\t\t\t\t}, jQuery(this.view));\n\n\t\t\t\t\treturn this;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('DebugView.prototype.modes options parameter must be an object or null/undefined');\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'remove',\n\t\t\tvalue: function remove() {\n\t\t\t\tvar $view = jQuery(this.view);\n\n\t\t\t\tif (this.view.hasChildNodes()) {\n\t\t\t\t\t$view.contents().appendTo(this.parent);\n\t\t\t\t}\n\n\t\t\t\t$view.remove();\n\t\t\t\tjQuery(this.break).remove();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'output',\n\t\t\tget: function get() {\n\t\t\t\treturn this.view;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'type',\n\t\t\tget: function get() {\n\t\t\t\treturn this.view.getAttribute('data-type');\n\t\t\t},\n\t\t\tset: function set(type) {\n\t\t\t\tthis.view.setAttribute('data-type', type != null ? type : ''); // lazy equality for null\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'name',\n\t\t\tget: function get() {\n\t\t\t\treturn this.view.getAttribute('data-name');\n\t\t\t},\n\t\t\tset: function set(name) {\n\t\t\t\tthis.view.setAttribute('data-name', name != null ? name : ''); // lazy equality for null\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'title',\n\t\t\tget: function get() {\n\t\t\t\treturn this.view.title;\n\t\t\t},\n\t\t\tset: function set(title) {\n\t\t\t\tthis.view.title = title;\n\t\t\t}\n\t\t}], [{\n\t\t\tkey: 'init',\n\t\t\tvalue: function init() {\n\t\t\t\t// Inject the the debug view toggle button into the UI bar.\n\t\t\t\tjQuery('<button id=\"debug-view-toggle\">' + strings.debugView.title + '</button>').ariaClick({\n\t\t\t\t\tlabel: strings.debugView.toggle\n\t\t\t\t}, function () {\n\t\t\t\t\treturn DebugView.toggle();\n\t\t\t\t}).prependTo('#ui-bar-body');\n\n\t\t\t\t// Enable the debug view initially.\n\t\t\t\tDebugView.enable();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'enable',\n\t\t\tvalue: function enable() {\n\t\t\t\tjQuery(document.documentElement).addClass('debug-view');\n\t\t\t\tjQuery.event.trigger('tw:debugviewupdate');\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'disable',\n\t\t\tvalue: function disable() {\n\t\t\t\tjQuery(document.documentElement).removeClass('debug-view');\n\t\t\t\tjQuery.event.trigger('tw:debugviewupdate');\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'toggle',\n\t\t\tvalue: function toggle() {\n\t\t\t\tjQuery(document.documentElement).toggleClass('debug-view');\n\t\t\t\tjQuery.event.trigger('tw:debugviewupdate');\n\t\t\t}\n\t\t}]);\n\n\t\treturn DebugView;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\n\n\treturn DebugView;\n}();\n\n/***********************************************************************************************************************\n *\n * lib/keyvaluestore.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Alert, Has */\n\nvar KeyValueStore = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * _WebStorageDriver Class.\n  ******************************************************************************************************************/\n\n\tvar _WebStorageDriver = function () {\n\t\tfunction _WebStorageDriver(persist, storageId) {\n\t\t\t_classCallCheck(this, _WebStorageDriver);\n\n\t\t\tvar prefix = storageId + '.';\n\t\t\tvar engine = null,\n\t\t\t    name = null;\n\n\t\t\tif (persist) {\n\t\t\t\tif (Has.localStorage) {\n\t\t\t\t\tengine = window.localStorage;\n\t\t\t\t\tname = 'localStorage';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (Has.sessionStorage) {\n\t\t\t\t\tengine = window.sessionStorage;\n\t\t\t\t\tname = 'sessionStorage';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\t_ok: {\n\t\t\t\t\tvalue: engine !== null\n\t\t\t\t},\n\n\t\t\t\t_engine: {\n\t\t\t\t\tvalue: engine\n\t\t\t\t},\n\n\t\t\t\t_prefix: {\n\t\t\t\t\tvalue: prefix\n\t\t\t\t},\n\n\t\t\t\t_prefixRe: {\n\t\t\t\t\tvalue: new RegExp('^' + RegExp.escape(prefix))\n\t\t\t\t},\n\n\t\t\t\tname: {\n\t\t\t\t\tvalue: name\n\t\t\t\t},\n\n\t\t\t\tid: {\n\t\t\t\t\tvalue: storageId\n\t\t\t\t},\n\n\t\t\t\tpersist: {\n\t\t\t\t\tvalue: !!persist\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t_createClass(_WebStorageDriver, [{\n\t\t\tkey: 'keys',\n\t\t\tvalue: function keys() {\n\t\t\t\tif (this._engine === null) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tvar keys = [];\n\n\t\t\t\tfor (var i = 0; i < this._engine.length; ++i) {\n\t\t\t\t\tvar key = this._engine.key(i);\n\n\t\t\t\t\tif (this._prefixRe.test(key)) {\n\t\t\t\t\t\tkeys.push(key.replace(this._prefixRe, ''));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn keys;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'has',\n\t\t\tvalue: function has(key) {\n\t\t\t\tif (this._engine === null || !key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Ideally, we really should be checking keys here.\n\t\t\t\treturn this._engine.getItem(this._prefix + key) != null; // lazy equality for null\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'get',\n\t\t\tvalue: function get(key) {\n\t\t\t\tif (this._engine === null || !key) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn this._engine.getItem(this._prefix + key);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'set',\n\t\t\tvalue: function set(key, value) {\n\t\t\t\tif (this._engine === null || !key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tthis._engine.setItem(this._prefix + key, value);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t/*\n     \tMassage the quota exceeded error—the most likely error—into something\n     \ta bit nicer for the player.\n     \t\tIdeally, we could simply do:\n     \t\te.code === 22\n     \tOr, preferably, something like:\n     \t\te.code === DOMException.QUOTA_EXCEEDED_ERR\n     \tHowever, both of those are browser convention, not part of the standard,\n     \tand are not supported in all browsers.  So, we have to resort to pattern\n     \tmatching the damn name.  I hate the parties responsible for this snafu\n     \tso much.\n     */\n\t\t\t\t\tif (/quota_?(?:exceeded|reached)/i.test(e.name)) {\n\t\t\t\t\t\te.message = this.name + ' quota exceeded';\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'delete',\n\t\t\tvalue: function _delete(key) {\n\t\t\t\tif (this._engine === null || !key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis._engine.removeItem(this._prefix + key);\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'serialize',\n\t\t\tvalue: function serialize(obj) {\n\t\t\t\treturn LZString.compressToUTF16(JSON.stringify(obj));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'deserialize',\n\t\t\tvalue: function deserialize(str) {\n\t\t\t\treturn JSON.parse(LZString.decompressFromUTF16(str));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'length',\n\t\t\tget: function get() {\n\t\t\t\t/*\n    \tDO NOT do something like `return this._engine.length;` as that will return\n    \tthe length of the entire store, rather than just our prefixed keys.\n    */\n\t\t\t\treturn this.keys().length;\n\t\t\t}\n\t\t}]);\n\n\t\treturn _WebStorageDriver;\n\t}();\n\n\t/*******************************************************************************************************************\n  * _CookieDriver Class.\n  ******************************************************************************************************************/\n\n\n\tvar _CookieDriver = function () {\n\t\tfunction _CookieDriver(persist, storageId) {\n\t\t\t_classCallCheck(this, _CookieDriver);\n\n\t\t\tvar prefix = storageId + '.';\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\t_ok: {\n\t\t\t\t\tvalue: 'cookie' in document // should really try to test cookie functionality\n\t\t\t\t},\n\n\t\t\t\t_prefix: {\n\t\t\t\t\tvalue: prefix\n\t\t\t\t},\n\n\t\t\t\t_prefixRe: {\n\t\t\t\t\tvalue: new RegExp('^' + RegExp.escape(prefix))\n\t\t\t\t},\n\n\t\t\t\tname: {\n\t\t\t\t\tvalue: 'cookie'\n\t\t\t\t},\n\n\t\t\t\tid: {\n\t\t\t\t\tvalue: storageId\n\t\t\t\t},\n\n\t\t\t\tpersist: {\n\t\t\t\t\tvalue: !!persist\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t_createClass(_CookieDriver, [{\n\t\t\tkey: 'keys',\n\t\t\tvalue: function keys() {\n\t\t\t\treturn Object.keys(this._getCookies());\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'has',\n\t\t\tvalue: function has(key) {\n\t\t\t\tif (!key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn this._getCookies().hasOwnProperty(this._prefix + key);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'get',\n\t\t\tvalue: function get(key) {\n\t\t\t\tif (!key) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tvar cookies = this._getCookies(),\n\t\t\t\t    pKey = this._prefix + key;\n\n\t\t\t\tif (cookies.hasOwnProperty(pKey)) {\n\t\t\t\t\treturn cookies[pKey];\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'set',\n\t\t\tvalue: function set(key, value) {\n\t\t\t\tif (!key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\t// Undefined expiry means a session cookie.\n\t\t\t\t\tthis._setCookie(key, value, this.persist ? 'Tue, 19 Jan 2038 03:14:07 GMT' : undefined);\n\t\t\t\t} catch (e) {\n\t\t\t\t\te.message = 'cookie error: ' + e.message;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\tif (!this.has(key)) {\n\t\t\t\t\tthrow new Error('unknown cookie error');\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'delete',\n\t\t\tvalue: function _delete(key) {\n\t\t\t\tif (!key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tthis._setCookie(key, undefined, 'Thu, 01 Jan 1970 00:00:00 GMT');\n\t\t\t\t} catch (e) {\n\t\t\t\t\te.message = 'cookie error: ' + e.message;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\t// It seems like we cannot simply use `.has()` here for validation because of IE shenanigans?\n\t\t\t\t// if (this.has(key)) {\n\t\t\t\tvar test = this.get(key);\n\t\t\t\tif (test !== null && test !== '') {\n\t\t\t\t\tthrow new Error('unknown cookie error');\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'serialize',\n\t\t\tvalue: function serialize(obj) {\n\t\t\t\treturn LZString.compressToBase64(JSON.stringify(obj));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'deserialize',\n\t\t\tvalue: function deserialize(str) {\n\t\t\t\treturn JSON.parse(LZString.decompressFromBase64(str));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_getCookies',\n\t\t\tvalue: function _getCookies() {\n\t\t\t\tvar cookieObj = {};\n\n\t\t\t\tif ('cookie' in document && document.cookie !== '') {\n\t\t\t\t\tvar cookies = document.cookie.split(/;\\s*/);\n\n\t\t\t\t\tfor (var i = 0; i < cookies.length; ++i) {\n\t\t\t\t\t\tvar kv = cookies[i].split('='),\n\t\t\t\t\t\t    key = decodeURIComponent(kv[0]);\n\n\t\t\t\t\t\tif (this._prefixRe.test(key)) {\n\t\t\t\t\t\t\tcookieObj[key] = decodeURIComponent(kv[1]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn cookieObj;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_setCookie',\n\t\t\tvalue: function _setCookie(key, value, expiry) {\n\t\t\t\tif ('cookie' in document) {\n\t\t\t\t\tvar payload = encodeURIComponent(this._prefix + key) + '=';\n\n\t\t\t\t\tif (value != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tpayload += encodeURIComponent(value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (expiry != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tpayload += '; ' + expiry;\n\t\t\t\t\t}\n\n\t\t\t\t\tpayload += '; path=/';\n\t\t\t\t\tdocument.cookie = payload;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'length',\n\t\t\tget: function get() {\n\t\t\t\treturn this.keys().length;\n\t\t\t}\n\t\t}]);\n\n\t\treturn _CookieDriver;\n\t}();\n\n\t/*******************************************************************************************************************\n  * KeyValueStore Class.\n  ******************************************************************************************************************/\n\n\n\tvar KeyValueStore = function () {\n\t\tfunction KeyValueStore(driverType, persist, storageId) {\n\t\t\t_classCallCheck(this, KeyValueStore);\n\n\t\t\tvar driver = null;\n\n\t\t\tswitch (driverType) {\n\t\t\t\tcase 'cookie':\n\t\t\t\t\tdriver = new _CookieDriver(persist, storageId);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'webStorage':\n\t\t\t\t\tdriver = new _WebStorageDriver(persist, storageId);\n\n\t\t\t\t\tif (!driver._ok) {\n\t\t\t\t\t\t// Fallback to cookies.  Perhaps, this should be handled externally?\n\t\t\t\t\t\tdriver = new _CookieDriver(persist, storageId);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('unknown driver type');\n\t\t\t}\n\n\t\t\tif (!driver._ok) {\n\t\t\t\tthrow new Error('unknown driver error');\n\t\t\t}\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\t_driver: {\n\t\t\t\t\tvalue: driver\n\t\t\t\t},\n\n\t\t\t\tname: {\n\t\t\t\t\tvalue: driver.name\n\t\t\t\t},\n\n\t\t\t\ttype: {\n\t\t\t\t\tvalue: driverType\n\t\t\t\t},\n\n\t\t\t\tid: {\n\t\t\t\t\tvalue: storageId\n\t\t\t\t},\n\n\t\t\t\tpersist: {\n\t\t\t\t\tvalue: persist\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t_createClass(KeyValueStore, [{\n\t\t\tkey: 'keys',\n\t\t\tvalue: function keys() {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<KeyValueStore>.keys()]');\n\t\t\t\t}\n\n\t\t\t\tif (this._driver === null) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\treturn this._driver.keys();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'clear',\n\t\t\tvalue: function clear() {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<KeyValueStore>.clear()]');\n\t\t\t\t}\n\n\t\t\t\tif (this._driver === null) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar keys = this.keys();\n\n\t\t\t\tfor (var i = 0; i < keys.length; ++i) {\n\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\tconsole.log('\\tdeleting key:', keys[i]);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.delete(keys[i]);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'has',\n\t\t\tvalue: function has(key, quiet) {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<KeyValueStore>.has(key: \"' + key + '\", quiet: \"' + quiet + '\")]');\n\t\t\t\t}\n\n\t\t\t\tif (this._driver === null || !key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\treturn this._driver.has(key);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (!quiet) {\n\t\t\t\t\t\tAlert.error(null, 'unable to check key \"' + key + '\"; ' + e.message, e);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'get',\n\t\t\tvalue: function get(key, quiet) {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<KeyValueStore>.get(key: \"' + key + '\", quiet: \"' + quiet + '\")]');\n\t\t\t\t}\n\n\t\t\t\tif (this._driver === null || !key) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar value = this._driver.get(key);\n\n\t\t\t\t\tif (value == null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this._driver.deserialize(value);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (!quiet) {\n\t\t\t\t\t\tAlert.error(null, 'unable to get key \"' + key + '\"; ' + e.message, e);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'set',\n\t\t\tvalue: function set(key, value, quiet) {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<KeyValueStore>.set(key: \"' + key + '\", value: …, quiet: \"' + quiet + '\")]');\n\t\t\t\t}\n\n\t\t\t\tif (this._driver === null || !key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\treturn this._driver.set(key, this._driver.serialize(value), quiet);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (!quiet) {\n\t\t\t\t\t\tAlert.error(null, 'unable to set key \"' + key + '\"; ' + e.message, e);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'delete',\n\t\t\tvalue: function _delete(key, quiet) {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<KeyValueStore>.delete(key: \"' + key + '\", quiet: \"' + quiet + '\")]');\n\t\t\t\t}\n\n\t\t\t\tif (this._driver === null || !key) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\treturn this._driver.delete(key, quiet);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (!quiet) {\n\t\t\t\t\t\tAlert.error(null, 'unable to delete key \"' + key + '\"; ' + e.message, e);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'deleteMatching',\n\t\t\tvalue: function deleteMatching(subKey, quiet) {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<KeyValueStore>.deleteMatching(subKey: \"' + subKey + '\", quiet: \"' + quiet + '\")]');\n\t\t\t\t}\n\n\t\t\t\tif (this._driver === null || !subKey) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar keys = this.keys(),\n\t\t\t\t    re = new RegExp('^' + RegExp.escape(subKey));\n\n\t\t\t\tfor (var i = 0; i < keys.length; ++i) {\n\t\t\t\t\tif (re.test(keys[i])) {\n\t\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\t\tconsole.log('\\tdeleting key:', keys[i]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.delete(keys[i], quiet);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'length',\n\t\t\tget: function get() {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<KeyValueStore>.length]');\n\t\t\t\t}\n\n\t\t\t\tif (this._driver === null) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\treturn this._driver.length;\n\t\t\t}\n\t\t}]);\n\n\t\treturn KeyValueStore;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\n\n\treturn KeyValueStore;\n}();\n\n/***********************************************************************************************************************\n *\n * lib/prngwrapper.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\nvar PRNGWrapper = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * PRNGWrapper Class.\n  ******************************************************************************************************************/\n\n\tvar PRNGWrapper = function () {\n\t\tfunction PRNGWrapper(seed, useEntropy) {\n\t\t\t_classCallCheck(this, PRNGWrapper);\n\n\t\t\t/* eslint-disable new-cap */\n\t\t\tObject.defineProperties(this, new Math.seedrandom(seed, useEntropy, function (prng, seed) {\n\t\t\t\treturn {\n\t\t\t\t\t_prng: {\n\t\t\t\t\t\tvalue: prng\n\t\t\t\t\t},\n\n\t\t\t\t\tseed: {\n\t\t\t\t\t\t/*\n      \tTODO: Make this non-writable.\n      */\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tvalue: seed\n\t\t\t\t\t},\n\n\t\t\t\t\tpull: {\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tvalue: 0\n\t\t\t\t\t},\n\n\t\t\t\t\trandom: {\n\t\t\t\t\t\tvalue: function value() {\n\t\t\t\t\t\t\t++this.pull;\n\t\t\t\t\t\t\treturn this._prng();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}));\n\t\t\t/* eslint-enable new-cap */\n\t\t}\n\n\t\t_createClass(PRNGWrapper, null, [{\n\t\t\tkey: 'marshal',\n\t\t\tvalue: function marshal(prng) {\n\t\t\t\tif (!prng || !prng.hasOwnProperty('seed') || !prng.hasOwnProperty('pull')) {\n\t\t\t\t\tthrow new Error('PRNG is missing required data');\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tseed: prng.seed,\n\t\t\t\t\tpull: prng.pull\n\t\t\t\t};\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'unmarshal',\n\t\t\tvalue: function unmarshal(prngObj) {\n\t\t\t\tif (!prngObj || !prngObj.hasOwnProperty('seed') || !prngObj.hasOwnProperty('pull')) {\n\t\t\t\t\tthrow new Error('PRNG object is missing required data');\n\t\t\t\t}\n\n\t\t\t\t/*\n    \tCreate a new PRNG using the original seed and pull values from it until it\n    \thas reached the original pull count.\n    */\n\t\t\t\tvar prng = new PRNGWrapper(prngObj.seed, false);\n\n\t\t\t\tfor (var i = prngObj.pull; i > 0; --i) {\n\t\t\t\t\tprng.random();\n\t\t\t\t}\n\n\t\t\t\treturn prng;\n\t\t\t}\n\t\t}]);\n\n\t\treturn PRNGWrapper;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\n\n\treturn PRNGWrapper;\n}();\n\n/***********************************************************************************************************************\n *\n * lib/stylewrapper.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\nvar StyleWrapper = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * StyleWrapper Class.\n  ******************************************************************************************************************/\n\n\tvar StyleWrapper = function () {\n\t\tfunction StyleWrapper(style) {\n\t\t\t_classCallCheck(this, StyleWrapper);\n\n\t\t\tif (style == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new TypeError('StyleWrapper style parameter must be an HTMLStyleElement object');\n\t\t\t}\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tstyle: {\n\t\t\t\t\tvalue: style\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t_createClass(StyleWrapper, [{\n\t\t\tkey: 'isEmpty',\n\t\t\tvalue: function isEmpty() {\n\t\t\t\t/*\n    return this.style.styleSheet\n    \t? this.style.styleSheet.cssText === '' // for IE ≤ 10\n    \t: this.style.hasChildNodes();          // for all other browsers (incl. IE ≥ 11)\n    */\n\t\t\t\t// This should work in all supported browsers.\n\t\t\t\treturn this.style.cssRules.length === 0;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'set',\n\t\t\tvalue: function set(css) {\n\t\t\t\tthis.clear();\n\t\t\t\tthis.add(css);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'add',\n\t\t\tvalue: function add(css) {\n\t\t\t\t// For IE ≤ 10.\n\t\t\t\tif (this.style.styleSheet) {\n\t\t\t\t\tthis.style.styleSheet.cssText += css;\n\t\t\t\t}\n\n\t\t\t\t// For all other browsers (incl. IE ≥ 11).\n\t\t\t\telse {\n\t\t\t\t\t\tthis.style.appendChild(document.createTextNode(css));\n\t\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'clear',\n\t\t\tvalue: function clear() {\n\t\t\t\t// For IE ≤ 10.\n\t\t\t\tif (this.style.styleSheet) {\n\t\t\t\t\tthis.style.styleSheet.cssText = '';\n\t\t\t\t}\n\n\t\t\t\t// For all other browsers (incl. IE ≥ 11).\n\t\t\t\telse {\n\t\t\t\t\t\tjQuery(this.style).empty();\n\t\t\t\t\t}\n\t\t\t}\n\t\t}]);\n\n\t\treturn StyleWrapper;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\n\n\treturn StyleWrapper;\n}();\n\n/***********************************************************************************************************************\n *\n * config.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\nvar Config = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar Config = Object.seal({\n\t\t/*\n  \tGeneral properties.\n  */\n\t\tdebug: false,\n\t\taddVisitedLinkClass: false,\n\t\tcleanupWikifierOutput: false,\n\t\tloadDelay: 0,\n\n\t\t/*\n  \tState history properties.\n  */\n\t\thistory: Object.seal({\n\t\t\tcontrols: true,\n\t\t\tmaxStates: 100,\n\n\t\t\t// Die if deprecated `Config.history` properties are accessed.\n\t\t\tget mode() {\n\t\t\t\t_throwHistoryModeError();\n\t\t\t},\n\t\t\tset mode(_) {\n\t\t\t\t_throwHistoryModeError();\n\t\t\t},\n\t\t\tget tracking() {\n\t\t\t\t_throwHistoryTrackingError();\n\t\t\t},\n\t\t\tset tracking(_) {\n\t\t\t\t_throwHistoryTrackingError();\n\t\t\t}\n\t\t}),\n\n\t\t/*\n  \tMacros properties.\n  */\n\t\tmacros: Object.seal({\n\t\t\tifAssignmentError: true,\n\t\t\tmaxLoopIterations: 1000\n\t\t}),\n\n\t\t/*\n  \tPassages properties.\n  */\n\t\tpassages: Object.seal({\n\t\t\tdescriptions: undefined,\n\t\t\tdisplayTitles: false,\n\t\t\tstart: undefined, // set by `Story.load()`\n\t\t\ttransitionOut: undefined\n\t\t}),\n\n\t\t/*\n  \tSaves properties.\n  */\n\t\tsaves: Object.seal({\n\t\t\tautoload: undefined,\n\t\t\tautosave: undefined,\n\t\t\tid: 'untitled-story',\n\t\t\tisAllowed: undefined,\n\t\t\tonLoad: undefined,\n\t\t\tonSave: undefined,\n\t\t\tslots: 8,\n\t\t\tversion: undefined\n\t\t}),\n\n\t\t/*\n  \tUI properties.\n  */\n\t\tui: Object.seal({\n\t\t\tstowBarInitially: false,\n\t\t\tupdateStoryElements: true\n\t\t}),\n\n\t\t/*\n  \tTransition properties.\n  */\n\t\ttransitionEndEventName: function () {\n\t\t\tvar teMap = new Map([['transition', 'transitionend'], ['MSTransition', 'msTransitionEnd'], ['WebkitTransition', 'webkitTransitionEnd'], ['MozTransition', 'transitionend']]),\n\t\t\t    teKeys = [].concat(_toConsumableArray(teMap.keys())),\n\t\t\t    el = document.createElement('div');\n\n\t\t\tfor (var i = 0; i < teKeys.length; ++i) {\n\t\t\t\tif (el.style[teKeys[i]] !== undefined) {\n\t\t\t\t\treturn teMap.get(teKeys[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn '';\n\t\t}()\n\t});\n\n\tfunction _throwHistoryModeError() {\n\t\tthrow new Error('Config.history.mode has been deprecated and' + ' is no longer used by SugarCube, please remove it from your code');\n\t}\n\n\tfunction _throwHistoryTrackingError() {\n\t\tthrow new Error('Config.history.tracking has been deprecated, use Config.history.maxStates instead');\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Config;\n}();\n\n/***********************************************************************************************************************\n *\n * markup/patterns.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/*\n\tTODO: Move all markup patterns into here.\n*/\n\nvar Patterns = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar\n\t// Some versions of Safari do not handle Unicode properly.\n\t_unicodeOk = /[\\u0150\\u0170]/g.test('Ő');\n\n\t/*******************************************************************************************************************\n  * Patterns.\n  ******************************************************************************************************************/\n\tvar\n\t// whitespace patterns.\n\tspace = '[\\\\s\\\\u00A0\\\\u2028\\\\u2029]',\n\t    // Unicode space-character escapes required for IE < 11 (maybe < 10?)\n\n\t// Character patterns.\n\tanyLetter = '[0-9A-Z_a-z\\\\-\\\\u00C0-\\\\u00D6\\\\u00D8-\\\\u00DE\\\\u00DF-\\\\u00F6\\\\u00F8-\\\\u00FF' + ((_unicodeOk ? '\\\\u0150\\\\u0170\\\\u0151\\\\u0171' /* Include surrogate pairs? '\\\\uD800-\\\\uDFFF' */ : '') + ']'),\n\t    anyLetterStrict = anyLetter.replace('\\\\-', ''),\n\t    // anyLetter sans hyphens\n\n\t/*\n \tIdentifier patterns.\n \t\tThese are kludges.  Since JavaScript's RegExp syntax isn't fully Unicode-enabled,\n \tnot supporting Unicode character classes, the correct regular expression to match\n \ta valid identifier (within the scope of our needs) would be on the order of 11 kB.\n \tThat being the case, for the time being, we restrict valid TwineScript identifiers\n \tto US-ASCII.\n \t\tFIXME: Fix this to, at least, approximate the correct range.\n */\n\tidentifierFirstChar = '[$A-Z_a-z]',\n\t    identifier = identifierFirstChar + '[$0-9A-Z_a-z]*',\n\n\n\t// Variable patterns.\n\tvariableSigil = '[$_]',\n\t    variable = variableSigil + identifier,\n\n\n\t// Inline CSS pattern.\n\tinlineCss = ['(?:(' + anyLetter + '+)\\\\(([^\\\\)\\\\|\\\\n]+)\\\\):)', // [1,2]=style(value):\n\t'(?:(' + anyLetter + '+):([^;\\\\|\\\\n]+);)', // [3,4]=style:value;\n\t'(?:((?:\\\\.' + anyLetter + '+)+);)', // [5]  =.className;\n\t'(?:((?:#' + anyLetter + '+)+);)' // [6]  =#id;\n\t].join('|'),\n\n\n\t// URL pattern.\n\turl = '(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\\\s\\'\"]+(?:/|\\\\b)';\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze({\n\t\tspace: space,\n\t\tanyLetter: anyLetter,\n\t\tanyLetterStrict: anyLetterStrict,\n\t\tidentifierFirstChar: identifierFirstChar,\n\t\tidentifier: identifier,\n\t\tvariableSigil: variableSigil,\n\t\tvariable: variable,\n\t\tinlineCss: inlineCss,\n\t\turl: url\n\t});\n}();\n\n/***********************************************************************************************************************\n *\n * markup/scripting.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Engine, Patterns, State, Story */\n\nvar Scripting = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\t/* eslint-disable no-unused-vars */\n\n\t/*******************************************************************************************************************\n  * Deprecated Legacy Functions.\n  ******************************************************************************************************************/\n\t/*\n \t[DEPRECATED] Returns the jQuery-wrapped target element(s) after making them accessible\n \tclickables (ARIA compatibility).\n \t\tn.b. Unused, included only for compatibility.\n */\n\n\tfunction addAccessibleClickHandler(targets, selector, handler, one, namespace) {\n\t\tif (arguments.length < 2) {\n\t\t\tthrow new Error('addAccessibleClickHandler insufficient number of parameters');\n\t\t}\n\n\t\tvar fn = void 0,\n\t\t    opts = void 0;\n\n\t\tif (typeof selector === 'function') {\n\t\t\tfn = selector;\n\t\t\topts = {\n\t\t\t\tnamespace: one,\n\t\t\t\tone: !!handler\n\t\t\t};\n\t\t} else {\n\t\t\tfn = handler;\n\t\t\topts = {\n\t\t\t\tnamespace: namespace,\n\t\t\t\tone: !!one,\n\t\t\t\tselector: selector\n\t\t\t};\n\t\t}\n\n\t\tif (typeof fn !== 'function') {\n\t\t\tthrow new TypeError('addAccessibleClickHandler handler parameter must be a function');\n\t\t}\n\n\t\treturn jQuery(targets).ariaClick(opts, fn);\n\t}\n\n\t/*\n \t[DEPRECATED] Returns a new DOM element, optionally appending it to the passed DOM element, if any.\n \t\tn.b. Unused, included only for compatibility.\n */\n\tfunction insertElement(place, type, id, classNames, text, title) {\n\t\tvar $el = jQuery(document.createElement(type));\n\n\t\t// Add attributes/properties.\n\t\tif (id) {\n\t\t\t$el.attr('id', id);\n\t\t}\n\n\t\tif (classNames) {\n\t\t\t$el.addClass(classNames);\n\t\t}\n\n\t\tif (title) {\n\t\t\t$el.attr('title', title);\n\t\t}\n\n\t\t// Add text content.\n\t\tif (text) {\n\t\t\t$el.text(text);\n\t\t}\n\n\t\t// Append it to the given node.\n\t\tif (place) {\n\t\t\t$el.appendTo(place);\n\t\t}\n\n\t\treturn $el[0];\n\t}\n\n\t/*\n \t[DEPRECATED] Creates a new text node and appends it to the passed DOM element.\n \t\tn.b. Unused, included only for compatibility.\n */\n\tfunction insertText(place, text) {\n\t\tjQuery(place).append(document.createTextNode(text));\n\t}\n\n\t/*\n \t[DEPRECATED] Removes all children from the passed DOM node.\n \t\tn.b. Unused, included only for compatibility.\n */\n\tfunction removeChildren(node) {\n\t\tjQuery(node).empty();\n\t}\n\n\t/*\n \t[DEPRECATED] Removes the passed DOM node.\n \t\tn.b. Unused, included only for compatibility.\n */\n\tfunction removeElement(node) {\n\t\tjQuery(node).remove();\n\t}\n\n\t/*\n \t[DEPRECATED] Fades a DOM element in or out.\n \t\tn.b. Unused, included only for compatibility.\n */\n\tfunction fade(el, options) {\n\t\t/* eslint-disable no-param-reassign */\n\t\tvar direction = options.fade === 'in' ? 1 : -1;\n\t\tvar current = void 0,\n\t\t    proxy = el.cloneNode(true),\n\t\t    intervalId = void 0;\n\n\t\tfunction tick() {\n\t\t\tcurrent += 0.05 * direction;\n\t\t\tsetOpacity(proxy, Math.easeInOut(current));\n\n\t\t\tif (direction === 1 && current >= 1 || direction === -1 && current <= 0) {\n\t\t\t\tel.style.visibility = options.fade === 'in' ? 'visible' : 'hidden';\n\t\t\t\tproxy.parentNode.replaceChild(el, proxy);\n\t\t\t\tproxy = null;\n\t\t\t\twindow.clearInterval(intervalId);\n\n\t\t\t\tif (options.onComplete) {\n\t\t\t\t\toptions.onComplete();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction setOpacity(el, opacity) {\n\t\t\t// Old IE.\n\t\t\tel.style.zoom = 1;\n\t\t\tel.style.filter = 'alpha(opacity=' + Math.floor(opacity * 100) + ')';\n\n\t\t\t// CSS.\n\t\t\tel.style.opacity = opacity;\n\t\t}\n\n\t\tel.parentNode.replaceChild(proxy, el);\n\n\t\tif (options.fade === 'in') {\n\t\t\tcurrent = 0;\n\t\t\tproxy.style.visibility = 'visible';\n\t\t} else {\n\t\t\tcurrent = 1;\n\t\t}\n\n\t\tsetOpacity(proxy, current);\n\t\tintervalId = window.setInterval(tick, 25);\n\t\t/* eslint-enable no-param-reassign */\n\t}\n\n\t/*\n \t[DEPRECATED] Scrolls the browser window to ensure that a DOM element is in view.\n \t\tn.b. Unused, included only for compatibility.\n */\n\tfunction scrollWindowTo(el, incrementBy) {\n\t\t/* eslint-disable no-param-reassign */\n\t\tvar increment = incrementBy != null ? Number(incrementBy) : 0.1; // lazy equality for null\n\n\t\tif (isNaN(increment) || !isFinite(increment) || increment < 0) {\n\t\t\tincrement = 0.1;\n\t\t} else if (increment > 1) {\n\t\t\tincrement = 1;\n\t\t}\n\n\t\tvar start = window.scrollY ? window.scrollY : document.body.scrollTop,\n\t\t    end = ensureVisible(el),\n\t\t    distance = Math.abs(start - end),\n\t\t    direction = start > end ? -1 : 1;\n\t\tvar progress = 0,\n\t\t    intervalId = void 0;\n\n\t\tfunction tick() {\n\t\t\tprogress += increment;\n\t\t\twindow.scroll(0, start + direction * (distance * Math.easeInOut(progress)));\n\n\t\t\tif (progress >= 1) {\n\t\t\t\twindow.clearInterval(intervalId);\n\t\t\t}\n\t\t}\n\n\t\tfunction findPosY(el) {\n\t\t\t// eslint-disable-line no-shadow\n\t\t\tvar curtop = 0;\n\n\t\t\twhile (el.offsetParent) {\n\t\t\t\tcurtop += el.offsetTop;\n\t\t\t\tel = el.offsetParent;\n\t\t\t}\n\n\t\t\treturn curtop;\n\t\t}\n\n\t\tfunction ensureVisible(el) {\n\t\t\t// eslint-disable-line no-shadow\n\t\t\tvar posTop = findPosY(el),\n\t\t\t    posBottom = posTop + el.offsetHeight,\n\t\t\t    winTop = window.scrollY ? window.scrollY : document.body.scrollTop,\n\t\t\t    winHeight = window.innerHeight ? window.innerHeight : document.body.clientHeight,\n\t\t\t    winBottom = winTop + winHeight;\n\n\t\t\tif (posTop < winTop) {\n\t\t\t\treturn posTop;\n\t\t\t} else {\n\t\t\t\tif (posBottom > winBottom) {\n\t\t\t\t\tif (el.offsetHeight < winHeight) {\n\t\t\t\t\t\treturn posTop - (winHeight - el.offsetHeight) + 20;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn posTop;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn posTop;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tintervalId = window.setInterval(tick, 25);\n\t\t/* eslint-enable no-param-reassign */\n\t}\n\n\t/*******************************************************************************************************************\n  * User Functions.\n  ******************************************************************************************************************/\n\t/**\n \tReturns a random value from its given arguments.\n **/\n\tfunction either() /* variadic */{\n\t\tif (arguments.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Array.prototype.concat.apply([], arguments).random();\n\t}\n\n\t/**\n \tReturns whether a passage with the given title exists within the story\n \thistory.  If multiple passage titles are given, returns the logical-AND\n \taggregate of the set.\n **/\n\tfunction hasVisited() /* variadic */{\n\t\tif (arguments.length === 0) {\n\t\t\tthrow new Error('hasVisited called with insufficient parameters');\n\t\t}\n\t\tif (State.isEmpty()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar needles = Array.prototype.concat.apply([], arguments),\n\t\t    played = State.passages;\n\n\t\tfor (var i = 0, iend = needles.length; i < iend; ++i) {\n\t\t\tif (!played.includes(needles[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n \tReturns the number of turns that have passed since the last instance of the given passage\n \toccurred within the story history or `-1` if it does not exist.  If multiple passages are\n \tgiven, returns the lowest count (which can be `-1`).\n **/\n\tfunction lastVisited() /* variadic */{\n\t\tif (arguments.length === 0) {\n\t\t\tthrow new Error('lastVisited called with insufficient parameters');\n\t\t}\n\t\tif (State.isEmpty()) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tvar needles = Array.prototype.concat.apply([], arguments),\n\t\t    played = State.passages,\n\t\t    uBound = played.length - 1;\n\t\tvar turns = State.turns;\n\n\t\tfor (var i = 0, iend = needles.length; i < iend && turns > -1; ++i) {\n\t\t\tvar lastIndex = played.lastIndexOf(needles[i]);\n\t\t\tturns = Math.min(turns, lastIndex === -1 ? -1 : uBound - lastIndex);\n\t\t}\n\n\t\treturn turns;\n\t}\n\n\t/**\n \tReturns the title of the current passage.\n **/\n\tfunction passage() {\n\t\treturn State.passage;\n\t}\n\n\t/**\n \tReturns the title of a previous passage, either the most recent one whose title does not\n \tmatch that of the active passage or the one at the optional offset, or an empty string,\n \tif there is no such passage.\n **/\n\tfunction previous() /* legacy: offset */{\n\t\tvar passages = State.passages;\n\n\t\t/* legacy: behavior with an offset */\n\t\tif (arguments.length > 0) {\n\t\t\tvar offset = Number(arguments[0]);\n\n\t\t\tif (isNaN(offset) || !isFinite(offset) || offset < 1) {\n\t\t\t\tthrow new RangeError('previous offset parameter must be a positive integer greater than zero');\n\t\t\t}\n\n\t\t\treturn passages.length > offset ? passages[passages.length - 1 - offset] : '';\n\t\t}\n\t\t/* /legacy */\n\n\t\tfor (var i = passages.length - 2; i >= 0; --i) {\n\t\t\tif (passages[i] !== State.passage) {\n\t\t\t\treturn passages[i];\n\t\t\t}\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t/**\n \tReturns a pseudo-random whole number (integer) within the range of the given bounds.\n **/\n\tfunction random() /* variadic(min:inclusive, max:inclusive) */{\n\t\tif (arguments.length === 0) {\n\t\t\tthrow new Error('random called with insufficient parameters');\n\t\t}\n\n\t\tvar min = void 0,\n\t\t    max = void 0;\n\n\t\tif (arguments.length === 1) {\n\t\t\tmin = 0;\n\t\t\tmax = arguments[0];\n\t\t} else {\n\t\t\tmin = arguments[0];\n\t\t\tmax = arguments[1];\n\t\t}\n\n\t\tif (min > max) {\n\t\t\tvar _ref4 = [max, min];\n\t\t\tmin = _ref4[0];\n\t\t\tmax = _ref4[1];\n\t\t}\n\n\t\treturn Math.floor(State.random() * (max - min + 1)) + min;\n\t}\n\n\t/**\n \tReturns a pseudo-random real number (floating-point) within the range of the given bounds.\n \t\tn.b. Unlike with its sibling function `random()`, the `max` parameter is exclusive, not\n \t     inclusive (i.e. the range goes to, but does not include, the given value).\n **/\n\tfunction randomFloat() /* variadic(min:inclusive, max:exclusive) */{\n\t\tif (arguments.length === 0) {\n\t\t\tthrow new Error('randomFloat called with insufficient parameters');\n\t\t}\n\n\t\tvar min = void 0,\n\t\t    max = void 0;\n\n\t\tif (arguments.length === 1) {\n\t\t\tmin = 0.0;\n\t\t\tmax = arguments[0];\n\t\t} else {\n\t\t\tmin = arguments[0];\n\t\t\tmax = arguments[1];\n\t\t}\n\n\t\tif (min > max) {\n\t\t\tvar _ref5 = [max, min];\n\t\t\tmin = _ref5[0];\n\t\t\tmax = _ref5[1];\n\t\t}\n\n\t\treturn State.random() * (max - min) + min;\n\t}\n\n\t/**\n \tReturns a new array consisting of all of the tags of the given passages.\n **/\n\tfunction tags() /* variadic */{\n\t\tif (arguments.length === 0) {\n\t\t\treturn Story.get(State.passage).tags.slice(0);\n\t\t}\n\n\t\tvar passages = Array.prototype.concat.apply([], arguments);\n\t\tvar tags = [];\n\n\t\tfor (var i = 0, iend = passages.length; i < iend; ++i) {\n\t\t\ttags = tags.concat(Story.get(passages[i]).tags);\n\t\t}\n\n\t\treturn tags;\n\t}\n\n\t/**\n \tReturns the number of milliseconds which have passed since the current passage was rendered.\n **/\n\tfunction time() {\n\t\treturn Engine.lastPlay === null ? 0 : Date.now() - Engine.lastPlay;\n\t}\n\n\t/**\n \tReturns the number of passages that the player has visited.\n \t\tn.b. Passages which were visited but have been undone (e.g. via the Backward button or\n \t     the `<<back>>` macro) are no longer part of the in-play story history and thus are\n \t     not tallied.  Passages which were visited but have expired from the story history,\n \t     on the other hand, are tallied.\n **/\n\tfunction turns() {\n\t\treturn State.turns;\n\t}\n\n\t/**\n \tReturns a reference to the current $variables store.\n **/\n\tfunction variables() {\n\t\treturn State.variables;\n\t}\n\n\t/**\n \tReturns the number of times that the passage with the given title exists within the story\n \thistory.  If multiple passage titles are given, returns the lowest count.\n **/\n\tfunction visited() /* variadic */{\n\t\tif (State.isEmpty()) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar needles = Array.prototype.concat.apply([], arguments.length === 0 ? [State.passage] : arguments),\n\t\t    played = State.passages;\n\t\tvar count = State.turns;\n\n\t\tfor (var i = 0, iend = needles.length; i < iend && count > 0; ++i) {\n\t\t\tcount = Math.min(count, played.count(needles[i]));\n\t\t}\n\n\t\treturn count;\n\t}\n\n\t/**\n \tReturns the number of passages within the story history which are tagged with all of the given tags.\n **/\n\tfunction visitedTags() /* variadic */{\n\t\tif (arguments.length === 0) {\n\t\t\tthrow new Error('visitedTags called with insufficient parameters');\n\t\t}\n\t\tif (State.isEmpty()) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar needles = Array.prototype.concat.apply([], arguments),\n\t\t    nLength = needles.length,\n\t\t    played = State.passages,\n\t\t    seen = new Map();\n\t\tvar count = 0;\n\n\t\tfor (var i = 0, iend = played.length; i < iend; ++i) {\n\t\t\tvar title = played[i];\n\n\t\t\tif (seen.has(title)) {\n\t\t\t\tif (seen.get(title)) {\n\t\t\t\t\t++count;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar _tags2 = Story.get(title).tags;\n\n\t\t\t\tif (_tags2.length > 0) {\n\t\t\t\t\tvar found = 0;\n\n\t\t\t\t\tfor (var j = 0; j < nLength; ++j) {\n\t\t\t\t\t\tif (_tags2.includes(needles[j])) {\n\t\t\t\t\t\t\t++found;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (found === nLength) {\n\t\t\t\t\t\t++count;\n\t\t\t\t\t\tseen.set(title, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tseen.set(title, false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn count;\n\t}\n\n\t/* eslint-enable no-unused-vars */\n\n\t/*******************************************************************************************************************\n  * Parsing Functions.\n  ******************************************************************************************************************/\n\t/*\n \tReturns the given string after converting all TwineScript syntactical sugars to\n \ttheir native JavaScript counterparts.\n */\n\tvar parse = function () {\n\t\tvar parseMap = Object.freeze({\n\t\t\t/* eslint-disable quote-props */\n\t\t\t// Story $variable sigil-prefix.\n\t\t\t'$': 'State.variables.',\n\t\t\t// Temporary _variable sigil-prefix.\n\t\t\t'_': 'TempVariables.',\n\t\t\t// Assignment operators.\n\t\t\t'to': '=',\n\t\t\t// Equality operators.\n\t\t\t'eq': '==',\n\t\t\t'neq': '!=',\n\t\t\t'is': '===',\n\t\t\t'isnot': '!==',\n\t\t\t// Relational operators.\n\t\t\t'gt': '>',\n\t\t\t'gte': '>=',\n\t\t\t'lt': '<',\n\t\t\t'lte': '<=',\n\t\t\t// Logical operators.\n\t\t\t'and': '&&',\n\t\t\t'or': '||',\n\t\t\t// Unary operators.\n\t\t\t'not': '!',\n\t\t\t'def': '\"undefined\" !== typeof',\n\t\t\t'ndef': '\"undefined\" === typeof'\n\t\t\t/* eslint-enable quote-props */\n\t\t}),\n\t\t    parseRe = new RegExp(['(\"\"|\\'\\')', // 1=Empty quotes\n\t\t'(\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\")', // 2=Double quoted, non-empty\n\t\t\"('(?:\\\\\\\\.|[^'\\\\\\\\])+')\", // 3=Single quoted, non-empty\n\t\t'([=+\\\\-*\\\\/%<>&\\\\|\\\\^~!?:,;\\\\(\\\\)\\\\[\\\\]{}]+)', // 4=Operator delimiters\n\t\t'([^\"\\'=+\\\\-*\\\\/%<>&\\\\|\\\\^~!?:,;\\\\(\\\\)\\\\[\\\\]{}\\\\s]+)' // 5=Barewords\n\t\t].join('|'), 'g'),\n\t\t    varTest = new RegExp('^' + Patterns.variable);\n\n\t\tfunction parse(rawCodeString) {\n\t\t\tif (parseRe.lastIndex !== 0) {\n\t\t\t\tthrow new RangeError('Scripting.parse last index is non-zero at start');\n\t\t\t}\n\n\t\t\tvar code = rawCodeString,\n\t\t\t    match = void 0;\n\n\t\t\twhile ((match = parseRe.exec(code)) !== null) {\n\t\t\t\t// no-op: Empty quotes | Double quoted | Single quoted | Operator delimiters\n\n\t\t\t\t/*\n    \tBarewords.\n    */\n\t\t\t\tif (match[5]) {\n\t\t\t\t\tvar token = match[5];\n\n\t\t\t\t\t/*\n     \tIf the token is simply a dollar-sign or underscore, then it's either\n     \tjust the raw character or, probably, a function alias, so skip it.\n     */\n\t\t\t\t\tif (token === '$' || token === '_') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t/*\n     \tIf the token is a story $variable or temporary _variable, reset it\n     \tto just its sigil—for later mapping.\n     */\n\t\t\t\t\telse if (varTest.test(token)) {\n\t\t\t\t\t\t\ttoken = token[0];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/*\n      \tIf the token is `is`, check to see if it's followed by `not`, if so,\n      \tconvert them into the `isnot` operator.\n      \t\tn.b. This is a safety feature, since `$a is not $b` probably sounds\n      \t     reasonable to most users.\n      */\n\t\t\t\t\t\telse if (token === 'is') {\n\t\t\t\t\t\t\t\tvar start = parseRe.lastIndex,\n\t\t\t\t\t\t\t\t    part = code.slice(start);\n\n\t\t\t\t\t\t\t\tif (/^\\s+not\\b/.test(part)) {\n\t\t\t\t\t\t\t\t\tcode = code.splice(start, part.search(/\\S/));\n\t\t\t\t\t\t\t\t\ttoken = 'isnot';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t/*\n     \tIf the finalized token has a mapping, replace it within the code string\n     \twith its counterpart.\n     \t\tn.b. We must use `parseMap.hasOwnProperty(token)` here, rather than simply\n     \t     using something like `parseMap[token]`, otherwise tokens which match\n     \t     properties from the prototype chain will cause shenanigans.\n     */\n\t\t\t\t\tif (parseMap.hasOwnProperty(token)) {\n\t\t\t\t\t\tcode = code.splice(match.index, // starting index\n\t\t\t\t\t\ttoken.length, // replace how many\n\t\t\t\t\t\tparseMap[token] // replacement string\n\t\t\t\t\t\t);\n\t\t\t\t\t\tparseRe.lastIndex += parseMap[token].length - token.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn code;\n\t\t}\n\n\t\treturn parse;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Eval Functions.\n  ******************************************************************************************************************/\n\t/* eslint-disable no-eval, no-extra-parens, no-unused-vars */\n\t/*\n \tEvaluates the given JavaScript code and returns the result, throwing if there were errors.\n */\n\tfunction evalJavaScript(code, output) {\n\t\treturn function (code, output) {\n\t\t\treturn eval(code);\n\t\t}.call(output ? { output: output } : null, String(code), output);\n\t}\n\n\t/*\n \tEvaluates the given TwineScript code and returns the result, throwing if there were errors.\n */\n\tfunction evalTwineScript(code, output) {\n\t\treturn function (code, output) {\n\t\t\treturn eval(code);\n\t\t}.call(output ? { output: output } : null, parse(String(code)), output);\n\t}\n\t/* eslint-enable no-eval, no-extra-parens, no-unused-vars */\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\tparse: { value: parse },\n\t\tevalJavaScript: { value: evalJavaScript },\n\t\tevalTwineScript: { value: evalTwineScript }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * markup/wikifier.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n ***********************************************************************************************************************\n *\n * Portions of this code are based on:\n * ____\n *\n * TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)\n *\n * Published under a BSD open source license\n *\n * Copyright (c) Osmosoft Limited 2005\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *\n * Redistributions of source code must retain the above copyright notice, this list\n * of conditions and the following disclaimer.\n *\n * Redistributions in binary form must reproduce the above copyright notice, this\n * list of conditions and the following disclaimer in the documentation and/or\n * other materials provided with the distribution.\n *\n * Neither the name of the Osmosoft Limited nor the names of its contributors may\n * be used to endorse or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n **********************************************************************************************************************/\n/*\n\tglobal Config, DebugView, Engine, Macro, MacroContext, Patterns, Scripting, State, Story, TempState, TempVariables,\n\t       Util, toStringOrDefault, throwError\n*/\n/* eslint \"no-param-reassign\": [ 2, { \"props\" : false } ] */\n\n/*\n\tTODO: The Wikifier, and associated code, could stand to receive a serious refactoring.\n*/\n/* eslint-disable max-len */\nvar Wikifier = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar\n\t// The Wikifier formatter object cache.\n\t_formatterCache = void 0;\n\n\t/*******************************************************************************************************************\n  * Wikifier Class.\n  ******************************************************************************************************************/\n\n\tvar Wikifier = function () {\n\t\tfunction Wikifier(destination, source) {\n\t\t\t_classCallCheck(this, Wikifier);\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\t// General Wikifier properties.\n\t\t\t\tformatter: {\n\t\t\t\t\tvalue: _formatterCache || Wikifier.compileFormatters()\n\t\t\t\t},\n\n\t\t\t\tsource: {\n\t\t\t\t\tvalue: source\n\t\t\t\t},\n\n\t\t\t\tnextMatch: {\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: 0\n\t\t\t\t},\n\n\t\t\t\toutput: {\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: null\n\t\t\t\t},\n\n\t\t\t\t// Formatter-related properties.\n\t\t\t\t_rawArgs: {\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\n\t\t\t\t_nobr: {\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: []\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// No destination specified.  Create a fragment to act as the output buffer.\n\t\t\tif (destination == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthis.output = document.createDocumentFragment();\n\t\t\t}\n\n\t\t\t// jQuery-wrapped destination.  Grab the first element.\n\t\t\telse if (destination.jquery) {\n\t\t\t\t\t// cannot use `hasOwnProperty()` here as `jquery` is from jQuery's prototype\n\t\t\t\t\tthis.output = destination[0];\n\t\t\t\t}\n\n\t\t\t\t// Normal destination.\n\t\t\t\telse {\n\t\t\t\t\t\tthis.output = destination;\n\t\t\t\t\t}\n\n\t\t\t// Wikify the source into the output buffer element.\n\t\t\tthis.subWikify(this.output);\n\t\t}\n\n\t\t_createClass(Wikifier, [{\n\t\t\tkey: 'subWikify',\n\t\t\tvalue: function subWikify(output, terminator, terminatorIgnoreCase) {\n\t\t\t\t// Cache and temporarily replace the current output buffer.\n\t\t\t\tvar oldOutput = this.output;\n\t\t\t\tthis.output = output;\n\n\t\t\t\tvar terminatorRegExp = terminator ? new RegExp('(?:' + terminator + ')', terminatorIgnoreCase ? 'gim' : 'gm') : null;\n\t\t\t\tvar terminatorMatch = void 0,\n\t\t\t\t    formatterMatch = void 0;\n\n\t\t\t\tdo {\n\t\t\t\t\t// Prepare the RegExp match positions.\n\t\t\t\t\tthis.formatter.formatterRegExp.lastIndex = this.nextMatch;\n\n\t\t\t\t\tif (terminatorRegExp) {\n\t\t\t\t\t\tterminatorRegExp.lastIndex = this.nextMatch;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get the first matches.\n\t\t\t\t\tformatterMatch = this.formatter.formatterRegExp.exec(this.source);\n\t\t\t\t\tterminatorMatch = terminatorRegExp ? terminatorRegExp.exec(this.source) : null;\n\n\t\t\t\t\t// Check for a terminator & formatter match.\n\t\t\t\t\tif (terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {\n\t\t\t\t\t\t// Output any text before the match.\n\t\t\t\t\t\tif (terminatorMatch.index > this.nextMatch) {\n\t\t\t\t\t\t\tthis.outputText(this.output, this.nextMatch, terminatorMatch.index);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Set the match parameters.\n\t\t\t\t\t\tthis.matchStart = terminatorMatch.index;\n\t\t\t\t\t\tthis.matchLength = terminatorMatch[0].length;\n\t\t\t\t\t\tthis.matchText = terminatorMatch[0];\n\t\t\t\t\t\tthis.nextMatch = terminatorRegExp.lastIndex;\n\n\t\t\t\t\t\t// Restore the output buffer and exit.\n\t\t\t\t\t\tthis.output = oldOutput;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (formatterMatch) {\n\t\t\t\t\t\t// Output any text before the match.\n\t\t\t\t\t\tif (formatterMatch.index > this.nextMatch) {\n\t\t\t\t\t\t\tthis.outputText(this.output, this.nextMatch, formatterMatch.index);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Set the match parameters.\n\t\t\t\t\t\tthis.matchStart = formatterMatch.index;\n\t\t\t\t\t\tthis.matchLength = formatterMatch[0].length;\n\t\t\t\t\t\tthis.matchText = formatterMatch[0];\n\t\t\t\t\t\tthis.nextMatch = this.formatter.formatterRegExp.lastIndex;\n\n\t\t\t\t\t\t// Figure out which formatter matched.\n\t\t\t\t\t\tvar matchingFormatter = void 0;\n\n\t\t\t\t\t\tfor (var i = 1, iend = formatterMatch.length; i < iend; ++i) {\n\t\t\t\t\t\t\tif (formatterMatch[i]) {\n\t\t\t\t\t\t\t\tmatchingFormatter = i - 1;\n\t\t\t\t\t\t\t\tbreak; // stop once we've found the matching formatter\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Call the formatter.\n\t\t\t\t\t\tthis.formatter.formatters[matchingFormatter].handler(this);\n\n\t\t\t\t\t\tif (TempState.break != null) {\n\t\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} while (terminatorMatch || formatterMatch);\n\n\t\t\t\t// Output any text after the last match.\n\t\t\t\tif (TempState.break == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tif (this.nextMatch < this.source.length) {\n\t\t\t\t\t\tthis.outputText(this.output, this.nextMatch, this.source.length);\n\t\t\t\t\t\tthis.nextMatch = this.source.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// In case of <<break>>/<<continue>>, remove the last <br>.\n\t\t\t\telse if (this.output.lastChild && this.output.lastChild.nodeType === Node.ELEMENT_NODE && this.output.lastChild.nodeName.toUpperCase() === 'BR') {\n\t\t\t\t\t\tjQuery(this.output.lastChild).remove();\n\t\t\t\t\t}\n\n\t\t\t\t// Restore the output buffer.\n\t\t\t\tthis.output = oldOutput;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'outputText',\n\t\t\tvalue: function outputText(destination, startPos, endPos) {\n\t\t\t\tjQuery(destination).append(document.createTextNode(this.source.substring(startPos, endPos)));\n\t\t\t}\n\n\t\t\t/*\n   \tMeant to be called by macros, this returns the raw, unprocessed text given to the\n   \tcurrently executing macro.\n   */\n\n\t\t}, {\n\t\t\tkey: 'rawArgs',\n\t\t\tvalue: function rawArgs() {\n\t\t\t\treturn this._rawArgs;\n\t\t\t}\n\n\t\t\t/*\n   \tMeant to be called by macros, this returns the text given to the currently executing\n   \tmacro after doing TwineScript-to-JavaScript transformations.\n   */\n\n\t\t}, {\n\t\t\tkey: 'fullArgs',\n\t\t\tvalue: function fullArgs() {\n\t\t\t\treturn Scripting.parse(this.rawArgs());\n\t\t\t}\n\n\t\t\t/*\n   \tReturns a compiled Wikifier formatter object.\n   */\n\n\t\t}], [{\n\t\t\tkey: 'compileFormatters',\n\t\t\tvalue: function compileFormatters() {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[Wikifier.compileFormatters]');\n\t\t\t\t}\n\n\t\t\t\tvar formatters = Wikifier.formatters;\n\t\t\t\t_formatterCache = {\n\t\t\t\t\tformatters: formatters,\n\t\t\t\t\tformatterRegExp: new RegExp(formatters.map(function (formatter) {\n\t\t\t\t\t\treturn '(' + formatter.match + ')';\n\t\t\t\t\t}).join('|'), 'gm')\n\t\t\t\t};\n\t\t\t\treturn _formatterCache;\n\t\t\t}\n\n\t\t\t/*\n   \tReturns the value of the given story/temporary variable.\n   */\n\n\t\t}, {\n\t\t\tkey: 'getValue',\n\t\t\tvalue: function getValue(storyVar) {\n\t\t\t\tvar varData = Wikifier.parseStoryVariable(storyVar);\n\t\t\t\tvar retVal = void 0;\n\n\t\t\t\tif (varData !== null) {\n\t\t\t\t\tretVal = varData.store;\n\n\t\t\t\t\tvar pNames = varData.names;\n\n\t\t\t\t\tfor (var i = 0, iend = pNames.length; i < iend; ++i) {\n\t\t\t\t\t\tif (typeof retVal[pNames[i]] !== 'undefined') {\n\t\t\t\t\t\t\tretVal = retVal[pNames[i]];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tretVal = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn retVal;\n\t\t\t}\n\n\t\t\t/*\n   \tSets the value of the given story/temporary variable.\n   */\n\n\t\t}, {\n\t\t\tkey: 'setValue',\n\t\t\tvalue: function setValue(storyVar, newValue) {\n\t\t\t\tvar varData = Wikifier.parseStoryVariable(storyVar);\n\n\t\t\t\tif (varData !== null) {\n\t\t\t\t\tvar pNames = varData.names,\n\t\t\t\t\t    varName = pNames.pop();\n\t\t\t\t\tvar baseObj = varData.store;\n\n\t\t\t\t\tfor (var i = 0, iend = pNames.length; i < iend; ++i) {\n\t\t\t\t\t\tif (typeof baseObj[pNames[i]] !== 'undefined') {\n\t\t\t\t\t\t\tbaseObj = baseObj[pNames[i]];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbaseObj = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (baseObj !== undefined) {\n\t\t\t\t\t\tbaseObj[varName] = newValue;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/*\n   \tReturns the property name chain of the given story/temporary variable, which may be\n   \tof arbitrary complexity.\n   */\n\n\t\t}, {\n\t\t\tkey: 'parseStoryVariable',\n\t\t\tvalue: function parseStoryVariable(varText) {\n\t\t\t\tvar retVal = {\n\t\t\t\t\tstore: varText[0] === '$' ? State.variables : TempVariables,\n\t\t\t\t\tnames: []\n\t\t\t\t};\n\t\t\t\tvar text = varText,\n\t\t\t\t    match = void 0;\n\n\t\t\t\twhile ((match = Wikifier._parseVarRegExp.exec(text)) !== null) {\n\t\t\t\t\t// Remove full match from text.\n\t\t\t\t\ttext = text.slice(match[0].length);\n\n\t\t\t\t\t// Base variable.\n\t\t\t\t\tif (match[1]) {\n\t\t\t\t\t\tretVal.names.push(match[1]);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Dot property.\n\t\t\t\t\telse if (match[2]) {\n\t\t\t\t\t\t\tretVal.names.push(match[2]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Square-bracketed property (double quoted).\n\t\t\t\t\t\telse if (match[3]) {\n\t\t\t\t\t\t\t\tretVal.names.push(match[3]);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Square-bracketed property (single quoted).\n\t\t\t\t\t\t\telse if (match[4]) {\n\t\t\t\t\t\t\t\t\tretVal.names.push(match[4]);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Square-bracketed property (embedded variable).\n\t\t\t\t\t\t\t\telse if (match[5]) {\n\t\t\t\t\t\t\t\t\t\tretVal.names.push(Wikifier.getValue(match[5]));\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Square-bracketed property (numeric index).\n\t\t\t\t\t\t\t\t\telse if (match[6]) {\n\t\t\t\t\t\t\t\t\t\t\tretVal.names.push(Number(match[6]));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn text === '' ? retVal : null;\n\t\t\t}\n\n\t\t\t/*\n   \tReturns the output generated by wikifying the given text, throwing if there were errors.\n   */\n\n\t\t}, {\n\t\t\tkey: 'wikifyEval',\n\t\t\tvalue: function wikifyEval(text) {\n\t\t\t\tvar output = document.createDocumentFragment();\n\n\t\t\t\tnew Wikifier(output, text);\n\n\t\t\t\tvar errors = output.querySelector('.error');\n\n\t\t\t\tif (errors !== null) {\n\t\t\t\t\tthrow new Error(errors.textContent.replace(/^(?:(?:Uncaught\\s+)?Error:\\s+)+/, ''));\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\t/*\n   \tCreate and return an internal link.\n   */\n\n\t\t}, {\n\t\t\tkey: 'createInternalLink',\n\t\t\tvalue: function createInternalLink(destination, passage, text, callback) {\n\t\t\t\tvar $link = jQuery(document.createElement('a'));\n\n\t\t\t\tif (passage != null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t$link.attr('data-passage', passage);\n\n\t\t\t\t\tif (Story.has(passage)) {\n\t\t\t\t\t\t$link.addClass('link-internal');\n\n\t\t\t\t\t\tif (Config.addVisitedLinkClass && State.hasPlayed(passage)) {\n\t\t\t\t\t\t\t$link.addClass('link-visited');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$link.addClass('link-broken');\n\t\t\t\t\t}\n\n\t\t\t\t\t$link.ariaClick({ one: true }, function () {\n\t\t\t\t\t\tif (typeof callback === 'function') {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tEngine.play(passage);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (text) {\n\t\t\t\t\t$link.append(document.createTextNode(text));\n\t\t\t\t}\n\n\t\t\t\tif (destination) {\n\t\t\t\t\t$link.appendTo(destination);\n\t\t\t\t}\n\n\t\t\t\t// For legacy-compatibility we must return the DOM node.\n\t\t\t\treturn $link[0];\n\t\t\t}\n\n\t\t\t/*\n   \tCreate and return an external link.\n   */\n\n\t\t}, {\n\t\t\tkey: 'createExternalLink',\n\t\t\tvalue: function createExternalLink(destination, url, text) {\n\t\t\t\tvar $link = jQuery(document.createElement('a')).attr('target', '_blank').addClass('link-external').text(text).appendTo(destination);\n\n\t\t\t\tif (url != null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t$link.attr({\n\t\t\t\t\t\thref: url,\n\t\t\t\t\t\ttabindex: 0 // for accessiblity\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// For legacy-compatibility we must return the DOM node.\n\t\t\t\treturn $link[0];\n\t\t\t}\n\n\t\t\t/*\n   \tReturns whether the given link source is external (probably).\n   */\n\n\t\t}, {\n\t\t\tkey: 'isExternalLink',\n\t\t\tvalue: function isExternalLink(link) {\n\t\t\t\tif (Story.has(link)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar urlRegExp = new RegExp('^' + Patterns.url, 'gim');\n\t\t\t\treturn urlRegExp.test(link) || /[\\.\\/\\\\#]/.test(link);\n\t\t\t}\n\t\t}]);\n\n\t\treturn Wikifier;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Additional Static Properties.\n  ******************************************************************************************************************/\n\n\n\tObject.defineProperties(Wikifier, {\n\t\t_parseVarRegExp: {\n\t\t\tvalue: new RegExp(['^(?:', Patterns.variableSigil, '(', Patterns.identifier, ')|\\\\.(', Patterns.identifier, ')|\\\\[(?:(?:\"((?:\\\\\\\\.|[^\"\\\\\\\\])+)\")|(?:\\'((?:\\\\\\\\.|[^\\'\\\\\\\\])+)\\')|(', Patterns.variableSigil, Patterns.identifierFirstChar, '.*)|(\\\\d+))\\\\])'].join(''))\n\t\t},\n\t\thelpers: { value: {} },\n\n\t\t/*\n  \tLegacy Aliases.\n  */\n\t\tparse: { value: Scripting.parse },\n\t\tevalExpression: { value: Scripting.evalTwineScript }, // See: `markup/scripting.js`.\n\t\tevalStatements: { value: Scripting.evalTwineScript }, // See: `markup/scripting.js`.\n\t\ttextPrimitives: { value: Patterns } // See: `markup/patterns.js`.\n\t});\n\n\t/*******************************************************************************************************************\n  * Helper Static Methods.\n  ******************************************************************************************************************/\n\tObject.defineProperties(Wikifier.helpers, {\n\t\t/*\n  charFormat : {\n  \tvalue(w) {\n  \t\tw.subWikify(\n  \t\t\tjQuery(document.createElement(this.element)).appendTo(w.output).get(0),\n  \t\t\tthis.terminator\n  \t\t);\n  \t}\n  },\n  */\n\n\t\t_inlineCssLookahead: {\n\t\t\tvalue: new RegExp(Patterns.inlineCss, 'gm')\n\t\t},\n\t\tinlineCss: {\n\t\t\tvalue: function value(w) {\n\t\t\t\tvar css = { classes: [], id: '', styles: {} },\n\t\t\t\t    lookahead = this._inlineCssLookahead;\n\t\t\t\tvar matched = void 0;\n\n\t\t\t\tdo {\n\t\t\t\t\tlookahead.lastIndex = w.nextMatch;\n\n\t\t\t\t\tvar match = lookahead.exec(w.source);\n\n\t\t\t\t\tmatched = match && match.index === w.nextMatch;\n\n\t\t\t\t\tif (matched) {\n\t\t\t\t\t\tif (match[1]) {\n\t\t\t\t\t\t\tcss.styles[Util.fromCssProperty(match[1])] = match[2].trim();\n\t\t\t\t\t\t} else if (match[3]) {\n\t\t\t\t\t\t\tcss.styles[Util.fromCssProperty(match[3])] = match[4].trim();\n\t\t\t\t\t\t} else if (match[5]) {\n\t\t\t\t\t\t\tcss.classes = css.classes.concat(match[5].slice(1).split(/\\./));\n\t\t\t\t\t\t} else if (match[6]) {\n\t\t\t\t\t\t\tcss.id = match[6].slice(1).split(/#/).pop();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tw.nextMatch = lookahead.lastIndex;\n\t\t\t\t\t}\n\t\t\t\t} while (matched);\n\n\t\t\t\treturn css;\n\t\t\t}\n\t\t},\n\n\t\tevalText: {\n\t\t\tvalue: function value(text) {\n\t\t\t\tvar result = void 0;\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = Scripting.evalTwineScript(text);\n\n\t\t\t\t\tif (result == null || typeof result === 'function') {\n\t\t\t\t\t\t// use lazy equality for null\n\t\t\t\t\t\tresult = text;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = String(result);\n\n\t\t\t\t\t\tif (/\\[(?:object(?:\\s+[^\\]]+)?|native\\s+code)\\]/.test(result)) {\n\t\t\t\t\t\t\tresult = text;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tresult = text;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t},\n\n\t\tevalPassageId: {\n\t\t\tvalue: function value(passage) {\n\t\t\t\tif (passage == null || Story.has(passage)) {\n\t\t\t\t\t// lazy equality for null; `0` is a valid name, so we cannot simply evaluate `passage`\n\t\t\t\t\treturn passage;\n\t\t\t\t}\n\n\t\t\t\treturn Wikifier.helpers.evalText(passage);\n\t\t\t}\n\t\t},\n\n\t\tparseSquareBracketedMarkup: {\n\t\t\t/* eslint-disable no-use-before-define, no-labels */\n\n\t\t\tvalue: function value(w) {\n\t\t\t\tfunction next() {\n\t\t\t\t\tif (pos >= w.source.length) {\n\t\t\t\t\t\treturn EOF;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn w.source[pos++];\n\t\t\t\t}\n\n\t\t\t\tfunction peek() {\n\t\t\t\t\tif (pos >= w.source.length) {\n\t\t\t\t\t\treturn EOF;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn w.source[pos];\n\t\t\t\t}\n\n\t\t\t\tfunction peekAhead(count) {\n\t\t\t\t\tif (count < 1 || pos + count >= w.source.length) {\n\t\t\t\t\t\treturn EOF;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn w.source[pos + count];\n\t\t\t\t}\n\n\t\t\t\tfunction error() /* variadic: fmt [, … ] */{\n\t\t\t\t\treturn {\n\t\t\t\t\t\terror: String.format.apply(null, arguments),\n\t\t\t\t\t\tpos: pos\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tfunction ignore() {\n\t\t\t\t\tstart = pos;\n\t\t\t\t}\n\n\t\t\t\tfunction emit(type) {\n\t\t\t\t\tvar text = w.source.slice(start, pos).trim();\n\n\t\t\t\t\tif (text === '') {\n\t\t\t\t\t\tthrow new Error('malformed wiki ' + (isLink ? 'link' : 'image') + ', empty ' + type + ' component');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type === 'link' && text[0] === '~') {\n\t\t\t\t\t\titem.forceInternal = true;\n\t\t\t\t\t\titem.link = text.slice(1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem[type] = text;\n\t\t\t\t\t}\n\n\t\t\t\t\tstart = pos;\n\t\t\t\t}\n\n\t\t\t\tfunction slurpQuote(endQuote) {\n\t\t\t\t\t++pos;\n\t\t\t\t\tloop: for (;;) {\n\t\t\t\t\t\tswitch (peek()) {\n\t\t\t\t\t\t\tcase '\\\\':\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t++pos;\n\t\t\t\t\t\t\t\t\tvar _c = peek();\n\n\t\t\t\t\t\t\t\t\tif (_c !== EOF && _c !== '\\n') {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/* falls through */\n\n\t\t\t\t\t\t\tcase EOF:\n\t\t\t\t\t\t\tcase '\\n':\n\t\t\t\t\t\t\t\treturn EOF;\n\n\t\t\t\t\t\t\tcase endQuote:\n\t\t\t\t\t\t\t\tbreak loop;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t++pos;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn pos;\n\t\t\t\t}\n\n\t\t\t\tvar EOF = -1; // end of file (string, really)\n\t\t\t\tvar item = {},\n\t\t\t\t    // scanned item object\n\t\t\t\tstart = w.matchStart,\n\t\t\t\t    // start position of a component\n\t\t\t\tpos = start + 1,\n\t\t\t\t    // current position in w.source\n\t\t\t\tdepth = void 0,\n\t\t\t\t    // current square bracket nesting depth\n\t\t\t\tcid = void 0,\n\t\t\t\t    // current component ID\n\t\t\t\tisLink = void 0,\n\t\t\t\t    // markup is a link, else image\n\t\t\t\tc = void 0;\n\n\t\t\t\t// [[text|~link][setter]]\n\t\t\t\t// [<>img[title|source][~link][setter]]\n\n\t\t\t\t// Scan left delimiter.\n\t\t\t\tc = peek();\n\n\t\t\t\tif (c === '[') {\n\t\t\t\t\t// Link.\n\t\t\t\t\tisLink = item.isLink = true;\n\t\t\t\t} else {\n\t\t\t\t\t// Image.\n\t\t\t\t\tisLink = false;\n\n\t\t\t\t\tswitch (c) {\n\t\t\t\t\t\tcase '<':\n\t\t\t\t\t\t\titem.align = 'left';\n\t\t\t\t\t\t\t++pos;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase '>':\n\t\t\t\t\t\t\titem.align = 'right';\n\t\t\t\t\t\t\t++pos;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!/^[Ii][Mm][Gg]$/.test(w.source.slice(pos, pos + 3))) {\n\t\t\t\t\t\treturn error('malformed square-bracketed wiki markup');\n\t\t\t\t\t}\n\n\t\t\t\t\tpos += 3;\n\t\t\t\t\titem.isImage = true;\n\t\t\t\t}\n\n\t\t\t\t// Scan for sections.\n\t\t\t\tif (next() !== '[') {\n\t\t\t\t\treturn error('malformed wiki {0}', isLink ? 'link' : 'image');\n\t\t\t\t}\n\n\t\t\t\tdepth = 1;\n\t\t\t\tcid = 0; // 0=title, 1=link(link)|source(image), 2=setter(link)|link(image), 3=setter(image)\n\t\t\t\tignore();\n\n\t\t\t\ttry {\n\t\t\t\t\tloop: for (;;) {\n\t\t\t\t\t\tswitch (c = peek()) {// eslint-disable-line no-extra-parens\n\t\t\t\t\t\t\tcase EOF:\n\t\t\t\t\t\t\tcase '\\n':\n\t\t\t\t\t\t\t\treturn error('unterminated wiki {0}', isLink ? 'link' : 'image');\n\n\t\t\t\t\t\t\tcase '\"':\n\t\t\t\t\t\t\t\t/*\n        \tThis is not entirely reliable within the non-setter component sections (i.e. the\n        \tsections which allow raw strings), since it's possible, however unlikely, for a raw\n        \tstring to contain unpaired double quotes.  The likelihood is low enough, however,\n        \tthat I'm deeming the risk acceptable, for now at least.\n        */\n\t\t\t\t\t\t\t\tif (slurpQuote(c) === EOF) {\n\t\t\t\t\t\t\t\t\treturn error('unterminated double quoted string in wiki {0}', isLink ? 'link' : 'image');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase \"'\":\n\t\t\t\t\t\t\t\t/*\n        \tDisallow the use of single quotes as delimiters for quoted strings within all but\n        \tthe setter component section, since it's entirely possible for raw strings to contain\n        \tunpaired single quotes.\n        */\n\t\t\t\t\t\t\t\tif (cid === 4 || cid === 3 && isLink) {\n\t\t\t\t\t\t\t\t\tif (slurpQuote(c) === EOF) {\n\t\t\t\t\t\t\t\t\t\treturn error('unterminated single quoted string in wiki {0}', isLink ? 'link' : 'image');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase '|':\n\t\t\t\t\t\t\t\t// core section pipe ('|') separator\n\t\t\t\t\t\t\t\tif (cid === 0) {\n\t\t\t\t\t\t\t\t\temit(isLink ? 'text' : 'title');\n\t\t\t\t\t\t\t\t\t++start;\n\t\t\t\t\t\t\t\t\tcid = 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase '-':\n\t\t\t\t\t\t\t\t// possible core section right arrow ('->') separator (Twine 2 extension)\n\t\t\t\t\t\t\t\tif (cid === 0 && peekAhead(1) === '>') {\n\t\t\t\t\t\t\t\t\temit(isLink ? 'text' : 'title');\n\t\t\t\t\t\t\t\t\t++pos;\n\t\t\t\t\t\t\t\t\tstart += 2;\n\t\t\t\t\t\t\t\t\tcid = 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase '<':\n\t\t\t\t\t\t\t\t// possible core section left arrow ('<-') separator (Twine 2 extension)\n\t\t\t\t\t\t\t\tif (cid === 0 && peekAhead(1) === '-') {\n\t\t\t\t\t\t\t\t\temit(isLink ? 'link' : 'source');\n\t\t\t\t\t\t\t\t\t++pos;\n\t\t\t\t\t\t\t\t\tstart += 2;\n\t\t\t\t\t\t\t\t\tcid = 2;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase '[':\n\t\t\t\t\t\t\t\tif (cid === -1) {\n\t\t\t\t\t\t\t\t\treturn error(\"unexpected left square bracket '['\");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t++depth;\n\n\t\t\t\t\t\t\t\tif (depth === 1) {\n\t\t\t\t\t\t\t\t\tignore();\n\t\t\t\t\t\t\t\t\t++start;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase ']':\n\t\t\t\t\t\t\t\t--depth;\n\n\t\t\t\t\t\t\t\tif (depth === 0) {\n\t\t\t\t\t\t\t\t\tswitch (cid) {\n\t\t\t\t\t\t\t\t\t\tcase 0: // core section (nothing emitted yet)\n\t\t\t\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\t\t\t\t// core section (already emitted link-text|image-title)\n\t\t\t\t\t\t\t\t\t\t\temit(isLink ? 'link' : 'source');\n\t\t\t\t\t\t\t\t\t\t\tcid = 3;\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\t\t\t\t// core section (already emitted link-link|image-source)\n\t\t\t\t\t\t\t\t\t\t\temit(isLink ? 'text' : 'title');\n\t\t\t\t\t\t\t\t\t\t\tcid = 3;\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\t\t\t// link-setter|image-link section\n\t\t\t\t\t\t\t\t\t\t\tif (isLink) {\n\t\t\t\t\t\t\t\t\t\t\t\temit('setter');\n\t\t\t\t\t\t\t\t\t\t\t\tcid = -1;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\temit('link');\n\t\t\t\t\t\t\t\t\t\t\t\tcid = 4;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\t\t\t\t// image-setter section\n\t\t\t\t\t\t\t\t\t\t\temit('setter');\n\t\t\t\t\t\t\t\t\t\t\tcid = -1;\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t++pos;\n\n\t\t\t\t\t\t\t\t\tif (peek() === ']') {\n\t\t\t\t\t\t\t\t\t\t++pos;\n\t\t\t\t\t\t\t\t\t\tbreak loop;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t--pos;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t++pos;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn error(e.message);\n\t\t\t\t}\n\n\t\t\t\titem.pos = pos;\n\n\t\t\t\treturn item;\n\t\t\t}\n\t\t\t/* eslint-enable no-use-before-define, no-labels */\n\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * Formatters.\n  ******************************************************************************************************************/\n\tObject.defineProperty(Wikifier, 'formatters', {\n\t\tvalue: [{\n\t\t\tname: 'macro',\n\t\t\tmatch: '<<',\n\t\t\tlookahead: /<<(\\/?[A-Za-z][^>\\s]*|[=-])(?:\\s*)((?:(?:\\\"(?:\\\\.|[^\\\"\\\\])*\\\")|(?:\\'(?:\\\\.|[^\\'\\\\])*\\')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>/gm,\n\t\t\targsPattern: ['(``)', // 1=Empty backticks\n\t\t\t'`((?:\\\\\\\\.|[^`\\\\\\\\])+)`', // 2=Backticked, non-empty\n\t\t\t'(\"\"|\\'\\')', // 3=Empty quotes\n\t\t\t'(\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\")', // 4=Double quoted, non-empty\n\t\t\t\"('(?:\\\\\\\\.|[^'\\\\\\\\])+')\", // 5=Single quoted, non-empty\n\t\t\t'(\\\\[(?:[<>]?[Ii][Mm][Gg])?\\\\[[^\\\\r\\\\n]*?\\\\]\\\\]+)', // 6=Double square-bracketed\n\t\t\t'([^`\"\\'\\\\s]+)', // 7=Barewords\n\t\t\t'(`|\"|\\')' // 8=Unterminated backticks and quotes\n\t\t\t].join('|'),\n\t\t\tworking: { source: '', name: '', arguments: '', index: 0 }, // the working parse object\n\t\t\tcontext: null, // last execution context object (top-level macros, hierarchically, have a null context)\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar matchStart = this.lookahead.lastIndex = w.matchStart;\n\n\t\t\t\tif (this.parseTag(w)) {\n\t\t\t\t\t/*\n     \tIf `parseBody()` is called below, it will modify the current working\n     \tvalues, so we must cache them now.\n     */\n\t\t\t\t\tvar nextMatch = w.nextMatch,\n\t\t\t\t\t    source = this.working.source,\n\t\t\t\t\t    name = this.working.name,\n\t\t\t\t\t    rawArgs = this.working.arguments;\n\t\t\t\t\tvar macro = void 0;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmacro = Macro.get(name);\n\n\t\t\t\t\t\tif (macro) {\n\t\t\t\t\t\t\tvar payload = null;\n\n\t\t\t\t\t\t\tif (macro.hasOwnProperty('tags')) {\n\t\t\t\t\t\t\t\tpayload = this.parseBody(w, macro);\n\n\t\t\t\t\t\t\t\tif (!payload) {\n\t\t\t\t\t\t\t\t\tw.nextMatch = nextMatch; // we must reset `w.nextMatch` here, as `parseBody()` modifies it\n\t\t\t\t\t\t\t\t\treturn throwError(w.output, 'cannot find a closing tag for macro <<' + name + '>>', w.source.slice(matchStart, w.nextMatch) + '…');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (typeof macro.handler === 'function') {\n\t\t\t\t\t\t\t\tvar args = !payload ? this.createArgs(rawArgs, macro.hasOwnProperty('skipArgs') && !!macro.skipArgs || macro.hasOwnProperty('skipArg0') && !!macro.skipArg0) : payload[0].args;\n\n\t\t\t\t\t\t\t\t/*\n        \tNew-style macros.\n        */\n\t\t\t\t\t\t\t\tif (macro.hasOwnProperty('_MACRO_API')) {\n\t\t\t\t\t\t\t\t\t/*\n         \tAdd the macro's execution context to the context chain.\n         */\n\t\t\t\t\t\t\t\t\tthis.context = new MacroContext({\n\t\t\t\t\t\t\t\t\t\tparent: this.context,\n\t\t\t\t\t\t\t\t\t\tmacro: macro,\n\t\t\t\t\t\t\t\t\t\tname: name,\n\t\t\t\t\t\t\t\t\t\targs: args,\n\t\t\t\t\t\t\t\t\t\tpayload: payload,\n\t\t\t\t\t\t\t\t\t\tparser: w,\n\t\t\t\t\t\t\t\t\t\tsource: source\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t/*\n         \tCall the handler.\n         \t\tn.b. There's no catch clause here because this try/finally exists simply\n         \t     to ensure that the execution context is properly restored in the event\n         \t     that an uncaught exception is thrown during the handler call.\n         */\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tmacro.handler.call(this.context);\n\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\tthis.context = this.context.parent;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/*\n        \tOld-style macros.\n        */\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tvar prevRawArgs = w._rawArgs;\n\t\t\t\t\t\t\t\t\t\tw._rawArgs = rawArgs; // cache the raw arguments for use by `Wikifier.rawArgs()` & `Wikifier.fullArgs()`\n\t\t\t\t\t\t\t\t\t\tmacro.handler(w.output, name, args, w, payload);\n\t\t\t\t\t\t\t\t\t\tw._rawArgs = prevRawArgs;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn throwError(w.output, 'macro <<' + name + '>> handler function ' + ('' + (macro.hasOwnProperty('handler') ? 'is not a function' : 'does not exist')), w.source.slice(matchStart, w.nextMatch));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (Macro.tags.has(name)) {\n\t\t\t\t\t\t\tvar tags = Macro.tags.get(name);\n\t\t\t\t\t\t\treturn throwError(w.output, 'child tag <<' + name + '>> was found outside of a call to its parent macro' + ((tags.length === 1 ? '' : 's') + ' <<' + tags.join('>>, <<') + '>>'), w.source.slice(matchStart, w.nextMatch));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn throwError(w.output, 'macro <<' + name + '>> does not exist', w.source.slice(matchStart, w.nextMatch));\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn throwError(w.output, 'cannot execute ' + (macro && macro.isWidget ? 'widget' : 'macro') + ' <<' + name + '>>: ' + e.message, w.source.slice(matchStart, w.nextMatch));\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tthis.working.source = '';\n\t\t\t\t\t\tthis.working.name = '';\n\t\t\t\t\t\tthis.working.arguments = '';\n\t\t\t\t\t\tthis.working.index = 0;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tw.outputText(w.output, w.matchStart, w.nextMatch);\n\t\t\t\t}\n\t\t\t},\n\t\t\tparseTag: function parseTag(w) {\n\t\t\t\tvar match = this.lookahead.exec(w.source);\n\n\t\t\t\tif (match && match.index === w.matchStart && match[1]) {\n\t\t\t\t\tw.nextMatch = this.lookahead.lastIndex;\n\n\t\t\t\t\tthis.working.source = w.source.slice(match.index, this.lookahead.lastIndex);\n\t\t\t\t\tthis.working.name = match[1];\n\t\t\t\t\tthis.working.arguments = match[2];\n\t\t\t\t\tthis.working.index = match.index;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tparseBody: function parseBody(w, macro) {\n\t\t\t\tvar openTag = this.working.name,\n\t\t\t\t    closeTag = '/' + openTag,\n\t\t\t\t    closeAlt = 'end' + openTag,\n\t\t\t\t    bodyTags = Array.isArray(macro.tags) ? macro.tags : false,\n\t\t\t\t    payload = [],\n\t\t\t\t    skipArgs = macro.hasOwnProperty('skipArgs') && macro.skipArgs,\n\t\t\t\t    skipArg0 = macro.hasOwnProperty('skipArg0') && macro.skipArg0;\n\t\t\t\tvar end = -1,\n\t\t\t\t    opened = 1,\n\t\t\t\t    curSource = this.working.source,\n\t\t\t\t    curTag = this.working.name,\n\t\t\t\t    curArgument = this.working.arguments,\n\t\t\t\t    contentStart = w.nextMatch;\n\n\t\t\t\twhile ((w.matchStart = w.source.indexOf(this.match, w.nextMatch)) !== -1) {\n\t\t\t\t\tif (!this.parseTag(w)) {\n\t\t\t\t\t\tthis.lookahead.lastIndex = w.nextMatch = w.matchStart + this.match.length;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tagSource = this.working.source,\n\t\t\t\t\t    tagName = this.working.name,\n\t\t\t\t\t    tagArgs = this.working.arguments,\n\t\t\t\t\t    tagBegin = this.working.index,\n\t\t\t\t\t    tagEnd = w.nextMatch;\n\n\t\t\t\t\tswitch (tagName) {\n\t\t\t\t\t\tcase openTag:\n\t\t\t\t\t\t\t++opened;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase closeAlt:\n\t\t\t\t\t\tcase closeTag:\n\t\t\t\t\t\t\t--opened;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tif (opened === 1 && bodyTags) {\n\t\t\t\t\t\t\t\tfor (var i = 0, iend = bodyTags.length; i < iend; ++i) {\n\t\t\t\t\t\t\t\t\tif (tagName === bodyTags[i]) {\n\t\t\t\t\t\t\t\t\t\tpayload.push({\n\t\t\t\t\t\t\t\t\t\t\tsource: curSource,\n\t\t\t\t\t\t\t\t\t\t\tname: curTag,\n\t\t\t\t\t\t\t\t\t\t\targuments: curArgument,\n\t\t\t\t\t\t\t\t\t\t\targs: this.createArgs(curArgument, skipArgs || payload.length === 0 && skipArg0),\n\t\t\t\t\t\t\t\t\t\t\tcontents: w.source.slice(contentStart, tagBegin)\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tcurSource = tagSource;\n\t\t\t\t\t\t\t\t\t\tcurTag = tagName;\n\t\t\t\t\t\t\t\t\t\tcurArgument = tagArgs;\n\t\t\t\t\t\t\t\t\t\tcontentStart = tagEnd;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (opened === 0) {\n\t\t\t\t\t\tpayload.push({\n\t\t\t\t\t\t\tsource: curSource,\n\t\t\t\t\t\t\tname: curTag,\n\t\t\t\t\t\t\targuments: curArgument,\n\t\t\t\t\t\t\targs: this.createArgs(curArgument, skipArgs || payload.length === 0 && skipArg0),\n\t\t\t\t\t\t\tcontents: w.source.slice(contentStart, tagBegin)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tend = tagEnd;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (end !== -1) {\n\t\t\t\t\tw.nextMatch = end;\n\t\t\t\t\treturn payload;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t},\n\t\t\tcreateArgs: function createArgs(rawArgsString, skipArgs) {\n\t\t\t\tvar args = skipArgs ? [] : this.parseArgs(rawArgsString);\n\n\t\t\t\t// Extend the args array with the raw and full argument strings.\n\t\t\t\tObject.defineProperties(args, {\n\t\t\t\t\traw: {\n\t\t\t\t\t\tvalue: rawArgsString\n\t\t\t\t\t},\n\t\t\t\t\tfull: {\n\t\t\t\t\t\tvalue: Scripting.parse(rawArgsString)\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn args;\n\t\t\t},\n\t\t\tparseArgs: function parseArgs(rawArgsString) {\n\t\t\t\t/*\n    \t`this.argsPattern` capture groups:\n    \t\t1=Empty backticks\n    \t\t2=Backticked, non-empty\n    \t\t3=Empty quotes\n    \t\t4=Double quoted, non-empty\n    \t\t5=Single quoted, non-empty\n    \t\t6=Double square-bracketed\n    \t\t7=Barewords\n    \t\t8=Unterminated backticks and quotes\n    */\n\t\t\t\tvar argsRe = new RegExp(this.argsPattern, 'gm'),\n\t\t\t\t    args = [],\n\t\t\t\t    varTest = new RegExp('^' + Patterns.variable);\n\t\t\t\tvar match = void 0;\n\n\t\t\t\twhile ((match = argsRe.exec(rawArgsString)) !== null) {\n\t\t\t\t\tvar arg = void 0;\n\n\t\t\t\t\t// Empty backticks.\n\t\t\t\t\tif (match[1]) {\n\t\t\t\t\t\targ = undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Backticked, non-empty.\n\t\t\t\t\telse if (match[2]) {\n\t\t\t\t\t\t\targ = match[2]; // the pattern excludes the backticks, so this is just the expression\n\n\t\t\t\t\t\t\t// Evaluate the expression.\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\targ = Scripting.evalTwineScript(arg);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tthrow new Error('unable to parse macro argument \"' + arg + '\": ' + e.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Empty quotes.\n\t\t\t\t\t\telse if (match[3]) {\n\t\t\t\t\t\t\t\targ = '';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Double quoted, non-empty.\n\t\t\t\t\t\t\telse if (match[4]) {\n\t\t\t\t\t\t\t\t\targ = match[4];\n\n\t\t\t\t\t\t\t\t\t// Evaluate the string to handle escaped characters.\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\targ = Scripting.evalJavaScript(arg);\n\t\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t\tthrow new Error('unable to parse macro argument \\'' + arg + '\\': ' + e.message);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Single quoted, non-empty.\n\t\t\t\t\t\t\t\telse if (match[5]) {\n\t\t\t\t\t\t\t\t\t\targ = match[5];\n\n\t\t\t\t\t\t\t\t\t\t// Evaluate the string to handle escaped characters.\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\targ = Scripting.evalJavaScript(arg);\n\t\t\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t\t\tthrow new Error('unable to parse macro argument \"' + arg + '\": ' + e.message);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Double square-bracketed.\n\t\t\t\t\t\t\t\t\telse if (match[6]) {\n\t\t\t\t\t\t\t\t\t\t\targ = match[6];\n\n\t\t\t\t\t\t\t\t\t\t\tvar markup = Wikifier.helpers.parseSquareBracketedMarkup({\n\t\t\t\t\t\t\t\t\t\t\t\tsource: arg,\n\t\t\t\t\t\t\t\t\t\t\t\tmatchStart: 0\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\tif (markup.hasOwnProperty('error')) {\n\t\t\t\t\t\t\t\t\t\t\t\tthrow new Error('unable to parse macro argument \"' + arg + '\": ' + markup.error);\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (markup.pos < arg.length) {\n\t\t\t\t\t\t\t\t\t\t\t\tthrow new Error('unable to parse macro argument \"' + arg + '\": unexpected character(s)' + (' \"' + arg.slice(markup.pos) + '\" (pos: ' + markup.pos + ')'));\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t// Convert to a link or image object.\n\t\t\t\t\t\t\t\t\t\t\tif (markup.isLink) {\n\t\t\t\t\t\t\t\t\t\t\t\t// .isLink, [.text], [.forceInternal], .link, [.setter]\n\t\t\t\t\t\t\t\t\t\t\t\targ = { isLink: true };\n\t\t\t\t\t\t\t\t\t\t\t\targ.count = markup.hasOwnProperty('text') ? 2 : 1;\n\t\t\t\t\t\t\t\t\t\t\t\targ.link = Wikifier.helpers.evalPassageId(markup.link);\n\t\t\t\t\t\t\t\t\t\t\t\targ.text = markup.hasOwnProperty('text') ? Wikifier.helpers.evalText(markup.text) : arg.link;\n\t\t\t\t\t\t\t\t\t\t\t\targ.external = !markup.forceInternal && Wikifier.isExternalLink(arg.link);\n\t\t\t\t\t\t\t\t\t\t\t\targ.setFn = markup.hasOwnProperty('setter') ? function (ex) {\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn Scripting.evalJavaScript(ex);\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t}(Scripting.parse(markup.setter)) : null;\n\t\t\t\t\t\t\t\t\t\t\t} else if (markup.isImage) {\n\t\t\t\t\t\t\t\t\t\t\t\t// .isImage, [.align], [.title], .source, [.forceInternal], [.link], [.setter]\n\t\t\t\t\t\t\t\t\t\t\t\targ = function (source) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar imgObj = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsource: source,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisImage: true\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Check for Twine 1.4 Base64 image passage transclusion.\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (source.slice(0, 5) !== 'data:' && Story.has(source)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar passage = Story.get(source);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (passage.tags.includes('Twine.image')) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timgObj.source = passage.text;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timgObj.passage = passage.title;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn imgObj;\n\t\t\t\t\t\t\t\t\t\t\t\t}(markup.source);\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (markup.hasOwnProperty('align')) {\n\t\t\t\t\t\t\t\t\t\t\t\t\targ.align = markup.align;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (markup.hasOwnProperty('title')) {\n\t\t\t\t\t\t\t\t\t\t\t\t\targ.title = Wikifier.helpers.evalText(markup.title);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (markup.hasOwnProperty('link')) {\n\t\t\t\t\t\t\t\t\t\t\t\t\targ.link = Wikifier.helpers.evalPassageId(markup.link);\n\t\t\t\t\t\t\t\t\t\t\t\t\targ.external = !markup.forceInternal && Wikifier.isExternalLink(arg.link);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\targ.setFn = markup.hasOwnProperty('setter') ? function (ex) {\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn Scripting.evalJavaScript(ex);\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t}(Scripting.parse(markup.setter)) : null;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// Barewords.\n\t\t\t\t\t\t\t\t\t\telse if (match[7]) {\n\t\t\t\t\t\t\t\t\t\t\t\targ = match[7];\n\n\t\t\t\t\t\t\t\t\t\t\t\t// variable, so substitute its value.\n\t\t\t\t\t\t\t\t\t\t\t\tif (varTest.test(arg)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\targ = Wikifier.getValue(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t// Settings or setup object, so try to evaluate it.\n\t\t\t\t\t\t\t\t\t\t\t\telse if (/^(?:settings|setup)[\\.\\[]/.test(arg)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\targ = Scripting.evalTwineScript(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthrow new Error('unable to parse macro argument \"' + arg + '\": ' + e.message);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// // Object or Array literal, so try to evaluate it.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// //\n\t\t\t\t\t\t\t\t\t\t\t\t\t// // n.b. Authors really shouldn't be passing object/array literals as arguments.  If they\n\t\t\t\t\t\t\t\t\t\t\t\t\t// //      want to pass a complex type, then store it in a variable and pass that instead.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// else if (/^(?:\\{.*\\}|\\[.*\\])$/.test(arg)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \t\t// The parens are to protect object literals from being confused with blocks.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \t\targ = Scripting.evalTwineScript(`(${arg})`);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \tcatch (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \t\tthrow new Error(`unable to parse macro argument \"${arg}\": ${e.message}`);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// }\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Null literal, so convert it into null.\n\t\t\t\t\t\t\t\t\t\t\t\t\telse if (arg === 'null') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\targ = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Undefined literal, so convert it into undefined.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse if (arg === 'undefined') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\targ = undefined;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Boolean true literal, so convert it into boolean true.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse if (arg === 'true') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\targ = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Boolean false literal, so convert it into boolean false.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse if (arg === 'false') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\targ = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Numeric literal, so convert it into a number.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse if (!isNaN(parseFloat(arg)) && isFinite(arg)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\targ = Number(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t// Unterminated backticks and quotes.\n\t\t\t\t\t\t\t\t\t\t\telse if (match[8]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar what = void 0;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tswitch (match[8]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase '`':\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhat = 'backtick expression';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase '\"':\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhat = 'double quoted string';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase \"'\":\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhat = 'single quoted string';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tthrow new Error('unterminated ' + what + ' in macro argument string');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\targs.push(arg);\n\t\t\t\t}\n\n\t\t\t\treturn args;\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'prettyLink',\n\t\t\tmatch: '\\\\[\\\\[[^[]',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar markup = Wikifier.helpers.parseSquareBracketedMarkup(w);\n\n\t\t\t\tif (markup.hasOwnProperty('error')) {\n\t\t\t\t\tw.outputText(w.output, w.matchStart, w.nextMatch);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tw.nextMatch = markup.pos;\n\n\t\t\t\t// text=(text), forceInternal=(~), link=link, setter=(setter)\n\t\t\t\tvar link = Wikifier.helpers.evalPassageId(markup.link),\n\t\t\t\t    text = markup.hasOwnProperty('text') ? Wikifier.helpers.evalText(markup.text) : link,\n\t\t\t\t    setFn = markup.hasOwnProperty('setter') ? function (ex) {\n\t\t\t\t\treturn function () {\n\t\t\t\t\t\treturn Scripting.evalJavaScript(ex);\n\t\t\t\t\t};\n\t\t\t\t}(Scripting.parse(markup.setter)) : null;\n\n\t\t\t\t// Debug view setup.\n\t\t\t\tvar output = (Config.debug ? new DebugView(w.output, 'wiki-link', '[[link]]', w.source.slice(w.matchStart, w.nextMatch)) : w).output;\n\n\t\t\t\tif (markup.forceInternal || !Wikifier.isExternalLink(link)) {\n\t\t\t\t\tWikifier.createInternalLink(output, link, text, setFn);\n\t\t\t\t} else {\n\t\t\t\t\tWikifier.createExternalLink(output, link, text);\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'urlLink',\n\t\t\tmatch: Patterns.url,\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tw.outputText(Wikifier.createExternalLink(w.output, w.matchText), w.matchStart, w.nextMatch);\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'image',\n\t\t\tmatch: '\\\\[[<>]?[Ii][Mm][Gg]\\\\[',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar markup = Wikifier.helpers.parseSquareBracketedMarkup(w);\n\n\t\t\t\tif (markup.hasOwnProperty('error')) {\n\t\t\t\t\tw.outputText(w.output, w.matchStart, w.nextMatch);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tw.nextMatch = markup.pos;\n\n\t\t\t\t// Debug view setup.\n\t\t\t\tvar debugView = void 0;\n\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tdebugView = new DebugView(w.output, 'wiki-image', markup.hasOwnProperty('link') ? '[img[][link]]' : '[img[]]', w.source.slice(w.matchStart, w.nextMatch));\n\t\t\t\t\tdebugView.modes({ block: true });\n\t\t\t\t}\n\n\t\t\t\t// align=(left|right), title=(title), source=source, forceInternal=(~), link=(link), setter=(setter)\n\t\t\t\tvar setFn = markup.hasOwnProperty('setter') ? function (ex) {\n\t\t\t\t\treturn function () {\n\t\t\t\t\t\treturn Scripting.evalJavaScript(ex);\n\t\t\t\t\t};\n\t\t\t\t}(Scripting.parse(markup.setter)) : null;\n\t\t\t\tvar el = (Config.debug ? debugView : w).output,\n\t\t\t\t    source = void 0;\n\n\t\t\t\tif (markup.hasOwnProperty('link')) {\n\t\t\t\t\tvar link = Wikifier.helpers.evalPassageId(markup.link);\n\n\t\t\t\t\tif (markup.forceInternal || !Wikifier.isExternalLink(link)) {\n\t\t\t\t\t\tel = Wikifier.createInternalLink(el, link, null, setFn);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tel = Wikifier.createExternalLink(el, link);\n\t\t\t\t\t}\n\n\t\t\t\t\tel.classList.add('link-image');\n\t\t\t\t}\n\n\t\t\t\tel = jQuery(document.createElement('img')).appendTo(el).get(0);\n\t\t\t\tsource = Wikifier.helpers.evalPassageId(markup.source);\n\n\t\t\t\t// Check for image passage transclusion.\n\t\t\t\tif (source.slice(0, 5) !== 'data:' && Story.has(source)) {\n\t\t\t\t\tvar passage = Story.get(source);\n\n\t\t\t\t\tif (passage.tags.includes('Twine.image')) {\n\t\t\t\t\t\tel.setAttribute('data-passage', passage.title);\n\t\t\t\t\t\tsource = passage.text;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tel.src = source;\n\n\t\t\t\tif (markup.hasOwnProperty('title')) {\n\t\t\t\t\tel.title = Wikifier.helpers.evalText(markup.title);\n\t\t\t\t}\n\n\t\t\t\tif (markup.hasOwnProperty('align')) {\n\t\t\t\t\tel.align = markup.align;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'monospacedByLine',\n\t\t\tmatch: '^\\\\{\\\\{\\\\{\\\\n',\n\t\t\tlookahead: /^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)/gm,\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tthis.lookahead.lastIndex = w.matchStart;\n\n\t\t\t\tvar match = this.lookahead.exec(w.source);\n\n\t\t\t\tif (match && match.index === w.matchStart) {\n\t\t\t\t\tjQuery(document.createElement('pre')).text(match[1]).appendTo(w.output);\n\t\t\t\t\tw.nextMatch = this.lookahead.lastIndex;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'formatByChar',\n\t\t\tmatch: \"''|//|__|\\\\^\\\\^|~~|==|\\\\{\\\\{\\\\{\",\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tswitch (w.matchText) {\n\t\t\t\t\tcase \"''\":\n\t\t\t\t\t\tw.subWikify(jQuery(document.createElement('strong')).appendTo(w.output).get(0), \"''\");\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase '//':\n\t\t\t\t\t\tw.subWikify(jQuery(document.createElement('em')).appendTo(w.output).get(0), '//');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase '__':\n\t\t\t\t\t\tw.subWikify(jQuery(document.createElement('u')).appendTo(w.output).get(0), '__');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase '^^':\n\t\t\t\t\t\tw.subWikify(jQuery(document.createElement('sup')).appendTo(w.output).get(0), '\\\\^\\\\^');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase '~~':\n\t\t\t\t\t\tw.subWikify(jQuery(document.createElement('sub')).appendTo(w.output).get(0), '~~');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase '==':\n\t\t\t\t\t\tw.subWikify(jQuery(document.createElement('s')).appendTo(w.output).get(0), '==');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase '{{{':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar lookahead = /\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}/gm;\n\n\t\t\t\t\t\t\tlookahead.lastIndex = w.matchStart;\n\n\t\t\t\t\t\t\tvar match = lookahead.exec(w.source);\n\n\t\t\t\t\t\t\tif (match && match.index === w.matchStart) {\n\t\t\t\t\t\t\t\tjQuery(document.createElement('code')).text(match[1]).appendTo(w.output);\n\t\t\t\t\t\t\t\tw.nextMatch = lookahead.lastIndex;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'customStyle',\n\t\t\tmatch: '@@',\n\t\t\tterminator: '@@',\n\t\t\tblockRegExp: /\\s*\\n/gm,\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar css = Wikifier.helpers.inlineCss(w);\n\n\t\t\t\tthis.blockRegExp.lastIndex = w.nextMatch; // must follow the call to `inlineCss()`\n\n\t\t\t\tvar blockMatch = this.blockRegExp.exec(w.source),\n\t\t\t\t    blockLevel = blockMatch && blockMatch.index === w.nextMatch,\n\t\t\t\t    $el = jQuery(document.createElement(blockLevel ? 'div' : 'span')).appendTo(w.output);\n\n\t\t\t\tif (css.classes.length === 0 && css.id === '' && Object.keys(css.styles).length === 0) {\n\t\t\t\t\t$el.addClass('marked');\n\t\t\t\t} else {\n\t\t\t\t\tcss.classes.forEach(function (className) {\n\t\t\t\t\t\treturn $el.addClass(className);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (css.id !== '') {\n\t\t\t\t\t\t$el.attr('id', css.id);\n\t\t\t\t\t}\n\n\t\t\t\t\t$el.css(css.styles);\n\t\t\t\t}\n\n\t\t\t\tif (blockLevel) {\n\t\t\t\t\t// Skip the leading and, if it exists, trailing newlines.\n\t\t\t\t\tw.nextMatch += blockMatch[0].length;\n\t\t\t\t\tw.subWikify($el[0], '\\\\n?' + this.terminator);\n\t\t\t\t} else {\n\t\t\t\t\tw.subWikify($el[0], this.terminator);\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'verbatimText',\n\t\t\tmatch: '\"{3}|<nowiki>',\n\t\t\tlookahead: /(?:\\\"{3}((?:.|\\n)*?)\\\"{3})|(?:<nowiki>((?:.|\\n)*?)<\\/nowiki>)/gm,\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tthis.lookahead.lastIndex = w.matchStart;\n\n\t\t\t\tvar match = this.lookahead.exec(w.source);\n\n\t\t\t\tif (match && match.index === w.matchStart) {\n\t\t\t\t\tjQuery(document.createElement('span')).addClass('verbatim').text(match[1] || match[2]).appendTo(w.output);\n\t\t\t\t\tw.nextMatch = this.lookahead.lastIndex;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'rule',\n\t\t\tmatch: '^----+$\\\\n?|<hr\\s*/?>\\\\n?',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tjQuery(document.createElement('hr')).appendTo(w.output);\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'emdash',\n\t\t\tmatch: '--',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tjQuery(document.createTextNode('—')).appendTo(w.output);\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'doubleDollarSign',\n\t\t\tmatch: '\\\\${2}',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tjQuery(document.createTextNode('$')).appendTo(w.output);\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'nakedVariable',\n\t\t\tmatch: [Patterns.variable, '(?:(?:\\\\.', Patterns.identifier, ')|(?:\\\\[\\\\d+\\\\])|(?:\\\\[\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\"\\\\])|(?:\\\\[\\'(?:\\\\\\\\.|[^\\'\\\\\\\\])+\\'\\\\])|(?:\\\\[', Patterns.variable, '\\\\]))*'].join(''),\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar result = toStringOrDefault(Wikifier.getValue(w.matchText), null);\n\n\t\t\t\tif (result === null) {\n\t\t\t\t\tjQuery(document.createTextNode(w.matchText)).appendTo(w.output);\n\t\t\t\t} else {\n\t\t\t\t\tnew Wikifier((Config.debug ? new DebugView(w.output, 'variable', w.matchText, w.matchText) // Debug view setup.\n\t\t\t\t\t: w).output, result);\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'heading',\n\t\t\tmatch: '^!{1,6}',\n\t\t\tterminator: '\\\\n',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar isHeading = function (nodes) {\n\t\t\t\t\tvar hasGCS = typeof window.getComputedStyle === 'function';\n\n\t\t\t\t\tfor (var i = nodes.length - 1; i >= 0; --i) {\n\t\t\t\t\t\tvar node = nodes[i];\n\n\t\t\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\t\t\tcase Node.ELEMENT_NODE:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar tagName = node.nodeName.toUpperCase();\n\n\t\t\t\t\t\t\t\t\tif (tagName === 'BR') {\n\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tvar styles = hasGCS ? window.getComputedStyle(node, null) : node.currentStyle;\n\n\t\t\t\t\t\t\t\t\tif (styles && styles.display) {\n\t\t\t\t\t\t\t\t\t\tif (styles.display === 'none') {\n\t\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn styles.display === 'block';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t/*\n         \tWebKit/Blink-based browsers do not attach any computed style\n         \tinformation to elements until they're inserted into the DOM\n         \t(and probably visible), not even the default browser styles\n         \tand any user styles.  So, we make an assumption based on the\n         \telement.\n         */\n\t\t\t\t\t\t\t\t\tswitch (tagName) {\n\t\t\t\t\t\t\t\t\t\tcase 'ADDRESS':\n\t\t\t\t\t\t\t\t\t\tcase 'ARTICLE':\n\t\t\t\t\t\t\t\t\t\tcase 'ASIDE':\n\t\t\t\t\t\t\t\t\t\tcase 'BLOCKQUOTE':\n\t\t\t\t\t\t\t\t\t\tcase 'CENTER':\n\t\t\t\t\t\t\t\t\t\tcase 'DIV':\n\t\t\t\t\t\t\t\t\t\tcase 'DL':\n\t\t\t\t\t\t\t\t\t\tcase 'FIGURE':\n\t\t\t\t\t\t\t\t\t\tcase 'FOOTER':\n\t\t\t\t\t\t\t\t\t\tcase 'FORM':\n\t\t\t\t\t\t\t\t\t\tcase 'H1':\n\t\t\t\t\t\t\t\t\t\tcase 'H2':\n\t\t\t\t\t\t\t\t\t\tcase 'H3':\n\t\t\t\t\t\t\t\t\t\tcase 'H4':\n\t\t\t\t\t\t\t\t\t\tcase 'H5':\n\t\t\t\t\t\t\t\t\t\tcase 'H6':\n\t\t\t\t\t\t\t\t\t\tcase 'HEADER':\n\t\t\t\t\t\t\t\t\t\tcase 'HR':\n\t\t\t\t\t\t\t\t\t\tcase 'MAIN':\n\t\t\t\t\t\t\t\t\t\tcase 'NAV':\n\t\t\t\t\t\t\t\t\t\tcase 'OL':\n\t\t\t\t\t\t\t\t\t\tcase 'P':\n\t\t\t\t\t\t\t\t\t\tcase 'PRE':\n\t\t\t\t\t\t\t\t\t\tcase 'SECTION':\n\t\t\t\t\t\t\t\t\t\tcase 'TABLE':\n\t\t\t\t\t\t\t\t\t\tcase 'UL':\n\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t\tcase Node.COMMENT_NODE:\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}(w.output.childNodes);\n\n\t\t\t\tif (isHeading) {\n\t\t\t\t\tw.subWikify(jQuery(document.createElement('h' + w.matchLength)).appendTo(w.output).get(0), this.terminator);\n\t\t\t\t} else {\n\t\t\t\t\tjQuery(w.output).append(document.createTextNode(w.matchText));\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'table',\n\t\t\tmatch: '^\\\\|(?:[^\\\\n]*)\\\\|(?:[fhck]?)$',\n\t\t\tlookahead: /^\\|([^\\n]*)\\|([fhck]?)$/gm,\n\t\t\trowTerminator: '\\\\|(?:[cfhk]?)$\\\\n?',\n\t\t\tcellPattern: '(?:\\\\|([^\\\\n\\\\|]*)\\\\|)|(\\\\|[cfhk]?$\\\\n?)',\n\t\t\tcellTerminator: '(?:\\\\u0020*)\\\\|',\n\t\t\trowTypes: { c: 'caption', f: 'tfoot', h: 'thead', '': 'tbody' },\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar table = jQuery(document.createElement('table')).appendTo(w.output).get(0),\n\t\t\t\t    prevColumns = [];\n\t\t\t\tvar curRowType = null,\n\t\t\t\t    $rowContainer = null,\n\t\t\t\t    rowCount = 0,\n\t\t\t\t    matched = void 0;\n\n\t\t\t\tw.nextMatch = w.matchStart;\n\n\t\t\t\tdo {\n\t\t\t\t\tthis.lookahead.lastIndex = w.nextMatch;\n\n\t\t\t\t\tvar match = this.lookahead.exec(w.source);\n\n\t\t\t\t\tmatched = match && match.index === w.nextMatch;\n\n\t\t\t\t\tif (matched) {\n\t\t\t\t\t\tvar nextRowType = match[2];\n\n\t\t\t\t\t\tif (nextRowType === 'k') {\n\t\t\t\t\t\t\ttable.className = match[1];\n\t\t\t\t\t\t\tw.nextMatch += match[0].length + 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (nextRowType !== curRowType) {\n\t\t\t\t\t\t\t\tcurRowType = nextRowType;\n\t\t\t\t\t\t\t\t$rowContainer = jQuery(document.createElement(this.rowTypes[nextRowType])).appendTo(table);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (curRowType === 'c') {\n\t\t\t\t\t\t\t\t$rowContainer.css('caption-side', rowCount === 0 ? 'top' : 'bottom');\n\t\t\t\t\t\t\t\tw.nextMatch += 1;\n\t\t\t\t\t\t\t\tw.subWikify($rowContainer[0], this.rowTerminator);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.rowHandler(w, jQuery(document.createElement('tr')).appendTo($rowContainer).get(0), prevColumns);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t++rowCount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} while (matched);\n\t\t\t},\n\t\t\trowHandler: function rowHandler(w, rowEl, prevColumns) {\n\t\t\t\tvar _this5 = this;\n\n\t\t\t\tvar cellRegExp = new RegExp(this.cellPattern, 'gm');\n\t\t\t\tvar col = 0,\n\t\t\t\t    curColCount = 1,\n\t\t\t\t    matched = void 0;\n\n\t\t\t\tdo {\n\t\t\t\t\tcellRegExp.lastIndex = w.nextMatch;\n\n\t\t\t\t\tvar cellMatch = cellRegExp.exec(w.source);\n\n\t\t\t\t\tmatched = cellMatch && cellMatch.index === w.nextMatch;\n\n\t\t\t\t\tif (matched) {\n\t\t\t\t\t\tif (cellMatch[1] === '~') {\n\t\t\t\t\t\t\tvar last = prevColumns[col];\n\n\t\t\t\t\t\t\tif (last) {\n\t\t\t\t\t\t\t\t++last.rowCount;\n\t\t\t\t\t\t\t\tlast.$element.attr('rowspan', last.rowCount).css('vertical-align', 'middle');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tw.nextMatch = cellMatch.index + cellMatch[0].length - 1;\n\t\t\t\t\t\t} else if (cellMatch[1] === '>') {\n\t\t\t\t\t\t\t++curColCount;\n\t\t\t\t\t\t\tw.nextMatch = cellMatch.index + cellMatch[0].length - 1;\n\t\t\t\t\t\t} else if (cellMatch[2]) {\n\t\t\t\t\t\t\tw.nextMatch = cellMatch.index + cellMatch[0].length;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t(function () {\n\t\t\t\t\t\t\t\t++w.nextMatch;\n\n\t\t\t\t\t\t\t\tvar css = Wikifier.helpers.inlineCss(w);\n\t\t\t\t\t\t\t\tvar spaceLeft = false,\n\t\t\t\t\t\t\t\t    spaceRight = false,\n\t\t\t\t\t\t\t\t    $cell = void 0;\n\n\t\t\t\t\t\t\t\twhile (w.source.substr(w.nextMatch, 1) === ' ') {\n\t\t\t\t\t\t\t\t\tspaceLeft = true;\n\t\t\t\t\t\t\t\t\t++w.nextMatch;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (w.source.substr(w.nextMatch, 1) === '!') {\n\t\t\t\t\t\t\t\t\t$cell = jQuery(document.createElement('th')).appendTo(rowEl);\n\t\t\t\t\t\t\t\t\t++w.nextMatch;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$cell = jQuery(document.createElement('td')).appendTo(rowEl);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tprevColumns[col] = {\n\t\t\t\t\t\t\t\t\trowCount: 1,\n\t\t\t\t\t\t\t\t\t$element: $cell\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif (curColCount > 1) {\n\t\t\t\t\t\t\t\t\t$cell.attr('colspan', curColCount);\n\t\t\t\t\t\t\t\t\tcurColCount = 1;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tw.subWikify($cell[0], _this5.cellTerminator);\n\n\t\t\t\t\t\t\t\tif (w.matchText.substr(w.matchText.length - 2, 1) === ' ') {\n\t\t\t\t\t\t\t\t\tspaceRight = true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tcss.classes.forEach(function (className) {\n\t\t\t\t\t\t\t\t\treturn $cell.addClass(className);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (css.id !== '') {\n\t\t\t\t\t\t\t\t\t$cell.attr('id', css.id);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (spaceLeft && spaceRight) {\n\t\t\t\t\t\t\t\t\tcss.styles['text-align'] = 'center';\n\t\t\t\t\t\t\t\t} else if (spaceLeft) {\n\t\t\t\t\t\t\t\t\tcss.styles['text-align'] = 'right';\n\t\t\t\t\t\t\t\t} else if (spaceRight) {\n\t\t\t\t\t\t\t\t\tcss.styles['text-align'] = 'left';\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$cell.css(css.styles);\n\n\t\t\t\t\t\t\t\tw.nextMatch = w.nextMatch - 1;\n\t\t\t\t\t\t\t})();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t++col;\n\t\t\t\t\t}\n\t\t\t\t} while (matched);\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'list',\n\t\t\tmatch: '^(?:(?:\\\\*+)|(?:#+))',\n\t\t\tlookahead: /^(?:(\\*+)|(#+))/gm,\n\t\t\tterminator: '\\\\n',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tw.nextMatch = w.matchStart;\n\n\t\t\t\tvar destStack = [w.output];\n\t\t\t\tvar curType = null,\n\t\t\t\t    curLevel = 0,\n\t\t\t\t    matched = void 0,\n\t\t\t\t    i = void 0;\n\n\t\t\t\tdo {\n\t\t\t\t\tthis.lookahead.lastIndex = w.nextMatch;\n\n\t\t\t\t\tvar match = this.lookahead.exec(w.source);\n\n\t\t\t\t\tmatched = match && match.index === w.nextMatch;\n\n\t\t\t\t\tif (matched) {\n\t\t\t\t\t\tvar newType = match[2] ? 'ol' : 'ul',\n\t\t\t\t\t\t    newLevel = match[0].length;\n\n\t\t\t\t\t\tw.nextMatch += match[0].length;\n\n\t\t\t\t\t\tif (newLevel > curLevel) {\n\t\t\t\t\t\t\tfor (i = curLevel; i < newLevel; ++i) {\n\t\t\t\t\t\t\t\tdestStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length - 1]).get(0));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (newLevel < curLevel) {\n\t\t\t\t\t\t\tfor (i = curLevel; i > newLevel; --i) {\n\t\t\t\t\t\t\t\tdestStack.pop();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (newLevel === curLevel && newType !== curType) {\n\t\t\t\t\t\t\tdestStack.pop();\n\t\t\t\t\t\t\tdestStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length - 1]).get(0));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurLevel = newLevel;\n\t\t\t\t\t\tcurType = newType;\n\t\t\t\t\t\tw.subWikify(jQuery(document.createElement('li')).appendTo(destStack[destStack.length - 1]).get(0), this.terminator);\n\t\t\t\t\t}\n\t\t\t\t} while (matched);\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'quoteByBlock',\n\t\t\tmatch: '^<<<\\\\n',\n\t\t\tterminator: '^<<<\\\\n',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tw.subWikify(jQuery(document.createElement('blockquote')).appendTo(w.output).get(0), this.terminator);\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'quoteByLine',\n\t\t\tmatch: '^>+',\n\t\t\tlookahead: /^>+/gm,\n\t\t\tterminator: '\\\\n',\n\t\t\telement: 'blockquote',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar destStack = [w.output];\n\t\t\t\tvar curLevel = 0,\n\t\t\t\t    newLevel = w.matchLength,\n\t\t\t\t    matched = void 0,\n\t\t\t\t    i = void 0;\n\n\t\t\t\tdo {\n\t\t\t\t\tif (newLevel > curLevel) {\n\t\t\t\t\t\tfor (i = curLevel; i < newLevel; ++i) {\n\t\t\t\t\t\t\tdestStack.push(jQuery(document.createElement(this.element)).appendTo(destStack[destStack.length - 1]).get(0));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (newLevel < curLevel) {\n\t\t\t\t\t\t\tfor (i = curLevel; i > newLevel; --i) {\n\t\t\t\t\t\t\t\tdestStack.pop();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tcurLevel = newLevel;\n\t\t\t\t\tw.subWikify(destStack[destStack.length - 1], this.terminator);\n\t\t\t\t\tjQuery(document.createElement('br')).appendTo(destStack[destStack.length - 1]);\n\n\t\t\t\t\tthis.lookahead.lastIndex = w.nextMatch;\n\n\t\t\t\t\tvar match = this.lookahead.exec(w.source);\n\n\t\t\t\t\tmatched = match && match.index === w.nextMatch;\n\n\t\t\t\t\tif (matched) {\n\t\t\t\t\t\tnewLevel = match[0].length;\n\t\t\t\t\t\tw.nextMatch += match[0].length;\n\t\t\t\t\t}\n\t\t\t\t} while (matched);\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'html',\n\t\t\tmatch: '<[Hh][Tt][Mm][Ll]>',\n\t\t\tlookahead: /<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)<\\/[Hh][Tt][Mm][Ll]>/gm,\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tthis.lookahead.lastIndex = w.matchStart;\n\n\t\t\t\tvar match = this.lookahead.exec(w.source);\n\n\t\t\t\tif (match && match.index === w.matchStart) {\n\t\t\t\t\tw.nextMatch = this.lookahead.lastIndex;\n\n\t\t\t\t\tjQuery(document.createDocumentFragment()).append(match[1]).appendTo(w.output);\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'commentByBlock',\n\t\t\tmatch: '(?:/(?:%|\\\\*))|(?:<!--)',\n\t\t\tlookahead: /(?:\\/(%|\\*)(?:(?:.|\\n)*?)\\1\\/)|(?:<!--(?:(?:.|\\n)*?)-->)/gm,\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tthis.lookahead.lastIndex = w.matchStart;\n\n\t\t\t\tvar match = this.lookahead.exec(w.source);\n\n\t\t\t\tif (match && match.index === w.matchStart) {\n\t\t\t\t\tw.nextMatch = this.lookahead.lastIndex;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'lineContinuation',\n\t\t\t// The end-of-line patter must come first.\n\t\t\tmatch: '\\\\\\\\' + Patterns.space + '*?(?:\\\\n|$)|(?:^|\\\\n)' + Patterns.space + '*?\\\\\\\\',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tw.nextMatch = w.matchStart + w.matchLength;\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'lineBreak',\n\t\t\tmatch: '\\\\n|<br\\s*/?>',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tif (w._nobr.length === 0 || !w._nobr[0]) {\n\t\t\t\t\tjQuery(document.createElement('br')).appendTo(w.output);\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'htmlCharacterReference',\n\t\t\tmatch: '(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)',\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tjQuery(document.createDocumentFragment()).append(w.matchText).appendTo(w.output);\n\t\t\t}\n\t\t}, { // This formatter MUST come after any formatter which handles HTML tag-like constructs (e.g. html & rawText).\n\t\t\tname: 'htmlTag',\n\t\t\tmatch: '<\\\\w+(?:\\\\s+[^\\\\u0000-\\\\u001F\\\\u007F-\\\\u009F\\\\s\"\\'>\\\\/=]+(?:\\\\s*=\\\\s*(?:\"[^\"]*?\"|\\'[^\\']*?\\'|[^\\\\s\"\\'=<>`]+))?)*\\\\s*\\\\/?>',\n\t\t\ttagPattern: '<(\\\\w+)',\n\t\t\tvoidElements: ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'keygen', 'link', 'menuitem', 'meta', 'param', 'source', 'track', 'wbr'],\n\t\t\tnobrElements: ['colgroup', 'datalist', 'dl', 'figure', 'ol', 'optgroup', 'select', 'table', 'tbody', 'tfoot', 'thead', 'tr', 'ul'],\n\n\t\t\thandler: function handler(w) {\n\t\t\t\tvar tagMatch = new RegExp(this.tagPattern).exec(w.matchText),\n\t\t\t\t    tag = tagMatch && tagMatch[1],\n\t\t\t\t    tagName = tag && tag.toLowerCase();\n\n\t\t\t\tif (tagName) {\n\t\t\t\t\tvar isVoid = this.voidElements.includes(tagName),\n\t\t\t\t\t    isNobr = this.nobrElements.includes(tagName);\n\t\t\t\t\tvar terminator = void 0,\n\t\t\t\t\t    terminatorMatch = void 0;\n\n\t\t\t\t\tif (!isVoid) {\n\t\t\t\t\t\tterminator = '<\\\\/' + tagName + '\\\\s*>';\n\n\t\t\t\t\t\tvar terminatorRegExp = new RegExp(terminator, 'gim'); // ignore case during match\n\n\t\t\t\t\t\tterminatorRegExp.lastIndex = w.matchStart;\n\t\t\t\t\t\tterminatorMatch = terminatorRegExp.exec(w.source);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isVoid || terminatorMatch) {\n\t\t\t\t\t\tvar output = w.output,\n\t\t\t\t\t\t    el = document.createElement(w.output.tagName),\n\t\t\t\t\t\t    debugView = void 0;\n\n\t\t\t\t\t\tel.innerHTML = w.matchText;\n\n\t\t\t\t\t\twhile (el.firstChild) {\n\t\t\t\t\t\t\tel = el.firstChild;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (el.hasAttribute('data-passage')) {\n\t\t\t\t\t\t\tthis.processDataAttributes(el);\n\n\t\t\t\t\t\t\t// Debug view setup.\n\t\t\t\t\t\t\tif (Config.debug) {\n\t\t\t\t\t\t\t\tdebugView = new DebugView(w.output, 'html-' + tagName, tagName, w.matchText);\n\t\t\t\t\t\t\t\tdebugView.modes({\n\t\t\t\t\t\t\t\t\tblock: tagName === 'img',\n\t\t\t\t\t\t\t\t\tnonvoid: terminatorMatch\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\toutput = debugView.output;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (terminatorMatch) {\n\t\t\t\t\t\t\tif (isNobr) {\n\t\t\t\t\t\t\t\tw._nobr.unshift(true);\n\t\t\t\t\t\t\t} else if (w._nobr.length > 0) {\n\t\t\t\t\t\t\t\tw._nobr.unshift(false);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tw.subWikify(el, terminator, true); // ignore case during match\n\n\t\t\t\t\t\t\t\t/*\n        \tDebug view modification.  If the current element has any debug\n        \tview descendants who have \"block\" mode set, then set its debug\n        \tview to the same.  It just makes things look a bit nicer.\n        */\n\t\t\t\t\t\t\t\tif (debugView && jQuery(el).find('.debug.block').length > 0) {\n\t\t\t\t\t\t\t\t\tdebugView.modes({ block: true });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tif (w._nobr.length > 0) {\n\t\t\t\t\t\t\t\t\tw._nobr.shift();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toutput.appendChild(el);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrowError(w.output, 'HTML tag \"' + tag + '\" is not closed', w.matchText + '…');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tprocessDataAttributes: function processDataAttributes(el) {\n\t\t\t\tvar passage = el.getAttribute('data-passage');\n\n\t\t\t\tif (passage == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar evaluated = Wikifier.helpers.evalPassageId(passage);\n\n\t\t\t\tif (evaluated !== passage) {\n\t\t\t\t\tpassage = evaluated;\n\t\t\t\t\tel.setAttribute('data-passage', evaluated);\n\t\t\t\t}\n\n\t\t\t\tif (passage !== '') {\n\t\t\t\t\tif (el.tagName.toUpperCase() === 'IMG') {\n\t\t\t\t\t\t// Handle image passage transclusion.\n\t\t\t\t\t\tif (passage.slice(0, 5) !== 'data:' && Story.has(passage)) {\n\t\t\t\t\t\t\tpassage = Story.get(passage);\n\t\t\t\t\t\t\tif (passage.tags.includes('Twine.image')) {\n\t\t\t\t\t\t\t\tel.src = passage.text.trim();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t(function () {\n\t\t\t\t\t\t\tvar setter = el.getAttribute('data-setter'),\n\t\t\t\t\t\t\t    setFn = void 0;\n\n\t\t\t\t\t\t\tif (setter != null) {\n\t\t\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\t\t\tsetter = String(setter).trim();\n\n\t\t\t\t\t\t\t\tif (setter !== '') {\n\t\t\t\t\t\t\t\t\tsetFn = function (ex) {\n\t\t\t\t\t\t\t\t\t\treturn function () {\n\t\t\t\t\t\t\t\t\t\t\treturn Scripting.evalJavaScript(ex);\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}(Scripting.parse(setter));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (Story.has(passage)) {\n\t\t\t\t\t\t\t\tel.classList.add('link-internal');\n\n\t\t\t\t\t\t\t\tif (Config.addVisitedLinkClass && State.hasPlayed(passage)) {\n\t\t\t\t\t\t\t\t\tel.classList.add('link-visited');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tel.classList.add('link-broken');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tjQuery(el).ariaClick({ one: true }, function () {\n\t\t\t\t\t\t\t\tif (typeof setFn === 'function') {\n\t\t\t\t\t\t\t\t\tsetFn.call(this);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tEngine.play(passage);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}]\n\t}); // End formatters\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Wikifier;\n}();\n/* eslint-enable max-len */\n\n/***********************************************************************************************************************\n *\n * macros/macro.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Scripting, clone, macros */\n\nvar Macro = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar\n\t// Macro definitions.\n\t_macros = {},\n\n\n\t// Map of all macro tags and their parents (key: 'tag name' => value: ['list of parent names']).\n\t_tags = {};\n\n\t/*******************************************************************************************************************\n  * Macros Functions.\n  ******************************************************************************************************************/\n\tfunction macrosAdd(name, def, deep) {\n\t\tif (Array.isArray(name)) {\n\t\t\tname.forEach(function (n) {\n\t\t\t\treturn macrosAdd(n, def, deep);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (macrosHas(name)) {\n\t\t\tthrow new Error('cannot clobber existing macro <<' + name + '>>');\n\t\t} else if (tagsHas(name)) {\n\t\t\tthrow new Error(String.format('cannot clobber child tag <<{0}>> of parent macro{1} <<{2}>>', name, _tags[name].length === 1 ? '' : 's', _tags[name].join('>>, <<')));\n\t\t}\n\n\t\ttry {\n\t\t\tif ((typeof def === 'undefined' ? 'undefined' : _typeof(def)) === 'object') {\n\t\t\t\t// Add the macro definition.\n\t\t\t\t_macros[name] = deep ? clone(def) : def;\n\t\t\t} else {\n\t\t\t\t// Add the macro alias.\n\t\t\t\tif (macrosHas(def)) {\n\t\t\t\t\t_macros[name] = deep ? clone(_macros[def]) : _macros[def];\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('cannot create alias of nonexistent macro <<' + def + '>>');\n\t\t\t\t}\n\t\t\t}\n\t\t\tObject.defineProperty(_macros, name, { writable: false });\n\n\t\t\t/* legacy */\n\t\t\t/*\n   \tSince `macrosGet()` may return legacy macros, we have to add a flag to (modern)\n   \tAPI macros, so that the macro formatter will know how to call the macro.\n   */\n\t\t\t_macros[name]._MACRO_API = true;\n\t\t\t/* /legacy */\n\t\t} catch (e) {\n\t\t\tif (e.name === 'TypeError') {\n\t\t\t\tthrow new Error('cannot clobber protected macro <<' + name + '>>');\n\t\t\t} else {\n\t\t\t\tthrow new Error('unknown error when attempting to add macro <<' + name + '>>: [' + e.name + '] ' + e.message);\n\t\t\t}\n\t\t}\n\n\t\t// Tags post-processing.\n\t\tif (_macros[name].hasOwnProperty('tags')) {\n\t\t\tif (_macros[name].tags == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\ttagsRegister(name);\n\t\t\t} else if (Array.isArray(_macros[name].tags)) {\n\t\t\t\ttagsRegister(name, _macros[name].tags);\n\t\t\t} else {\n\t\t\t\tthrow new Error('bad value for \"tags\" property of macro <<' + name + '>>');\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction macrosDelete(name) {\n\t\tif (Array.isArray(name)) {\n\t\t\tname.forEach(function (n) {\n\t\t\t\treturn macrosDelete(n);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (macrosHas(name)) {\n\t\t\t// Tags pre-processing.\n\t\t\tif (_macros[name].hasOwnProperty('tags')) {\n\t\t\t\ttagsUnregister(name);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Remove the macro definition.\n\t\t\t\tObject.defineProperty(_macros, name, { writable: true });\n\t\t\t\tdelete _macros[name];\n\t\t\t} catch (e) {\n\t\t\t\tthrow new Error('unknown error removing macro <<' + name + '>>: ' + e.message);\n\t\t\t}\n\t\t} else if (tagsHas(name)) {\n\t\t\tthrow new Error('cannot remove child tag <<' + name + '>> of parent macro <<' + _tags[name] + '>>');\n\t\t}\n\t}\n\n\tfunction macrosIsEmpty() {\n\t\treturn Object.keys(_macros).length === 0;\n\t}\n\n\tfunction macrosHas(name) {\n\t\treturn _macros.hasOwnProperty(name);\n\t}\n\n\tfunction macrosGet(name) {\n\t\tvar macro = null;\n\n\t\tif (macrosHas(name) && typeof _macros[name].handler === 'function') {\n\t\t\tmacro = _macros[name];\n\t\t}\n\t\t/* legacy macro support */\n\t\telse if (macros.hasOwnProperty(name) && typeof macros[name].handler === 'function') {\n\t\t\t\tmacro = macros[name];\n\t\t\t}\n\t\t/* /legacy macro support */\n\n\t\treturn macro;\n\t}\n\n\tfunction macrosInit() {\n\t\tvar handler = arguments.length <= 0 || arguments[0] === undefined ? 'init' : arguments[0];\n\t\t// eslint-disable-line no-unused-vars\n\t\tObject.keys(_macros).forEach(function (name) {\n\t\t\tif (typeof _macros[name][handler] === 'function') {\n\t\t\t\t_macros[name][handler].call(_macros[name], name);\n\t\t\t}\n\t\t});\n\n\t\t/* legacy macro support */\n\t\tObject.keys(macros).forEach(function (name) {\n\t\t\tif (typeof macros[name][handler] === 'function') {\n\t\t\t\tmacros[name][handler].call(macros[name], name);\n\t\t\t}\n\t\t});\n\t\t/* /legacy macro support */\n\t}\n\n\t/*******************************************************************************************************************\n  * Tags Functions.\n  ******************************************************************************************************************/\n\tfunction tagsRegister(parent, bodyTags) {\n\t\tif (!parent) {\n\t\t\tthrow new Error('no parent specified');\n\t\t}\n\n\t\tvar endTags = ['/' + parent, 'end' + parent],\n\t\t    // automatically create the closing tags\n\t\tallTags = [].concat(endTags, Array.isArray(bodyTags) ? bodyTags : []);\n\n\t\tfor (var i = 0; i < allTags.length; ++i) {\n\t\t\tvar tag = allTags[i];\n\n\t\t\tif (macrosHas(tag)) {\n\t\t\t\tthrow new Error('cannot register tag for an existing macro');\n\t\t\t}\n\n\t\t\tif (tagsHas(tag)) {\n\t\t\t\tif (!_tags[tag].includes(parent)) {\n\t\t\t\t\t_tags[tag].push(parent);\n\t\t\t\t\t_tags[tag].sort();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t_tags[tag] = [parent];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction tagsUnregister(parent) {\n\t\tif (!parent) {\n\t\t\tthrow new Error('no parent specified');\n\t\t}\n\n\t\tObject.keys(_tags).forEach(function (tag) {\n\t\t\tvar i = _tags[tag].indexOf(parent);\n\n\t\t\tif (i !== -1) {\n\t\t\t\tif (_tags[tag].length === 1) {\n\t\t\t\t\tdelete _tags[tag];\n\t\t\t\t} else {\n\t\t\t\t\t_tags[tag].splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction tagsHas(name) {\n\t\treturn _tags.hasOwnProperty(name);\n\t}\n\n\tfunction tagsGet(name) {\n\t\treturn tagsHas(name) ? _tags[name] : null;\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\t/*\n  \tMacro Functions.\n  */\n\t\tadd: { value: macrosAdd },\n\t\tdelete: { value: macrosDelete },\n\t\tisEmpty: { value: macrosIsEmpty },\n\t\thas: { value: macrosHas },\n\t\tget: { value: macrosGet },\n\t\tinit: { value: macrosInit },\n\n\t\t/*\n  \tTags Functions.\n  */\n\t\ttags: {\n\t\t\tvalue: Object.freeze(Object.defineProperties({}, {\n\t\t\t\tregister: { value: tagsRegister },\n\t\t\t\tunregister: { value: tagsUnregister },\n\t\t\t\thas: { value: tagsHas },\n\t\t\t\tget: { value: tagsGet }\n\t\t\t}))\n\t\t},\n\n\t\t/*\n  \tLegacy Aliases.\n  */\n\t\tevalStatements: { value: function value() {\n\t\t\t\treturn Scripting.evalJavaScript.apply(Scripting, arguments);\n\t\t\t} } // See: `markup/scripting.js`.\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * macros/macrocontext.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Config, DebugView, throwError */\n\nvar MacroContext = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * MacroContext Class.\n  ******************************************************************************************************************/\n\n\tvar MacroContext = function () {\n\t\tfunction MacroContext(contextData) {\n\t\t\t_classCallCheck(this, MacroContext);\n\n\t\t\tvar context = Object.assign({\n\t\t\t\tparent: null,\n\t\t\t\tmacro: null,\n\t\t\t\tname: '',\n\t\t\t\targs: null,\n\t\t\t\tpayload: null,\n\t\t\t\tparser: null,\n\t\t\t\tsource: ''\n\t\t\t}, contextData);\n\n\t\t\tif (context.macro === null || context.name === '' || context.parser === null) {\n\t\t\t\tthrow new TypeError('context object missing required properties');\n\t\t\t}\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tparent: {\n\t\t\t\t\tvalue: context.parent\n\t\t\t\t},\n\n\t\t\t\tself: {\n\t\t\t\t\tvalue: context.macro\n\t\t\t\t},\n\n\t\t\t\tname: {\n\t\t\t\t\tvalue: context.name\n\t\t\t\t},\n\n\t\t\t\targs: {\n\t\t\t\t\tvalue: context.args\n\t\t\t\t},\n\n\t\t\t\tpayload: {\n\t\t\t\t\tvalue: context.payload\n\t\t\t\t},\n\n\t\t\t\tsource: {\n\t\t\t\t\tvalue: context.source\n\t\t\t\t},\n\n\t\t\t\tparser: {\n\t\t\t\t\tvalue: context.parser\n\t\t\t\t},\n\n\t\t\t\t_output: {\n\t\t\t\t\tvalue: context.parser.output\n\t\t\t\t},\n\n\t\t\t\t_debugView: {\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: null\n\t\t\t\t},\n\n\t\t\t\t_debugViewEnabled: {\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: Config.debug\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t_createClass(MacroContext, [{\n\t\t\tkey: 'contextHas',\n\t\t\tvalue: function contextHas(filter) {\n\t\t\t\tvar context = this;\n\n\t\t\t\twhile ((context = context.parent) !== null) {\n\t\t\t\t\tif (filter(context)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'contextSelect',\n\t\t\tvalue: function contextSelect(filter) {\n\t\t\t\tvar context = this;\n\n\t\t\t\twhile ((context = context.parent) !== null) {\n\t\t\t\t\tif (filter(context)) {\n\t\t\t\t\t\treturn context;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'contextSelectAll',\n\t\t\tvalue: function contextSelectAll(filter) {\n\t\t\t\tvar result = [];\n\t\t\t\tvar context = this;\n\n\t\t\t\twhile ((context = context.parent) !== null) {\n\t\t\t\t\tif (filter(context)) {\n\t\t\t\t\t\tresult.push(context);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'createDebugView',\n\t\t\tvalue: function createDebugView(name, title) {\n\t\t\t\tthis._debugView = new DebugView(this._output, 'macro', name ? name : this.name, title ? title : this.source);\n\n\t\t\t\tif (this.payload !== null && this.payload.length > 0) {\n\t\t\t\t\tthis._debugView.modes({ nonvoid: true });\n\t\t\t\t}\n\n\t\t\t\tthis._debugViewEnabled = true;\n\t\t\t\treturn this._debugView;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'removeDebugView',\n\t\t\tvalue: function removeDebugView() {\n\t\t\t\tif (this._debugView !== null) {\n\t\t\t\t\tthis._debugView.remove();\n\t\t\t\t\tthis._debugView = null;\n\t\t\t\t}\n\n\t\t\t\tthis._debugViewEnabled = false;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'error',\n\t\t\tvalue: function error(message, title) {\n\t\t\t\treturn throwError(this._output, '<<' + this.name + '>>: ' + message, title ? title : this.source);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'output',\n\t\t\tget: function get() {\n\t\t\t\treturn this._debugViewEnabled ? this.debugView.output : this._output;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'debugView',\n\t\t\tget: function get() {\n\t\t\t\tif (this._debugViewEnabled) {\n\t\t\t\t\treturn this._debugView !== null ? this._debugView : this.createDebugView();\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}]);\n\n\t\treturn MacroContext;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\n\n\treturn MacroContext;\n}();\n\n/***********************************************************************************************************************\n *\n * macros/macrolib.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/*\n\tglobal AudioWrapper, Config, DebugView, Engine, Has, Macro, Scripting, State, Story, TempState, TempVariables,\n\t       Util, Wikifier, postdisplay, prehistory, storage, strings, toStringOrDefault\n*/\n\n(function () {\n\t'use strict';\n\n\t/*******************************************************************************************************************\n  * Utility Functions.\n  ******************************************************************************************************************/\n\n\tfunction _getWikifyEvalHandler(content, widgetArgs, callback) {\n\t\treturn function () {\n\t\t\tif (content !== '') {\n\t\t\t\tvar argsCache = void 0;\n\t\t\t\t/*\n    \tThere's no catch clause because this try/finally is here simply to ensure that\n    \tproper cleanup is done in the event that an exception is thrown during the\n    \t`Wikifier.wikifyEval()` call.\n    */\n\t\t\t\ttry {\n\t\t\t\t\t// Setup the `$args` variable, caching the existing value if necessary.\n\t\t\t\t\tif (typeof widgetArgs !== 'undefined') {\n\t\t\t\t\t\tif (State.variables.hasOwnProperty('args')) {\n\t\t\t\t\t\t\targsCache = State.variables.args;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tState.variables.args = widgetArgs;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Wikify the content and discard any output, unless there were errors.\n\t\t\t\t\tWikifier.wikifyEval(content);\n\t\t\t\t} finally {\n\t\t\t\t\t// Teardown the `$args` variable, restoring the cached value if necessary.\n\t\t\t\t\tif (typeof widgetArgs !== 'undefined') {\n\t\t\t\t\t\tif (typeof argsCache !== 'undefined') {\n\t\t\t\t\t\t\tState.variables.args = argsCache;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete State.variables.args;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Call the given callback function, if any.\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback.call(this);\n\t\t\t}\n\t\t};\n\t}\n\n\t/*******************************************************************************************************************\n  * Variables Macros.\n  ******************************************************************************************************************/\n\t/*\n \t<<set>>\n */\n\tMacro.add('set', {\n\t\tskipArgs: true,\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.full.length === 0) {\n\t\t\t\treturn this.error('no expression specified');\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tScripting.evalJavaScript(this.args.full);\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error('bad evaluation: ' + e.message);\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ hidden: true });\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<unset>>\n */\n\tMacro.add('unset', {\n\t\tskipArgs: true,\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.full.length === 0) {\n\t\t\t\treturn this.error('no story/temporary variable list specified');\n\t\t\t}\n\n\t\t\tvar re = new RegExp('(?:(State\\\\.variables)|(TempVariables))\\\\.(' + Wikifier.textPrimitives.identifier + ')', 'g');\n\t\t\tvar match = void 0;\n\n\t\t\twhile ((match = re.exec(this.args.full)) !== null) {\n\t\t\t\tvar store = match[1] ? State.variables : TempVariables,\n\t\t\t\t    name = match[3];\n\n\t\t\t\tif (store.hasOwnProperty(name)) {\n\t\t\t\t\tdelete store[name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ hidden: true });\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<remember>>\n */\n\tMacro.add('remember', {\n\t\tskipArgs: true,\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.full.length === 0) {\n\t\t\t\treturn this.error('no expression specified');\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tScripting.evalJavaScript(this.args.full);\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error('bad evaluation: ' + e.message);\n\t\t\t}\n\n\t\t\tvar remember = storage.get('remember') || {},\n\t\t\t    re = new RegExp('State\\\\.variables\\\\.(' + Wikifier.textPrimitives.identifier + ')', 'g');\n\t\t\tvar match = void 0;\n\n\t\t\twhile ((match = re.exec(this.args.full)) !== null) {\n\t\t\t\tvar name = match[1];\n\t\t\t\tremember[name] = State.variables[name];\n\t\t\t}\n\n\t\t\tif (!storage.set('remember', remember)) {\n\t\t\t\treturn this.error('unknown error, cannot remember: ' + this.args.raw);\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ hidden: true });\n\t\t\t}\n\t\t},\n\t\tinit: function init() {\n\t\t\tvar remember = storage.get('remember');\n\n\t\t\tif (remember) {\n\t\t\t\tObject.keys(remember).forEach(function (name) {\n\t\t\t\t\treturn State.variables[name] = remember[name];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<forget>>\n */\n\tMacro.add('forget', {\n\t\tskipArgs: true,\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.full.length === 0) {\n\t\t\t\treturn this.error('no story variable list specified');\n\t\t\t}\n\n\t\t\tvar remember = storage.get('remember'),\n\t\t\t    re = new RegExp('State\\\\.variables\\\\.(' + Wikifier.textPrimitives.identifier + ')', 'g');\n\t\t\tvar match = void 0,\n\t\t\t    needStore = false;\n\n\t\t\twhile ((match = re.exec(this.args.full)) !== null) {\n\t\t\t\tvar name = match[1];\n\n\t\t\t\tif (State.variables.hasOwnProperty(name)) {\n\t\t\t\t\tdelete State.variables[name];\n\t\t\t\t}\n\n\t\t\t\tif (remember && remember.hasOwnProperty(name)) {\n\t\t\t\t\tneedStore = true;\n\t\t\t\t\tdelete remember[name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (needStore && !storage.set('remember', remember)) {\n\t\t\t\treturn this.error('unknown error, cannot update remember store');\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ hidden: true });\n\t\t\t}\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * Scripting Macros.\n  ******************************************************************************************************************/\n\t/*\n \t<<run>>\n */\n\tMacro.add('run', 'set'); // add <<run>> as an alias of <<set>>\n\n\t/*\n \t<<script>>\n */\n\tMacro.add('script', {\n\t\tskipArgs: true,\n\t\ttags: null,\n\n\t\thandler: function handler() {\n\t\t\tvar output = document.createDocumentFragment();\n\n\t\t\ttry {\n\t\t\t\tScripting.evalJavaScript(this.payload[0].contents, output);\n\n\t\t\t\t// Custom debug view setup.\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tthis.createDebugView(this.name, this.source + this.payload[0].contents + '<</' + this.name + '>>');\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error('bad evaluation: ' + e.message, this.source + this.payload[0].contents + '<</' + this.name + '>>');\n\t\t\t}\n\n\t\t\tif (output.hasChildNodes()) {\n\t\t\t\tthis.output.appendChild(output);\n\t\t\t}\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * Display Macros.\n  ******************************************************************************************************************/\n\t/*\n \t<<display>>\n */\n\tMacro.add('display', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no passage specified');\n\t\t\t}\n\n\t\t\tvar passage = void 0;\n\n\t\t\tif (_typeof(this.args[0]) === 'object') {\n\t\t\t\t// Argument was in wiki link syntax.\n\t\t\t\tpassage = this.args[0].link;\n\t\t\t} else {\n\t\t\t\t// Argument was simply the passage name.\n\t\t\t\tpassage = this.args[0];\n\t\t\t}\n\n\t\t\tif (!Story.has(passage)) {\n\t\t\t\treturn this.error('passage \"' + passage + '\" does not exist');\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ block: true });\n\t\t\t}\n\n\t\t\tpassage = Story.get(passage);\n\t\t\tvar $el = void 0;\n\n\t\t\tif (this.args[1]) {\n\t\t\t\t$el = jQuery(document.createElement(this.args[1])).addClass(passage.domId + ' macro-' + this.name).attr('data-passage', passage.title).appendTo(this.output);\n\t\t\t} else {\n\t\t\t\t$el = jQuery(this.output);\n\t\t\t}\n\n\t\t\t$el.wiki(passage.processText());\n\t\t}\n\t});\n\n\t/*\n \t<<nobr>>\n */\n\tMacro.add('nobr', {\n\t\tskipArgs: true,\n\t\ttags: null,\n\n\t\thandler: function handler() {\n\t\t\t/*\n   \tWikify the contents, after removing all leading & trailing newlines and compacting\n   \tall internal sequences of newlines into single spaces.\n   */\n\t\t\tnew Wikifier(this.output, this.payload[0].contents.replace(/^\\n+|\\n+$/g, '').replace(/\\n+/g, ' '));\n\t\t}\n\t});\n\n\t/*\n \t<<print>>, <<=>>, & <<->>\n */\n\tMacro.add(['print', '=', '-'], {\n\t\tskipArgs: true,\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.full.length === 0) {\n\t\t\t\treturn this.error('no expression specified');\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tvar result = toStringOrDefault(Scripting.evalJavaScript(this.args.full), null);\n\n\t\t\t\tif (result !== null) {\n\t\t\t\t\tnew Wikifier(this.output, this.name === '-' ? Util.escape(result) : result);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error('bad evaluation: ' + e.message);\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<silently>>\n */\n\tMacro.add('silently', {\n\t\tskipArgs: true,\n\t\ttags: null,\n\n\t\thandler: function handler() {\n\t\t\tvar frag = document.createDocumentFragment();\n\t\t\tnew Wikifier(frag, this.payload[0].contents.trim());\n\n\t\t\tif (Config.debug) {\n\t\t\t\t// Custom debug view setup.\n\t\t\t\tthis.debugView.modes({ hidden: true });\n\t\t\t\tthis.output.appendChild(frag);\n\t\t\t} else {\n\t\t\t\t// Discard the output, unless there were errors.\n\t\t\t\tvar errList = [].concat(_toConsumableArray(frag.querySelectorAll('.error'))).map(function (errEl) {\n\t\t\t\t\treturn errEl.textContent;\n\t\t\t\t});\n\n\t\t\t\tif (errList.length > 0) {\n\t\t\t\t\treturn this.error('error' + (errList.length === 1 ? '' : 's') + ' within contents (' + errList.join('; ') + ')', this.source + this.payload[0].contents + '<</' + this.name + '>>');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * Control Macros.\n  ******************************************************************************************************************/\n\t/*\n \t<<if>>, <<elseif>>, & <<else>>\n */\n\tMacro.add('if', {\n\t\tskipArgs: true,\n\t\ttags: ['elseif', 'else'],\n\n\t\thandler: function handler() {\n\t\t\tvar i = 0;\n\n\t\t\ttry {\n\t\t\t\tvar evalJavaScript = Scripting.evalJavaScript,\n\t\t\t\t    len = this.payload.length;\n\t\t\t\tvar success = false;\n\n\t\t\t\tfor (; /* empty */i < len; ++i) {\n\t\t\t\t\t// Sanity checks.\n\t\t\t\t\t/* eslint-disable prefer-template */\n\t\t\t\t\tswitch (this.payload[i].name) {\n\t\t\t\t\t\tcase 'else':\n\t\t\t\t\t\t\tif (i + 1 !== len) {\n\t\t\t\t\t\t\t\treturn this.error('<<else>> must be the final clause');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.payload[i].args.raw.length > 0) {\n\t\t\t\t\t\t\t\tif (/^\\s*if\\b/i.test(this.payload[i].args.raw)) {\n\t\t\t\t\t\t\t\t\treturn this.error('whitespace is not allowed between the \"else\" and \"if\" in <<elseif>> clause' + (i > 0 ? ' (#' + i + ')' : ''));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn this.error('<<else>> does not accept a conditional expression' + ' (perhaps you meant to use <<elseif>>),' + (' invalid: ' + this.payload[i].args.raw));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tif (this.payload[i].args.full.length === 0) {\n\t\t\t\t\t\t\t\treturn this.error('no conditional expression specified for <<' + this.payload[i].name + '>> clause' + (i > 0 ? ' (#' + i + ')' : ''));\n\t\t\t\t\t\t\t} else if (Config.macros.ifAssignmentError && /[^!=&^|<>*/%+-]=[^=]/.test(this.payload[i].args.full)) {\n\t\t\t\t\t\t\t\treturn this.error('assignment operator found within <<' + this.payload[i].name + '>> clause' + (i > 0 ? ' (#' + i + ')' : '') + ' (perhaps you meant to use an equality operator: ==, ===, eq, is),' + (' invalid: ' + this.payload[i].args.raw));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t/* eslint-enable prefer-template */\n\n\t\t\t\t\t// Custom debug view setup for the current clause.\n\t\t\t\t\tif (Config.debug) {\n\t\t\t\t\t\tthis.createDebugView(this.payload[i].name, this.payload[i].source).modes({ nonvoid: false });\n\t\t\t\t\t}\n\n\t\t\t\t\t// Conditional test.\n\t\t\t\t\tif (this.payload[i].name === 'else' || !!evalJavaScript(this.payload[i].args.full)) {\n\t\t\t\t\t\tsuccess = true;\n\t\t\t\t\t\tnew Wikifier(this.output, this.payload[i].contents);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (Config.debug) {\n\t\t\t\t\t\t// Custom debug view setup for a failed conditional.\n\t\t\t\t\t\tthis.debugView.modes({\n\t\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\t\tinvalid: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Custom debug view setup for the remaining clauses.\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tfor (++i; i < len; ++i) {\n\t\t\t\t\t\tthis.createDebugView(this.payload[i].name, this.payload[i].source).modes({\n\t\t\t\t\t\t\tnonvoid: false,\n\t\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\t\tinvalid: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t/*\n     \tFake a debug view for `<</if>>`.  We do this to aid the checking of nesting\n     \tand as a quick indicator of if any of the clauses matched.\n     */\n\t\t\t\t\tthis.createDebugView('/' + this.name, '<</' + this.name + '>>').modes({\n\t\t\t\t\t\tnonvoid: false,\n\t\t\t\t\t\thidden: !success,\n\t\t\t\t\t\tinvalid: !success\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error('bad conditional expression in <<' + (i === 0 ? 'if' : 'elseif') + '>> clause' + ((i > 0 ? ' (#' + i + ')' : '') + ': ' + e.message)); // eslint-disable-line prefer-template\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<switch>>, <<case>>, & <<default>>\n */\n\tMacro.add('switch', {\n\t\tskipArg0: true,\n\t\ttags: ['case', 'default'],\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.full.length === 0) {\n\t\t\t\treturn this.error('no expression specified');\n\t\t\t}\n\n\t\t\tvar len = this.payload.length;\n\t\t\tvar result = void 0;\n\n\t\t\t// if (len === 1 || !this.payload.some(p => p.name === 'case')) {\n\t\t\tif (len === 1) {\n\t\t\t\treturn this.error('no cases specified');\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tresult = Scripting.evalJavaScript(this.args.full);\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error('bad evaluation: ' + e.message);\n\t\t\t}\n\n\t\t\tvar debugView = this.debugView; // cache it now, to be modified later\n\t\t\tvar i = 1,\n\t\t\t    success = false;\n\n\t\t\t// Initial debug view setup for `<<switch>>`.\n\t\t\tif (Config.debug) {\n\t\t\t\tdebugView.modes({\n\t\t\t\t\tnonvoid: false,\n\t\t\t\t\thidden: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfor (; /* empty */i < len; ++i) {\n\t\t\t\t// Sanity checks.\n\t\t\t\tswitch (this.payload[i].name) {\n\t\t\t\t\tcase 'default':\n\t\t\t\t\t\tif (i + 1 !== len) {\n\t\t\t\t\t\t\treturn this.error('<<default>> must be the final case');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.payload[i].args.length > 0) {\n\t\t\t\t\t\t\treturn this.error('<<default>> does not accept values, invalid: ' + this.payload[i].args.raw);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (this.payload[i].args.length === 0) {\n\t\t\t\t\t\t\treturn this.error('no value(s) specified for <<' + this.payload[i].name + '>> (#' + i + ')');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Custom debug view setup for the current case.\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tthis.createDebugView(this.payload[i].name, this.payload[i].source).modes({ nonvoid: false });\n\t\t\t\t}\n\n\t\t\t\t// Case test(s).\n\t\t\t\tif (this.payload[i].name === 'default' || this.payload[i].args.some(function (v) {\n\t\t\t\t\treturn v === result;\n\t\t\t\t})) {\n\t\t\t\t\tsuccess = true;\n\t\t\t\t\tnew Wikifier(this.output, this.payload[i].contents);\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (Config.debug) {\n\t\t\t\t\t// Custom debug view setup for a failed case.\n\t\t\t\t\tthis.debugView.modes({\n\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\tinvalid: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Custom debug view setup for the remaining cases.\n\t\t\tif (Config.debug) {\n\t\t\t\tfor (++i; i < len; ++i) {\n\t\t\t\t\tthis.createDebugView(this.payload[i].name, this.payload[i].source).modes({\n\t\t\t\t\t\tnonvoid: false,\n\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\tinvalid: true\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/*\n    \tFinalize the debug view for `<<switch>>` and fake a debug view for `<</switch>>`.\n    \tWe do both as a quick indicator of if any of the cases matched and the latter\n    \tto aid the checking of nesting.\n    */\n\t\t\t\tdebugView.modes({\n\t\t\t\t\tnonvoid: false,\n\t\t\t\t\thidden: true, // !success,\n\t\t\t\t\tinvalid: !success\n\t\t\t\t});\n\t\t\t\tthis.createDebugView('/' + this.name, '<</' + this.name + '>>').modes({\n\t\t\t\t\tnonvoid: false,\n\t\t\t\t\thidden: true, // !success,\n\t\t\t\t\tinvalid: !success\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<for>>, <<break>>, & <<continue>>\n */\n\tMacro.add('for', {\n\t\tskipArgs: true,\n\t\ttags: null,\n\n\t\thandler: function handler() {\n\t\t\tvar evalJavaScript = Scripting.evalJavaScript,\n\t\t\t    payload = this.payload[0].contents.replace(/\\n$/, '');\n\t\t\tvar init = void 0,\n\t\t\t    condition = this.args.full.trim(),\n\t\t\t    post = void 0,\n\t\t\t    first = true,\n\t\t\t    safety = Config.macros.maxLoopIterations;\n\n\t\t\tif (condition.length === 0) {\n\t\t\t\tcondition = true;\n\t\t\t} else if (condition.indexOf(';') !== -1) {\n\t\t\t\tvar parts = condition.match(/^([^;]*?)\\s*;\\s*([^;]*?)\\s*;\\s*([^;]*?)$/);\n\n\t\t\t\tif (parts !== null) {\n\t\t\t\t\tinit = parts[1];\n\t\t\t\t\tcondition = parts[2];\n\t\t\t\t\tpost = parts[3];\n\t\t\t\t} else {\n\t\t\t\t\treturn this.error('invalid 3-part syntax, format: init ; condition ; post');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ block: true });\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tTempState.break = null;\n\n\t\t\t\tif (init) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tevalJavaScript(init);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn this.error('bad init expression: ' + e.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twhile (evalJavaScript(condition)) {\n\t\t\t\t\tif (--safety < 0) {\n\t\t\t\t\t\treturn this.error('exceeded configured maximum loop iterations' + (' (' + Config.macros.maxLoopIterations + ')'));\n\t\t\t\t\t}\n\n\t\t\t\t\tnew Wikifier(this.output, first ? payload.replace(/^\\n/, '') : payload);\n\n\t\t\t\t\tif (first) {\n\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (TempState.break != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tif (TempState.break === 1) {\n\t\t\t\t\t\t\tTempState.break = null;\n\t\t\t\t\t\t} else if (TempState.break === 2) {\n\t\t\t\t\t\t\tTempState.break = null;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (post) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tevalJavaScript(post);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treturn this.error('bad post expression: ' + e.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error('bad conditional expression: ' + e.message);\n\t\t\t} finally {\n\t\t\t\tTempState.break = null;\n\t\t\t}\n\t\t}\n\t});\n\tMacro.add(['break', 'continue'], {\n\t\tskipArgs: true,\n\n\t\thandler: function handler() {\n\t\t\tif (this.contextHas(function (c) {\n\t\t\t\treturn c.name === 'for';\n\t\t\t})) {\n\t\t\t\tTempState.break = this.name === 'continue' ? 1 : 2;\n\t\t\t} else {\n\t\t\t\treturn this.error('must only be used in conjunction with its parent macro <<for>>');\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ hidden: true });\n\t\t\t}\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * Interactive Macros.\n  ******************************************************************************************************************/\n\t/*\n \t<<button>> & <<click>>\n */\n\tMacro.add(['button', 'click'], {\n\t\ttags: null,\n\n\t\thandler: function handler() {\n\t\t\tvar _this6 = this;\n\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no ' + (this.name === 'click' ? 'link' : 'button') + ' text specified');\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.createDebugView(this.name, this.source + this.payload[0].contents + '<</' + this.name + '>>');\n\t\t\t}\n\n\t\t\tvar $el = jQuery(document.createElement(this.name === 'click' ? 'a' : 'button')),\n\t\t\t    widgetArgs = function () {\n\t\t\t\tvar wargs = void 0;\n\n\t\t\t\tif (State.variables.hasOwnProperty('args') && _this6.contextHas(function (c) {\n\t\t\t\t\treturn c.self.isWidget;\n\t\t\t\t})) {\n\t\t\t\t\twargs = State.variables.args;\n\t\t\t\t}\n\n\t\t\t\treturn wargs;\n\t\t\t}();\n\t\t\tvar passage = void 0;\n\n\t\t\tif (_typeof(this.args[0]) === 'object') {\n\t\t\t\tif (this.args[0].isImage) {\n\t\t\t\t\t// Argument was in wiki image syntax.\n\t\t\t\t\tvar $image = jQuery(document.createElement('img')).attr('src', this.args[0].source).appendTo($el);\n\n\t\t\t\t\tif (this.args[0].hasOwnProperty('passage')) {\n\t\t\t\t\t\t$image.attr('data-passage', this.args[0].passage);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.args[0].hasOwnProperty('title')) {\n\t\t\t\t\t\t$image.attr('title', this.args[0].title);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.args[0].hasOwnProperty('align')) {\n\t\t\t\t\t\t$image.attr('align', this.args[0].align);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.args[0].hasOwnProperty('link')) {\n\t\t\t\t\t\tpassage = this.args[0].link;\n\t\t\t\t\t}\n\n\t\t\t\t\tpassage = this.args[0].link;\n\t\t\t\t} else {\n\t\t\t\t\t// Argument was in wiki link syntax.\n\t\t\t\t\t$el.append(document.createTextNode(this.args[0].text));\n\t\t\t\t\tpassage = this.args[0].link;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Argument was simply the link text.\n\t\t\t\t$el.append(document.createTextNode(this.args[0]));\n\t\t\t\tpassage = this.args.length > 1 ? this.args[1] : undefined;\n\t\t\t}\n\n\t\t\tif (passage != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\t$el.attr('data-passage', passage);\n\n\t\t\t\tif (Story.has(passage)) {\n\t\t\t\t\t$el.addClass('link-internal');\n\n\t\t\t\t\tif (Config.addVisitedLinkClass && State.hasPlayed(passage)) {\n\t\t\t\t\t\t$el.addClass('link-visited');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$el.addClass('link-broken');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$el.addClass('link-internal');\n\t\t\t}\n\n\t\t\t$el.addClass('macro-' + this.name).ariaClick({\n\t\t\t\tnamespace: '.macros',\n\t\t\t\tone: passage != null // lazy equality for null\n\t\t\t}, _getWikifyEvalHandler(this.payload[0].contents.trim(), widgetArgs, passage != null ? function () {\n\t\t\t\treturn Engine.play(passage);\n\t\t\t} : undefined // lazy equality for null\n\t\t\t)).appendTo(this.output);\n\t\t}\n\t});\n\n\t/*\n \t<<checkbox>>\n */\n\tMacro.add('checkbox', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length < 3) {\n\t\t\t\tvar errors = [];\n\t\t\t\tif (this.args.length < 1) {\n\t\t\t\t\terrors.push('story variable name');\n\t\t\t\t}\n\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\terrors.push('unchecked value');\n\t\t\t\t}\n\t\t\t\tif (this.args.length < 3) {\n\t\t\t\t\terrors.push('checked value');\n\t\t\t\t}\n\t\t\t\treturn this.error('no ' + errors.join(' or ') + ' specified');\n\t\t\t}\n\n\t\t\t/*\n   \tTry to ensure that we receive the story variable's name (incl. sigil), not its value.\n   */\n\t\t\tif (typeof this.args[0] !== 'string' || this.args[0].trim()[0] !== '$') {\n\t\t\t\treturn this.error('story variable name \"' + this.args[0] + '\" is missing its sigil ($)');\n\t\t\t}\n\n\t\t\tvar varName = this.args[0].trim(),\n\t\t\t    varId = Util.slugify(varName),\n\t\t\t    uncheckValue = this.args[1],\n\t\t\t    checkValue = this.args[2],\n\t\t\t    el = document.createElement('input');\n\n\t\t\t/*\n   \tSetup and append the input element to the output buffer.\n   */\n\t\t\tjQuery(el).attr({\n\t\t\t\tid: this.name + '-' + varId,\n\t\t\t\tname: this.name + '-' + varId,\n\t\t\t\ttype: 'checkbox',\n\t\t\t\ttabindex: 0 // for accessiblity\n\t\t\t}).addClass('macro-' + this.name).on('change', function () {\n\t\t\t\tWikifier.setValue(varName, this.checked ? checkValue : uncheckValue);\n\t\t\t}).appendTo(this.output);\n\n\t\t\t/*\n   \tSet the story variable and input element to the appropriate value and state, as requested.\n   */\n\t\t\tif (this.args.length > 3 && this.args[3] === 'checked') {\n\t\t\t\tel.checked = true;\n\t\t\t\tWikifier.setValue(varName, checkValue);\n\t\t\t} else {\n\t\t\t\tWikifier.setValue(varName, uncheckValue);\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<radiobutton>>\n */\n\tMacro.add('radiobutton', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length < 2) {\n\t\t\t\tvar errors = [];\n\t\t\t\tif (this.args.length < 1) {\n\t\t\t\t\terrors.push('story variable name');\n\t\t\t\t}\n\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\terrors.push('checked value');\n\t\t\t\t}\n\t\t\t\treturn this.error('no ' + errors.join(' or ') + ' specified');\n\t\t\t}\n\n\t\t\t/*\n   \tTry to ensure that we receive the story variable's name (incl. sigil), not its value.\n   */\n\t\t\tif (typeof this.args[0] !== 'string' || this.args[0].trim()[0] !== '$') {\n\t\t\t\treturn this.error('story variable name \"' + this.args[0] + '\" is missing its sigil ($)');\n\t\t\t}\n\n\t\t\tvar varName = this.args[0].trim(),\n\t\t\t    varId = Util.slugify(varName),\n\t\t\t    checkValue = this.args[1],\n\t\t\t    el = document.createElement('input');\n\n\t\t\t/*\n   \tSetup and initialize the group counter.\n   */\n\t\t\tif (!TempState.hasOwnProperty(this.name)) {\n\t\t\t\tTempState[this.name] = {};\n\t\t\t\tTempState[this.name][varId] = 0;\n\t\t\t}\n\n\t\t\t/*\n   \tSetup and append the input element to the output buffer.\n   */\n\t\t\tjQuery(el).attr({\n\t\t\t\tid: this.name + '-' + varId + '-' + TempState[this.name][varId]++,\n\t\t\t\tname: this.name + '-' + varId,\n\t\t\t\ttype: 'radio',\n\t\t\t\ttabindex: 0 // for accessiblity\n\t\t\t}).addClass('macro-' + this.name).on('change', function () {\n\t\t\t\tif (this.checked) {\n\t\t\t\t\tWikifier.setValue(varName, checkValue);\n\t\t\t\t}\n\t\t\t}).appendTo(this.output);\n\n\t\t\t/*\n   \tSet the story variable to the checked value and the input element to checked, if requested.\n   */\n\t\t\tif (this.args.length > 2 && this.args[2] === 'checked') {\n\t\t\t\tel.checked = true;\n\t\t\t\tWikifier.setValue(varName, checkValue);\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<textarea>>\n */\n\tMacro.add('textarea', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length < 2) {\n\t\t\t\tvar errors = [];\n\t\t\t\tif (this.args.length < 1) {\n\t\t\t\t\terrors.push('story variable name');\n\t\t\t\t}\n\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\terrors.push('default value');\n\t\t\t\t}\n\t\t\t\treturn this.error('no ' + errors.join(' or ') + ' specified');\n\t\t\t}\n\n\t\t\t/*\n   \tTry to ensure that we receive the story variable's name (incl. sigil), not its value.\n   */\n\t\t\tif (typeof this.args[0] !== 'string' || this.args[0].trim()[0] !== '$') {\n\t\t\t\treturn this.error('story variable name \"' + this.args[0] + '\" is missing its sigil ($)');\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ block: true });\n\t\t\t}\n\n\t\t\tvar varName = this.args[0].trim(),\n\t\t\t    varId = Util.slugify(varName),\n\t\t\t    defaultValue = this.args[1],\n\t\t\t    autofocus = this.args[2] === 'autofocus',\n\t\t\t    el = document.createElement('textarea');\n\n\t\t\t/*\n   \tSetup and append the textarea element to the output buffer.\n   */\n\t\t\tjQuery(el).attr({\n\t\t\t\tid: this.name + '-' + varId,\n\t\t\t\tname: this.name + '-' + varId,\n\t\t\t\trows: 4,\n\t\t\t\t// cols     : 68, // instead of setting \"cols\" we set the `min-width` in CSS\n\t\t\t\ttabindex: 0 // for accessiblity\n\t\t\t}).addClass('macro-' + this.name).on('change', function () {\n\t\t\t\tWikifier.setValue(varName, this.value);\n\t\t\t}).appendTo(this.output);\n\n\t\t\t/*\n   \tSet the story variable and textarea element to the default value.\n   */\n\t\t\tWikifier.setValue(varName, defaultValue);\n\t\t\t// Ideally, we should be setting the `.defaultValue` property here, but IE doesn't support\n\t\t\t// it, so we have to use `.textContent`, which is equivalent to `.defaultValue` anyway.\n\t\t\tel.textContent = defaultValue;\n\n\t\t\t/*\n   \tAutofocus the textarea element, if requested.\n   */\n\t\t\tif (autofocus) {\n\t\t\t\t// Set the element's \"autofocus\" attribute.\n\t\t\t\tel.setAttribute('autofocus', 'autofocus');\n\n\t\t\t\t// Setup a single-use post-display task to autofocus the element.\n\t\t\t\tpostdisplay['#autofocus:' + el.id] = function (task) {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\treturn el.focus();\n\t\t\t\t\t}, Engine.minDomActionDelay);\n\t\t\t\t\tdelete postdisplay[task]; // single-use task\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<textbox>>\n */\n\tMacro.add('textbox', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length < 2) {\n\t\t\t\tvar errors = [];\n\t\t\t\tif (this.args.length < 1) {\n\t\t\t\t\terrors.push('story variable name');\n\t\t\t\t}\n\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\terrors.push('default value');\n\t\t\t\t}\n\t\t\t\treturn this.error('no ' + errors.join(' or ') + ' specified');\n\t\t\t}\n\n\t\t\t/*\n   \tTry to ensure that we receive the story variable's name (incl. sigil), not its value.\n   */\n\t\t\tif (typeof this.args[0] !== 'string' || this.args[0].trim()[0] !== '$') {\n\t\t\t\treturn this.error('story variable name \"' + this.args[0] + '\" is missing its sigil ($)');\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ block: true });\n\t\t\t}\n\n\t\t\tvar varName = this.args[0].trim(),\n\t\t\t    varId = Util.slugify(varName),\n\t\t\t    defaultValue = this.args[1],\n\t\t\t    el = document.createElement('input');\n\t\t\tvar autofocus = false,\n\t\t\t    passage = void 0;\n\n\t\t\tif (this.args.length > 3) {\n\t\t\t\tpassage = this.args[2];\n\t\t\t\tautofocus = this.args[3] === 'autofocus';\n\t\t\t} else if (this.args.length > 2) {\n\t\t\t\tif (this.args[2] === 'autofocus') {\n\t\t\t\t\tautofocus = true;\n\t\t\t\t} else {\n\t\t\t\t\tpassage = this.args[2];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*\n   \tSetup and append the input element to the output buffer.\n   */\n\t\t\tjQuery(el).attr({\n\t\t\t\tid: this.name + '-' + varId,\n\t\t\t\tname: this.name + '-' + varId,\n\t\t\t\ttype: 'text',\n\t\t\t\ttabindex: 0 // for accessiblity\n\t\t\t}).addClass('macro-' + this.name).on('change', function () {\n\t\t\t\tWikifier.setValue(varName, this.value);\n\t\t\t}).on('keypress', function (evt) {\n\t\t\t\t// If Return/Enter is pressed, set the story variable and, optionally, forward to another passage.\n\t\t\t\tif (evt.which === 13) {\n\t\t\t\t\t// 13 is Return/Enter\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\tWikifier.setValue(varName, this.value);\n\t\t\t\t\tif (passage != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tEngine.play(passage);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).appendTo(this.output);\n\n\t\t\t/*\n   \tSet the story variable and input element to the default value.\n   */\n\t\t\tWikifier.setValue(varName, defaultValue);\n\t\t\tel.value = defaultValue;\n\n\t\t\t/*\n   \tAutofocus the input element, if requested.\n   */\n\t\t\tif (autofocus) {\n\t\t\t\t// Set the element's \"autofocus\" attribute.\n\t\t\t\tel.setAttribute('autofocus', 'autofocus');\n\n\t\t\t\t// Setup a single-use post-display task to autofocus the element.\n\t\t\t\tpostdisplay['#autofocus:' + el.id] = function (task) {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\treturn el.focus();\n\t\t\t\t\t}, Engine.minDomActionDelay);\n\t\t\t\t\tdelete postdisplay[task]; // single-use task\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * Links Macros.\n  ******************************************************************************************************************/\n\t/*\n \t<<actions>>\n */\n\tMacro.add('actions', {\n\t\thandler: function handler() {\n\t\t\tvar $list = jQuery(document.createElement('ul')).addClass(this.name).appendTo(this.output);\n\n\t\t\tif (!State.variables['#actions']) {\n\t\t\t\tState.variables['#actions'] = {};\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < this.args.length; ++i) {\n\t\t\t\tvar passage = void 0,\n\t\t\t\t    text = void 0,\n\t\t\t\t    $image = void 0,\n\t\t\t\t    setFn = void 0;\n\n\t\t\t\tif (_typeof(this.args[i]) === 'object') {\n\t\t\t\t\tif (this.args[i].isImage) {\n\t\t\t\t\t\t// Argument was in wiki image syntax.\n\t\t\t\t\t\t$image = jQuery(document.createElement('img')).attr('src', this.args[i].source);\n\n\t\t\t\t\t\tif (this.args[i].hasOwnProperty('passage')) {\n\t\t\t\t\t\t\t$image.attr('data-passage', this.args[i].passage);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.args[i].hasOwnProperty('title')) {\n\t\t\t\t\t\t\t$image.attr('title', this.args[i].title);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.args[i].hasOwnProperty('align')) {\n\t\t\t\t\t\t\t$image.attr('align', this.args[i].align);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpassage = this.args[i].link;\n\t\t\t\t\t\tsetFn = this.args[i].setFn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Argument was in wiki link syntax.\n\t\t\t\t\t\ttext = this.args[i].text;\n\t\t\t\t\t\tpassage = this.args[i].link;\n\t\t\t\t\t\tsetFn = this.args[i].setFn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Argument was simply the passage name.\n\t\t\t\t\ttext = passage = this.args[i];\n\t\t\t\t}\n\n\t\t\t\tif (State.variables['#actions'].hasOwnProperty(passage) && State.variables['#actions'][passage]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tjQuery(Wikifier.createInternalLink(jQuery(document.createElement('li')).appendTo($list), passage, null, function (p, fn) {\n\t\t\t\t\treturn function () {\n\t\t\t\t\t\tState.variables['#actions'][p] = true;\n\t\t\t\t\t\tif (typeof fn === 'function') {\n\t\t\t\t\t\t\tfn();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}(passage, setFn))).addClass('macro-' + this.name).append($image || document.createTextNode(text));\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<back>> & <<return>>\n */\n\tMacro.add(['back', 'return'], {\n\t\thandler: function handler() {\n\t\t\t/* legacy */\n\t\t\tif (this.args.length > 1) {\n\t\t\t\treturn this.error('too many arguments specified, check the documentation for details');\n\t\t\t}\n\t\t\t/* /legacy */\n\n\t\t\tvar momentIndex = -1,\n\t\t\t    passage = void 0,\n\t\t\t    text = void 0,\n\t\t\t    $image = void 0;\n\n\t\t\tif (this.args.length === 1) {\n\t\t\t\tif (_typeof(this.args[0]) === 'object') {\n\t\t\t\t\tif (this.args[0].isImage) {\n\t\t\t\t\t\t// Argument was in wiki image syntax.\n\t\t\t\t\t\t$image = jQuery(document.createElement('img')).attr('src', this.args[0].source);\n\n\t\t\t\t\t\tif (this.args[0].hasOwnProperty('passage')) {\n\t\t\t\t\t\t\t$image.attr('data-passage', this.args[0].passage);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.args[0].hasOwnProperty('title')) {\n\t\t\t\t\t\t\t$image.attr('title', this.args[0].title);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.args[0].hasOwnProperty('align')) {\n\t\t\t\t\t\t\t$image.attr('align', this.args[0].align);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.args[0].hasOwnProperty('link')) {\n\t\t\t\t\t\t\tpassage = this.args[0].link;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Argument was in wiki link syntax.\n\t\t\t\t\t\tif (this.args[0].count === 1) {\n\t\t\t\t\t\t\t// Simple link syntax: `[[...]]`.\n\t\t\t\t\t\t\tpassage = this.args[0].link;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Pretty link syntax: `[[...|...]]`.\n\t\t\t\t\t\t\ttext = this.args[0].text;\n\t\t\t\t\t\t\tpassage = this.args[0].link;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (this.args.length === 1) {\n\t\t\t\t\t// Argument was simply the link text.\n\t\t\t\t\ttext = this.args[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (passage == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\t/*\n    \tFind the index and title of the most recent moment whose title does not match\n    \tthat of the active (present) moment's.\n    */\n\t\t\t\tfor (var i = State.length - 2; i >= 0; --i) {\n\t\t\t\t\tif (State.history[i].title !== State.passage) {\n\t\t\t\t\t\tmomentIndex = i;\n\t\t\t\t\t\tpassage = State.history[i].title;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we failed to find a passage and we're `<<return>>`, fallback to `State.expired`.\n\t\t\t\tif (passage == null && this.name === 'return') {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tfor (var _i2 = State.expired.length - 1; _i2 >= 0; --_i2) {\n\t\t\t\t\t\tif (State.expired[_i2] !== State.passage) {\n\t\t\t\t\t\t\tpassage = State.expired[_i2];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!Story.has(passage)) {\n\t\t\t\t\treturn this.error('passage \"' + passage + '\" does not exist');\n\t\t\t\t}\n\n\t\t\t\tif (this.name === 'back') {\n\t\t\t\t\t/*\n     \tFind the index of the most recent moment whose title matches that of the\n     \tspecified passage.\n     */\n\t\t\t\t\tfor (var _i3 = State.length - 2; _i3 >= 0; --_i3) {\n\t\t\t\t\t\tif (State.history[_i3].title === passage) {\n\t\t\t\t\t\t\tmomentIndex = _i3;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (momentIndex === -1) {\n\t\t\t\t\t\treturn this.error('cannot find passage \"' + passage + '\" in the current story history');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (passage == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\treturn this.error('cannot find passage');\n\t\t\t}\n\n\t\t\t// if (this.name === \"back\" && momentIndex === -1) {\n\t\t\t// \t// no-op; we're already at the first passage in the current story history\n\t\t\t// \treturn;\n\t\t\t// }\n\n\t\t\tvar $el = void 0;\n\n\t\t\tif (this.name !== 'back' || momentIndex !== -1) {\n\t\t\t\t$el = jQuery(document.createElement('a')).addClass('link-internal').ariaClick({ one: true }, this.name === 'return' ? function () {\n\t\t\t\t\treturn Engine.play(passage);\n\t\t\t\t} : function () {\n\t\t\t\t\treturn Engine.goTo(momentIndex);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t$el = jQuery(document.createElement('span')).addClass('link-disabled');\n\t\t\t}\n\n\t\t\t$el.addClass('macro-' + this.name).append($image || document.createTextNode(text || strings.macros[this.name].text)).appendTo(this.output);\n\t\t}\n\t});\n\n\t/*\n \t<<choice>>\n */\n\tMacro.add('choice', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no passage specified');\n\t\t\t}\n\n\t\t\tvar choiceId = State.passage;\n\t\t\tvar passage = void 0,\n\t\t\t    text = void 0,\n\t\t\t    $image = void 0,\n\t\t\t    setFn = void 0;\n\n\t\t\tif (this.args.length === 1) {\n\t\t\t\tif (_typeof(this.args[0]) === 'object') {\n\t\t\t\t\tif (this.args[0].isImage) {\n\t\t\t\t\t\t// Argument was in wiki image syntax.\n\t\t\t\t\t\t$image = jQuery(document.createElement('img')).attr('src', this.args[0].source);\n\n\t\t\t\t\t\tif (this.args[0].hasOwnProperty('passage')) {\n\t\t\t\t\t\t\t$image.attr('data-passage', this.args[0].passage);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.args[0].hasOwnProperty('title')) {\n\t\t\t\t\t\t\t$image.attr('title', this.args[0].title);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.args[0].hasOwnProperty('align')) {\n\t\t\t\t\t\t\t$image.attr('align', this.args[0].align);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpassage = this.args[0].link;\n\t\t\t\t\t\tsetFn = this.args[0].setFn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Argument was in wiki link syntax.\n\t\t\t\t\t\ttext = this.args[0].text;\n\t\t\t\t\t\tpassage = this.args[0].link;\n\t\t\t\t\t\tsetFn = this.args[0].setFn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Argument was simply the passage name.\n\t\t\t\t\ttext = passage = this.args[0];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Yes, the arguments are backwards.\n\t\t\t\tpassage = this.args[0];\n\t\t\t\ttext = this.args[1];\n\t\t\t}\n\n\t\t\tif (!State.variables.hasOwnProperty('#choice')) {\n\t\t\t\tState.variables['#choice'] = {};\n\t\t\t} else if (State.variables['#choice'].hasOwnProperty(choiceId) && State.variables['#choice'][choiceId]) {\n\t\t\t\tjQuery(document.createElement('span')).addClass('link-disabled macro-' + this.name).attr('tabindex', -1).append($image || document.createTextNode(text)).appendTo(this.output);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tjQuery(Wikifier.createInternalLink(this.output, passage, null, function () {\n\t\t\t\tState.variables['#choice'][choiceId] = true;\n\t\t\t\tif (typeof setFn === 'function') {\n\t\t\t\t\tsetFn();\n\t\t\t\t}\n\t\t\t})).addClass('macro-' + this.name).append($image || document.createTextNode(text));\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * DOM Macros.\n  ******************************************************************************************************************/\n\t/*\n \t<<addclass>> & <<toggleclass>>\n */\n\tMacro.add(['addclass', 'toggleclass'], {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length < 2) {\n\t\t\t\tvar errors = [];\n\t\t\t\tif (this.args.length < 1) {\n\t\t\t\t\terrors.push('selector');\n\t\t\t\t}\n\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\terrors.push('class names');\n\t\t\t\t}\n\t\t\t\treturn this.error('no ' + errors.join(' or ') + ' specified');\n\t\t\t}\n\n\t\t\tvar $targets = jQuery(this.args[0]);\n\n\t\t\tif ($targets.length === 0) {\n\t\t\t\treturn this.error('no elements matched the selector \"' + this.args[0] + '\"');\n\t\t\t}\n\n\t\t\tswitch (this.name) {\n\t\t\t\tcase 'addclass':\n\t\t\t\t\t$targets.addClass(this.args[1].trim());\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'toggleclass':\n\t\t\t\t\t$targets.toggleClass(this.args[1].trim());\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<removeclass>>\n */\n\tMacro.add('removeclass', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no selector specified');\n\t\t\t}\n\n\t\t\tvar $targets = jQuery(this.args[0]);\n\n\t\t\tif ($targets.length === 0) {\n\t\t\t\treturn this.error('no elements matched the selector \"' + this.args[0] + '\"');\n\t\t\t}\n\n\t\t\tif (this.args.length > 1) {\n\t\t\t\t$targets.removeClass(this.args[1].trim());\n\t\t\t} else {\n\t\t\t\t$targets.removeClass();\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<copy>>\n */\n\tMacro.add('copy', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no selector specified');\n\t\t\t}\n\n\t\t\tvar $targets = jQuery(this.args[0]);\n\n\t\t\tif ($targets.length === 0) {\n\t\t\t\treturn this.error('no elements matched the selector \"' + this.args[0] + '\"');\n\t\t\t}\n\n\t\t\tjQuery(this.output).append($targets.html());\n\t\t}\n\t});\n\n\t/*\n \t<<append>>, <<prepend>>, & <<replace>>\n */\n\tMacro.add(['append', 'prepend', 'replace'], {\n\t\ttags: null,\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no selector specified');\n\t\t\t}\n\n\t\t\tvar $targets = jQuery(this.args[0]);\n\n\t\t\tif ($targets.length === 0) {\n\t\t\t\treturn this.error('no elements matched the selector \"' + this.args[0] + '\"');\n\t\t\t}\n\n\t\t\tif (this.payload[0].contents !== '') {\n\t\t\t\tvar frag = document.createDocumentFragment();\n\t\t\t\tnew Wikifier(frag, this.payload[0].contents);\n\n\t\t\t\tswitch (this.name) {\n\t\t\t\t\tcase 'replace':\n\t\t\t\t\t\t$targets.empty();\n\t\t\t\t\t/* falls through */\n\n\t\t\t\t\tcase 'append':\n\t\t\t\t\t\t$targets.append(frag);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'prepend':\n\t\t\t\t\t\t$targets.prepend(frag);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (this.name === 'replace') {\n\t\t\t\t$targets.empty();\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<remove>>\n */\n\tMacro.add('remove', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no selector specified');\n\t\t\t}\n\n\t\t\tvar $targets = jQuery(this.args[0]);\n\n\t\t\tif ($targets.length === 0) {\n\t\t\t\treturn this.error('no elements matched the selector \"' + this.args[0] + '\"');\n\t\t\t}\n\n\t\t\t$targets.remove();\n\t\t}\n\t});\n\n\t/*******************************************************************************************************************\n  * Audio Macros.\n  ******************************************************************************************************************/\n\tif (!Has.audio) {\n\t\tMacro.add(['cacheaudio', 'audio', 'stopallaudio', 'playlist', 'setplaylist'], {\n\t\t\thandler: function handler() {/* empty */}\n\t\t});\n\t} else {\n\t\t/*\n  \t<<cacheaudio>>\n  */\n\t\tMacro.add('cacheaudio', {\n\t\t\thandler: function handler() {\n\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\tvar errors = [];\n\t\t\t\t\tif (this.args.length < 1) {\n\t\t\t\t\t\terrors.push('track ID');\n\t\t\t\t\t}\n\t\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\t\terrors.push('sources');\n\t\t\t\t\t}\n\t\t\t\t\treturn this.error('no ' + errors.join(' or ') + ' specified');\n\t\t\t\t}\n\n\t\t\t\tvar types = this.self.types,\n\t\t\t\t    canPlay = this.self.canPlay,\n\n\t\t\t\t/*\n    \tUse `document.createElement('audio')` in favor of `new Audio()` as the\n    \tlatter is treated differently (often unfavorably) in certain cases,\n    \tchiefly in mobile browsers.\n    */\n\t\t\t\taudio = document.createElement('audio'),\n\t\t\t\t    id = this.args[0],\n\t\t\t\t    extRe = this.self.extRe;\n\n\t\t\t\tfor (var i = 1; i < this.args.length; ++i) {\n\t\t\t\t\tvar url = this.args[i],\n\t\t\t\t\t    match = extRe.exec(Util.parseUrl(url).pathname);\n\n\t\t\t\t\tif (match === null) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar ext = match[1].toLowerCase(),\n\t\t\t\t\t    type = types.hasOwnProperty(ext) ? types[ext] : 'audio/' + ext;\n\n\t\t\t\t\t// Determine and cache the `canPlay` status for the audio type.\n\t\t\t\t\tif (!canPlay.hasOwnProperty(type)) {\n\t\t\t\t\t\t// Some early implementations return 'no' instead of the empty string.\n\t\t\t\t\t\tcanPlay[type] = audio.canPlayType(type).replace(/^no$/i, '') !== '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (canPlay[type]) {\n\t\t\t\t\t\tvar source = document.createElement('source');\n\t\t\t\t\t\tsource.src = url;\n\t\t\t\t\t\tsource.type = type;\n\t\t\t\t\t\taudio.appendChild(source);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If in Test Mode and no <source> elements were generated, return an error.\n\t\t\t\tif (Config.debug && !audio.hasChildNodes()) {\n\t\t\t\t\treturn this.error('no supported audio tracks found');\n\t\t\t\t}\n\n\t\t\t\t// Wrap the <audio> element and add it to the tracks.  We do this even if no <source>\n\t\t\t\t// elements were generated to suppress errors for players.  The above Test Mode error\n\t\t\t\t// should suffice for authors.\n\t\t\t\taudio.preload = 'auto';\n\t\t\t\tthis.self.tracks[id] = new AudioWrapper(audio);\n\n\t\t\t\t// Custom debug view setup.\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tthis.createDebugView();\n\t\t\t\t}\n\t\t\t},\n\n\n\t\t\textRe: /\\.([^\\.\\/\\\\]+)$/,\n\t\t\ttypes: Object.freeze({\n\t\t\t\t/*\n    \tDefine a file extension to MIME-type mapping for some common audio types.\n    \tDo not include the codecs property in most cases, however, as we have no way\n    \tof knowing what codec the given files were actually encoded with—the browser\n    \twill figure it out.  In some cases, however, the relationship between extension\n    \tand codec is strong, so we may include the codec in those cases.\n    \t\tCaveats by browser:\n    \t\tOpera (Presto) will return a false-negative if the codecs value is quoted\n    \t\twith single quotes, requiring the use of either double quotes or no quotes.\n    \t\t\tBlink-based browsers (e.g. Chrome, Opera ≥15) will return a false-negative\n    \t\tfor WAVE audio if the preferred MIME-type of 'audio/wave' is specified,\n    \t\trequiring the use of 'audio/wav' instead.\n    */\n\t\t\t\taac: 'audio/aac', //\n\t\t\t\tmp3: 'audio/mpeg; codecs=\"mp3\"', // .mp3 files should be MPEG Layer-III audio in an MPEG Audio container\n\t\t\t\tmp4: 'audio/mp4', // codecs vary, but commonly \"mp4a.40.2\"\n\t\t\t\tm4a: 'audio/mp4', // (ditto)\n\t\t\t\togg: 'audio/ogg', // codecs vary, but commonly \"vorbis\" and, recently, \"opus\"\n\t\t\t\toga: 'audio/ogg', // (ditto)\n\t\t\t\topus: 'audio/ogg; codecs=\"opus\"', // .opus files should be Opus audio in an Ogg container\n\t\t\t\twav: 'audio/wav', // codecs vary, but commonly \"1\" (1 is the FourCC for PCM/LPCM)\n\t\t\t\tweba: 'audio/webm', // codecs vary, but commonly \"vorbis\" and, recently, \"opus\"\n\t\t\t\twebm: 'audio/webm' // codecs vary, but commonly \"vorbis\" and, recently, \"opus\"\n\t\t\t}),\n\t\t\tcanPlay: {},\n\t\t\ttracks: {}\n\t\t});\n\n\t\t/*\n  \t<<audio>>\n  */\n\t\tMacro.add('audio', {\n\t\t\thandler: function handler() {\n\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\tvar errors = [];\n\t\t\t\t\tif (this.args.length < 1) {\n\t\t\t\t\t\terrors.push('track ID');\n\t\t\t\t\t}\n\t\t\t\t\tif (this.args.length < 2) {\n\t\t\t\t\t\terrors.push('actions');\n\t\t\t\t\t}\n\t\t\t\t\treturn this.error('no ' + errors.join(' or ') + ' specified');\n\t\t\t\t}\n\n\t\t\t\tvar tracks = Macro.get('cacheaudio').tracks,\n\t\t\t\t    id = this.args[0];\n\n\t\t\t\tif (!tracks.hasOwnProperty(id)) {\n\t\t\t\t\treturn this.error('track \"' + id + '\" does not exist');\n\t\t\t\t}\n\n\t\t\t\tvar audio = tracks[id],\n\t\t\t\t    args = this.args.slice(1);\n\t\t\t\tvar action = void 0,\n\t\t\t\t    volume = void 0,\n\t\t\t\t    mute = void 0,\n\t\t\t\t    time = void 0,\n\t\t\t\t    loop = void 0,\n\t\t\t\t    fadeTo = void 0,\n\t\t\t\t    fadeOver = 5,\n\t\t\t\t    passage = void 0,\n\t\t\t\t    raw = void 0;\n\n\t\t\t\t// Process arguments.\n\t\t\t\twhile (args.length > 0) {\n\t\t\t\t\tvar arg = args.shift();\n\n\t\t\t\t\tswitch (arg) {\n\t\t\t\t\t\tcase 'play':\n\t\t\t\t\t\tcase 'pause':\n\t\t\t\t\t\tcase 'stop':\n\t\t\t\t\t\t\taction = arg;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fadein':\n\t\t\t\t\t\t\taction = 'fade';\n\t\t\t\t\t\t\tfadeTo = 1;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fadeout':\n\t\t\t\t\t\t\taction = 'fade';\n\t\t\t\t\t\t\tfadeTo = 0;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fadeto':\n\t\t\t\t\t\t\tif (args.length === 0) {\n\t\t\t\t\t\t\t\treturn this.error('fadeto missing required level value');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\taction = 'fade';\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\tfadeTo = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(fadeTo) || !isFinite(fadeTo)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse fadeto: ' + raw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fadeoverto':\n\t\t\t\t\t\t\tif (args.length < 2) {\n\t\t\t\t\t\t\t\tvar _errors = [];\n\t\t\t\t\t\t\t\tif (args.length < 1) {\n\t\t\t\t\t\t\t\t\t_errors.push('seconds');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (args.length < 2) {\n\t\t\t\t\t\t\t\t\t_errors.push('level');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn this.error('fadeoverto missing required ' + _errors.join(' and ') + (' value' + (_errors.length > 1 ? 's' : '')));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\taction = 'fade';\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\tfadeOver = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(fadeOver) || !isFinite(fadeOver)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse fadeoverto: ' + raw);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\tfadeTo = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(fadeTo) || !isFinite(fadeTo)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse fadeoverto: ' + raw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'volume':\n\t\t\t\t\t\t\tif (args.length === 0) {\n\t\t\t\t\t\t\t\treturn this.error('volume missing required level value');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\tvolume = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(volume) || !isFinite(volume)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse volume: ' + raw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'mute':\n\t\t\t\t\t\tcase 'unmute':\n\t\t\t\t\t\t\tmute = arg === 'mute';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'time':\n\t\t\t\t\t\t\tif (args.length === 0) {\n\t\t\t\t\t\t\t\treturn this.error('time missing required seconds value');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\ttime = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(time) || !isFinite(time)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse time: ' + raw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'loop':\n\t\t\t\t\t\tcase 'unloop':\n\t\t\t\t\t\t\tloop = arg === 'loop';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'goto':\n\t\t\t\t\t\t\tif (args.length === 0) {\n\t\t\t\t\t\t\t\treturn this.error('goto missing required passage title');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\traw = args.shift();\n\n\t\t\t\t\t\t\tif ((typeof raw === 'undefined' ? 'undefined' : _typeof(raw)) === 'object') {\n\t\t\t\t\t\t\t\t// Argument was in wiki link syntax.\n\t\t\t\t\t\t\t\tpassage = raw.link;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Argument was simply the passage name.\n\t\t\t\t\t\t\t\tpassage = raw;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!Story.has(passage)) {\n\t\t\t\t\t\t\t\treturn this.error('passage \"' + passage + '\" does not exist');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn this.error('unknown action: ' + arg);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tif (volume != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\taudio.volume = volume;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (time != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\taudio.time = time;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mute != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tif (mute) {\n\t\t\t\t\t\t\taudio.mute();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudio.unmute();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (loop != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tif (loop) {\n\t\t\t\t\t\t\taudio.loop();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudio.unloop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (passage != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\taudio.one('end', function () {\n\t\t\t\t\t\t\treturn Engine.play(passage);\n\t\t\t\t\t\t}); // execute the callback once only\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (action) {\n\t\t\t\t\t\tcase 'play':\n\t\t\t\t\t\t\taudio.play();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'pause':\n\t\t\t\t\t\t\taudio.pause();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'stop':\n\t\t\t\t\t\t\taudio.stop();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fade':\n\t\t\t\t\t\t\tif (audio.volume === fadeTo) {\n\t\t\t\t\t\t\t\tif (fadeTo === 0) {\n\t\t\t\t\t\t\t\t\taudio.volume = 1;\n\t\t\t\t\t\t\t\t} else if (fadeTo === 1) {\n\t\t\t\t\t\t\t\t\taudio.volume = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\taudio.fadeWithDuration(fadeOver, fadeTo);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Custom debug view setup.\n\t\t\t\t\tif (Config.debug) {\n\t\t\t\t\t\tthis.createDebugView();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn this.error('error playing audio: ' + e.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/*\n  \t<<fadeoutplayingaudio>>\n  */\n\t\tMacro.add('fadeoutplayingaudio', {\n\t\t\thandler: function handler() {\n\t\t\t\tvar tracks = Macro.get('cacheaudio').tracks,\n\t\t\t\t    fadeOver = this.args.length === 0 ? 5 : Number(this.args[0]);\n\n\t\t\t\tif (isNaN(fadeOver) || !isFinite(fadeOver) || fadeOver <= 0) {\n\t\t\t\t\treturn this.error('seconds value (' + this.args[0] + ') is not a finite number greater than zero');\n\t\t\t\t}\n\n\t\t\t\tObject.keys(tracks).filter(function (id) {\n\t\t\t\t\treturn tracks[id].isPlaying();\n\t\t\t\t}).forEach(function (id) {\n\t\t\t\t\tvar track = tracks[id];\n\t\t\t\t\ttrack.fadeWithDuration(fadeOver, 0);\n\t\t\t\t});\n\n\t\t\t\t// Custom debug view setup.\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tthis.createDebugView();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/*\n  \t<<stopallaudio>>\n  */\n\t\tMacro.add('stopallaudio', {\n\t\t\tskipArgs: true,\n\n\t\t\thandler: function handler() {\n\t\t\t\tvar tracks = Macro.get('cacheaudio').tracks;\n\t\t\t\tObject.keys(tracks).forEach(function (id) {\n\t\t\t\t\treturn tracks[id].stop();\n\t\t\t\t});\n\n\t\t\t\t// Custom debug view setup.\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tthis.createDebugView();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/*\n  \t<<playlist>>\n  */\n\t\tMacro.add('playlist', {\n\t\t\thandler: function handler() {\n\t\t\t\tif (this.args.length === 0) {\n\t\t\t\t\treturn this.error('no actions specified');\n\t\t\t\t}\n\n\t\t\t\tvar self = this.self,\n\t\t\t\t    args = this.args.slice(0);\n\t\t\t\tvar action = void 0,\n\t\t\t\t    volume = void 0,\n\t\t\t\t    mute = void 0,\n\t\t\t\t    loop = void 0,\n\t\t\t\t    shuffle = void 0,\n\t\t\t\t    fadeTo = void 0,\n\t\t\t\t    fadeOver = 5,\n\t\t\t\t    raw = void 0;\n\n\t\t\t\t// Process arguments.\n\t\t\t\twhile (args.length > 0) {\n\t\t\t\t\tvar arg = args.shift();\n\n\t\t\t\t\tswitch (arg) {\n\t\t\t\t\t\tcase 'play':\n\t\t\t\t\t\tcase 'pause':\n\t\t\t\t\t\tcase 'stop':\n\t\t\t\t\t\t\taction = arg;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fadein':\n\t\t\t\t\t\t\taction = 'fade';\n\t\t\t\t\t\t\tfadeTo = 1;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fadeout':\n\t\t\t\t\t\t\taction = 'fade';\n\t\t\t\t\t\t\tfadeTo = 0;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fadeto':\n\t\t\t\t\t\t\tif (args.length === 0) {\n\t\t\t\t\t\t\t\treturn this.error('fadeto missing required level value');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\taction = 'fade';\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\tfadeTo = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(fadeTo) || !isFinite(fadeTo)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse fadeto: ' + raw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fadeoverto':\n\t\t\t\t\t\t\tif (args.length < 2) {\n\t\t\t\t\t\t\t\tvar errors = [];\n\t\t\t\t\t\t\t\tif (args.length < 1) {\n\t\t\t\t\t\t\t\t\terrors.push('seconds');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (args.length < 2) {\n\t\t\t\t\t\t\t\t\terrors.push('level');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn this.error('fadeoverto missing required ' + errors.join(' and ') + (' value' + (errors.length > 1 ? 's' : '')));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\taction = 'fade';\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\tfadeOver = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(fadeOver) || !isFinite(fadeOver)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse fadeoverto: ' + raw);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\tfadeTo = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(fadeTo) || !isFinite(fadeTo)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse fadeoverto: ' + raw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'volume':\n\t\t\t\t\t\t\tif (args.length === 0) {\n\t\t\t\t\t\t\t\treturn this.error('volume missing required level value');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\traw = args.shift();\n\t\t\t\t\t\t\tvolume = parseFloat(raw);\n\n\t\t\t\t\t\t\tif (isNaN(volume) || !isFinite(volume)) {\n\t\t\t\t\t\t\t\treturn this.error('cannot parse volume: ' + raw);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'mute':\n\t\t\t\t\t\tcase 'unmute':\n\t\t\t\t\t\t\tmute = arg === 'mute';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'loop':\n\t\t\t\t\t\tcase 'unloop':\n\t\t\t\t\t\t\tloop = arg === 'loop';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'shuffle':\n\t\t\t\t\t\tcase 'unshuffle':\n\t\t\t\t\t\t\tshuffle = arg === 'shuffle';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn this.error('unknown action: ' + arg);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tif (volume != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tself.setVolume(volume);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mute != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tself.muted = mute;\n\n\t\t\t\t\t\tif (mute) {\n\t\t\t\t\t\t\tself.mute();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself.unmute();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (loop != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tself.loop = loop;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shuffle != null) {\n\t\t\t\t\t\t// lazy equality for null\n\t\t\t\t\t\tself.shuffle = shuffle;\n\t\t\t\t\t\tself.buildList();\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (action) {\n\t\t\t\t\t\tcase 'play':\n\t\t\t\t\t\t\tself.play();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'pause':\n\t\t\t\t\t\t\tself.pause();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'stop':\n\t\t\t\t\t\t\tself.stop();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'fade':\n\t\t\t\t\t\t\tif (self.volume === fadeTo) {\n\t\t\t\t\t\t\t\tif (fadeTo === 0) {\n\t\t\t\t\t\t\t\t\tself.setVolume(1);\n\t\t\t\t\t\t\t\t} else if (fadeTo === 1) {\n\t\t\t\t\t\t\t\t\tself.setVolume(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.fade(fadeOver, fadeTo);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Custom debug view setup.\n\t\t\t\t\tif (Config.debug) {\n\t\t\t\t\t\tthis.createDebugView();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn this.error('error playing audio: ' + e.message);\n\t\t\t\t}\n\t\t\t},\n\t\t\tplay: function play() {\n\t\t\t\tif (this.list.length === 0) {\n\t\t\t\t\tthis.buildList();\n\t\t\t\t}\n\n\t\t\t\tif (this.current === null || this.current.isEnded()) {\n\t\t\t\t\tif (!this.next()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.current.play();\n\t\t\t},\n\t\t\tpause: function pause() {\n\t\t\t\tif (this.current !== null) {\n\t\t\t\t\tthis.current.pause();\n\t\t\t\t}\n\t\t\t},\n\t\t\tstop: function stop() {\n\t\t\t\tif (this.current !== null) {\n\t\t\t\t\tthis.current.stop();\n\t\t\t\t}\n\t\t\t},\n\t\t\tfade: function fade(over, to) {\n\t\t\t\tif (this.list.length === 0) {\n\t\t\t\t\tthis.buildList();\n\t\t\t\t}\n\n\t\t\t\tif (this.current === null || this.current.isEnded()) {\n\t\t\t\t\tif (!this.next()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.current.volume = this.volume;\n\t\t\t\t}\n\n\t\t\t\tthis.current.fadeWithDuration(over, to);\n\t\t\t\tthis.volume = to; // kludgey, but necessary\n\t\t\t},\n\t\t\tmute: function mute() {\n\t\t\t\tif (this.current !== null) {\n\t\t\t\t\tthis.current.mute();\n\t\t\t\t}\n\t\t\t},\n\t\t\tunmute: function unmute() {\n\t\t\t\tif (this.current !== null) {\n\t\t\t\t\tthis.current.unmute();\n\t\t\t\t}\n\t\t\t},\n\t\t\tnext: function next() {\n\t\t\t\tthis.current = this.list.shift();\n\n\t\t\t\tif (this.current == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tthis.current = null;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (this.current.noSource()) {\n\t\t\t\t\treturn this.next();\n\t\t\t\t}\n\n\t\t\t\tthis.current.volume = this.volume;\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tsetVolume: function setVolume(vol) {\n\t\t\t\tthis.volume = vol;\n\n\t\t\t\tif (this.current !== null) {\n\t\t\t\t\tthis.current.volume = vol;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonEnd: function onEnd() {\n\t\t\t\tvar _this = Macro.get('playlist');\n\n\t\t\t\tif (_this.list.length === 0) {\n\t\t\t\t\tif (!_this.loop) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this.buildList();\n\t\t\t\t}\n\n\t\t\t\tif (!_this.next()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (_this.muted) {\n\t\t\t\t\t_this.mute();\n\t\t\t\t}\n\n\t\t\t\t_this.current.play();\n\t\t\t},\n\t\t\tbuildList: function buildList() {\n\t\t\t\tthis.list = this.tracks.slice(0);\n\n\t\t\t\tif (this.shuffle) {\n\t\t\t\t\tthis.list.shuffle();\n\n\t\t\t\t\t// Try not to immediately replay the last track when shuffling.\n\t\t\t\t\tif (this.list.length > 1 && this.list[0] === this.current) {\n\t\t\t\t\t\tthis.list.push(this.list.shift());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\n\t\t\ttracks: [],\n\t\t\tlist: [],\n\t\t\tcurrent: null,\n\t\t\tvolume: 1,\n\t\t\tmuted: false,\n\t\t\tloop: true,\n\t\t\tshuffle: false\n\t\t});\n\n\t\t/*\n  \t<<setplaylist>>\n  */\n\t\tMacro.add('setplaylist', {\n\t\t\thandler: function handler() {\n\t\t\t\tif (this.args.length === 0) {\n\t\t\t\t\treturn this.error('no track ID(s) specified');\n\t\t\t\t}\n\n\t\t\t\tvar tracks = Macro.get('cacheaudio').tracks,\n\t\t\t\t    playlist = Macro.get('playlist'),\n\t\t\t\t    list = [];\n\n\t\t\t\tfor (var i = 0; i < this.args.length; ++i) {\n\t\t\t\t\tvar id = this.args[i];\n\n\t\t\t\t\tif (!tracks.hasOwnProperty(id)) {\n\t\t\t\t\t\treturn this.error('track \"' + id + '\" does not exist');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar track = tracks[id].clone();\n\t\t\t\t\ttrack.stop();\n\t\t\t\t\ttrack.unloop();\n\t\t\t\t\ttrack.unmute();\n\t\t\t\t\ttrack.volume = 1;\n\t\t\t\t\tjQuery(track.audio).on('ended.macro-playlist', playlist.onEnd);\n\t\t\t\t\tlist.push(track);\n\t\t\t\t}\n\n\t\t\t\tif (playlist.current !== null) {\n\t\t\t\t\tplaylist.current.pause();\n\t\t\t\t}\n\n\t\t\t\tplaylist.tracks = list;\n\t\t\t\tplaylist.list = [];\n\t\t\t\tplaylist.current = null;\n\t\t\t\tplaylist.volume = 1;\n\t\t\t\tplaylist.muted = false;\n\t\t\t\tplaylist.loop = true;\n\t\t\t\tplaylist.shuffle = false;\n\n\t\t\t\t// Custom debug view setup.\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tthis.createDebugView();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/*******************************************************************************************************************\n  * Miscellaneous Macros.\n  ******************************************************************************************************************/\n\t/*\n \t<<goto>>\n */\n\tMacro.add('goto', {\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no passage specified');\n\t\t\t}\n\n\t\t\tvar passage = void 0;\n\n\t\t\tif (_typeof(this.args[0]) === 'object') {\n\t\t\t\t// Argument was in wiki link syntax.\n\t\t\t\tpassage = this.args[0].link;\n\t\t\t} else {\n\t\t\t\t// Argument was simply the passage name.\n\t\t\t\tpassage = this.args[0];\n\t\t\t}\n\n\t\t\tif (!Story.has(passage)) {\n\t\t\t\treturn this.error('passage \"' + passage + '\" does not exist');\n\t\t\t}\n\n\t\t\t/*\n   \tCall `Engine.play()`.\n   \t\tn.b. This does not terminate the current Wikifier call chain, though, ideally, it\n   \t     probably should.  Doing so would not be trivial, however, and then there's the\n   \t     question of whether that behavior would be unwanted by users, who are used to\n   \t     the current behavior from similar macros and constructs.\n   */\n\t\t\tsetTimeout(function () {\n\t\t\t\treturn Engine.play(passage);\n\t\t\t}, Engine.minDomActionDelay);\n\t\t}\n\t});\n\n\t/*\n \t<<timed>> & <<next>>\n */\n\tMacro.add('timed', {\n\t\ttags: ['next'],\n\t\ttimers: new Set(),\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no time value specified in <<timed>>');\n\t\t\t}\n\n\t\t\tvar items = [];\n\n\t\t\ttry {\n\t\t\t\titems.push({\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tsource: this.source,\n\t\t\t\t\tdelay: Math.max(Engine.minDomActionDelay, Util.fromCssTime(this.args[0])),\n\t\t\t\t\tcontent: this.payload[0].contents\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error(e.message + ' in <<timed>>');\n\t\t\t}\n\n\t\t\tif (this.payload.length > 1) {\n\t\t\t\tvar i = void 0;\n\n\t\t\t\ttry {\n\t\t\t\t\tvar len = void 0;\n\n\t\t\t\t\tfor (i = 1, len = this.payload.length; i < len; ++i) {\n\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\tname: this.payload[i].name,\n\t\t\t\t\t\t\tsource: this.payload[i].source,\n\t\t\t\t\t\t\tdelay: this.payload[i].args.length === 0 ? items[items.length - 1].delay : Math.max(Engine.minDomActionDelay, Util.fromCssTime(this.payload[i].args[0])),\n\t\t\t\t\t\t\tcontent: this.payload[i].contents\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn this.error(e.message + ' in <<next>> (#' + i + ')');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ block: true });\n\t\t\t}\n\n\t\t\t// Register the timer and, possibly, a cleanup task.\n\t\t\tthis.self.registerTimeout(jQuery(document.createElement('span')).addClass('macro-' + this.name).appendTo(this.output), items, this.args.length > 1 && /^(?:transition|t8n)$/.test(this.args[1]));\n\t\t},\n\t\tregisterTimeout: function registerTimeout($output, items, transition) {\n\t\t\tvar turnId = State.turns,\n\t\t\t    timers = this.timers;\n\t\t\tvar timerId = null,\n\t\t\t    nextItem = items.shift();\n\n\t\t\tvar worker = function worker() {\n\t\t\t\t/*\n    \t1. Bookkeeping.\n    */\n\t\t\t\ttimers.delete(timerId);\n\n\t\t\t\tif (turnId !== State.turns) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t/*\n    \t2. Set the current item and setup the next worker, if any.\n    */\n\t\t\t\tvar curItem = nextItem;\n\n\t\t\t\tif ((nextItem = items.shift()) != null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\ttimerId = setTimeout(worker, nextItem.delay);\n\t\t\t\t\ttimers.add(timerId);\n\t\t\t\t}\n\n\t\t\t\t/*\n    \t3. Wikify the content last to reduce temporal drift.\n    */\n\t\t\t\tvar frag = document.createDocumentFragment();\n\t\t\t\tnew Wikifier(frag, curItem.content);\n\n\t\t\t\t/*\n    \t4. Output.\n    */\n\t\t\t\t// Custom debug view setup for `<<next>>`.\n\t\t\t\tif (Config.debug && curItem.name === 'next') {\n\t\t\t\t\t$output = jQuery(new DebugView( // eslint-disable-line no-param-reassign\n\t\t\t\t\t$output[0], 'macro', curItem.name, curItem.source).output);\n\t\t\t\t}\n\n\t\t\t\tif (transition) {\n\t\t\t\t\t$output = jQuery(document.createElement('span')) // eslint-disable-line no-param-reassign\n\t\t\t\t\t.addClass('macro-timed-insert macro-timed-in').appendTo($output);\n\t\t\t\t}\n\n\t\t\t\t$output.append(frag);\n\n\t\t\t\tif (transition) {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\treturn $output.removeClass('macro-timed-in');\n\t\t\t\t\t}, Engine.minDomActionDelay);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Setup the timeout.\n\t\t\ttimerId = setTimeout(worker, nextItem.delay);\n\t\t\ttimers.add(timerId);\n\n\t\t\t// Setup a single-use `prehistory` task to remove pending timers.\n\t\t\tif (!prehistory.hasOwnProperty('#timed-timers-cleanup')) {\n\t\t\t\tprehistory['#timed-timers-cleanup'] = function (task) {\n\t\t\t\t\ttimers.forEach(function (timerId) {\n\t\t\t\t\t\treturn clearTimeout(timerId);\n\t\t\t\t\t}); // eslint-disable-line no-shadow\n\t\t\t\t\ttimers.clear();\n\t\t\t\t\tdelete prehistory[task]; // single-use task\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<repeat>> & <<stop>>\n */\n\tMacro.add('repeat', {\n\t\ttags: null,\n\t\ttimers: new Set(),\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no time value specified');\n\t\t\t}\n\n\t\t\tvar delay = void 0;\n\n\t\t\ttry {\n\t\t\t\tdelay = Math.max(Engine.minDomActionDelay, Util.fromCssTime(this.args[0]));\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error(e.message);\n\t\t\t}\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ block: true });\n\t\t\t}\n\n\t\t\t// Register the timer and, possibly, a cleanup task.\n\t\t\tthis.self.registerInterval(jQuery(document.createElement('span')).addClass('macro-' + this.name).appendTo(this.output), this.payload[0].contents, delay, this.args.length > 1 && /^(?:transition|t8n)$/.test(this.args[1]));\n\t\t},\n\t\tregisterInterval: function registerInterval($output, content, delay, transition) {\n\t\t\tvar turnId = State.turns,\n\t\t\t    timers = this.timers;\n\t\t\tvar timerId = null;\n\n\t\t\t// Setup the interval.\n\t\t\ttimerId = setInterval(function () {\n\t\t\t\t// Terminate the timer if the turn IDs do not match.\n\t\t\t\tif (turnId !== State.turns) {\n\t\t\t\t\tclearInterval(timerId);\n\t\t\t\t\ttimers.delete(timerId);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar timerIdCache = void 0;\n\t\t\t\t/*\n    \tThere's no catch clause because this try/finally is here simply to ensure that\n    \tproper cleanup is done in the event that an exception is thrown during the\n    \t`Wikifier` call.\n    */\n\t\t\t\ttry {\n\t\t\t\t\tTempState.break = null;\n\n\t\t\t\t\t// Setup the `repeatTimerId` value, caching the existing value, if necessary.\n\t\t\t\t\tif (TempState.hasOwnProperty('repeatTimerId')) {\n\t\t\t\t\t\ttimerIdCache = TempState.repeatTimerId;\n\t\t\t\t\t}\n\t\t\t\t\tTempState.repeatTimerId = timerId;\n\n\t\t\t\t\t// Wikify the content.\n\t\t\t\t\tvar frag = document.createDocumentFragment();\n\t\t\t\t\tnew Wikifier(frag, content);\n\n\t\t\t\t\tif (transition) {\n\t\t\t\t\t\t$output = jQuery(document.createElement('span')) // eslint-disable-line no-param-reassign\n\t\t\t\t\t\t.addClass('macro-repeat-insert macro-repeat-in').appendTo($output);\n\t\t\t\t\t}\n\n\t\t\t\t\t$output.append(frag);\n\n\t\t\t\t\tif (transition) {\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\treturn $output.removeClass('macro-repeat-in');\n\t\t\t\t\t\t}, Engine.minDomActionDelay);\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\t// Teardown the `repeatTimerId` property, restoring the cached value, if necessary.\n\t\t\t\t\tif (typeof timerIdCache !== 'undefined') {\n\t\t\t\t\t\tTempState.repeatTimerId = timerIdCache;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete TempState.repeatTimerId;\n\t\t\t\t\t}\n\n\t\t\t\t\tTempState.break = null;\n\t\t\t\t}\n\t\t\t}, delay);\n\t\t\ttimers.add(timerId);\n\n\t\t\t// Setup a single-use `prehistory` task to remove pending timers.\n\t\t\tif (!prehistory.hasOwnProperty('#repeat-timers-cleanup')) {\n\t\t\t\tprehistory['#repeat-timers-cleanup'] = function (task) {\n\t\t\t\t\ttimers.forEach(function (timerId) {\n\t\t\t\t\t\treturn clearInterval(timerId);\n\t\t\t\t\t});\n\t\t\t\t\ttimers.clear();\n\t\t\t\t\tdelete prehistory[task]; // single-use task\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t});\n\tMacro.add('stop', {\n\t\tskipArgs: true,\n\n\t\thandler: function handler() {\n\t\t\tif (!TempState.hasOwnProperty('repeatTimerId')) {\n\t\t\t\treturn this.error('must only be used in conjunction with its parent macro <<repeat>>');\n\t\t\t}\n\n\t\t\tvar timers = Macro.get('repeat').timers,\n\t\t\t    timerId = TempState.repeatTimerId;\n\t\t\tclearInterval(timerId);\n\t\t\ttimers.delete(timerId);\n\t\t\tTempState.break = 2;\n\n\t\t\t// Custom debug view setup.\n\t\t\tif (Config.debug) {\n\t\t\t\tthis.debugView.modes({ hidden: true });\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n \t<<widget>>\n */\n\tMacro.add('widget', {\n\t\ttags: null,\n\n\t\thandler: function handler() {\n\t\t\tif (this.args.length === 0) {\n\t\t\t\treturn this.error('no widget name specified');\n\t\t\t}\n\n\t\t\tvar widgetName = this.args[0];\n\n\t\t\tif (Macro.has(widgetName)) {\n\t\t\t\tif (!Macro.get(widgetName).isWidget) {\n\t\t\t\t\treturn this.error('cannot clobber existing macro \"' + widgetName + '\"');\n\t\t\t\t}\n\n\t\t\t\t// Delete the existing widget.\n\t\t\t\tMacro.delete(widgetName);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMacro.add(widgetName, {\n\t\t\t\t\tisWidget: true,\n\t\t\t\t\thandler: function (contents) {\n\t\t\t\t\t\treturn function () {\n\t\t\t\t\t\t\tvar _this7 = this;\n\n\t\t\t\t\t\t\tvar argsCache = void 0;\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tvar _ret5 = function () {\n\t\t\t\t\t\t\t\t\t// Setup the `$args` variable, caching the existing value if necessary.\n\t\t\t\t\t\t\t\t\tif (State.variables.hasOwnProperty('args')) {\n\t\t\t\t\t\t\t\t\t\targsCache = State.variables.args;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tState.variables.args = [];\n\n\t\t\t\t\t\t\t\t\tfor (var i = 0, len = _this7.args.length; i < len; ++i) {\n\t\t\t\t\t\t\t\t\t\tState.variables.args[i] = _this7.args[i];\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tState.variables.args.raw = _this7.args.raw;\n\t\t\t\t\t\t\t\t\tState.variables.args.full = _this7.args.full;\n\n\t\t\t\t\t\t\t\t\t// Setup the error trapping variables.\n\t\t\t\t\t\t\t\t\tvar resFrag = document.createDocumentFragment(),\n\t\t\t\t\t\t\t\t\t    errList = [];\n\n\t\t\t\t\t\t\t\t\t// Wikify the widget contents.\n\t\t\t\t\t\t\t\t\tnew Wikifier(resFrag, contents);\n\n\t\t\t\t\t\t\t\t\t// Carry over the output, unless there were errors.\n\t\t\t\t\t\t\t\t\tArray.from(resFrag.querySelectorAll('.error')).forEach(function (errEl) {\n\t\t\t\t\t\t\t\t\t\terrList.push(errEl.textContent);\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tif (errList.length === 0) {\n\t\t\t\t\t\t\t\t\t\t_this7.output.appendChild(resFrag);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\tv: _this7.error('error' + (errList.length > 1 ? 's' : '') + ' within' + (' widget contents (' + errList.join('; ') + ')'))\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}();\n\n\t\t\t\t\t\t\t\tif ((typeof _ret5 === 'undefined' ? 'undefined' : _typeof(_ret5)) === \"object\") return _ret5.v;\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\treturn this.error('cannot execute widget: ' + e.message);\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t// Teardown the `$args` variable, restoring the cached value if necessary.\n\t\t\t\t\t\t\t\tif (typeof argsCache !== 'undefined') {\n\t\t\t\t\t\t\t\t\tState.variables.args = argsCache;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdelete State.variables.args;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}(this.payload[0].contents)\n\t\t\t\t});\n\n\t\t\t\t// Custom debug view setup.\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tthis.createDebugView(this.name, this.source + this.payload[0].contents + '<</' + this.name + '>>');\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\treturn this.error('cannot create widget macro \"' + widgetName + '\": ' + e.message);\n\t\t\t}\n\t\t}\n\t});\n})();\n\n/***********************************************************************************************************************\n *\n * dialog.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Engine, safeActiveElement, strings */\n\nvar Dialog = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar _$overlay = null,\n\t    _$dialog = null,\n\t    _$dialogTitle = null,\n\t    _$dialogBody = null,\n\t    _lastActive = null,\n\t    _scrollbarWidth = 0;\n\n\t/*******************************************************************************************************************\n  * Core Functions.\n  ******************************************************************************************************************/\n\tfunction dialogInit() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Dialog/dialogInit()]');\n\t\t}\n\n\t\t/*\n  \tCalculate and cache the width of scrollbars.\n  */\n\t\t_scrollbarWidth = function () {\n\t\t\tvar scrollbarWidth = void 0;\n\n\t\t\ttry {\n\t\t\t\tvar inner = document.createElement('p'),\n\t\t\t\t    outer = document.createElement('div');\n\n\t\t\t\tinner.style.width = '100%';\n\t\t\t\tinner.style.height = '200px';\n\t\t\t\touter.style.position = 'absolute';\n\t\t\t\touter.style.left = '0px';\n\t\t\t\touter.style.top = '0px';\n\t\t\t\touter.style.width = '100px';\n\t\t\t\touter.style.height = '100px';\n\t\t\t\touter.style.visibility = 'hidden';\n\t\t\t\touter.style.overflow = 'hidden';\n\n\t\t\t\touter.appendChild(inner);\n\t\t\t\tdocument.body.appendChild(outer);\n\n\t\t\t\tvar w1 = inner.offsetWidth;\n\t\t\t\t/*\n    \tThe `overflow: scroll` style property value does not work consistently\n    \twith scrollbars which are styled with `::-webkit-scrollbar`, so we use\n    \t`overflow: auto` with dimensions guaranteed to force a scrollbar.\n    */\n\t\t\t\touter.style.overflow = 'auto';\n\t\t\t\tvar w2 = inner.offsetWidth;\n\n\t\t\t\tif (w1 === w2) {\n\t\t\t\t\tw2 = outer.clientWidth;\n\t\t\t\t}\n\n\t\t\t\tdocument.body.removeChild(outer);\n\n\t\t\t\tscrollbarWidth = w1 - w2;\n\t\t\t} catch (e) {/* no-op */}\n\n\t\t\treturn scrollbarWidth || 17; // 17px is a reasonable failover\n\t\t}();\n\n\t\t/*\n  \tGenerate the dialog elements.\n  */\n\t\tvar $uiTree = jQuery(document.createDocumentFragment()).append(\n\t\t/* eslint-disable max-len */\n\t\t'<div id=\"ui-overlay\" class=\"ui-close\"></div>' + '<div id=\"ui-dialog\" tabindex=\"0\" role=\"dialog\" aria-labelledby=\"ui-dialog-title\">' + '<div id=\"ui-dialog-titlebar\">' + '<h1 id=\"ui-dialog-title\"></h1>' + ('<button id=\"ui-dialog-close\" class=\"ui-close\" tabindex=\"0\" aria-label=\"' + strings.close + '\"></button>') + '</div>' + '<div id=\"ui-dialog-body\"></div>' + '</div>'\n\t\t/* eslint-enable max-len */\n\t\t);\n\n\t\t/*\n  \tCache the dialog elements, since they're going to be used often.\n  \t\tn.b. We rewrap the elements themselves, rather than simply using the results of\n  \t     `find()`, so that we cache uncluttered jQuery-wrappers (i.e. `context` refers\n  \t     to the elements and there is no `prevObject`).\n  */\n\t\t_$overlay = jQuery($uiTree.find('#ui-overlay').get(0));\n\t\t_$dialog = jQuery($uiTree.find('#ui-dialog').get(0));\n\t\t_$dialogTitle = jQuery($uiTree.find('#ui-dialog-title').get(0));\n\t\t_$dialogBody = jQuery($uiTree.find('#ui-dialog-body').get(0));\n\n\t\t/*\n  \tInsert the dialog elements into the page before the store area.\n  */\n\n\t\t// OLDFASHIONED\n\t\t$('#hud').prepend($uiTree);\n\t\t//$uiTree.insertBefore('#store-area');\n\t}\n\n\t/*******************************************************************************************************************\n  * Dialog Functions.\n  ******************************************************************************************************************/\n\tfunction dialogIsOpen(classNames) {\n\t\treturn _$dialog.hasClass('open') && (classNames ? classNames.splitOrEmpty(/\\s+/).every(function (c) {\n\t\t\treturn _$dialogBody.hasClass(c);\n\t\t}) : true);\n\t}\n\n\tfunction dialogBody() {\n\t\treturn _$dialogBody.get(0);\n\t}\n\n\tfunction dialogSetup(title, classNames) {\n\t\t_$dialogBody.empty().removeClass();\n\n\t\tif (classNames != null) {\n\t\t\t// lazy equality for null\n\t\t\t_$dialogBody.addClass(classNames);\n\t\t}\n\n\t\t_$dialogTitle.empty().append((title != null ? String(title) : '') || ' '); // lazy equality for null\n\t\treturn _$dialogBody.get(0);\n\t}\n\n\t/**\n \tAdds a click hander to the target element(s) which opens the dialog modal.\n **/\n\tfunction dialogAddClickHandler(targets, options, startFn, doneFn, closeFn) {\n\t\treturn jQuery(targets).ariaClick(function (evt) {\n\t\t\tevt.preventDefault();\n\n\t\t\t// Call the start function.\n\t\t\tif (typeof startFn === 'function') {\n\t\t\t\tstartFn(evt);\n\t\t\t}\n\n\t\t\t// Open the dialog.\n\t\t\tdialogOpen(options, closeFn);\n\n\t\t\t// Call the done function.\n\t\t\tif (typeof doneFn === 'function') {\n\t\t\t\tdoneFn(evt);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction dialogOpen(options, closeFn) {\n\t\tvar _jQuery$extend = jQuery.extend({ top: 50 }, options);\n\n\t\tvar top = _jQuery$extend.top;\n\n\t\t// Record the last active/focused non-dialog element.\n\n\t\tif (!dialogIsOpen()) {\n\t\t\t_lastActive = safeActiveElement();\n\t\t}\n\n\t\t// Add the <html> level class (mostly used to style <body>).\n\t\tjQuery(document.documentElement).addClass('ui-dialog-open');\n\n\t\t// Display the overlay.\n\t\t_$overlay.addClass('open');\n\n\t\t// Add the imagesLoaded handler to the dialog body, if necessary.\n\t\t// n.b. We use `querySelector()` as jQuery has no equivalent.\n\t\tif (_$dialogBody[0].querySelector('img') !== null) {\n\t\t\t_$dialogBody.imagesLoaded().always(function () {\n\t\t\t\treturn dialogResizeHandler({ data: { top: top } });\n\t\t\t});\n\t\t}\n\n\t\t// Add `aria-hidden=true` to all direct non-dialog-children of <body> to\n\t\t// hide the underlying page form screen readers while the dialog is open.\n\t\tjQuery('body>:not(script,#store-area,#ui-bar,#ui-overlay,#ui-dialog)').attr('tabindex', -3).attr('aria-hidden', true);\n\t\tjQuery('#ui-bar,#story').find('[tabindex]:not([tabindex^=-])').attr('tabindex', -2).attr('aria-hidden', true);\n\n\t\t// Display the dialog.\n\t\tvar position = dialogCalcPosition(top);\n\t\t_$dialog.css(position).addClass('open').focus();\n\n\t\t// Add the UI resize handler.\n\t\tjQuery(window).on('resize.ui-resize', null, { top: top }, jQuery.throttle(40, dialogResizeHandler));\n\n\t\t// Setup the delegated UI close handler.\n\t\tjQuery(document).on('click.ui-close', '.ui-close', { closeFn: closeFn }, dialogClose) // yes, namespace and class have the same name\n\t\t.on('keypress.ui-close', '.ui-close', function (evt) {\n\t\t\t// 13 is Enter/Return, 32 is Space.\n\t\t\tif (evt.which === 13 || evt.which === 32) {\n\t\t\t\tjQuery(this).trigger('click');\n\t\t\t}\n\t\t});\n\n\t\t// Trigger a global `tw:dialogopened` event.\n\t\tsetTimeout(function () {\n\t\t\treturn jQuery.event.trigger('tw:dialogopened');\n\t\t}, Engine.minDomActionDelay);\n\t}\n\n\tfunction dialogClose(evt) {\n\t\t// Largely reverse the actions taken in `dialogOpen()`.\n\t\tjQuery(document).off('.ui-close'); // namespace, not to be confused with the class by the same name\n\t\tjQuery(window).off('resize.ui-resize');\n\t\t_$dialog.removeClass('open').css({ left: '', right: '', top: '', bottom: '' });\n\n\t\tjQuery('#ui-bar,#story').find('[tabindex=-2]').removeAttr('aria-hidden').attr('tabindex', 0);\n\t\tjQuery('body>[tabindex=-3]').removeAttr('aria-hidden').removeAttr('tabindex');\n\n\t\t_$dialogTitle.empty();\n\t\t_$dialogBody.empty().removeClass();\n\t\t_$overlay.removeClass('open');\n\t\tjQuery(document.documentElement).removeClass('ui-dialog-open');\n\n\t\t// Attempt to restore focus to whichever element had it prior to opening the dialog.\n\t\tif (_lastActive !== null) {\n\t\t\tjQuery(_lastActive).focus();\n\t\t\t_lastActive = null;\n\t\t}\n\n\t\t// Call the given \"on close\" callback function, if any.\n\t\tif (evt && evt.data && typeof evt.data.closeFn === 'function') {\n\t\t\tevt.data.closeFn(evt);\n\t\t}\n\n\t\t// Trigger a global `tw:dialogclosed` event.\n\t\tsetTimeout(function () {\n\t\t\treturn jQuery.event.trigger('tw:dialogclosed');\n\t\t}, Engine.minDomActionDelay);\n\t}\n\n\tfunction dialogResizeHandler(evt) {\n\t\tvar top = evt && evt.data && typeof evt.data.top !== 'undefined' ? evt.data.top : 50;\n\n\t\tif (_$dialog.css('display') === 'block') {\n\t\t\t// Stow the dialog.\n\t\t\t_$dialog.css({ display: 'none' });\n\n\t\t\t// Restore the dialog with its new positional properties.\n\t\t\t_$dialog.css(jQuery.extend({ display: '' }, dialogCalcPosition(top)));\n\t\t}\n\t}\n\n\tfunction dialogCalcPosition(topPos) {\n\t\tvar top = topPos != null ? topPos : 50,\n\t\t    // lazy equality for null\n\t\t$parent = jQuery(window),\n\t\t    dialogPos = { left: '', right: '', top: '', bottom: '' };\n\n\t\t// Unset the dialog's positional properties before checking its dimensions.\n\t\t_$dialog.css(dialogPos);\n\n\t\tvar horzSpace = $parent.width() - _$dialog.outerWidth(true) - 1,\n\t\t    // -1 to address a Firefox issue\n\t\tvertSpace = $parent.height() - _$dialog.outerHeight(true) - 1; // -1 to address a Firefox issue\n\n\t\tif (horzSpace <= 32 + _scrollbarWidth) {\n\t\t\tvertSpace -= _scrollbarWidth;\n\t\t}\n\t\tif (vertSpace <= 32 + _scrollbarWidth) {\n\t\t\thorzSpace -= _scrollbarWidth;\n\t\t}\n\n\t\tif (horzSpace <= 32) {\n\t\t\tdialogPos.left = dialogPos.right = 16;\n\t\t} else {\n\t\t\tdialogPos.left = dialogPos.right = ~~(horzSpace / 2);\n\t\t}\n\n\t\tif (vertSpace <= 32) {\n\t\t\tdialogPos.top = dialogPos.bottom = 16;\n\t\t} else {\n\t\t\tif (vertSpace / 2 > top) {\n\t\t\t\tdialogPos.top = top;\n\t\t\t} else {\n\t\t\t\tdialogPos.top = dialogPos.bottom = ~~(vertSpace / 2);\n\t\t\t}\n\t\t}\n\n\t\tObject.keys(dialogPos).forEach(function (p) {\n\t\t\tif (dialogPos[p] !== '') {\n\t\t\t\tdialogPos[p] += 'px';\n\t\t\t}\n\t\t});\n\n\t\treturn dialogPos;\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\tinit: { value: dialogInit },\n\t\tisOpen: { value: dialogIsOpen },\n\t\tbody: { value: dialogBody },\n\t\tsetup: { value: dialogSetup },\n\t\taddClickHandler: { value: dialogAddClickHandler },\n\t\topen: { value: dialogOpen },\n\t\tclose: { value: dialogClose },\n\t\tresize: { value: function value() {\n\t\t\t\treturn dialogResizeHandler();\n\t\t\t} } // Forbid params on the exported method.\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * engine.js\n *\n * Copyright © 2015–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/*\n\tglobal Alert, Config, DebugView, Save, State, Story, TempVariables:true, UI, Wikifier, postdisplay, predisplay,\n\t       prehistory\n*/\n\nvar Engine = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar\n\t// Minimum delay for DOM actions (in milliseconds).\n\tminDomActionDelay = 40;\n\n\tvar\n\t// Current state of the engine (values: 'idle', 'playing', 'rendering').\n\t_state = 'idle',\n\n\n\t// Last time `enginePlay()` was called (in milliseconds).\n\t_lastPlay = null,\n\n\n\t// Cache of the debug view for the StoryInit special passage.\n\t_storyInitDebugView = null;\n\n\t/*******************************************************************************************************************\n  * Engine Functions.\n  ******************************************************************************************************************/\n\tfunction engineStart() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Engine/engineStart()]');\n\t\t}\n\n\t\t/*\n  \tExecute the StoryInit special passage.\n  */\n\t\tif (Story.has('StoryInit')) {\n\t\t\ttry {\n\t\t\t\tvar debugBuffer = Wikifier.wikifyEval(Story.get('StoryInit').text);\n\n\t\t\t\tif (Config.debug) {\n\t\t\t\t\tvar debugView = new DebugView(document.createDocumentFragment(), 'special', 'StoryInit', 'StoryInit');\n\t\t\t\t\tdebugView.modes({ hidden: true });\n\t\t\t\t\tdebugView.append(debugBuffer);\n\t\t\t\t\t_storyInitDebugView = debugView.output;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tAlert.error('StoryInit', e.message);\n\t\t\t}\n\t\t}\n\n\t\t/*\n  \tFinalize various `Config` properties here, before any passages are displayed.\n  \t\tn.b. We do this here to give authors every opportunity to modify these properties.\n  */\n\t\tConfig.history.maxStates = Math.max(0, Config.history.maxStates);\n\n\t\tif (isNaN(Config.history.maxStates) || !isFinite(Config.history.maxStates)) {\n\t\t\t// TODO: Maybe this should throw instead?\n\t\t\tConfig.history.maxStates = 100;\n\t\t}\n\n\t\tif (Config.history.maxStates === 1) {\n\t\t\tConfig.history.controls = false;\n\t\t}\n\n\t\tif (Config.debug) {\n\t\t\tDebugView.init();\n\t\t}\n\n\t\t/*\n  \tAttempt to restore an active session.  Failing that, attempt to autoload the autosave,\n  \tif requested.  Failing that, display the starting passage.\n  */\n\t\tif (Config.passages.start == null) {\n\t\t\t// lazy equality for null\n\t\t\tthrow new Error('starting passage not selected');\n\t\t}\n\n\t\tif (!Story.has(Config.passages.start)) {\n\t\t\tthrow new Error('starting passage (\"' + Config.passages.start + '\") not found');\n\t\t}\n\n\t\tif (State.restore()) {\n\t\t\tengineShow();\n\t\t} else {\n\t\t\tvar loadStart = true;\n\n\t\t\tswitch (_typeof(Config.saves.autoload)) {\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tif (Config.saves.autoload && Save.autosave.ok() && Save.autosave.has()) {\n\t\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\t\tconsole.log('\\tattempting autoload: \"' + Save.autosave.get().title + '\"');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tloadStart = !Save.autosave.load();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'string':\n\t\t\t\t\tif (Config.saves.autoload === 'prompt' && Save.autosave.ok() && Save.autosave.has()) {\n\t\t\t\t\t\tloadStart = false;\n\t\t\t\t\t\tUI.buildDialogAutoload();\n\t\t\t\t\t\tUI.open();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'function':\n\t\t\t\t\tif (Save.autosave.ok() && Save.autosave.has() && !!Config.saves.autoload()) {\n\t\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\t\tconsole.log('\\tattempting autoload: \"' + Save.autosave.get().title + '\"');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tloadStart = !Save.autosave.load();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (loadStart) {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('\\tstarting passage: \"' + Config.passages.start + '\"');\n\t\t\t\t}\n\n\t\t\t\tenginePlay(Config.passages.start);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n \tRestarts the story.\n **/\n\tfunction engineRestart() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Engine/engineRestart()]');\n\t\t}\n\n\t\t/*\n  \tTrigger the loading screen to hide any unsightly rendering shenanigans during\n  \tthe page reload.\n  */\n\t\tjQuery(document.documentElement).addClass('init-loading');\n\n\t\t/*\n  \tScroll the window to the top.\n  \t\tThis is required by most browsers for the starting passage or it will remain at\n  \twhatever its current scroll position is after the page reload.  We do it generally,\n  \trather than only for the currently set starting passage, since the starting passage\n  \tmay be dynamically manipulated.\n  */\n\t\twindow.scroll(0, 0);\n\n\t\t/*\n  \tDelete the active session and reload the page.\n  */\n\t\tState.reset();\n\t\twindow.location.reload();\n\t}\n\n\t/**\n \tReturns the current state of the engine.\n **/\n\tfunction engineState() {\n\t\treturn _state;\n\t}\n\n\t/**\n \tReturns the last time `enginePlay()` was called (in milliseconds).\n **/\n\tfunction engineLastPlay() {\n\t\treturn _lastPlay;\n\t}\n\n\t/**\n \tActivate the moment at the given index within the state history and show it.\n **/\n\tfunction engineGoTo(idx) {\n\t\tvar succeded = State.goTo(idx);\n\n\t\tif (succeded) {\n\t\t\tengineShow();\n\t\t}\n\n\t\treturn succeded;\n\t}\n\n\t/**\n \tActivate the moment at the given offset from the active moment within the state history\n \tand show it.\n **/\n\tfunction engineGo(offset) {\n\t\tvar succeded = State.go(offset);\n\n\t\tif (succeded) {\n\t\t\tengineShow();\n\t\t}\n\n\t\treturn succeded;\n\t}\n\n\t/**\n \tGo to the moment which directly precedes the active moment and show it.\n **/\n\tfunction engineBackward() {\n\t\treturn engineGo(-1);\n\t}\n\n\t/**\n \tGo to the moment which directly follows the active moment and show it.\n **/\n\tfunction engineForward() {\n\t\treturn engineGo(1);\n\t}\n\n\t/**\n \tRenders and displays the active (present) moment's associated passage without adding\n \ta new moment to the history.\n **/\n\tfunction engineShow() {\n\t\treturn enginePlay(State.passage, true);\n\t}\n\n\t/**\n \tRenders and displays the passage referenced by the given title, optionally without\n \tadding a new moment to the history.\n **/\n\tfunction enginePlay(title, noHistory) {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Engine/enginePlay(title: \"' + title + '\", noHistory: ' + noHistory + ')]');\n\t\t}\n\n\t\t/*\n  \tUpdate the engine state.\n  */\n\t\t_state = 'playing';\n\n\t\t/*\n  \tReset the temporary state and variables objects.\n  */\n\t\tTempState = {}; // eslint-disable-line no-undef\n\t\tTempVariables = {};\n\n\t\t// We must also update the `window.SugarCube` debugging references.\n\t\t// window.SugarCube.TempState = TempState;\n\t\twindow.SugarCube.TempVariables = TempVariables;\n\n\t\t/*\n  \tDebug view setup.\n  */\n\t\tvar passageReadyOutput = void 0,\n\t\t    passageDoneOutput = void 0;\n\n\t\t/*\n  \tRetrieve the passage by the given title.\n  \t\tn.b. The `title` parameter may be empty, a string, or a number (though using a number\n  \t     as reference to a numeric title should be discouraged), so after loading the\n  \t     passage, always refer to `passage.title` and never the `title` parameter.\n  */\n\t\tvar passage = Story.get(title);\n\n\t\t/*\n  \tExecute the pre-history tasks.\n  */\n\t\tObject.keys(prehistory).forEach(function (task) {\n\t\t\tif (typeof prehistory[task] === 'function') {\n\t\t\t\tprehistory[task].call(this, task);\n\t\t\t}\n\t\t}, passage);\n\n\t\t/*\n  \tCreate a new entry in the history.\n  */\n\t\tif (!noHistory) {\n\t\t\tState.create(passage.title);\n\t\t}\n\n\t\t/*\n  \tClear `<body>` classes, then execute the `PassageReady` passage and `predisplay` tasks.\n  */\n\t\tif (document.body.className) {\n\t\t\tdocument.body.className = '';\n\t\t}\n\n\t\tObject.keys(predisplay).forEach(function (task) {\n\t\t\tif (typeof predisplay[task] === 'function') {\n\t\t\t\tpredisplay[task].call(this, task);\n\t\t\t}\n\t\t}, passage);\n\n\t\tif (Story.has('PassageReady')) {\n\t\t\ttry {\n\t\t\t\tpassageReadyOutput = Wikifier.wikifyEval(Story.get('PassageReady').text);\n\t\t\t} catch (e) {\n\t\t\t\tAlert.error('PassageReady', e.message);\n\t\t\t}\n\t\t}\n\n\t\t/*\n  \tUpdate the engine state.\n  */\n\t\t_state = 'rendering';\n\n\t\t/*\n  \tRender the incoming passage and add it to the page.\n  */\n\t\tvar $incoming = jQuery(passage.render()),\n\t\t    passages = document.getElementById('passages');\n\n\t\tif (passages.hasChildNodes()) {\n\t\t\tif (\n\t\t\t/* eslint-disable no-extra-parens */\n\t\t\ttypeof Config.passages.transitionOut === 'number' || typeof Config.passages.transitionOut === 'string' && Config.passages.transitionOut !== '' && Config.transitionEndEventName !== ''\n\t\t\t/* eslint-enable no-extra-parens */\n\t\t\t) {\n\t\t\t\t\t[].concat(_toConsumableArray(passages.childNodes)).forEach(function (outgoing) {\n\t\t\t\t\t\tvar $outgoing = jQuery(outgoing);\n\n\t\t\t\t\t\tif (outgoing.nodeType === Node.ELEMENT_NODE && $outgoing.hasClass('passage')) {\n\t\t\t\t\t\t\tif ($outgoing.hasClass('passage-out')) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$outgoing.attr('id', 'out-' + $outgoing.attr('id')).addClass('passage-out');\n\n\t\t\t\t\t\t\tif (typeof Config.passages.transitionOut === 'string') {\n\t\t\t\t\t\t\t\t$outgoing.on(Config.transitionEndEventName, function (evt) {\n\t\t\t\t\t\t\t\t\tif (evt.originalEvent.propertyName === Config.passages.transitionOut) {\n\t\t\t\t\t\t\t\t\t\t$outgoing.remove();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t\treturn $outgoing.remove();\n\t\t\t\t\t\t\t\t}, Math.max(minDomActionDelay, Config.passages.transitionOut));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$outgoing.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\tjQuery(passages).empty();\n\t\t\t}\n\t\t}\n\t\t$incoming.addClass('passage-in').appendTo(passages);\n\t\tsetTimeout(function () {\n\t\t\treturn $incoming.removeClass('passage-in');\n\t\t}, minDomActionDelay);\n\n\t\t/*\n  \tSet the document title.\n  */\n\t\tdocument.title = Config.passages.displayTitles && passage.title !== Config.passages.start ? passage.title + ' | ' + Story.title : Story.title;\n\n\t\t/*\n  \tScroll the window to the top.\n  */\n\t\twindow.scroll(0, 0);\n\n\t\t/*\n  \tUpdate the engine state.\n  */\n\t\t_state = 'playing';\n\n\t\t/*\n  \tExecute the `PassageDone` passage and `postdisplay` tasks, then update the non-passage\n  \tpage elements, if enabled.\n  */\n\t\tif (Story.has('PassageDone')) {\n\t\t\ttry {\n\t\t\t\tpassageDoneOutput = Wikifier.wikifyEval(Story.get('PassageDone').text);\n\t\t\t} catch (e) {\n\t\t\t\tAlert.error('PassageDone', e.message);\n\t\t\t}\n\t\t}\n\n\t\tObject.keys(postdisplay).forEach(function (task) {\n\t\t\tif (typeof postdisplay[task] === 'function') {\n\t\t\t\tpostdisplay[task].call(this, task);\n\t\t\t}\n\t\t}, passage);\n\n\t\tif (Config.ui.updateStoryElements) {\n\t\t\tUI.setStoryElements();\n\t\t}\n\n\t\t/*\n  \tAdd the completed debug views for `StoryInit`, `PassageReady`, and `PassageDone`\n  \tto the incoming passage element.\n  */\n\t\tif (Config.debug) {\n\t\t\tvar debugView = void 0;\n\n\t\t\t// Prepend the `PassageReady` debug view.\n\t\t\tif (passageReadyOutput != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tdebugView = new DebugView(document.createDocumentFragment(), 'special', 'PassageReady', 'PassageReady');\n\t\t\t\tdebugView.modes({ hidden: true });\n\t\t\t\tdebugView.append(passageReadyOutput);\n\t\t\t\t$incoming.prepend(debugView.output);\n\t\t\t}\n\n\t\t\t// Append the `PassageDone` debug view.\n\t\t\tif (passageDoneOutput != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tdebugView = new DebugView(document.createDocumentFragment(), 'special', 'PassageDone', 'PassageDone');\n\t\t\t\tdebugView.modes({ hidden: true });\n\t\t\t\tdebugView.append(passageDoneOutput);\n\t\t\t\t$incoming.append(debugView.output);\n\t\t\t}\n\n\t\t\t// Prepend the cached `StoryInit` debug view, if we're showing the first moment/turn.\n\t\t\tif (State.turns === 1 && _storyInitDebugView != null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\t$incoming.prepend(_storyInitDebugView);\n\t\t\t}\n\t\t}\n\n\t\t/*\n  \tUpdate the last display time.\n  */\n\t\t_lastPlay = Date.now();\n\n\t\t/*\n  \tLast second post-processing for accessibility and other things.\n  */\n\t\tUI.hideOutlines(); // initially hide outlines\n\t\tjQuery('#story')\n\t\t// Add `link-external` to all `href` bearing `<a>` elements which don't have it.\n\t\t.find('a[href]:not(.link-external)').addClass('link-external').end()\n\t\t// Add `tabindex=0` to all interactive elements which don't have it.\n\t\t.find('a,link,button,input,select,textarea').not('[tabindex]').attr('tabindex', 0);\n\n\t\t/*\n  \tHandle autosaves.\n  */\n\t\tswitch (_typeof(Config.saves.autosave)) {\n\t\t\tcase 'boolean':\n\t\t\t\tif (Config.saves.autosave) {\n\t\t\t\t\tSave.autosave.save();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'string':\n\t\t\t\tif (passage.tags.includes(Config.saves.autosave)) {\n\t\t\t\t\tSave.autosave.save();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'object':\n\t\t\t\tif (Array.isArray(Config.saves.autosave) && passage.tags.some(function (t) {\n\t\t\t\t\treturn Config.saves.autosave.includes(t);\n\t\t\t\t})) {\n\t\t\t\t\tSave.autosave.save();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\t/*\n  \tReset the engine state.\n  */\n\t\t_state = 'idle';\n\n\t\t// TODO: Let this return the jQuery wrapped element, rather than just the element.\n\t\treturn $incoming[0];\n\t}\n\n\t/*******************************************************************************************************************\n  * Legacy Functions.\n  ******************************************************************************************************************/\n\t/**\n \t[DEPRECATED] Play the given passage, optionally without altering the history.\n **/\n\tfunction engineDisplay(title, link, option) {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Engine/engineDisplay()]');\n\t\t}\n\n\t\tvar noHistory = false;\n\n\t\t// Process the option parameter.\n\t\tswitch (option) {\n\t\t\tcase undefined:\n\t\t\t\t/* no-op */\n\t\t\t\tbreak;\n\n\t\t\tcase 'replace':\n\t\t\tcase 'back':\n\t\t\t\tnoHistory = true;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Engine.display option parameter called with' + (' obsolete value \"' + option + '\"; please notify the developer'));\n\t\t}\n\n\t\tenginePlay(title, noHistory);\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\t/*\n  \tConstants.\n  */\n\t\tminDomActionDelay: { value: minDomActionDelay },\n\n\t\t/*\n  \tCore Functions.\n  */\n\t\tstart: { value: engineStart },\n\t\trestart: { value: engineRestart },\n\t\tstate: { get: engineState },\n\t\tlastPlay: { get: engineLastPlay },\n\t\tgoTo: { value: engineGoTo },\n\t\tgo: { value: engineGo },\n\t\tbackward: { value: engineBackward },\n\t\tforward: { value: engineForward },\n\t\tshow: { value: engineShow },\n\t\tplay: { value: enginePlay },\n\n\t\t/*\n  \tLegacy Functions.\n  */\n\t\tdisplay: { value: engineDisplay }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * passage.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Config, Story, Util, Wikifier, convertBreaks, postrender, prerender, strings */\n\nvar Passage = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar _tagsToSkip = void 0,\n\t    _unescapeTwine1Chars = void 0;\n\n\t/*\n \tTags which should not be transformed into classes:\n \t\tdebug      → special tag\n \t\tnobr       → special tag\n \t\tpassage    → the default class\n \t\tscript     → special tag (only in Twine 1)\n \t\tstylesheet → special tag (only in Twine 1)\n \t\ttwine.*    → special tag\n \t\twidget     → special tag\n */\n\t// For Twine 1\n\tif (TWINE1) {\n\t\t_tagsToSkip = /^(?:debug|nobr|passage|script|stylesheet|widget|twine\\..*)$/i;\n\t}\n\t// For Twine 2\n\telse {\n\t\t\t_tagsToSkip = /^(?:debug|nobr|passage|widget|twine\\..*)$/i;\n\t\t}\n\n\t// For Twine 1\n\tif (TWINE1) {\n\t\t(function () {\n\t\t\t/*\n   \tReturns a decoded version of the passed Twine 1 passage store encoded string.\n   */\n\t\t\tvar _escapedTwine1CharsRe = /(?:\\\\n|\\\\t|\\\\s|\\\\|\\r)/g,\n\t\t\t    _hasEscapedTwine1CharsRe = new RegExp(_escapedTwine1CharsRe.source),\n\t\t\t    // to drop the global flag\n\t\t\t_escapedTwine1CharsMap = Object.freeze({\n\t\t\t\t'\\\\n': '\\n',\n\t\t\t\t'\\\\t': '\\t',\n\t\t\t\t'\\\\s': '\\\\',\n\t\t\t\t'\\\\': '\\\\',\n\t\t\t\t'\\r': ''\n\t\t\t});\n\n\t\t\t_unescapeTwine1Chars = function _unescapeTwine1Chars(str) {\n\t\t\t\tif (str == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tvar s = String(str);\n\t\t\t\treturn s && _hasEscapedTwine1CharsRe.test(s) ? s.replace(_escapedTwine1CharsRe, function (c) {\n\t\t\t\t\treturn _escapedTwine1CharsMap[c];\n\t\t\t\t}) : s;\n\t\t\t};\n\t\t})();\n\t}\n\n\t/*******************************************************************************************************************\n  * Passage Class.\n  ******************************************************************************************************************/\n\n\tvar Passage = function () {\n\t\tfunction Passage(title, el) {\n\t\t\tvar _this8 = this;\n\n\t\t\t_classCallCheck(this, Passage);\n\n\t\t\tObject.defineProperties(this, {\n\t\t\t\t// Passage title/ID.\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: Util.unescape(title)\n\t\t\t\t},\n\n\t\t\t\t// Passage data element (within the story data element; i.e. T1: '[tiddler]', T2: 'tw-passagedata').\n\t\t\t\telement: {\n\t\t\t\t\tvalue: el || null\n\t\t\t\t},\n\n\t\t\t\t// Passage tags array (sorted and unique).\n\t\t\t\ttags: {\n\t\t\t\t\tvalue: Object.freeze(el && el.hasAttribute('tags') ? el.getAttribute('tags').trim().splitOrEmpty(/\\s+/).sort().filter(function (tag, i, aref) {\n\t\t\t\t\t\treturn i === 0 || aref[i - 1] !== tag;\n\t\t\t\t\t}) : [])\n\t\t\t\t},\n\n\t\t\t\t// Passage excerpt.  Used by the `description()` method.\n\t\t\t\t_excerpt: {\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: null\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Properties dependant on the above set.\n\t\t\tObject.defineProperties(this, {\n\t\t\t\t// Passage DOM-compatible ID.\n\t\t\t\tdomId: {\n\t\t\t\t\tvalue: 'passage-' + Util.slugify(this.title)\n\t\t\t\t},\n\n\t\t\t\t// Passage classes array (sorted and unique).\n\t\t\t\tclasses: {\n\t\t\t\t\tvalue: Object.freeze(this.tags.length === 0 ? [] : function () {\n\t\t\t\t\t\treturn(\n\t\t\t\t\t\t\t/*\n       \tReturn the sorted list of unique classes.\n       \t\tn.b. The `this.tags` array is already sorted and unique, so we only need\n       \t     to filter and map here.\n       */\n\t\t\t\t\t\t\t_this8.tags.filter(function (tag) {\n\t\t\t\t\t\t\t\treturn !_tagsToSkip.test(tag);\n\t\t\t\t\t\t\t}).map(function (tag) {\n\t\t\t\t\t\t\t\treturn Util.slugify(tag);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}())\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Getters.\n\n\n\t\t_createClass(Passage, [{\n\t\t\tkey: 'description',\n\t\t\tvalue: function description() {\n\t\t\t\tvar descriptions = Config.passages.descriptions;\n\n\t\t\t\tif (descriptions != null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tswitch (typeof descriptions === 'undefined' ? 'undefined' : _typeof(descriptions)) {\n\t\t\t\t\t\tcase 'boolean':\n\t\t\t\t\t\t\tif (descriptions) {\n\t\t\t\t\t\t\t\treturn this.title;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t\tif (descriptions instanceof Map && descriptions.has(this.title)) {\n\t\t\t\t\t\t\t\treturn descriptions.get(this.title);\n\t\t\t\t\t\t\t} else if (descriptions.hasOwnProperty(this.title)) {\n\t\t\t\t\t\t\t\treturn descriptions[this.title];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'function':\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar result = descriptions.call(this);\n\n\t\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new TypeError('Config.passages.descriptions must be a boolean, object, or function');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Initialize the excerpt cache from the raw passage text, if necessary.\n\t\t\t\tif (this._excerpt === null) {\n\t\t\t\t\tthis._excerpt = Passage.getExcerptFromText(this.text);\n\t\t\t\t}\n\n\t\t\t\treturn this._excerpt;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'processText',\n\t\t\tvalue: function processText() {\n\t\t\t\tvar processed = this.text;\n\n\t\t\t\t// Handle the `nobr` tag.\n\t\t\t\tif (this.tags.includes('nobr')) {\n\t\t\t\t\t// Remove all leading & trailing newlines and compact all internal sequences\n\t\t\t\t\t// of newlines into single spaces.\n\t\t\t\t\tprocessed = processed.replace(/^\\n+|\\n+$/g, '').replace(/\\n+/g, ' ');\n\t\t\t\t}\n\n\t\t\t\t// Handle image passage transclusion.\n\t\t\t\tif (this.tags.includes('Twine.image')) {\n\t\t\t\t\tprocessed = '[img[' + processed + ']]';\n\t\t\t\t}\n\n\t\t\t\treturn processed;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'render',\n\t\t\tvalue: function render() {\n\t\t\t\tvar _this9 = this;\n\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('[<Passage: \"' + this.title + '\">.render()]');\n\t\t\t\t}\n\n\t\t\t\t// Create and setup the new passage element.\n\t\t\t\tvar passageEl = document.createElement('div');\n\t\t\t\tjQuery(passageEl).attr({\n\t\t\t\t\tid: this.domId,\n\t\t\t\t\t'data-passage': this.title,\n\t\t\t\t\t'data-tags': this.tags.join(' ')\n\t\t\t\t}).addClass('passage ' + this.className);\n\n\t\t\t\t// Add the passage's classes to the <body>.\n\t\t\t\tjQuery(document.body).addClass(this.className);\n\n\t\t\t\t// Execute pre-render tasks.\n\t\t\t\tObject.keys(prerender).forEach(function (task) {\n\t\t\t\t\tif (typeof prerender[task] === 'function') {\n\t\t\t\t\t\tprerender[task].call(_this9, passageEl, task);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Wikify the PassageHeader passage, if it exists, into the passage element.\n\t\t\t\tif (Story.has('PassageHeader')) {\n\t\t\t\t\tnew Wikifier(passageEl, Story.get('PassageHeader').processText());\n\t\t\t\t}\n\n\t\t\t\t// Wikify the passage into its element.\n\t\t\t\tnew Wikifier(passageEl, this.processText());\n\n\t\t\t\t// Wikify the PassageFooter passage, if it exists, into the passage element.\n\t\t\t\tif (Story.has('PassageFooter')) {\n\t\t\t\t\tnew Wikifier(passageEl, Story.get('PassageFooter').processText());\n\t\t\t\t}\n\n\t\t\t\t// Convert breaks to paragraphs within the output passage.\n\t\t\t\tif (Config.cleanupWikifierOutput) {\n\t\t\t\t\tconvertBreaks(passageEl);\n\t\t\t\t}\n\n\t\t\t\t// Execute post-render tasks.\n\t\t\t\tObject.keys(postrender).forEach(function (task) {\n\t\t\t\t\tif (typeof postrender[task] === 'function') {\n\t\t\t\t\t\tpostrender[task].call(_this9, passageEl, task);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Update the excerpt cache to reflect the rendered text.\n\t\t\t\tthis._excerpt = Passage.getExcerptFromNode(passageEl);\n\n\t\t\t\treturn passageEl;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'className',\n\t\t\tget: function get() {\n\t\t\t\treturn this.classes.join(' ');\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'text',\n\t\t\tget: function get() {\n\t\t\t\tif (this.element == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\treturn ('<span class=\"error\" title=\"%passage%\">' + (strings.errors.title + ': ' + strings.errors.nonexistentPassage) + '</span>').replace(/%passage%/g, Util.escape(this.title));\n\t\t\t\t}\n\n\t\t\t\t// For Twine 1\n\t\t\t\tif (TWINE1) {\n\t\t\t\t\treturn _unescapeTwine1Chars(this.element.textContent);\n\t\t\t\t}\n\t\t\t\t// For Twine 2\n\t\t\t\telse {\n\t\t\t\t\t\treturn this.element.textContent.replace(/\\r/g, '');\n\t\t\t\t\t}\n\t\t\t}\n\t\t}], [{\n\t\t\tkey: 'getExcerptFromNode',\n\t\t\tvalue: function getExcerptFromNode(node, count) {\n\t\t\t\tif (!node.hasChildNodes()) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tvar excerpt = node.textContent.trim();\n\n\t\t\t\tif (excerpt !== '') {\n\t\t\t\t\tvar excerptRe = new RegExp('(\\\\S+(?:\\\\s+\\\\S+){0,' + (count > 0 ? count - 1 : 7) + '})');\n\t\t\t\t\texcerpt = excerpt\n\t\t\t\t\t// Compact whitespace.\n\t\t\t\t\t.replace(/\\s+/g, ' ')\n\t\t\t\t\t// Attempt to match the excerpt regexp.\n\t\t\t\t\t.match(excerptRe);\n\t\t\t\t}\n\n\t\t\t\treturn excerpt ? excerpt[1] + '…' : '…'; // horizontal ellipsis\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'getExcerptFromText',\n\t\t\tvalue: function getExcerptFromText(text, count) {\n\t\t\t\tif (text === '') {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tvar excerptRe = new RegExp('(\\\\S+(?:\\\\s+\\\\S+){0,' + (count > 0 ? count - 1 : 7) + '})'),\n\t\t\t\t    excerpt = text\n\t\t\t\t// Strip macro tags (replace with a space).\n\t\t\t\t.replace(/<<.*?>>/g, ' ')\n\t\t\t\t// Strip html tags (replace with a space).\n\t\t\t\t.replace(/<.*?>/g, ' ')\n\t\t\t\t// The above might have left problematic whitespace, so trim.\n\t\t\t\t.trim()\n\t\t\t\t// Strip wiki tables.\n\t\t\t\t.replace(/^\\s*\\|.*\\|.*?$/gm, '')\n\t\t\t\t// Strip wiki images.\n\t\t\t\t.replace(/\\[[<>]?img\\[[^\\]]*\\]\\]/g, '')\n\t\t\t\t// Clean wiki links, i.e. remove all but the link text.\n\t\t\t\t.replace(/\\[\\[([^|\\]]*)(?:|[^\\]]*)?\\]\\]/g, '$1')\n\t\t\t\t// Clean wiki !headings.\n\t\t\t\t.replace(/^\\s*!+(.*?)$/gm, '$1')\n\t\t\t\t// Clean wiki bold/italic/underline/highlight formatting.\n\t\t\t\t.replace(/\\'{2}|\\/{2}|_{2}|@{2}/g, '')\n\t\t\t\t// A final trim.\n\t\t\t\t.trim()\n\t\t\t\t// Compact whitespace.\n\t\t\t\t.replace(/\\s+/g, ' ')\n\t\t\t\t// Attempt to match the excerpt regexp.\n\t\t\t\t.match(excerptRe);\n\t\t\t\treturn excerpt ? excerpt[1] + '…' : '…'; // horizontal ellipsis\n\t\t\t}\n\t\t}]);\n\n\t\treturn Passage;\n\t}();\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\n\n\treturn Passage;\n}();\n\n/***********************************************************************************************************************\n *\n * save.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Config, Engine, State, Story, UI, Util, storage, strings */\n\nvar Save = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar _slotsUBound = -1; // The upper bound of the saves slots.\n\n\t/*******************************************************************************************************************\n  * Saves Functions.\n  ******************************************************************************************************************/\n\tfunction savesInit() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Save/savesInit()]');\n\t\t}\n\n\t\t// Disable save slots and the autosave when Web Storage is unavailable.\n\t\tif (storage.name === 'cookie') {\n\t\t\tsavesObjClear();\n\t\t\tConfig.saves.autosave = undefined;\n\t\t\tConfig.saves.slots = 0;\n\t\t\treturn false;\n\t\t}\n\n\t\t// Finalize the `Config.saves.slots` property here, before it's used.\n\t\tConfig.saves.slots = Math.max(0, Config.saves.slots);\n\n\t\tif (isNaN(Config.saves.slots) || !isFinite(Config.saves.slots)) {\n\t\t\t// TODO: Maybe this should throw instead?\n\t\t\tConfig.saves.slots = 8;\n\t\t}\n\n\t\tvar saves = savesObjGet(),\n\t\t    updated = false;\n\n\t\t/* legacy */\n\t\t// Convert an ancient saves array into a new saves object.\n\t\tif (Array.isArray(saves)) {\n\t\t\tsaves = {\n\t\t\t\tautosave: null,\n\t\t\t\tslots: saves\n\t\t\t};\n\t\t\tupdated = true;\n\t\t}\n\t\t/* /legacy */\n\n\t\t// Handle the author changing the number of save slots.\n\t\tif (Config.saves.slots !== saves.slots.length) {\n\t\t\tif (Config.saves.slots < saves.slots.length) {\n\t\t\t\t// Attempt to decrease the number of slots; this will only compact\n\t\t\t\t// the slots array, by removing empty slots, no saves will be deleted.\n\t\t\t\tsaves.slots.reverse();\n\n\t\t\t\tsaves.slots = saves.slots.filter(function (val) {\n\t\t\t\t\tif (val === null && this.count > 0) {\n\t\t\t\t\t\t--this.count;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}, { count: saves.slots.length - Config.saves.slots });\n\n\t\t\t\tsaves.slots.reverse();\n\t\t\t} else if (Config.saves.slots > saves.slots.length) {\n\t\t\t\t// Attempt to increase the number of slots.\n\t\t\t\t_appendSlots(saves.slots, Config.saves.slots - saves.slots.length);\n\t\t\t}\n\n\t\t\tupdated = true;\n\t\t}\n\n\t\t/* legacy */\n\t\t// Update saves with old/obsolete properties.\n\t\tif (_savesObjUpdate(saves.autosave)) {\n\t\t\tupdated = true;\n\t\t}\n\n\t\tfor (var i = 0; i < saves.slots.length; ++i) {\n\t\t\tif (_savesObjUpdate(saves.slots[i])) {\n\t\t\t\tupdated = true;\n\t\t\t}\n\t\t}\n\n\t\t// Remove save stores which are empty.\n\t\tif (_savesObjIsEmpty(saves)) {\n\t\t\tstorage.delete('saves');\n\t\t\tupdated = false;\n\t\t}\n\t\t/* /legacy */\n\n\t\t// If the saves object was updated, then update the store.\n\t\tif (updated) {\n\t\t\t_savesObjSave(saves);\n\t\t}\n\n\t\t_slotsUBound = saves.slots.length - 1;\n\n\t\treturn true;\n\t}\n\n\tfunction savesObjCreate() {\n\t\treturn {\n\t\t\tautosave: null,\n\t\t\tslots: _appendSlots([], Config.saves.slots)\n\t\t};\n\t}\n\n\tfunction savesObjGet() {\n\t\tvar saves = storage.get('saves');\n\t\treturn saves === null ? savesObjCreate() : saves;\n\t}\n\n\tfunction savesObjClear() {\n\t\tstorage.delete('saves');\n\t\treturn true;\n\t}\n\n\tfunction savesOK() {\n\t\treturn autosaveOK() || slotsOK();\n\t}\n\n\t/*******************************************************************************************************************\n  * Autosave Functions.\n  ******************************************************************************************************************/\n\tfunction autosaveOK() {\n\t\treturn storage.name !== 'cookie' && typeof Config.saves.autosave !== 'undefined';\n\t}\n\n\tfunction autosaveHas() {\n\t\tvar saves = savesObjGet();\n\n\t\tif (saves.autosave === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction autosaveGet() {\n\t\tvar saves = savesObjGet();\n\t\treturn saves.autosave;\n\t}\n\n\tfunction autosaveLoad() {\n\t\tvar saves = savesObjGet();\n\n\t\tif (saves.autosave === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn _unmarshal(saves.autosave);\n\t}\n\n\tfunction autosaveSave(title, metadata) {\n\t\tif (typeof Config.saves.isAllowed === 'function' && !Config.saves.isAllowed()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar saves = savesObjGet();\n\t\tsaves.autosave = _marshal();\n\t\tsaves.autosave.title = title || Story.get(State.passage).description();\n\t\tsaves.autosave.date = Date.now();\n\n\t\tif (metadata != null) {\n\t\t\t// lazy equality for null\n\t\t\tsaves.autosave.metadata = metadata;\n\t\t}\n\n\t\treturn _savesObjSave(saves);\n\t}\n\n\tfunction autosaveDelete() {\n\t\tvar saves = savesObjGet();\n\t\tsaves.autosave = null;\n\t\treturn _savesObjSave(saves);\n\t}\n\n\t/*******************************************************************************************************************\n  * Slots Functions.\n  ******************************************************************************************************************/\n\tfunction slotsOK() {\n\t\treturn storage.name !== 'cookie' && _slotsUBound !== -1;\n\t}\n\n\tfunction slotsLength() {\n\t\treturn _slotsUBound + 1;\n\t}\n\n\tfunction slotsCount() {\n\t\tif (!slotsOK()) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar saves = savesObjGet();\n\t\tvar count = 0;\n\n\t\tfor (var i = 0, iend = saves.slots.length; i < iend; ++i) {\n\t\t\tif (saves.slots[i] !== null) {\n\t\t\t\t++count;\n\t\t\t}\n\t\t}\n\t\treturn count;\n\t}\n\n\tfunction slotsIsEmpty() {\n\t\treturn slotsCount() === 0;\n\t}\n\n\tfunction slotsHas(slot) {\n\t\tif (slot < 0 || slot > _slotsUBound) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar saves = savesObjGet();\n\n\t\tif (slot >= saves.slots.length || saves.slots[slot] === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction slotsGet(slot) {\n\t\tif (slot < 0 || slot > _slotsUBound) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar saves = savesObjGet();\n\n\t\tif (slot >= saves.slots.length) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn saves.slots[slot];\n\t}\n\n\tfunction slotsLoad(slot) {\n\t\tif (slot < 0 || slot > _slotsUBound) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar saves = savesObjGet();\n\n\t\tif (slot >= saves.slots.length || saves.slots[slot] === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn _unmarshal(saves.slots[slot]);\n\t}\n\n\tfunction slotsSave(slot, title, metadata) {\n\t\tif (typeof Config.saves.isAllowed === 'function' && !Config.saves.isAllowed()) {\n\t\t\tUI.alert(strings.saves.disallowed);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (slot < 0 || slot > _slotsUBound) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar saves = savesObjGet();\n\t\tif (slot >= saves.slots.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tsaves.slots[slot] = _marshal();\n\t\tsaves.slots[slot].title = title || Story.get(State.passage).description();\n\t\tsaves.slots[slot].date = Date.now();\n\n\t\tif (metadata != null) {\n\t\t\t// lazy equality for null\n\t\t\tsaves.slots[slot].metadata = metadata;\n\t\t}\n\n\t\treturn _savesObjSave(saves);\n\t}\n\n\tfunction slotsDelete(slot) {\n\t\tif (slot < 0 || slot > _slotsUBound) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar saves = savesObjGet();\n\n\t\tif (slot >= saves.slots.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tsaves.slots[slot] = null;\n\t\treturn _savesObjSave(saves);\n\t}\n\n\t/*******************************************************************************************************************\n  * Disk Functions.\n  ******************************************************************************************************************/\n\tfunction exportSave(filename) {\n\t\tif (typeof Config.saves.isAllowed === 'function' && !Config.saves.isAllowed()) {\n\t\t\tUI.alert(strings.saves.disallowed);\n\t\t\treturn;\n\t\t}\n\n\t\tfunction datestamp() {\n\t\t\tvar now = new Date();\n\t\t\tvar MM = now.getMonth() + 1,\n\t\t\t    DD = now.getDate(),\n\t\t\t    hh = now.getHours(),\n\t\t\t    mm = now.getMinutes(),\n\t\t\t    ss = now.getSeconds();\n\n\t\t\tif (MM < 10) {\n\t\t\t\tMM = '0' + MM;\n\t\t\t}\n\t\t\tif (DD < 10) {\n\t\t\t\tDD = '0' + DD;\n\t\t\t}\n\t\t\tif (hh < 10) {\n\t\t\t\thh = '0' + hh;\n\t\t\t}\n\t\t\tif (mm < 10) {\n\t\t\t\tmm = '0' + mm;\n\t\t\t}\n\t\t\tif (ss < 10) {\n\t\t\t\tss = '0' + ss;\n\t\t\t}\n\n\t\t\treturn '' + now.getFullYear() + MM + DD + '-' + hh + mm + ss;\n\t\t}\n\n\t\tvar saveName = '' + (filename == null ? Story.domId : Util.slugify(filename)) // lazy equality for null\n\t\t+ ('-' + datestamp() + '.save'),\n\t\t    saveObj = LZString.compressToBase64(JSON.stringify(_marshal()));\n\t\tsaveAs(new Blob([saveObj], { type: 'text/plain;charset=UTF-8' }), saveName);\n\t}\n\n\tfunction importSave(event) {\n\t\tvar file = event.target.files[0],\n\t\t    reader = new FileReader();\n\n\t\t// Add the handler that will capture the file information once the load is finished.\n\t\tjQuery(reader).on('load', function (evt) {\n\t\t\tif (!evt.target.result) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar saveObj = void 0;\n\n\t\t\ttry {\n\t\t\t\tsaveObj = JSON.parse(/\\.json$/i.test(file.name) || /^\\{/.test(evt.target.result) ? evt.target.result : LZString.decompressFromBase64(evt.target.result));\n\t\t\t} catch (e) {/* no-op; `_unmarshal()` will handle the error */}\n\n\t\t\t_unmarshal(saveObj);\n\t\t});\n\n\t\t// Initiate the file load.\n\t\treader.readAsText(file);\n\t}\n\n\t/*******************************************************************************************************************\n  * Utility Functions.\n  ******************************************************************************************************************/\n\tfunction _appendSlots(array, num) {\n\t\tfor (var i = 0; i < num; ++i) {\n\t\t\tarray.push(null);\n\t\t}\n\n\t\treturn array;\n\t}\n\n\tfunction _savesObjIsEmpty(saves) {\n\t\tvar slots = saves.slots;\n\t\tvar isSlotsEmpty = true;\n\n\t\tfor (var i = 0, iend = slots.length; i < iend; ++i) {\n\t\t\tif (slots[i] !== null) {\n\t\t\t\tisSlotsEmpty = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn saves.autosave === null && isSlotsEmpty;\n\t}\n\n\tfunction _savesObjSave(saves) {\n\t\tif (_savesObjIsEmpty(saves)) {\n\t\t\tstorage.delete('saves');\n\t\t\treturn true;\n\t\t}\n\n\t\treturn storage.set('saves', saves);\n\t}\n\n\tfunction _savesObjUpdate(saveObj) {\n\t\tif (saveObj === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar updated = false;\n\n\t\t/* eslint-disable no-param-reassign */\n\t\tif (!saveObj.hasOwnProperty('state') || !saveObj.state.hasOwnProperty('delta') || !saveObj.state.hasOwnProperty('index')) {\n\t\t\tif (saveObj.hasOwnProperty('data')) {\n\t\t\t\tdelete saveObj.mode;\n\t\t\t\tsaveObj.state = {\n\t\t\t\t\tdelta: State.deltaEncode(saveObj.data)\n\t\t\t\t};\n\t\t\t\tdelete saveObj.data;\n\t\t\t} else if (!saveObj.state.hasOwnProperty('delta')) {\n\t\t\t\tdelete saveObj.state.mode;\n\t\t\t\tsaveObj.state.delta = State.deltaEncode(saveObj.state.history);\n\t\t\t\tdelete saveObj.state.history;\n\t\t\t} else if (!saveObj.state.hasOwnProperty('index')) {\n\t\t\t\tdelete saveObj.state.mode;\n\t\t\t}\n\n\t\t\tsaveObj.state.index = saveObj.state.delta.length - 1;\n\t\t\tupdated = true;\n\t\t}\n\n\t\tif (saveObj.state.hasOwnProperty('rseed')) {\n\t\t\tsaveObj.state.seed = saveObj.state.rseed;\n\t\t\tdelete saveObj.state.rseed;\n\n\t\t\tsaveObj.state.delta.forEach(function (_, i, delta) {\n\t\t\t\tif (delta[i].hasOwnProperty('rcount')) {\n\t\t\t\t\tdelta[i].pull = delta[i].rcount;\n\t\t\t\t\tdelete delta[i].rcount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tupdated = true;\n\t\t}\n\n\t\tif (saveObj.state.hasOwnProperty('expired') && typeof saveObj.state.expired === 'number' || // eslint-disable-line no-extra-parens, max-len\n\t\tsaveObj.state.hasOwnProperty('unique') || saveObj.state.hasOwnProperty('last')) {\n\t\t\tif (saveObj.state.hasOwnProperty('expired') && typeof saveObj.state.expired === 'number') {\n\t\t\t\tdelete saveObj.state.expired;\n\t\t\t}\n\n\t\t\tif (saveObj.state.hasOwnProperty('unique') || saveObj.state.hasOwnProperty('last')) {\n\t\t\t\tsaveObj.state.expired = [];\n\n\t\t\t\tif (saveObj.state.hasOwnProperty('unique')) {\n\t\t\t\t\tsaveObj.state.expired.push(saveObj.state.unique);\n\t\t\t\t\tdelete saveObj.state.unique;\n\t\t\t\t}\n\n\t\t\t\tif (saveObj.state.hasOwnProperty('last')) {\n\t\t\t\t\tsaveObj.state.expired.push(saveObj.state.last);\n\t\t\t\t\tdelete saveObj.state.last;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tupdated = true;\n\t\t}\n\t\t/* eslint-enable no-param-reassign */\n\n\t\treturn updated;\n\t}\n\n\tfunction _marshal() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Save/_marshal()]');\n\t\t}\n\n\t\tvar saveObj = {\n\t\t\tid: Config.saves.id,\n\t\t\tstate: State.marshalForSave()\n\t\t};\n\n\t\tif (Config.saves.version) {\n\t\t\tsaveObj.version = Config.saves.version;\n\t\t}\n\n\t\tif (typeof Config.saves.onSave === 'function') {\n\t\t\tConfig.saves.onSave(saveObj);\n\t\t}\n\n\t\t// Delta encode the state history and delete the non-encoded property.\n\t\tsaveObj.state.delta = State.deltaEncode(saveObj.state.history);\n\t\tdelete saveObj.state.history;\n\n\t\treturn saveObj;\n\t}\n\n\tfunction _unmarshal(saveObj) {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Save/_unmarshal()]');\n\t\t}\n\n\t\ttry {\n\t\t\t/* eslint-disable no-param-reassign */\n\t\t\t/* legacy */\n\t\t\t// Update saves with old/obsolete properties.\n\t\t\t_savesObjUpdate(saveObj);\n\t\t\t/* /legacy */\n\n\t\t\tif (!saveObj || !saveObj.hasOwnProperty('id') || !saveObj.hasOwnProperty('state')) {\n\t\t\t\tthrow new Error(strings.errors.saveMissingData);\n\t\t\t}\n\n\t\t\t// Delta decode the state history.\n\t\t\tsaveObj.state.history = State.deltaDecode(saveObj.state.delta);\n\t\t\tdelete saveObj.state.delta;\n\n\t\t\tif (typeof Config.saves.onLoad === 'function') {\n\t\t\t\tConfig.saves.onLoad(saveObj);\n\t\t\t}\n\n\t\t\tif (saveObj.id !== Config.saves.id) {\n\t\t\t\tthrow new Error(strings.errors.saveIdMismatch.replace(/%identity%/g, strings.identity));\n\t\t\t}\n\n\t\t\t// Restore the state.\n\t\t\tState.unmarshalForSave(saveObj.state); // may also throw exceptions\n\n\t\t\t// Show the active moment.\n\t\t\tEngine.show();\n\t\t\t/* eslint-enable no-param-reassign */\n\t\t} catch (e) {\n\t\t\tUI.alert(e.message[0].toUpperCase() + e.message.slice(1) + '.</p><p>' + strings.aborting + '.');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\t/*\n  \tSave Functions.\n  */\n\t\tinit: { value: savesInit },\n\t\tget: { value: savesObjGet },\n\t\tclear: { value: savesObjClear },\n\t\tok: { value: savesOK },\n\n\t\t/*\n  \tAutosave  Functions.\n  */\n\t\tautosave: {\n\t\t\tvalue: Object.freeze(Object.defineProperties({}, {\n\t\t\t\tok: { value: autosaveOK },\n\t\t\t\thas: { value: autosaveHas },\n\t\t\t\tget: { value: autosaveGet },\n\t\t\t\tload: { value: autosaveLoad },\n\t\t\t\tsave: { value: autosaveSave },\n\t\t\t\tdelete: { value: autosaveDelete }\n\t\t\t}))\n\t\t},\n\n\t\t/*\n  \tSlots  Functions.\n  */\n\t\tslots: {\n\t\t\tvalue: Object.freeze(Object.defineProperties({}, {\n\t\t\t\tok: { value: slotsOK },\n\t\t\t\tlength: { get: slotsLength },\n\t\t\t\tisEmpty: { value: slotsIsEmpty },\n\t\t\t\tcount: { value: slotsCount },\n\t\t\t\thas: { value: slotsHas },\n\t\t\t\tget: { value: slotsGet },\n\t\t\t\tload: { value: slotsLoad },\n\t\t\t\tsave: { value: slotsSave },\n\t\t\t\tdelete: { value: slotsDelete }\n\t\t\t}))\n\t\t},\n\n\t\t/*\n  \tDisk Functions.\n  */\n\t\texport: { value: exportSave },\n\t\timport: { value: importSave }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * setting.js\n *\n * Copyright © 2015–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global settings:true, storage */\n\nvar Setting = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar\n\t// Setting definition array.\n\t_definitions = [],\n\n\n\t// Setting control types object (pseudo-enumeration).\n\tTypes = Object.freeze({\n\t\tHeader: 0,\n\t\tToggle: 1,\n\t\tList: 2\n\t});\n\n\t/*******************************************************************************************************************\n  * Settings Functions.\n  ******************************************************************************************************************/\n\tfunction settingsInit() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Setting/settingsInit()]');\n\t\t}\n\n\t\t/* legacy */\n\t\t// Attempt to migrate an existing `options` store to `settings`.\n\t\tif (storage.has('options')) {\n\t\t\tvar old = storage.get('options');\n\n\t\t\tif (old !== null) {\n\t\t\t\twindow.SugarCube.settings = settings = Object.assign(settingsCreate(), old);\n\t\t\t}\n\n\t\t\tsettingsSave();\n\t\t\tstorage.delete('options');\n\t\t}\n\t\t/* /legacy */\n\n\t\t// Load existing settings.\n\t\tsettingsLoad();\n\n\t\t// Execute `onInit` callbacks.\n\t\t_definitions.forEach(function (d) {\n\t\t\tif (d.hasOwnProperty('onInit')) {\n\t\t\t\tvar thisArg = {\n\t\t\t\t\tname: d.name,\n\t\t\t\t\tvalue: settings[d.name],\n\t\t\t\t\tdefault: d.default\n\t\t\t\t};\n\n\t\t\t\tif (d.hasOwnProperty('list')) {\n\t\t\t\t\tthisArg.list = d.list;\n\t\t\t\t}\n\n\t\t\t\td.onInit.call(thisArg);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction settingsCreate() {\n\t\treturn Object.create(null);\n\t}\n\n\tfunction settingsSave() {\n\t\tvar savedSettings = settingsCreate();\n\n\t\tif (Object.keys(settings).length > 0) {\n\t\t\t// _definitions.forEach(definition => {\n\t\t\t// \tif (definition.type !== Types.Header && settings[definition.name] !== definition.default) {\n\t\t\t// \t\tsavedSettings[definition.name] = settings[definition.name];\n\t\t\t// \t}\n\t\t\t// });\n\t\t\t_definitions.filter(function (d) {\n\t\t\t\treturn d.type !== Types.Header && settings[d.name] !== d.default;\n\t\t\t}).forEach(function (d) {\n\t\t\t\treturn savedSettings[d.name] = settings[d.name];\n\t\t\t});\n\t\t}\n\n\t\tif (Object.keys(savedSettings).length === 0) {\n\t\t\tstorage.delete('settings');\n\t\t\treturn true;\n\t\t}\n\n\t\treturn storage.set('settings', savedSettings);\n\t}\n\n\tfunction settingsLoad() {\n\t\tvar defaultSettings = settingsCreate(),\n\t\t    loadedSettings = storage.get('settings') || settingsCreate();\n\n\t\t// Load the defaults.\n\t\t// _definitions.forEach(definition => {\n\t\t// \tif (definition.type !== Types.Header) {\n\t\t// \t\tdefaultSettings[definition.name] = definition.default;\n\t\t// \t}\n\t\t// });\n\t\t_definitions.filter(function (d) {\n\t\t\treturn d.type !== Types.Header;\n\t\t}).forEach(function (d) {\n\t\t\treturn defaultSettings[d.name] = d.default;\n\t\t});\n\n\t\t// Assign to the `settings` object while overwriting the defaults with the loaded settings.\n\t\twindow.SugarCube.settings = settings = Object.assign(defaultSettings, loadedSettings);\n\t}\n\n\tfunction settingsClear() {\n\t\twindow.SugarCube.settings = settings = settingsCreate();\n\t\tstorage.delete('settings');\n\t\treturn true;\n\t}\n\n\tfunction settingsReset(name) {\n\t\tif (arguments.length === 0) {\n\t\t\tsettingsClear();\n\t\t\tsettingsLoad();\n\t\t} else {\n\t\t\tif (name == null || !definitionsHas(name)) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tthrow new Error('nonexistent setting \"' + name + '\"');\n\t\t\t}\n\n\t\t\tvar d = definitionsGet(name);\n\n\t\t\tif (d.type !== Types.Header) {\n\t\t\t\tsettings[name] = d.default;\n\t\t\t}\n\t\t}\n\n\t\treturn settingsSave();\n\t}\n\n\t/*******************************************************************************************************************\n  * Definitions Functions.\n  ******************************************************************************************************************/\n\tfunction definitionsForEach(callback, thisArg) {\n\t\t_definitions.forEach(callback, thisArg);\n\t}\n\n\tfunction definitionsAdd(type, name, def) {\n\t\tif (arguments.length < 3) {\n\t\t\tvar errors = [];\n\t\t\tif (arguments.length < 1) {\n\t\t\t\terrors.push('type');\n\t\t\t}\n\t\t\tif (arguments.length < 2) {\n\t\t\t\terrors.push('name');\n\t\t\t}\n\t\t\tif (arguments.length < 3) {\n\t\t\t\terrors.push('definition');\n\t\t\t}\n\t\t\tthrow new Error('missing parameters, no ' + errors.join(' or ') + ' specified');\n\t\t}\n\n\t\tif ((typeof def === 'undefined' ? 'undefined' : _typeof(def)) !== 'object') {\n\t\t\tthrow new TypeError('definition parameter must be an object');\n\t\t}\n\n\t\tif (definitionsHas(name)) {\n\t\t\tthrow new Error('cannot clobber existing setting \"' + name + '\"');\n\t\t}\n\n\t\t/*\n  \tDefinition objects.\n  \t{\n  \t\ttype     : (both:Setting.Types),\n  \t\tname     : (both:string),\n  \t\tlabel    : (both:string),\n  \t\tdefault  : (toggle:boolean, list:[as array]), // if undefined (toggle:false, list:list[0])\n  \t\tlist     : (list:array),\n  \t\tonInit   : (both:function),\n  \t\tonChange : (both:function)\n  \t}\n  */\n\t\tvar definition = {\n\t\t\ttype: type,\n\t\t\tname: name,\n\t\t\tlabel: def.label == null ? '' : String(def.label).trim() // lazy equality for null\n\t\t};\n\n\t\tswitch (type) {\n\t\t\tcase Types.Header:\n\t\t\t\tbreak;\n\n\t\t\tcase Types.Toggle:\n\t\t\t\tdefinition.default = !!def.default;\n\t\t\t\tbreak;\n\n\t\t\tcase Types.List:\n\t\t\t\tif (!def.hasOwnProperty('list')) {\n\t\t\t\t\tthrow new Error('no list specified');\n\t\t\t\t} else if (!Array.isArray(def.list)) {\n\t\t\t\t\tthrow new TypeError('list must be an array');\n\t\t\t\t} else if (def.list.length === 0) {\n\t\t\t\t\tthrow new Error('list must not be empty');\n\t\t\t\t}\n\n\t\t\t\tdefinition.list = Object.freeze(def.list);\n\n\t\t\t\tif (def.default == null) {\n\t\t\t\t\t// lazy equality for null\n\t\t\t\t\tdefinition.default = def.list[0];\n\t\t\t\t} else {\n\t\t\t\t\tvar defaultIndex = def.list.indexOf(def.default);\n\n\t\t\t\t\tif (defaultIndex === -1) {\n\t\t\t\t\t\tthrow new Error('list does not contain default');\n\t\t\t\t\t}\n\n\t\t\t\t\tdefinition.default = def.list[defaultIndex];\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error('unknown Setting type: ' + type);\n\t\t}\n\n\t\tif (typeof def.onInit === 'function') {\n\t\t\tdefinition.onInit = Object.freeze(def.onInit);\n\t\t}\n\n\t\tif (typeof def.onChange === 'function') {\n\t\t\tdefinition.onChange = Object.freeze(def.onChange);\n\t\t}\n\n\t\t_definitions.push(Object.freeze(definition));\n\t}\n\n\tfunction definitionsAddHeader(name, label) {\n\t\tdefinitionsAdd(Types.Header, name, { label: label });\n\t}\n\n\tfunction definitionsAddToggle() {\n\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\targs[_key] = arguments[_key];\n\t\t}\n\n\t\tdefinitionsAdd.apply(undefined, [Types.Toggle].concat(args));\n\t}\n\n\tfunction definitionsAddList() {\n\t\tfor (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\targs[_key2] = arguments[_key2];\n\t\t}\n\n\t\tdefinitionsAdd.apply(undefined, [Types.List].concat(args));\n\t}\n\n\tfunction definitionsIsEmpty() {\n\t\treturn _definitions.length === 0;\n\t}\n\n\tfunction definitionsHas(name) {\n\t\treturn _definitions.some(function (definition) {\n\t\t\treturn definition.name === name;\n\t\t});\n\t}\n\n\tfunction definitionsGet(name) {\n\t\treturn _definitions.find(function (definition) {\n\t\t\treturn definition.name === name;\n\t\t});\n\t}\n\n\tfunction definitionsDelete(name) {\n\t\tif (definitionsHas(name)) {\n\t\t\tdelete settings[name];\n\t\t}\n\n\t\tfor (var i = 0; i < _definitions.length; ++i) {\n\t\t\tif (_definitions[i].name === name) {\n\t\t\t\t_definitions.splice(i, 1);\n\t\t\t\tdefinitionsDelete(name);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\t/*\n  \tEnumerations.\n  */\n\t\tTypes: { value: Types },\n\n\t\t/*\n  \tSettings Functions.\n  */\n\t\tinit: { value: settingsInit },\n\t\tcreate: { value: settingsCreate },\n\t\tsave: { value: settingsSave },\n\t\tload: { value: settingsLoad },\n\t\tclear: { value: settingsClear },\n\t\treset: { value: settingsReset },\n\n\t\t/*\n  \tDefinitions Functions.\n  */\n\t\tforEach: { value: definitionsForEach },\n\t\tadd: { value: definitionsAdd },\n\t\taddHeader: { value: definitionsAddHeader },\n\t\taddToggle: { value: definitionsAddToggle },\n\t\taddList: { value: definitionsAddList },\n\t\tisEmpty: { value: definitionsIsEmpty },\n\t\thas: { value: definitionsHas },\n\t\tget: { value: definitionsGet },\n\t\tdelete: { value: definitionsDelete }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * state.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Config, Engine, PRNGWrapper, Util, clone, session */\n\nvar State = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar\n\t// History moment stack.\n\t_history = [],\n\n\n\t// Currently active/played moment.\n\t_active = momentCreate(),\n\n\n\t// Currently active/played moment index.\n\t_activeIndex = -1,\n\n\n\t// Titles of all moments which have expired (i.e. fallen off the bottom of the stack).\n\t_expired = [],\n\n\n\t// (optional) Seedable PRNG object.\n\t_prng = null;\n\n\t/*******************************************************************************************************************\n  * State Functions.\n  ******************************************************************************************************************/\n\t/**\n \tResets the story state.\n **/\n\tfunction stateReset() {\n\t\t// eslint-disable-line no-unused-vars\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[State/stateReset()]');\n\t\t}\n\n\t\t/*\n  \tDelete the active session.\n  */\n\t\tsession.delete('state');\n\n\t\t/*\n  \tReset the properties.\n  */\n\t\t_history = [];\n\t\t_active = momentCreate();\n\t\t_activeIndex = -1;\n\t\t_expired = [];\n\t\t_prng = _prng === null ? null : new PRNGWrapper(_prng.seed, false);\n\t}\n\n\t/**\n \tRestores the story state from the active session.\n **/\n\tfunction stateRestore() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[State/stateRestore()]');\n\t\t}\n\n\t\t/*\n  \tAttempt to restore an active session.\n  */\n\t\tif (session.has('state')) {\n\t\t\t/*\n   \tRetrieve the session.\n   */\n\t\t\tvar stateObj = session.get('state');\n\n\t\t\tif (DEBUG) {\n\t\t\t\tconsole.log('\\tsession state:', stateObj);\n\t\t\t}\n\n\t\t\tif (stateObj == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/*\n   \tRestore the session.\n   */\n\t\t\tstateUnmarshal(stateObj);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n \tReturns the current story state marshaled into a serializable object.\n **/\n\tfunction stateMarshal(noDelta) {\n\t\t/*\n  \tGather the properties.\n  */\n\t\tvar stateObj = {\n\t\t\tindex: _activeIndex\n\t\t};\n\n\t\tif (noDelta) {\n\t\t\tstateObj.history = clone(_history);\n\t\t} else {\n\t\t\tstateObj.delta = historyDeltaEncode(_history);\n\t\t}\n\n\t\tif (_expired.length > 0) {\n\t\t\tstateObj.expired = [].concat(_toConsumableArray(_expired));\n\t\t}\n\n\t\tif (_prng !== null) {\n\t\t\tstateObj.seed = _prng.seed;\n\t\t}\n\n\t\treturn stateObj;\n\t}\n\n\t/**\n \tRestores the story state from a marshaled story state serialization object.\n **/\n\tfunction stateUnmarshal(stateObj, noDelta) {\n\t\tif (stateObj == null) {\n\t\t\t// lazy equality for null\n\t\t\tthrow new Error('state object is null or undefined');\n\t\t}\n\n\t\tif (!stateObj.hasOwnProperty(noDelta ? 'history' : 'delta') || stateObj[noDelta ? 'history' : 'delta'].length === 0) {\n\t\t\tthrow new Error('state object has no history or history is empty');\n\t\t}\n\n\t\tif (!stateObj.hasOwnProperty('index')) {\n\t\t\tthrow new Error('state object has no index');\n\t\t}\n\n\t\tif (_prng !== null && !stateObj.hasOwnProperty('seed')) {\n\t\t\tthrow new Error('state object has no seed, but PRNG is enabled');\n\t\t}\n\n\t\tif (_prng === null && stateObj.hasOwnProperty('seed')) {\n\t\t\tthrow new Error('state object has seed, but PRNG is disabled');\n\t\t}\n\n\t\t/*\n  \tRestore the properties.\n  */\n\t\t_history = noDelta ? clone(stateObj.history) : historyDeltaDecode(stateObj.delta);\n\t\t_activeIndex = stateObj.index;\n\t\t_expired = stateObj.hasOwnProperty('expired') ? [].concat(_toConsumableArray(stateObj.expired)) : [];\n\n\t\tif (stateObj.hasOwnProperty('seed')) {\n\t\t\t/*\n   \tWe only need to restore the PRNG's seed here as `momentActivate()` will handle\n   \tfully restoring the PRNG to its proper state.\n   */\n\t\t\t_prng.seed = stateObj.seed;\n\t\t}\n\n\t\t/*\n  \tActivate the current moment (do this only after all properties have been restored).\n  */\n\t\tmomentActivate(_activeIndex);\n\t}\n\n\t/**\n \tReturns the current story state marshaled into a save-compatible serializable object.\n **/\n\tfunction stateMarshalForSave() {\n\t\treturn stateMarshal(true);\n\t}\n\n\t/**\n \tRestores the story state from a marshaled save-compatible story state serialization object.\n **/\n\tfunction stateUnmarshalForSave(stateObj) {\n\t\treturn stateUnmarshal(stateObj, true);\n\t}\n\n\t/**\n \tReturns the titles of expired moments.\n **/\n\tfunction stateExpired() {\n\t\treturn _expired;\n\t}\n\n\t/**\n \tReturns the total number of played moments (expired + in-play history moments).\n **/\n\tfunction stateTurns() {\n\t\treturn _expired.length + historyLength();\n\t}\n\n\t/**\n \tReturns the passage titles of all played moments (expired + in-play history moments).\n **/\n\tfunction stateTitles() {\n\t\treturn _expired.concat(_history.slice(0, historyLength()).map(function (m) {\n\t\t\treturn m.title;\n\t\t}));\n\t}\n\n\t/**\n \tReturns whether a passage with the given title has been played (expired + in-play history moments).\n **/\n\tfunction stateHasPlayed(title) {\n\t\tif (title == null || title === '') {\n\t\t\t// lazy equality for null\n\t\t\treturn false;\n\t\t}\n\n\t\tif (_expired.includes(title)) {\n\t\t\treturn true;\n\t\t} else if (_history.slice(0, historyLength()).some(function (m) {\n\t\t\treturn m.title === title;\n\t\t})) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/*******************************************************************************************************************\n  * Moment Functions.\n  ******************************************************************************************************************/\n\t/**\n \tReturns a new moment object created from the given passage title and variables object.\n **/\n\tfunction momentCreate(title, variables) {\n\t\treturn {\n\t\t\ttitle: title == null ? '' : String(title), // lazy equality for null\n\t\t\tvariables: variables == null ? {} : clone(variables) // lazy equality for null\n\t\t};\n\t}\n\n\t/**\n \tReturns the active (present) moment.\n **/\n\tfunction momentActive() {\n\t\treturn _active;\n\t}\n\n\t/**\n \tReturns the index within the history of the active (present) moment.\n **/\n\tfunction momentActiveIndex() {\n\t\treturn _activeIndex;\n\t}\n\n\t/**\n \tReturns the title from the active (present) moment.\n **/\n\tfunction momentActiveTitle() {\n\t\treturn _active.title;\n\t}\n\n\t/**\n \tReturns the variables from the active (present) moment.\n **/\n\tfunction momentActiveVariables() {\n\t\treturn _active.variables;\n\t}\n\n\t/**\n \tReturns the active (present) moment after setting it to either the given moment object\n \tor the moment object at the given history index.  Additionally, updates the active session\n \tand triggers a history update event.\n **/\n\tfunction momentActivate(moment) {\n\t\tif (moment == null) {\n\t\t\t// lazy equality for null\n\t\t\tthrow new Error('moment activation attempted with null or undefined');\n\t\t}\n\n\t\t/*\n  \tSet the active moment.\n  */\n\t\tswitch (typeof moment === 'undefined' ? 'undefined' : _typeof(moment)) {\n\t\t\tcase 'object':\n\t\t\t\t_active = clone(moment);\n\t\t\t\tbreak;\n\n\t\t\tcase 'number':\n\t\t\t\tif (historyIsEmpty()) {\n\t\t\t\t\tthrow new Error('moment activation attempted with index on empty history');\n\t\t\t\t}\n\n\t\t\t\tif (moment < 0 || moment >= historySize()) {\n\t\t\t\t\tthrow new RangeError('moment activation attempted with out-of-bounds index;' + (' need [0, ' + (historySize() - 1) + '], got ' + moment));\n\t\t\t\t}\n\n\t\t\t\t_active = clone(_history[moment]);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new TypeError('moment activation attempted with a \"' + (typeof moment === 'undefined' ? 'undefined' : _typeof(moment)) + '\";' + ' must be an object or valid history stack index');\n\t\t}\n\n\t\t/*\n  \tRestore the seedable PRNG.\n  \t\tn.b. We cannot simply set `_prng.pull` to `_active.pull` as that would not\n  \t     properly mutate the PRNG's internal state.\n  */\n\t\tif (_prng !== null) {\n\t\t\t_prng = PRNGWrapper.unmarshal({\n\t\t\t\tseed: _prng.seed,\n\t\t\t\tpull: _active.pull\n\t\t\t});\n\t\t}\n\n\t\t/*\n  \tUpdate the active session.\n  */\n\t\tsession.set('state', stateMarshal());\n\n\t\t/*\n  \tTrigger a global `tw:historyupdate` event.\n  \t\tn.b. We do this here because setting a new active moment is a core component of,\n  \t     virtually, all history updates.\n  */\n\t\tjQuery.event.trigger('tw:historyupdate');\n\n\t\treturn _active;\n\t}\n\n\t/*******************************************************************************************************************\n  * History Functions.\n  ******************************************************************************************************************/\n\t/**\n \tReturns the moment history.\n **/\n\tfunction historyGet() {\n\t\treturn _history;\n\t}\n\n\t/**\n \tReturns the number of active history moments (past only).\n **/\n\tfunction historyLength() {\n\t\treturn _activeIndex + 1;\n\t}\n\n\t/**\n \tReturns the total number of history moments (past + future).\n **/\n\tfunction historySize() {\n\t\treturn _history.length;\n\t}\n\n\t/**\n \tReturns whether the history is empty.\n **/\n\tfunction historyIsEmpty() {\n\t\treturn _history.length === 0;\n\t}\n\n\t/**\n \tReturns the topmost (most recent) moment within the history.\n **/\n\tfunction historyTop() {\n\t\treturn _history.length > 0 ? _history[_history.length - 1] : null;\n\t}\n\n\t/**\n \tReturns the bottommost (least recent) moment within the history.\n **/\n\tfunction historyBottom() {\n\t\treturn _history.length > 0 ? _history[0] : null;\n\t}\n\n\t/**\n \tReturns the moment at the given index within the history.\n **/\n\tfunction historyIndex(index) {\n\t\tif (historyIsEmpty() || index < 0 || index > _activeIndex) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn _history[index];\n\t}\n\n\t/**\n \tReturns the moment at the given offset from the active moment within the history.\n **/\n\tfunction historyPeek(offset) {\n\t\tif (historyIsEmpty()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar lengthOffset = 1 + (offset ? Math.abs(offset) : 0);\n\n\t\tif (lengthOffset > historyLength()) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn _history[historyLength() - lengthOffset];\n\t}\n\n\t/**\n \tReturns whether a moment with the given title exists within the history.\n **/\n\tfunction historyHas(title) {\n\t\tif (historyIsEmpty() || title == null || title === '') {\n\t\t\t// lazy equality for null\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (var i = _activeIndex; i >= 0; --i) {\n\t\t\tif (_history[i].title === title) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n \tCreates a new moment and pushes it onto the history, discarding future moments if necessary.\n **/\n\tfunction historyCreate(title) {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[State/historyCreate(title: \"' + title + '\")]');\n\t\t}\n\n\t\t/*\n  \tTODO: It might be good to have some assertions about the passage title here.\n  */\n\n\t\t/*\n  \tIf we're not at the top of the stack, discard the future moments.\n  */\n\t\tif (historyLength() < historySize()) {\n\t\t\tif (DEBUG) {\n\t\t\t\tconsole.log('\\tnon-top push; discarding ' + (historySize() - historyLength()) + ' future moments');\n\t\t\t}\n\n\t\t\t_history.splice(historyLength(), historySize() - historyLength());\n\t\t}\n\n\t\t/*\n  \tPush the new moment onto the history stack.\n  */\n\t\t_history.push(momentCreate(title, _active.variables));\n\n\t\tif (_prng) {\n\t\t\thistoryTop().pull = _prng.pull;\n\t\t}\n\n\t\t/*\n  \tTruncate the history, if necessary, by discarding moments from the bottom.\n  */\n\t\tif (Config.history.maxStates > 0) {\n\t\t\twhile (historySize() > Config.history.maxStates) {\n\t\t\t\t_expired.push(_history.shift().title);\n\t\t\t}\n\t\t}\n\n\t\t/*\n  \tActivate the new top moment.\n  */\n\t\t_activeIndex = historySize() - 1;\n\t\tmomentActivate(_activeIndex);\n\n\t\treturn historyLength();\n\t}\n\n\t/**\n \tActivate the moment at the given index within the history.\n **/\n\tfunction historyGoTo(index) {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[State/historyGoTo(index: ' + index + ')]');\n\t\t}\n\n\t\tif (index == null /* lazy equality for null */\n\t\t|| index < 0 || index >= historySize() || index === _activeIndex) {\n\t\t\treturn false;\n\t\t}\n\n\t\t_activeIndex = index;\n\t\tmomentActivate(_activeIndex);\n\n\t\treturn true;\n\t}\n\n\t/**\n \tActivate the moment at the given offset from the active moment within the history.\n **/\n\tfunction historyGo(offset) {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[State/historyGo(offset: ' + offset + ')]');\n\t\t}\n\n\t\tif (offset == null || offset === 0) {\n\t\t\t// lazy equality for null\n\t\t\treturn false;\n\t\t}\n\n\t\treturn historyGoTo(_activeIndex + offset);\n\t}\n\n\t/**\n \tReturns the delta encoded form of the given history array.\n **/\n\tfunction historyDeltaEncode(historyArr) {\n\t\tif (!Array.isArray(historyArr)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (historyArr.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tvar delta = [clone(historyArr[0])];\n\n\t\tfor (var i = 1, iend = historyArr.length; i < iend; ++i) {\n\t\t\tdelta.push(Util.diff(historyArr[i - 1], historyArr[i]));\n\t\t}\n\n\t\treturn delta;\n\t}\n\n\t/**\n \tReturns a history array from the given delta encoded history array.\n **/\n\tfunction historyDeltaDecode(delta) {\n\t\tif (!Array.isArray(delta)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (delta.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tvar historyArr = [clone(delta[0])];\n\n\t\tfor (var i = 1, iend = delta.length; i < iend; ++i) {\n\t\t\thistoryArr.push(Util.patch(historyArr[i - 1], delta[i]));\n\t\t}\n\n\t\treturn historyArr;\n\t}\n\n\t/*******************************************************************************************************************\n  * PRNG Functions.\n  ******************************************************************************************************************/\n\tfunction prngInit(seed, useEntropy) {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[State/prngInit(seed: ' + seed + ', useEntropy: ' + useEntropy + ')]');\n\t\t}\n\n\t\tif (!historyIsEmpty()) {\n\t\t\tvar scriptSection = void 0;\n\n\t\t\tif (TWINE1) {\n\t\t\t\t// for Twine 1\n\t\t\t\tscriptSection = 'a script-tagged passage';\n\t\t\t} else {\n\t\t\t\t// for Twine 2\n\t\t\t\tscriptSection = 'the Story JavaScript';\n\t\t\t}\n\n\t\t\tthrow new Error('State.initPRNG must be called during initialization,' + (' within either ' + scriptSection + ' or the StoryInit special passage'));\n\t\t}\n\n\t\t_prng = new PRNGWrapper(seed, useEntropy);\n\t\t_active.pull = _prng.pull;\n\t}\n\n\tfunction prngRandom() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[State/prngRandom()]');\n\t\t}\n\n\t\treturn _prng ? _prng.random() : Math.random();\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\t/*\n  \tState Functions.\n  */\n\t\treset: { value: stateReset },\n\t\trestore: { value: stateRestore },\n\t\tmarshalForSave: { value: stateMarshalForSave },\n\t\tunmarshalForSave: { value: stateUnmarshalForSave },\n\t\texpired: { get: stateExpired },\n\t\tturns: { get: stateTurns },\n\t\tpassages: { get: stateTitles },\n\t\thasPlayed: { value: stateHasPlayed },\n\n\t\t/*\n  \tMoment Functions.\n  */\n\t\tactive: { get: momentActive },\n\t\tactiveIndex: { get: momentActiveIndex },\n\t\tpassage: { get: momentActiveTitle }, // shortcut for `State.active.title`\n\t\tvariables: { get: momentActiveVariables }, // shortcut for `State.active.variables`\n\n\t\t/*\n  \tHistory Functions.\n  */\n\t\thistory: { get: historyGet },\n\t\tlength: { get: historyLength },\n\t\tsize: { get: historySize },\n\t\tisEmpty: { value: historyIsEmpty },\n\t\ttop: { value: historyTop },\n\t\tbottom: { value: historyBottom },\n\t\tindex: { value: historyIndex },\n\t\tpeek: { value: historyPeek },\n\t\thas: { value: historyHas },\n\t\tcreate: { value: historyCreate },\n\t\tgoTo: { value: historyGoTo },\n\t\tgo: { value: historyGo },\n\t\tdeltaEncode: { value: historyDeltaEncode },\n\t\tdeltaDecode: { value: historyDeltaDecode },\n\n\t\t/*\n  \tPRNG Functions.\n  */\n\t\tinitPRNG: { value: prngInit },\n\t\trandom: { value: prngRandom },\n\n\t\t/*\n  \tLegacy Aliases.\n  */\n\t\trestart: { value: function value() {\n\t\t\t\treturn Engine.restart();\n\t\t\t} },\n\t\tbackward: { value: function value() {\n\t\t\t\treturn Engine.backward();\n\t\t\t} },\n\t\tforward: { value: function value() {\n\t\t\t\treturn Engine.forward();\n\t\t\t} },\n\t\tdisplay: { value: function value() {\n\t\t\t\treturn Engine.display.apply(Engine, arguments);\n\t\t\t} },\n\t\tshow: { value: function value() {\n\t\t\t\treturn Engine.show.apply(Engine, arguments);\n\t\t\t} },\n\t\tplay: { value: function value() {\n\t\t\t\treturn Engine.play.apply(Engine, arguments);\n\t\t\t} }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * story.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* global Alert, Config, Passage, Scripting, Util, Wikifier, addStyle */\n\nvar Story = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar\n\t// Map of normal passages.\n\t_passages = {},\n\n\n\t// List of style passages.\n\t_styles = [],\n\n\n\t// List of script passages.\n\t_scripts = [],\n\n\n\t// List of widget passages.\n\t_widgets = [];\n\n\tvar\n\t// Story title.\n\t_title = '',\n\n\n\t// Story IFID.\n\t_ifId = '',\n\n\n\t// DOM-compatible ID.\n\t_domId = '';\n\n\t/*******************************************************************************************************************\n  * Story Functions.\n  ******************************************************************************************************************/\n\tfunction storyLoad() {\n\t\t// For Twine 1.\n\t\tif (TWINE1) {\n\t\t\tif (DEBUG) {\n\t\t\t\tconsole.log('[Story/storyLoad()]');\n\t\t\t}\n\n\t\t\t/*\n   \tSet the default starting passage.\n   */\n\t\t\tConfig.passages.start = function () {\n\t\t\t\t// Handle the Twine 1.4+ Test Play From Here feature (pattern: \"START_AT\").\n\t\t\t\tvar testPlay = \"START_AT\"; // eslint-disable-line quotes\n\t\t\t\tif (testPlay !== '') {\n\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\tconsole.log('\\tTest play; starting passage: \"' + testPlay + '\"');\n\t\t\t\t\t}\n\n\t\t\t\t\tConfig.debug = true;\n\t\t\t\t\treturn testPlay;\n\t\t\t\t}\n\n\t\t\t\t// In the absence of a `testPlay` value, return 'Start'.\n\t\t\t\treturn 'Start';\n\t\t\t}();\n\n\t\t\t/*\n   \tProcess the passages, excluding any tagged 'Twine.private' or 'annotation'.\n   */\n\t\t\tjQuery('#store-area').children(':not([tags~=\"Twine.private\"],[tags~=\"annotation\"])').each(function () {\n\t\t\t\tvar $this = jQuery(this),\n\t\t\t\t    passage = new Passage($this.attr('tiddler'), this);\n\n\t\t\t\t// Special cases.\n\t\t\t\tif (passage.tags.includes('stylesheet')) {\n\t\t\t\t\t_styles.push(passage);\n\t\t\t\t} else if (passage.tags.includes('script')) {\n\t\t\t\t\t_scripts.push(passage);\n\t\t\t\t} else if (passage.tags.includes('widget')) {\n\t\t\t\t\t_widgets.push(passage);\n\t\t\t\t}\n\n\t\t\t\t// Normal passages.\n\t\t\t\telse {\n\t\t\t\t\t\t_passages[passage.title] = passage;\n\t\t\t\t\t}\n\t\t\t});\n\n\t\t\t/*\n   \tSet the story title or throw an exception.\n   */\n\t\t\tif (_passages.hasOwnProperty('StoryTitle')) {\n\t\t\t\tvar buf = document.createDocumentFragment();\n\t\t\t\tnew Wikifier(buf, _passages.StoryTitle.processText().trim());\n\t\t\t\t_storySetTitle(buf.textContent.trim());\n\t\t\t} else {\n\t\t\t\tthrow new Error('cannot find the StoryTitle special passage');\n\t\t\t}\n\n\t\t\t/*\n   \tSet the default saves ID (must be done after the call to `_storySetTitle()`).\n   \t\tn.b. If not for the requirement to support Twine 1/Twee, we could use the\n   \t     story's IFID attribute here.\n   */\n\t\t\tConfig.saves.id = Story.domId;\n\t\t}\n\n\t\t// For Twine 2.\n\t\telse {\n\t\t\t\t(function () {\n\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\tconsole.log('[Story/storyLoad()]');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $storydata = jQuery('#store-area>tw-storydata'),\n\t\t\t\t\t    startNode = $storydata.attr('startnode') || '';\n\n\t\t\t\t\t/*\n     \tSet the default starting passage.\n     */\n\t\t\t\t\tConfig.passages.start = null; // no default in Twine 2\n\n\t\t\t\t\t/*\n     \tProcess story options.\n     \t\tn.b. Currently, the only option of interest to us is 'debug' (it may be the\n     \t     only one period), so we simply use `<RegExp>.test()` to check for it.\n     */\n\t\t\t\t\tConfig.debug = /\\bdebug\\b/.test($storydata.attr('options'));\n\n\t\t\t\t\t/*\n     \tProcess stylesheet passages.\n     */\n\t\t\t\t\t$storydata.children('style') // alternatively: '[type=\"text/twine-css\"]' or '#twine-user-stylesheet'\n\t\t\t\t\t.each(function (i) {\n\t\t\t\t\t\t_styles.push(new Passage('tw-user-style-' + i, this));\n\t\t\t\t\t});\n\n\t\t\t\t\t/*\n     \tProcess script passages.\n     */\n\t\t\t\t\t$storydata.children('script') // alternatively: '[type=\"text/twine-javascript\"]' or '#twine-user-script'\n\t\t\t\t\t.each(function (i) {\n\t\t\t\t\t\t_scripts.push(new Passage('tw-user-script-' + i, this));\n\t\t\t\t\t});\n\n\t\t\t\t\t/*\n     \tProcess normal passages, excluding any tagged 'Twine.private' or 'annotation'.\n     */\n\t\t\t\t\t$storydata.children('tw-passagedata:not([tags~=\"Twine.private\"],[tags~=\"annotation\"])').each(function () {\n\t\t\t\t\t\tvar $this = jQuery(this),\n\t\t\t\t\t\t    pid = $this.attr('pid') || '',\n\t\t\t\t\t\t    passage = new Passage($this.attr('name'), this);\n\n\t\t\t\t\t\tif (pid === startNode && startNode !== '') {\n\t\t\t\t\t\t\tConfig.passages.start = passage.title;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Special cases.\n\t\t\t\t\t\tif (passage.tags.includes('widget')) {\n\t\t\t\t\t\t\t_widgets.push(passage);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Normal passages.\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t_passages[passage.title] = passage;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t/*\n     \tGet the story IFID.\n     */\n\t\t\t\t\t_ifId = $storydata.attr('ifid');\n\n\t\t\t\t\t/*\n     \tSet the story title.\n     \t\tTODO: Maybe `$storydata.attr('name')` should be used instead of `'{{STORY_NAME}}'`?\n     */\n\t\t\t\t\t_storySetTitle(Util.unescape('{{STORY_NAME}}'));\n\n\t\t\t\t\t/*\n     \tSet the default saves ID (must be done after the call to `_storySetTitle()`).\n     \t\tn.b. If not for the requirement to support Twine 1/Twee, we could use the\n     \t     story's IFID attribute here.\n     */\n\t\t\t\t\tConfig.saves.id = Story.domId;\n\t\t\t\t})();\n\t\t\t}\n\t}\n\n\tfunction storyInit() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[Story/storyInit()]');\n\t\t}\n\n\t\t/*\n  \tAdd the story styles.\n  */\n\t\tfor (var i = 0; i < _styles.length; ++i) {\n\t\t\taddStyle(_styles[i].text);\n\t\t}\n\n\t\t/*\n  \tEvaluate the story scripts.\n  */\n\t\tfor (var _i4 = 0; _i4 < _scripts.length; ++_i4) {\n\t\t\ttry {\n\t\t\t\tScripting.evalJavaScript(_scripts[_i4].text);\n\t\t\t} catch (e) {\n\t\t\t\tAlert.error(_scripts[_i4].title, e.message);\n\t\t\t}\n\t\t}\n\n\t\t/*\n  \tProcess the story widgets.\n  */\n\t\tfor (var _i5 = 0; _i5 < _widgets.length; ++_i5) {\n\t\t\ttry {\n\t\t\t\tWikifier.wikifyEval(_widgets[_i5].processText());\n\t\t\t} catch (e) {\n\t\t\t\tAlert.error(_widgets[_i5].title, e.message);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _storySetTitle(title) {\n\t\tif (title == null || title === '') {\n\t\t\t// lazy equality for null\n\t\t\tthrow new Error('story title cannot be null or empty');\n\t\t}\n\n\t\tdocument.title = _title = Util.unescape(title);\n\t\t_domId = Util.slugify(_title);\n\t}\n\n\tfunction storyTitle() {\n\t\treturn _title;\n\t}\n\n\tfunction storyDomId() {\n\t\treturn _domId;\n\t}\n\n\tfunction storyIfId() {\n\t\treturn _ifId;\n\t}\n\n\t/*******************************************************************************************************************\n  * Passage Functions.\n  ******************************************************************************************************************/\n\tfunction passagesHas(title) {\n\t\tvar type = typeof title === 'undefined' ? 'undefined' : _typeof(title);\n\n\t\tswitch (type) {\n\t\t\t// Valid types.\n\t\t\tcase 'number':\n\t\t\tcase 'string':\n\t\t\t\t{\n\t\t\t\t\tvar id = String(title);\n\t\t\t\t\treturn _passages.hasOwnProperty(id);\n\t\t\t\t}\n\n\t\t\t// Invalid types.  We do the extra processing just to make a nicer error.\n\t\t\tcase 'boolean':\n\t\t\tcase 'function':\n\t\t\t\ttype = 'a ' + type;\n\t\t\t\tbreak;\n\n\t\t\tcase 'undefined':\n\t\t\t\t/* no-op */\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// 'object'\n\t\t\t\tif (title === null) {\n\t\t\t\t\ttype = 'null';\n\t\t\t\t} else {\n\t\t\t\t\ttype = 'an ' + type;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthrow new TypeError('Story.has title parameter cannot be ' + type);\n\t}\n\n\tfunction passagesGet(title) {\n\t\tvar type = typeof title === 'undefined' ? 'undefined' : _typeof(title);\n\n\t\tswitch (type) {\n\t\t\t// Valid types.\n\t\t\tcase 'number':\n\t\t\tcase 'string':\n\t\t\t\t{\n\t\t\t\t\tvar id = String(title);\n\t\t\t\t\treturn _passages.hasOwnProperty(id) ? _passages[id] : new Passage(id || '(unknown)');\n\t\t\t\t}\n\n\t\t\t// Invalid types.  We do the extra processing just to make a nicer error.\n\t\t\tcase 'boolean':\n\t\t\tcase 'function':\n\t\t\t\ttype = 'a ' + type;\n\t\t\t\tbreak;\n\n\t\t\tcase 'undefined':\n\t\t\t\t/* no-op */\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// 'object'\n\t\t\t\tif (title === null) {\n\t\t\t\t\ttype = 'null';\n\t\t\t\t} else {\n\t\t\t\t\ttype = 'an ' + type;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthrow new TypeError('Story.get title parameter cannot be ' + type);\n\t}\n\n\tfunction passagesLookup(key, value) {\n\t\tvar sortKey = arguments.length <= 2 || arguments[2] === undefined ? 'title' : arguments[2];\n\n\t\tvar pnames = Object.keys(_passages),\n\t\t    results = [];\n\n\t\tfor (var i = 0; i < pnames.length; ++i) {\n\t\t\tvar passage = _passages[pnames[i]];\n\n\t\t\tif (passage.hasOwnProperty(key)) {\n\t\t\t\tswitch (_typeof(passage[key])) {\n\t\t\t\t\tcase 'undefined':\n\t\t\t\t\t\t/* no-op */\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t// Currently, we assume that the only properties which are objects will\n\t\t\t\t\t\t// either be arrays or array-like-objects.\n\t\t\t\t\t\tfor (var j = 0, jend = passage[key].length; j < jend; ++j) {\n\t\t\t\t\t\t\t/* eslint-disable eqeqeq */\n\t\t\t\t\t\t\tif (passage[key][j] == value) {\n\t\t\t\t\t\t\t\t// lazy equality, since null & undefined are both possible\n\t\t\t\t\t\t\t\tresults.push(passage);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/* eslint-enable eqeqeq */\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t/* eslint-disable eqeqeq */\n\t\t\t\t\t\tif (passage[key] == value) {\n\t\t\t\t\t\t\t// lazy equality, since null & undefined are both possible\n\t\t\t\t\t\t\tresults.push(passage);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t/* eslint-enable eqeqeq */\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/* eslint-disable eqeqeq, no-nested-ternary, max-len */\n\t\tresults.sort(function (a, b) {\n\t\t\treturn a[sortKey] == b[sortKey] ? 0 : a[sortKey] < b[sortKey] ? -1 : +1;\n\t\t}); // lazy equality for null\n\t\t/* eslint-enable eqeqeq, no-nested-ternary, max-len */\n\n\t\treturn results;\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\t/*\n  \tPassage Containers.\n  \t\tTODO: These should probably have getters, rather than being exported directly.\n  */\n\t\tpassages: { value: _passages },\n\t\tstyles: { value: _styles },\n\t\tscripts: { value: _scripts },\n\t\twidgets: { value: _widgets },\n\n\t\t/*\n  \tStory Functions.\n  */\n\t\tload: { value: storyLoad },\n\t\tinit: { value: storyInit },\n\t\ttitle: { get: storyTitle }, // a setter is probably not required here\n\t\tdomId: { get: storyDomId },\n\t\tifId: { get: storyIfId },\n\n\t\t/*\n  \tPassage Functions.\n  */\n\t\thas: { value: passagesHas },\n\t\tget: { value: passagesGet },\n\t\tlookup: { value: passagesLookup }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * strings.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/* eslint-disable max-len, prefer-template */\n\n/*\n\tNotes:\n\n\t1. The capitalization and punctuation used herein is deliberate, especially within the error strings.\n\t2. The replacement patterns (%…%) are only supported for the strings in which they can be found\n\t   herein.  During replacement, all instances of the patterns are replaced, so, where they are\n\t   found, they may be used as many times as desired.\n*/\nvar strings = Object.seal({ // eslint-disable-line no-unused-vars, no-var\n\t/*\n \tIdentity.\n */\n\tidentity: 'game',\n\n\t/*\n \tGeneral.\n */\n\taborting: 'Aborting',\n\tcancel: 'Cancel',\n\tclose: 'Close',\n\tok: 'OK',\n\n\t/*\n \tErrors.\n */\n\terrors: {\n\t\ttitle: 'Error',\n\t\tnonexistentPassage: 'the passage \"%passage%\" does not exist',\n\t\tsaveMissingData: \"save is missing required data. Either you've loaded a file which is not a save or the save has become corrupted\",\n\t\tsaveIdMismatch: 'save is from the wrong %identity%'\n\t},\n\n\t/*\n \tWarnings.\n */\n\twarnings: {\n\t\tdegraded: 'Apologies! Your browser either lacks some of the capabilities required by this %identity% or has disabled them, so this %identity% is running in a degraded mode. You may be able to continue, but some parts may not work properly.\\n\\nThe former may, probably, be solved by upgrading your browser. The latter may be solved by loosening its security restrictions' + (window.location.protocol === 'file:' ? ' or, perhaps, by viewing this %identity% via the HTTP protocol.' : '.')\n\t},\n\n\t/*\n \tDebug View.\n */\n\tdebugView: {\n\t\ttitle: 'Debug View',\n\t\ttoggle: 'Toggle the debug view'\n\t},\n\n\t/*\n \tUI bar.\n */\n\tuiBar: {\n\t\ttoggle: 'Toggle the UI bar',\n\t\tbackward: 'Go backward within the %identity% history',\n\t\tforward: 'Go forward within the %identity% history',\n\t\tjumpto: 'Jump to a specific point within the %identity% history'\n\t},\n\n\t/*\n \tJump To.\n */\n\tjumpto: {\n\t\ttitle: 'Jump To',\n\t\tturn: 'Turn',\n\t\tunavailable: 'No jump points currently available…'\n\t},\n\n\t/*\n \tSaves.\n */\n\tsaves: {\n\t\ttitle: 'Saves',\n\t\tdisallowed: 'Saving has been disallowed on this passage.',\n\t\temptySlot: '— slot empty —',\n\t\tincapable: 'Apologies! Your browser either lacks the capabilities required to support saves or has disabled them, so saves have been disabled for this session.<br><br>The former may, probably, be solved by <a href=\"http://browsehappy.com/\" target=\"_blank\">upgrading your browser</a>. The latter may be solved by loosening its security restrictions' + (window.location.protocol === 'file:' ? ' or, perhaps, by viewing this %identity% via the HTTP protocol.' : '.'),\n\t\tlabelAuto: 'Autosave',\n\t\tlabelDelete: 'Delete',\n\t\tlabelExport: 'Save to Disk…',\n\t\tlabelImport: 'Load from Disk…',\n\t\tlabelLoad: 'Load',\n\t\tlabelClear: 'Delete All',\n\t\tlabelSave: 'Save',\n\t\tlabelSlot: 'Slot',\n\t\tsavedOn: 'Saved on',\n\t\tunavailable: 'No save slots found…',\n\t\tunknownDate: 'unknown'\n\t},\n\n\t/*\n \tSettings.\n */\n\tsettings: {\n\t\ttitle: 'Settings',\n\t\toff: 'Off',\n\t\ton: 'On',\n\t\treset: 'Reset to Defaults'\n\t},\n\n\t/*\n \tRestart.\n */\n\trestart: {\n\t\ttitle: 'Restart',\n\t\tprompt: 'Are you sure that you want to restart? Unsaved progress will be lost.'\n\t},\n\n\t/*\n \tShare.\n */\n\tshare: {\n\t\ttitle: 'Share'\n\t},\n\n\t/*\n \tAlert.\n */\n\talert: {\n\t\t/* empty*/\n\t},\n\n\t/*\n \tAutoload.\n */\n\tautoload: {\n\t\ttitle: 'Autoload',\n\t\tcancel: 'Go to start',\n\t\tok: 'Load autosave',\n\t\tprompt: 'An autosave exists. Load it now or go to the start?'\n\t},\n\n\t/*\n \tMacros.\n */\n\tmacros: {\n\t\tback: {\n\t\t\ttext: 'Back'\n\t\t},\n\t\treturn: {\n\t\t\ttext: 'Return'\n\t\t}\n\t}\n});\n\n/***********************************************************************************************************************\n *\n * ui.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/*\n\tglobal Dialog, Engine, Has, Save, Setting, State, Story, StyleWrapper, Util, Wikifier, Config, setPageElement,\n\t       settings, strings\n*/\n\nvar UI = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar _outlinePatch = null;\n\n\t/*******************************************************************************************************************\n  * UI Functions, Core.\n  ******************************************************************************************************************/\n\tfunction uiInit() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiInit()]');\n\t\t}\n\n\t\t/*\n  \tRemove #init-no-js & #init-lacking from #init-screen.\n  */\n\t\tjQuery('#init-no-js,#init-lacking').remove();\n\n\t\t/*\n  \tGenerate and cache the outline patching <style> element (`StyleWrapper`-wrapped).\n  */\n\t\t_outlinePatch = new StyleWrapper(function () {\n\t\t\treturn jQuery(document.createElement('style')).attr({\n\t\t\t\tid: 'style-outline-patch',\n\t\t\t\ttype: 'text/css'\n\t\t\t}).appendTo(document.head).get(0);\n\t\t} // return the <style> element itself\n\t\t());\n\n\t\t/*\n  \tGenerate the UI bar elements and insert them into the page before the store area.\n  */\n\t\t(function () {\n\t\t\tvar $uiTree = jQuery(document.createDocumentFragment()),\n\t\t\t    toggleLabel = strings.uiBar.toggle,\n\t\t\t    backwardLabel = strings.uiBar.backward.replace(/%identity%/g, strings.identity),\n\t\t\t    jumptoLabel = strings.uiBar.jumpto.replace(/%identity%/g, strings.identity),\n\t\t\t    forwardLabel = strings.uiBar.forward.replace(/%identity%/g, strings.identity);\n\n\t\t\t// OLDFASHIONED\n\t\t\t// -- added \"hud\"\n\t\t\t$uiTree.append(\n\t\t\t/* eslint-disable max-len */\n\t\t\t'<div id=\"ui-bar\">' + '<div id=\"ui-bar-tray\">' + ('<button id=\"ui-bar-toggle\" tabindex=\"0\" title=\"' + toggleLabel + '\" aria-label=\"' + toggleLabel + '\"></button>') + '<div id=\"ui-bar-history\">' + ('<button id=\"history-backward\" tabindex=\"0\" title=\"' + backwardLabel + '\" aria-label=\"' + backwardLabel + '\"><i class=\"fa fa-arrow-left\" aria-hidden=\"true\"></i></button>') + ('<button id=\"history-jumpto\" tabindex=\"0\" title=\"' + jumptoLabel + '\" aria-label=\"' + jumptoLabel + '\"></button>') + ('<button id=\"history-forward\" tabindex=\"0\" title=\"' + forwardLabel + '\" aria-label=\"' + forwardLabel + '\"><i class=\"fa fa-arrow-right\" aria-hidden=\"true\"></i></button>') + '</div>' + '</div>' + '<div id=\"ui-bar-body\">' + '<header id=\"title\" role=\"banner\">' + '<div id=\"story-banner\"></div>' + '<h1 id=\"story-title\"></h1>' + '<div id=\"story-subtitle\"></div>' + '<div id=\"story-title-separator\"></div>' + '<p id=\"story-author\"></p>' + '</header>' + '<div id=\"story-caption\"></div>' + '<nav id=\"menu\" role=\"navigation\">' + '<ul id=\"menu-story\"></ul>' + '<ul id=\"menu-core\">' + ('<li id=\"menu-item-saves\"><a tabindex=\"0\">' + strings.saves.title + '</a></li>') + ('<li id=\"menu-item-settings\"><a tabindex=\"0\">' + strings.settings.title + '</a></li>') + ('<li id=\"menu-item-restart\"><a tabindex=\"0\">' + strings.restart.title + '</a></li>') + ('<li id=\"menu-item-share\"><a tabindex=\"0\">' + strings.share.title + '</a></li>') + '</ul>' + '</nav>' + '</div>' + '</div>' + '<div id=\"story\" role=\"main\">' + '<div id=\"passages\"></div>' + '</div>'\n\t\t\t/* eslint-enable max-len */\n\t\t\t);\n\n\t\t\t$(\"#hud\").append($uiTree);\n\t\t\t//.insertBefore('#store-area');\n\t\t})();\n\n\t\t/*\n  \tSetup the UI bar's global event handlers.\n  */\n\t\tjQuery(document)\n\t\t// Setup a handler for the history-backward/-forward buttons.\n\t\t.on('tw:historyupdate', function ($backward, $forward) {\n\t\t\treturn function () {\n\t\t\t\t$backward.prop('disabled', State.length < 2);\n\t\t\t\t$forward.prop('disabled', State.length === State.size);\n\t\t\t};\n\t\t}(jQuery('#history-backward'), jQuery('#history-forward')))\n\t\t// Setup accessible outline handling.\n\t\t//   based on: http://www.paciellogroup.com/blog/2012/04/how-to-remove-css-outlines-in-an-accessible-manner/\n\t\t.on('mousedown.outline-handler keydown.outline-handler', function (evt) {\n\t\t\tswitch (evt.type) {\n\t\t\t\tcase 'mousedown':\n\t\t\t\t\tuiHideOutlines();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'keydown':\n\t\t\t\t\tuiShowOutlines();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction uiStart() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiStart()]');\n\t\t}\n\n\t\tvar $uiBar = jQuery('#ui-bar');\n\n\t\t// Setup the #ui-bar's initial state.\n\t\tif (Config.ui.stowBarInitially || jQuery(window).width() <= 800) {\n\t\t\t(function () {\n\t\t\t\tvar $uiBarStory = jQuery($uiBar).add('#story');\n\t\t\t\t$uiBarStory.addClass('no-transition');\n\t\t\t\t$uiBar.addClass('stowed');\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\treturn $uiBarStory.removeClass('no-transition');\n\t\t\t\t}, Engine.minDomActionDelay);\n\t\t\t})();\n\t\t}\n\n\t\t// Setup the #ui-bar-toggle and #ui-bar-history widgets.\n\t\tjQuery('#ui-bar-toggle').ariaClick({\n\t\t\tlabel: strings.uiBar.toggle\n\t\t}, function () {\n\t\t\treturn $uiBar.toggleClass('stowed');\n\t\t});\n\n\t\tif (Config.history.controls) {\n\t\t\tjQuery('#history-backward').prop('disabled', State.length < 2).ariaClick({\n\t\t\t\tlabel: strings.uiBar.backward.replace(/%identity%/g, strings.identity)\n\t\t\t}, function () {\n\t\t\t\treturn Engine.backward();\n\t\t\t});\n\n\t\t\tif (Story.lookup('tags', 'bookmark').length > 0) {\n\t\t\t\tjQuery('#history-jumpto').ariaClick({\n\t\t\t\t\tlabel: strings.uiBar.jumpto.replace(/%identity%/g, strings.identity)\n\t\t\t\t}, function () {\n\t\t\t\t\treturn UI.jumpto();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tjQuery('#history-jumpto').remove();\n\t\t\t}\n\n\t\t\tjQuery('#history-forward').prop('disabled', State.length === State.size).ariaClick({\n\t\t\t\tlabel: strings.uiBar.forward.replace(/%identity%/g, strings.identity)\n\t\t\t}, function () {\n\t\t\t\treturn Engine.forward();\n\t\t\t});\n\t\t} else {\n\t\t\tjQuery('#ui-bar-history').remove();\n\t\t}\n\n\t\t// Setup the title.\n\t\tif (TWINE1) {\n\t\t\t// for Twine 1\n\t\t\tsetPageElement('story-title', 'StoryTitle', Story.title);\n\t\t} else {\n\t\t\t// for Twine 2\n\t\t\tjQuery('#story-title').text(Story.title);\n\t\t}\n\n\t\t// Setup the dynamic page elements.\n\t\tif (!Story.has('StoryCaption')) {\n\t\t\tjQuery('#story-caption').remove();\n\t\t}\n\n\t\tif (!Story.has('StoryMenu')) {\n\t\t\tjQuery('#menu-story').remove();\n\t\t}\n\n\t\tif (!Config.ui.updateStoryElements) {\n\t\t\t/*\n   \tWe only need to set the story elements here if `Config.ui.updateStoryElements`\n   \tis falsy, since otherwise they will be set by `Engine.play()`.\n   */\n\t\t\tuiSetStoryElements();\n\t\t}\n\n\t\t// Setup the Saves menu item.\n\t\tDialog.addClickHandler('#menu-item-saves a', null, uiBuildSaves).text(strings.saves.title);\n\n\t\t// Setup the Settings menu item.\n\t\tif (!Setting.isEmpty()) {\n\t\t\tDialog.addClickHandler('#menu-item-settings a', null, uiBuildSettings).text(strings.settings.title);\n\t\t} else {\n\t\t\tjQuery('#menu-item-settings').remove();\n\t\t}\n\n\t\t// Setup the Restart menu item.\n\t\tDialog.addClickHandler('#menu-item-restart a', null, uiBuildRestart).text(strings.restart.title);\n\n\t\t// Setup the Share menu item.\n\t\tif (Story.has('StoryShare')) {\n\t\t\tDialog.addClickHandler('#menu-item-share a', null, uiBuildShare).text(strings.share.title);\n\t\t} else {\n\t\t\tjQuery('#menu-item-share').remove();\n\t\t}\n\n\t\t// Focus the document element initially.\n\t\tjQuery(document.documentElement).focus();\n\t}\n\n\tfunction uiSetStoryElements() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiSetStoryElements()]');\n\t\t}\n\n\t\t// Setup the (non-navigation) dynamic page elements.\n\t\tsetPageElement('story-banner', 'StoryBanner');\n\t\tsetPageElement('story-subtitle', 'StorySubtitle');\n\t\tsetPageElement('story-author', 'StoryAuthor');\n\t\tsetPageElement('story-caption', 'StoryCaption');\n\n\t\t// Setup the #menu-story items.\n\t\tvar menuStory = document.getElementById('menu-story');\n\n\t\tif (menuStory !== null) {\n\t\t\tjQuery(menuStory).empty();\n\n\t\t\tif (Story.has('StoryMenu')) {\n\t\t\t\tuiAssembleLinkList('StoryMenu', menuStory);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction uiHideOutlines() {\n\t\t_outlinePatch.set('*:focus{outline:none}');\n\t}\n\n\tfunction uiShowOutlines() {\n\t\t_outlinePatch.clear();\n\t}\n\n\tfunction uiAssembleLinkList(passage, listEl) {\n\t\tvar list = listEl;\n\n\t\t// Cache the value of `Config.debug` and then disable it during this method's run.\n\t\tvar debugState = Config.debug;\n\t\tConfig.debug = false;\n\n\t\tif (list == null) {\n\t\t\t// lazy equality for null\n\t\t\tlist = document.createElement('ul');\n\t\t}\n\n\t\tvar temp = document.createDocumentFragment();\n\t\tnew Wikifier(temp, Story.get(passage).processText().trim());\n\n\t\tif (temp.hasChildNodes()) {\n\t\t\tvar li = null;\n\n\t\t\twhile (temp.hasChildNodes()) {\n\t\t\t\tvar node = temp.firstChild;\n\n\t\t\t\t// Non-<a>-element nodes.\n\t\t\t\tif (node.nodeType !== Node.ELEMENT_NODE || node.nodeName.toUpperCase() !== 'A') {\n\t\t\t\t\ttemp.removeChild(node);\n\n\t\t\t\t\tif (li !== null) {\n\t\t\t\t\t\t// Forget the current list item.\n\t\t\t\t\t\tli = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// <a>-element nodes.\n\t\t\t\telse {\n\t\t\t\t\t\tif (li === null) {\n\t\t\t\t\t\t\t// Create a new list item.\n\t\t\t\t\t\t\tli = document.createElement('li');\n\t\t\t\t\t\t\tlist.appendChild(li);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tli.appendChild(node);\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Restore `Config.debug` to its original value.\n\t\tConfig.debug = debugState;\n\n\t\treturn list;\n\t}\n\n\t/*******************************************************************************************************************\n  * UI Functions, Built-ins.\n  ******************************************************************************************************************/\n\tfunction uiOpenAlert(message) {\n\t\tjQuery(Dialog.setup('Alert', 'alert')).append('<p>' + message + '</p><ul class=\"buttons\">' + ('<li><button id=\"alert-ok\" class=\"ui-close\">' + (strings.alert.ok || strings.ok) + '</button></li>') + '</ul>');\n\n\t\tfor (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n\t\t\targs[_key3 - 1] = arguments[_key3];\n\t\t}\n\n\t\tDialog.open.apply(Dialog, args);\n\t}\n\n\tfunction uiOpenJumpto() {\n\t\tuiBuildJumpto();\n\t\tDialog.open.apply(Dialog, arguments);\n\t}\n\n\tfunction uiOpenRestart() {\n\t\tuiBuildRestart();\n\t\tDialog.open.apply(Dialog, arguments);\n\t}\n\n\tfunction uiOpenSaves() {\n\t\tuiBuildSaves();\n\t\tDialog.open.apply(Dialog, arguments);\n\t}\n\n\tfunction uiOpenSettings() {\n\t\tuiBuildSettings();\n\t\tDialog.open.apply(Dialog, arguments);\n\t}\n\n\tfunction uiOpenShare() {\n\t\tuiBuildShare();\n\t\tDialog.open.apply(Dialog, arguments);\n\t}\n\n\tfunction uiBuildAutoload() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiBuildAutoload()]');\n\t\t}\n\n\t\tjQuery(Dialog.setup(strings.autoload.title, 'autoload')).append(\n\t\t/* eslint-disable max-len */\n\t\t'<p>' + strings.autoload.prompt + '</p><ul class=\"buttons\">' + ('<li><button id=\"autoload-ok\" class=\"ui-close\">' + (strings.autoload.ok || strings.ok) + '</button></li>') + ('<li><button id=\"autoload-cancel\" class=\"ui-close\">' + (strings.autoload.cancel || strings.cancel) + '</button></li>') + '</ul>'\n\t\t/* eslint-enable max-len */\n\t\t);\n\n\t\t// Add an additional delegated click handler for the `.ui-close` elements to handle autoloading.\n\t\tjQuery(document).one('click.autoload', '.ui-close', function (evt) {\n\t\t\tvar isAutoloadOk = evt.target.id === 'autoload-ok';\n\t\t\tjQuery(document).one('tw:dialogclosed', function () {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tconsole.log('\\tattempting autoload: \"' + Save.autosave.get().title + '\"');\n\t\t\t\t}\n\n\t\t\t\tif (!isAutoloadOk || !Save.autosave.load()) {\n\t\t\t\t\tEngine.play(Config.passages.start);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tfunction uiBuildJumpto() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiBuildJumpto()]');\n\t\t}\n\n\t\tvar list = document.createElement('ul');\n\n\t\tjQuery(Dialog.setup(strings.jumpto.title, 'jumpto list')).append(list);\n\n\t\tvar expired = State.expired.length;\n\n\t\tfor (var i = State.size - 1; i >= 0; --i) {\n\t\t\tif (i === State.activeIndex) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar passage = Story.get(State.history[i].title);\n\n\t\t\tif (passage && passage.tags.includes('bookmark')) {\n\t\t\t\tjQuery(document.createElement('li')).append(jQuery(document.createElement('a')).ariaClick({ one: true }, function (idx) {\n\t\t\t\t\treturn function () {\n\t\t\t\t\t\treturn jQuery(document).one('tw:dialogclosed', function () {\n\t\t\t\t\t\t\treturn Engine.goTo(idx);\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t}(i)).addClass('ui-close').text(strings.jumpto.turn + ' ' + (expired + i + 1) + ': ' + passage.description())).appendTo(list);\n\t\t\t}\n\t\t}\n\n\t\tif (!list.hasChildNodes()) {\n\t\t\tjQuery(list).append('<li><a><em>' + strings.jumpto.unavailable + '</em></a></li>');\n\t\t}\n\t}\n\n\tfunction uiBuildRestart() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiBuildRestart()]');\n\t\t}\n\n\t\tjQuery(Dialog.setup(strings.restart.title, 'restart')).append(\n\t\t/* eslint-disable max-len */\n\t\t'<p>' + strings.restart.prompt + '</p><ul class=\"buttons\">' + ('<li><button id=\"restart-ok\">' + (strings.restart.ok || strings.ok) + '</button></li>') + ('<li><button id=\"restart-cancel\" class=\"ui-close\">' + (strings.restart.cancel || strings.cancel) + '</button></li>') + '</ul>'\n\t\t/* eslint-enable max-len */\n\t\t).find('#restart-ok')\n\t\t/*\n  \tInstead of adding '.ui-close' to '#restart-ok' (to receive the use of the default\n  \tdelegated dialog close handler), we setup a special case close handler here.  We\n  \tdo this to ensure that the invocation of `Engine.restart()` happens after the dialog\n  \thas fully closed.  If we did not, then a race condition could occur, causing display\n  \tshenanigans.\n  */\n\t\t.ariaClick({ one: true }, function () {\n\t\t\tjQuery(document).one('tw:dialogclosed', function () {\n\t\t\t\treturn Engine.restart();\n\t\t\t});\n\t\t\tDialog.close();\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tfunction uiBuildSaves() {\n\t\tfunction createActionItem(bId, bClass, bText, bAction) {\n\t\t\tvar $btn = jQuery(document.createElement('button')).attr('id', 'saves-' + bId).html(bText);\n\n\t\t\tif (bClass) {\n\t\t\t\t$btn.addClass(bClass);\n\t\t\t}\n\n\t\t\tif (bAction) {\n\t\t\t\t$btn.ariaClick(bAction);\n\t\t\t} else {\n\t\t\t\t$btn.prop('disabled', true);\n\t\t\t}\n\n\t\t\treturn jQuery(document.createElement('li')).append($btn);\n\t\t}\n\n\t\tfunction createSaveList() {\n\t\t\tfunction createButton(bId, bClass, bText, bSlot, bAction) {\n\t\t\t\tvar $btn = jQuery(document.createElement('button')).attr('id', 'saves-' + bId + '-' + bSlot).addClass(bId).html(bText);\n\n\t\t\t\tif (bClass) {\n\t\t\t\t\t$btn.addClass(bClass);\n\t\t\t\t}\n\n\t\t\t\tif (bAction) {\n\t\t\t\t\tif (bSlot === 'auto') {\n\t\t\t\t\t\t$btn.ariaClick({\n\t\t\t\t\t\t\tlabel: bText + ' ' + strings.saves.labelAuto\n\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\treturn bAction();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$btn.ariaClick({\n\t\t\t\t\t\t\tlabel: bText + ' ' + strings.saves.labelSlot + ' ' + (bSlot + 1)\n\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\treturn bAction(bSlot);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$btn.prop('disabled', true);\n\t\t\t\t}\n\n\t\t\t\treturn $btn;\n\t\t\t}\n\n\t\t\tvar saves = Save.get(),\n\t\t\t    $tbody = jQuery(document.createElement('tbody'));\n\n\t\t\tif (Save.autosave.ok()) {\n\t\t\t\tvar $tdSlot = jQuery(document.createElement('td')),\n\t\t\t\t    $tdLoad = jQuery(document.createElement('td')),\n\t\t\t\t    $tdDesc = jQuery(document.createElement('td')),\n\t\t\t\t    $tdDele = jQuery(document.createElement('td'));\n\n\t\t\t\t// Add the slot ID.\n\t\t\t\tjQuery(document.createElement('b')).attr({\n\t\t\t\t\ttitle: strings.saves.labelAuto,\n\t\t\t\t\t'aria-label': strings.saves.labelAuto\n\t\t\t\t}).text('A') // '\\u25C6' Black Diamond\n\t\t\t\t.appendTo($tdSlot);\n\n\t\t\t\tif (saves.autosave) {\n\t\t\t\t\t// Add the load button.\n\t\t\t\t\t$tdLoad.append(createButton('load', 'ui-close', strings.saves.labelLoad, 'auto', function () {\n\t\t\t\t\t\tjQuery(document).one('tw:dialogclosed', function () {\n\t\t\t\t\t\t\treturn Save.autosave.load();\n\t\t\t\t\t\t});\n\t\t\t\t\t}));\n\n\t\t\t\t\t// Add the description (title and datestamp).\n\t\t\t\t\tjQuery(document.createElement('div')).text(saves.autosave.title).appendTo($tdDesc);\n\t\t\t\t\tjQuery(document.createElement('div')).addClass('datestamp').html(saves.autosave.date ? strings.saves.savedOn + ' ' + new Date(saves.autosave.date).toLocaleString() : strings.saves.savedOn + ' <em>' + strings.saves.unknownDate + '</em>').appendTo($tdDesc);\n\n\t\t\t\t\t// Add the delete button.\n\t\t\t\t\t$tdDele.append(createButton('delete', null, strings.saves.labelDelete, 'auto', function () {\n\t\t\t\t\t\tSave.autosave.delete();\n\t\t\t\t\t\tuiBuildSaves();\n\t\t\t\t\t\tDialog.resize();\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\t// Add the load button.\n\t\t\t\t\t$tdLoad.append(createButton('load', null, strings.saves.labelLoad, 'auto'));\n\n\t\t\t\t\t// Add the description.\n\t\t\t\t\tjQuery(document.createElement('em')).text(strings.saves.emptySlot).appendTo($tdDesc);\n\t\t\t\t\t$tdDesc.addClass('empty');\n\n\t\t\t\t\t// Add the delete button.\n\t\t\t\t\t$tdDele.append(createButton('delete', null, strings.saves.labelDelete, 'auto'));\n\t\t\t\t}\n\n\t\t\t\tjQuery(document.createElement('tr')).append($tdSlot).append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody);\n\t\t\t}\n\n\t\t\tfor (var i = 0, iend = saves.slots.length; i < iend; ++i) {\n\t\t\t\tvar _$tdSlot = jQuery(document.createElement('td')),\n\t\t\t\t    _$tdLoad = jQuery(document.createElement('td')),\n\t\t\t\t    _$tdDesc = jQuery(document.createElement('td')),\n\t\t\t\t    _$tdDele = jQuery(document.createElement('td'));\n\n\t\t\t\t// Add the slot ID.\n\t\t\t\t_$tdSlot.append(document.createTextNode(i + 1));\n\n\t\t\t\tif (saves.slots[i]) {\n\t\t\t\t\t// Add the load button.\n\t\t\t\t\t_$tdLoad.append(createButton('load', 'ui-close', strings.saves.labelLoad, i, function (slot) {\n\t\t\t\t\t\tjQuery(document).one('tw:dialogclosed', function () {\n\t\t\t\t\t\t\treturn Save.slots.load(slot);\n\t\t\t\t\t\t});\n\t\t\t\t\t}));\n\n\t\t\t\t\t// Add the description (title and datestamp).\n\t\t\t\t\tjQuery(document.createElement('div')).text(saves.slots[i].title).appendTo(_$tdDesc);\n\t\t\t\t\tjQuery(document.createElement('div')).addClass('datestamp').html(saves.slots[i].date ? strings.saves.savedOn + ' ' + new Date(saves.slots[i].date).toLocaleString() : strings.saves.savedOn + ' <em>' + strings.saves.unknownDate + '</em>').appendTo(_$tdDesc);\n\n\t\t\t\t\t// Add the delete button.\n\t\t\t\t\t_$tdDele.append(createButton('delete', null, strings.saves.labelDelete, i, function (slot) {\n\t\t\t\t\t\tSave.slots.delete(slot);\n\t\t\t\t\t\tuiBuildSaves();\n\t\t\t\t\t\tDialog.resize();\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\t// Add the load button.\n\t\t\t\t\t_$tdLoad.append(createButton('save', 'ui-close', strings.saves.labelSave, i, Save.slots.save));\n\n\t\t\t\t\t// Add the description.\n\t\t\t\t\tjQuery(document.createElement('em')).text(strings.saves.emptySlot).appendTo(_$tdDesc);\n\t\t\t\t\t_$tdDesc.addClass('empty');\n\n\t\t\t\t\t// Add the delete button.\n\t\t\t\t\t_$tdDele.append(createButton('delete', null, strings.saves.labelDelete, i));\n\t\t\t\t}\n\n\t\t\t\tjQuery(document.createElement('tr')).append(_$tdSlot).append(_$tdLoad).append(_$tdDesc).append(_$tdDele).appendTo($tbody);\n\t\t\t}\n\n\t\t\treturn jQuery(document.createElement('table')).attr('id', 'saves-list').append($tbody);\n\t\t}\n\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiBuildSaves()]');\n\t\t}\n\n\t\tvar $dialogBody = jQuery(Dialog.setup(strings.saves.title, 'saves')),\n\t\t    savesOk = Save.ok();\n\n\t\t// Add saves list.\n\t\tif (savesOk) {\n\t\t\t$dialogBody.append(createSaveList());\n\t\t}\n\n\t\t// Add button bar items (export, import, and clear).\n\t\tif (savesOk || Has.fileAPI) {\n\t\t\tvar $btnBar = jQuery(document.createElement('ul')).addClass('buttons').appendTo($dialogBody);\n\n\t\t\tif (Has.fileAPI) {\n\t\t\t\t$btnBar.append(createActionItem('export', 'ui-close', strings.saves.labelExport, function () {\n\t\t\t\t\treturn Save.export();\n\t\t\t\t}));\n\t\t\t\t$btnBar.append(createActionItem('import', null, strings.saves.labelImport, function () {\n\t\t\t\t\treturn $dialogBody.find('#saves-import-file').trigger('click');\n\t\t\t\t}));\n\n\t\t\t\t// Add the hidden `input[type=file]` element which will be triggered by the `#saves-import` button.\n\t\t\t\tjQuery(document.createElement('input')).css({\n\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\tvisibility: 'hidden',\n\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\tleft: '-9999px',\n\t\t\t\t\ttop: '-9999px',\n\t\t\t\t\twidth: '1px',\n\t\t\t\t\theight: '1px'\n\t\t\t\t}).attr({\n\t\t\t\t\ttype: 'file',\n\t\t\t\t\tid: 'saves-import-file',\n\t\t\t\t\ttabindex: -1,\n\t\t\t\t\t'aria-hidden': true\n\t\t\t\t}).on('change', function (evt) {\n\t\t\t\t\tjQuery(document).one('tw:dialogclosed', function () {\n\t\t\t\t\t\treturn Save.import(evt);\n\t\t\t\t\t});\n\t\t\t\t\tDialog.close();\n\t\t\t\t}).appendTo($dialogBody);\n\t\t\t}\n\n\t\t\tif (savesOk) {\n\t\t\t\t$btnBar.append(createActionItem('clear', null, strings.saves.labelClear, Save.autosave.has() || !Save.slots.isEmpty() ? function () {\n\t\t\t\t\tSave.clear();\n\t\t\t\t\tuiBuildSaves();\n\t\t\t\t\tDialog.resize();\n\t\t\t\t} : null));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} else {\n\t\t\tuiOpenAlert(strings.saves.incapable.replace(/%identity%/g, strings.identity));\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tfunction uiBuildSettings() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiBuildSettings()]');\n\t\t}\n\n\t\tvar $dialogBody = jQuery(Dialog.setup(strings.settings.title, 'settings'));\n\n\t\tSetting.forEach(function (control) {\n\t\t\tif (control.type === Setting.Types.Header) {\n\t\t\t\tvar _name = control.name,\n\t\t\t\t    _id = Util.slugify(_name),\n\t\t\t\t    $elHeader = jQuery(document.createElement('div')),\n\t\t\t\t    $elHeading = jQuery(document.createElement('h2')),\n\t\t\t\t    _$elLabel = jQuery(document.createElement('p'));\n\n\t\t\t\t$elHeader.attr('id', 'header-body-' + _id).append($elHeading).append(_$elLabel).appendTo($dialogBody);\n\t\t\t\t$elHeading.attr('id', 'header-heading-' + _id).wiki(_name);\n\t\t\t\t_$elLabel.attr('id', 'header-label-' + _id).wiki(control.label);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar name = control.name,\n\t\t\t    id = Util.slugify(name),\n\t\t\t    $elSetting = jQuery(document.createElement('div')),\n\t\t\t    $elLabel = jQuery(document.createElement('label')),\n\t\t\t    $elWrapper = jQuery(document.createElement('div'));\n\t\t\tvar $elControl = void 0;\n\n\t\t\t$elSetting.attr('id', 'setting-body-' + id).append($elLabel).append($elWrapper).appendTo($dialogBody);\n\n\t\t\t// Setup the label.\n\t\t\t$elLabel.attr({\n\t\t\t\tid: 'setting-label-' + id,\n\t\t\t\tfor: 'setting-control-' + id // must be in sync with $elControl's ID (see below)\n\t\t\t}).wiki(control.label);\n\n\t\t\t// Setup the control.\n\t\t\tif (settings[name] == null) {\n\t\t\t\t// lazy equality for null\n\t\t\t\tsettings[name] = control.default;\n\t\t\t}\n\n\t\t\tswitch (control.type) {\n\t\t\t\tcase Setting.Types.Toggle:\n\t\t\t\t\t$elControl = jQuery(document.createElement('button'));\n\n\t\t\t\t\tif (settings[name]) {\n\t\t\t\t\t\t$elControl.addClass('enabled').text(strings.settings.on);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$elControl.text(strings.settings.off);\n\t\t\t\t\t}\n\n\t\t\t\t\t$elControl.ariaClick(function () {\n\t\t\t\t\t\tif (settings[name]) {\n\t\t\t\t\t\t\tjQuery(this).removeClass('enabled').text(strings.settings.off);\n\t\t\t\t\t\t\tsettings[name] = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tjQuery(this).addClass('enabled').text(strings.settings.on);\n\t\t\t\t\t\t\tsettings[name] = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSetting.save();\n\n\t\t\t\t\t\tif (control.hasOwnProperty('onChange')) {\n\t\t\t\t\t\t\tcontrol.onChange.call({\n\t\t\t\t\t\t\t\tname: name,\n\t\t\t\t\t\t\t\tvalue: settings[name],\n\t\t\t\t\t\t\t\tdefault: control.default\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase Setting.Types.List:\n\t\t\t\t\t$elControl = jQuery(document.createElement('select'));\n\n\t\t\t\t\tfor (var i = 0, iend = control.list.length; i < iend; ++i) {\n\t\t\t\t\t\tjQuery(document.createElement('option')).val(i).text(control.list[i]).appendTo($elControl);\n\t\t\t\t\t}\n\n\t\t\t\t\t$elControl.val(control.list.indexOf(settings[name])).attr('tabindex', 0).on('change', function () {\n\t\t\t\t\t\tsettings[name] = control.list[Number(this.value)];\n\t\t\t\t\t\tSetting.save();\n\n\t\t\t\t\t\tif (control.hasOwnProperty('onChange')) {\n\t\t\t\t\t\t\tcontrol.onChange.call({\n\t\t\t\t\t\t\t\tname: name,\n\t\t\t\t\t\t\t\tvalue: settings[name],\n\t\t\t\t\t\t\t\tdefault: control.default,\n\t\t\t\t\t\t\t\tlist: control.list\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t$elControl.attr('id', 'setting-control-' + id).appendTo($elWrapper);\n\t\t});\n\n\t\t// Add the button bar.\n\t\t$dialogBody.append('<ul class=\"buttons\">' + ('<li><button id=\"settings-ok\" class=\"ui-close\">' + (strings.settings.ok || strings.ok) + '</button></li>') + ('<li><button id=\"settings-reset\">' + strings.settings.reset + '</button></li>') + '</ul>').find('#settings-reset')\n\t\t/*\n  \tInstead of adding '.ui-close' to '#settings-reset' (to receive the use of the default\n  \tdelegated dialog close handler), we setup a special case close handler here.  We\n  \tdo this to ensure that the invocation of `window.location.reload()` happens after the\n  \tdialog has fully closed.  If we did not, then a race condition could occur, causing\n  \tdisplay shenanigans.\n  */\n\t\t.ariaClick({ one: true }, function () {\n\t\t\tjQuery(document).one('tw:dialogclosed', function () {\n\t\t\t\tSetting.reset();\n\t\t\t\twindow.location.reload();\n\t\t\t});\n\t\t\tDialog.close();\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tfunction uiBuildShare() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[UI/uiBuildShare()]');\n\t\t}\n\n\t\tjQuery(Dialog.setup(strings.share.title, 'share list')).append(uiAssembleLinkList('StoryShare'));\n\n\t\treturn true;\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\t/*\n  \tUI Functions, Core.\n  */\n\t\tinit: { value: uiInit },\n\t\tstart: { value: uiStart },\n\t\tsetStoryElements: { value: uiSetStoryElements },\n\t\thideOutlines: { value: uiHideOutlines },\n\t\tshowOutlines: { value: uiShowOutlines },\n\t\tassembleLinkList: { value: uiAssembleLinkList },\n\n\t\t/*\n  \tUI Functions, Built-ins.\n  */\n\t\talert: { value: uiOpenAlert },\n\t\tjumpto: { value: uiOpenJumpto },\n\t\trestart: { value: uiOpenRestart },\n\t\tsaves: { value: uiOpenSaves },\n\t\tsettings: { value: uiOpenSettings },\n\t\tshare: { value: uiOpenShare },\n\t\tbuildAutoload: { value: uiBuildAutoload },\n\t\tbuildJumpto: { value: uiBuildJumpto },\n\t\tbuildRestart: { value: uiBuildRestart },\n\t\tbuildSaves: { value: uiBuildSaves },\n\t\tbuildSettings: { value: uiBuildSettings },\n\t\tbuildShare: { value: uiBuildShare },\n\n\t\t/*\n  \tLegacy Aliases.\n  */\n\t\tisOpen: { value: function value() {\n\t\t\t\treturn Dialog.isOpen.apply(Dialog, arguments);\n\t\t\t} },\n\t\tbody: { value: function value() {\n\t\t\t\treturn Dialog.body();\n\t\t\t} },\n\t\tsetup: { value: function value() {\n\t\t\t\treturn Dialog.setup.apply(Dialog, arguments);\n\t\t\t} },\n\t\taddClickHandler: { value: function value() {\n\t\t\t\treturn Dialog.addClickHandler.apply(Dialog, arguments);\n\t\t\t} },\n\t\topen: { value: function value() {\n\t\t\t\treturn Dialog.open.apply(Dialog, arguments);\n\t\t\t} },\n\t\tclose: { value: function value() {\n\t\t\t\treturn Dialog.close.apply(Dialog, arguments);\n\t\t\t} },\n\t\tresize: { value: function value() {\n\t\t\t\treturn Dialog.resize();\n\t\t\t} },\n\t\t// Deprecated method names.\n\t\tbuildDialogAutoload: { value: uiBuildAutoload },\n\t\tbuildDialogJumpto: { value: uiBuildJumpto },\n\t\tbuildDialogRestart: { value: uiBuildRestart },\n\t\tbuildDialogSaves: { value: uiBuildSaves },\n\t\tbuildDialogSettings: { value: uiBuildSettings },\n\t\tbuildDialogShare: { value: uiBuildShare },\n\t\tbuildLinkListFromPassage: { value: uiAssembleLinkList }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * ar.js\n *\n * Copyright © 2016 Blair MacIntyre <blair@cc.gatech.edu>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n\nvar AR = function () {\n\t// eslint-disable-line no-unused-vars, no-var\n\t'use strict';\n\n\tvar _arScene = null,\n\t    _$storyEntities = null,\n\t    _$passageEntities = null,\n\t    _$hud = null;\n\n\t/*******************************************************************************************************************\n  * Core Functions.\n  ******************************************************************************************************************/\n\tfunction arInit() {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[AR/arInit()]');\n\t\t}\n\n\t\t/*\n  \tGenerate the dialog elements.\n  */\n\t\tvar $uiTree = jQuery(document.createDocumentFragment()).append(\n\t\t/* eslint-disable max-len */\n\t\t//\t\t\t\t\t'<ar-scene id=\"argon-aframe\">' \n\t\t'  <a-entity id=\"story-entities\">' + '  </a-entity>' + '  <a-entity id=\"passage-entities\">' + '  </a-entity>'\n\t\t//\t\t\t\t  + '</ar-scene>'\n\t\t/* eslint-enable max-len */\n\t\t);\n\n\t\t/*\n  \tCache the dialog elements, since they're going to be used often.\n  \t\tn.b. We rewrap the elements themselves, rather than simply using the results of\n  \t     `find()`, so that we cache uncluttered jQuery-wrappers (i.e. `context` refers\n  \t     to the elements and there is no `prevObject`).\n  */\n\t\t_arScene = $('#argon-aframe').get(0);\n\t\t_$storyEntities = jQuery($uiTree.find('#story-entities').get(0));\n\t\t_$passageEntities = jQuery($uiTree.find('#passage-entities').get(0));\n\t\t_$hud = jQuery(document.getElementById('hud'));\n\n\t\t_arScene.addEventListener('argon-initialized', function (evt) {\n\t\t\tconsole.log(\"argon initialized, moving hud\");\n\t\t\t_arScene.hud.hudElements[0].appendChild(_$hud.get(0));\n\t\t});\n\n\t\t/*\n  \tInsert the dialog elements into the page before the store area.\n  */\n\t\t$(\"#argon-aframe\").append($uiTree);\n\n\t\t//$uiTree.insertBefore('#store-area');\n\n\t\t/*\n  \tSet up the scene for AR.  \n  */\n\t\t_$hud.find(\"#passages\").addClass(\"passages-ar\");\n\t\t_$hud.find(\"#story\").addClass(\"story-ar\");\n\t}\n\n\t/*******************************************************************************************************************\n  * Module Exports.\n  ******************************************************************************************************************/\n\treturn Object.freeze(Object.defineProperties({}, {\n\t\tinit: { value: arInit }\n\t}));\n}();\n\n/***********************************************************************************************************************\n *\n * sugarcube.js\n *\n * Copyright © 2013–2016 Thomas Michael Edwards <tmedwards@motoslave.net>. All rights reserved.\n * Use of this source code is governed by a Simplified BSD License which can be found in the LICENSE file.\n *\n **********************************************************************************************************************/\n/*\n\tglobal Alert, Browser, Config, Dialog, DebugView, Engine, Has, KeyValueStore, Macro, Passage, Save, Scripting,\n\t       Setting, State, Story, UI, Util, Wikifier, strings\n*/\n/* eslint-disable no-var */\n\n/*\n\tVersion object.\n*/\nvar version = Object.freeze({\n\ttitle: 'OldFashioned',\n\tmajor: 2,\n\tminor: 7,\n\tpatch: 2,\n\tprerelease: \"\",\n\tbuild: 55,\n\tdate: new Date(\"2016-09-08T02:02:18.955Z\"),\n\t/* legacy */\n\textensions: {},\n\t/* /legacy */\n\n\ttoString: function toString() {\n\t\t'use strict';\n\n\t\tvar prerelease = this.prerelease ? '-' + this.prerelease : '';\n\t\treturn this.major + '.' + this.minor + '.' + this.patch + prerelease + '+' + this.build;\n\t},\n\tshort: function short() {\n\t\t'use strict';\n\n\t\tvar prerelease = this.prerelease ? '-' + this.prerelease : '';\n\t\treturn this.title + ' (v' + this.major + '.' + this.minor + '.' + this.patch + prerelease + ')';\n\t},\n\tlong: function long() {\n\t\t'use strict';\n\n\t\treturn this.title + ' v' + this.toString() + ' (' + this.date.toUTCString() + ')';\n\t}\n});\n\n/* eslint-disable no-unused-vars */\n/*\n\tInternal variables.\n*/\nvar\n// Temporary state object.\nTempState = {},\n\n\n// Temporary _variables object.\nTempVariables = {},\n\n\n// Legacy macros object.\nmacros = {},\n\n\n// Post-display task callbacks object.\npostdisplay = {},\n\n\n// Post-render task callbacks object.\npostrender = {},\n\n\n// Pre-display task callbacks object.\npredisplay = {},\n\n\n// Pre-history task callbacks object.\nprehistory = {},\n\n\n// Pre-render task callbacks object.\nprerender = {},\n\n\n// Session storage manager object.\nsession = null,\n\n\n// Settings object.\nsettings = {},\n\n\n// Setup object.\nsetup = {},\n\n\n// Persistant storage manager object.\nstorage = null;\n\n/*\n\tLegacy aliases.\n*/\nvar browser = Browser,\n    config = Config,\n    has = Has,\n    History = State,\n    state = State,\n    tale = Story;\n/* eslint-enable no-unused-vars */\n\n/*\n\tGlobal `SugarCube` object.  Allows scripts to detect if they're running in SugarCube by\n\ttesting for the object (e.g. `\"SugarCube\" in window`) and contains exported identifiers\n\tfor debugging purposes.\n*/\nwindow.SugarCube = {};\n\n/*\n\tHandle the loading screen.\n\n\tThe value of `document.readyState` may be: 'loading' -> 'interactive' -> 'complete'.\n\tThough, to reach this point, it must already be in, at least, the 'interactive' state.\n*/\njQuery(document).on('readystatechange.SugarCube', function () {\n\t'use strict';\n\n\tif (DEBUG) {\n\t\tconsole.log('[SugarCube/readystatechange()] document.readyState: \"' + document.readyState + '\"');\n\t}\n\n\tvar $html = jQuery(document.documentElement);\n\n\tif (document.readyState === 'complete') {\n\t\tif ($html.hasClass('init-loading')) {\n\t\t\tif (Config.loadDelay > 0) {\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\treturn $html.removeClass('init-loading');\n\t\t\t\t}, Math.max(Engine.minDomActionDelay, Config.loadDelay));\n\t\t\t} else {\n\t\t\t\t$html.removeClass('init-loading');\n\t\t\t}\n\t\t}\n\t} else {\n\t\t$html.addClass('init-loading');\n\t}\n});\n\n/*\n\tMain function, entry point for the story.\n*/\njQuery(function () {\n\t'use strict';\n\n\ttry {\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[SugarCube/main()] Document loaded; beginning startup.');\n\t\t}\n\n\t\t/*\n  \tWARNING!\n  \t\tThe ordering of the code in this function is important, so be careful when mucking around with it.\n  */\n\n\t\t// Normalize the document.\n\t\tif (document.normalize) {\n\t\t\tdocument.normalize();\n\t\t}\n\n\t\t// Load the story data (must be done before most anything else).\n\t\tStory.load();\n\n\t\t// Instantiate the storage and session objects.\n\t\t// n.b. `KeyValueStore()` params: driverType, persist, storageId\n\t\tstorage = new KeyValueStore('webStorage', true, Story.domId);\n\t\tsession = new KeyValueStore('webStorage', false, Story.domId);\n\n\t\t// Alert players when their browser is degrading required capabilities.\n\t\tif (!session.has('rcWarn') && storage.name === 'cookie') {\n\t\t\t/* eslint-disable no-alert */\n\t\t\tsession.set('rcWarn', 1);\n\t\t\twindow.alert(strings.warnings.degraded.replace(/%identity%/g, strings.identity));\n\t\t\t/* eslint-enable no-alert */\n\t\t}\n\n\t\t// Initialize the user interface (must be done before story initialization, specifically before scripts).\n\t\tDialog.init();\n\t\tUI.init();\n\n\t\t// Initialize the story (largely load the user styles, scripts, and widgets).\n\t\tStory.init();\n\n\t\t// Initialize the saves (must be done after story initialization, but before engine start).\n\t\tSave.init();\n\n\t\t// Initialize the settings.\n\t\tSetting.init();\n\n\t\t// Initialize the macros.\n\t\tMacro.init();\n\n\t\t// Add the AR components.\n\t\tAR.init();\n\n\t\t// Start the engine (should be done as late as possible, but before UI startup).\n\t\tEngine.start();\n\n\t\t// Start the user interface.\n\t\tUI.start();\n\n\t\t// Finally, export identifiers for debugging purposes.\n\t\twindow.SugarCube = {\n\t\t\tBrowser: Browser,\n\t\t\tConfig: Config,\n\t\t\tDialog: Dialog,\n\t\t\tDebugView: DebugView,\n\t\t\tEngine: Engine,\n\t\t\tHas: Has,\n\t\t\tMacro: Macro,\n\t\t\tPassage: Passage,\n\t\t\tSave: Save,\n\t\t\tScripting: Scripting,\n\t\t\tSetting: Setting,\n\t\t\tState: State,\n\t\t\tStory: Story,\n\t\t\tTempVariables: TempVariables,\n\t\t\tUI: UI,\n\t\t\tUtil: Util,\n\t\t\tWikifier: Wikifier,\n\t\t\tmacros: macros,\n\t\t\tsession: session,\n\t\t\tsettings: settings,\n\t\t\tsetup: setup,\n\t\t\tstorage: storage,\n\t\t\tversion: version\n\t\t};\n\n\t\tif (DEBUG) {\n\t\t\tconsole.log('[SugarCube/main()] Startup complete; story ready.');\n\t\t}\n\t} catch (e) {\n\t\tjQuery(document).off('readystatechange.SugarCube');\n\t\treturn Alert.fatal(null, e.message, e);\n\t}\n});\n})(window, window.document, jQuery);\n}\n\t</script>\n</body>\n</html>\n"});